var YV=Object.defineProperty;var hP=t=>{throw TypeError(t)};var QV=(t,e,r)=>e in t?YV(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r;var ce=(t,e,r)=>QV(t,typeof e!="symbol"?e+"":e,r),K0=(t,e,r)=>e.has(t)||hP("Cannot "+r);var Ve=(t,e,r)=>(K0(t,e,"read from private field"),r?r.call(t):e.get(t)),fr=(t,e,r)=>e.has(t)?hP("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(t):e.set(t,r),Bt=(t,e,r,n)=>(K0(t,e,"write to private field"),n?n.call(t,r):e.set(t,r),r),Nn=(t,e,r)=>(K0(t,e,"access private method"),r);var np=(t,e,r,n)=>({set _(s){Bt(t,e,s,r)},get _(){return Ve(t,e,n)}});function JV(t,e){for(var r=0;r<e.length;r++){const n=e[r];if(typeof n!="string"&&!Array.isArray(n)){for(const s in n)if(s!=="default"&&!(s in t)){const i=Object.getOwnPropertyDescriptor(n,s);i&&Object.defineProperty(t,s,i.get?i:{enumerable:!0,get:()=>n[s]})}}}return Object.freeze(Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}))}(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))n(s);new MutationObserver(s=>{for(const i of s)if(i.type==="childList")for(const o of i.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&n(o)}).observe(document,{childList:!0,subtree:!0});function r(s){const i={};return s.integrity&&(i.integrity=s.integrity),s.referrerPolicy&&(i.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?i.credentials="include":s.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function n(s){if(s.ep)return;s.ep=!0;const i=r(s);fetch(s.href,i)}})();function qD(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var YD={exports:{}},Vg={},QD={exports:{}},Ht={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Qh=Symbol.for("react.element"),ZV=Symbol.for("react.portal"),eW=Symbol.for("react.fragment"),tW=Symbol.for("react.strict_mode"),rW=Symbol.for("react.profiler"),nW=Symbol.for("react.provider"),sW=Symbol.for("react.context"),iW=Symbol.for("react.forward_ref"),oW=Symbol.for("react.suspense"),aW=Symbol.for("react.memo"),lW=Symbol.for("react.lazy"),fP=Symbol.iterator;function cW(t){return t===null||typeof t!="object"?null:(t=fP&&t[fP]||t["@@iterator"],typeof t=="function"?t:null)}var JD={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},ZD=Object.assign,eI={};function $u(t,e,r){this.props=t,this.context=e,this.refs=eI,this.updater=r||JD}$u.prototype.isReactComponent={};$u.prototype.setState=function(t,e){if(typeof t!="object"&&typeof t!="function"&&t!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,t,e,"setState")};$u.prototype.forceUpdate=function(t){this.updater.enqueueForceUpdate(this,t,"forceUpdate")};function tI(){}tI.prototype=$u.prototype;function Yx(t,e,r){this.props=t,this.context=e,this.refs=eI,this.updater=r||JD}var Qx=Yx.prototype=new tI;Qx.constructor=Yx;ZD(Qx,$u.prototype);Qx.isPureReactComponent=!0;var pP=Array.isArray,rI=Object.prototype.hasOwnProperty,Jx={current:null},nI={key:!0,ref:!0,__self:!0,__source:!0};function sI(t,e,r){var n,s={},i=null,o=null;if(e!=null)for(n in e.ref!==void 0&&(o=e.ref),e.key!==void 0&&(i=""+e.key),e)rI.call(e,n)&&!nI.hasOwnProperty(n)&&(s[n]=e[n]);var a=arguments.length-2;if(a===1)s.children=r;else if(1<a){for(var l=Array(a),c=0;c<a;c++)l[c]=arguments[c+2];s.children=l}if(t&&t.defaultProps)for(n in a=t.defaultProps,a)s[n]===void 0&&(s[n]=a[n]);return{$$typeof:Qh,type:t,key:i,ref:o,props:s,_owner:Jx.current}}function uW(t,e){return{$$typeof:Qh,type:t.type,key:e,ref:t.ref,props:t.props,_owner:t._owner}}function Zx(t){return typeof t=="object"&&t!==null&&t.$$typeof===Qh}function dW(t){var e={"=":"=0",":":"=2"};return"$"+t.replace(/[=:]/g,function(r){return e[r]})}var mP=/\/+/g;function X0(t,e){return typeof t=="object"&&t!==null&&t.key!=null?dW(""+t.key):e.toString(36)}function _m(t,e,r,n,s){var i=typeof t;(i==="undefined"||i==="boolean")&&(t=null);var o=!1;if(t===null)o=!0;else switch(i){case"string":case"number":o=!0;break;case"object":switch(t.$$typeof){case Qh:case ZV:o=!0}}if(o)return o=t,s=s(o),t=n===""?"."+X0(o,0):n,pP(s)?(r="",t!=null&&(r=t.replace(mP,"$&/")+"/"),_m(s,e,r,"",function(c){return c})):s!=null&&(Zx(s)&&(s=uW(s,r+(!s.key||o&&o.key===s.key?"":(""+s.key).replace(mP,"$&/")+"/")+t)),e.push(s)),1;if(o=0,n=n===""?".":n+":",pP(t))for(var a=0;a<t.length;a++){i=t[a];var l=n+X0(i,a);o+=_m(i,e,r,l,s)}else if(l=cW(t),typeof l=="function")for(t=l.call(t),a=0;!(i=t.next()).done;)i=i.value,l=n+X0(i,a++),o+=_m(i,e,r,l,s);else if(i==="object")throw e=String(t),Error("Objects are not valid as a React child (found: "+(e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e)+"). If you meant to render a collection of children, use an array instead.");return o}function sp(t,e,r){if(t==null)return t;var n=[],s=0;return _m(t,n,"","",function(i){return e.call(r,i,s++)}),n}function hW(t){if(t._status===-1){var e=t._result;e=e(),e.then(function(r){(t._status===0||t._status===-1)&&(t._status=1,t._result=r)},function(r){(t._status===0||t._status===-1)&&(t._status=2,t._result=r)}),t._status===-1&&(t._status=0,t._result=e)}if(t._status===1)return t._result.default;throw t._result}var ns={current:null},ym={transition:null},fW={ReactCurrentDispatcher:ns,ReactCurrentBatchConfig:ym,ReactCurrentOwner:Jx};function iI(){throw Error("act(...) is not supported in production builds of React.")}Ht.Children={map:sp,forEach:function(t,e,r){sp(t,function(){e.apply(this,arguments)},r)},count:function(t){var e=0;return sp(t,function(){e++}),e},toArray:function(t){return sp(t,function(e){return e})||[]},only:function(t){if(!Zx(t))throw Error("React.Children.only expected to receive a single React element child.");return t}};Ht.Component=$u;Ht.Fragment=eW;Ht.Profiler=rW;Ht.PureComponent=Yx;Ht.StrictMode=tW;Ht.Suspense=oW;Ht.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=fW;Ht.act=iI;Ht.cloneElement=function(t,e,r){if(t==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+t+".");var n=ZD({},t.props),s=t.key,i=t.ref,o=t._owner;if(e!=null){if(e.ref!==void 0&&(i=e.ref,o=Jx.current),e.key!==void 0&&(s=""+e.key),t.type&&t.type.defaultProps)var a=t.type.defaultProps;for(l in e)rI.call(e,l)&&!nI.hasOwnProperty(l)&&(n[l]=e[l]===void 0&&a!==void 0?a[l]:e[l])}var l=arguments.length-2;if(l===1)n.children=r;else if(1<l){a=Array(l);for(var c=0;c<l;c++)a[c]=arguments[c+2];n.children=a}return{$$typeof:Qh,type:t.type,key:s,ref:i,props:n,_owner:o}};Ht.createContext=function(t){return t={$$typeof:sW,_currentValue:t,_currentValue2:t,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},t.Provider={$$typeof:nW,_context:t},t.Consumer=t};Ht.createElement=sI;Ht.createFactory=function(t){var e=sI.bind(null,t);return e.type=t,e};Ht.createRef=function(){return{current:null}};Ht.forwardRef=function(t){return{$$typeof:iW,render:t}};Ht.isValidElement=Zx;Ht.lazy=function(t){return{$$typeof:lW,_payload:{_status:-1,_result:t},_init:hW}};Ht.memo=function(t,e){return{$$typeof:aW,type:t,compare:e===void 0?null:e}};Ht.startTransition=function(t){var e=ym.transition;ym.transition={};try{t()}finally{ym.transition=e}};Ht.unstable_act=iI;Ht.useCallback=function(t,e){return ns.current.useCallback(t,e)};Ht.useContext=function(t){return ns.current.useContext(t)};Ht.useDebugValue=function(){};Ht.useDeferredValue=function(t){return ns.current.useDeferredValue(t)};Ht.useEffect=function(t,e){return ns.current.useEffect(t,e)};Ht.useId=function(){return ns.current.useId()};Ht.useImperativeHandle=function(t,e,r){return ns.current.useImperativeHandle(t,e,r)};Ht.useInsertionEffect=function(t,e){return ns.current.useInsertionEffect(t,e)};Ht.useLayoutEffect=function(t,e){return ns.current.useLayoutEffect(t,e)};Ht.useMemo=function(t,e){return ns.current.useMemo(t,e)};Ht.useReducer=function(t,e,r){return ns.current.useReducer(t,e,r)};Ht.useRef=function(t){return ns.current.useRef(t)};Ht.useState=function(t){return ns.current.useState(t)};Ht.useSyncExternalStore=function(t,e,r){return ns.current.useSyncExternalStore(t,e,r)};Ht.useTransition=function(){return ns.current.useTransition()};Ht.version="18.3.1";QD.exports=Ht;var D=QD.exports;const st=qD(D),oI=JV({__proto__:null,default:st},[D]);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var pW=D,mW=Symbol.for("react.element"),gW=Symbol.for("react.fragment"),_W=Object.prototype.hasOwnProperty,yW=pW.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,vW={key:!0,ref:!0,__self:!0,__source:!0};function aI(t,e,r){var n,s={},i=null,o=null;r!==void 0&&(i=""+r),e.key!==void 0&&(i=""+e.key),e.ref!==void 0&&(o=e.ref);for(n in e)_W.call(e,n)&&!vW.hasOwnProperty(n)&&(s[n]=e[n]);if(t&&t.defaultProps)for(n in e=t.defaultProps,e)s[n]===void 0&&(s[n]=e[n]);return{$$typeof:mW,type:t,key:i,ref:o,props:s,_owner:yW.current}}Vg.Fragment=gW;Vg.jsx=aI;Vg.jsxs=aI;YD.exports=Vg;var G=YD.exports,lI={exports:{}},js={},cI={exports:{}},uI={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(t){function e(N,ne){var te=N.length;N.push(ne);e:for(;0<te;){var z=te-1>>>1,O=N[z];if(0<s(O,ne))N[z]=ne,N[te]=O,te=z;else break e}}function r(N){return N.length===0?null:N[0]}function n(N){if(N.length===0)return null;var ne=N[0],te=N.pop();if(te!==ne){N[0]=te;e:for(var z=0,O=N.length,H=O>>>1;z<H;){var re=2*(z+1)-1,_e=N[re],oe=re+1,pe=N[oe];if(0>s(_e,te))oe<O&&0>s(pe,_e)?(N[z]=pe,N[oe]=te,z=oe):(N[z]=_e,N[re]=te,z=re);else if(oe<O&&0>s(pe,te))N[z]=pe,N[oe]=te,z=oe;else break e}}return ne}function s(N,ne){var te=N.sortIndex-ne.sortIndex;return te!==0?te:N.id-ne.id}if(typeof performance=="object"&&typeof performance.now=="function"){var i=performance;t.unstable_now=function(){return i.now()}}else{var o=Date,a=o.now();t.unstable_now=function(){return o.now()-a}}var l=[],c=[],u=1,d=null,h=3,f=!1,p=!1,m=!1,y=typeof setTimeout=="function"?setTimeout:null,g=typeof clearTimeout=="function"?clearTimeout:null,_=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function v(N){for(var ne=r(c);ne!==null;){if(ne.callback===null)n(c);else if(ne.startTime<=N)n(c),ne.sortIndex=ne.expirationTime,e(l,ne);else break;ne=r(c)}}function w(N){if(m=!1,v(N),!p)if(r(l)!==null)p=!0,Y(x);else{var ne=r(c);ne!==null&&J(w,ne.startTime-N)}}function x(N,ne){p=!1,m&&(m=!1,g(S),S=-1),f=!0;var te=h;try{for(v(ne),d=r(l);d!==null&&(!(d.expirationTime>ne)||N&&!j());){var z=d.callback;if(typeof z=="function"){d.callback=null,h=d.priorityLevel;var O=z(d.expirationTime<=ne);ne=t.unstable_now(),typeof O=="function"?d.callback=O:d===r(l)&&n(l),v(ne)}else n(l);d=r(l)}if(d!==null)var H=!0;else{var re=r(c);re!==null&&J(w,re.startTime-ne),H=!1}return H}finally{d=null,h=te,f=!1}}var M=!1,T=null,S=-1,k=5,$=-1;function j(){return!(t.unstable_now()-$<k)}function V(){if(T!==null){var N=t.unstable_now();$=N;var ne=!0;try{ne=T(!0,N)}finally{ne?L():(M=!1,T=null)}}else M=!1}var L;if(typeof _=="function")L=function(){_(V)};else if(typeof MessageChannel<"u"){var X=new MessageChannel,K=X.port2;X.port1.onmessage=V,L=function(){K.postMessage(null)}}else L=function(){y(V,0)};function Y(N){T=N,M||(M=!0,L())}function J(N,ne){S=y(function(){N(t.unstable_now())},ne)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(N){N.callback=null},t.unstable_continueExecution=function(){p||f||(p=!0,Y(x))},t.unstable_forceFrameRate=function(N){0>N||125<N?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):k=0<N?Math.floor(1e3/N):5},t.unstable_getCurrentPriorityLevel=function(){return h},t.unstable_getFirstCallbackNode=function(){return r(l)},t.unstable_next=function(N){switch(h){case 1:case 2:case 3:var ne=3;break;default:ne=h}var te=h;h=ne;try{return N()}finally{h=te}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(N,ne){switch(N){case 1:case 2:case 3:case 4:case 5:break;default:N=3}var te=h;h=N;try{return ne()}finally{h=te}},t.unstable_scheduleCallback=function(N,ne,te){var z=t.unstable_now();switch(typeof te=="object"&&te!==null?(te=te.delay,te=typeof te=="number"&&0<te?z+te:z):te=z,N){case 1:var O=-1;break;case 2:O=250;break;case 5:O=1073741823;break;case 4:O=1e4;break;default:O=5e3}return O=te+O,N={id:u++,callback:ne,priorityLevel:N,startTime:te,expirationTime:O,sortIndex:-1},te>z?(N.sortIndex=te,e(c,N),r(l)===null&&N===r(c)&&(m?(g(S),S=-1):m=!0,J(w,te-z))):(N.sortIndex=O,e(l,N),p||f||(p=!0,Y(x))),N},t.unstable_shouldYield=j,t.unstable_wrapCallback=function(N){var ne=h;return function(){var te=h;h=ne;try{return N.apply(this,arguments)}finally{h=te}}}})(uI);cI.exports=uI;var wW=cI.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var xW=D,Ls=wW;function Ye(t){for(var e="https://reactjs.org/docs/error-decoder.html?invariant="+t,r=1;r<arguments.length;r++)e+="&args[]="+encodeURIComponent(arguments[r]);return"Minified React error #"+t+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var dI=new Set,yh={};function rc(t,e){vu(t,e),vu(t+"Capture",e)}function vu(t,e){for(yh[t]=e,t=0;t<e.length;t++)dI.add(e[t])}var Fo=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),Xv=Object.prototype.hasOwnProperty,bW=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,gP={},_P={};function MW(t){return Xv.call(_P,t)?!0:Xv.call(gP,t)?!1:bW.test(t)?_P[t]=!0:(gP[t]=!0,!1)}function TW(t,e,r,n){if(r!==null&&r.type===0)return!1;switch(typeof e){case"function":case"symbol":return!0;case"boolean":return n?!1:r!==null?!r.acceptsBooleans:(t=t.toLowerCase().slice(0,5),t!=="data-"&&t!=="aria-");default:return!1}}function CW(t,e,r,n){if(e===null||typeof e>"u"||TW(t,e,r,n))return!0;if(n)return!1;if(r!==null)switch(r.type){case 3:return!e;case 4:return e===!1;case 5:return isNaN(e);case 6:return isNaN(e)||1>e}return!1}function ss(t,e,r,n,s,i,o){this.acceptsBooleans=e===2||e===3||e===4,this.attributeName=n,this.attributeNamespace=s,this.mustUseProperty=r,this.propertyName=t,this.type=e,this.sanitizeURL=i,this.removeEmptyString=o}var Ln={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(t){Ln[t]=new ss(t,0,!1,t,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(t){var e=t[0];Ln[e]=new ss(e,1,!1,t[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(t){Ln[t]=new ss(t,2,!1,t.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(t){Ln[t]=new ss(t,2,!1,t,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(t){Ln[t]=new ss(t,3,!1,t.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(t){Ln[t]=new ss(t,3,!0,t,null,!1,!1)});["capture","download"].forEach(function(t){Ln[t]=new ss(t,4,!1,t,null,!1,!1)});["cols","rows","size","span"].forEach(function(t){Ln[t]=new ss(t,6,!1,t,null,!1,!1)});["rowSpan","start"].forEach(function(t){Ln[t]=new ss(t,5,!1,t.toLowerCase(),null,!1,!1)});var e1=/[\-:]([a-z])/g;function t1(t){return t[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(t){var e=t.replace(e1,t1);Ln[e]=new ss(e,1,!1,t,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(t){var e=t.replace(e1,t1);Ln[e]=new ss(e,1,!1,t,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(t){var e=t.replace(e1,t1);Ln[e]=new ss(e,1,!1,t,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(t){Ln[t]=new ss(t,1,!1,t.toLowerCase(),null,!1,!1)});Ln.xlinkHref=new ss("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(t){Ln[t]=new ss(t,1,!1,t.toLowerCase(),null,!0,!0)});function r1(t,e,r,n){var s=Ln.hasOwnProperty(e)?Ln[e]:null;(s!==null?s.type!==0:n||!(2<e.length)||e[0]!=="o"&&e[0]!=="O"||e[1]!=="n"&&e[1]!=="N")&&(CW(e,r,s,n)&&(r=null),n||s===null?MW(e)&&(r===null?t.removeAttribute(e):t.setAttribute(e,""+r)):s.mustUseProperty?t[s.propertyName]=r===null?s.type===3?!1:"":r:(e=s.attributeName,n=s.attributeNamespace,r===null?t.removeAttribute(e):(s=s.type,r=s===3||s===4&&r===!0?"":""+r,n?t.setAttributeNS(n,e,r):t.setAttribute(e,r))))}var Go=xW.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,ip=Symbol.for("react.element"),Oc=Symbol.for("react.portal"),Dc=Symbol.for("react.fragment"),n1=Symbol.for("react.strict_mode"),qv=Symbol.for("react.profiler"),hI=Symbol.for("react.provider"),fI=Symbol.for("react.context"),s1=Symbol.for("react.forward_ref"),Yv=Symbol.for("react.suspense"),Qv=Symbol.for("react.suspense_list"),i1=Symbol.for("react.memo"),ma=Symbol.for("react.lazy"),pI=Symbol.for("react.offscreen"),yP=Symbol.iterator;function Cd(t){return t===null||typeof t!="object"?null:(t=yP&&t[yP]||t["@@iterator"],typeof t=="function"?t:null)}var Vr=Object.assign,q0;function Kd(t){if(q0===void 0)try{throw Error()}catch(r){var e=r.stack.trim().match(/\n( *(at )?)/);q0=e&&e[1]||""}return`
`+q0+t}var Y0=!1;function Q0(t,e){if(!t||Y0)return"";Y0=!0;var r=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(e)if(e=function(){throw Error()},Object.defineProperty(e.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(e,[])}catch(c){var n=c}Reflect.construct(t,[],e)}else{try{e.call()}catch(c){n=c}t.call(e.prototype)}else{try{throw Error()}catch(c){n=c}t()}}catch(c){if(c&&n&&typeof c.stack=="string"){for(var s=c.stack.split(`
`),i=n.stack.split(`
`),o=s.length-1,a=i.length-1;1<=o&&0<=a&&s[o]!==i[a];)a--;for(;1<=o&&0<=a;o--,a--)if(s[o]!==i[a]){if(o!==1||a!==1)do if(o--,a--,0>a||s[o]!==i[a]){var l=`
`+s[o].replace(" at new "," at ");return t.displayName&&l.includes("<anonymous>")&&(l=l.replace("<anonymous>",t.displayName)),l}while(1<=o&&0<=a);break}}}finally{Y0=!1,Error.prepareStackTrace=r}return(t=t?t.displayName||t.name:"")?Kd(t):""}function SW(t){switch(t.tag){case 5:return Kd(t.type);case 16:return Kd("Lazy");case 13:return Kd("Suspense");case 19:return Kd("SuspenseList");case 0:case 2:case 15:return t=Q0(t.type,!1),t;case 11:return t=Q0(t.type.render,!1),t;case 1:return t=Q0(t.type,!0),t;default:return""}}function Jv(t){if(t==null)return null;if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t;switch(t){case Dc:return"Fragment";case Oc:return"Portal";case qv:return"Profiler";case n1:return"StrictMode";case Yv:return"Suspense";case Qv:return"SuspenseList"}if(typeof t=="object")switch(t.$$typeof){case fI:return(t.displayName||"Context")+".Consumer";case hI:return(t._context.displayName||"Context")+".Provider";case s1:var e=t.render;return t=t.displayName,t||(t=e.displayName||e.name||"",t=t!==""?"ForwardRef("+t+")":"ForwardRef"),t;case i1:return e=t.displayName||null,e!==null?e:Jv(t.type)||"Memo";case ma:e=t._payload,t=t._init;try{return Jv(t(e))}catch{}}return null}function EW(t){var e=t.type;switch(t.tag){case 24:return"Cache";case 9:return(e.displayName||"Context")+".Consumer";case 10:return(e._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return t=e.render,t=t.displayName||t.name||"",e.displayName||(t!==""?"ForwardRef("+t+")":"ForwardRef");case 7:return"Fragment";case 5:return e;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return Jv(e);case 8:return e===n1?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e}return null}function Fa(t){switch(typeof t){case"boolean":case"number":case"string":case"undefined":return t;case"object":return t;default:return""}}function mI(t){var e=t.type;return(t=t.nodeName)&&t.toLowerCase()==="input"&&(e==="checkbox"||e==="radio")}function PW(t){var e=mI(t)?"checked":"value",r=Object.getOwnPropertyDescriptor(t.constructor.prototype,e),n=""+t[e];if(!t.hasOwnProperty(e)&&typeof r<"u"&&typeof r.get=="function"&&typeof r.set=="function"){var s=r.get,i=r.set;return Object.defineProperty(t,e,{configurable:!0,get:function(){return s.call(this)},set:function(o){n=""+o,i.call(this,o)}}),Object.defineProperty(t,e,{enumerable:r.enumerable}),{getValue:function(){return n},setValue:function(o){n=""+o},stopTracking:function(){t._valueTracker=null,delete t[e]}}}}function op(t){t._valueTracker||(t._valueTracker=PW(t))}function gI(t){if(!t)return!1;var e=t._valueTracker;if(!e)return!0;var r=e.getValue(),n="";return t&&(n=mI(t)?t.checked?"true":"false":t.value),t=n,t!==r?(e.setValue(t),!0):!1}function Wm(t){if(t=t||(typeof document<"u"?document:void 0),typeof t>"u")return null;try{return t.activeElement||t.body}catch{return t.body}}function Zv(t,e){var r=e.checked;return Vr({},e,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:r??t._wrapperState.initialChecked})}function vP(t,e){var r=e.defaultValue==null?"":e.defaultValue,n=e.checked!=null?e.checked:e.defaultChecked;r=Fa(e.value!=null?e.value:r),t._wrapperState={initialChecked:n,initialValue:r,controlled:e.type==="checkbox"||e.type==="radio"?e.checked!=null:e.value!=null}}function _I(t,e){e=e.checked,e!=null&&r1(t,"checked",e,!1)}function ew(t,e){_I(t,e);var r=Fa(e.value),n=e.type;if(r!=null)n==="number"?(r===0&&t.value===""||t.value!=r)&&(t.value=""+r):t.value!==""+r&&(t.value=""+r);else if(n==="submit"||n==="reset"){t.removeAttribute("value");return}e.hasOwnProperty("value")?tw(t,e.type,r):e.hasOwnProperty("defaultValue")&&tw(t,e.type,Fa(e.defaultValue)),e.checked==null&&e.defaultChecked!=null&&(t.defaultChecked=!!e.defaultChecked)}function wP(t,e,r){if(e.hasOwnProperty("value")||e.hasOwnProperty("defaultValue")){var n=e.type;if(!(n!=="submit"&&n!=="reset"||e.value!==void 0&&e.value!==null))return;e=""+t._wrapperState.initialValue,r||e===t.value||(t.value=e),t.defaultValue=e}r=t.name,r!==""&&(t.name=""),t.defaultChecked=!!t._wrapperState.initialChecked,r!==""&&(t.name=r)}function tw(t,e,r){(e!=="number"||Wm(t.ownerDocument)!==t)&&(r==null?t.defaultValue=""+t._wrapperState.initialValue:t.defaultValue!==""+r&&(t.defaultValue=""+r))}var Xd=Array.isArray;function qc(t,e,r,n){if(t=t.options,e){e={};for(var s=0;s<r.length;s++)e["$"+r[s]]=!0;for(r=0;r<t.length;r++)s=e.hasOwnProperty("$"+t[r].value),t[r].selected!==s&&(t[r].selected=s),s&&n&&(t[r].defaultSelected=!0)}else{for(r=""+Fa(r),e=null,s=0;s<t.length;s++){if(t[s].value===r){t[s].selected=!0,n&&(t[s].defaultSelected=!0);return}e!==null||t[s].disabled||(e=t[s])}e!==null&&(e.selected=!0)}}function rw(t,e){if(e.dangerouslySetInnerHTML!=null)throw Error(Ye(91));return Vr({},e,{value:void 0,defaultValue:void 0,children:""+t._wrapperState.initialValue})}function xP(t,e){var r=e.value;if(r==null){if(r=e.children,e=e.defaultValue,r!=null){if(e!=null)throw Error(Ye(92));if(Xd(r)){if(1<r.length)throw Error(Ye(93));r=r[0]}e=r}e==null&&(e=""),r=e}t._wrapperState={initialValue:Fa(r)}}function yI(t,e){var r=Fa(e.value),n=Fa(e.defaultValue);r!=null&&(r=""+r,r!==t.value&&(t.value=r),e.defaultValue==null&&t.defaultValue!==r&&(t.defaultValue=r)),n!=null&&(t.defaultValue=""+n)}function bP(t){var e=t.textContent;e===t._wrapperState.initialValue&&e!==""&&e!==null&&(t.value=e)}function vI(t){switch(t){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function nw(t,e){return t==null||t==="http://www.w3.org/1999/xhtml"?vI(e):t==="http://www.w3.org/2000/svg"&&e==="foreignObject"?"http://www.w3.org/1999/xhtml":t}var ap,wI=function(t){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(e,r,n,s){MSApp.execUnsafeLocalFunction(function(){return t(e,r,n,s)})}:t}(function(t,e){if(t.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in t)t.innerHTML=e;else{for(ap=ap||document.createElement("div"),ap.innerHTML="<svg>"+e.valueOf().toString()+"</svg>",e=ap.firstChild;t.firstChild;)t.removeChild(t.firstChild);for(;e.firstChild;)t.appendChild(e.firstChild)}});function vh(t,e){if(e){var r=t.firstChild;if(r&&r===t.lastChild&&r.nodeType===3){r.nodeValue=e;return}}t.textContent=e}var nh={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},kW=["Webkit","ms","Moz","O"];Object.keys(nh).forEach(function(t){kW.forEach(function(e){e=e+t.charAt(0).toUpperCase()+t.substring(1),nh[e]=nh[t]})});function xI(t,e,r){return e==null||typeof e=="boolean"||e===""?"":r||typeof e!="number"||e===0||nh.hasOwnProperty(t)&&nh[t]?(""+e).trim():e+"px"}function bI(t,e){t=t.style;for(var r in e)if(e.hasOwnProperty(r)){var n=r.indexOf("--")===0,s=xI(r,e[r],n);r==="float"&&(r="cssFloat"),n?t.setProperty(r,s):t[r]=s}}var AW=Vr({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function sw(t,e){if(e){if(AW[t]&&(e.children!=null||e.dangerouslySetInnerHTML!=null))throw Error(Ye(137,t));if(e.dangerouslySetInnerHTML!=null){if(e.children!=null)throw Error(Ye(60));if(typeof e.dangerouslySetInnerHTML!="object"||!("__html"in e.dangerouslySetInnerHTML))throw Error(Ye(61))}if(e.style!=null&&typeof e.style!="object")throw Error(Ye(62))}}function iw(t,e){if(t.indexOf("-")===-1)return typeof e.is=="string";switch(t){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var ow=null;function o1(t){return t=t.target||t.srcElement||window,t.correspondingUseElement&&(t=t.correspondingUseElement),t.nodeType===3?t.parentNode:t}var aw=null,Yc=null,Qc=null;function MP(t){if(t=ef(t)){if(typeof aw!="function")throw Error(Ye(280));var e=t.stateNode;e&&(e=Kg(e),aw(t.stateNode,t.type,e))}}function MI(t){Yc?Qc?Qc.push(t):Qc=[t]:Yc=t}function TI(){if(Yc){var t=Yc,e=Qc;if(Qc=Yc=null,MP(t),e)for(t=0;t<e.length;t++)MP(e[t])}}function CI(t,e){return t(e)}function SI(){}var J0=!1;function EI(t,e,r){if(J0)return t(e,r);J0=!0;try{return CI(t,e,r)}finally{J0=!1,(Yc!==null||Qc!==null)&&(SI(),TI())}}function wh(t,e){var r=t.stateNode;if(r===null)return null;var n=Kg(r);if(n===null)return null;r=n[e];e:switch(e){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(n=!n.disabled)||(t=t.type,n=!(t==="button"||t==="input"||t==="select"||t==="textarea")),t=!n;break e;default:t=!1}if(t)return null;if(r&&typeof r!="function")throw Error(Ye(231,e,typeof r));return r}var lw=!1;if(Fo)try{var Sd={};Object.defineProperty(Sd,"passive",{get:function(){lw=!0}}),window.addEventListener("test",Sd,Sd),window.removeEventListener("test",Sd,Sd)}catch{lw=!1}function $W(t,e,r,n,s,i,o,a,l){var c=Array.prototype.slice.call(arguments,3);try{e.apply(r,c)}catch(u){this.onError(u)}}var sh=!1,Um=null,Gm=!1,cw=null,OW={onError:function(t){sh=!0,Um=t}};function DW(t,e,r,n,s,i,o,a,l){sh=!1,Um=null,$W.apply(OW,arguments)}function IW(t,e,r,n,s,i,o,a,l){if(DW.apply(this,arguments),sh){if(sh){var c=Um;sh=!1,Um=null}else throw Error(Ye(198));Gm||(Gm=!0,cw=c)}}function nc(t){var e=t,r=t;if(t.alternate)for(;e.return;)e=e.return;else{t=e;do e=t,e.flags&4098&&(r=e.return),t=e.return;while(t)}return e.tag===3?r:null}function PI(t){if(t.tag===13){var e=t.memoizedState;if(e===null&&(t=t.alternate,t!==null&&(e=t.memoizedState)),e!==null)return e.dehydrated}return null}function TP(t){if(nc(t)!==t)throw Error(Ye(188))}function FW(t){var e=t.alternate;if(!e){if(e=nc(t),e===null)throw Error(Ye(188));return e!==t?null:t}for(var r=t,n=e;;){var s=r.return;if(s===null)break;var i=s.alternate;if(i===null){if(n=s.return,n!==null){r=n;continue}break}if(s.child===i.child){for(i=s.child;i;){if(i===r)return TP(s),t;if(i===n)return TP(s),e;i=i.sibling}throw Error(Ye(188))}if(r.return!==n.return)r=s,n=i;else{for(var o=!1,a=s.child;a;){if(a===r){o=!0,r=s,n=i;break}if(a===n){o=!0,n=s,r=i;break}a=a.sibling}if(!o){for(a=i.child;a;){if(a===r){o=!0,r=i,n=s;break}if(a===n){o=!0,n=i,r=s;break}a=a.sibling}if(!o)throw Error(Ye(189))}}if(r.alternate!==n)throw Error(Ye(190))}if(r.tag!==3)throw Error(Ye(188));return r.stateNode.current===r?t:e}function kI(t){return t=FW(t),t!==null?AI(t):null}function AI(t){if(t.tag===5||t.tag===6)return t;for(t=t.child;t!==null;){var e=AI(t);if(e!==null)return e;t=t.sibling}return null}var $I=Ls.unstable_scheduleCallback,CP=Ls.unstable_cancelCallback,LW=Ls.unstable_shouldYield,RW=Ls.unstable_requestPaint,rn=Ls.unstable_now,jW=Ls.unstable_getCurrentPriorityLevel,a1=Ls.unstable_ImmediatePriority,OI=Ls.unstable_UserBlockingPriority,Hm=Ls.unstable_NormalPriority,NW=Ls.unstable_LowPriority,DI=Ls.unstable_IdlePriority,Wg=null,uo=null;function zW(t){if(uo&&typeof uo.onCommitFiberRoot=="function")try{uo.onCommitFiberRoot(Wg,t,void 0,(t.current.flags&128)===128)}catch{}}var Ii=Math.clz32?Math.clz32:WW,BW=Math.log,VW=Math.LN2;function WW(t){return t>>>=0,t===0?32:31-(BW(t)/VW|0)|0}var lp=64,cp=4194304;function qd(t){switch(t&-t){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return t&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return t}}function Km(t,e){var r=t.pendingLanes;if(r===0)return 0;var n=0,s=t.suspendedLanes,i=t.pingedLanes,o=r&268435455;if(o!==0){var a=o&~s;a!==0?n=qd(a):(i&=o,i!==0&&(n=qd(i)))}else o=r&~s,o!==0?n=qd(o):i!==0&&(n=qd(i));if(n===0)return 0;if(e!==0&&e!==n&&!(e&s)&&(s=n&-n,i=e&-e,s>=i||s===16&&(i&4194240)!==0))return e;if(n&4&&(n|=r&16),e=t.entangledLanes,e!==0)for(t=t.entanglements,e&=n;0<e;)r=31-Ii(e),s=1<<r,n|=t[r],e&=~s;return n}function UW(t,e){switch(t){case 1:case 2:case 4:return e+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function GW(t,e){for(var r=t.suspendedLanes,n=t.pingedLanes,s=t.expirationTimes,i=t.pendingLanes;0<i;){var o=31-Ii(i),a=1<<o,l=s[o];l===-1?(!(a&r)||a&n)&&(s[o]=UW(a,e)):l<=e&&(t.expiredLanes|=a),i&=~a}}function uw(t){return t=t.pendingLanes&-1073741825,t!==0?t:t&1073741824?1073741824:0}function II(){var t=lp;return lp<<=1,!(lp&4194240)&&(lp=64),t}function Z0(t){for(var e=[],r=0;31>r;r++)e.push(t);return e}function Jh(t,e,r){t.pendingLanes|=e,e!==536870912&&(t.suspendedLanes=0,t.pingedLanes=0),t=t.eventTimes,e=31-Ii(e),t[e]=r}function HW(t,e){var r=t.pendingLanes&~e;t.pendingLanes=e,t.suspendedLanes=0,t.pingedLanes=0,t.expiredLanes&=e,t.mutableReadLanes&=e,t.entangledLanes&=e,e=t.entanglements;var n=t.eventTimes;for(t=t.expirationTimes;0<r;){var s=31-Ii(r),i=1<<s;e[s]=0,n[s]=-1,t[s]=-1,r&=~i}}function l1(t,e){var r=t.entangledLanes|=e;for(t=t.entanglements;r;){var n=31-Ii(r),s=1<<n;s&e|t[n]&e&&(t[n]|=e),r&=~s}}var yr=0;function FI(t){return t&=-t,1<t?4<t?t&268435455?16:536870912:4:1}var LI,c1,RI,jI,NI,dw=!1,up=[],Ea=null,Pa=null,ka=null,xh=new Map,bh=new Map,_a=[],KW="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function SP(t,e){switch(t){case"focusin":case"focusout":Ea=null;break;case"dragenter":case"dragleave":Pa=null;break;case"mouseover":case"mouseout":ka=null;break;case"pointerover":case"pointerout":xh.delete(e.pointerId);break;case"gotpointercapture":case"lostpointercapture":bh.delete(e.pointerId)}}function Ed(t,e,r,n,s,i){return t===null||t.nativeEvent!==i?(t={blockedOn:e,domEventName:r,eventSystemFlags:n,nativeEvent:i,targetContainers:[s]},e!==null&&(e=ef(e),e!==null&&c1(e)),t):(t.eventSystemFlags|=n,e=t.targetContainers,s!==null&&e.indexOf(s)===-1&&e.push(s),t)}function XW(t,e,r,n,s){switch(e){case"focusin":return Ea=Ed(Ea,t,e,r,n,s),!0;case"dragenter":return Pa=Ed(Pa,t,e,r,n,s),!0;case"mouseover":return ka=Ed(ka,t,e,r,n,s),!0;case"pointerover":var i=s.pointerId;return xh.set(i,Ed(xh.get(i)||null,t,e,r,n,s)),!0;case"gotpointercapture":return i=s.pointerId,bh.set(i,Ed(bh.get(i)||null,t,e,r,n,s)),!0}return!1}function zI(t){var e=Al(t.target);if(e!==null){var r=nc(e);if(r!==null){if(e=r.tag,e===13){if(e=PI(r),e!==null){t.blockedOn=e,NI(t.priority,function(){RI(r)});return}}else if(e===3&&r.stateNode.current.memoizedState.isDehydrated){t.blockedOn=r.tag===3?r.stateNode.containerInfo:null;return}}}t.blockedOn=null}function vm(t){if(t.blockedOn!==null)return!1;for(var e=t.targetContainers;0<e.length;){var r=hw(t.domEventName,t.eventSystemFlags,e[0],t.nativeEvent);if(r===null){r=t.nativeEvent;var n=new r.constructor(r.type,r);ow=n,r.target.dispatchEvent(n),ow=null}else return e=ef(r),e!==null&&c1(e),t.blockedOn=r,!1;e.shift()}return!0}function EP(t,e,r){vm(t)&&r.delete(e)}function qW(){dw=!1,Ea!==null&&vm(Ea)&&(Ea=null),Pa!==null&&vm(Pa)&&(Pa=null),ka!==null&&vm(ka)&&(ka=null),xh.forEach(EP),bh.forEach(EP)}function Pd(t,e){t.blockedOn===e&&(t.blockedOn=null,dw||(dw=!0,Ls.unstable_scheduleCallback(Ls.unstable_NormalPriority,qW)))}function Mh(t){function e(s){return Pd(s,t)}if(0<up.length){Pd(up[0],t);for(var r=1;r<up.length;r++){var n=up[r];n.blockedOn===t&&(n.blockedOn=null)}}for(Ea!==null&&Pd(Ea,t),Pa!==null&&Pd(Pa,t),ka!==null&&Pd(ka,t),xh.forEach(e),bh.forEach(e),r=0;r<_a.length;r++)n=_a[r],n.blockedOn===t&&(n.blockedOn=null);for(;0<_a.length&&(r=_a[0],r.blockedOn===null);)zI(r),r.blockedOn===null&&_a.shift()}var Jc=Go.ReactCurrentBatchConfig,Xm=!0;function YW(t,e,r,n){var s=yr,i=Jc.transition;Jc.transition=null;try{yr=1,u1(t,e,r,n)}finally{yr=s,Jc.transition=i}}function QW(t,e,r,n){var s=yr,i=Jc.transition;Jc.transition=null;try{yr=4,u1(t,e,r,n)}finally{yr=s,Jc.transition=i}}function u1(t,e,r,n){if(Xm){var s=hw(t,e,r,n);if(s===null)cy(t,e,n,qm,r),SP(t,n);else if(XW(s,t,e,r,n))n.stopPropagation();else if(SP(t,n),e&4&&-1<KW.indexOf(t)){for(;s!==null;){var i=ef(s);if(i!==null&&LI(i),i=hw(t,e,r,n),i===null&&cy(t,e,n,qm,r),i===s)break;s=i}s!==null&&n.stopPropagation()}else cy(t,e,n,null,r)}}var qm=null;function hw(t,e,r,n){if(qm=null,t=o1(n),t=Al(t),t!==null)if(e=nc(t),e===null)t=null;else if(r=e.tag,r===13){if(t=PI(e),t!==null)return t;t=null}else if(r===3){if(e.stateNode.current.memoizedState.isDehydrated)return e.tag===3?e.stateNode.containerInfo:null;t=null}else e!==t&&(t=null);return qm=t,null}function BI(t){switch(t){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(jW()){case a1:return 1;case OI:return 4;case Hm:case NW:return 16;case DI:return 536870912;default:return 16}default:return 16}}var Ta=null,d1=null,wm=null;function VI(){if(wm)return wm;var t,e=d1,r=e.length,n,s="value"in Ta?Ta.value:Ta.textContent,i=s.length;for(t=0;t<r&&e[t]===s[t];t++);var o=r-t;for(n=1;n<=o&&e[r-n]===s[i-n];n++);return wm=s.slice(t,1<n?1-n:void 0)}function xm(t){var e=t.keyCode;return"charCode"in t?(t=t.charCode,t===0&&e===13&&(t=13)):t=e,t===10&&(t=13),32<=t||t===13?t:0}function dp(){return!0}function PP(){return!1}function Ns(t){function e(r,n,s,i,o){this._reactName=r,this._targetInst=s,this.type=n,this.nativeEvent=i,this.target=o,this.currentTarget=null;for(var a in t)t.hasOwnProperty(a)&&(r=t[a],this[a]=r?r(i):i[a]);return this.isDefaultPrevented=(i.defaultPrevented!=null?i.defaultPrevented:i.returnValue===!1)?dp:PP,this.isPropagationStopped=PP,this}return Vr(e.prototype,{preventDefault:function(){this.defaultPrevented=!0;var r=this.nativeEvent;r&&(r.preventDefault?r.preventDefault():typeof r.returnValue!="unknown"&&(r.returnValue=!1),this.isDefaultPrevented=dp)},stopPropagation:function(){var r=this.nativeEvent;r&&(r.stopPropagation?r.stopPropagation():typeof r.cancelBubble!="unknown"&&(r.cancelBubble=!0),this.isPropagationStopped=dp)},persist:function(){},isPersistent:dp}),e}var Ou={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(t){return t.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},h1=Ns(Ou),Zh=Vr({},Ou,{view:0,detail:0}),JW=Ns(Zh),ey,ty,kd,Ug=Vr({},Zh,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:f1,button:0,buttons:0,relatedTarget:function(t){return t.relatedTarget===void 0?t.fromElement===t.srcElement?t.toElement:t.fromElement:t.relatedTarget},movementX:function(t){return"movementX"in t?t.movementX:(t!==kd&&(kd&&t.type==="mousemove"?(ey=t.screenX-kd.screenX,ty=t.screenY-kd.screenY):ty=ey=0,kd=t),ey)},movementY:function(t){return"movementY"in t?t.movementY:ty}}),kP=Ns(Ug),ZW=Vr({},Ug,{dataTransfer:0}),eU=Ns(ZW),tU=Vr({},Zh,{relatedTarget:0}),ry=Ns(tU),rU=Vr({},Ou,{animationName:0,elapsedTime:0,pseudoElement:0}),nU=Ns(rU),sU=Vr({},Ou,{clipboardData:function(t){return"clipboardData"in t?t.clipboardData:window.clipboardData}}),iU=Ns(sU),oU=Vr({},Ou,{data:0}),AP=Ns(oU),aU={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},lU={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},cU={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function uU(t){var e=this.nativeEvent;return e.getModifierState?e.getModifierState(t):(t=cU[t])?!!e[t]:!1}function f1(){return uU}var dU=Vr({},Zh,{key:function(t){if(t.key){var e=aU[t.key]||t.key;if(e!=="Unidentified")return e}return t.type==="keypress"?(t=xm(t),t===13?"Enter":String.fromCharCode(t)):t.type==="keydown"||t.type==="keyup"?lU[t.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:f1,charCode:function(t){return t.type==="keypress"?xm(t):0},keyCode:function(t){return t.type==="keydown"||t.type==="keyup"?t.keyCode:0},which:function(t){return t.type==="keypress"?xm(t):t.type==="keydown"||t.type==="keyup"?t.keyCode:0}}),hU=Ns(dU),fU=Vr({},Ug,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),$P=Ns(fU),pU=Vr({},Zh,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:f1}),mU=Ns(pU),gU=Vr({},Ou,{propertyName:0,elapsedTime:0,pseudoElement:0}),_U=Ns(gU),yU=Vr({},Ug,{deltaX:function(t){return"deltaX"in t?t.deltaX:"wheelDeltaX"in t?-t.wheelDeltaX:0},deltaY:function(t){return"deltaY"in t?t.deltaY:"wheelDeltaY"in t?-t.wheelDeltaY:"wheelDelta"in t?-t.wheelDelta:0},deltaZ:0,deltaMode:0}),vU=Ns(yU),wU=[9,13,27,32],p1=Fo&&"CompositionEvent"in window,ih=null;Fo&&"documentMode"in document&&(ih=document.documentMode);var xU=Fo&&"TextEvent"in window&&!ih,WI=Fo&&(!p1||ih&&8<ih&&11>=ih),OP=" ",DP=!1;function UI(t,e){switch(t){case"keyup":return wU.indexOf(e.keyCode)!==-1;case"keydown":return e.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function GI(t){return t=t.detail,typeof t=="object"&&"data"in t?t.data:null}var Ic=!1;function bU(t,e){switch(t){case"compositionend":return GI(e);case"keypress":return e.which!==32?null:(DP=!0,OP);case"textInput":return t=e.data,t===OP&&DP?null:t;default:return null}}function MU(t,e){if(Ic)return t==="compositionend"||!p1&&UI(t,e)?(t=VI(),wm=d1=Ta=null,Ic=!1,t):null;switch(t){case"paste":return null;case"keypress":if(!(e.ctrlKey||e.altKey||e.metaKey)||e.ctrlKey&&e.altKey){if(e.char&&1<e.char.length)return e.char;if(e.which)return String.fromCharCode(e.which)}return null;case"compositionend":return WI&&e.locale!=="ko"?null:e.data;default:return null}}var TU={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function IP(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e==="input"?!!TU[t.type]:e==="textarea"}function HI(t,e,r,n){MI(n),e=Ym(e,"onChange"),0<e.length&&(r=new h1("onChange","change",null,r,n),t.push({event:r,listeners:e}))}var oh=null,Th=null;function CU(t){nF(t,0)}function Gg(t){var e=Rc(t);if(gI(e))return t}function SU(t,e){if(t==="change")return e}var KI=!1;if(Fo){var ny;if(Fo){var sy="oninput"in document;if(!sy){var FP=document.createElement("div");FP.setAttribute("oninput","return;"),sy=typeof FP.oninput=="function"}ny=sy}else ny=!1;KI=ny&&(!document.documentMode||9<document.documentMode)}function LP(){oh&&(oh.detachEvent("onpropertychange",XI),Th=oh=null)}function XI(t){if(t.propertyName==="value"&&Gg(Th)){var e=[];HI(e,Th,t,o1(t)),EI(CU,e)}}function EU(t,e,r){t==="focusin"?(LP(),oh=e,Th=r,oh.attachEvent("onpropertychange",XI)):t==="focusout"&&LP()}function PU(t){if(t==="selectionchange"||t==="keyup"||t==="keydown")return Gg(Th)}function kU(t,e){if(t==="click")return Gg(e)}function AU(t,e){if(t==="input"||t==="change")return Gg(e)}function $U(t,e){return t===e&&(t!==0||1/t===1/e)||t!==t&&e!==e}var ji=typeof Object.is=="function"?Object.is:$U;function Ch(t,e){if(ji(t,e))return!0;if(typeof t!="object"||t===null||typeof e!="object"||e===null)return!1;var r=Object.keys(t),n=Object.keys(e);if(r.length!==n.length)return!1;for(n=0;n<r.length;n++){var s=r[n];if(!Xv.call(e,s)||!ji(t[s],e[s]))return!1}return!0}function RP(t){for(;t&&t.firstChild;)t=t.firstChild;return t}function jP(t,e){var r=RP(t);t=0;for(var n;r;){if(r.nodeType===3){if(n=t+r.textContent.length,t<=e&&n>=e)return{node:r,offset:e-t};t=n}e:{for(;r;){if(r.nextSibling){r=r.nextSibling;break e}r=r.parentNode}r=void 0}r=RP(r)}}function qI(t,e){return t&&e?t===e?!0:t&&t.nodeType===3?!1:e&&e.nodeType===3?qI(t,e.parentNode):"contains"in t?t.contains(e):t.compareDocumentPosition?!!(t.compareDocumentPosition(e)&16):!1:!1}function YI(){for(var t=window,e=Wm();e instanceof t.HTMLIFrameElement;){try{var r=typeof e.contentWindow.location.href=="string"}catch{r=!1}if(r)t=e.contentWindow;else break;e=Wm(t.document)}return e}function m1(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e&&(e==="input"&&(t.type==="text"||t.type==="search"||t.type==="tel"||t.type==="url"||t.type==="password")||e==="textarea"||t.contentEditable==="true")}function OU(t){var e=YI(),r=t.focusedElem,n=t.selectionRange;if(e!==r&&r&&r.ownerDocument&&qI(r.ownerDocument.documentElement,r)){if(n!==null&&m1(r)){if(e=n.start,t=n.end,t===void 0&&(t=e),"selectionStart"in r)r.selectionStart=e,r.selectionEnd=Math.min(t,r.value.length);else if(t=(e=r.ownerDocument||document)&&e.defaultView||window,t.getSelection){t=t.getSelection();var s=r.textContent.length,i=Math.min(n.start,s);n=n.end===void 0?i:Math.min(n.end,s),!t.extend&&i>n&&(s=n,n=i,i=s),s=jP(r,i);var o=jP(r,n);s&&o&&(t.rangeCount!==1||t.anchorNode!==s.node||t.anchorOffset!==s.offset||t.focusNode!==o.node||t.focusOffset!==o.offset)&&(e=e.createRange(),e.setStart(s.node,s.offset),t.removeAllRanges(),i>n?(t.addRange(e),t.extend(o.node,o.offset)):(e.setEnd(o.node,o.offset),t.addRange(e)))}}for(e=[],t=r;t=t.parentNode;)t.nodeType===1&&e.push({element:t,left:t.scrollLeft,top:t.scrollTop});for(typeof r.focus=="function"&&r.focus(),r=0;r<e.length;r++)t=e[r],t.element.scrollLeft=t.left,t.element.scrollTop=t.top}}var DU=Fo&&"documentMode"in document&&11>=document.documentMode,Fc=null,fw=null,ah=null,pw=!1;function NP(t,e,r){var n=r.window===r?r.document:r.nodeType===9?r:r.ownerDocument;pw||Fc==null||Fc!==Wm(n)||(n=Fc,"selectionStart"in n&&m1(n)?n={start:n.selectionStart,end:n.selectionEnd}:(n=(n.ownerDocument&&n.ownerDocument.defaultView||window).getSelection(),n={anchorNode:n.anchorNode,anchorOffset:n.anchorOffset,focusNode:n.focusNode,focusOffset:n.focusOffset}),ah&&Ch(ah,n)||(ah=n,n=Ym(fw,"onSelect"),0<n.length&&(e=new h1("onSelect","select",null,e,r),t.push({event:e,listeners:n}),e.target=Fc)))}function hp(t,e){var r={};return r[t.toLowerCase()]=e.toLowerCase(),r["Webkit"+t]="webkit"+e,r["Moz"+t]="moz"+e,r}var Lc={animationend:hp("Animation","AnimationEnd"),animationiteration:hp("Animation","AnimationIteration"),animationstart:hp("Animation","AnimationStart"),transitionend:hp("Transition","TransitionEnd")},iy={},QI={};Fo&&(QI=document.createElement("div").style,"AnimationEvent"in window||(delete Lc.animationend.animation,delete Lc.animationiteration.animation,delete Lc.animationstart.animation),"TransitionEvent"in window||delete Lc.transitionend.transition);function Hg(t){if(iy[t])return iy[t];if(!Lc[t])return t;var e=Lc[t],r;for(r in e)if(e.hasOwnProperty(r)&&r in QI)return iy[t]=e[r];return t}var JI=Hg("animationend"),ZI=Hg("animationiteration"),eF=Hg("animationstart"),tF=Hg("transitionend"),rF=new Map,zP="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Ua(t,e){rF.set(t,e),rc(e,[t])}for(var oy=0;oy<zP.length;oy++){var ay=zP[oy],IU=ay.toLowerCase(),FU=ay[0].toUpperCase()+ay.slice(1);Ua(IU,"on"+FU)}Ua(JI,"onAnimationEnd");Ua(ZI,"onAnimationIteration");Ua(eF,"onAnimationStart");Ua("dblclick","onDoubleClick");Ua("focusin","onFocus");Ua("focusout","onBlur");Ua(tF,"onTransitionEnd");vu("onMouseEnter",["mouseout","mouseover"]);vu("onMouseLeave",["mouseout","mouseover"]);vu("onPointerEnter",["pointerout","pointerover"]);vu("onPointerLeave",["pointerout","pointerover"]);rc("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));rc("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));rc("onBeforeInput",["compositionend","keypress","textInput","paste"]);rc("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));rc("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));rc("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Yd="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),LU=new Set("cancel close invalid load scroll toggle".split(" ").concat(Yd));function BP(t,e,r){var n=t.type||"unknown-event";t.currentTarget=r,IW(n,e,void 0,t),t.currentTarget=null}function nF(t,e){e=(e&4)!==0;for(var r=0;r<t.length;r++){var n=t[r],s=n.event;n=n.listeners;e:{var i=void 0;if(e)for(var o=n.length-1;0<=o;o--){var a=n[o],l=a.instance,c=a.currentTarget;if(a=a.listener,l!==i&&s.isPropagationStopped())break e;BP(s,a,c),i=l}else for(o=0;o<n.length;o++){if(a=n[o],l=a.instance,c=a.currentTarget,a=a.listener,l!==i&&s.isPropagationStopped())break e;BP(s,a,c),i=l}}}if(Gm)throw t=cw,Gm=!1,cw=null,t}function Ar(t,e){var r=e[vw];r===void 0&&(r=e[vw]=new Set);var n=t+"__bubble";r.has(n)||(sF(e,t,2,!1),r.add(n))}function ly(t,e,r){var n=0;e&&(n|=4),sF(r,t,n,e)}var fp="_reactListening"+Math.random().toString(36).slice(2);function Sh(t){if(!t[fp]){t[fp]=!0,dI.forEach(function(r){r!=="selectionchange"&&(LU.has(r)||ly(r,!1,t),ly(r,!0,t))});var e=t.nodeType===9?t:t.ownerDocument;e===null||e[fp]||(e[fp]=!0,ly("selectionchange",!1,e))}}function sF(t,e,r,n){switch(BI(e)){case 1:var s=YW;break;case 4:s=QW;break;default:s=u1}r=s.bind(null,e,r,t),s=void 0,!lw||e!=="touchstart"&&e!=="touchmove"&&e!=="wheel"||(s=!0),n?s!==void 0?t.addEventListener(e,r,{capture:!0,passive:s}):t.addEventListener(e,r,!0):s!==void 0?t.addEventListener(e,r,{passive:s}):t.addEventListener(e,r,!1)}function cy(t,e,r,n,s){var i=n;if(!(e&1)&&!(e&2)&&n!==null)e:for(;;){if(n===null)return;var o=n.tag;if(o===3||o===4){var a=n.stateNode.containerInfo;if(a===s||a.nodeType===8&&a.parentNode===s)break;if(o===4)for(o=n.return;o!==null;){var l=o.tag;if((l===3||l===4)&&(l=o.stateNode.containerInfo,l===s||l.nodeType===8&&l.parentNode===s))return;o=o.return}for(;a!==null;){if(o=Al(a),o===null)return;if(l=o.tag,l===5||l===6){n=i=o;continue e}a=a.parentNode}}n=n.return}EI(function(){var c=i,u=o1(r),d=[];e:{var h=rF.get(t);if(h!==void 0){var f=h1,p=t;switch(t){case"keypress":if(xm(r)===0)break e;case"keydown":case"keyup":f=hU;break;case"focusin":p="focus",f=ry;break;case"focusout":p="blur",f=ry;break;case"beforeblur":case"afterblur":f=ry;break;case"click":if(r.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":f=kP;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":f=eU;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":f=mU;break;case JI:case ZI:case eF:f=nU;break;case tF:f=_U;break;case"scroll":f=JW;break;case"wheel":f=vU;break;case"copy":case"cut":case"paste":f=iU;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":f=$P}var m=(e&4)!==0,y=!m&&t==="scroll",g=m?h!==null?h+"Capture":null:h;m=[];for(var _=c,v;_!==null;){v=_;var w=v.stateNode;if(v.tag===5&&w!==null&&(v=w,g!==null&&(w=wh(_,g),w!=null&&m.push(Eh(_,w,v)))),y)break;_=_.return}0<m.length&&(h=new f(h,p,null,r,u),d.push({event:h,listeners:m}))}}if(!(e&7)){e:{if(h=t==="mouseover"||t==="pointerover",f=t==="mouseout"||t==="pointerout",h&&r!==ow&&(p=r.relatedTarget||r.fromElement)&&(Al(p)||p[Lo]))break e;if((f||h)&&(h=u.window===u?u:(h=u.ownerDocument)?h.defaultView||h.parentWindow:window,f?(p=r.relatedTarget||r.toElement,f=c,p=p?Al(p):null,p!==null&&(y=nc(p),p!==y||p.tag!==5&&p.tag!==6)&&(p=null)):(f=null,p=c),f!==p)){if(m=kP,w="onMouseLeave",g="onMouseEnter",_="mouse",(t==="pointerout"||t==="pointerover")&&(m=$P,w="onPointerLeave",g="onPointerEnter",_="pointer"),y=f==null?h:Rc(f),v=p==null?h:Rc(p),h=new m(w,_+"leave",f,r,u),h.target=y,h.relatedTarget=v,w=null,Al(u)===c&&(m=new m(g,_+"enter",p,r,u),m.target=v,m.relatedTarget=y,w=m),y=w,f&&p)t:{for(m=f,g=p,_=0,v=m;v;v=bc(v))_++;for(v=0,w=g;w;w=bc(w))v++;for(;0<_-v;)m=bc(m),_--;for(;0<v-_;)g=bc(g),v--;for(;_--;){if(m===g||g!==null&&m===g.alternate)break t;m=bc(m),g=bc(g)}m=null}else m=null;f!==null&&VP(d,h,f,m,!1),p!==null&&y!==null&&VP(d,y,p,m,!0)}}e:{if(h=c?Rc(c):window,f=h.nodeName&&h.nodeName.toLowerCase(),f==="select"||f==="input"&&h.type==="file")var x=SU;else if(IP(h))if(KI)x=AU;else{x=PU;var M=EU}else(f=h.nodeName)&&f.toLowerCase()==="input"&&(h.type==="checkbox"||h.type==="radio")&&(x=kU);if(x&&(x=x(t,c))){HI(d,x,r,u);break e}M&&M(t,h,c),t==="focusout"&&(M=h._wrapperState)&&M.controlled&&h.type==="number"&&tw(h,"number",h.value)}switch(M=c?Rc(c):window,t){case"focusin":(IP(M)||M.contentEditable==="true")&&(Fc=M,fw=c,ah=null);break;case"focusout":ah=fw=Fc=null;break;case"mousedown":pw=!0;break;case"contextmenu":case"mouseup":case"dragend":pw=!1,NP(d,r,u);break;case"selectionchange":if(DU)break;case"keydown":case"keyup":NP(d,r,u)}var T;if(p1)e:{switch(t){case"compositionstart":var S="onCompositionStart";break e;case"compositionend":S="onCompositionEnd";break e;case"compositionupdate":S="onCompositionUpdate";break e}S=void 0}else Ic?UI(t,r)&&(S="onCompositionEnd"):t==="keydown"&&r.keyCode===229&&(S="onCompositionStart");S&&(WI&&r.locale!=="ko"&&(Ic||S!=="onCompositionStart"?S==="onCompositionEnd"&&Ic&&(T=VI()):(Ta=u,d1="value"in Ta?Ta.value:Ta.textContent,Ic=!0)),M=Ym(c,S),0<M.length&&(S=new AP(S,t,null,r,u),d.push({event:S,listeners:M}),T?S.data=T:(T=GI(r),T!==null&&(S.data=T)))),(T=xU?bU(t,r):MU(t,r))&&(c=Ym(c,"onBeforeInput"),0<c.length&&(u=new AP("onBeforeInput","beforeinput",null,r,u),d.push({event:u,listeners:c}),u.data=T))}nF(d,e)})}function Eh(t,e,r){return{instance:t,listener:e,currentTarget:r}}function Ym(t,e){for(var r=e+"Capture",n=[];t!==null;){var s=t,i=s.stateNode;s.tag===5&&i!==null&&(s=i,i=wh(t,r),i!=null&&n.unshift(Eh(t,i,s)),i=wh(t,e),i!=null&&n.push(Eh(t,i,s))),t=t.return}return n}function bc(t){if(t===null)return null;do t=t.return;while(t&&t.tag!==5);return t||null}function VP(t,e,r,n,s){for(var i=e._reactName,o=[];r!==null&&r!==n;){var a=r,l=a.alternate,c=a.stateNode;if(l!==null&&l===n)break;a.tag===5&&c!==null&&(a=c,s?(l=wh(r,i),l!=null&&o.unshift(Eh(r,l,a))):s||(l=wh(r,i),l!=null&&o.push(Eh(r,l,a)))),r=r.return}o.length!==0&&t.push({event:e,listeners:o})}var RU=/\r\n?/g,jU=/\u0000|\uFFFD/g;function WP(t){return(typeof t=="string"?t:""+t).replace(RU,`
`).replace(jU,"")}function pp(t,e,r){if(e=WP(e),WP(t)!==e&&r)throw Error(Ye(425))}function Qm(){}var mw=null,gw=null;function _w(t,e){return t==="textarea"||t==="noscript"||typeof e.children=="string"||typeof e.children=="number"||typeof e.dangerouslySetInnerHTML=="object"&&e.dangerouslySetInnerHTML!==null&&e.dangerouslySetInnerHTML.__html!=null}var yw=typeof setTimeout=="function"?setTimeout:void 0,NU=typeof clearTimeout=="function"?clearTimeout:void 0,UP=typeof Promise=="function"?Promise:void 0,zU=typeof queueMicrotask=="function"?queueMicrotask:typeof UP<"u"?function(t){return UP.resolve(null).then(t).catch(BU)}:yw;function BU(t){setTimeout(function(){throw t})}function uy(t,e){var r=e,n=0;do{var s=r.nextSibling;if(t.removeChild(r),s&&s.nodeType===8)if(r=s.data,r==="/$"){if(n===0){t.removeChild(s),Mh(e);return}n--}else r!=="$"&&r!=="$?"&&r!=="$!"||n++;r=s}while(r);Mh(e)}function Aa(t){for(;t!=null;t=t.nextSibling){var e=t.nodeType;if(e===1||e===3)break;if(e===8){if(e=t.data,e==="$"||e==="$!"||e==="$?")break;if(e==="/$")return null}}return t}function GP(t){t=t.previousSibling;for(var e=0;t;){if(t.nodeType===8){var r=t.data;if(r==="$"||r==="$!"||r==="$?"){if(e===0)return t;e--}else r==="/$"&&e++}t=t.previousSibling}return null}var Du=Math.random().toString(36).slice(2),io="__reactFiber$"+Du,Ph="__reactProps$"+Du,Lo="__reactContainer$"+Du,vw="__reactEvents$"+Du,VU="__reactListeners$"+Du,WU="__reactHandles$"+Du;function Al(t){var e=t[io];if(e)return e;for(var r=t.parentNode;r;){if(e=r[Lo]||r[io]){if(r=e.alternate,e.child!==null||r!==null&&r.child!==null)for(t=GP(t);t!==null;){if(r=t[io])return r;t=GP(t)}return e}t=r,r=t.parentNode}return null}function ef(t){return t=t[io]||t[Lo],!t||t.tag!==5&&t.tag!==6&&t.tag!==13&&t.tag!==3?null:t}function Rc(t){if(t.tag===5||t.tag===6)return t.stateNode;throw Error(Ye(33))}function Kg(t){return t[Ph]||null}var ww=[],jc=-1;function Ga(t){return{current:t}}function $r(t){0>jc||(t.current=ww[jc],ww[jc]=null,jc--)}function Pr(t,e){jc++,ww[jc]=t.current,t.current=e}var La={},Hn=Ga(La),hs=Ga(!1),Ul=La;function wu(t,e){var r=t.type.contextTypes;if(!r)return La;var n=t.stateNode;if(n&&n.__reactInternalMemoizedUnmaskedChildContext===e)return n.__reactInternalMemoizedMaskedChildContext;var s={},i;for(i in r)s[i]=e[i];return n&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=e,t.__reactInternalMemoizedMaskedChildContext=s),s}function fs(t){return t=t.childContextTypes,t!=null}function Jm(){$r(hs),$r(Hn)}function HP(t,e,r){if(Hn.current!==La)throw Error(Ye(168));Pr(Hn,e),Pr(hs,r)}function iF(t,e,r){var n=t.stateNode;if(e=e.childContextTypes,typeof n.getChildContext!="function")return r;n=n.getChildContext();for(var s in n)if(!(s in e))throw Error(Ye(108,EW(t)||"Unknown",s));return Vr({},r,n)}function Zm(t){return t=(t=t.stateNode)&&t.__reactInternalMemoizedMergedChildContext||La,Ul=Hn.current,Pr(Hn,t),Pr(hs,hs.current),!0}function KP(t,e,r){var n=t.stateNode;if(!n)throw Error(Ye(169));r?(t=iF(t,e,Ul),n.__reactInternalMemoizedMergedChildContext=t,$r(hs),$r(Hn),Pr(Hn,t)):$r(hs),Pr(hs,r)}var To=null,Xg=!1,dy=!1;function oF(t){To===null?To=[t]:To.push(t)}function UU(t){Xg=!0,oF(t)}function Ha(){if(!dy&&To!==null){dy=!0;var t=0,e=yr;try{var r=To;for(yr=1;t<r.length;t++){var n=r[t];do n=n(!0);while(n!==null)}To=null,Xg=!1}catch(s){throw To!==null&&(To=To.slice(t+1)),$I(a1,Ha),s}finally{yr=e,dy=!1}}return null}var Nc=[],zc=0,eg=null,tg=0,Qs=[],Js=0,Gl=null,Po=1,ko="";function bl(t,e){Nc[zc++]=tg,Nc[zc++]=eg,eg=t,tg=e}function aF(t,e,r){Qs[Js++]=Po,Qs[Js++]=ko,Qs[Js++]=Gl,Gl=t;var n=Po;t=ko;var s=32-Ii(n)-1;n&=~(1<<s),r+=1;var i=32-Ii(e)+s;if(30<i){var o=s-s%5;i=(n&(1<<o)-1).toString(32),n>>=o,s-=o,Po=1<<32-Ii(e)+s|r<<s|n,ko=i+t}else Po=1<<i|r<<s|n,ko=t}function g1(t){t.return!==null&&(bl(t,1),aF(t,1,0))}function _1(t){for(;t===eg;)eg=Nc[--zc],Nc[zc]=null,tg=Nc[--zc],Nc[zc]=null;for(;t===Gl;)Gl=Qs[--Js],Qs[Js]=null,ko=Qs[--Js],Qs[Js]=null,Po=Qs[--Js],Qs[Js]=null}var Ds=null,Os=null,Dr=!1,Pi=null;function lF(t,e){var r=ti(5,null,null,0);r.elementType="DELETED",r.stateNode=e,r.return=t,e=t.deletions,e===null?(t.deletions=[r],t.flags|=16):e.push(r)}function XP(t,e){switch(t.tag){case 5:var r=t.type;return e=e.nodeType!==1||r.toLowerCase()!==e.nodeName.toLowerCase()?null:e,e!==null?(t.stateNode=e,Ds=t,Os=Aa(e.firstChild),!0):!1;case 6:return e=t.pendingProps===""||e.nodeType!==3?null:e,e!==null?(t.stateNode=e,Ds=t,Os=null,!0):!1;case 13:return e=e.nodeType!==8?null:e,e!==null?(r=Gl!==null?{id:Po,overflow:ko}:null,t.memoizedState={dehydrated:e,treeContext:r,retryLane:1073741824},r=ti(18,null,null,0),r.stateNode=e,r.return=t,t.child=r,Ds=t,Os=null,!0):!1;default:return!1}}function xw(t){return(t.mode&1)!==0&&(t.flags&128)===0}function bw(t){if(Dr){var e=Os;if(e){var r=e;if(!XP(t,e)){if(xw(t))throw Error(Ye(418));e=Aa(r.nextSibling);var n=Ds;e&&XP(t,e)?lF(n,r):(t.flags=t.flags&-4097|2,Dr=!1,Ds=t)}}else{if(xw(t))throw Error(Ye(418));t.flags=t.flags&-4097|2,Dr=!1,Ds=t}}}function qP(t){for(t=t.return;t!==null&&t.tag!==5&&t.tag!==3&&t.tag!==13;)t=t.return;Ds=t}function mp(t){if(t!==Ds)return!1;if(!Dr)return qP(t),Dr=!0,!1;var e;if((e=t.tag!==3)&&!(e=t.tag!==5)&&(e=t.type,e=e!=="head"&&e!=="body"&&!_w(t.type,t.memoizedProps)),e&&(e=Os)){if(xw(t))throw cF(),Error(Ye(418));for(;e;)lF(t,e),e=Aa(e.nextSibling)}if(qP(t),t.tag===13){if(t=t.memoizedState,t=t!==null?t.dehydrated:null,!t)throw Error(Ye(317));e:{for(t=t.nextSibling,e=0;t;){if(t.nodeType===8){var r=t.data;if(r==="/$"){if(e===0){Os=Aa(t.nextSibling);break e}e--}else r!=="$"&&r!=="$!"&&r!=="$?"||e++}t=t.nextSibling}Os=null}}else Os=Ds?Aa(t.stateNode.nextSibling):null;return!0}function cF(){for(var t=Os;t;)t=Aa(t.nextSibling)}function xu(){Os=Ds=null,Dr=!1}function y1(t){Pi===null?Pi=[t]:Pi.push(t)}var GU=Go.ReactCurrentBatchConfig;function Ad(t,e,r){if(t=r.ref,t!==null&&typeof t!="function"&&typeof t!="object"){if(r._owner){if(r=r._owner,r){if(r.tag!==1)throw Error(Ye(309));var n=r.stateNode}if(!n)throw Error(Ye(147,t));var s=n,i=""+t;return e!==null&&e.ref!==null&&typeof e.ref=="function"&&e.ref._stringRef===i?e.ref:(e=function(o){var a=s.refs;o===null?delete a[i]:a[i]=o},e._stringRef=i,e)}if(typeof t!="string")throw Error(Ye(284));if(!r._owner)throw Error(Ye(290,t))}return t}function gp(t,e){throw t=Object.prototype.toString.call(e),Error(Ye(31,t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t))}function YP(t){var e=t._init;return e(t._payload)}function uF(t){function e(g,_){if(t){var v=g.deletions;v===null?(g.deletions=[_],g.flags|=16):v.push(_)}}function r(g,_){if(!t)return null;for(;_!==null;)e(g,_),_=_.sibling;return null}function n(g,_){for(g=new Map;_!==null;)_.key!==null?g.set(_.key,_):g.set(_.index,_),_=_.sibling;return g}function s(g,_){return g=Ia(g,_),g.index=0,g.sibling=null,g}function i(g,_,v){return g.index=v,t?(v=g.alternate,v!==null?(v=v.index,v<_?(g.flags|=2,_):v):(g.flags|=2,_)):(g.flags|=1048576,_)}function o(g){return t&&g.alternate===null&&(g.flags|=2),g}function a(g,_,v,w){return _===null||_.tag!==6?(_=yy(v,g.mode,w),_.return=g,_):(_=s(_,v),_.return=g,_)}function l(g,_,v,w){var x=v.type;return x===Dc?u(g,_,v.props.children,w,v.key):_!==null&&(_.elementType===x||typeof x=="object"&&x!==null&&x.$$typeof===ma&&YP(x)===_.type)?(w=s(_,v.props),w.ref=Ad(g,_,v),w.return=g,w):(w=Pm(v.type,v.key,v.props,null,g.mode,w),w.ref=Ad(g,_,v),w.return=g,w)}function c(g,_,v,w){return _===null||_.tag!==4||_.stateNode.containerInfo!==v.containerInfo||_.stateNode.implementation!==v.implementation?(_=vy(v,g.mode,w),_.return=g,_):(_=s(_,v.children||[]),_.return=g,_)}function u(g,_,v,w,x){return _===null||_.tag!==7?(_=Vl(v,g.mode,w,x),_.return=g,_):(_=s(_,v),_.return=g,_)}function d(g,_,v){if(typeof _=="string"&&_!==""||typeof _=="number")return _=yy(""+_,g.mode,v),_.return=g,_;if(typeof _=="object"&&_!==null){switch(_.$$typeof){case ip:return v=Pm(_.type,_.key,_.props,null,g.mode,v),v.ref=Ad(g,null,_),v.return=g,v;case Oc:return _=vy(_,g.mode,v),_.return=g,_;case ma:var w=_._init;return d(g,w(_._payload),v)}if(Xd(_)||Cd(_))return _=Vl(_,g.mode,v,null),_.return=g,_;gp(g,_)}return null}function h(g,_,v,w){var x=_!==null?_.key:null;if(typeof v=="string"&&v!==""||typeof v=="number")return x!==null?null:a(g,_,""+v,w);if(typeof v=="object"&&v!==null){switch(v.$$typeof){case ip:return v.key===x?l(g,_,v,w):null;case Oc:return v.key===x?c(g,_,v,w):null;case ma:return x=v._init,h(g,_,x(v._payload),w)}if(Xd(v)||Cd(v))return x!==null?null:u(g,_,v,w,null);gp(g,v)}return null}function f(g,_,v,w,x){if(typeof w=="string"&&w!==""||typeof w=="number")return g=g.get(v)||null,a(_,g,""+w,x);if(typeof w=="object"&&w!==null){switch(w.$$typeof){case ip:return g=g.get(w.key===null?v:w.key)||null,l(_,g,w,x);case Oc:return g=g.get(w.key===null?v:w.key)||null,c(_,g,w,x);case ma:var M=w._init;return f(g,_,v,M(w._payload),x)}if(Xd(w)||Cd(w))return g=g.get(v)||null,u(_,g,w,x,null);gp(_,w)}return null}function p(g,_,v,w){for(var x=null,M=null,T=_,S=_=0,k=null;T!==null&&S<v.length;S++){T.index>S?(k=T,T=null):k=T.sibling;var $=h(g,T,v[S],w);if($===null){T===null&&(T=k);break}t&&T&&$.alternate===null&&e(g,T),_=i($,_,S),M===null?x=$:M.sibling=$,M=$,T=k}if(S===v.length)return r(g,T),Dr&&bl(g,S),x;if(T===null){for(;S<v.length;S++)T=d(g,v[S],w),T!==null&&(_=i(T,_,S),M===null?x=T:M.sibling=T,M=T);return Dr&&bl(g,S),x}for(T=n(g,T);S<v.length;S++)k=f(T,g,S,v[S],w),k!==null&&(t&&k.alternate!==null&&T.delete(k.key===null?S:k.key),_=i(k,_,S),M===null?x=k:M.sibling=k,M=k);return t&&T.forEach(function(j){return e(g,j)}),Dr&&bl(g,S),x}function m(g,_,v,w){var x=Cd(v);if(typeof x!="function")throw Error(Ye(150));if(v=x.call(v),v==null)throw Error(Ye(151));for(var M=x=null,T=_,S=_=0,k=null,$=v.next();T!==null&&!$.done;S++,$=v.next()){T.index>S?(k=T,T=null):k=T.sibling;var j=h(g,T,$.value,w);if(j===null){T===null&&(T=k);break}t&&T&&j.alternate===null&&e(g,T),_=i(j,_,S),M===null?x=j:M.sibling=j,M=j,T=k}if($.done)return r(g,T),Dr&&bl(g,S),x;if(T===null){for(;!$.done;S++,$=v.next())$=d(g,$.value,w),$!==null&&(_=i($,_,S),M===null?x=$:M.sibling=$,M=$);return Dr&&bl(g,S),x}for(T=n(g,T);!$.done;S++,$=v.next())$=f(T,g,S,$.value,w),$!==null&&(t&&$.alternate!==null&&T.delete($.key===null?S:$.key),_=i($,_,S),M===null?x=$:M.sibling=$,M=$);return t&&T.forEach(function(V){return e(g,V)}),Dr&&bl(g,S),x}function y(g,_,v,w){if(typeof v=="object"&&v!==null&&v.type===Dc&&v.key===null&&(v=v.props.children),typeof v=="object"&&v!==null){switch(v.$$typeof){case ip:e:{for(var x=v.key,M=_;M!==null;){if(M.key===x){if(x=v.type,x===Dc){if(M.tag===7){r(g,M.sibling),_=s(M,v.props.children),_.return=g,g=_;break e}}else if(M.elementType===x||typeof x=="object"&&x!==null&&x.$$typeof===ma&&YP(x)===M.type){r(g,M.sibling),_=s(M,v.props),_.ref=Ad(g,M,v),_.return=g,g=_;break e}r(g,M);break}else e(g,M);M=M.sibling}v.type===Dc?(_=Vl(v.props.children,g.mode,w,v.key),_.return=g,g=_):(w=Pm(v.type,v.key,v.props,null,g.mode,w),w.ref=Ad(g,_,v),w.return=g,g=w)}return o(g);case Oc:e:{for(M=v.key;_!==null;){if(_.key===M)if(_.tag===4&&_.stateNode.containerInfo===v.containerInfo&&_.stateNode.implementation===v.implementation){r(g,_.sibling),_=s(_,v.children||[]),_.return=g,g=_;break e}else{r(g,_);break}else e(g,_);_=_.sibling}_=vy(v,g.mode,w),_.return=g,g=_}return o(g);case ma:return M=v._init,y(g,_,M(v._payload),w)}if(Xd(v))return p(g,_,v,w);if(Cd(v))return m(g,_,v,w);gp(g,v)}return typeof v=="string"&&v!==""||typeof v=="number"?(v=""+v,_!==null&&_.tag===6?(r(g,_.sibling),_=s(_,v),_.return=g,g=_):(r(g,_),_=yy(v,g.mode,w),_.return=g,g=_),o(g)):r(g,_)}return y}var bu=uF(!0),dF=uF(!1),rg=Ga(null),ng=null,Bc=null,v1=null;function w1(){v1=Bc=ng=null}function x1(t){var e=rg.current;$r(rg),t._currentValue=e}function Mw(t,e,r){for(;t!==null;){var n=t.alternate;if((t.childLanes&e)!==e?(t.childLanes|=e,n!==null&&(n.childLanes|=e)):n!==null&&(n.childLanes&e)!==e&&(n.childLanes|=e),t===r)break;t=t.return}}function Zc(t,e){ng=t,v1=Bc=null,t=t.dependencies,t!==null&&t.firstContext!==null&&(t.lanes&e&&(ds=!0),t.firstContext=null)}function si(t){var e=t._currentValue;if(v1!==t)if(t={context:t,memoizedValue:e,next:null},Bc===null){if(ng===null)throw Error(Ye(308));Bc=t,ng.dependencies={lanes:0,firstContext:t}}else Bc=Bc.next=t;return e}var $l=null;function b1(t){$l===null?$l=[t]:$l.push(t)}function hF(t,e,r,n){var s=e.interleaved;return s===null?(r.next=r,b1(e)):(r.next=s.next,s.next=r),e.interleaved=r,Ro(t,n)}function Ro(t,e){t.lanes|=e;var r=t.alternate;for(r!==null&&(r.lanes|=e),r=t,t=t.return;t!==null;)t.childLanes|=e,r=t.alternate,r!==null&&(r.childLanes|=e),r=t,t=t.return;return r.tag===3?r.stateNode:null}var ga=!1;function M1(t){t.updateQueue={baseState:t.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function fF(t,e){t=t.updateQueue,e.updateQueue===t&&(e.updateQueue={baseState:t.baseState,firstBaseUpdate:t.firstBaseUpdate,lastBaseUpdate:t.lastBaseUpdate,shared:t.shared,effects:t.effects})}function Oo(t,e){return{eventTime:t,lane:e,tag:0,payload:null,callback:null,next:null}}function $a(t,e,r){var n=t.updateQueue;if(n===null)return null;if(n=n.shared,ir&2){var s=n.pending;return s===null?e.next=e:(e.next=s.next,s.next=e),n.pending=e,Ro(t,r)}return s=n.interleaved,s===null?(e.next=e,b1(n)):(e.next=s.next,s.next=e),n.interleaved=e,Ro(t,r)}function bm(t,e,r){if(e=e.updateQueue,e!==null&&(e=e.shared,(r&4194240)!==0)){var n=e.lanes;n&=t.pendingLanes,r|=n,e.lanes=r,l1(t,r)}}function QP(t,e){var r=t.updateQueue,n=t.alternate;if(n!==null&&(n=n.updateQueue,r===n)){var s=null,i=null;if(r=r.firstBaseUpdate,r!==null){do{var o={eventTime:r.eventTime,lane:r.lane,tag:r.tag,payload:r.payload,callback:r.callback,next:null};i===null?s=i=o:i=i.next=o,r=r.next}while(r!==null);i===null?s=i=e:i=i.next=e}else s=i=e;r={baseState:n.baseState,firstBaseUpdate:s,lastBaseUpdate:i,shared:n.shared,effects:n.effects},t.updateQueue=r;return}t=r.lastBaseUpdate,t===null?r.firstBaseUpdate=e:t.next=e,r.lastBaseUpdate=e}function sg(t,e,r,n){var s=t.updateQueue;ga=!1;var i=s.firstBaseUpdate,o=s.lastBaseUpdate,a=s.shared.pending;if(a!==null){s.shared.pending=null;var l=a,c=l.next;l.next=null,o===null?i=c:o.next=c,o=l;var u=t.alternate;u!==null&&(u=u.updateQueue,a=u.lastBaseUpdate,a!==o&&(a===null?u.firstBaseUpdate=c:a.next=c,u.lastBaseUpdate=l))}if(i!==null){var d=s.baseState;o=0,u=c=l=null,a=i;do{var h=a.lane,f=a.eventTime;if((n&h)===h){u!==null&&(u=u.next={eventTime:f,lane:0,tag:a.tag,payload:a.payload,callback:a.callback,next:null});e:{var p=t,m=a;switch(h=e,f=r,m.tag){case 1:if(p=m.payload,typeof p=="function"){d=p.call(f,d,h);break e}d=p;break e;case 3:p.flags=p.flags&-65537|128;case 0:if(p=m.payload,h=typeof p=="function"?p.call(f,d,h):p,h==null)break e;d=Vr({},d,h);break e;case 2:ga=!0}}a.callback!==null&&a.lane!==0&&(t.flags|=64,h=s.effects,h===null?s.effects=[a]:h.push(a))}else f={eventTime:f,lane:h,tag:a.tag,payload:a.payload,callback:a.callback,next:null},u===null?(c=u=f,l=d):u=u.next=f,o|=h;if(a=a.next,a===null){if(a=s.shared.pending,a===null)break;h=a,a=h.next,h.next=null,s.lastBaseUpdate=h,s.shared.pending=null}}while(!0);if(u===null&&(l=d),s.baseState=l,s.firstBaseUpdate=c,s.lastBaseUpdate=u,e=s.shared.interleaved,e!==null){s=e;do o|=s.lane,s=s.next;while(s!==e)}else i===null&&(s.shared.lanes=0);Kl|=o,t.lanes=o,t.memoizedState=d}}function JP(t,e,r){if(t=e.effects,e.effects=null,t!==null)for(e=0;e<t.length;e++){var n=t[e],s=n.callback;if(s!==null){if(n.callback=null,n=r,typeof s!="function")throw Error(Ye(191,s));s.call(n)}}}var tf={},ho=Ga(tf),kh=Ga(tf),Ah=Ga(tf);function Ol(t){if(t===tf)throw Error(Ye(174));return t}function T1(t,e){switch(Pr(Ah,e),Pr(kh,t),Pr(ho,tf),t=e.nodeType,t){case 9:case 11:e=(e=e.documentElement)?e.namespaceURI:nw(null,"");break;default:t=t===8?e.parentNode:e,e=t.namespaceURI||null,t=t.tagName,e=nw(e,t)}$r(ho),Pr(ho,e)}function Mu(){$r(ho),$r(kh),$r(Ah)}function pF(t){Ol(Ah.current);var e=Ol(ho.current),r=nw(e,t.type);e!==r&&(Pr(kh,t),Pr(ho,r))}function C1(t){kh.current===t&&($r(ho),$r(kh))}var zr=Ga(0);function ig(t){for(var e=t;e!==null;){if(e.tag===13){var r=e.memoizedState;if(r!==null&&(r=r.dehydrated,r===null||r.data==="$?"||r.data==="$!"))return e}else if(e.tag===19&&e.memoizedProps.revealOrder!==void 0){if(e.flags&128)return e}else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}return null}var hy=[];function S1(){for(var t=0;t<hy.length;t++)hy[t]._workInProgressVersionPrimary=null;hy.length=0}var Mm=Go.ReactCurrentDispatcher,fy=Go.ReactCurrentBatchConfig,Hl=0,Br=null,yn=null,En=null,og=!1,lh=!1,$h=0,HU=0;function zn(){throw Error(Ye(321))}function E1(t,e){if(e===null)return!1;for(var r=0;r<e.length&&r<t.length;r++)if(!ji(t[r],e[r]))return!1;return!0}function P1(t,e,r,n,s,i){if(Hl=i,Br=e,e.memoizedState=null,e.updateQueue=null,e.lanes=0,Mm.current=t===null||t.memoizedState===null?YU:QU,t=r(n,s),lh){i=0;do{if(lh=!1,$h=0,25<=i)throw Error(Ye(301));i+=1,En=yn=null,e.updateQueue=null,Mm.current=JU,t=r(n,s)}while(lh)}if(Mm.current=ag,e=yn!==null&&yn.next!==null,Hl=0,En=yn=Br=null,og=!1,e)throw Error(Ye(300));return t}function k1(){var t=$h!==0;return $h=0,t}function eo(){var t={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return En===null?Br.memoizedState=En=t:En=En.next=t,En}function ii(){if(yn===null){var t=Br.alternate;t=t!==null?t.memoizedState:null}else t=yn.next;var e=En===null?Br.memoizedState:En.next;if(e!==null)En=e,yn=t;else{if(t===null)throw Error(Ye(310));yn=t,t={memoizedState:yn.memoizedState,baseState:yn.baseState,baseQueue:yn.baseQueue,queue:yn.queue,next:null},En===null?Br.memoizedState=En=t:En=En.next=t}return En}function Oh(t,e){return typeof e=="function"?e(t):e}function py(t){var e=ii(),r=e.queue;if(r===null)throw Error(Ye(311));r.lastRenderedReducer=t;var n=yn,s=n.baseQueue,i=r.pending;if(i!==null){if(s!==null){var o=s.next;s.next=i.next,i.next=o}n.baseQueue=s=i,r.pending=null}if(s!==null){i=s.next,n=n.baseState;var a=o=null,l=null,c=i;do{var u=c.lane;if((Hl&u)===u)l!==null&&(l=l.next={lane:0,action:c.action,hasEagerState:c.hasEagerState,eagerState:c.eagerState,next:null}),n=c.hasEagerState?c.eagerState:t(n,c.action);else{var d={lane:u,action:c.action,hasEagerState:c.hasEagerState,eagerState:c.eagerState,next:null};l===null?(a=l=d,o=n):l=l.next=d,Br.lanes|=u,Kl|=u}c=c.next}while(c!==null&&c!==i);l===null?o=n:l.next=a,ji(n,e.memoizedState)||(ds=!0),e.memoizedState=n,e.baseState=o,e.baseQueue=l,r.lastRenderedState=n}if(t=r.interleaved,t!==null){s=t;do i=s.lane,Br.lanes|=i,Kl|=i,s=s.next;while(s!==t)}else s===null&&(r.lanes=0);return[e.memoizedState,r.dispatch]}function my(t){var e=ii(),r=e.queue;if(r===null)throw Error(Ye(311));r.lastRenderedReducer=t;var n=r.dispatch,s=r.pending,i=e.memoizedState;if(s!==null){r.pending=null;var o=s=s.next;do i=t(i,o.action),o=o.next;while(o!==s);ji(i,e.memoizedState)||(ds=!0),e.memoizedState=i,e.baseQueue===null&&(e.baseState=i),r.lastRenderedState=i}return[i,n]}function mF(){}function gF(t,e){var r=Br,n=ii(),s=e(),i=!ji(n.memoizedState,s);if(i&&(n.memoizedState=s,ds=!0),n=n.queue,A1(vF.bind(null,r,n,t),[t]),n.getSnapshot!==e||i||En!==null&&En.memoizedState.tag&1){if(r.flags|=2048,Dh(9,yF.bind(null,r,n,s,e),void 0,null),Pn===null)throw Error(Ye(349));Hl&30||_F(r,e,s)}return s}function _F(t,e,r){t.flags|=16384,t={getSnapshot:e,value:r},e=Br.updateQueue,e===null?(e={lastEffect:null,stores:null},Br.updateQueue=e,e.stores=[t]):(r=e.stores,r===null?e.stores=[t]:r.push(t))}function yF(t,e,r,n){e.value=r,e.getSnapshot=n,wF(e)&&xF(t)}function vF(t,e,r){return r(function(){wF(e)&&xF(t)})}function wF(t){var e=t.getSnapshot;t=t.value;try{var r=e();return!ji(t,r)}catch{return!0}}function xF(t){var e=Ro(t,1);e!==null&&Fi(e,t,1,-1)}function ZP(t){var e=eo();return typeof t=="function"&&(t=t()),e.memoizedState=e.baseState=t,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Oh,lastRenderedState:t},e.queue=t,t=t.dispatch=qU.bind(null,Br,t),[e.memoizedState,t]}function Dh(t,e,r,n){return t={tag:t,create:e,destroy:r,deps:n,next:null},e=Br.updateQueue,e===null?(e={lastEffect:null,stores:null},Br.updateQueue=e,e.lastEffect=t.next=t):(r=e.lastEffect,r===null?e.lastEffect=t.next=t:(n=r.next,r.next=t,t.next=n,e.lastEffect=t)),t}function bF(){return ii().memoizedState}function Tm(t,e,r,n){var s=eo();Br.flags|=t,s.memoizedState=Dh(1|e,r,void 0,n===void 0?null:n)}function qg(t,e,r,n){var s=ii();n=n===void 0?null:n;var i=void 0;if(yn!==null){var o=yn.memoizedState;if(i=o.destroy,n!==null&&E1(n,o.deps)){s.memoizedState=Dh(e,r,i,n);return}}Br.flags|=t,s.memoizedState=Dh(1|e,r,i,n)}function e2(t,e){return Tm(8390656,8,t,e)}function A1(t,e){return qg(2048,8,t,e)}function MF(t,e){return qg(4,2,t,e)}function TF(t,e){return qg(4,4,t,e)}function CF(t,e){if(typeof e=="function")return t=t(),e(t),function(){e(null)};if(e!=null)return t=t(),e.current=t,function(){e.current=null}}function SF(t,e,r){return r=r!=null?r.concat([t]):null,qg(4,4,CF.bind(null,e,t),r)}function $1(){}function EF(t,e){var r=ii();e=e===void 0?null:e;var n=r.memoizedState;return n!==null&&e!==null&&E1(e,n[1])?n[0]:(r.memoizedState=[t,e],t)}function PF(t,e){var r=ii();e=e===void 0?null:e;var n=r.memoizedState;return n!==null&&e!==null&&E1(e,n[1])?n[0]:(t=t(),r.memoizedState=[t,e],t)}function kF(t,e,r){return Hl&21?(ji(r,e)||(r=II(),Br.lanes|=r,Kl|=r,t.baseState=!0),e):(t.baseState&&(t.baseState=!1,ds=!0),t.memoizedState=r)}function KU(t,e){var r=yr;yr=r!==0&&4>r?r:4,t(!0);var n=fy.transition;fy.transition={};try{t(!1),e()}finally{yr=r,fy.transition=n}}function AF(){return ii().memoizedState}function XU(t,e,r){var n=Da(t);if(r={lane:n,action:r,hasEagerState:!1,eagerState:null,next:null},$F(t))OF(e,r);else if(r=hF(t,e,r,n),r!==null){var s=ts();Fi(r,t,n,s),DF(r,e,n)}}function qU(t,e,r){var n=Da(t),s={lane:n,action:r,hasEagerState:!1,eagerState:null,next:null};if($F(t))OF(e,s);else{var i=t.alternate;if(t.lanes===0&&(i===null||i.lanes===0)&&(i=e.lastRenderedReducer,i!==null))try{var o=e.lastRenderedState,a=i(o,r);if(s.hasEagerState=!0,s.eagerState=a,ji(a,o)){var l=e.interleaved;l===null?(s.next=s,b1(e)):(s.next=l.next,l.next=s),e.interleaved=s;return}}catch{}finally{}r=hF(t,e,s,n),r!==null&&(s=ts(),Fi(r,t,n,s),DF(r,e,n))}}function $F(t){var e=t.alternate;return t===Br||e!==null&&e===Br}function OF(t,e){lh=og=!0;var r=t.pending;r===null?e.next=e:(e.next=r.next,r.next=e),t.pending=e}function DF(t,e,r){if(r&4194240){var n=e.lanes;n&=t.pendingLanes,r|=n,e.lanes=r,l1(t,r)}}var ag={readContext:si,useCallback:zn,useContext:zn,useEffect:zn,useImperativeHandle:zn,useInsertionEffect:zn,useLayoutEffect:zn,useMemo:zn,useReducer:zn,useRef:zn,useState:zn,useDebugValue:zn,useDeferredValue:zn,useTransition:zn,useMutableSource:zn,useSyncExternalStore:zn,useId:zn,unstable_isNewReconciler:!1},YU={readContext:si,useCallback:function(t,e){return eo().memoizedState=[t,e===void 0?null:e],t},useContext:si,useEffect:e2,useImperativeHandle:function(t,e,r){return r=r!=null?r.concat([t]):null,Tm(4194308,4,CF.bind(null,e,t),r)},useLayoutEffect:function(t,e){return Tm(4194308,4,t,e)},useInsertionEffect:function(t,e){return Tm(4,2,t,e)},useMemo:function(t,e){var r=eo();return e=e===void 0?null:e,t=t(),r.memoizedState=[t,e],t},useReducer:function(t,e,r){var n=eo();return e=r!==void 0?r(e):e,n.memoizedState=n.baseState=e,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:t,lastRenderedState:e},n.queue=t,t=t.dispatch=XU.bind(null,Br,t),[n.memoizedState,t]},useRef:function(t){var e=eo();return t={current:t},e.memoizedState=t},useState:ZP,useDebugValue:$1,useDeferredValue:function(t){return eo().memoizedState=t},useTransition:function(){var t=ZP(!1),e=t[0];return t=KU.bind(null,t[1]),eo().memoizedState=t,[e,t]},useMutableSource:function(){},useSyncExternalStore:function(t,e,r){var n=Br,s=eo();if(Dr){if(r===void 0)throw Error(Ye(407));r=r()}else{if(r=e(),Pn===null)throw Error(Ye(349));Hl&30||_F(n,e,r)}s.memoizedState=r;var i={value:r,getSnapshot:e};return s.queue=i,e2(vF.bind(null,n,i,t),[t]),n.flags|=2048,Dh(9,yF.bind(null,n,i,r,e),void 0,null),r},useId:function(){var t=eo(),e=Pn.identifierPrefix;if(Dr){var r=ko,n=Po;r=(n&~(1<<32-Ii(n)-1)).toString(32)+r,e=":"+e+"R"+r,r=$h++,0<r&&(e+="H"+r.toString(32)),e+=":"}else r=HU++,e=":"+e+"r"+r.toString(32)+":";return t.memoizedState=e},unstable_isNewReconciler:!1},QU={readContext:si,useCallback:EF,useContext:si,useEffect:A1,useImperativeHandle:SF,useInsertionEffect:MF,useLayoutEffect:TF,useMemo:PF,useReducer:py,useRef:bF,useState:function(){return py(Oh)},useDebugValue:$1,useDeferredValue:function(t){var e=ii();return kF(e,yn.memoizedState,t)},useTransition:function(){var t=py(Oh)[0],e=ii().memoizedState;return[t,e]},useMutableSource:mF,useSyncExternalStore:gF,useId:AF,unstable_isNewReconciler:!1},JU={readContext:si,useCallback:EF,useContext:si,useEffect:A1,useImperativeHandle:SF,useInsertionEffect:MF,useLayoutEffect:TF,useMemo:PF,useReducer:my,useRef:bF,useState:function(){return my(Oh)},useDebugValue:$1,useDeferredValue:function(t){var e=ii();return yn===null?e.memoizedState=t:kF(e,yn.memoizedState,t)},useTransition:function(){var t=my(Oh)[0],e=ii().memoizedState;return[t,e]},useMutableSource:mF,useSyncExternalStore:gF,useId:AF,unstable_isNewReconciler:!1};function Mi(t,e){if(t&&t.defaultProps){e=Vr({},e),t=t.defaultProps;for(var r in t)e[r]===void 0&&(e[r]=t[r]);return e}return e}function Tw(t,e,r,n){e=t.memoizedState,r=r(n,e),r=r==null?e:Vr({},e,r),t.memoizedState=r,t.lanes===0&&(t.updateQueue.baseState=r)}var Yg={isMounted:function(t){return(t=t._reactInternals)?nc(t)===t:!1},enqueueSetState:function(t,e,r){t=t._reactInternals;var n=ts(),s=Da(t),i=Oo(n,s);i.payload=e,r!=null&&(i.callback=r),e=$a(t,i,s),e!==null&&(Fi(e,t,s,n),bm(e,t,s))},enqueueReplaceState:function(t,e,r){t=t._reactInternals;var n=ts(),s=Da(t),i=Oo(n,s);i.tag=1,i.payload=e,r!=null&&(i.callback=r),e=$a(t,i,s),e!==null&&(Fi(e,t,s,n),bm(e,t,s))},enqueueForceUpdate:function(t,e){t=t._reactInternals;var r=ts(),n=Da(t),s=Oo(r,n);s.tag=2,e!=null&&(s.callback=e),e=$a(t,s,n),e!==null&&(Fi(e,t,n,r),bm(e,t,n))}};function t2(t,e,r,n,s,i,o){return t=t.stateNode,typeof t.shouldComponentUpdate=="function"?t.shouldComponentUpdate(n,i,o):e.prototype&&e.prototype.isPureReactComponent?!Ch(r,n)||!Ch(s,i):!0}function IF(t,e,r){var n=!1,s=La,i=e.contextType;return typeof i=="object"&&i!==null?i=si(i):(s=fs(e)?Ul:Hn.current,n=e.contextTypes,i=(n=n!=null)?wu(t,s):La),e=new e(r,i),t.memoizedState=e.state!==null&&e.state!==void 0?e.state:null,e.updater=Yg,t.stateNode=e,e._reactInternals=t,n&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=s,t.__reactInternalMemoizedMaskedChildContext=i),e}function r2(t,e,r,n){t=e.state,typeof e.componentWillReceiveProps=="function"&&e.componentWillReceiveProps(r,n),typeof e.UNSAFE_componentWillReceiveProps=="function"&&e.UNSAFE_componentWillReceiveProps(r,n),e.state!==t&&Yg.enqueueReplaceState(e,e.state,null)}function Cw(t,e,r,n){var s=t.stateNode;s.props=r,s.state=t.memoizedState,s.refs={},M1(t);var i=e.contextType;typeof i=="object"&&i!==null?s.context=si(i):(i=fs(e)?Ul:Hn.current,s.context=wu(t,i)),s.state=t.memoizedState,i=e.getDerivedStateFromProps,typeof i=="function"&&(Tw(t,e,i,r),s.state=t.memoizedState),typeof e.getDerivedStateFromProps=="function"||typeof s.getSnapshotBeforeUpdate=="function"||typeof s.UNSAFE_componentWillMount!="function"&&typeof s.componentWillMount!="function"||(e=s.state,typeof s.componentWillMount=="function"&&s.componentWillMount(),typeof s.UNSAFE_componentWillMount=="function"&&s.UNSAFE_componentWillMount(),e!==s.state&&Yg.enqueueReplaceState(s,s.state,null),sg(t,r,s,n),s.state=t.memoizedState),typeof s.componentDidMount=="function"&&(t.flags|=4194308)}function Tu(t,e){try{var r="",n=e;do r+=SW(n),n=n.return;while(n);var s=r}catch(i){s=`
Error generating stack: `+i.message+`
`+i.stack}return{value:t,source:e,stack:s,digest:null}}function gy(t,e,r){return{value:t,source:null,stack:r??null,digest:e??null}}function Sw(t,e){try{console.error(e.value)}catch(r){setTimeout(function(){throw r})}}var ZU=typeof WeakMap=="function"?WeakMap:Map;function FF(t,e,r){r=Oo(-1,r),r.tag=3,r.payload={element:null};var n=e.value;return r.callback=function(){cg||(cg=!0,Lw=n),Sw(t,e)},r}function LF(t,e,r){r=Oo(-1,r),r.tag=3;var n=t.type.getDerivedStateFromError;if(typeof n=="function"){var s=e.value;r.payload=function(){return n(s)},r.callback=function(){Sw(t,e)}}var i=t.stateNode;return i!==null&&typeof i.componentDidCatch=="function"&&(r.callback=function(){Sw(t,e),typeof n!="function"&&(Oa===null?Oa=new Set([this]):Oa.add(this));var o=e.stack;this.componentDidCatch(e.value,{componentStack:o!==null?o:""})}),r}function n2(t,e,r){var n=t.pingCache;if(n===null){n=t.pingCache=new ZU;var s=new Set;n.set(e,s)}else s=n.get(e),s===void 0&&(s=new Set,n.set(e,s));s.has(r)||(s.add(r),t=f5.bind(null,t,e,r),e.then(t,t))}function s2(t){do{var e;if((e=t.tag===13)&&(e=t.memoizedState,e=e!==null?e.dehydrated!==null:!0),e)return t;t=t.return}while(t!==null);return null}function i2(t,e,r,n,s){return t.mode&1?(t.flags|=65536,t.lanes=s,t):(t===e?t.flags|=65536:(t.flags|=128,r.flags|=131072,r.flags&=-52805,r.tag===1&&(r.alternate===null?r.tag=17:(e=Oo(-1,1),e.tag=2,$a(r,e,1))),r.lanes|=1),t)}var e5=Go.ReactCurrentOwner,ds=!1;function Jn(t,e,r,n){e.child=t===null?dF(e,null,r,n):bu(e,t.child,r,n)}function o2(t,e,r,n,s){r=r.render;var i=e.ref;return Zc(e,s),n=P1(t,e,r,n,i,s),r=k1(),t!==null&&!ds?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~s,jo(t,e,s)):(Dr&&r&&g1(e),e.flags|=1,Jn(t,e,n,s),e.child)}function a2(t,e,r,n,s){if(t===null){var i=r.type;return typeof i=="function"&&!N1(i)&&i.defaultProps===void 0&&r.compare===null&&r.defaultProps===void 0?(e.tag=15,e.type=i,RF(t,e,i,n,s)):(t=Pm(r.type,null,n,e,e.mode,s),t.ref=e.ref,t.return=e,e.child=t)}if(i=t.child,!(t.lanes&s)){var o=i.memoizedProps;if(r=r.compare,r=r!==null?r:Ch,r(o,n)&&t.ref===e.ref)return jo(t,e,s)}return e.flags|=1,t=Ia(i,n),t.ref=e.ref,t.return=e,e.child=t}function RF(t,e,r,n,s){if(t!==null){var i=t.memoizedProps;if(Ch(i,n)&&t.ref===e.ref)if(ds=!1,e.pendingProps=n=i,(t.lanes&s)!==0)t.flags&131072&&(ds=!0);else return e.lanes=t.lanes,jo(t,e,s)}return Ew(t,e,r,n,s)}function jF(t,e,r){var n=e.pendingProps,s=n.children,i=t!==null?t.memoizedState:null;if(n.mode==="hidden")if(!(e.mode&1))e.memoizedState={baseLanes:0,cachePool:null,transitions:null},Pr(Wc,ks),ks|=r;else{if(!(r&1073741824))return t=i!==null?i.baseLanes|r:r,e.lanes=e.childLanes=1073741824,e.memoizedState={baseLanes:t,cachePool:null,transitions:null},e.updateQueue=null,Pr(Wc,ks),ks|=t,null;e.memoizedState={baseLanes:0,cachePool:null,transitions:null},n=i!==null?i.baseLanes:r,Pr(Wc,ks),ks|=n}else i!==null?(n=i.baseLanes|r,e.memoizedState=null):n=r,Pr(Wc,ks),ks|=n;return Jn(t,e,s,r),e.child}function NF(t,e){var r=e.ref;(t===null&&r!==null||t!==null&&t.ref!==r)&&(e.flags|=512,e.flags|=2097152)}function Ew(t,e,r,n,s){var i=fs(r)?Ul:Hn.current;return i=wu(e,i),Zc(e,s),r=P1(t,e,r,n,i,s),n=k1(),t!==null&&!ds?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~s,jo(t,e,s)):(Dr&&n&&g1(e),e.flags|=1,Jn(t,e,r,s),e.child)}function l2(t,e,r,n,s){if(fs(r)){var i=!0;Zm(e)}else i=!1;if(Zc(e,s),e.stateNode===null)Cm(t,e),IF(e,r,n),Cw(e,r,n,s),n=!0;else if(t===null){var o=e.stateNode,a=e.memoizedProps;o.props=a;var l=o.context,c=r.contextType;typeof c=="object"&&c!==null?c=si(c):(c=fs(r)?Ul:Hn.current,c=wu(e,c));var u=r.getDerivedStateFromProps,d=typeof u=="function"||typeof o.getSnapshotBeforeUpdate=="function";d||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(a!==n||l!==c)&&r2(e,o,n,c),ga=!1;var h=e.memoizedState;o.state=h,sg(e,n,o,s),l=e.memoizedState,a!==n||h!==l||hs.current||ga?(typeof u=="function"&&(Tw(e,r,u,n),l=e.memoizedState),(a=ga||t2(e,r,a,n,h,l,c))?(d||typeof o.UNSAFE_componentWillMount!="function"&&typeof o.componentWillMount!="function"||(typeof o.componentWillMount=="function"&&o.componentWillMount(),typeof o.UNSAFE_componentWillMount=="function"&&o.UNSAFE_componentWillMount()),typeof o.componentDidMount=="function"&&(e.flags|=4194308)):(typeof o.componentDidMount=="function"&&(e.flags|=4194308),e.memoizedProps=n,e.memoizedState=l),o.props=n,o.state=l,o.context=c,n=a):(typeof o.componentDidMount=="function"&&(e.flags|=4194308),n=!1)}else{o=e.stateNode,fF(t,e),a=e.memoizedProps,c=e.type===e.elementType?a:Mi(e.type,a),o.props=c,d=e.pendingProps,h=o.context,l=r.contextType,typeof l=="object"&&l!==null?l=si(l):(l=fs(r)?Ul:Hn.current,l=wu(e,l));var f=r.getDerivedStateFromProps;(u=typeof f=="function"||typeof o.getSnapshotBeforeUpdate=="function")||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(a!==d||h!==l)&&r2(e,o,n,l),ga=!1,h=e.memoizedState,o.state=h,sg(e,n,o,s);var p=e.memoizedState;a!==d||h!==p||hs.current||ga?(typeof f=="function"&&(Tw(e,r,f,n),p=e.memoizedState),(c=ga||t2(e,r,c,n,h,p,l)||!1)?(u||typeof o.UNSAFE_componentWillUpdate!="function"&&typeof o.componentWillUpdate!="function"||(typeof o.componentWillUpdate=="function"&&o.componentWillUpdate(n,p,l),typeof o.UNSAFE_componentWillUpdate=="function"&&o.UNSAFE_componentWillUpdate(n,p,l)),typeof o.componentDidUpdate=="function"&&(e.flags|=4),typeof o.getSnapshotBeforeUpdate=="function"&&(e.flags|=1024)):(typeof o.componentDidUpdate!="function"||a===t.memoizedProps&&h===t.memoizedState||(e.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||a===t.memoizedProps&&h===t.memoizedState||(e.flags|=1024),e.memoizedProps=n,e.memoizedState=p),o.props=n,o.state=p,o.context=l,n=c):(typeof o.componentDidUpdate!="function"||a===t.memoizedProps&&h===t.memoizedState||(e.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||a===t.memoizedProps&&h===t.memoizedState||(e.flags|=1024),n=!1)}return Pw(t,e,r,n,i,s)}function Pw(t,e,r,n,s,i){NF(t,e);var o=(e.flags&128)!==0;if(!n&&!o)return s&&KP(e,r,!1),jo(t,e,i);n=e.stateNode,e5.current=e;var a=o&&typeof r.getDerivedStateFromError!="function"?null:n.render();return e.flags|=1,t!==null&&o?(e.child=bu(e,t.child,null,i),e.child=bu(e,null,a,i)):Jn(t,e,a,i),e.memoizedState=n.state,s&&KP(e,r,!0),e.child}function zF(t){var e=t.stateNode;e.pendingContext?HP(t,e.pendingContext,e.pendingContext!==e.context):e.context&&HP(t,e.context,!1),T1(t,e.containerInfo)}function c2(t,e,r,n,s){return xu(),y1(s),e.flags|=256,Jn(t,e,r,n),e.child}var kw={dehydrated:null,treeContext:null,retryLane:0};function Aw(t){return{baseLanes:t,cachePool:null,transitions:null}}function BF(t,e,r){var n=e.pendingProps,s=zr.current,i=!1,o=(e.flags&128)!==0,a;if((a=o)||(a=t!==null&&t.memoizedState===null?!1:(s&2)!==0),a?(i=!0,e.flags&=-129):(t===null||t.memoizedState!==null)&&(s|=1),Pr(zr,s&1),t===null)return bw(e),t=e.memoizedState,t!==null&&(t=t.dehydrated,t!==null)?(e.mode&1?t.data==="$!"?e.lanes=8:e.lanes=1073741824:e.lanes=1,null):(o=n.children,t=n.fallback,i?(n=e.mode,i=e.child,o={mode:"hidden",children:o},!(n&1)&&i!==null?(i.childLanes=0,i.pendingProps=o):i=Zg(o,n,0,null),t=Vl(t,n,r,null),i.return=e,t.return=e,i.sibling=t,e.child=i,e.child.memoizedState=Aw(r),e.memoizedState=kw,t):O1(e,o));if(s=t.memoizedState,s!==null&&(a=s.dehydrated,a!==null))return t5(t,e,o,n,a,s,r);if(i){i=n.fallback,o=e.mode,s=t.child,a=s.sibling;var l={mode:"hidden",children:n.children};return!(o&1)&&e.child!==s?(n=e.child,n.childLanes=0,n.pendingProps=l,e.deletions=null):(n=Ia(s,l),n.subtreeFlags=s.subtreeFlags&14680064),a!==null?i=Ia(a,i):(i=Vl(i,o,r,null),i.flags|=2),i.return=e,n.return=e,n.sibling=i,e.child=n,n=i,i=e.child,o=t.child.memoizedState,o=o===null?Aw(r):{baseLanes:o.baseLanes|r,cachePool:null,transitions:o.transitions},i.memoizedState=o,i.childLanes=t.childLanes&~r,e.memoizedState=kw,n}return i=t.child,t=i.sibling,n=Ia(i,{mode:"visible",children:n.children}),!(e.mode&1)&&(n.lanes=r),n.return=e,n.sibling=null,t!==null&&(r=e.deletions,r===null?(e.deletions=[t],e.flags|=16):r.push(t)),e.child=n,e.memoizedState=null,n}function O1(t,e){return e=Zg({mode:"visible",children:e},t.mode,0,null),e.return=t,t.child=e}function _p(t,e,r,n){return n!==null&&y1(n),bu(e,t.child,null,r),t=O1(e,e.pendingProps.children),t.flags|=2,e.memoizedState=null,t}function t5(t,e,r,n,s,i,o){if(r)return e.flags&256?(e.flags&=-257,n=gy(Error(Ye(422))),_p(t,e,o,n)):e.memoizedState!==null?(e.child=t.child,e.flags|=128,null):(i=n.fallback,s=e.mode,n=Zg({mode:"visible",children:n.children},s,0,null),i=Vl(i,s,o,null),i.flags|=2,n.return=e,i.return=e,n.sibling=i,e.child=n,e.mode&1&&bu(e,t.child,null,o),e.child.memoizedState=Aw(o),e.memoizedState=kw,i);if(!(e.mode&1))return _p(t,e,o,null);if(s.data==="$!"){if(n=s.nextSibling&&s.nextSibling.dataset,n)var a=n.dgst;return n=a,i=Error(Ye(419)),n=gy(i,n,void 0),_p(t,e,o,n)}if(a=(o&t.childLanes)!==0,ds||a){if(n=Pn,n!==null){switch(o&-o){case 4:s=2;break;case 16:s=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:s=32;break;case 536870912:s=268435456;break;default:s=0}s=s&(n.suspendedLanes|o)?0:s,s!==0&&s!==i.retryLane&&(i.retryLane=s,Ro(t,s),Fi(n,t,s,-1))}return j1(),n=gy(Error(Ye(421))),_p(t,e,o,n)}return s.data==="$?"?(e.flags|=128,e.child=t.child,e=p5.bind(null,t),s._reactRetry=e,null):(t=i.treeContext,Os=Aa(s.nextSibling),Ds=e,Dr=!0,Pi=null,t!==null&&(Qs[Js++]=Po,Qs[Js++]=ko,Qs[Js++]=Gl,Po=t.id,ko=t.overflow,Gl=e),e=O1(e,n.children),e.flags|=4096,e)}function u2(t,e,r){t.lanes|=e;var n=t.alternate;n!==null&&(n.lanes|=e),Mw(t.return,e,r)}function _y(t,e,r,n,s){var i=t.memoizedState;i===null?t.memoizedState={isBackwards:e,rendering:null,renderingStartTime:0,last:n,tail:r,tailMode:s}:(i.isBackwards=e,i.rendering=null,i.renderingStartTime=0,i.last=n,i.tail=r,i.tailMode=s)}function VF(t,e,r){var n=e.pendingProps,s=n.revealOrder,i=n.tail;if(Jn(t,e,n.children,r),n=zr.current,n&2)n=n&1|2,e.flags|=128;else{if(t!==null&&t.flags&128)e:for(t=e.child;t!==null;){if(t.tag===13)t.memoizedState!==null&&u2(t,r,e);else if(t.tag===19)u2(t,r,e);else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break e;for(;t.sibling===null;){if(t.return===null||t.return===e)break e;t=t.return}t.sibling.return=t.return,t=t.sibling}n&=1}if(Pr(zr,n),!(e.mode&1))e.memoizedState=null;else switch(s){case"forwards":for(r=e.child,s=null;r!==null;)t=r.alternate,t!==null&&ig(t)===null&&(s=r),r=r.sibling;r=s,r===null?(s=e.child,e.child=null):(s=r.sibling,r.sibling=null),_y(e,!1,s,r,i);break;case"backwards":for(r=null,s=e.child,e.child=null;s!==null;){if(t=s.alternate,t!==null&&ig(t)===null){e.child=s;break}t=s.sibling,s.sibling=r,r=s,s=t}_y(e,!0,r,null,i);break;case"together":_y(e,!1,null,null,void 0);break;default:e.memoizedState=null}return e.child}function Cm(t,e){!(e.mode&1)&&t!==null&&(t.alternate=null,e.alternate=null,e.flags|=2)}function jo(t,e,r){if(t!==null&&(e.dependencies=t.dependencies),Kl|=e.lanes,!(r&e.childLanes))return null;if(t!==null&&e.child!==t.child)throw Error(Ye(153));if(e.child!==null){for(t=e.child,r=Ia(t,t.pendingProps),e.child=r,r.return=e;t.sibling!==null;)t=t.sibling,r=r.sibling=Ia(t,t.pendingProps),r.return=e;r.sibling=null}return e.child}function r5(t,e,r){switch(e.tag){case 3:zF(e),xu();break;case 5:pF(e);break;case 1:fs(e.type)&&Zm(e);break;case 4:T1(e,e.stateNode.containerInfo);break;case 10:var n=e.type._context,s=e.memoizedProps.value;Pr(rg,n._currentValue),n._currentValue=s;break;case 13:if(n=e.memoizedState,n!==null)return n.dehydrated!==null?(Pr(zr,zr.current&1),e.flags|=128,null):r&e.child.childLanes?BF(t,e,r):(Pr(zr,zr.current&1),t=jo(t,e,r),t!==null?t.sibling:null);Pr(zr,zr.current&1);break;case 19:if(n=(r&e.childLanes)!==0,t.flags&128){if(n)return VF(t,e,r);e.flags|=128}if(s=e.memoizedState,s!==null&&(s.rendering=null,s.tail=null,s.lastEffect=null),Pr(zr,zr.current),n)break;return null;case 22:case 23:return e.lanes=0,jF(t,e,r)}return jo(t,e,r)}var WF,$w,UF,GF;WF=function(t,e){for(var r=e.child;r!==null;){if(r.tag===5||r.tag===6)t.appendChild(r.stateNode);else if(r.tag!==4&&r.child!==null){r.child.return=r,r=r.child;continue}if(r===e)break;for(;r.sibling===null;){if(r.return===null||r.return===e)return;r=r.return}r.sibling.return=r.return,r=r.sibling}};$w=function(){};UF=function(t,e,r,n){var s=t.memoizedProps;if(s!==n){t=e.stateNode,Ol(ho.current);var i=null;switch(r){case"input":s=Zv(t,s),n=Zv(t,n),i=[];break;case"select":s=Vr({},s,{value:void 0}),n=Vr({},n,{value:void 0}),i=[];break;case"textarea":s=rw(t,s),n=rw(t,n),i=[];break;default:typeof s.onClick!="function"&&typeof n.onClick=="function"&&(t.onclick=Qm)}sw(r,n);var o;r=null;for(c in s)if(!n.hasOwnProperty(c)&&s.hasOwnProperty(c)&&s[c]!=null)if(c==="style"){var a=s[c];for(o in a)a.hasOwnProperty(o)&&(r||(r={}),r[o]="")}else c!=="dangerouslySetInnerHTML"&&c!=="children"&&c!=="suppressContentEditableWarning"&&c!=="suppressHydrationWarning"&&c!=="autoFocus"&&(yh.hasOwnProperty(c)?i||(i=[]):(i=i||[]).push(c,null));for(c in n){var l=n[c];if(a=s!=null?s[c]:void 0,n.hasOwnProperty(c)&&l!==a&&(l!=null||a!=null))if(c==="style")if(a){for(o in a)!a.hasOwnProperty(o)||l&&l.hasOwnProperty(o)||(r||(r={}),r[o]="");for(o in l)l.hasOwnProperty(o)&&a[o]!==l[o]&&(r||(r={}),r[o]=l[o])}else r||(i||(i=[]),i.push(c,r)),r=l;else c==="dangerouslySetInnerHTML"?(l=l?l.__html:void 0,a=a?a.__html:void 0,l!=null&&a!==l&&(i=i||[]).push(c,l)):c==="children"?typeof l!="string"&&typeof l!="number"||(i=i||[]).push(c,""+l):c!=="suppressContentEditableWarning"&&c!=="suppressHydrationWarning"&&(yh.hasOwnProperty(c)?(l!=null&&c==="onScroll"&&Ar("scroll",t),i||a===l||(i=[])):(i=i||[]).push(c,l))}r&&(i=i||[]).push("style",r);var c=i;(e.updateQueue=c)&&(e.flags|=4)}};GF=function(t,e,r,n){r!==n&&(e.flags|=4)};function $d(t,e){if(!Dr)switch(t.tailMode){case"hidden":e=t.tail;for(var r=null;e!==null;)e.alternate!==null&&(r=e),e=e.sibling;r===null?t.tail=null:r.sibling=null;break;case"collapsed":r=t.tail;for(var n=null;r!==null;)r.alternate!==null&&(n=r),r=r.sibling;n===null?e||t.tail===null?t.tail=null:t.tail.sibling=null:n.sibling=null}}function Bn(t){var e=t.alternate!==null&&t.alternate.child===t.child,r=0,n=0;if(e)for(var s=t.child;s!==null;)r|=s.lanes|s.childLanes,n|=s.subtreeFlags&14680064,n|=s.flags&14680064,s.return=t,s=s.sibling;else for(s=t.child;s!==null;)r|=s.lanes|s.childLanes,n|=s.subtreeFlags,n|=s.flags,s.return=t,s=s.sibling;return t.subtreeFlags|=n,t.childLanes=r,e}function n5(t,e,r){var n=e.pendingProps;switch(_1(e),e.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Bn(e),null;case 1:return fs(e.type)&&Jm(),Bn(e),null;case 3:return n=e.stateNode,Mu(),$r(hs),$r(Hn),S1(),n.pendingContext&&(n.context=n.pendingContext,n.pendingContext=null),(t===null||t.child===null)&&(mp(e)?e.flags|=4:t===null||t.memoizedState.isDehydrated&&!(e.flags&256)||(e.flags|=1024,Pi!==null&&(Nw(Pi),Pi=null))),$w(t,e),Bn(e),null;case 5:C1(e);var s=Ol(Ah.current);if(r=e.type,t!==null&&e.stateNode!=null)UF(t,e,r,n,s),t.ref!==e.ref&&(e.flags|=512,e.flags|=2097152);else{if(!n){if(e.stateNode===null)throw Error(Ye(166));return Bn(e),null}if(t=Ol(ho.current),mp(e)){n=e.stateNode,r=e.type;var i=e.memoizedProps;switch(n[io]=e,n[Ph]=i,t=(e.mode&1)!==0,r){case"dialog":Ar("cancel",n),Ar("close",n);break;case"iframe":case"object":case"embed":Ar("load",n);break;case"video":case"audio":for(s=0;s<Yd.length;s++)Ar(Yd[s],n);break;case"source":Ar("error",n);break;case"img":case"image":case"link":Ar("error",n),Ar("load",n);break;case"details":Ar("toggle",n);break;case"input":vP(n,i),Ar("invalid",n);break;case"select":n._wrapperState={wasMultiple:!!i.multiple},Ar("invalid",n);break;case"textarea":xP(n,i),Ar("invalid",n)}sw(r,i),s=null;for(var o in i)if(i.hasOwnProperty(o)){var a=i[o];o==="children"?typeof a=="string"?n.textContent!==a&&(i.suppressHydrationWarning!==!0&&pp(n.textContent,a,t),s=["children",a]):typeof a=="number"&&n.textContent!==""+a&&(i.suppressHydrationWarning!==!0&&pp(n.textContent,a,t),s=["children",""+a]):yh.hasOwnProperty(o)&&a!=null&&o==="onScroll"&&Ar("scroll",n)}switch(r){case"input":op(n),wP(n,i,!0);break;case"textarea":op(n),bP(n);break;case"select":case"option":break;default:typeof i.onClick=="function"&&(n.onclick=Qm)}n=s,e.updateQueue=n,n!==null&&(e.flags|=4)}else{o=s.nodeType===9?s:s.ownerDocument,t==="http://www.w3.org/1999/xhtml"&&(t=vI(r)),t==="http://www.w3.org/1999/xhtml"?r==="script"?(t=o.createElement("div"),t.innerHTML="<script><\/script>",t=t.removeChild(t.firstChild)):typeof n.is=="string"?t=o.createElement(r,{is:n.is}):(t=o.createElement(r),r==="select"&&(o=t,n.multiple?o.multiple=!0:n.size&&(o.size=n.size))):t=o.createElementNS(t,r),t[io]=e,t[Ph]=n,WF(t,e,!1,!1),e.stateNode=t;e:{switch(o=iw(r,n),r){case"dialog":Ar("cancel",t),Ar("close",t),s=n;break;case"iframe":case"object":case"embed":Ar("load",t),s=n;break;case"video":case"audio":for(s=0;s<Yd.length;s++)Ar(Yd[s],t);s=n;break;case"source":Ar("error",t),s=n;break;case"img":case"image":case"link":Ar("error",t),Ar("load",t),s=n;break;case"details":Ar("toggle",t),s=n;break;case"input":vP(t,n),s=Zv(t,n),Ar("invalid",t);break;case"option":s=n;break;case"select":t._wrapperState={wasMultiple:!!n.multiple},s=Vr({},n,{value:void 0}),Ar("invalid",t);break;case"textarea":xP(t,n),s=rw(t,n),Ar("invalid",t);break;default:s=n}sw(r,s),a=s;for(i in a)if(a.hasOwnProperty(i)){var l=a[i];i==="style"?bI(t,l):i==="dangerouslySetInnerHTML"?(l=l?l.__html:void 0,l!=null&&wI(t,l)):i==="children"?typeof l=="string"?(r!=="textarea"||l!=="")&&vh(t,l):typeof l=="number"&&vh(t,""+l):i!=="suppressContentEditableWarning"&&i!=="suppressHydrationWarning"&&i!=="autoFocus"&&(yh.hasOwnProperty(i)?l!=null&&i==="onScroll"&&Ar("scroll",t):l!=null&&r1(t,i,l,o))}switch(r){case"input":op(t),wP(t,n,!1);break;case"textarea":op(t),bP(t);break;case"option":n.value!=null&&t.setAttribute("value",""+Fa(n.value));break;case"select":t.multiple=!!n.multiple,i=n.value,i!=null?qc(t,!!n.multiple,i,!1):n.defaultValue!=null&&qc(t,!!n.multiple,n.defaultValue,!0);break;default:typeof s.onClick=="function"&&(t.onclick=Qm)}switch(r){case"button":case"input":case"select":case"textarea":n=!!n.autoFocus;break e;case"img":n=!0;break e;default:n=!1}}n&&(e.flags|=4)}e.ref!==null&&(e.flags|=512,e.flags|=2097152)}return Bn(e),null;case 6:if(t&&e.stateNode!=null)GF(t,e,t.memoizedProps,n);else{if(typeof n!="string"&&e.stateNode===null)throw Error(Ye(166));if(r=Ol(Ah.current),Ol(ho.current),mp(e)){if(n=e.stateNode,r=e.memoizedProps,n[io]=e,(i=n.nodeValue!==r)&&(t=Ds,t!==null))switch(t.tag){case 3:pp(n.nodeValue,r,(t.mode&1)!==0);break;case 5:t.memoizedProps.suppressHydrationWarning!==!0&&pp(n.nodeValue,r,(t.mode&1)!==0)}i&&(e.flags|=4)}else n=(r.nodeType===9?r:r.ownerDocument).createTextNode(n),n[io]=e,e.stateNode=n}return Bn(e),null;case 13:if($r(zr),n=e.memoizedState,t===null||t.memoizedState!==null&&t.memoizedState.dehydrated!==null){if(Dr&&Os!==null&&e.mode&1&&!(e.flags&128))cF(),xu(),e.flags|=98560,i=!1;else if(i=mp(e),n!==null&&n.dehydrated!==null){if(t===null){if(!i)throw Error(Ye(318));if(i=e.memoizedState,i=i!==null?i.dehydrated:null,!i)throw Error(Ye(317));i[io]=e}else xu(),!(e.flags&128)&&(e.memoizedState=null),e.flags|=4;Bn(e),i=!1}else Pi!==null&&(Nw(Pi),Pi=null),i=!0;if(!i)return e.flags&65536?e:null}return e.flags&128?(e.lanes=r,e):(n=n!==null,n!==(t!==null&&t.memoizedState!==null)&&n&&(e.child.flags|=8192,e.mode&1&&(t===null||zr.current&1?vn===0&&(vn=3):j1())),e.updateQueue!==null&&(e.flags|=4),Bn(e),null);case 4:return Mu(),$w(t,e),t===null&&Sh(e.stateNode.containerInfo),Bn(e),null;case 10:return x1(e.type._context),Bn(e),null;case 17:return fs(e.type)&&Jm(),Bn(e),null;case 19:if($r(zr),i=e.memoizedState,i===null)return Bn(e),null;if(n=(e.flags&128)!==0,o=i.rendering,o===null)if(n)$d(i,!1);else{if(vn!==0||t!==null&&t.flags&128)for(t=e.child;t!==null;){if(o=ig(t),o!==null){for(e.flags|=128,$d(i,!1),n=o.updateQueue,n!==null&&(e.updateQueue=n,e.flags|=4),e.subtreeFlags=0,n=r,r=e.child;r!==null;)i=r,t=n,i.flags&=14680066,o=i.alternate,o===null?(i.childLanes=0,i.lanes=t,i.child=null,i.subtreeFlags=0,i.memoizedProps=null,i.memoizedState=null,i.updateQueue=null,i.dependencies=null,i.stateNode=null):(i.childLanes=o.childLanes,i.lanes=o.lanes,i.child=o.child,i.subtreeFlags=0,i.deletions=null,i.memoizedProps=o.memoizedProps,i.memoizedState=o.memoizedState,i.updateQueue=o.updateQueue,i.type=o.type,t=o.dependencies,i.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext}),r=r.sibling;return Pr(zr,zr.current&1|2),e.child}t=t.sibling}i.tail!==null&&rn()>Cu&&(e.flags|=128,n=!0,$d(i,!1),e.lanes=4194304)}else{if(!n)if(t=ig(o),t!==null){if(e.flags|=128,n=!0,r=t.updateQueue,r!==null&&(e.updateQueue=r,e.flags|=4),$d(i,!0),i.tail===null&&i.tailMode==="hidden"&&!o.alternate&&!Dr)return Bn(e),null}else 2*rn()-i.renderingStartTime>Cu&&r!==1073741824&&(e.flags|=128,n=!0,$d(i,!1),e.lanes=4194304);i.isBackwards?(o.sibling=e.child,e.child=o):(r=i.last,r!==null?r.sibling=o:e.child=o,i.last=o)}return i.tail!==null?(e=i.tail,i.rendering=e,i.tail=e.sibling,i.renderingStartTime=rn(),e.sibling=null,r=zr.current,Pr(zr,n?r&1|2:r&1),e):(Bn(e),null);case 22:case 23:return R1(),n=e.memoizedState!==null,t!==null&&t.memoizedState!==null!==n&&(e.flags|=8192),n&&e.mode&1?ks&1073741824&&(Bn(e),e.subtreeFlags&6&&(e.flags|=8192)):Bn(e),null;case 24:return null;case 25:return null}throw Error(Ye(156,e.tag))}function s5(t,e){switch(_1(e),e.tag){case 1:return fs(e.type)&&Jm(),t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 3:return Mu(),$r(hs),$r(Hn),S1(),t=e.flags,t&65536&&!(t&128)?(e.flags=t&-65537|128,e):null;case 5:return C1(e),null;case 13:if($r(zr),t=e.memoizedState,t!==null&&t.dehydrated!==null){if(e.alternate===null)throw Error(Ye(340));xu()}return t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 19:return $r(zr),null;case 4:return Mu(),null;case 10:return x1(e.type._context),null;case 22:case 23:return R1(),null;case 24:return null;default:return null}}var yp=!1,Un=!1,i5=typeof WeakSet=="function"?WeakSet:Set,pt=null;function Vc(t,e){var r=t.ref;if(r!==null)if(typeof r=="function")try{r(null)}catch(n){Yr(t,e,n)}else r.current=null}function Ow(t,e,r){try{r()}catch(n){Yr(t,e,n)}}var d2=!1;function o5(t,e){if(mw=Xm,t=YI(),m1(t)){if("selectionStart"in t)var r={start:t.selectionStart,end:t.selectionEnd};else e:{r=(r=t.ownerDocument)&&r.defaultView||window;var n=r.getSelection&&r.getSelection();if(n&&n.rangeCount!==0){r=n.anchorNode;var s=n.anchorOffset,i=n.focusNode;n=n.focusOffset;try{r.nodeType,i.nodeType}catch{r=null;break e}var o=0,a=-1,l=-1,c=0,u=0,d=t,h=null;t:for(;;){for(var f;d!==r||s!==0&&d.nodeType!==3||(a=o+s),d!==i||n!==0&&d.nodeType!==3||(l=o+n),d.nodeType===3&&(o+=d.nodeValue.length),(f=d.firstChild)!==null;)h=d,d=f;for(;;){if(d===t)break t;if(h===r&&++c===s&&(a=o),h===i&&++u===n&&(l=o),(f=d.nextSibling)!==null)break;d=h,h=d.parentNode}d=f}r=a===-1||l===-1?null:{start:a,end:l}}else r=null}r=r||{start:0,end:0}}else r=null;for(gw={focusedElem:t,selectionRange:r},Xm=!1,pt=e;pt!==null;)if(e=pt,t=e.child,(e.subtreeFlags&1028)!==0&&t!==null)t.return=e,pt=t;else for(;pt!==null;){e=pt;try{var p=e.alternate;if(e.flags&1024)switch(e.tag){case 0:case 11:case 15:break;case 1:if(p!==null){var m=p.memoizedProps,y=p.memoizedState,g=e.stateNode,_=g.getSnapshotBeforeUpdate(e.elementType===e.type?m:Mi(e.type,m),y);g.__reactInternalSnapshotBeforeUpdate=_}break;case 3:var v=e.stateNode.containerInfo;v.nodeType===1?v.textContent="":v.nodeType===9&&v.documentElement&&v.removeChild(v.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(Ye(163))}}catch(w){Yr(e,e.return,w)}if(t=e.sibling,t!==null){t.return=e.return,pt=t;break}pt=e.return}return p=d2,d2=!1,p}function ch(t,e,r){var n=e.updateQueue;if(n=n!==null?n.lastEffect:null,n!==null){var s=n=n.next;do{if((s.tag&t)===t){var i=s.destroy;s.destroy=void 0,i!==void 0&&Ow(e,r,i)}s=s.next}while(s!==n)}}function Qg(t,e){if(e=e.updateQueue,e=e!==null?e.lastEffect:null,e!==null){var r=e=e.next;do{if((r.tag&t)===t){var n=r.create;r.destroy=n()}r=r.next}while(r!==e)}}function Dw(t){var e=t.ref;if(e!==null){var r=t.stateNode;switch(t.tag){case 5:t=r;break;default:t=r}typeof e=="function"?e(t):e.current=t}}function HF(t){var e=t.alternate;e!==null&&(t.alternate=null,HF(e)),t.child=null,t.deletions=null,t.sibling=null,t.tag===5&&(e=t.stateNode,e!==null&&(delete e[io],delete e[Ph],delete e[vw],delete e[VU],delete e[WU])),t.stateNode=null,t.return=null,t.dependencies=null,t.memoizedProps=null,t.memoizedState=null,t.pendingProps=null,t.stateNode=null,t.updateQueue=null}function KF(t){return t.tag===5||t.tag===3||t.tag===4}function h2(t){e:for(;;){for(;t.sibling===null;){if(t.return===null||KF(t.return))return null;t=t.return}for(t.sibling.return=t.return,t=t.sibling;t.tag!==5&&t.tag!==6&&t.tag!==18;){if(t.flags&2||t.child===null||t.tag===4)continue e;t.child.return=t,t=t.child}if(!(t.flags&2))return t.stateNode}}function Iw(t,e,r){var n=t.tag;if(n===5||n===6)t=t.stateNode,e?r.nodeType===8?r.parentNode.insertBefore(t,e):r.insertBefore(t,e):(r.nodeType===8?(e=r.parentNode,e.insertBefore(t,r)):(e=r,e.appendChild(t)),r=r._reactRootContainer,r!=null||e.onclick!==null||(e.onclick=Qm));else if(n!==4&&(t=t.child,t!==null))for(Iw(t,e,r),t=t.sibling;t!==null;)Iw(t,e,r),t=t.sibling}function Fw(t,e,r){var n=t.tag;if(n===5||n===6)t=t.stateNode,e?r.insertBefore(t,e):r.appendChild(t);else if(n!==4&&(t=t.child,t!==null))for(Fw(t,e,r),t=t.sibling;t!==null;)Fw(t,e,r),t=t.sibling}var On=null,Si=!1;function ia(t,e,r){for(r=r.child;r!==null;)XF(t,e,r),r=r.sibling}function XF(t,e,r){if(uo&&typeof uo.onCommitFiberUnmount=="function")try{uo.onCommitFiberUnmount(Wg,r)}catch{}switch(r.tag){case 5:Un||Vc(r,e);case 6:var n=On,s=Si;On=null,ia(t,e,r),On=n,Si=s,On!==null&&(Si?(t=On,r=r.stateNode,t.nodeType===8?t.parentNode.removeChild(r):t.removeChild(r)):On.removeChild(r.stateNode));break;case 18:On!==null&&(Si?(t=On,r=r.stateNode,t.nodeType===8?uy(t.parentNode,r):t.nodeType===1&&uy(t,r),Mh(t)):uy(On,r.stateNode));break;case 4:n=On,s=Si,On=r.stateNode.containerInfo,Si=!0,ia(t,e,r),On=n,Si=s;break;case 0:case 11:case 14:case 15:if(!Un&&(n=r.updateQueue,n!==null&&(n=n.lastEffect,n!==null))){s=n=n.next;do{var i=s,o=i.destroy;i=i.tag,o!==void 0&&(i&2||i&4)&&Ow(r,e,o),s=s.next}while(s!==n)}ia(t,e,r);break;case 1:if(!Un&&(Vc(r,e),n=r.stateNode,typeof n.componentWillUnmount=="function"))try{n.props=r.memoizedProps,n.state=r.memoizedState,n.componentWillUnmount()}catch(a){Yr(r,e,a)}ia(t,e,r);break;case 21:ia(t,e,r);break;case 22:r.mode&1?(Un=(n=Un)||r.memoizedState!==null,ia(t,e,r),Un=n):ia(t,e,r);break;default:ia(t,e,r)}}function f2(t){var e=t.updateQueue;if(e!==null){t.updateQueue=null;var r=t.stateNode;r===null&&(r=t.stateNode=new i5),e.forEach(function(n){var s=m5.bind(null,t,n);r.has(n)||(r.add(n),n.then(s,s))})}}function pi(t,e){var r=e.deletions;if(r!==null)for(var n=0;n<r.length;n++){var s=r[n];try{var i=t,o=e,a=o;e:for(;a!==null;){switch(a.tag){case 5:On=a.stateNode,Si=!1;break e;case 3:On=a.stateNode.containerInfo,Si=!0;break e;case 4:On=a.stateNode.containerInfo,Si=!0;break e}a=a.return}if(On===null)throw Error(Ye(160));XF(i,o,s),On=null,Si=!1;var l=s.alternate;l!==null&&(l.return=null),s.return=null}catch(c){Yr(s,e,c)}}if(e.subtreeFlags&12854)for(e=e.child;e!==null;)qF(e,t),e=e.sibling}function qF(t,e){var r=t.alternate,n=t.flags;switch(t.tag){case 0:case 11:case 14:case 15:if(pi(e,t),Ji(t),n&4){try{ch(3,t,t.return),Qg(3,t)}catch(m){Yr(t,t.return,m)}try{ch(5,t,t.return)}catch(m){Yr(t,t.return,m)}}break;case 1:pi(e,t),Ji(t),n&512&&r!==null&&Vc(r,r.return);break;case 5:if(pi(e,t),Ji(t),n&512&&r!==null&&Vc(r,r.return),t.flags&32){var s=t.stateNode;try{vh(s,"")}catch(m){Yr(t,t.return,m)}}if(n&4&&(s=t.stateNode,s!=null)){var i=t.memoizedProps,o=r!==null?r.memoizedProps:i,a=t.type,l=t.updateQueue;if(t.updateQueue=null,l!==null)try{a==="input"&&i.type==="radio"&&i.name!=null&&_I(s,i),iw(a,o);var c=iw(a,i);for(o=0;o<l.length;o+=2){var u=l[o],d=l[o+1];u==="style"?bI(s,d):u==="dangerouslySetInnerHTML"?wI(s,d):u==="children"?vh(s,d):r1(s,u,d,c)}switch(a){case"input":ew(s,i);break;case"textarea":yI(s,i);break;case"select":var h=s._wrapperState.wasMultiple;s._wrapperState.wasMultiple=!!i.multiple;var f=i.value;f!=null?qc(s,!!i.multiple,f,!1):h!==!!i.multiple&&(i.defaultValue!=null?qc(s,!!i.multiple,i.defaultValue,!0):qc(s,!!i.multiple,i.multiple?[]:"",!1))}s[Ph]=i}catch(m){Yr(t,t.return,m)}}break;case 6:if(pi(e,t),Ji(t),n&4){if(t.stateNode===null)throw Error(Ye(162));s=t.stateNode,i=t.memoizedProps;try{s.nodeValue=i}catch(m){Yr(t,t.return,m)}}break;case 3:if(pi(e,t),Ji(t),n&4&&r!==null&&r.memoizedState.isDehydrated)try{Mh(e.containerInfo)}catch(m){Yr(t,t.return,m)}break;case 4:pi(e,t),Ji(t);break;case 13:pi(e,t),Ji(t),s=t.child,s.flags&8192&&(i=s.memoizedState!==null,s.stateNode.isHidden=i,!i||s.alternate!==null&&s.alternate.memoizedState!==null||(F1=rn())),n&4&&f2(t);break;case 22:if(u=r!==null&&r.memoizedState!==null,t.mode&1?(Un=(c=Un)||u,pi(e,t),Un=c):pi(e,t),Ji(t),n&8192){if(c=t.memoizedState!==null,(t.stateNode.isHidden=c)&&!u&&t.mode&1)for(pt=t,u=t.child;u!==null;){for(d=pt=u;pt!==null;){switch(h=pt,f=h.child,h.tag){case 0:case 11:case 14:case 15:ch(4,h,h.return);break;case 1:Vc(h,h.return);var p=h.stateNode;if(typeof p.componentWillUnmount=="function"){n=h,r=h.return;try{e=n,p.props=e.memoizedProps,p.state=e.memoizedState,p.componentWillUnmount()}catch(m){Yr(n,r,m)}}break;case 5:Vc(h,h.return);break;case 22:if(h.memoizedState!==null){m2(d);continue}}f!==null?(f.return=h,pt=f):m2(d)}u=u.sibling}e:for(u=null,d=t;;){if(d.tag===5){if(u===null){u=d;try{s=d.stateNode,c?(i=s.style,typeof i.setProperty=="function"?i.setProperty("display","none","important"):i.display="none"):(a=d.stateNode,l=d.memoizedProps.style,o=l!=null&&l.hasOwnProperty("display")?l.display:null,a.style.display=xI("display",o))}catch(m){Yr(t,t.return,m)}}}else if(d.tag===6){if(u===null)try{d.stateNode.nodeValue=c?"":d.memoizedProps}catch(m){Yr(t,t.return,m)}}else if((d.tag!==22&&d.tag!==23||d.memoizedState===null||d===t)&&d.child!==null){d.child.return=d,d=d.child;continue}if(d===t)break e;for(;d.sibling===null;){if(d.return===null||d.return===t)break e;u===d&&(u=null),d=d.return}u===d&&(u=null),d.sibling.return=d.return,d=d.sibling}}break;case 19:pi(e,t),Ji(t),n&4&&f2(t);break;case 21:break;default:pi(e,t),Ji(t)}}function Ji(t){var e=t.flags;if(e&2){try{e:{for(var r=t.return;r!==null;){if(KF(r)){var n=r;break e}r=r.return}throw Error(Ye(160))}switch(n.tag){case 5:var s=n.stateNode;n.flags&32&&(vh(s,""),n.flags&=-33);var i=h2(t);Fw(t,i,s);break;case 3:case 4:var o=n.stateNode.containerInfo,a=h2(t);Iw(t,a,o);break;default:throw Error(Ye(161))}}catch(l){Yr(t,t.return,l)}t.flags&=-3}e&4096&&(t.flags&=-4097)}function a5(t,e,r){pt=t,YF(t)}function YF(t,e,r){for(var n=(t.mode&1)!==0;pt!==null;){var s=pt,i=s.child;if(s.tag===22&&n){var o=s.memoizedState!==null||yp;if(!o){var a=s.alternate,l=a!==null&&a.memoizedState!==null||Un;a=yp;var c=Un;if(yp=o,(Un=l)&&!c)for(pt=s;pt!==null;)o=pt,l=o.child,o.tag===22&&o.memoizedState!==null?g2(s):l!==null?(l.return=o,pt=l):g2(s);for(;i!==null;)pt=i,YF(i),i=i.sibling;pt=s,yp=a,Un=c}p2(t)}else s.subtreeFlags&8772&&i!==null?(i.return=s,pt=i):p2(t)}}function p2(t){for(;pt!==null;){var e=pt;if(e.flags&8772){var r=e.alternate;try{if(e.flags&8772)switch(e.tag){case 0:case 11:case 15:Un||Qg(5,e);break;case 1:var n=e.stateNode;if(e.flags&4&&!Un)if(r===null)n.componentDidMount();else{var s=e.elementType===e.type?r.memoizedProps:Mi(e.type,r.memoizedProps);n.componentDidUpdate(s,r.memoizedState,n.__reactInternalSnapshotBeforeUpdate)}var i=e.updateQueue;i!==null&&JP(e,i,n);break;case 3:var o=e.updateQueue;if(o!==null){if(r=null,e.child!==null)switch(e.child.tag){case 5:r=e.child.stateNode;break;case 1:r=e.child.stateNode}JP(e,o,r)}break;case 5:var a=e.stateNode;if(r===null&&e.flags&4){r=a;var l=e.memoizedProps;switch(e.type){case"button":case"input":case"select":case"textarea":l.autoFocus&&r.focus();break;case"img":l.src&&(r.src=l.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(e.memoizedState===null){var c=e.alternate;if(c!==null){var u=c.memoizedState;if(u!==null){var d=u.dehydrated;d!==null&&Mh(d)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(Ye(163))}Un||e.flags&512&&Dw(e)}catch(h){Yr(e,e.return,h)}}if(e===t){pt=null;break}if(r=e.sibling,r!==null){r.return=e.return,pt=r;break}pt=e.return}}function m2(t){for(;pt!==null;){var e=pt;if(e===t){pt=null;break}var r=e.sibling;if(r!==null){r.return=e.return,pt=r;break}pt=e.return}}function g2(t){for(;pt!==null;){var e=pt;try{switch(e.tag){case 0:case 11:case 15:var r=e.return;try{Qg(4,e)}catch(l){Yr(e,r,l)}break;case 1:var n=e.stateNode;if(typeof n.componentDidMount=="function"){var s=e.return;try{n.componentDidMount()}catch(l){Yr(e,s,l)}}var i=e.return;try{Dw(e)}catch(l){Yr(e,i,l)}break;case 5:var o=e.return;try{Dw(e)}catch(l){Yr(e,o,l)}}}catch(l){Yr(e,e.return,l)}if(e===t){pt=null;break}var a=e.sibling;if(a!==null){a.return=e.return,pt=a;break}pt=e.return}}var l5=Math.ceil,lg=Go.ReactCurrentDispatcher,D1=Go.ReactCurrentOwner,ri=Go.ReactCurrentBatchConfig,ir=0,Pn=null,hn=null,Fn=0,ks=0,Wc=Ga(0),vn=0,Ih=null,Kl=0,Jg=0,I1=0,uh=null,us=null,F1=0,Cu=1/0,Mo=null,cg=!1,Lw=null,Oa=null,vp=!1,Ca=null,ug=0,dh=0,Rw=null,Sm=-1,Em=0;function ts(){return ir&6?rn():Sm!==-1?Sm:Sm=rn()}function Da(t){return t.mode&1?ir&2&&Fn!==0?Fn&-Fn:GU.transition!==null?(Em===0&&(Em=II()),Em):(t=yr,t!==0||(t=window.event,t=t===void 0?16:BI(t.type)),t):1}function Fi(t,e,r,n){if(50<dh)throw dh=0,Rw=null,Error(Ye(185));Jh(t,r,n),(!(ir&2)||t!==Pn)&&(t===Pn&&(!(ir&2)&&(Jg|=r),vn===4&&ya(t,Fn)),ps(t,n),r===1&&ir===0&&!(e.mode&1)&&(Cu=rn()+500,Xg&&Ha()))}function ps(t,e){var r=t.callbackNode;GW(t,e);var n=Km(t,t===Pn?Fn:0);if(n===0)r!==null&&CP(r),t.callbackNode=null,t.callbackPriority=0;else if(e=n&-n,t.callbackPriority!==e){if(r!=null&&CP(r),e===1)t.tag===0?UU(_2.bind(null,t)):oF(_2.bind(null,t)),zU(function(){!(ir&6)&&Ha()}),r=null;else{switch(FI(n)){case 1:r=a1;break;case 4:r=OI;break;case 16:r=Hm;break;case 536870912:r=DI;break;default:r=Hm}r=sL(r,QF.bind(null,t))}t.callbackPriority=e,t.callbackNode=r}}function QF(t,e){if(Sm=-1,Em=0,ir&6)throw Error(Ye(327));var r=t.callbackNode;if(eu()&&t.callbackNode!==r)return null;var n=Km(t,t===Pn?Fn:0);if(n===0)return null;if(n&30||n&t.expiredLanes||e)e=dg(t,n);else{e=n;var s=ir;ir|=2;var i=ZF();(Pn!==t||Fn!==e)&&(Mo=null,Cu=rn()+500,Bl(t,e));do try{d5();break}catch(a){JF(t,a)}while(!0);w1(),lg.current=i,ir=s,hn!==null?e=0:(Pn=null,Fn=0,e=vn)}if(e!==0){if(e===2&&(s=uw(t),s!==0&&(n=s,e=jw(t,s))),e===1)throw r=Ih,Bl(t,0),ya(t,n),ps(t,rn()),r;if(e===6)ya(t,n);else{if(s=t.current.alternate,!(n&30)&&!c5(s)&&(e=dg(t,n),e===2&&(i=uw(t),i!==0&&(n=i,e=jw(t,i))),e===1))throw r=Ih,Bl(t,0),ya(t,n),ps(t,rn()),r;switch(t.finishedWork=s,t.finishedLanes=n,e){case 0:case 1:throw Error(Ye(345));case 2:Ml(t,us,Mo);break;case 3:if(ya(t,n),(n&130023424)===n&&(e=F1+500-rn(),10<e)){if(Km(t,0)!==0)break;if(s=t.suspendedLanes,(s&n)!==n){ts(),t.pingedLanes|=t.suspendedLanes&s;break}t.timeoutHandle=yw(Ml.bind(null,t,us,Mo),e);break}Ml(t,us,Mo);break;case 4:if(ya(t,n),(n&4194240)===n)break;for(e=t.eventTimes,s=-1;0<n;){var o=31-Ii(n);i=1<<o,o=e[o],o>s&&(s=o),n&=~i}if(n=s,n=rn()-n,n=(120>n?120:480>n?480:1080>n?1080:1920>n?1920:3e3>n?3e3:4320>n?4320:1960*l5(n/1960))-n,10<n){t.timeoutHandle=yw(Ml.bind(null,t,us,Mo),n);break}Ml(t,us,Mo);break;case 5:Ml(t,us,Mo);break;default:throw Error(Ye(329))}}}return ps(t,rn()),t.callbackNode===r?QF.bind(null,t):null}function jw(t,e){var r=uh;return t.current.memoizedState.isDehydrated&&(Bl(t,e).flags|=256),t=dg(t,e),t!==2&&(e=us,us=r,e!==null&&Nw(e)),t}function Nw(t){us===null?us=t:us.push.apply(us,t)}function c5(t){for(var e=t;;){if(e.flags&16384){var r=e.updateQueue;if(r!==null&&(r=r.stores,r!==null))for(var n=0;n<r.length;n++){var s=r[n],i=s.getSnapshot;s=s.value;try{if(!ji(i(),s))return!1}catch{return!1}}}if(r=e.child,e.subtreeFlags&16384&&r!==null)r.return=e,e=r;else{if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return!0;e=e.return}e.sibling.return=e.return,e=e.sibling}}return!0}function ya(t,e){for(e&=~I1,e&=~Jg,t.suspendedLanes|=e,t.pingedLanes&=~e,t=t.expirationTimes;0<e;){var r=31-Ii(e),n=1<<r;t[r]=-1,e&=~n}}function _2(t){if(ir&6)throw Error(Ye(327));eu();var e=Km(t,0);if(!(e&1))return ps(t,rn()),null;var r=dg(t,e);if(t.tag!==0&&r===2){var n=uw(t);n!==0&&(e=n,r=jw(t,n))}if(r===1)throw r=Ih,Bl(t,0),ya(t,e),ps(t,rn()),r;if(r===6)throw Error(Ye(345));return t.finishedWork=t.current.alternate,t.finishedLanes=e,Ml(t,us,Mo),ps(t,rn()),null}function L1(t,e){var r=ir;ir|=1;try{return t(e)}finally{ir=r,ir===0&&(Cu=rn()+500,Xg&&Ha())}}function Xl(t){Ca!==null&&Ca.tag===0&&!(ir&6)&&eu();var e=ir;ir|=1;var r=ri.transition,n=yr;try{if(ri.transition=null,yr=1,t)return t()}finally{yr=n,ri.transition=r,ir=e,!(ir&6)&&Ha()}}function R1(){ks=Wc.current,$r(Wc)}function Bl(t,e){t.finishedWork=null,t.finishedLanes=0;var r=t.timeoutHandle;if(r!==-1&&(t.timeoutHandle=-1,NU(r)),hn!==null)for(r=hn.return;r!==null;){var n=r;switch(_1(n),n.tag){case 1:n=n.type.childContextTypes,n!=null&&Jm();break;case 3:Mu(),$r(hs),$r(Hn),S1();break;case 5:C1(n);break;case 4:Mu();break;case 13:$r(zr);break;case 19:$r(zr);break;case 10:x1(n.type._context);break;case 22:case 23:R1()}r=r.return}if(Pn=t,hn=t=Ia(t.current,null),Fn=ks=e,vn=0,Ih=null,I1=Jg=Kl=0,us=uh=null,$l!==null){for(e=0;e<$l.length;e++)if(r=$l[e],n=r.interleaved,n!==null){r.interleaved=null;var s=n.next,i=r.pending;if(i!==null){var o=i.next;i.next=s,n.next=o}r.pending=n}$l=null}return t}function JF(t,e){do{var r=hn;try{if(w1(),Mm.current=ag,og){for(var n=Br.memoizedState;n!==null;){var s=n.queue;s!==null&&(s.pending=null),n=n.next}og=!1}if(Hl=0,En=yn=Br=null,lh=!1,$h=0,D1.current=null,r===null||r.return===null){vn=1,Ih=e,hn=null;break}e:{var i=t,o=r.return,a=r,l=e;if(e=Fn,a.flags|=32768,l!==null&&typeof l=="object"&&typeof l.then=="function"){var c=l,u=a,d=u.tag;if(!(u.mode&1)&&(d===0||d===11||d===15)){var h=u.alternate;h?(u.updateQueue=h.updateQueue,u.memoizedState=h.memoizedState,u.lanes=h.lanes):(u.updateQueue=null,u.memoizedState=null)}var f=s2(o);if(f!==null){f.flags&=-257,i2(f,o,a,i,e),f.mode&1&&n2(i,c,e),e=f,l=c;var p=e.updateQueue;if(p===null){var m=new Set;m.add(l),e.updateQueue=m}else p.add(l);break e}else{if(!(e&1)){n2(i,c,e),j1();break e}l=Error(Ye(426))}}else if(Dr&&a.mode&1){var y=s2(o);if(y!==null){!(y.flags&65536)&&(y.flags|=256),i2(y,o,a,i,e),y1(Tu(l,a));break e}}i=l=Tu(l,a),vn!==4&&(vn=2),uh===null?uh=[i]:uh.push(i),i=o;do{switch(i.tag){case 3:i.flags|=65536,e&=-e,i.lanes|=e;var g=FF(i,l,e);QP(i,g);break e;case 1:a=l;var _=i.type,v=i.stateNode;if(!(i.flags&128)&&(typeof _.getDerivedStateFromError=="function"||v!==null&&typeof v.componentDidCatch=="function"&&(Oa===null||!Oa.has(v)))){i.flags|=65536,e&=-e,i.lanes|=e;var w=LF(i,a,e);QP(i,w);break e}}i=i.return}while(i!==null)}tL(r)}catch(x){e=x,hn===r&&r!==null&&(hn=r=r.return);continue}break}while(!0)}function ZF(){var t=lg.current;return lg.current=ag,t===null?ag:t}function j1(){(vn===0||vn===3||vn===2)&&(vn=4),Pn===null||!(Kl&268435455)&&!(Jg&268435455)||ya(Pn,Fn)}function dg(t,e){var r=ir;ir|=2;var n=ZF();(Pn!==t||Fn!==e)&&(Mo=null,Bl(t,e));do try{u5();break}catch(s){JF(t,s)}while(!0);if(w1(),ir=r,lg.current=n,hn!==null)throw Error(Ye(261));return Pn=null,Fn=0,vn}function u5(){for(;hn!==null;)eL(hn)}function d5(){for(;hn!==null&&!LW();)eL(hn)}function eL(t){var e=nL(t.alternate,t,ks);t.memoizedProps=t.pendingProps,e===null?tL(t):hn=e,D1.current=null}function tL(t){var e=t;do{var r=e.alternate;if(t=e.return,e.flags&32768){if(r=s5(r,e),r!==null){r.flags&=32767,hn=r;return}if(t!==null)t.flags|=32768,t.subtreeFlags=0,t.deletions=null;else{vn=6,hn=null;return}}else if(r=n5(r,e,ks),r!==null){hn=r;return}if(e=e.sibling,e!==null){hn=e;return}hn=e=t}while(e!==null);vn===0&&(vn=5)}function Ml(t,e,r){var n=yr,s=ri.transition;try{ri.transition=null,yr=1,h5(t,e,r,n)}finally{ri.transition=s,yr=n}return null}function h5(t,e,r,n){do eu();while(Ca!==null);if(ir&6)throw Error(Ye(327));r=t.finishedWork;var s=t.finishedLanes;if(r===null)return null;if(t.finishedWork=null,t.finishedLanes=0,r===t.current)throw Error(Ye(177));t.callbackNode=null,t.callbackPriority=0;var i=r.lanes|r.childLanes;if(HW(t,i),t===Pn&&(hn=Pn=null,Fn=0),!(r.subtreeFlags&2064)&&!(r.flags&2064)||vp||(vp=!0,sL(Hm,function(){return eu(),null})),i=(r.flags&15990)!==0,r.subtreeFlags&15990||i){i=ri.transition,ri.transition=null;var o=yr;yr=1;var a=ir;ir|=4,D1.current=null,o5(t,r),qF(r,t),OU(gw),Xm=!!mw,gw=mw=null,t.current=r,a5(r),RW(),ir=a,yr=o,ri.transition=i}else t.current=r;if(vp&&(vp=!1,Ca=t,ug=s),i=t.pendingLanes,i===0&&(Oa=null),zW(r.stateNode),ps(t,rn()),e!==null)for(n=t.onRecoverableError,r=0;r<e.length;r++)s=e[r],n(s.value,{componentStack:s.stack,digest:s.digest});if(cg)throw cg=!1,t=Lw,Lw=null,t;return ug&1&&t.tag!==0&&eu(),i=t.pendingLanes,i&1?t===Rw?dh++:(dh=0,Rw=t):dh=0,Ha(),null}function eu(){if(Ca!==null){var t=FI(ug),e=ri.transition,r=yr;try{if(ri.transition=null,yr=16>t?16:t,Ca===null)var n=!1;else{if(t=Ca,Ca=null,ug=0,ir&6)throw Error(Ye(331));var s=ir;for(ir|=4,pt=t.current;pt!==null;){var i=pt,o=i.child;if(pt.flags&16){var a=i.deletions;if(a!==null){for(var l=0;l<a.length;l++){var c=a[l];for(pt=c;pt!==null;){var u=pt;switch(u.tag){case 0:case 11:case 15:ch(8,u,i)}var d=u.child;if(d!==null)d.return=u,pt=d;else for(;pt!==null;){u=pt;var h=u.sibling,f=u.return;if(HF(u),u===c){pt=null;break}if(h!==null){h.return=f,pt=h;break}pt=f}}}var p=i.alternate;if(p!==null){var m=p.child;if(m!==null){p.child=null;do{var y=m.sibling;m.sibling=null,m=y}while(m!==null)}}pt=i}}if(i.subtreeFlags&2064&&o!==null)o.return=i,pt=o;else e:for(;pt!==null;){if(i=pt,i.flags&2048)switch(i.tag){case 0:case 11:case 15:ch(9,i,i.return)}var g=i.sibling;if(g!==null){g.return=i.return,pt=g;break e}pt=i.return}}var _=t.current;for(pt=_;pt!==null;){o=pt;var v=o.child;if(o.subtreeFlags&2064&&v!==null)v.return=o,pt=v;else e:for(o=_;pt!==null;){if(a=pt,a.flags&2048)try{switch(a.tag){case 0:case 11:case 15:Qg(9,a)}}catch(x){Yr(a,a.return,x)}if(a===o){pt=null;break e}var w=a.sibling;if(w!==null){w.return=a.return,pt=w;break e}pt=a.return}}if(ir=s,Ha(),uo&&typeof uo.onPostCommitFiberRoot=="function")try{uo.onPostCommitFiberRoot(Wg,t)}catch{}n=!0}return n}finally{yr=r,ri.transition=e}}return!1}function y2(t,e,r){e=Tu(r,e),e=FF(t,e,1),t=$a(t,e,1),e=ts(),t!==null&&(Jh(t,1,e),ps(t,e))}function Yr(t,e,r){if(t.tag===3)y2(t,t,r);else for(;e!==null;){if(e.tag===3){y2(e,t,r);break}else if(e.tag===1){var n=e.stateNode;if(typeof e.type.getDerivedStateFromError=="function"||typeof n.componentDidCatch=="function"&&(Oa===null||!Oa.has(n))){t=Tu(r,t),t=LF(e,t,1),e=$a(e,t,1),t=ts(),e!==null&&(Jh(e,1,t),ps(e,t));break}}e=e.return}}function f5(t,e,r){var n=t.pingCache;n!==null&&n.delete(e),e=ts(),t.pingedLanes|=t.suspendedLanes&r,Pn===t&&(Fn&r)===r&&(vn===4||vn===3&&(Fn&130023424)===Fn&&500>rn()-F1?Bl(t,0):I1|=r),ps(t,e)}function rL(t,e){e===0&&(t.mode&1?(e=cp,cp<<=1,!(cp&130023424)&&(cp=4194304)):e=1);var r=ts();t=Ro(t,e),t!==null&&(Jh(t,e,r),ps(t,r))}function p5(t){var e=t.memoizedState,r=0;e!==null&&(r=e.retryLane),rL(t,r)}function m5(t,e){var r=0;switch(t.tag){case 13:var n=t.stateNode,s=t.memoizedState;s!==null&&(r=s.retryLane);break;case 19:n=t.stateNode;break;default:throw Error(Ye(314))}n!==null&&n.delete(e),rL(t,r)}var nL;nL=function(t,e,r){if(t!==null)if(t.memoizedProps!==e.pendingProps||hs.current)ds=!0;else{if(!(t.lanes&r)&&!(e.flags&128))return ds=!1,r5(t,e,r);ds=!!(t.flags&131072)}else ds=!1,Dr&&e.flags&1048576&&aF(e,tg,e.index);switch(e.lanes=0,e.tag){case 2:var n=e.type;Cm(t,e),t=e.pendingProps;var s=wu(e,Hn.current);Zc(e,r),s=P1(null,e,n,t,s,r);var i=k1();return e.flags|=1,typeof s=="object"&&s!==null&&typeof s.render=="function"&&s.$$typeof===void 0?(e.tag=1,e.memoizedState=null,e.updateQueue=null,fs(n)?(i=!0,Zm(e)):i=!1,e.memoizedState=s.state!==null&&s.state!==void 0?s.state:null,M1(e),s.updater=Yg,e.stateNode=s,s._reactInternals=e,Cw(e,n,t,r),e=Pw(null,e,n,!0,i,r)):(e.tag=0,Dr&&i&&g1(e),Jn(null,e,s,r),e=e.child),e;case 16:n=e.elementType;e:{switch(Cm(t,e),t=e.pendingProps,s=n._init,n=s(n._payload),e.type=n,s=e.tag=_5(n),t=Mi(n,t),s){case 0:e=Ew(null,e,n,t,r);break e;case 1:e=l2(null,e,n,t,r);break e;case 11:e=o2(null,e,n,t,r);break e;case 14:e=a2(null,e,n,Mi(n.type,t),r);break e}throw Error(Ye(306,n,""))}return e;case 0:return n=e.type,s=e.pendingProps,s=e.elementType===n?s:Mi(n,s),Ew(t,e,n,s,r);case 1:return n=e.type,s=e.pendingProps,s=e.elementType===n?s:Mi(n,s),l2(t,e,n,s,r);case 3:e:{if(zF(e),t===null)throw Error(Ye(387));n=e.pendingProps,i=e.memoizedState,s=i.element,fF(t,e),sg(e,n,null,r);var o=e.memoizedState;if(n=o.element,i.isDehydrated)if(i={element:n,isDehydrated:!1,cache:o.cache,pendingSuspenseBoundaries:o.pendingSuspenseBoundaries,transitions:o.transitions},e.updateQueue.baseState=i,e.memoizedState=i,e.flags&256){s=Tu(Error(Ye(423)),e),e=c2(t,e,n,r,s);break e}else if(n!==s){s=Tu(Error(Ye(424)),e),e=c2(t,e,n,r,s);break e}else for(Os=Aa(e.stateNode.containerInfo.firstChild),Ds=e,Dr=!0,Pi=null,r=dF(e,null,n,r),e.child=r;r;)r.flags=r.flags&-3|4096,r=r.sibling;else{if(xu(),n===s){e=jo(t,e,r);break e}Jn(t,e,n,r)}e=e.child}return e;case 5:return pF(e),t===null&&bw(e),n=e.type,s=e.pendingProps,i=t!==null?t.memoizedProps:null,o=s.children,_w(n,s)?o=null:i!==null&&_w(n,i)&&(e.flags|=32),NF(t,e),Jn(t,e,o,r),e.child;case 6:return t===null&&bw(e),null;case 13:return BF(t,e,r);case 4:return T1(e,e.stateNode.containerInfo),n=e.pendingProps,t===null?e.child=bu(e,null,n,r):Jn(t,e,n,r),e.child;case 11:return n=e.type,s=e.pendingProps,s=e.elementType===n?s:Mi(n,s),o2(t,e,n,s,r);case 7:return Jn(t,e,e.pendingProps,r),e.child;case 8:return Jn(t,e,e.pendingProps.children,r),e.child;case 12:return Jn(t,e,e.pendingProps.children,r),e.child;case 10:e:{if(n=e.type._context,s=e.pendingProps,i=e.memoizedProps,o=s.value,Pr(rg,n._currentValue),n._currentValue=o,i!==null)if(ji(i.value,o)){if(i.children===s.children&&!hs.current){e=jo(t,e,r);break e}}else for(i=e.child,i!==null&&(i.return=e);i!==null;){var a=i.dependencies;if(a!==null){o=i.child;for(var l=a.firstContext;l!==null;){if(l.context===n){if(i.tag===1){l=Oo(-1,r&-r),l.tag=2;var c=i.updateQueue;if(c!==null){c=c.shared;var u=c.pending;u===null?l.next=l:(l.next=u.next,u.next=l),c.pending=l}}i.lanes|=r,l=i.alternate,l!==null&&(l.lanes|=r),Mw(i.return,r,e),a.lanes|=r;break}l=l.next}}else if(i.tag===10)o=i.type===e.type?null:i.child;else if(i.tag===18){if(o=i.return,o===null)throw Error(Ye(341));o.lanes|=r,a=o.alternate,a!==null&&(a.lanes|=r),Mw(o,r,e),o=i.sibling}else o=i.child;if(o!==null)o.return=i;else for(o=i;o!==null;){if(o===e){o=null;break}if(i=o.sibling,i!==null){i.return=o.return,o=i;break}o=o.return}i=o}Jn(t,e,s.children,r),e=e.child}return e;case 9:return s=e.type,n=e.pendingProps.children,Zc(e,r),s=si(s),n=n(s),e.flags|=1,Jn(t,e,n,r),e.child;case 14:return n=e.type,s=Mi(n,e.pendingProps),s=Mi(n.type,s),a2(t,e,n,s,r);case 15:return RF(t,e,e.type,e.pendingProps,r);case 17:return n=e.type,s=e.pendingProps,s=e.elementType===n?s:Mi(n,s),Cm(t,e),e.tag=1,fs(n)?(t=!0,Zm(e)):t=!1,Zc(e,r),IF(e,n,s),Cw(e,n,s,r),Pw(null,e,n,!0,t,r);case 19:return VF(t,e,r);case 22:return jF(t,e,r)}throw Error(Ye(156,e.tag))};function sL(t,e){return $I(t,e)}function g5(t,e,r,n){this.tag=t,this.key=r,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=e,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=n,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function ti(t,e,r,n){return new g5(t,e,r,n)}function N1(t){return t=t.prototype,!(!t||!t.isReactComponent)}function _5(t){if(typeof t=="function")return N1(t)?1:0;if(t!=null){if(t=t.$$typeof,t===s1)return 11;if(t===i1)return 14}return 2}function Ia(t,e){var r=t.alternate;return r===null?(r=ti(t.tag,e,t.key,t.mode),r.elementType=t.elementType,r.type=t.type,r.stateNode=t.stateNode,r.alternate=t,t.alternate=r):(r.pendingProps=e,r.type=t.type,r.flags=0,r.subtreeFlags=0,r.deletions=null),r.flags=t.flags&14680064,r.childLanes=t.childLanes,r.lanes=t.lanes,r.child=t.child,r.memoizedProps=t.memoizedProps,r.memoizedState=t.memoizedState,r.updateQueue=t.updateQueue,e=t.dependencies,r.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext},r.sibling=t.sibling,r.index=t.index,r.ref=t.ref,r}function Pm(t,e,r,n,s,i){var o=2;if(n=t,typeof t=="function")N1(t)&&(o=1);else if(typeof t=="string")o=5;else e:switch(t){case Dc:return Vl(r.children,s,i,e);case n1:o=8,s|=8;break;case qv:return t=ti(12,r,e,s|2),t.elementType=qv,t.lanes=i,t;case Yv:return t=ti(13,r,e,s),t.elementType=Yv,t.lanes=i,t;case Qv:return t=ti(19,r,e,s),t.elementType=Qv,t.lanes=i,t;case pI:return Zg(r,s,i,e);default:if(typeof t=="object"&&t!==null)switch(t.$$typeof){case hI:o=10;break e;case fI:o=9;break e;case s1:o=11;break e;case i1:o=14;break e;case ma:o=16,n=null;break e}throw Error(Ye(130,t==null?t:typeof t,""))}return e=ti(o,r,e,s),e.elementType=t,e.type=n,e.lanes=i,e}function Vl(t,e,r,n){return t=ti(7,t,n,e),t.lanes=r,t}function Zg(t,e,r,n){return t=ti(22,t,n,e),t.elementType=pI,t.lanes=r,t.stateNode={isHidden:!1},t}function yy(t,e,r){return t=ti(6,t,null,e),t.lanes=r,t}function vy(t,e,r){return e=ti(4,t.children!==null?t.children:[],t.key,e),e.lanes=r,e.stateNode={containerInfo:t.containerInfo,pendingChildren:null,implementation:t.implementation},e}function y5(t,e,r,n,s){this.tag=e,this.containerInfo=t,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=Z0(0),this.expirationTimes=Z0(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Z0(0),this.identifierPrefix=n,this.onRecoverableError=s,this.mutableSourceEagerHydrationData=null}function z1(t,e,r,n,s,i,o,a,l){return t=new y5(t,e,r,a,l),e===1?(e=1,i===!0&&(e|=8)):e=0,i=ti(3,null,null,e),t.current=i,i.stateNode=t,i.memoizedState={element:n,isDehydrated:r,cache:null,transitions:null,pendingSuspenseBoundaries:null},M1(i),t}function v5(t,e,r){var n=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:Oc,key:n==null?null:""+n,children:t,containerInfo:e,implementation:r}}function iL(t){if(!t)return La;t=t._reactInternals;e:{if(nc(t)!==t||t.tag!==1)throw Error(Ye(170));var e=t;do{switch(e.tag){case 3:e=e.stateNode.context;break e;case 1:if(fs(e.type)){e=e.stateNode.__reactInternalMemoizedMergedChildContext;break e}}e=e.return}while(e!==null);throw Error(Ye(171))}if(t.tag===1){var r=t.type;if(fs(r))return iF(t,r,e)}return e}function oL(t,e,r,n,s,i,o,a,l){return t=z1(r,n,!0,t,s,i,o,a,l),t.context=iL(null),r=t.current,n=ts(),s=Da(r),i=Oo(n,s),i.callback=e??null,$a(r,i,s),t.current.lanes=s,Jh(t,s,n),ps(t,n),t}function e_(t,e,r,n){var s=e.current,i=ts(),o=Da(s);return r=iL(r),e.context===null?e.context=r:e.pendingContext=r,e=Oo(i,o),e.payload={element:t},n=n===void 0?null:n,n!==null&&(e.callback=n),t=$a(s,e,o),t!==null&&(Fi(t,s,o,i),bm(t,s,o)),o}function hg(t){if(t=t.current,!t.child)return null;switch(t.child.tag){case 5:return t.child.stateNode;default:return t.child.stateNode}}function v2(t,e){if(t=t.memoizedState,t!==null&&t.dehydrated!==null){var r=t.retryLane;t.retryLane=r!==0&&r<e?r:e}}function B1(t,e){v2(t,e),(t=t.alternate)&&v2(t,e)}function w5(){return null}var aL=typeof reportError=="function"?reportError:function(t){console.error(t)};function V1(t){this._internalRoot=t}t_.prototype.render=V1.prototype.render=function(t){var e=this._internalRoot;if(e===null)throw Error(Ye(409));e_(t,e,null,null)};t_.prototype.unmount=V1.prototype.unmount=function(){var t=this._internalRoot;if(t!==null){this._internalRoot=null;var e=t.containerInfo;Xl(function(){e_(null,t,null,null)}),e[Lo]=null}};function t_(t){this._internalRoot=t}t_.prototype.unstable_scheduleHydration=function(t){if(t){var e=jI();t={blockedOn:null,target:t,priority:e};for(var r=0;r<_a.length&&e!==0&&e<_a[r].priority;r++);_a.splice(r,0,t),r===0&&zI(t)}};function W1(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11)}function r_(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11&&(t.nodeType!==8||t.nodeValue!==" react-mount-point-unstable "))}function w2(){}function x5(t,e,r,n,s){if(s){if(typeof n=="function"){var i=n;n=function(){var c=hg(o);i.call(c)}}var o=oL(e,n,t,0,null,!1,!1,"",w2);return t._reactRootContainer=o,t[Lo]=o.current,Sh(t.nodeType===8?t.parentNode:t),Xl(),o}for(;s=t.lastChild;)t.removeChild(s);if(typeof n=="function"){var a=n;n=function(){var c=hg(l);a.call(c)}}var l=z1(t,0,!1,null,null,!1,!1,"",w2);return t._reactRootContainer=l,t[Lo]=l.current,Sh(t.nodeType===8?t.parentNode:t),Xl(function(){e_(e,l,r,n)}),l}function n_(t,e,r,n,s){var i=r._reactRootContainer;if(i){var o=i;if(typeof s=="function"){var a=s;s=function(){var l=hg(o);a.call(l)}}e_(e,o,t,s)}else o=x5(r,e,t,s,n);return hg(o)}LI=function(t){switch(t.tag){case 3:var e=t.stateNode;if(e.current.memoizedState.isDehydrated){var r=qd(e.pendingLanes);r!==0&&(l1(e,r|1),ps(e,rn()),!(ir&6)&&(Cu=rn()+500,Ha()))}break;case 13:Xl(function(){var n=Ro(t,1);if(n!==null){var s=ts();Fi(n,t,1,s)}}),B1(t,1)}};c1=function(t){if(t.tag===13){var e=Ro(t,134217728);if(e!==null){var r=ts();Fi(e,t,134217728,r)}B1(t,134217728)}};RI=function(t){if(t.tag===13){var e=Da(t),r=Ro(t,e);if(r!==null){var n=ts();Fi(r,t,e,n)}B1(t,e)}};jI=function(){return yr};NI=function(t,e){var r=yr;try{return yr=t,e()}finally{yr=r}};aw=function(t,e,r){switch(e){case"input":if(ew(t,r),e=r.name,r.type==="radio"&&e!=null){for(r=t;r.parentNode;)r=r.parentNode;for(r=r.querySelectorAll("input[name="+JSON.stringify(""+e)+'][type="radio"]'),e=0;e<r.length;e++){var n=r[e];if(n!==t&&n.form===t.form){var s=Kg(n);if(!s)throw Error(Ye(90));gI(n),ew(n,s)}}}break;case"textarea":yI(t,r);break;case"select":e=r.value,e!=null&&qc(t,!!r.multiple,e,!1)}};CI=L1;SI=Xl;var b5={usingClientEntryPoint:!1,Events:[ef,Rc,Kg,MI,TI,L1]},Od={findFiberByHostInstance:Al,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},M5={bundleType:Od.bundleType,version:Od.version,rendererPackageName:Od.rendererPackageName,rendererConfig:Od.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:Go.ReactCurrentDispatcher,findHostInstanceByFiber:function(t){return t=kI(t),t===null?null:t.stateNode},findFiberByHostInstance:Od.findFiberByHostInstance||w5,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var wp=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!wp.isDisabled&&wp.supportsFiber)try{Wg=wp.inject(M5),uo=wp}catch{}}js.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=b5;js.createPortal=function(t,e){var r=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!W1(e))throw Error(Ye(200));return v5(t,e,null,r)};js.createRoot=function(t,e){if(!W1(t))throw Error(Ye(299));var r=!1,n="",s=aL;return e!=null&&(e.unstable_strictMode===!0&&(r=!0),e.identifierPrefix!==void 0&&(n=e.identifierPrefix),e.onRecoverableError!==void 0&&(s=e.onRecoverableError)),e=z1(t,1,!1,null,null,r,!1,n,s),t[Lo]=e.current,Sh(t.nodeType===8?t.parentNode:t),new V1(e)};js.findDOMNode=function(t){if(t==null)return null;if(t.nodeType===1)return t;var e=t._reactInternals;if(e===void 0)throw typeof t.render=="function"?Error(Ye(188)):(t=Object.keys(t).join(","),Error(Ye(268,t)));return t=kI(e),t=t===null?null:t.stateNode,t};js.flushSync=function(t){return Xl(t)};js.hydrate=function(t,e,r){if(!r_(e))throw Error(Ye(200));return n_(null,t,e,!0,r)};js.hydrateRoot=function(t,e,r){if(!W1(t))throw Error(Ye(405));var n=r!=null&&r.hydratedSources||null,s=!1,i="",o=aL;if(r!=null&&(r.unstable_strictMode===!0&&(s=!0),r.identifierPrefix!==void 0&&(i=r.identifierPrefix),r.onRecoverableError!==void 0&&(o=r.onRecoverableError)),e=oL(e,null,t,1,r??null,s,!1,i,o),t[Lo]=e.current,Sh(t),n)for(t=0;t<n.length;t++)r=n[t],s=r._getVersion,s=s(r._source),e.mutableSourceEagerHydrationData==null?e.mutableSourceEagerHydrationData=[r,s]:e.mutableSourceEagerHydrationData.push(r,s);return new t_(e)};js.render=function(t,e,r){if(!r_(e))throw Error(Ye(200));return n_(null,t,e,!1,r)};js.unmountComponentAtNode=function(t){if(!r_(t))throw Error(Ye(40));return t._reactRootContainer?(Xl(function(){n_(null,null,t,!1,function(){t._reactRootContainer=null,t[Lo]=null})}),!0):!1};js.unstable_batchedUpdates=L1;js.unstable_renderSubtreeIntoContainer=function(t,e,r,n){if(!r_(r))throw Error(Ye(200));if(t==null||t._reactInternals===void 0)throw Error(Ye(38));return n_(t,e,r,!1,n)};js.version="18.3.1-next-f1338f8080-20240426";function lL(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(lL)}catch(t){console.error(t)}}lL(),lI.exports=js;var sc=lI.exports;const cL=qD(sc);var uL,x2=sc;uL=x2.createRoot,x2.hydrateRoot;const T5=1,C5=1e6;let wy=0;function S5(){return wy=(wy+1)%Number.MAX_SAFE_INTEGER,wy.toString()}const xy=new Map,b2=t=>{if(xy.has(t))return;const e=setTimeout(()=>{xy.delete(t),hh({type:"REMOVE_TOAST",toastId:t})},C5);xy.set(t,e)},E5=(t,e)=>{switch(e.type){case"ADD_TOAST":return{...t,toasts:[e.toast,...t.toasts].slice(0,T5)};case"UPDATE_TOAST":return{...t,toasts:t.toasts.map(r=>r.id===e.toast.id?{...r,...e.toast}:r)};case"DISMISS_TOAST":{const{toastId:r}=e;return r?b2(r):t.toasts.forEach(n=>{b2(n.id)}),{...t,toasts:t.toasts.map(n=>n.id===r||r===void 0?{...n,open:!1}:n)}}case"REMOVE_TOAST":return e.toastId===void 0?{...t,toasts:[]}:{...t,toasts:t.toasts.filter(r=>r.id!==e.toastId)}}},km=[];let Am={toasts:[]};function hh(t){Am=E5(Am,t),km.forEach(e=>{e(Am)})}function P5({...t}){const e=S5(),r=s=>hh({type:"UPDATE_TOAST",toast:{...s,id:e}}),n=()=>hh({type:"DISMISS_TOAST",toastId:e});return hh({type:"ADD_TOAST",toast:{...t,id:e,open:!0,onOpenChange:s=>{s||n()}}}),{id:e,dismiss:n,update:r}}function k5(){const[t,e]=D.useState(Am);return D.useEffect(()=>(km.push(e),()=>{const r=km.indexOf(e);r>-1&&km.splice(r,1)}),[t]),{...t,toast:P5,dismiss:r=>hh({type:"DISMISS_TOAST",toastId:r})}}function $t(t,e,{checkForDefaultPrevented:r=!0}={}){return function(s){if(t==null||t(s),r===!1||!s.defaultPrevented)return e==null?void 0:e(s)}}function A5(t,e){typeof t=="function"?t(e):t!=null&&(t.current=e)}function dL(...t){return e=>t.forEach(r=>A5(r,e))}function cr(...t){return D.useCallback(dL(...t),t)}function $5(t,e=[]){let r=[];function n(i,o){const a=D.createContext(o),l=r.length;r=[...r,o];function c(d){const{scope:h,children:f,...p}=d,m=(h==null?void 0:h[t][l])||a,y=D.useMemo(()=>p,Object.values(p));return G.jsx(m.Provider,{value:y,children:f})}function u(d,h){const f=(h==null?void 0:h[t][l])||a,p=D.useContext(f);if(p)return p;if(o!==void 0)return o;throw new Error(`\`${d}\` must be used within \`${i}\``)}return c.displayName=i+"Provider",[c,u]}const s=()=>{const i=r.map(o=>D.createContext(o));return function(a){const l=(a==null?void 0:a[t])||i;return D.useMemo(()=>({[`__scope${t}`]:{...a,[t]:l}}),[a,l])}};return s.scopeName=t,[n,O5(s,...e)]}function O5(...t){const e=t[0];if(t.length===1)return e;const r=()=>{const n=t.map(s=>({useScope:s(),scopeName:s.scopeName}));return function(i){const o=n.reduce((a,{useScope:l,scopeName:c})=>{const d=l(i)[`__scope${c}`];return{...a,...d}},{});return D.useMemo(()=>({[`__scope${e.scopeName}`]:o}),[o])}};return r.scopeName=e.scopeName,r}var ql=D.forwardRef((t,e)=>{const{children:r,...n}=t,s=D.Children.toArray(r),i=s.find(D5);if(i){const o=i.props.children,a=s.map(l=>l===i?D.Children.count(o)>1?D.Children.only(null):D.isValidElement(o)?o.props.children:null:l);return G.jsx(zw,{...n,ref:e,children:D.isValidElement(o)?D.cloneElement(o,void 0,a):null})}return G.jsx(zw,{...n,ref:e,children:r})});ql.displayName="Slot";var zw=D.forwardRef((t,e)=>{const{children:r,...n}=t;if(D.isValidElement(r)){const s=F5(r);return D.cloneElement(r,{...I5(n,r.props),ref:e?dL(e,s):s})}return D.Children.count(r)>1?D.Children.only(null):null});zw.displayName="SlotClone";var U1=({children:t})=>G.jsx(G.Fragment,{children:t});function D5(t){return D.isValidElement(t)&&t.type===U1}function I5(t,e){const r={...e};for(const n in e){const s=t[n],i=e[n];/^on[A-Z]/.test(n)?s&&i?r[n]=(...a)=>{i(...a),s(...a)}:s&&(r[n]=s):n==="style"?r[n]={...s,...i}:n==="className"&&(r[n]=[s,i].filter(Boolean).join(" "))}return{...t,...r}}function F5(t){var n,s;let e=(n=Object.getOwnPropertyDescriptor(t.props,"ref"))==null?void 0:n.get,r=e&&"isReactWarning"in e&&e.isReactWarning;return r?t.ref:(e=(s=Object.getOwnPropertyDescriptor(t,"ref"))==null?void 0:s.get,r=e&&"isReactWarning"in e&&e.isReactWarning,r?t.props.ref:t.props.ref||t.ref)}function G1(t){const e=t+"CollectionProvider",[r,n]=$5(e),[s,i]=r(e,{collectionRef:{current:null},itemMap:new Map}),o=f=>{const{scope:p,children:m}=f,y=st.useRef(null),g=st.useRef(new Map).current;return G.jsx(s,{scope:p,itemMap:g,collectionRef:y,children:m})};o.displayName=e;const a=t+"CollectionSlot",l=st.forwardRef((f,p)=>{const{scope:m,children:y}=f,g=i(a,m),_=cr(p,g.collectionRef);return G.jsx(ql,{ref:_,children:y})});l.displayName=a;const c=t+"CollectionItemSlot",u="data-radix-collection-item",d=st.forwardRef((f,p)=>{const{scope:m,children:y,...g}=f,_=st.useRef(null),v=cr(p,_),w=i(c,m);return st.useEffect(()=>(w.itemMap.set(_,{ref:_,...g}),()=>void w.itemMap.delete(_))),G.jsx(ql,{[u]:"",ref:v,children:y})});d.displayName=c;function h(f){const p=i(t+"CollectionConsumer",f);return st.useCallback(()=>{const y=p.collectionRef.current;if(!y)return[];const g=Array.from(y.querySelectorAll(`[${u}]`));return Array.from(p.itemMap.values()).sort((w,x)=>g.indexOf(w.ref.current)-g.indexOf(x.ref.current))},[p.collectionRef,p.itemMap])}return[{Provider:o,Slot:l,ItemSlot:d},h,n]}function L5(t,e){const r=D.createContext(e),n=i=>{const{children:o,...a}=i,l=D.useMemo(()=>a,Object.values(a));return G.jsx(r.Provider,{value:l,children:o})};n.displayName=t+"Provider";function s(i){const o=D.useContext(r);if(o)return o;if(e!==void 0)return e;throw new Error(`\`${i}\` must be used within \`${t}\``)}return[n,s]}function Iu(t,e=[]){let r=[];function n(i,o){const a=D.createContext(o),l=r.length;r=[...r,o];const c=d=>{var g;const{scope:h,children:f,...p}=d,m=((g=h==null?void 0:h[t])==null?void 0:g[l])||a,y=D.useMemo(()=>p,Object.values(p));return G.jsx(m.Provider,{value:y,children:f})};c.displayName=i+"Provider";function u(d,h){var m;const f=((m=h==null?void 0:h[t])==null?void 0:m[l])||a,p=D.useContext(f);if(p)return p;if(o!==void 0)return o;throw new Error(`\`${d}\` must be used within \`${i}\``)}return[c,u]}const s=()=>{const i=r.map(o=>D.createContext(o));return function(a){const l=(a==null?void 0:a[t])||i;return D.useMemo(()=>({[`__scope${t}`]:{...a,[t]:l}}),[a,l])}};return s.scopeName=t,[n,R5(s,...e)]}function R5(...t){const e=t[0];if(t.length===1)return e;const r=()=>{const n=t.map(s=>({useScope:s(),scopeName:s.scopeName}));return function(i){const o=n.reduce((a,{useScope:l,scopeName:c})=>{const d=l(i)[`__scope${c}`];return{...a,...d}},{});return D.useMemo(()=>({[`__scope${e.scopeName}`]:o}),[o])}};return r.scopeName=e.scopeName,r}var j5=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","span","svg","ul"],Kt=j5.reduce((t,e)=>{const r=D.forwardRef((n,s)=>{const{asChild:i,...o}=n,a=i?ql:e;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),G.jsx(a,{...o,ref:s})});return r.displayName=`Primitive.${e}`,{...t,[e]:r}},{});function hL(t,e){t&&sc.flushSync(()=>t.dispatchEvent(e))}function Rs(t){const e=D.useRef(t);return D.useEffect(()=>{e.current=t}),D.useMemo(()=>(...r)=>{var n;return(n=e.current)==null?void 0:n.call(e,...r)},[])}function N5(t,e=globalThis==null?void 0:globalThis.document){const r=Rs(t);D.useEffect(()=>{const n=s=>{s.key==="Escape"&&r(s)};return e.addEventListener("keydown",n,{capture:!0}),()=>e.removeEventListener("keydown",n,{capture:!0})},[r,e])}var z5="DismissableLayer",Bw="dismissableLayer.update",B5="dismissableLayer.pointerDownOutside",V5="dismissableLayer.focusOutside",M2,fL=D.createContext({layers:new Set,layersWithOutsidePointerEventsDisabled:new Set,branches:new Set}),rf=D.forwardRef((t,e)=>{const{disableOutsidePointerEvents:r=!1,onEscapeKeyDown:n,onPointerDownOutside:s,onFocusOutside:i,onInteractOutside:o,onDismiss:a,...l}=t,c=D.useContext(fL),[u,d]=D.useState(null),h=(u==null?void 0:u.ownerDocument)??(globalThis==null?void 0:globalThis.document),[,f]=D.useState({}),p=cr(e,T=>d(T)),m=Array.from(c.layers),[y]=[...c.layersWithOutsidePointerEventsDisabled].slice(-1),g=m.indexOf(y),_=u?m.indexOf(u):-1,v=c.layersWithOutsidePointerEventsDisabled.size>0,w=_>=g,x=U5(T=>{const S=T.target,k=[...c.branches].some($=>$.contains(S));!w||k||(s==null||s(T),o==null||o(T),T.defaultPrevented||a==null||a())},h),M=G5(T=>{const S=T.target;[...c.branches].some($=>$.contains(S))||(i==null||i(T),o==null||o(T),T.defaultPrevented||a==null||a())},h);return N5(T=>{_===c.layers.size-1&&(n==null||n(T),!T.defaultPrevented&&a&&(T.preventDefault(),a()))},h),D.useEffect(()=>{if(u)return r&&(c.layersWithOutsidePointerEventsDisabled.size===0&&(M2=h.body.style.pointerEvents,h.body.style.pointerEvents="none"),c.layersWithOutsidePointerEventsDisabled.add(u)),c.layers.add(u),T2(),()=>{r&&c.layersWithOutsidePointerEventsDisabled.size===1&&(h.body.style.pointerEvents=M2)}},[u,h,r,c]),D.useEffect(()=>()=>{u&&(c.layers.delete(u),c.layersWithOutsidePointerEventsDisabled.delete(u),T2())},[u,c]),D.useEffect(()=>{const T=()=>f({});return document.addEventListener(Bw,T),()=>document.removeEventListener(Bw,T)},[]),G.jsx(Kt.div,{...l,ref:p,style:{pointerEvents:v?w?"auto":"none":void 0,...t.style},onFocusCapture:$t(t.onFocusCapture,M.onFocusCapture),onBlurCapture:$t(t.onBlurCapture,M.onBlurCapture),onPointerDownCapture:$t(t.onPointerDownCapture,x.onPointerDownCapture)})});rf.displayName=z5;var W5="DismissableLayerBranch",pL=D.forwardRef((t,e)=>{const r=D.useContext(fL),n=D.useRef(null),s=cr(e,n);return D.useEffect(()=>{const i=n.current;if(i)return r.branches.add(i),()=>{r.branches.delete(i)}},[r.branches]),G.jsx(Kt.div,{...t,ref:s})});pL.displayName=W5;function U5(t,e=globalThis==null?void 0:globalThis.document){const r=Rs(t),n=D.useRef(!1),s=D.useRef(()=>{});return D.useEffect(()=>{const i=a=>{if(a.target&&!n.current){let l=function(){mL(B5,r,c,{discrete:!0})};const c={originalEvent:a};a.pointerType==="touch"?(e.removeEventListener("click",s.current),s.current=l,e.addEventListener("click",s.current,{once:!0})):l()}else e.removeEventListener("click",s.current);n.current=!1},o=window.setTimeout(()=>{e.addEventListener("pointerdown",i)},0);return()=>{window.clearTimeout(o),e.removeEventListener("pointerdown",i),e.removeEventListener("click",s.current)}},[e,r]),{onPointerDownCapture:()=>n.current=!0}}function G5(t,e=globalThis==null?void 0:globalThis.document){const r=Rs(t),n=D.useRef(!1);return D.useEffect(()=>{const s=i=>{i.target&&!n.current&&mL(V5,r,{originalEvent:i},{discrete:!1})};return e.addEventListener("focusin",s),()=>e.removeEventListener("focusin",s)},[e,r]),{onFocusCapture:()=>n.current=!0,onBlurCapture:()=>n.current=!1}}function T2(){const t=new CustomEvent(Bw);document.dispatchEvent(t)}function mL(t,e,r,{discrete:n}){const s=r.originalEvent.target,i=new CustomEvent(t,{bubbles:!1,cancelable:!0,detail:r});e&&s.addEventListener(t,e,{once:!0}),n?hL(s,i):s.dispatchEvent(i)}var H5=rf,K5=pL,Kn=globalThis!=null&&globalThis.document?D.useLayoutEffect:()=>{},X5="Portal",s_=D.forwardRef((t,e)=>{var a;const{container:r,...n}=t,[s,i]=D.useState(!1);Kn(()=>i(!0),[]);const o=r||s&&((a=globalThis==null?void 0:globalThis.document)==null?void 0:a.body);return o?cL.createPortal(G.jsx(Kt.div,{...n,ref:e}),o):null});s_.displayName=X5;function q5(t,e){return D.useReducer((r,n)=>e[r][n]??r,t)}var Fu=t=>{const{present:e,children:r}=t,n=Y5(e),s=typeof r=="function"?r({present:n.isPresent}):D.Children.only(r),i=cr(n.ref,Q5(s));return typeof r=="function"||n.isPresent?D.cloneElement(s,{ref:i}):null};Fu.displayName="Presence";function Y5(t){const[e,r]=D.useState(),n=D.useRef({}),s=D.useRef(t),i=D.useRef("none"),o=t?"mounted":"unmounted",[a,l]=q5(o,{mounted:{UNMOUNT:"unmounted",ANIMATION_OUT:"unmountSuspended"},unmountSuspended:{MOUNT:"mounted",ANIMATION_END:"unmounted"},unmounted:{MOUNT:"mounted"}});return D.useEffect(()=>{const c=xp(n.current);i.current=a==="mounted"?c:"none"},[a]),Kn(()=>{const c=n.current,u=s.current;if(u!==t){const h=i.current,f=xp(c);t?l("MOUNT"):f==="none"||(c==null?void 0:c.display)==="none"?l("UNMOUNT"):l(u&&h!==f?"ANIMATION_OUT":"UNMOUNT"),s.current=t}},[t,l]),Kn(()=>{if(e){let c;const u=e.ownerDocument.defaultView??window,d=f=>{const m=xp(n.current).includes(f.animationName);if(f.target===e&&m&&(l("ANIMATION_END"),!s.current)){const y=e.style.animationFillMode;e.style.animationFillMode="forwards",c=u.setTimeout(()=>{e.style.animationFillMode==="forwards"&&(e.style.animationFillMode=y)})}},h=f=>{f.target===e&&(i.current=xp(n.current))};return e.addEventListener("animationstart",h),e.addEventListener("animationcancel",d),e.addEventListener("animationend",d),()=>{u.clearTimeout(c),e.removeEventListener("animationstart",h),e.removeEventListener("animationcancel",d),e.removeEventListener("animationend",d)}}else l("ANIMATION_END")},[e,l]),{isPresent:["mounted","unmountSuspended"].includes(a),ref:D.useCallback(c=>{c&&(n.current=getComputedStyle(c)),r(c)},[])}}function xp(t){return(t==null?void 0:t.animationName)||"none"}function Q5(t){var n,s;let e=(n=Object.getOwnPropertyDescriptor(t.props,"ref"))==null?void 0:n.get,r=e&&"isReactWarning"in e&&e.isReactWarning;return r?t.ref:(e=(s=Object.getOwnPropertyDescriptor(t,"ref"))==null?void 0:s.get,r=e&&"isReactWarning"in e&&e.isReactWarning,r?t.props.ref:t.props.ref||t.ref)}function Fh({prop:t,defaultProp:e,onChange:r=()=>{}}){const[n,s]=J5({defaultProp:e,onChange:r}),i=t!==void 0,o=i?t:n,a=Rs(r),l=D.useCallback(c=>{if(i){const d=typeof c=="function"?c(t):c;d!==t&&a(d)}else s(c)},[i,t,s,a]);return[o,l]}function J5({defaultProp:t,onChange:e}){const r=D.useState(t),[n]=r,s=D.useRef(n),i=Rs(e);return D.useEffect(()=>{s.current!==n&&(i(n),s.current=n)},[n,s,i]),r}var Z5="VisuallyHidden",nf=D.forwardRef((t,e)=>G.jsx(Kt.span,{...t,ref:e,style:{position:"absolute",border:0,width:1,height:1,padding:0,margin:-1,overflow:"hidden",clip:"rect(0, 0, 0, 0)",whiteSpace:"nowrap",wordWrap:"normal",...t.style}}));nf.displayName=Z5;var eG=nf,H1="ToastProvider",[K1,tG,rG]=G1("Toast"),[gL,PJ]=Iu("Toast",[rG]),[nG,i_]=gL(H1),_L=t=>{const{__scopeToast:e,label:r="Notification",duration:n=5e3,swipeDirection:s="right",swipeThreshold:i=50,children:o}=t,[a,l]=D.useState(null),[c,u]=D.useState(0),d=D.useRef(!1),h=D.useRef(!1);return r.trim()||console.error(`Invalid prop \`label\` supplied to \`${H1}\`. Expected non-empty \`string\`.`),G.jsx(K1.Provider,{scope:e,children:G.jsx(nG,{scope:e,label:r,duration:n,swipeDirection:s,swipeThreshold:i,toastCount:c,viewport:a,onViewportChange:l,onToastAdd:D.useCallback(()=>u(f=>f+1),[]),onToastRemove:D.useCallback(()=>u(f=>f-1),[]),isFocusedToastEscapeKeyDownRef:d,isClosePausedRef:h,children:o})})};_L.displayName=H1;var yL="ToastViewport",sG=["F8"],Vw="toast.viewportPause",Ww="toast.viewportResume",vL=D.forwardRef((t,e)=>{const{__scopeToast:r,hotkey:n=sG,label:s="Notifications ({hotkey})",...i}=t,o=i_(yL,r),a=tG(r),l=D.useRef(null),c=D.useRef(null),u=D.useRef(null),d=D.useRef(null),h=cr(e,d,o.onViewportChange),f=n.join("+").replace(/Key/g,"").replace(/Digit/g,""),p=o.toastCount>0;D.useEffect(()=>{const y=g=>{var v;n.length!==0&&n.every(w=>g[w]||g.code===w)&&((v=d.current)==null||v.focus())};return document.addEventListener("keydown",y),()=>document.removeEventListener("keydown",y)},[n]),D.useEffect(()=>{const y=l.current,g=d.current;if(p&&y&&g){const _=()=>{if(!o.isClosePausedRef.current){const M=new CustomEvent(Vw);g.dispatchEvent(M),o.isClosePausedRef.current=!0}},v=()=>{if(o.isClosePausedRef.current){const M=new CustomEvent(Ww);g.dispatchEvent(M),o.isClosePausedRef.current=!1}},w=M=>{!y.contains(M.relatedTarget)&&v()},x=()=>{y.contains(document.activeElement)||v()};return y.addEventListener("focusin",_),y.addEventListener("focusout",w),y.addEventListener("pointermove",_),y.addEventListener("pointerleave",x),window.addEventListener("blur",_),window.addEventListener("focus",v),()=>{y.removeEventListener("focusin",_),y.removeEventListener("focusout",w),y.removeEventListener("pointermove",_),y.removeEventListener("pointerleave",x),window.removeEventListener("blur",_),window.removeEventListener("focus",v)}}},[p,o.isClosePausedRef]);const m=D.useCallback(({tabbingDirection:y})=>{const _=a().map(v=>{const w=v.ref.current,x=[w,..._G(w)];return y==="forwards"?x:x.reverse()});return(y==="forwards"?_.reverse():_).flat()},[a]);return D.useEffect(()=>{const y=d.current;if(y){const g=_=>{var x,M,T;const v=_.altKey||_.ctrlKey||_.metaKey;if(_.key==="Tab"&&!v){const S=document.activeElement,k=_.shiftKey;if(_.target===y&&k){(x=c.current)==null||x.focus();return}const V=m({tabbingDirection:k?"backwards":"forwards"}),L=V.findIndex(X=>X===S);by(V.slice(L+1))?_.preventDefault():k?(M=c.current)==null||M.focus():(T=u.current)==null||T.focus()}};return y.addEventListener("keydown",g),()=>y.removeEventListener("keydown",g)}},[a,m]),G.jsxs(K5,{ref:l,role:"region","aria-label":s.replace("{hotkey}",f),tabIndex:-1,style:{pointerEvents:p?void 0:"none"},children:[p&&G.jsx(Uw,{ref:c,onFocusFromOutsideViewport:()=>{const y=m({tabbingDirection:"forwards"});by(y)}}),G.jsx(K1.Slot,{scope:r,children:G.jsx(Kt.ol,{tabIndex:-1,...i,ref:h})}),p&&G.jsx(Uw,{ref:u,onFocusFromOutsideViewport:()=>{const y=m({tabbingDirection:"backwards"});by(y)}})]})});vL.displayName=yL;var wL="ToastFocusProxy",Uw=D.forwardRef((t,e)=>{const{__scopeToast:r,onFocusFromOutsideViewport:n,...s}=t,i=i_(wL,r);return G.jsx(nf,{"aria-hidden":!0,tabIndex:0,...s,ref:e,style:{position:"fixed"},onFocus:o=>{var c;const a=o.relatedTarget;!((c=i.viewport)!=null&&c.contains(a))&&n()}})});Uw.displayName=wL;var o_="Toast",iG="toast.swipeStart",oG="toast.swipeMove",aG="toast.swipeCancel",lG="toast.swipeEnd",xL=D.forwardRef((t,e)=>{const{forceMount:r,open:n,defaultOpen:s,onOpenChange:i,...o}=t,[a=!0,l]=Fh({prop:n,defaultProp:s,onChange:i});return G.jsx(Fu,{present:r||a,children:G.jsx(dG,{open:a,...o,ref:e,onClose:()=>l(!1),onPause:Rs(t.onPause),onResume:Rs(t.onResume),onSwipeStart:$t(t.onSwipeStart,c=>{c.currentTarget.setAttribute("data-swipe","start")}),onSwipeMove:$t(t.onSwipeMove,c=>{const{x:u,y:d}=c.detail.delta;c.currentTarget.setAttribute("data-swipe","move"),c.currentTarget.style.setProperty("--radix-toast-swipe-move-x",`${u}px`),c.currentTarget.style.setProperty("--radix-toast-swipe-move-y",`${d}px`)}),onSwipeCancel:$t(t.onSwipeCancel,c=>{c.currentTarget.setAttribute("data-swipe","cancel"),c.currentTarget.style.removeProperty("--radix-toast-swipe-move-x"),c.currentTarget.style.removeProperty("--radix-toast-swipe-move-y"),c.currentTarget.style.removeProperty("--radix-toast-swipe-end-x"),c.currentTarget.style.removeProperty("--radix-toast-swipe-end-y")}),onSwipeEnd:$t(t.onSwipeEnd,c=>{const{x:u,y:d}=c.detail.delta;c.currentTarget.setAttribute("data-swipe","end"),c.currentTarget.style.removeProperty("--radix-toast-swipe-move-x"),c.currentTarget.style.removeProperty("--radix-toast-swipe-move-y"),c.currentTarget.style.setProperty("--radix-toast-swipe-end-x",`${u}px`),c.currentTarget.style.setProperty("--radix-toast-swipe-end-y",`${d}px`),l(!1)})})})});xL.displayName=o_;var[cG,uG]=gL(o_,{onClose(){}}),dG=D.forwardRef((t,e)=>{const{__scopeToast:r,type:n="foreground",duration:s,open:i,onClose:o,onEscapeKeyDown:a,onPause:l,onResume:c,onSwipeStart:u,onSwipeMove:d,onSwipeCancel:h,onSwipeEnd:f,...p}=t,m=i_(o_,r),[y,g]=D.useState(null),_=cr(e,X=>g(X)),v=D.useRef(null),w=D.useRef(null),x=s||m.duration,M=D.useRef(0),T=D.useRef(x),S=D.useRef(0),{onToastAdd:k,onToastRemove:$}=m,j=Rs(()=>{var K;(y==null?void 0:y.contains(document.activeElement))&&((K=m.viewport)==null||K.focus()),o()}),V=D.useCallback(X=>{!X||X===1/0||(window.clearTimeout(S.current),M.current=new Date().getTime(),S.current=window.setTimeout(j,X))},[j]);D.useEffect(()=>{const X=m.viewport;if(X){const K=()=>{V(T.current),c==null||c()},Y=()=>{const J=new Date().getTime()-M.current;T.current=T.current-J,window.clearTimeout(S.current),l==null||l()};return X.addEventListener(Vw,Y),X.addEventListener(Ww,K),()=>{X.removeEventListener(Vw,Y),X.removeEventListener(Ww,K)}}},[m.viewport,x,l,c,V]),D.useEffect(()=>{i&&!m.isClosePausedRef.current&&V(x)},[i,x,m.isClosePausedRef,V]),D.useEffect(()=>(k(),()=>$()),[k,$]);const L=D.useMemo(()=>y?PL(y):null,[y]);return m.viewport?G.jsxs(G.Fragment,{children:[L&&G.jsx(hG,{__scopeToast:r,role:"status","aria-live":n==="foreground"?"assertive":"polite","aria-atomic":!0,children:L}),G.jsx(cG,{scope:r,onClose:j,children:sc.createPortal(G.jsx(K1.ItemSlot,{scope:r,children:G.jsx(H5,{asChild:!0,onEscapeKeyDown:$t(a,()=>{m.isFocusedToastEscapeKeyDownRef.current||j(),m.isFocusedToastEscapeKeyDownRef.current=!1}),children:G.jsx(Kt.li,{role:"status","aria-live":"off","aria-atomic":!0,tabIndex:0,"data-state":i?"open":"closed","data-swipe-direction":m.swipeDirection,...p,ref:_,style:{userSelect:"none",touchAction:"none",...t.style},onKeyDown:$t(t.onKeyDown,X=>{X.key==="Escape"&&(a==null||a(X.nativeEvent),X.nativeEvent.defaultPrevented||(m.isFocusedToastEscapeKeyDownRef.current=!0,j()))}),onPointerDown:$t(t.onPointerDown,X=>{X.button===0&&(v.current={x:X.clientX,y:X.clientY})}),onPointerMove:$t(t.onPointerMove,X=>{if(!v.current)return;const K=X.clientX-v.current.x,Y=X.clientY-v.current.y,J=!!w.current,N=["left","right"].includes(m.swipeDirection),ne=["left","up"].includes(m.swipeDirection)?Math.min:Math.max,te=N?ne(0,K):0,z=N?0:ne(0,Y),O=X.pointerType==="touch"?10:2,H={x:te,y:z},re={originalEvent:X,delta:H};J?(w.current=H,bp(oG,d,re,{discrete:!1})):C2(H,m.swipeDirection,O)?(w.current=H,bp(iG,u,re,{discrete:!1}),X.target.setPointerCapture(X.pointerId)):(Math.abs(K)>O||Math.abs(Y)>O)&&(v.current=null)}),onPointerUp:$t(t.onPointerUp,X=>{const K=w.current,Y=X.target;if(Y.hasPointerCapture(X.pointerId)&&Y.releasePointerCapture(X.pointerId),w.current=null,v.current=null,K){const J=X.currentTarget,N={originalEvent:X,delta:K};C2(K,m.swipeDirection,m.swipeThreshold)?bp(lG,f,N,{discrete:!0}):bp(aG,h,N,{discrete:!0}),J.addEventListener("click",ne=>ne.preventDefault(),{once:!0})}})})})}),m.viewport)})]}):null}),hG=t=>{const{__scopeToast:e,children:r,...n}=t,s=i_(o_,e),[i,o]=D.useState(!1),[a,l]=D.useState(!1);return mG(()=>o(!0)),D.useEffect(()=>{const c=window.setTimeout(()=>l(!0),1e3);return()=>window.clearTimeout(c)},[]),a?null:G.jsx(s_,{asChild:!0,children:G.jsx(nf,{...n,children:i&&G.jsxs(G.Fragment,{children:[s.label," ",r]})})})},fG="ToastTitle",bL=D.forwardRef((t,e)=>{const{__scopeToast:r,...n}=t;return G.jsx(Kt.div,{...n,ref:e})});bL.displayName=fG;var pG="ToastDescription",ML=D.forwardRef((t,e)=>{const{__scopeToast:r,...n}=t;return G.jsx(Kt.div,{...n,ref:e})});ML.displayName=pG;var TL="ToastAction",CL=D.forwardRef((t,e)=>{const{altText:r,...n}=t;return r.trim()?G.jsx(EL,{altText:r,asChild:!0,children:G.jsx(X1,{...n,ref:e})}):(console.error(`Invalid prop \`altText\` supplied to \`${TL}\`. Expected non-empty \`string\`.`),null)});CL.displayName=TL;var SL="ToastClose",X1=D.forwardRef((t,e)=>{const{__scopeToast:r,...n}=t,s=uG(SL,r);return G.jsx(EL,{asChild:!0,children:G.jsx(Kt.button,{type:"button",...n,ref:e,onClick:$t(t.onClick,s.onClose)})})});X1.displayName=SL;var EL=D.forwardRef((t,e)=>{const{__scopeToast:r,altText:n,...s}=t;return G.jsx(Kt.div,{"data-radix-toast-announce-exclude":"","data-radix-toast-announce-alt":n||void 0,...s,ref:e})});function PL(t){const e=[];return Array.from(t.childNodes).forEach(n=>{if(n.nodeType===n.TEXT_NODE&&n.textContent&&e.push(n.textContent),gG(n)){const s=n.ariaHidden||n.hidden||n.style.display==="none",i=n.dataset.radixToastAnnounceExclude==="";if(!s)if(i){const o=n.dataset.radixToastAnnounceAlt;o&&e.push(o)}else e.push(...PL(n))}}),e}function bp(t,e,r,{discrete:n}){const s=r.originalEvent.currentTarget,i=new CustomEvent(t,{bubbles:!0,cancelable:!0,detail:r});e&&s.addEventListener(t,e,{once:!0}),n?hL(s,i):s.dispatchEvent(i)}var C2=(t,e,r=0)=>{const n=Math.abs(t.x),s=Math.abs(t.y),i=n>s;return e==="left"||e==="right"?i&&n>r:!i&&s>r};function mG(t=()=>{}){const e=Rs(t);Kn(()=>{let r=0,n=0;return r=window.requestAnimationFrame(()=>n=window.requestAnimationFrame(e)),()=>{window.cancelAnimationFrame(r),window.cancelAnimationFrame(n)}},[e])}function gG(t){return t.nodeType===t.ELEMENT_NODE}function _G(t){const e=[],r=document.createTreeWalker(t,NodeFilter.SHOW_ELEMENT,{acceptNode:n=>{const s=n.tagName==="INPUT"&&n.type==="hidden";return n.disabled||n.hidden||s?NodeFilter.FILTER_SKIP:n.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;r.nextNode();)e.push(r.currentNode);return e}function by(t){const e=document.activeElement;return t.some(r=>r===e?!0:(r.focus(),document.activeElement!==e))}var yG=_L,kL=vL,AL=xL,$L=bL,OL=ML,DL=CL,IL=X1;function FL(t){var e,r,n="";if(typeof t=="string"||typeof t=="number")n+=t;else if(typeof t=="object")if(Array.isArray(t)){var s=t.length;for(e=0;e<s;e++)t[e]&&(r=FL(t[e]))&&(n&&(n+=" "),n+=r)}else for(r in t)t[r]&&(n&&(n+=" "),n+=r);return n}function LL(){for(var t,e,r=0,n="",s=arguments.length;r<s;r++)(t=arguments[r])&&(e=FL(t))&&(n&&(n+=" "),n+=e);return n}const S2=t=>typeof t=="boolean"?`${t}`:t===0?"0":t,E2=LL,q1=(t,e)=>r=>{var n;if((e==null?void 0:e.variants)==null)return E2(t,r==null?void 0:r.class,r==null?void 0:r.className);const{variants:s,defaultVariants:i}=e,o=Object.keys(s).map(c=>{const u=r==null?void 0:r[c],d=i==null?void 0:i[c];if(u===null)return null;const h=S2(u)||S2(d);return s[c][h]}),a=r&&Object.entries(r).reduce((c,u)=>{let[d,h]=u;return h===void 0||(c[d]=h),c},{}),l=e==null||(n=e.compoundVariants)===null||n===void 0?void 0:n.reduce((c,u)=>{let{class:d,className:h,...f}=u;return Object.entries(f).every(p=>{let[m,y]=p;return Array.isArray(y)?y.includes({...i,...a}[m]):{...i,...a}[m]===y})?[...c,d,h]:c},[]);return E2(t,o,l,r==null?void 0:r.class,r==null?void 0:r.className)};/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const vG=t=>t.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),RL=(...t)=>t.filter((e,r,n)=>!!e&&e.trim()!==""&&n.indexOf(e)===r).join(" ").trim();/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var wG={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xG=D.forwardRef(({color:t="currentColor",size:e=24,strokeWidth:r=2,absoluteStrokeWidth:n,className:s="",children:i,iconNode:o,...a},l)=>D.createElement("svg",{ref:l,...wG,width:e,height:e,stroke:t,strokeWidth:n?Number(r)*24/Number(e):r,className:RL("lucide",s),...a},[...o.map(([c,u])=>D.createElement(c,u)),...Array.isArray(i)?i:[i]]));/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ws=(t,e)=>{const r=D.forwardRef(({className:n,...s},i)=>D.createElement(xG,{ref:i,iconNode:e,className:RL(`lucide-${vG(t)}`,n),...s}));return r.displayName=`${t}`,r};/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const bG=ws("Check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const jL=ws("ChevronDown",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const MG=ws("ChevronUp",[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const TG=ws("Download",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const NL=ws("Image",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const CG=ws("MessageSquare",[["path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z",key:"1lielz"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const SG=ws("Palette",[["circle",{cx:"13.5",cy:"6.5",r:".5",fill:"currentColor",key:"1okk4w"}],["circle",{cx:"17.5",cy:"10.5",r:".5",fill:"currentColor",key:"f64h9f"}],["circle",{cx:"8.5",cy:"7.5",r:".5",fill:"currentColor",key:"fotxhn"}],["circle",{cx:"6.5",cy:"12.5",r:".5",fill:"currentColor",key:"qy21gx"}],["path",{d:"M12 2C6.5 2 2 6.5 2 12s4.5 10 10 10c.926 0 1.648-.746 1.648-1.688 0-.437-.18-.835-.437-1.125-.29-.289-.438-.652-.438-1.125a1.64 1.64 0 0 1 1.668-1.668h1.996c3.051 0 5.555-2.503 5.555-5.554C21.965 6.012 17.461 2 12 2z",key:"12rzf8"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const EG=ws("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const P2=ws("RefreshCw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const k2=ws("Sparkles",[["path",{d:"M9.937 15.5A2 2 0 0 0 8.5 14.063l-6.135-1.582a.5.5 0 0 1 0-.962L8.5 9.936A2 2 0 0 0 9.937 8.5l1.582-6.135a.5.5 0 0 1 .963 0L14.063 8.5A2 2 0 0 0 15.5 9.937l6.135 1.581a.5.5 0 0 1 0 .964L15.5 14.063a2 2 0 0 0-1.437 1.437l-1.582 6.135a.5.5 0 0 1-.963 0z",key:"4pj2yx"}],["path",{d:"M20 3v4",key:"1olli1"}],["path",{d:"M22 5h-4",key:"1gvqau"}],["path",{d:"M4 17v2",key:"vumght"}],["path",{d:"M5 18H3",key:"zchphs"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const A2=ws("TriangleAlert",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const My=ws("Type",[["polyline",{points:"4 7 4 4 20 4 20 7",key:"1nosan"}],["line",{x1:"9",x2:"15",y1:"20",y2:"20",key:"swin9y"}],["line",{x1:"12",x2:"12",y1:"4",y2:"20",key:"1tx1rr"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const PG=ws("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const kG=ws("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]),Y1="-",AG=t=>{const e=OG(t),{conflictingClassGroups:r,conflictingClassGroupModifiers:n}=t;return{getClassGroupId:o=>{const a=o.split(Y1);return a[0]===""&&a.length!==1&&a.shift(),zL(a,e)||$G(o)},getConflictingClassGroupIds:(o,a)=>{const l=r[o]||[];return a&&n[o]?[...l,...n[o]]:l}}},zL=(t,e)=>{var o;if(t.length===0)return e.classGroupId;const r=t[0],n=e.nextPart.get(r),s=n?zL(t.slice(1),n):void 0;if(s)return s;if(e.validators.length===0)return;const i=t.join(Y1);return(o=e.validators.find(({validator:a})=>a(i)))==null?void 0:o.classGroupId},$2=/^\[(.+)\]$/,$G=t=>{if($2.test(t)){const e=$2.exec(t)[1],r=e==null?void 0:e.substring(0,e.indexOf(":"));if(r)return"arbitrary.."+r}},OG=t=>{const{theme:e,prefix:r}=t,n={nextPart:new Map,validators:[]};return IG(Object.entries(t.classGroups),r).forEach(([i,o])=>{Gw(o,n,i,e)}),n},Gw=(t,e,r,n)=>{t.forEach(s=>{if(typeof s=="string"){const i=s===""?e:O2(e,s);i.classGroupId=r;return}if(typeof s=="function"){if(DG(s)){Gw(s(n),e,r,n);return}e.validators.push({validator:s,classGroupId:r});return}Object.entries(s).forEach(([i,o])=>{Gw(o,O2(e,i),r,n)})})},O2=(t,e)=>{let r=t;return e.split(Y1).forEach(n=>{r.nextPart.has(n)||r.nextPart.set(n,{nextPart:new Map,validators:[]}),r=r.nextPart.get(n)}),r},DG=t=>t.isThemeGetter,IG=(t,e)=>e?t.map(([r,n])=>{const s=n.map(i=>typeof i=="string"?e+i:typeof i=="object"?Object.fromEntries(Object.entries(i).map(([o,a])=>[e+o,a])):i);return[r,s]}):t,FG=t=>{if(t<1)return{get:()=>{},set:()=>{}};let e=0,r=new Map,n=new Map;const s=(i,o)=>{r.set(i,o),e++,e>t&&(e=0,n=r,r=new Map)};return{get(i){let o=r.get(i);if(o!==void 0)return o;if((o=n.get(i))!==void 0)return s(i,o),o},set(i,o){r.has(i)?r.set(i,o):s(i,o)}}},BL="!",LG=t=>{const{separator:e,experimentalParseClassName:r}=t,n=e.length===1,s=e[0],i=e.length,o=a=>{const l=[];let c=0,u=0,d;for(let y=0;y<a.length;y++){let g=a[y];if(c===0){if(g===s&&(n||a.slice(y,y+i)===e)){l.push(a.slice(u,y)),u=y+i;continue}if(g==="/"){d=y;continue}}g==="["?c++:g==="]"&&c--}const h=l.length===0?a:a.substring(u),f=h.startsWith(BL),p=f?h.substring(1):h,m=d&&d>u?d-u:void 0;return{modifiers:l,hasImportantModifier:f,baseClassName:p,maybePostfixModifierPosition:m}};return r?a=>r({className:a,parseClassName:o}):o},RG=t=>{if(t.length<=1)return t;const e=[];let r=[];return t.forEach(n=>{n[0]==="["?(e.push(...r.sort(),n),r=[]):r.push(n)}),e.push(...r.sort()),e},jG=t=>({cache:FG(t.cacheSize),parseClassName:LG(t),...AG(t)}),NG=/\s+/,zG=(t,e)=>{const{parseClassName:r,getClassGroupId:n,getConflictingClassGroupIds:s}=e,i=[],o=t.trim().split(NG);let a="";for(let l=o.length-1;l>=0;l-=1){const c=o[l],{modifiers:u,hasImportantModifier:d,baseClassName:h,maybePostfixModifierPosition:f}=r(c);let p=!!f,m=n(p?h.substring(0,f):h);if(!m){if(!p){a=c+(a.length>0?" "+a:a);continue}if(m=n(h),!m){a=c+(a.length>0?" "+a:a);continue}p=!1}const y=RG(u).join(":"),g=d?y+BL:y,_=g+m;if(i.includes(_))continue;i.push(_);const v=s(m,p);for(let w=0;w<v.length;++w){const x=v[w];i.push(g+x)}a=c+(a.length>0?" "+a:a)}return a};function BG(){let t=0,e,r,n="";for(;t<arguments.length;)(e=arguments[t++])&&(r=VL(e))&&(n&&(n+=" "),n+=r);return n}const VL=t=>{if(typeof t=="string")return t;let e,r="";for(let n=0;n<t.length;n++)t[n]&&(e=VL(t[n]))&&(r&&(r+=" "),r+=e);return r};function VG(t,...e){let r,n,s,i=o;function o(l){const c=e.reduce((u,d)=>d(u),t());return r=jG(c),n=r.cache.get,s=r.cache.set,i=a,a(l)}function a(l){const c=n(l);if(c)return c;const u=zG(l,r);return s(l,u),u}return function(){return i(BG.apply(null,arguments))}}const kr=t=>{const e=r=>r[t]||[];return e.isThemeGetter=!0,e},WL=/^\[(?:([a-z-]+):)?(.+)\]$/i,WG=/^\d+\/\d+$/,UG=new Set(["px","full","screen"]),GG=/^(\d+(\.\d+)?)?(xs|sm|md|lg|xl)$/,HG=/\d+(%|px|r?em|[sdl]?v([hwib]|min|max)|pt|pc|in|cm|mm|cap|ch|ex|r?lh|cq(w|h|i|b|min|max))|\b(calc|min|max|clamp)\(.+\)|^0$/,KG=/^(rgba?|hsla?|hwb|(ok)?(lab|lch))\(.+\)$/,XG=/^(inset_)?-?((\d+)?\.?(\d+)[a-z]+|0)_-?((\d+)?\.?(\d+)[a-z]+|0)/,qG=/^(url|image|image-set|cross-fade|element|(repeating-)?(linear|radial|conic)-gradient)\(.+\)$/,yo=t=>tu(t)||UG.has(t)||WG.test(t),oa=t=>Lu(t,"length",n8),tu=t=>!!t&&!Number.isNaN(Number(t)),Ty=t=>Lu(t,"number",tu),Dd=t=>!!t&&Number.isInteger(Number(t)),YG=t=>t.endsWith("%")&&tu(t.slice(0,-1)),zt=t=>WL.test(t),aa=t=>GG.test(t),QG=new Set(["length","size","percentage"]),JG=t=>Lu(t,QG,UL),ZG=t=>Lu(t,"position",UL),e8=new Set(["image","url"]),t8=t=>Lu(t,e8,i8),r8=t=>Lu(t,"",s8),Id=()=>!0,Lu=(t,e,r)=>{const n=WL.exec(t);return n?n[1]?typeof e=="string"?n[1]===e:e.has(n[1]):r(n[2]):!1},n8=t=>HG.test(t)&&!KG.test(t),UL=()=>!1,s8=t=>XG.test(t),i8=t=>qG.test(t),o8=()=>{const t=kr("colors"),e=kr("spacing"),r=kr("blur"),n=kr("brightness"),s=kr("borderColor"),i=kr("borderRadius"),o=kr("borderSpacing"),a=kr("borderWidth"),l=kr("contrast"),c=kr("grayscale"),u=kr("hueRotate"),d=kr("invert"),h=kr("gap"),f=kr("gradientColorStops"),p=kr("gradientColorStopPositions"),m=kr("inset"),y=kr("margin"),g=kr("opacity"),_=kr("padding"),v=kr("saturate"),w=kr("scale"),x=kr("sepia"),M=kr("skew"),T=kr("space"),S=kr("translate"),k=()=>["auto","contain","none"],$=()=>["auto","hidden","clip","visible","scroll"],j=()=>["auto",zt,e],V=()=>[zt,e],L=()=>["",yo,oa],X=()=>["auto",tu,zt],K=()=>["bottom","center","left","left-bottom","left-top","right","right-bottom","right-top","top"],Y=()=>["solid","dashed","dotted","double","none"],J=()=>["normal","multiply","screen","overlay","darken","lighten","color-dodge","color-burn","hard-light","soft-light","difference","exclusion","hue","saturation","color","luminosity"],N=()=>["start","end","center","between","around","evenly","stretch"],ne=()=>["","0",zt],te=()=>["auto","avoid","all","avoid-page","page","left","right","column"],z=()=>[tu,zt];return{cacheSize:500,separator:":",theme:{colors:[Id],spacing:[yo,oa],blur:["none","",aa,zt],brightness:z(),borderColor:[t],borderRadius:["none","","full",aa,zt],borderSpacing:V(),borderWidth:L(),contrast:z(),grayscale:ne(),hueRotate:z(),invert:ne(),gap:V(),gradientColorStops:[t],gradientColorStopPositions:[YG,oa],inset:j(),margin:j(),opacity:z(),padding:V(),saturate:z(),scale:z(),sepia:ne(),skew:z(),space:V(),translate:V()},classGroups:{aspect:[{aspect:["auto","square","video",zt]}],container:["container"],columns:[{columns:[aa]}],"break-after":[{"break-after":te()}],"break-before":[{"break-before":te()}],"break-inside":[{"break-inside":["auto","avoid","avoid-page","avoid-column"]}],"box-decoration":[{"box-decoration":["slice","clone"]}],box:[{box:["border","content"]}],display:["block","inline-block","inline","flex","inline-flex","table","inline-table","table-caption","table-cell","table-column","table-column-group","table-footer-group","table-header-group","table-row-group","table-row","flow-root","grid","inline-grid","contents","list-item","hidden"],float:[{float:["right","left","none","start","end"]}],clear:[{clear:["left","right","both","none","start","end"]}],isolation:["isolate","isolation-auto"],"object-fit":[{object:["contain","cover","fill","none","scale-down"]}],"object-position":[{object:[...K(),zt]}],overflow:[{overflow:$()}],"overflow-x":[{"overflow-x":$()}],"overflow-y":[{"overflow-y":$()}],overscroll:[{overscroll:k()}],"overscroll-x":[{"overscroll-x":k()}],"overscroll-y":[{"overscroll-y":k()}],position:["static","fixed","absolute","relative","sticky"],inset:[{inset:[m]}],"inset-x":[{"inset-x":[m]}],"inset-y":[{"inset-y":[m]}],start:[{start:[m]}],end:[{end:[m]}],top:[{top:[m]}],right:[{right:[m]}],bottom:[{bottom:[m]}],left:[{left:[m]}],visibility:["visible","invisible","collapse"],z:[{z:["auto",Dd,zt]}],basis:[{basis:j()}],"flex-direction":[{flex:["row","row-reverse","col","col-reverse"]}],"flex-wrap":[{flex:["wrap","wrap-reverse","nowrap"]}],flex:[{flex:["1","auto","initial","none",zt]}],grow:[{grow:ne()}],shrink:[{shrink:ne()}],order:[{order:["first","last","none",Dd,zt]}],"grid-cols":[{"grid-cols":[Id]}],"col-start-end":[{col:["auto",{span:["full",Dd,zt]},zt]}],"col-start":[{"col-start":X()}],"col-end":[{"col-end":X()}],"grid-rows":[{"grid-rows":[Id]}],"row-start-end":[{row:["auto",{span:[Dd,zt]},zt]}],"row-start":[{"row-start":X()}],"row-end":[{"row-end":X()}],"grid-flow":[{"grid-flow":["row","col","dense","row-dense","col-dense"]}],"auto-cols":[{"auto-cols":["auto","min","max","fr",zt]}],"auto-rows":[{"auto-rows":["auto","min","max","fr",zt]}],gap:[{gap:[h]}],"gap-x":[{"gap-x":[h]}],"gap-y":[{"gap-y":[h]}],"justify-content":[{justify:["normal",...N()]}],"justify-items":[{"justify-items":["start","end","center","stretch"]}],"justify-self":[{"justify-self":["auto","start","end","center","stretch"]}],"align-content":[{content:["normal",...N(),"baseline"]}],"align-items":[{items:["start","end","center","baseline","stretch"]}],"align-self":[{self:["auto","start","end","center","stretch","baseline"]}],"place-content":[{"place-content":[...N(),"baseline"]}],"place-items":[{"place-items":["start","end","center","baseline","stretch"]}],"place-self":[{"place-self":["auto","start","end","center","stretch"]}],p:[{p:[_]}],px:[{px:[_]}],py:[{py:[_]}],ps:[{ps:[_]}],pe:[{pe:[_]}],pt:[{pt:[_]}],pr:[{pr:[_]}],pb:[{pb:[_]}],pl:[{pl:[_]}],m:[{m:[y]}],mx:[{mx:[y]}],my:[{my:[y]}],ms:[{ms:[y]}],me:[{me:[y]}],mt:[{mt:[y]}],mr:[{mr:[y]}],mb:[{mb:[y]}],ml:[{ml:[y]}],"space-x":[{"space-x":[T]}],"space-x-reverse":["space-x-reverse"],"space-y":[{"space-y":[T]}],"space-y-reverse":["space-y-reverse"],w:[{w:["auto","min","max","fit","svw","lvw","dvw",zt,e]}],"min-w":[{"min-w":[zt,e,"min","max","fit"]}],"max-w":[{"max-w":[zt,e,"none","full","min","max","fit","prose",{screen:[aa]},aa]}],h:[{h:[zt,e,"auto","min","max","fit","svh","lvh","dvh"]}],"min-h":[{"min-h":[zt,e,"min","max","fit","svh","lvh","dvh"]}],"max-h":[{"max-h":[zt,e,"min","max","fit","svh","lvh","dvh"]}],size:[{size:[zt,e,"auto","min","max","fit"]}],"font-size":[{text:["base",aa,oa]}],"font-smoothing":["antialiased","subpixel-antialiased"],"font-style":["italic","not-italic"],"font-weight":[{font:["thin","extralight","light","normal","medium","semibold","bold","extrabold","black",Ty]}],"font-family":[{font:[Id]}],"fvn-normal":["normal-nums"],"fvn-ordinal":["ordinal"],"fvn-slashed-zero":["slashed-zero"],"fvn-figure":["lining-nums","oldstyle-nums"],"fvn-spacing":["proportional-nums","tabular-nums"],"fvn-fraction":["diagonal-fractions","stacked-fractons"],tracking:[{tracking:["tighter","tight","normal","wide","wider","widest",zt]}],"line-clamp":[{"line-clamp":["none",tu,Ty]}],leading:[{leading:["none","tight","snug","normal","relaxed","loose",yo,zt]}],"list-image":[{"list-image":["none",zt]}],"list-style-type":[{list:["none","disc","decimal",zt]}],"list-style-position":[{list:["inside","outside"]}],"placeholder-color":[{placeholder:[t]}],"placeholder-opacity":[{"placeholder-opacity":[g]}],"text-alignment":[{text:["left","center","right","justify","start","end"]}],"text-color":[{text:[t]}],"text-opacity":[{"text-opacity":[g]}],"text-decoration":["underline","overline","line-through","no-underline"],"text-decoration-style":[{decoration:[...Y(),"wavy"]}],"text-decoration-thickness":[{decoration:["auto","from-font",yo,oa]}],"underline-offset":[{"underline-offset":["auto",yo,zt]}],"text-decoration-color":[{decoration:[t]}],"text-transform":["uppercase","lowercase","capitalize","normal-case"],"text-overflow":["truncate","text-ellipsis","text-clip"],"text-wrap":[{text:["wrap","nowrap","balance","pretty"]}],indent:[{indent:V()}],"vertical-align":[{align:["baseline","top","middle","bottom","text-top","text-bottom","sub","super",zt]}],whitespace:[{whitespace:["normal","nowrap","pre","pre-line","pre-wrap","break-spaces"]}],break:[{break:["normal","words","all","keep"]}],hyphens:[{hyphens:["none","manual","auto"]}],content:[{content:["none",zt]}],"bg-attachment":[{bg:["fixed","local","scroll"]}],"bg-clip":[{"bg-clip":["border","padding","content","text"]}],"bg-opacity":[{"bg-opacity":[g]}],"bg-origin":[{"bg-origin":["border","padding","content"]}],"bg-position":[{bg:[...K(),ZG]}],"bg-repeat":[{bg:["no-repeat",{repeat:["","x","y","round","space"]}]}],"bg-size":[{bg:["auto","cover","contain",JG]}],"bg-image":[{bg:["none",{"gradient-to":["t","tr","r","br","b","bl","l","tl"]},t8]}],"bg-color":[{bg:[t]}],"gradient-from-pos":[{from:[p]}],"gradient-via-pos":[{via:[p]}],"gradient-to-pos":[{to:[p]}],"gradient-from":[{from:[f]}],"gradient-via":[{via:[f]}],"gradient-to":[{to:[f]}],rounded:[{rounded:[i]}],"rounded-s":[{"rounded-s":[i]}],"rounded-e":[{"rounded-e":[i]}],"rounded-t":[{"rounded-t":[i]}],"rounded-r":[{"rounded-r":[i]}],"rounded-b":[{"rounded-b":[i]}],"rounded-l":[{"rounded-l":[i]}],"rounded-ss":[{"rounded-ss":[i]}],"rounded-se":[{"rounded-se":[i]}],"rounded-ee":[{"rounded-ee":[i]}],"rounded-es":[{"rounded-es":[i]}],"rounded-tl":[{"rounded-tl":[i]}],"rounded-tr":[{"rounded-tr":[i]}],"rounded-br":[{"rounded-br":[i]}],"rounded-bl":[{"rounded-bl":[i]}],"border-w":[{border:[a]}],"border-w-x":[{"border-x":[a]}],"border-w-y":[{"border-y":[a]}],"border-w-s":[{"border-s":[a]}],"border-w-e":[{"border-e":[a]}],"border-w-t":[{"border-t":[a]}],"border-w-r":[{"border-r":[a]}],"border-w-b":[{"border-b":[a]}],"border-w-l":[{"border-l":[a]}],"border-opacity":[{"border-opacity":[g]}],"border-style":[{border:[...Y(),"hidden"]}],"divide-x":[{"divide-x":[a]}],"divide-x-reverse":["divide-x-reverse"],"divide-y":[{"divide-y":[a]}],"divide-y-reverse":["divide-y-reverse"],"divide-opacity":[{"divide-opacity":[g]}],"divide-style":[{divide:Y()}],"border-color":[{border:[s]}],"border-color-x":[{"border-x":[s]}],"border-color-y":[{"border-y":[s]}],"border-color-s":[{"border-s":[s]}],"border-color-e":[{"border-e":[s]}],"border-color-t":[{"border-t":[s]}],"border-color-r":[{"border-r":[s]}],"border-color-b":[{"border-b":[s]}],"border-color-l":[{"border-l":[s]}],"divide-color":[{divide:[s]}],"outline-style":[{outline:["",...Y()]}],"outline-offset":[{"outline-offset":[yo,zt]}],"outline-w":[{outline:[yo,oa]}],"outline-color":[{outline:[t]}],"ring-w":[{ring:L()}],"ring-w-inset":["ring-inset"],"ring-color":[{ring:[t]}],"ring-opacity":[{"ring-opacity":[g]}],"ring-offset-w":[{"ring-offset":[yo,oa]}],"ring-offset-color":[{"ring-offset":[t]}],shadow:[{shadow:["","inner","none",aa,r8]}],"shadow-color":[{shadow:[Id]}],opacity:[{opacity:[g]}],"mix-blend":[{"mix-blend":[...J(),"plus-lighter","plus-darker"]}],"bg-blend":[{"bg-blend":J()}],filter:[{filter:["","none"]}],blur:[{blur:[r]}],brightness:[{brightness:[n]}],contrast:[{contrast:[l]}],"drop-shadow":[{"drop-shadow":["","none",aa,zt]}],grayscale:[{grayscale:[c]}],"hue-rotate":[{"hue-rotate":[u]}],invert:[{invert:[d]}],saturate:[{saturate:[v]}],sepia:[{sepia:[x]}],"backdrop-filter":[{"backdrop-filter":["","none"]}],"backdrop-blur":[{"backdrop-blur":[r]}],"backdrop-brightness":[{"backdrop-brightness":[n]}],"backdrop-contrast":[{"backdrop-contrast":[l]}],"backdrop-grayscale":[{"backdrop-grayscale":[c]}],"backdrop-hue-rotate":[{"backdrop-hue-rotate":[u]}],"backdrop-invert":[{"backdrop-invert":[d]}],"backdrop-opacity":[{"backdrop-opacity":[g]}],"backdrop-saturate":[{"backdrop-saturate":[v]}],"backdrop-sepia":[{"backdrop-sepia":[x]}],"border-collapse":[{border:["collapse","separate"]}],"border-spacing":[{"border-spacing":[o]}],"border-spacing-x":[{"border-spacing-x":[o]}],"border-spacing-y":[{"border-spacing-y":[o]}],"table-layout":[{table:["auto","fixed"]}],caption:[{caption:["top","bottom"]}],transition:[{transition:["none","all","","colors","opacity","shadow","transform",zt]}],duration:[{duration:z()}],ease:[{ease:["linear","in","out","in-out",zt]}],delay:[{delay:z()}],animate:[{animate:["none","spin","ping","pulse","bounce",zt]}],transform:[{transform:["","gpu","none"]}],scale:[{scale:[w]}],"scale-x":[{"scale-x":[w]}],"scale-y":[{"scale-y":[w]}],rotate:[{rotate:[Dd,zt]}],"translate-x":[{"translate-x":[S]}],"translate-y":[{"translate-y":[S]}],"skew-x":[{"skew-x":[M]}],"skew-y":[{"skew-y":[M]}],"transform-origin":[{origin:["center","top","top-right","right","bottom-right","bottom","bottom-left","left","top-left",zt]}],accent:[{accent:["auto",t]}],appearance:[{appearance:["none","auto"]}],cursor:[{cursor:["auto","default","pointer","wait","text","move","help","not-allowed","none","context-menu","progress","cell","crosshair","vertical-text","alias","copy","no-drop","grab","grabbing","all-scroll","col-resize","row-resize","n-resize","e-resize","s-resize","w-resize","ne-resize","nw-resize","se-resize","sw-resize","ew-resize","ns-resize","nesw-resize","nwse-resize","zoom-in","zoom-out",zt]}],"caret-color":[{caret:[t]}],"pointer-events":[{"pointer-events":["none","auto"]}],resize:[{resize:["none","y","x",""]}],"scroll-behavior":[{scroll:["auto","smooth"]}],"scroll-m":[{"scroll-m":V()}],"scroll-mx":[{"scroll-mx":V()}],"scroll-my":[{"scroll-my":V()}],"scroll-ms":[{"scroll-ms":V()}],"scroll-me":[{"scroll-me":V()}],"scroll-mt":[{"scroll-mt":V()}],"scroll-mr":[{"scroll-mr":V()}],"scroll-mb":[{"scroll-mb":V()}],"scroll-ml":[{"scroll-ml":V()}],"scroll-p":[{"scroll-p":V()}],"scroll-px":[{"scroll-px":V()}],"scroll-py":[{"scroll-py":V()}],"scroll-ps":[{"scroll-ps":V()}],"scroll-pe":[{"scroll-pe":V()}],"scroll-pt":[{"scroll-pt":V()}],"scroll-pr":[{"scroll-pr":V()}],"scroll-pb":[{"scroll-pb":V()}],"scroll-pl":[{"scroll-pl":V()}],"snap-align":[{snap:["start","end","center","align-none"]}],"snap-stop":[{snap:["normal","always"]}],"snap-type":[{snap:["none","x","y","both"]}],"snap-strictness":[{snap:["mandatory","proximity"]}],touch:[{touch:["auto","none","manipulation"]}],"touch-x":[{"touch-pan":["x","left","right"]}],"touch-y":[{"touch-pan":["y","up","down"]}],"touch-pz":["touch-pinch-zoom"],select:[{select:["none","text","all","auto"]}],"will-change":[{"will-change":["auto","scroll","contents","transform",zt]}],fill:[{fill:[t,"none"]}],"stroke-w":[{stroke:[yo,oa,Ty]}],stroke:[{stroke:[t,"none"]}],sr:["sr-only","not-sr-only"],"forced-color-adjust":[{"forced-color-adjust":["auto","none"]}]},conflictingClassGroups:{overflow:["overflow-x","overflow-y"],overscroll:["overscroll-x","overscroll-y"],inset:["inset-x","inset-y","start","end","top","right","bottom","left"],"inset-x":["right","left"],"inset-y":["top","bottom"],flex:["basis","grow","shrink"],gap:["gap-x","gap-y"],p:["px","py","ps","pe","pt","pr","pb","pl"],px:["pr","pl"],py:["pt","pb"],m:["mx","my","ms","me","mt","mr","mb","ml"],mx:["mr","ml"],my:["mt","mb"],size:["w","h"],"font-size":["leading"],"fvn-normal":["fvn-ordinal","fvn-slashed-zero","fvn-figure","fvn-spacing","fvn-fraction"],"fvn-ordinal":["fvn-normal"],"fvn-slashed-zero":["fvn-normal"],"fvn-figure":["fvn-normal"],"fvn-spacing":["fvn-normal"],"fvn-fraction":["fvn-normal"],"line-clamp":["display","overflow"],rounded:["rounded-s","rounded-e","rounded-t","rounded-r","rounded-b","rounded-l","rounded-ss","rounded-se","rounded-ee","rounded-es","rounded-tl","rounded-tr","rounded-br","rounded-bl"],"rounded-s":["rounded-ss","rounded-es"],"rounded-e":["rounded-se","rounded-ee"],"rounded-t":["rounded-tl","rounded-tr"],"rounded-r":["rounded-tr","rounded-br"],"rounded-b":["rounded-br","rounded-bl"],"rounded-l":["rounded-tl","rounded-bl"],"border-spacing":["border-spacing-x","border-spacing-y"],"border-w":["border-w-s","border-w-e","border-w-t","border-w-r","border-w-b","border-w-l"],"border-w-x":["border-w-r","border-w-l"],"border-w-y":["border-w-t","border-w-b"],"border-color":["border-color-s","border-color-e","border-color-t","border-color-r","border-color-b","border-color-l"],"border-color-x":["border-color-r","border-color-l"],"border-color-y":["border-color-t","border-color-b"],"scroll-m":["scroll-mx","scroll-my","scroll-ms","scroll-me","scroll-mt","scroll-mr","scroll-mb","scroll-ml"],"scroll-mx":["scroll-mr","scroll-ml"],"scroll-my":["scroll-mt","scroll-mb"],"scroll-p":["scroll-px","scroll-py","scroll-ps","scroll-pe","scroll-pt","scroll-pr","scroll-pb","scroll-pl"],"scroll-px":["scroll-pr","scroll-pl"],"scroll-py":["scroll-pt","scroll-pb"],touch:["touch-x","touch-y","touch-pz"],"touch-x":["touch"],"touch-y":["touch"],"touch-pz":["touch"]},conflictingClassGroupModifiers:{"font-size":["leading"]}}},a8=VG(o8);function tr(...t){return a8(LL(t))}const l8=yG,GL=D.forwardRef(({className:t,...e},r)=>G.jsx(kL,{ref:r,className:tr("fixed top-0 z-[100] flex max-h-screen w-full flex-col-reverse p-4 sm:bottom-0 sm:right-0 sm:top-auto sm:flex-col md:max-w-[420px]",t),...e}));GL.displayName=kL.displayName;const c8=q1("group pointer-events-auto relative flex w-full items-center justify-between space-x-4 overflow-hidden rounded-md border p-6 pr-8 shadow-lg transition-all data-[swipe=cancel]:translate-x-0 data-[swipe=end]:translate-x-[var(--radix-toast-swipe-end-x)] data-[swipe=move]:translate-x-[var(--radix-toast-swipe-move-x)] data-[swipe=move]:transition-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[swipe=end]:animate-out data-[state=closed]:fade-out-80 data-[state=closed]:slide-out-to-right-full data-[state=open]:slide-in-from-top-full data-[state=open]:sm:slide-in-from-bottom-full",{variants:{variant:{default:"border bg-background text-foreground",destructive:"destructive group border-destructive bg-destructive text-destructive-foreground"}},defaultVariants:{variant:"default"}}),HL=D.forwardRef(({className:t,variant:e,...r},n)=>G.jsx(AL,{ref:n,className:tr(c8({variant:e}),t),...r}));HL.displayName=AL.displayName;const u8=D.forwardRef(({className:t,...e},r)=>G.jsx(DL,{ref:r,className:tr("inline-flex h-8 shrink-0 items-center justify-center rounded-md border bg-transparent px-3 text-sm font-medium ring-offset-background transition-colors hover:bg-secondary focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 group-[.destructive]:border-muted/40 group-[.destructive]:hover:border-destructive/30 group-[.destructive]:hover:bg-destructive group-[.destructive]:hover:text-destructive-foreground group-[.destructive]:focus:ring-destructive",t),...e}));u8.displayName=DL.displayName;const KL=D.forwardRef(({className:t,...e},r)=>G.jsx(IL,{ref:r,className:tr("absolute right-2 top-2 rounded-md p-1 text-foreground/50 opacity-0 transition-opacity hover:text-foreground focus:opacity-100 focus:outline-none focus:ring-2 group-hover:opacity-100 group-[.destructive]:text-red-300 group-[.destructive]:hover:text-red-50 group-[.destructive]:focus:ring-red-400 group-[.destructive]:focus:ring-offset-red-600",t),"toast-close":"",...e,children:G.jsx(kG,{className:"h-4 w-4"})}));KL.displayName=IL.displayName;const XL=D.forwardRef(({className:t,...e},r)=>G.jsx($L,{ref:r,className:tr("text-sm font-semibold",t),...e}));XL.displayName=$L.displayName;const qL=D.forwardRef(({className:t,...e},r)=>G.jsx(OL,{ref:r,className:tr("text-sm opacity-90",t),...e}));qL.displayName=OL.displayName;function d8(){const{toasts:t}=k5();return G.jsxs(l8,{children:[t.map(function({id:e,title:r,description:n,action:s,...i}){return G.jsxs(HL,{...i,children:[G.jsxs("div",{className:"grid gap-1",children:[r&&G.jsx(XL,{children:r}),n&&G.jsx(qL,{children:n})]}),s,G.jsx(KL,{})]},e)}),G.jsx(GL,{})]})}var D2=["light","dark"],h8="(prefers-color-scheme: dark)",f8=D.createContext(void 0),p8={setTheme:t=>{},themes:[]},m8=()=>{var t;return(t=D.useContext(f8))!=null?t:p8};D.memo(({forcedTheme:t,storageKey:e,attribute:r,enableSystem:n,enableColorScheme:s,defaultTheme:i,value:o,attrs:a,nonce:l})=>{let c=i==="system",u=r==="class"?`var d=document.documentElement,c=d.classList;${`c.remove(${a.map(p=>`'${p}'`).join(",")})`};`:`var d=document.documentElement,n='${r}',s='setAttribute';`,d=s?D2.includes(i)&&i?`if(e==='light'||e==='dark'||!e)d.style.colorScheme=e||'${i}'`:"if(e==='light'||e==='dark')d.style.colorScheme=e":"",h=(p,m=!1,y=!0)=>{let g=o?o[p]:p,_=m?p+"|| ''":`'${g}'`,v="";return s&&y&&!m&&D2.includes(p)&&(v+=`d.style.colorScheme = '${p}';`),r==="class"?m||g?v+=`c.add(${_})`:v+="null":g&&(v+=`d[s](n,${_})`),v},f=t?`!function(){${u}${h(t)}}()`:n?`!function(){try{${u}var e=localStorage.getItem('${e}');if('system'===e||(!e&&${c})){var t='${h8}',m=window.matchMedia(t);if(m.media!==t||m.matches){${h("dark")}}else{${h("light")}}}else if(e){${o?`var x=${JSON.stringify(o)};`:""}${h(o?"x[e]":"e",!0)}}${c?"":"else{"+h(i,!1,!1)+"}"}${d}}catch(e){}}()`:`!function(){try{${u}var e=localStorage.getItem('${e}');if(e){${o?`var x=${JSON.stringify(o)};`:""}${h(o?"x[e]":"e",!0)}}else{${h(i,!1,!1)};}${d}}catch(t){}}();`;return D.createElement("script",{nonce:l,dangerouslySetInnerHTML:{__html:f}})});var g8=t=>{switch(t){case"success":return v8;case"info":return x8;case"warning":return w8;case"error":return b8;default:return null}},_8=Array(12).fill(0),y8=({visible:t})=>st.createElement("div",{className:"sonner-loading-wrapper","data-visible":t},st.createElement("div",{className:"sonner-spinner"},_8.map((e,r)=>st.createElement("div",{className:"sonner-loading-bar",key:`spinner-bar-${r}`})))),v8=st.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",height:"20",width:"20"},st.createElement("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.857-9.809a.75.75 0 00-1.214-.882l-3.483 4.79-1.88-1.88a.75.75 0 10-1.06 1.061l2.5 2.5a.75.75 0 001.137-.089l4-5.5z",clipRule:"evenodd"})),w8=st.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",height:"20",width:"20"},st.createElement("path",{fillRule:"evenodd",d:"M9.401 3.003c1.155-2 4.043-2 5.197 0l7.355 12.748c1.154 2-.29 4.5-2.599 4.5H4.645c-2.309 0-3.752-2.5-2.598-4.5L9.4 3.003zM12 8.25a.75.75 0 01.75.75v3.75a.75.75 0 01-1.5 0V9a.75.75 0 01.75-.75zm0 8.25a.75.75 0 100-1.5.75.75 0 000 1.5z",clipRule:"evenodd"})),x8=st.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",height:"20",width:"20"},st.createElement("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a.75.75 0 000 1.5h.253a.25.25 0 01.244.304l-.459 2.066A1.75 1.75 0 0010.747 15H11a.75.75 0 000-1.5h-.253a.25.25 0 01-.244-.304l.459-2.066A1.75 1.75 0 009.253 9H9z",clipRule:"evenodd"})),b8=st.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",height:"20",width:"20"},st.createElement("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-8-5a.75.75 0 01.75.75v4.5a.75.75 0 01-1.5 0v-4.5A.75.75 0 0110 5zm0 10a1 1 0 100-2 1 1 0 000 2z",clipRule:"evenodd"})),M8=()=>{let[t,e]=st.useState(document.hidden);return st.useEffect(()=>{let r=()=>{e(document.hidden)};return document.addEventListener("visibilitychange",r),()=>window.removeEventListener("visibilitychange",r)},[]),t},Hw=1,T8=class{constructor(){this.subscribe=e=>(this.subscribers.push(e),()=>{let r=this.subscribers.indexOf(e);this.subscribers.splice(r,1)}),this.publish=e=>{this.subscribers.forEach(r=>r(e))},this.addToast=e=>{this.publish(e),this.toasts=[...this.toasts,e]},this.create=e=>{var r;let{message:n,...s}=e,i=typeof(e==null?void 0:e.id)=="number"||((r=e.id)==null?void 0:r.length)>0?e.id:Hw++,o=this.toasts.find(l=>l.id===i),a=e.dismissible===void 0?!0:e.dismissible;return o?this.toasts=this.toasts.map(l=>l.id===i?(this.publish({...l,...e,id:i,title:n}),{...l,...e,id:i,dismissible:a,title:n}):l):this.addToast({title:n,...s,dismissible:a,id:i}),i},this.dismiss=e=>(e||this.toasts.forEach(r=>{this.subscribers.forEach(n=>n({id:r.id,dismiss:!0}))}),this.subscribers.forEach(r=>r({id:e,dismiss:!0})),e),this.message=(e,r)=>this.create({...r,message:e}),this.error=(e,r)=>this.create({...r,message:e,type:"error"}),this.success=(e,r)=>this.create({...r,type:"success",message:e}),this.info=(e,r)=>this.create({...r,type:"info",message:e}),this.warning=(e,r)=>this.create({...r,type:"warning",message:e}),this.loading=(e,r)=>this.create({...r,type:"loading",message:e}),this.promise=(e,r)=>{if(!r)return;let n;r.loading!==void 0&&(n=this.create({...r,promise:e,type:"loading",message:r.loading,description:typeof r.description!="function"?r.description:void 0}));let s=e instanceof Promise?e:e(),i=n!==void 0;return s.then(async o=>{if(S8(o)&&!o.ok){i=!1;let a=typeof r.error=="function"?await r.error(`HTTP error! status: ${o.status}`):r.error,l=typeof r.description=="function"?await r.description(`HTTP error! status: ${o.status}`):r.description;this.create({id:n,type:"error",message:a,description:l})}else if(r.success!==void 0){i=!1;let a=typeof r.success=="function"?await r.success(o):r.success,l=typeof r.description=="function"?await r.description(o):r.description;this.create({id:n,type:"success",message:a,description:l})}}).catch(async o=>{if(r.error!==void 0){i=!1;let a=typeof r.error=="function"?await r.error(o):r.error,l=typeof r.description=="function"?await r.description(o):r.description;this.create({id:n,type:"error",message:a,description:l})}}).finally(()=>{var o;i&&(this.dismiss(n),n=void 0),(o=r.finally)==null||o.call(r)}),n},this.custom=(e,r)=>{let n=(r==null?void 0:r.id)||Hw++;return this.create({jsx:e(n),id:n,...r}),n},this.subscribers=[],this.toasts=[]}},Ps=new T8,C8=(t,e)=>{let r=(e==null?void 0:e.id)||Hw++;return Ps.addToast({title:t,...e,id:r}),r},S8=t=>t&&typeof t=="object"&&"ok"in t&&typeof t.ok=="boolean"&&"status"in t&&typeof t.status=="number",E8=C8,P8=()=>Ps.toasts;Object.assign(E8,{success:Ps.success,info:Ps.info,warning:Ps.warning,error:Ps.error,custom:Ps.custom,message:Ps.message,promise:Ps.promise,dismiss:Ps.dismiss,loading:Ps.loading},{getHistory:P8});function k8(t,{insertAt:e}={}){if(typeof document>"u")return;let r=document.head||document.getElementsByTagName("head")[0],n=document.createElement("style");n.type="text/css",e==="top"&&r.firstChild?r.insertBefore(n,r.firstChild):r.appendChild(n),n.styleSheet?n.styleSheet.cssText=t:n.appendChild(document.createTextNode(t))}k8(`:where(html[dir="ltr"]),:where([data-sonner-toaster][dir="ltr"]){--toast-icon-margin-start: -3px;--toast-icon-margin-end: 4px;--toast-svg-margin-start: -1px;--toast-svg-margin-end: 0px;--toast-button-margin-start: auto;--toast-button-margin-end: 0;--toast-close-button-start: 0;--toast-close-button-end: unset;--toast-close-button-transform: translate(-35%, -35%)}:where(html[dir="rtl"]),:where([data-sonner-toaster][dir="rtl"]){--toast-icon-margin-start: 4px;--toast-icon-margin-end: -3px;--toast-svg-margin-start: 0px;--toast-svg-margin-end: -1px;--toast-button-margin-start: 0;--toast-button-margin-end: auto;--toast-close-button-start: unset;--toast-close-button-end: 0;--toast-close-button-transform: translate(35%, -35%)}:where([data-sonner-toaster]){position:fixed;width:var(--width);font-family:ui-sans-serif,system-ui,-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica Neue,Arial,Noto Sans,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol,Noto Color Emoji;--gray1: hsl(0, 0%, 99%);--gray2: hsl(0, 0%, 97.3%);--gray3: hsl(0, 0%, 95.1%);--gray4: hsl(0, 0%, 93%);--gray5: hsl(0, 0%, 90.9%);--gray6: hsl(0, 0%, 88.7%);--gray7: hsl(0, 0%, 85.8%);--gray8: hsl(0, 0%, 78%);--gray9: hsl(0, 0%, 56.1%);--gray10: hsl(0, 0%, 52.3%);--gray11: hsl(0, 0%, 43.5%);--gray12: hsl(0, 0%, 9%);--border-radius: 8px;box-sizing:border-box;padding:0;margin:0;list-style:none;outline:none;z-index:999999999}:where([data-sonner-toaster][data-x-position="right"]){right:max(var(--offset),env(safe-area-inset-right))}:where([data-sonner-toaster][data-x-position="left"]){left:max(var(--offset),env(safe-area-inset-left))}:where([data-sonner-toaster][data-x-position="center"]){left:50%;transform:translate(-50%)}:where([data-sonner-toaster][data-y-position="top"]){top:max(var(--offset),env(safe-area-inset-top))}:where([data-sonner-toaster][data-y-position="bottom"]){bottom:max(var(--offset),env(safe-area-inset-bottom))}:where([data-sonner-toast]){--y: translateY(100%);--lift-amount: calc(var(--lift) * var(--gap));z-index:var(--z-index);position:absolute;opacity:0;transform:var(--y);filter:blur(0);touch-action:none;transition:transform .4s,opacity .4s,height .4s,box-shadow .2s;box-sizing:border-box;outline:none;overflow-wrap:anywhere}:where([data-sonner-toast][data-styled="true"]){padding:16px;background:var(--normal-bg);border:1px solid var(--normal-border);color:var(--normal-text);border-radius:var(--border-radius);box-shadow:0 4px 12px #0000001a;width:var(--width);font-size:13px;display:flex;align-items:center;gap:6px}:where([data-sonner-toast]:focus-visible){box-shadow:0 4px 12px #0000001a,0 0 0 2px #0003}:where([data-sonner-toast][data-y-position="top"]){top:0;--y: translateY(-100%);--lift: 1;--lift-amount: calc(1 * var(--gap))}:where([data-sonner-toast][data-y-position="bottom"]){bottom:0;--y: translateY(100%);--lift: -1;--lift-amount: calc(var(--lift) * var(--gap))}:where([data-sonner-toast]) :where([data-description]){font-weight:400;line-height:1.4;color:inherit}:where([data-sonner-toast]) :where([data-title]){font-weight:500;line-height:1.5;color:inherit}:where([data-sonner-toast]) :where([data-icon]){display:flex;height:16px;width:16px;position:relative;justify-content:flex-start;align-items:center;flex-shrink:0;margin-left:var(--toast-icon-margin-start);margin-right:var(--toast-icon-margin-end)}:where([data-sonner-toast][data-promise="true"]) :where([data-icon])>svg{opacity:0;transform:scale(.8);transform-origin:center;animation:sonner-fade-in .3s ease forwards}:where([data-sonner-toast]) :where([data-icon])>*{flex-shrink:0}:where([data-sonner-toast]) :where([data-icon]) svg{margin-left:var(--toast-svg-margin-start);margin-right:var(--toast-svg-margin-end)}:where([data-sonner-toast]) :where([data-content]){display:flex;flex-direction:column;gap:2px}[data-sonner-toast][data-styled=true] [data-button]{border-radius:4px;padding-left:8px;padding-right:8px;height:24px;font-size:12px;color:var(--normal-bg);background:var(--normal-text);margin-left:var(--toast-button-margin-start);margin-right:var(--toast-button-margin-end);border:none;cursor:pointer;outline:none;display:flex;align-items:center;flex-shrink:0;transition:opacity .4s,box-shadow .2s}:where([data-sonner-toast]) :where([data-button]):focus-visible{box-shadow:0 0 0 2px #0006}:where([data-sonner-toast]) :where([data-button]):first-of-type{margin-left:var(--toast-button-margin-start);margin-right:var(--toast-button-margin-end)}:where([data-sonner-toast]) :where([data-cancel]){color:var(--normal-text);background:rgba(0,0,0,.08)}:where([data-sonner-toast][data-theme="dark"]) :where([data-cancel]){background:rgba(255,255,255,.3)}:where([data-sonner-toast]) :where([data-close-button]){position:absolute;left:var(--toast-close-button-start);right:var(--toast-close-button-end);top:0;height:20px;width:20px;display:flex;justify-content:center;align-items:center;padding:0;background:var(--gray1);color:var(--gray12);border:1px solid var(--gray4);transform:var(--toast-close-button-transform);border-radius:50%;cursor:pointer;z-index:1;transition:opacity .1s,background .2s,border-color .2s}:where([data-sonner-toast]) :where([data-close-button]):focus-visible{box-shadow:0 4px 12px #0000001a,0 0 0 2px #0003}:where([data-sonner-toast]) :where([data-disabled="true"]){cursor:not-allowed}:where([data-sonner-toast]):hover :where([data-close-button]):hover{background:var(--gray2);border-color:var(--gray5)}:where([data-sonner-toast][data-swiping="true"]):before{content:"";position:absolute;left:0;right:0;height:100%;z-index:-1}:where([data-sonner-toast][data-y-position="top"][data-swiping="true"]):before{bottom:50%;transform:scaleY(3) translateY(50%)}:where([data-sonner-toast][data-y-position="bottom"][data-swiping="true"]):before{top:50%;transform:scaleY(3) translateY(-50%)}:where([data-sonner-toast][data-swiping="false"][data-removed="true"]):before{content:"";position:absolute;inset:0;transform:scaleY(2)}:where([data-sonner-toast]):after{content:"";position:absolute;left:0;height:calc(var(--gap) + 1px);bottom:100%;width:100%}:where([data-sonner-toast][data-mounted="true"]){--y: translateY(0);opacity:1}:where([data-sonner-toast][data-expanded="false"][data-front="false"]){--scale: var(--toasts-before) * .05 + 1;--y: translateY(calc(var(--lift-amount) * var(--toasts-before))) scale(calc(-1 * var(--scale)));height:var(--front-toast-height)}:where([data-sonner-toast])>*{transition:opacity .4s}:where([data-sonner-toast][data-expanded="false"][data-front="false"][data-styled="true"])>*{opacity:0}:where([data-sonner-toast][data-visible="false"]){opacity:0;pointer-events:none}:where([data-sonner-toast][data-mounted="true"][data-expanded="true"]){--y: translateY(calc(var(--lift) * var(--offset)));height:var(--initial-height)}:where([data-sonner-toast][data-removed="true"][data-front="true"][data-swipe-out="false"]){--y: translateY(calc(var(--lift) * -100%));opacity:0}:where([data-sonner-toast][data-removed="true"][data-front="false"][data-swipe-out="false"][data-expanded="true"]){--y: translateY(calc(var(--lift) * var(--offset) + var(--lift) * -100%));opacity:0}:where([data-sonner-toast][data-removed="true"][data-front="false"][data-swipe-out="false"][data-expanded="false"]){--y: translateY(40%);opacity:0;transition:transform .5s,opacity .2s}:where([data-sonner-toast][data-removed="true"][data-front="false"]):before{height:calc(var(--initial-height) + 20%)}[data-sonner-toast][data-swiping=true]{transform:var(--y) translateY(var(--swipe-amount, 0px));transition:none}[data-sonner-toast][data-swipe-out=true][data-y-position=bottom],[data-sonner-toast][data-swipe-out=true][data-y-position=top]{animation:swipe-out .2s ease-out forwards}@keyframes swipe-out{0%{transform:translateY(calc(var(--lift) * var(--offset) + var(--swipe-amount)));opacity:1}to{transform:translateY(calc(var(--lift) * var(--offset) + var(--swipe-amount) + var(--lift) * -100%));opacity:0}}@media (max-width: 600px){[data-sonner-toaster]{position:fixed;--mobile-offset: 16px;right:var(--mobile-offset);left:var(--mobile-offset);width:100%}[data-sonner-toaster] [data-sonner-toast]{left:0;right:0;width:calc(100% - var(--mobile-offset) * 2)}[data-sonner-toaster][data-x-position=left]{left:var(--mobile-offset)}[data-sonner-toaster][data-y-position=bottom]{bottom:20px}[data-sonner-toaster][data-y-position=top]{top:20px}[data-sonner-toaster][data-x-position=center]{left:var(--mobile-offset);right:var(--mobile-offset);transform:none}}[data-sonner-toaster][data-theme=light]{--normal-bg: #fff;--normal-border: var(--gray4);--normal-text: var(--gray12);--success-bg: hsl(143, 85%, 96%);--success-border: hsl(145, 92%, 91%);--success-text: hsl(140, 100%, 27%);--info-bg: hsl(208, 100%, 97%);--info-border: hsl(221, 91%, 91%);--info-text: hsl(210, 92%, 45%);--warning-bg: hsl(49, 100%, 97%);--warning-border: hsl(49, 91%, 91%);--warning-text: hsl(31, 92%, 45%);--error-bg: hsl(359, 100%, 97%);--error-border: hsl(359, 100%, 94%);--error-text: hsl(360, 100%, 45%)}[data-sonner-toaster][data-theme=light] [data-sonner-toast][data-invert=true]{--normal-bg: #000;--normal-border: hsl(0, 0%, 20%);--normal-text: var(--gray1)}[data-sonner-toaster][data-theme=dark] [data-sonner-toast][data-invert=true]{--normal-bg: #fff;--normal-border: var(--gray3);--normal-text: var(--gray12)}[data-sonner-toaster][data-theme=dark]{--normal-bg: #000;--normal-border: hsl(0, 0%, 20%);--normal-text: var(--gray1);--success-bg: hsl(150, 100%, 6%);--success-border: hsl(147, 100%, 12%);--success-text: hsl(150, 86%, 65%);--info-bg: hsl(215, 100%, 6%);--info-border: hsl(223, 100%, 12%);--info-text: hsl(216, 87%, 65%);--warning-bg: hsl(64, 100%, 6%);--warning-border: hsl(60, 100%, 12%);--warning-text: hsl(46, 87%, 65%);--error-bg: hsl(358, 76%, 10%);--error-border: hsl(357, 89%, 16%);--error-text: hsl(358, 100%, 81%)}[data-rich-colors=true][data-sonner-toast][data-type=success],[data-rich-colors=true][data-sonner-toast][data-type=success] [data-close-button]{background:var(--success-bg);border-color:var(--success-border);color:var(--success-text)}[data-rich-colors=true][data-sonner-toast][data-type=info],[data-rich-colors=true][data-sonner-toast][data-type=info] [data-close-button]{background:var(--info-bg);border-color:var(--info-border);color:var(--info-text)}[data-rich-colors=true][data-sonner-toast][data-type=warning],[data-rich-colors=true][data-sonner-toast][data-type=warning] [data-close-button]{background:var(--warning-bg);border-color:var(--warning-border);color:var(--warning-text)}[data-rich-colors=true][data-sonner-toast][data-type=error],[data-rich-colors=true][data-sonner-toast][data-type=error] [data-close-button]{background:var(--error-bg);border-color:var(--error-border);color:var(--error-text)}.sonner-loading-wrapper{--size: 16px;height:var(--size);width:var(--size);position:absolute;inset:0;z-index:10}.sonner-loading-wrapper[data-visible=false]{transform-origin:center;animation:sonner-fade-out .2s ease forwards}.sonner-spinner{position:relative;top:50%;left:50%;height:var(--size);width:var(--size)}.sonner-loading-bar{animation:sonner-spin 1.2s linear infinite;background:var(--gray11);border-radius:6px;height:8%;left:-10%;position:absolute;top:-3.9%;width:24%}.sonner-loading-bar:nth-child(1){animation-delay:-1.2s;transform:rotate(.0001deg) translate(146%)}.sonner-loading-bar:nth-child(2){animation-delay:-1.1s;transform:rotate(30deg) translate(146%)}.sonner-loading-bar:nth-child(3){animation-delay:-1s;transform:rotate(60deg) translate(146%)}.sonner-loading-bar:nth-child(4){animation-delay:-.9s;transform:rotate(90deg) translate(146%)}.sonner-loading-bar:nth-child(5){animation-delay:-.8s;transform:rotate(120deg) translate(146%)}.sonner-loading-bar:nth-child(6){animation-delay:-.7s;transform:rotate(150deg) translate(146%)}.sonner-loading-bar:nth-child(7){animation-delay:-.6s;transform:rotate(180deg) translate(146%)}.sonner-loading-bar:nth-child(8){animation-delay:-.5s;transform:rotate(210deg) translate(146%)}.sonner-loading-bar:nth-child(9){animation-delay:-.4s;transform:rotate(240deg) translate(146%)}.sonner-loading-bar:nth-child(10){animation-delay:-.3s;transform:rotate(270deg) translate(146%)}.sonner-loading-bar:nth-child(11){animation-delay:-.2s;transform:rotate(300deg) translate(146%)}.sonner-loading-bar:nth-child(12){animation-delay:-.1s;transform:rotate(330deg) translate(146%)}@keyframes sonner-fade-in{0%{opacity:0;transform:scale(.8)}to{opacity:1;transform:scale(1)}}@keyframes sonner-fade-out{0%{opacity:1;transform:scale(1)}to{opacity:0;transform:scale(.8)}}@keyframes sonner-spin{0%{opacity:1}to{opacity:.15}}@media (prefers-reduced-motion){[data-sonner-toast],[data-sonner-toast]>*,.sonner-loading-bar{transition:none!important;animation:none!important}}.sonner-loader{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);transform-origin:center;transition:opacity .2s,transform .2s}.sonner-loader[data-visible=false]{opacity:0;transform:scale(.8) translate(-50%,-50%)}
`);function Mp(t){return t.label!==void 0}var A8=3,$8="32px",O8=4e3,D8=356,I8=14,F8=20,L8=200;function R8(...t){return t.filter(Boolean).join(" ")}var j8=t=>{var e,r,n,s,i,o,a,l,c,u;let{invert:d,toast:h,unstyled:f,interacting:p,setHeights:m,visibleToasts:y,heights:g,index:_,toasts:v,expanded:w,removeToast:x,defaultRichColors:M,closeButton:T,style:S,cancelButtonStyle:k,actionButtonStyle:$,className:j="",descriptionClassName:V="",duration:L,position:X,gap:K,loadingIcon:Y,expandByDefault:J,classNames:N,icons:ne,closeButtonAriaLabel:te="Close toast",pauseWhenPageIsHidden:z,cn:O}=t,[H,re]=st.useState(!1),[_e,oe]=st.useState(!1),[pe,$e]=st.useState(!1),[Ne,de]=st.useState(!1),[q,se]=st.useState(0),[Q,Me]=st.useState(0),Te=st.useRef(null),ke=st.useRef(null),Pe=_===0,Fe=_+1<=y,Le=h.type,We=h.dismissible!==!1,Ze=h.className||"",et=h.descriptionClassName||"",Re=st.useMemo(()=>g.findIndex(R=>R.toastId===h.id)||0,[g,h.id]),qe=st.useMemo(()=>{var R;return(R=h.closeButton)!=null?R:T},[h.closeButton,T]),at=st.useMemo(()=>h.duration||L||O8,[h.duration,L]),ct=st.useRef(0),lt=st.useRef(0),Qe=st.useRef(0),je=st.useRef(null),[yt,Rt]=X.split("-"),Yt=st.useMemo(()=>g.reduce((R,le,W)=>W>=Re?R:R+le.height,0),[g,Re]),Xt=M8(),Ur=h.invert||d,wr=Le==="loading";lt.current=st.useMemo(()=>Re*K+Yt,[Re,Yt]),st.useEffect(()=>{re(!0)},[]),st.useLayoutEffect(()=>{if(!H)return;let R=ke.current,le=R.style.height;R.style.height="auto";let W=R.getBoundingClientRect().height;R.style.height=le,Me(W),m(ae=>ae.find(we=>we.toastId===h.id)?ae.map(we=>we.toastId===h.id?{...we,height:W}:we):[{toastId:h.id,height:W,position:h.position},...ae])},[H,h.title,h.description,m,h.id]);let Ct=st.useCallback(()=>{oe(!0),se(lt.current),m(R=>R.filter(le=>le.toastId!==h.id)),setTimeout(()=>{x(h)},L8)},[h,x,m,lt]);st.useEffect(()=>{if(h.promise&&Le==="loading"||h.duration===1/0||h.type==="loading")return;let R,le=at;return w||p||z&&Xt?(()=>{if(Qe.current<ct.current){let W=new Date().getTime()-ct.current;le=le-W}Qe.current=new Date().getTime()})():le!==1/0&&(ct.current=new Date().getTime(),R=setTimeout(()=>{var W;(W=h.onAutoClose)==null||W.call(h,h),Ct()},le)),()=>clearTimeout(R)},[w,p,J,h,at,Ct,h.promise,Le,z,Xt]),st.useEffect(()=>{let R=ke.current;if(R){let le=R.getBoundingClientRect().height;return Me(le),m(W=>[{toastId:h.id,height:le,position:h.position},...W]),()=>m(W=>W.filter(ae=>ae.toastId!==h.id))}},[m,h.id]),st.useEffect(()=>{h.delete&&Ct()},[Ct,h.delete]);function is(){return ne!=null&&ne.loading?st.createElement("div",{className:"sonner-loader","data-visible":Le==="loading"},ne.loading):Y?st.createElement("div",{className:"sonner-loader","data-visible":Le==="loading"},Y):st.createElement(y8,{visible:Le==="loading"})}return st.createElement("li",{"aria-live":h.important?"assertive":"polite","aria-atomic":"true",role:"status",tabIndex:0,ref:ke,className:O(j,Ze,N==null?void 0:N.toast,(e=h==null?void 0:h.classNames)==null?void 0:e.toast,N==null?void 0:N.default,N==null?void 0:N[Le],(r=h==null?void 0:h.classNames)==null?void 0:r[Le]),"data-sonner-toast":"","data-rich-colors":(n=h.richColors)!=null?n:M,"data-styled":!(h.jsx||h.unstyled||f),"data-mounted":H,"data-promise":!!h.promise,"data-removed":_e,"data-visible":Fe,"data-y-position":yt,"data-x-position":Rt,"data-index":_,"data-front":Pe,"data-swiping":pe,"data-dismissible":We,"data-type":Le,"data-invert":Ur,"data-swipe-out":Ne,"data-expanded":!!(w||J&&H),style:{"--index":_,"--toasts-before":_,"--z-index":v.length-_,"--offset":`${_e?q:lt.current}px`,"--initial-height":J?"auto":`${Q}px`,...S,...h.style},onPointerDown:R=>{wr||!We||(Te.current=new Date,se(lt.current),R.target.setPointerCapture(R.pointerId),R.target.tagName!=="BUTTON"&&($e(!0),je.current={x:R.clientX,y:R.clientY}))},onPointerUp:()=>{var R,le,W,ae;if(Ne||!We)return;je.current=null;let we=Number(((R=ke.current)==null?void 0:R.style.getPropertyValue("--swipe-amount").replace("px",""))||0),ze=new Date().getTime()-((le=Te.current)==null?void 0:le.getTime()),Ee=Math.abs(we)/ze;if(Math.abs(we)>=F8||Ee>.11){se(lt.current),(W=h.onDismiss)==null||W.call(h,h),Ct(),de(!0);return}(ae=ke.current)==null||ae.style.setProperty("--swipe-amount","0px"),$e(!1)},onPointerMove:R=>{var le;if(!je.current||!We)return;let W=R.clientY-je.current.y,ae=R.clientX-je.current.x,we=(yt==="top"?Math.min:Math.max)(0,W),ze=R.pointerType==="touch"?10:2;Math.abs(we)>ze?(le=ke.current)==null||le.style.setProperty("--swipe-amount",`${W}px`):Math.abs(ae)>ze&&(je.current=null)}},qe&&!h.jsx?st.createElement("button",{"aria-label":te,"data-disabled":wr,"data-close-button":!0,onClick:wr||!We?()=>{}:()=>{var R;Ct(),(R=h.onDismiss)==null||R.call(h,h)},className:O(N==null?void 0:N.closeButton,(s=h==null?void 0:h.classNames)==null?void 0:s.closeButton)},st.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"},st.createElement("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),st.createElement("line",{x1:"6",y1:"6",x2:"18",y2:"18"}))):null,h.jsx||st.isValidElement(h.title)?h.jsx||h.title:st.createElement(st.Fragment,null,Le||h.icon||h.promise?st.createElement("div",{"data-icon":"",className:O(N==null?void 0:N.icon,(i=h==null?void 0:h.classNames)==null?void 0:i.icon)},h.promise||h.type==="loading"&&!h.icon?h.icon||is():null,h.type!=="loading"?h.icon||(ne==null?void 0:ne[Le])||g8(Le):null):null,st.createElement("div",{"data-content":"",className:O(N==null?void 0:N.content,(o=h==null?void 0:h.classNames)==null?void 0:o.content)},st.createElement("div",{"data-title":"",className:O(N==null?void 0:N.title,(a=h==null?void 0:h.classNames)==null?void 0:a.title)},h.title),h.description?st.createElement("div",{"data-description":"",className:O(V,et,N==null?void 0:N.description,(l=h==null?void 0:h.classNames)==null?void 0:l.description)},h.description):null),st.isValidElement(h.cancel)?h.cancel:h.cancel&&Mp(h.cancel)?st.createElement("button",{"data-button":!0,"data-cancel":!0,style:h.cancelButtonStyle||k,onClick:R=>{var le,W;Mp(h.cancel)&&We&&((W=(le=h.cancel).onClick)==null||W.call(le,R),Ct())},className:O(N==null?void 0:N.cancelButton,(c=h==null?void 0:h.classNames)==null?void 0:c.cancelButton)},h.cancel.label):null,st.isValidElement(h.action)?h.action:h.action&&Mp(h.action)?st.createElement("button",{"data-button":!0,"data-action":!0,style:h.actionButtonStyle||$,onClick:R=>{var le,W;Mp(h.action)&&(R.defaultPrevented||((W=(le=h.action).onClick)==null||W.call(le,R),Ct()))},className:O(N==null?void 0:N.actionButton,(u=h==null?void 0:h.classNames)==null?void 0:u.actionButton)},h.action.label):null))};function I2(){if(typeof window>"u"||typeof document>"u")return"ltr";let t=document.documentElement.getAttribute("dir");return t==="auto"||!t?window.getComputedStyle(document.documentElement).direction:t}var N8=t=>{let{invert:e,position:r="bottom-right",hotkey:n=["altKey","KeyT"],expand:s,closeButton:i,className:o,offset:a,theme:l="light",richColors:c,duration:u,style:d,visibleToasts:h=A8,toastOptions:f,dir:p=I2(),gap:m=I8,loadingIcon:y,icons:g,containerAriaLabel:_="Notifications",pauseWhenPageIsHidden:v,cn:w=R8}=t,[x,M]=st.useState([]),T=st.useMemo(()=>Array.from(new Set([r].concat(x.filter(z=>z.position).map(z=>z.position)))),[x,r]),[S,k]=st.useState([]),[$,j]=st.useState(!1),[V,L]=st.useState(!1),[X,K]=st.useState(l!=="system"?l:typeof window<"u"&&window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"),Y=st.useRef(null),J=n.join("+").replace(/Key/g,"").replace(/Digit/g,""),N=st.useRef(null),ne=st.useRef(!1),te=st.useCallback(z=>{var O;(O=x.find(H=>H.id===z.id))!=null&&O.delete||Ps.dismiss(z.id),M(H=>H.filter(({id:re})=>re!==z.id))},[x]);return st.useEffect(()=>Ps.subscribe(z=>{if(z.dismiss){M(O=>O.map(H=>H.id===z.id?{...H,delete:!0}:H));return}setTimeout(()=>{cL.flushSync(()=>{M(O=>{let H=O.findIndex(re=>re.id===z.id);return H!==-1?[...O.slice(0,H),{...O[H],...z},...O.slice(H+1)]:[z,...O]})})})}),[]),st.useEffect(()=>{if(l!=="system"){K(l);return}l==="system"&&(window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?K("dark"):K("light")),typeof window<"u"&&window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",({matches:z})=>{K(z?"dark":"light")})},[l]),st.useEffect(()=>{x.length<=1&&j(!1)},[x]),st.useEffect(()=>{let z=O=>{var H,re;n.every(_e=>O[_e]||O.code===_e)&&(j(!0),(H=Y.current)==null||H.focus()),O.code==="Escape"&&(document.activeElement===Y.current||(re=Y.current)!=null&&re.contains(document.activeElement))&&j(!1)};return document.addEventListener("keydown",z),()=>document.removeEventListener("keydown",z)},[n]),st.useEffect(()=>{if(Y.current)return()=>{N.current&&(N.current.focus({preventScroll:!0}),N.current=null,ne.current=!1)}},[Y.current]),x.length?st.createElement("section",{"aria-label":`${_} ${J}`,tabIndex:-1},T.map((z,O)=>{var H;let[re,_e]=z.split("-");return st.createElement("ol",{key:z,dir:p==="auto"?I2():p,tabIndex:-1,ref:Y,className:o,"data-sonner-toaster":!0,"data-theme":X,"data-y-position":re,"data-x-position":_e,style:{"--front-toast-height":`${((H=S[0])==null?void 0:H.height)||0}px`,"--offset":typeof a=="number"?`${a}px`:a||$8,"--width":`${D8}px`,"--gap":`${m}px`,...d},onBlur:oe=>{ne.current&&!oe.currentTarget.contains(oe.relatedTarget)&&(ne.current=!1,N.current&&(N.current.focus({preventScroll:!0}),N.current=null))},onFocus:oe=>{oe.target instanceof HTMLElement&&oe.target.dataset.dismissible==="false"||ne.current||(ne.current=!0,N.current=oe.relatedTarget)},onMouseEnter:()=>j(!0),onMouseMove:()=>j(!0),onMouseLeave:()=>{V||j(!1)},onPointerDown:oe=>{oe.target instanceof HTMLElement&&oe.target.dataset.dismissible==="false"||L(!0)},onPointerUp:()=>L(!1)},x.filter(oe=>!oe.position&&O===0||oe.position===z).map((oe,pe)=>{var $e,Ne;return st.createElement(j8,{key:oe.id,icons:g,index:pe,toast:oe,defaultRichColors:c,duration:($e=f==null?void 0:f.duration)!=null?$e:u,className:f==null?void 0:f.className,descriptionClassName:f==null?void 0:f.descriptionClassName,invert:e,visibleToasts:h,closeButton:(Ne=f==null?void 0:f.closeButton)!=null?Ne:i,interacting:V,position:z,style:f==null?void 0:f.style,unstyled:f==null?void 0:f.unstyled,classNames:f==null?void 0:f.classNames,cancelButtonStyle:f==null?void 0:f.cancelButtonStyle,actionButtonStyle:f==null?void 0:f.actionButtonStyle,removeToast:te,toasts:x.filter(de=>de.position==oe.position),heights:S.filter(de=>de.position==oe.position),setHeights:k,expandByDefault:s,gap:m,loadingIcon:y,expanded:$,pauseWhenPageIsHidden:v,cn:w})}))})):null};const z8=({...t})=>{const{theme:e="system"}=m8();return G.jsx(N8,{theme:e,className:"toaster group",toastOptions:{classNames:{toast:"group toast group-[.toaster]:bg-background group-[.toaster]:text-foreground group-[.toaster]:border-border group-[.toaster]:shadow-lg",description:"group-[.toast]:text-muted-foreground",actionButton:"group-[.toast]:bg-primary group-[.toast]:text-primary-foreground",cancelButton:"group-[.toast]:bg-muted group-[.toast]:text-muted-foreground"}},...t})};var B8=oI.useId||(()=>{}),V8=0;function ru(t){const[e,r]=D.useState(B8());return Kn(()=>{r(n=>n??String(V8++))},[t]),e?`radix-${e}`:""}const W8=["top","right","bottom","left"],Ra=Math.min,As=Math.max,fg=Math.round,Tp=Math.floor,ja=t=>({x:t,y:t}),U8={left:"right",right:"left",bottom:"top",top:"bottom"},G8={start:"end",end:"start"};function Kw(t,e,r){return As(t,Ra(e,r))}function No(t,e){return typeof t=="function"?t(e):t}function zo(t){return t.split("-")[0]}function Ru(t){return t.split("-")[1]}function Q1(t){return t==="x"?"y":"x"}function J1(t){return t==="y"?"height":"width"}function Na(t){return["top","bottom"].includes(zo(t))?"y":"x"}function Z1(t){return Q1(Na(t))}function H8(t,e,r){r===void 0&&(r=!1);const n=Ru(t),s=Z1(t),i=J1(s);let o=s==="x"?n===(r?"end":"start")?"right":"left":n==="start"?"bottom":"top";return e.reference[i]>e.floating[i]&&(o=pg(o)),[o,pg(o)]}function K8(t){const e=pg(t);return[Xw(t),e,Xw(e)]}function Xw(t){return t.replace(/start|end/g,e=>G8[e])}function X8(t,e,r){const n=["left","right"],s=["right","left"],i=["top","bottom"],o=["bottom","top"];switch(t){case"top":case"bottom":return r?e?s:n:e?n:s;case"left":case"right":return e?i:o;default:return[]}}function q8(t,e,r,n){const s=Ru(t);let i=X8(zo(t),r==="start",n);return s&&(i=i.map(o=>o+"-"+s),e&&(i=i.concat(i.map(Xw)))),i}function pg(t){return t.replace(/left|right|bottom|top/g,e=>U8[e])}function Y8(t){return{top:0,right:0,bottom:0,left:0,...t}}function YL(t){return typeof t!="number"?Y8(t):{top:t,right:t,bottom:t,left:t}}function mg(t){const{x:e,y:r,width:n,height:s}=t;return{width:n,height:s,top:r,left:e,right:e+n,bottom:r+s,x:e,y:r}}function F2(t,e,r){let{reference:n,floating:s}=t;const i=Na(e),o=Z1(e),a=J1(o),l=zo(e),c=i==="y",u=n.x+n.width/2-s.width/2,d=n.y+n.height/2-s.height/2,h=n[a]/2-s[a]/2;let f;switch(l){case"top":f={x:u,y:n.y-s.height};break;case"bottom":f={x:u,y:n.y+n.height};break;case"right":f={x:n.x+n.width,y:d};break;case"left":f={x:n.x-s.width,y:d};break;default:f={x:n.x,y:n.y}}switch(Ru(e)){case"start":f[o]-=h*(r&&c?-1:1);break;case"end":f[o]+=h*(r&&c?-1:1);break}return f}const Q8=async(t,e,r)=>{const{placement:n="bottom",strategy:s="absolute",middleware:i=[],platform:o}=r,a=i.filter(Boolean),l=await(o.isRTL==null?void 0:o.isRTL(e));let c=await o.getElementRects({reference:t,floating:e,strategy:s}),{x:u,y:d}=F2(c,n,l),h=n,f={},p=0;for(let m=0;m<a.length;m++){const{name:y,fn:g}=a[m],{x:_,y:v,data:w,reset:x}=await g({x:u,y:d,initialPlacement:n,placement:h,strategy:s,middlewareData:f,rects:c,platform:o,elements:{reference:t,floating:e}});u=_??u,d=v??d,f={...f,[y]:{...f[y],...w}},x&&p<=50&&(p++,typeof x=="object"&&(x.placement&&(h=x.placement),x.rects&&(c=x.rects===!0?await o.getElementRects({reference:t,floating:e,strategy:s}):x.rects),{x:u,y:d}=F2(c,h,l)),m=-1)}return{x:u,y:d,placement:h,strategy:s,middlewareData:f}};async function Lh(t,e){var r;e===void 0&&(e={});const{x:n,y:s,platform:i,rects:o,elements:a,strategy:l}=t,{boundary:c="clippingAncestors",rootBoundary:u="viewport",elementContext:d="floating",altBoundary:h=!1,padding:f=0}=No(e,t),p=YL(f),y=a[h?d==="floating"?"reference":"floating":d],g=mg(await i.getClippingRect({element:(r=await(i.isElement==null?void 0:i.isElement(y)))==null||r?y:y.contextElement||await(i.getDocumentElement==null?void 0:i.getDocumentElement(a.floating)),boundary:c,rootBoundary:u,strategy:l})),_=d==="floating"?{x:n,y:s,width:o.floating.width,height:o.floating.height}:o.reference,v=await(i.getOffsetParent==null?void 0:i.getOffsetParent(a.floating)),w=await(i.isElement==null?void 0:i.isElement(v))?await(i.getScale==null?void 0:i.getScale(v))||{x:1,y:1}:{x:1,y:1},x=mg(i.convertOffsetParentRelativeRectToViewportRelativeRect?await i.convertOffsetParentRelativeRectToViewportRelativeRect({elements:a,rect:_,offsetParent:v,strategy:l}):_);return{top:(g.top-x.top+p.top)/w.y,bottom:(x.bottom-g.bottom+p.bottom)/w.y,left:(g.left-x.left+p.left)/w.x,right:(x.right-g.right+p.right)/w.x}}const J8=t=>({name:"arrow",options:t,async fn(e){const{x:r,y:n,placement:s,rects:i,platform:o,elements:a,middlewareData:l}=e,{element:c,padding:u=0}=No(t,e)||{};if(c==null)return{};const d=YL(u),h={x:r,y:n},f=Z1(s),p=J1(f),m=await o.getDimensions(c),y=f==="y",g=y?"top":"left",_=y?"bottom":"right",v=y?"clientHeight":"clientWidth",w=i.reference[p]+i.reference[f]-h[f]-i.floating[p],x=h[f]-i.reference[f],M=await(o.getOffsetParent==null?void 0:o.getOffsetParent(c));let T=M?M[v]:0;(!T||!await(o.isElement==null?void 0:o.isElement(M)))&&(T=a.floating[v]||i.floating[p]);const S=w/2-x/2,k=T/2-m[p]/2-1,$=Ra(d[g],k),j=Ra(d[_],k),V=$,L=T-m[p]-j,X=T/2-m[p]/2+S,K=Kw(V,X,L),Y=!l.arrow&&Ru(s)!=null&&X!==K&&i.reference[p]/2-(X<V?$:j)-m[p]/2<0,J=Y?X<V?X-V:X-L:0;return{[f]:h[f]+J,data:{[f]:K,centerOffset:X-K-J,...Y&&{alignmentOffset:J}},reset:Y}}}),Z8=function(t){return t===void 0&&(t={}),{name:"flip",options:t,async fn(e){var r,n;const{placement:s,middlewareData:i,rects:o,initialPlacement:a,platform:l,elements:c}=e,{mainAxis:u=!0,crossAxis:d=!0,fallbackPlacements:h,fallbackStrategy:f="bestFit",fallbackAxisSideDirection:p="none",flipAlignment:m=!0,...y}=No(t,e);if((r=i.arrow)!=null&&r.alignmentOffset)return{};const g=zo(s),_=Na(a),v=zo(a)===a,w=await(l.isRTL==null?void 0:l.isRTL(c.floating)),x=h||(v||!m?[pg(a)]:K8(a)),M=p!=="none";!h&&M&&x.push(...q8(a,m,p,w));const T=[a,...x],S=await Lh(e,y),k=[];let $=((n=i.flip)==null?void 0:n.overflows)||[];if(u&&k.push(S[g]),d){const X=H8(s,o,w);k.push(S[X[0]],S[X[1]])}if($=[...$,{placement:s,overflows:k}],!k.every(X=>X<=0)){var j,V;const X=(((j=i.flip)==null?void 0:j.index)||0)+1,K=T[X];if(K)return{data:{index:X,overflows:$},reset:{placement:K}};let Y=(V=$.filter(J=>J.overflows[0]<=0).sort((J,N)=>J.overflows[1]-N.overflows[1])[0])==null?void 0:V.placement;if(!Y)switch(f){case"bestFit":{var L;const J=(L=$.filter(N=>{if(M){const ne=Na(N.placement);return ne===_||ne==="y"}return!0}).map(N=>[N.placement,N.overflows.filter(ne=>ne>0).reduce((ne,te)=>ne+te,0)]).sort((N,ne)=>N[1]-ne[1])[0])==null?void 0:L[0];J&&(Y=J);break}case"initialPlacement":Y=a;break}if(s!==Y)return{reset:{placement:Y}}}return{}}}};function L2(t,e){return{top:t.top-e.height,right:t.right-e.width,bottom:t.bottom-e.height,left:t.left-e.width}}function R2(t){return W8.some(e=>t[e]>=0)}const e6=function(t){return t===void 0&&(t={}),{name:"hide",options:t,async fn(e){const{rects:r}=e,{strategy:n="referenceHidden",...s}=No(t,e);switch(n){case"referenceHidden":{const i=await Lh(e,{...s,elementContext:"reference"}),o=L2(i,r.reference);return{data:{referenceHiddenOffsets:o,referenceHidden:R2(o)}}}case"escaped":{const i=await Lh(e,{...s,altBoundary:!0}),o=L2(i,r.floating);return{data:{escapedOffsets:o,escaped:R2(o)}}}default:return{}}}}};async function t6(t,e){const{placement:r,platform:n,elements:s}=t,i=await(n.isRTL==null?void 0:n.isRTL(s.floating)),o=zo(r),a=Ru(r),l=Na(r)==="y",c=["left","top"].includes(o)?-1:1,u=i&&l?-1:1,d=No(e,t);let{mainAxis:h,crossAxis:f,alignmentAxis:p}=typeof d=="number"?{mainAxis:d,crossAxis:0,alignmentAxis:null}:{mainAxis:d.mainAxis||0,crossAxis:d.crossAxis||0,alignmentAxis:d.alignmentAxis};return a&&typeof p=="number"&&(f=a==="end"?p*-1:p),l?{x:f*u,y:h*c}:{x:h*c,y:f*u}}const r6=function(t){return t===void 0&&(t=0),{name:"offset",options:t,async fn(e){var r,n;const{x:s,y:i,placement:o,middlewareData:a}=e,l=await t6(e,t);return o===((r=a.offset)==null?void 0:r.placement)&&(n=a.arrow)!=null&&n.alignmentOffset?{}:{x:s+l.x,y:i+l.y,data:{...l,placement:o}}}}},n6=function(t){return t===void 0&&(t={}),{name:"shift",options:t,async fn(e){const{x:r,y:n,placement:s}=e,{mainAxis:i=!0,crossAxis:o=!1,limiter:a={fn:y=>{let{x:g,y:_}=y;return{x:g,y:_}}},...l}=No(t,e),c={x:r,y:n},u=await Lh(e,l),d=Na(zo(s)),h=Q1(d);let f=c[h],p=c[d];if(i){const y=h==="y"?"top":"left",g=h==="y"?"bottom":"right",_=f+u[y],v=f-u[g];f=Kw(_,f,v)}if(o){const y=d==="y"?"top":"left",g=d==="y"?"bottom":"right",_=p+u[y],v=p-u[g];p=Kw(_,p,v)}const m=a.fn({...e,[h]:f,[d]:p});return{...m,data:{x:m.x-r,y:m.y-n,enabled:{[h]:i,[d]:o}}}}}},s6=function(t){return t===void 0&&(t={}),{options:t,fn(e){const{x:r,y:n,placement:s,rects:i,middlewareData:o}=e,{offset:a=0,mainAxis:l=!0,crossAxis:c=!0}=No(t,e),u={x:r,y:n},d=Na(s),h=Q1(d);let f=u[h],p=u[d];const m=No(a,e),y=typeof m=="number"?{mainAxis:m,crossAxis:0}:{mainAxis:0,crossAxis:0,...m};if(l){const v=h==="y"?"height":"width",w=i.reference[h]-i.floating[v]+y.mainAxis,x=i.reference[h]+i.reference[v]-y.mainAxis;f<w?f=w:f>x&&(f=x)}if(c){var g,_;const v=h==="y"?"width":"height",w=["top","left"].includes(zo(s)),x=i.reference[d]-i.floating[v]+(w&&((g=o.offset)==null?void 0:g[d])||0)+(w?0:y.crossAxis),M=i.reference[d]+i.reference[v]+(w?0:((_=o.offset)==null?void 0:_[d])||0)-(w?y.crossAxis:0);p<x?p=x:p>M&&(p=M)}return{[h]:f,[d]:p}}}},i6=function(t){return t===void 0&&(t={}),{name:"size",options:t,async fn(e){var r,n;const{placement:s,rects:i,platform:o,elements:a}=e,{apply:l=()=>{},...c}=No(t,e),u=await Lh(e,c),d=zo(s),h=Ru(s),f=Na(s)==="y",{width:p,height:m}=i.floating;let y,g;d==="top"||d==="bottom"?(y=d,g=h===(await(o.isRTL==null?void 0:o.isRTL(a.floating))?"start":"end")?"left":"right"):(g=d,y=h==="end"?"top":"bottom");const _=m-u.top-u.bottom,v=p-u.left-u.right,w=Ra(m-u[y],_),x=Ra(p-u[g],v),M=!e.middlewareData.shift;let T=w,S=x;if((r=e.middlewareData.shift)!=null&&r.enabled.x&&(S=v),(n=e.middlewareData.shift)!=null&&n.enabled.y&&(T=_),M&&!h){const $=As(u.left,0),j=As(u.right,0),V=As(u.top,0),L=As(u.bottom,0);f?S=p-2*($!==0||j!==0?$+j:As(u.left,u.right)):T=m-2*(V!==0||L!==0?V+L:As(u.top,u.bottom))}await l({...e,availableWidth:S,availableHeight:T});const k=await o.getDimensions(a.floating);return p!==k.width||m!==k.height?{reset:{rects:!0}}:{}}}};function a_(){return typeof window<"u"}function ju(t){return QL(t)?(t.nodeName||"").toLowerCase():"#document"}function Is(t){var e;return(t==null||(e=t.ownerDocument)==null?void 0:e.defaultView)||window}function mo(t){var e;return(e=(QL(t)?t.ownerDocument:t.document)||window.document)==null?void 0:e.documentElement}function QL(t){return a_()?t instanceof Node||t instanceof Is(t).Node:!1}function Ni(t){return a_()?t instanceof Element||t instanceof Is(t).Element:!1}function fo(t){return a_()?t instanceof HTMLElement||t instanceof Is(t).HTMLElement:!1}function j2(t){return!a_()||typeof ShadowRoot>"u"?!1:t instanceof ShadowRoot||t instanceof Is(t).ShadowRoot}function sf(t){const{overflow:e,overflowX:r,overflowY:n,display:s}=zi(t);return/auto|scroll|overlay|hidden|clip/.test(e+n+r)&&!["inline","contents"].includes(s)}function o6(t){return["table","td","th"].includes(ju(t))}function l_(t){return[":popover-open",":modal"].some(e=>{try{return t.matches(e)}catch{return!1}})}function eb(t){const e=tb(),r=Ni(t)?zi(t):t;return r.transform!=="none"||r.perspective!=="none"||(r.containerType?r.containerType!=="normal":!1)||!e&&(r.backdropFilter?r.backdropFilter!=="none":!1)||!e&&(r.filter?r.filter!=="none":!1)||["transform","perspective","filter"].some(n=>(r.willChange||"").includes(n))||["paint","layout","strict","content"].some(n=>(r.contain||"").includes(n))}function a6(t){let e=za(t);for(;fo(e)&&!Su(e);){if(eb(e))return e;if(l_(e))return null;e=za(e)}return null}function tb(){return typeof CSS>"u"||!CSS.supports?!1:CSS.supports("-webkit-backdrop-filter","none")}function Su(t){return["html","body","#document"].includes(ju(t))}function zi(t){return Is(t).getComputedStyle(t)}function c_(t){return Ni(t)?{scrollLeft:t.scrollLeft,scrollTop:t.scrollTop}:{scrollLeft:t.scrollX,scrollTop:t.scrollY}}function za(t){if(ju(t)==="html")return t;const e=t.assignedSlot||t.parentNode||j2(t)&&t.host||mo(t);return j2(e)?e.host:e}function JL(t){const e=za(t);return Su(e)?t.ownerDocument?t.ownerDocument.body:t.body:fo(e)&&sf(e)?e:JL(e)}function Rh(t,e,r){var n;e===void 0&&(e=[]),r===void 0&&(r=!0);const s=JL(t),i=s===((n=t.ownerDocument)==null?void 0:n.body),o=Is(s);if(i){const a=qw(o);return e.concat(o,o.visualViewport||[],sf(s)?s:[],a&&r?Rh(a):[])}return e.concat(s,Rh(s,[],r))}function qw(t){return t.parent&&Object.getPrototypeOf(t.parent)?t.frameElement:null}function ZL(t){const e=zi(t);let r=parseFloat(e.width)||0,n=parseFloat(e.height)||0;const s=fo(t),i=s?t.offsetWidth:r,o=s?t.offsetHeight:n,a=fg(r)!==i||fg(n)!==o;return a&&(r=i,n=o),{width:r,height:n,$:a}}function rb(t){return Ni(t)?t:t.contextElement}function nu(t){const e=rb(t);if(!fo(e))return ja(1);const r=e.getBoundingClientRect(),{width:n,height:s,$:i}=ZL(e);let o=(i?fg(r.width):r.width)/n,a=(i?fg(r.height):r.height)/s;return(!o||!Number.isFinite(o))&&(o=1),(!a||!Number.isFinite(a))&&(a=1),{x:o,y:a}}const l6=ja(0);function eR(t){const e=Is(t);return!tb()||!e.visualViewport?l6:{x:e.visualViewport.offsetLeft,y:e.visualViewport.offsetTop}}function c6(t,e,r){return e===void 0&&(e=!1),!r||e&&r!==Is(t)?!1:e}function Yl(t,e,r,n){e===void 0&&(e=!1),r===void 0&&(r=!1);const s=t.getBoundingClientRect(),i=rb(t);let o=ja(1);e&&(n?Ni(n)&&(o=nu(n)):o=nu(t));const a=c6(i,r,n)?eR(i):ja(0);let l=(s.left+a.x)/o.x,c=(s.top+a.y)/o.y,u=s.width/o.x,d=s.height/o.y;if(i){const h=Is(i),f=n&&Ni(n)?Is(n):n;let p=h,m=qw(p);for(;m&&n&&f!==p;){const y=nu(m),g=m.getBoundingClientRect(),_=zi(m),v=g.left+(m.clientLeft+parseFloat(_.paddingLeft))*y.x,w=g.top+(m.clientTop+parseFloat(_.paddingTop))*y.y;l*=y.x,c*=y.y,u*=y.x,d*=y.y,l+=v,c+=w,p=Is(m),m=qw(p)}}return mg({width:u,height:d,x:l,y:c})}function u6(t){let{elements:e,rect:r,offsetParent:n,strategy:s}=t;const i=s==="fixed",o=mo(n),a=e?l_(e.floating):!1;if(n===o||a&&i)return r;let l={scrollLeft:0,scrollTop:0},c=ja(1);const u=ja(0),d=fo(n);if((d||!d&&!i)&&((ju(n)!=="body"||sf(o))&&(l=c_(n)),fo(n))){const h=Yl(n);c=nu(n),u.x=h.x+n.clientLeft,u.y=h.y+n.clientTop}return{width:r.width*c.x,height:r.height*c.y,x:r.x*c.x-l.scrollLeft*c.x+u.x,y:r.y*c.y-l.scrollTop*c.y+u.y}}function d6(t){return Array.from(t.getClientRects())}function Yw(t,e){const r=c_(t).scrollLeft;return e?e.left+r:Yl(mo(t)).left+r}function h6(t){const e=mo(t),r=c_(t),n=t.ownerDocument.body,s=As(e.scrollWidth,e.clientWidth,n.scrollWidth,n.clientWidth),i=As(e.scrollHeight,e.clientHeight,n.scrollHeight,n.clientHeight);let o=-r.scrollLeft+Yw(t);const a=-r.scrollTop;return zi(n).direction==="rtl"&&(o+=As(e.clientWidth,n.clientWidth)-s),{width:s,height:i,x:o,y:a}}function f6(t,e){const r=Is(t),n=mo(t),s=r.visualViewport;let i=n.clientWidth,o=n.clientHeight,a=0,l=0;if(s){i=s.width,o=s.height;const c=tb();(!c||c&&e==="fixed")&&(a=s.offsetLeft,l=s.offsetTop)}return{width:i,height:o,x:a,y:l}}function p6(t,e){const r=Yl(t,!0,e==="fixed"),n=r.top+t.clientTop,s=r.left+t.clientLeft,i=fo(t)?nu(t):ja(1),o=t.clientWidth*i.x,a=t.clientHeight*i.y,l=s*i.x,c=n*i.y;return{width:o,height:a,x:l,y:c}}function N2(t,e,r){let n;if(e==="viewport")n=f6(t,r);else if(e==="document")n=h6(mo(t));else if(Ni(e))n=p6(e,r);else{const s=eR(t);n={...e,x:e.x-s.x,y:e.y-s.y}}return mg(n)}function tR(t,e){const r=za(t);return r===e||!Ni(r)||Su(r)?!1:zi(r).position==="fixed"||tR(r,e)}function m6(t,e){const r=e.get(t);if(r)return r;let n=Rh(t,[],!1).filter(a=>Ni(a)&&ju(a)!=="body"),s=null;const i=zi(t).position==="fixed";let o=i?za(t):t;for(;Ni(o)&&!Su(o);){const a=zi(o),l=eb(o);!l&&a.position==="fixed"&&(s=null),(i?!l&&!s:!l&&a.position==="static"&&!!s&&["absolute","fixed"].includes(s.position)||sf(o)&&!l&&tR(t,o))?n=n.filter(u=>u!==o):s=a,o=za(o)}return e.set(t,n),n}function g6(t){let{element:e,boundary:r,rootBoundary:n,strategy:s}=t;const o=[...r==="clippingAncestors"?l_(e)?[]:m6(e,this._c):[].concat(r),n],a=o[0],l=o.reduce((c,u)=>{const d=N2(e,u,s);return c.top=As(d.top,c.top),c.right=Ra(d.right,c.right),c.bottom=Ra(d.bottom,c.bottom),c.left=As(d.left,c.left),c},N2(e,a,s));return{width:l.right-l.left,height:l.bottom-l.top,x:l.left,y:l.top}}function _6(t){const{width:e,height:r}=ZL(t);return{width:e,height:r}}function y6(t,e,r){const n=fo(e),s=mo(e),i=r==="fixed",o=Yl(t,!0,i,e);let a={scrollLeft:0,scrollTop:0};const l=ja(0);if(n||!n&&!i)if((ju(e)!=="body"||sf(s))&&(a=c_(e)),n){const f=Yl(e,!0,i,e);l.x=f.x+e.clientLeft,l.y=f.y+e.clientTop}else s&&(l.x=Yw(s));let c=0,u=0;if(s&&!n&&!i){const f=s.getBoundingClientRect();u=f.top+a.scrollTop,c=f.left+a.scrollLeft-Yw(s,f)}const d=o.left+a.scrollLeft-l.x-c,h=o.top+a.scrollTop-l.y-u;return{x:d,y:h,width:o.width,height:o.height}}function Cy(t){return zi(t).position==="static"}function z2(t,e){if(!fo(t)||zi(t).position==="fixed")return null;if(e)return e(t);let r=t.offsetParent;return mo(t)===r&&(r=r.ownerDocument.body),r}function rR(t,e){const r=Is(t);if(l_(t))return r;if(!fo(t)){let s=za(t);for(;s&&!Su(s);){if(Ni(s)&&!Cy(s))return s;s=za(s)}return r}let n=z2(t,e);for(;n&&o6(n)&&Cy(n);)n=z2(n,e);return n&&Su(n)&&Cy(n)&&!eb(n)?r:n||a6(t)||r}const v6=async function(t){const e=this.getOffsetParent||rR,r=this.getDimensions,n=await r(t.floating);return{reference:y6(t.reference,await e(t.floating),t.strategy),floating:{x:0,y:0,width:n.width,height:n.height}}};function w6(t){return zi(t).direction==="rtl"}const x6={convertOffsetParentRelativeRectToViewportRelativeRect:u6,getDocumentElement:mo,getClippingRect:g6,getOffsetParent:rR,getElementRects:v6,getClientRects:d6,getDimensions:_6,getScale:nu,isElement:Ni,isRTL:w6};function b6(t,e){let r=null,n;const s=mo(t);function i(){var a;clearTimeout(n),(a=r)==null||a.disconnect(),r=null}function o(a,l){a===void 0&&(a=!1),l===void 0&&(l=1),i();const{left:c,top:u,width:d,height:h}=t.getBoundingClientRect();if(a||e(),!d||!h)return;const f=Tp(u),p=Tp(s.clientWidth-(c+d)),m=Tp(s.clientHeight-(u+h)),y=Tp(c),_={rootMargin:-f+"px "+-p+"px "+-m+"px "+-y+"px",threshold:As(0,Ra(1,l))||1};let v=!0;function w(x){const M=x[0].intersectionRatio;if(M!==l){if(!v)return o();M?o(!1,M):n=setTimeout(()=>{o(!1,1e-7)},1e3)}v=!1}try{r=new IntersectionObserver(w,{..._,root:s.ownerDocument})}catch{r=new IntersectionObserver(w,_)}r.observe(t)}return o(!0),i}function M6(t,e,r,n){n===void 0&&(n={});const{ancestorScroll:s=!0,ancestorResize:i=!0,elementResize:o=typeof ResizeObserver=="function",layoutShift:a=typeof IntersectionObserver=="function",animationFrame:l=!1}=n,c=rb(t),u=s||i?[...c?Rh(c):[],...Rh(e)]:[];u.forEach(g=>{s&&g.addEventListener("scroll",r,{passive:!0}),i&&g.addEventListener("resize",r)});const d=c&&a?b6(c,r):null;let h=-1,f=null;o&&(f=new ResizeObserver(g=>{let[_]=g;_&&_.target===c&&f&&(f.unobserve(e),cancelAnimationFrame(h),h=requestAnimationFrame(()=>{var v;(v=f)==null||v.observe(e)})),r()}),c&&!l&&f.observe(c),f.observe(e));let p,m=l?Yl(t):null;l&&y();function y(){const g=Yl(t);m&&(g.x!==m.x||g.y!==m.y||g.width!==m.width||g.height!==m.height)&&r(),m=g,p=requestAnimationFrame(y)}return r(),()=>{var g;u.forEach(_=>{s&&_.removeEventListener("scroll",r),i&&_.removeEventListener("resize",r)}),d==null||d(),(g=f)==null||g.disconnect(),f=null,l&&cancelAnimationFrame(p)}}const T6=r6,C6=n6,S6=Z8,E6=i6,P6=e6,B2=J8,k6=s6,A6=(t,e,r)=>{const n=new Map,s={platform:x6,...r},i={...s.platform,_c:n};return Q8(t,e,{...s,platform:i})};var $m=typeof document<"u"?D.useLayoutEffect:D.useEffect;function gg(t,e){if(t===e)return!0;if(typeof t!=typeof e)return!1;if(typeof t=="function"&&t.toString()===e.toString())return!0;let r,n,s;if(t&&e&&typeof t=="object"){if(Array.isArray(t)){if(r=t.length,r!==e.length)return!1;for(n=r;n--!==0;)if(!gg(t[n],e[n]))return!1;return!0}if(s=Object.keys(t),r=s.length,r!==Object.keys(e).length)return!1;for(n=r;n--!==0;)if(!{}.hasOwnProperty.call(e,s[n]))return!1;for(n=r;n--!==0;){const i=s[n];if(!(i==="_owner"&&t.$$typeof)&&!gg(t[i],e[i]))return!1}return!0}return t!==t&&e!==e}function nR(t){return typeof window>"u"?1:(t.ownerDocument.defaultView||window).devicePixelRatio||1}function V2(t,e){const r=nR(t);return Math.round(e*r)/r}function Sy(t){const e=D.useRef(t);return $m(()=>{e.current=t}),e}function $6(t){t===void 0&&(t={});const{placement:e="bottom",strategy:r="absolute",middleware:n=[],platform:s,elements:{reference:i,floating:o}={},transform:a=!0,whileElementsMounted:l,open:c}=t,[u,d]=D.useState({x:0,y:0,strategy:r,placement:e,middlewareData:{},isPositioned:!1}),[h,f]=D.useState(n);gg(h,n)||f(n);const[p,m]=D.useState(null),[y,g]=D.useState(null),_=D.useCallback(N=>{N!==M.current&&(M.current=N,m(N))},[]),v=D.useCallback(N=>{N!==T.current&&(T.current=N,g(N))},[]),w=i||p,x=o||y,M=D.useRef(null),T=D.useRef(null),S=D.useRef(u),k=l!=null,$=Sy(l),j=Sy(s),V=Sy(c),L=D.useCallback(()=>{if(!M.current||!T.current)return;const N={placement:e,strategy:r,middleware:h};j.current&&(N.platform=j.current),A6(M.current,T.current,N).then(ne=>{const te={...ne,isPositioned:V.current!==!1};X.current&&!gg(S.current,te)&&(S.current=te,sc.flushSync(()=>{d(te)}))})},[h,e,r,j,V]);$m(()=>{c===!1&&S.current.isPositioned&&(S.current.isPositioned=!1,d(N=>({...N,isPositioned:!1})))},[c]);const X=D.useRef(!1);$m(()=>(X.current=!0,()=>{X.current=!1}),[]),$m(()=>{if(w&&(M.current=w),x&&(T.current=x),w&&x){if($.current)return $.current(w,x,L);L()}},[w,x,L,$,k]);const K=D.useMemo(()=>({reference:M,floating:T,setReference:_,setFloating:v}),[_,v]),Y=D.useMemo(()=>({reference:w,floating:x}),[w,x]),J=D.useMemo(()=>{const N={position:r,left:0,top:0};if(!Y.floating)return N;const ne=V2(Y.floating,u.x),te=V2(Y.floating,u.y);return a?{...N,transform:"translate("+ne+"px, "+te+"px)",...nR(Y.floating)>=1.5&&{willChange:"transform"}}:{position:r,left:ne,top:te}},[r,a,Y.floating,u.x,u.y]);return D.useMemo(()=>({...u,update:L,refs:K,elements:Y,floatingStyles:J}),[u,L,K,Y,J])}const O6=t=>{function e(r){return{}.hasOwnProperty.call(r,"current")}return{name:"arrow",options:t,fn(r){const{element:n,padding:s}=typeof t=="function"?t(r):t;return n&&e(n)?n.current!=null?B2({element:n.current,padding:s}).fn(r):{}:n?B2({element:n,padding:s}).fn(r):{}}}},D6=(t,e)=>({...T6(t),options:[t,e]}),I6=(t,e)=>({...C6(t),options:[t,e]}),F6=(t,e)=>({...k6(t),options:[t,e]}),L6=(t,e)=>({...S6(t),options:[t,e]}),R6=(t,e)=>({...E6(t),options:[t,e]}),j6=(t,e)=>({...P6(t),options:[t,e]}),N6=(t,e)=>({...O6(t),options:[t,e]});var z6="Arrow",sR=D.forwardRef((t,e)=>{const{children:r,width:n=10,height:s=5,...i}=t;return G.jsx(Kt.svg,{...i,ref:e,width:n,height:s,viewBox:"0 0 30 10",preserveAspectRatio:"none",children:t.asChild?r:G.jsx("polygon",{points:"0,0 30,0 15,10"})})});sR.displayName=z6;var B6=sR;function V6(t,e=[]){let r=[];function n(i,o){const a=D.createContext(o),l=r.length;r=[...r,o];function c(d){const{scope:h,children:f,...p}=d,m=(h==null?void 0:h[t][l])||a,y=D.useMemo(()=>p,Object.values(p));return G.jsx(m.Provider,{value:y,children:f})}function u(d,h){const f=(h==null?void 0:h[t][l])||a,p=D.useContext(f);if(p)return p;if(o!==void 0)return o;throw new Error(`\`${d}\` must be used within \`${i}\``)}return c.displayName=i+"Provider",[c,u]}const s=()=>{const i=r.map(o=>D.createContext(o));return function(a){const l=(a==null?void 0:a[t])||i;return D.useMemo(()=>({[`__scope${t}`]:{...a,[t]:l}}),[a,l])}};return s.scopeName=t,[n,W6(s,...e)]}function W6(...t){const e=t[0];if(t.length===1)return e;const r=()=>{const n=t.map(s=>({useScope:s(),scopeName:s.scopeName}));return function(i){const o=n.reduce((a,{useScope:l,scopeName:c})=>{const d=l(i)[`__scope${c}`];return{...a,...d}},{});return D.useMemo(()=>({[`__scope${e.scopeName}`]:o}),[o])}};return r.scopeName=e.scopeName,r}function iR(t){const[e,r]=D.useState(void 0);return Kn(()=>{if(t){r({width:t.offsetWidth,height:t.offsetHeight});const n=new ResizeObserver(s=>{if(!Array.isArray(s)||!s.length)return;const i=s[0];let o,a;if("borderBoxSize"in i){const l=i.borderBoxSize,c=Array.isArray(l)?l[0]:l;o=c.inlineSize,a=c.blockSize}else o=t.offsetWidth,a=t.offsetHeight;r({width:o,height:a})});return n.observe(t,{box:"border-box"}),()=>n.unobserve(t)}else r(void 0)},[t]),e}var nb="Popper",[oR,u_]=V6(nb),[U6,aR]=oR(nb),lR=t=>{const{__scopePopper:e,children:r}=t,[n,s]=D.useState(null);return G.jsx(U6,{scope:e,anchor:n,onAnchorChange:s,children:r})};lR.displayName=nb;var cR="PopperAnchor",uR=D.forwardRef((t,e)=>{const{__scopePopper:r,virtualRef:n,...s}=t,i=aR(cR,r),o=D.useRef(null),a=cr(e,o);return D.useEffect(()=>{i.onAnchorChange((n==null?void 0:n.current)||o.current)}),n?null:G.jsx(Kt.div,{...s,ref:a})});uR.displayName=cR;var sb="PopperContent",[G6,H6]=oR(sb),dR=D.forwardRef((t,e)=>{var pe,$e,Ne,de,q,se;const{__scopePopper:r,side:n="bottom",sideOffset:s=0,align:i="center",alignOffset:o=0,arrowPadding:a=0,avoidCollisions:l=!0,collisionBoundary:c=[],collisionPadding:u=0,sticky:d="partial",hideWhenDetached:h=!1,updatePositionStrategy:f="optimized",onPlaced:p,...m}=t,y=aR(sb,r),[g,_]=D.useState(null),v=cr(e,Q=>_(Q)),[w,x]=D.useState(null),M=iR(w),T=(M==null?void 0:M.width)??0,S=(M==null?void 0:M.height)??0,k=n+(i!=="center"?"-"+i:""),$=typeof u=="number"?u:{top:0,right:0,bottom:0,left:0,...u},j=Array.isArray(c)?c:[c],V=j.length>0,L={padding:$,boundary:j.filter(X6),altBoundary:V},{refs:X,floatingStyles:K,placement:Y,isPositioned:J,middlewareData:N}=$6({strategy:"fixed",placement:k,whileElementsMounted:(...Q)=>M6(...Q,{animationFrame:f==="always"}),elements:{reference:y.anchor},middleware:[D6({mainAxis:s+S,alignmentAxis:o}),l&&I6({mainAxis:!0,crossAxis:!1,limiter:d==="partial"?F6():void 0,...L}),l&&L6({...L}),R6({...L,apply:({elements:Q,rects:Me,availableWidth:Te,availableHeight:ke})=>{const{width:Pe,height:Fe}=Me.reference,Le=Q.floating.style;Le.setProperty("--radix-popper-available-width",`${Te}px`),Le.setProperty("--radix-popper-available-height",`${ke}px`),Le.setProperty("--radix-popper-anchor-width",`${Pe}px`),Le.setProperty("--radix-popper-anchor-height",`${Fe}px`)}}),w&&N6({element:w,padding:a}),q6({arrowWidth:T,arrowHeight:S}),h&&j6({strategy:"referenceHidden",...L})]}),[ne,te]=pR(Y),z=Rs(p);Kn(()=>{J&&(z==null||z())},[J,z]);const O=(pe=N.arrow)==null?void 0:pe.x,H=($e=N.arrow)==null?void 0:$e.y,re=((Ne=N.arrow)==null?void 0:Ne.centerOffset)!==0,[_e,oe]=D.useState();return Kn(()=>{g&&oe(window.getComputedStyle(g).zIndex)},[g]),G.jsx("div",{ref:X.setFloating,"data-radix-popper-content-wrapper":"",style:{...K,transform:J?K.transform:"translate(0, -200%)",minWidth:"max-content",zIndex:_e,"--radix-popper-transform-origin":[(de=N.transformOrigin)==null?void 0:de.x,(q=N.transformOrigin)==null?void 0:q.y].join(" "),...((se=N.hide)==null?void 0:se.referenceHidden)&&{visibility:"hidden",pointerEvents:"none"}},dir:t.dir,children:G.jsx(G6,{scope:r,placedSide:ne,onArrowChange:x,arrowX:O,arrowY:H,shouldHideArrow:re,children:G.jsx(Kt.div,{"data-side":ne,"data-align":te,...m,ref:v,style:{...m.style,animation:J?void 0:"none"}})})})});dR.displayName=sb;var hR="PopperArrow",K6={top:"bottom",right:"left",bottom:"top",left:"right"},fR=D.forwardRef(function(e,r){const{__scopePopper:n,...s}=e,i=H6(hR,n),o=K6[i.placedSide];return G.jsx("span",{ref:i.onArrowChange,style:{position:"absolute",left:i.arrowX,top:i.arrowY,[o]:0,transformOrigin:{top:"",right:"0 0",bottom:"center 0",left:"100% 0"}[i.placedSide],transform:{top:"translateY(100%)",right:"translateY(50%) rotate(90deg) translateX(-50%)",bottom:"rotate(180deg)",left:"translateY(50%) rotate(-90deg) translateX(50%)"}[i.placedSide],visibility:i.shouldHideArrow?"hidden":void 0},children:G.jsx(B6,{...s,ref:r,style:{...s.style,display:"block"}})})});fR.displayName=hR;function X6(t){return t!==null}var q6=t=>({name:"transformOrigin",options:t,fn(e){var y,g,_;const{placement:r,rects:n,middlewareData:s}=e,o=((y=s.arrow)==null?void 0:y.centerOffset)!==0,a=o?0:t.arrowWidth,l=o?0:t.arrowHeight,[c,u]=pR(r),d={start:"0%",center:"50%",end:"100%"}[u],h=(((g=s.arrow)==null?void 0:g.x)??0)+a/2,f=(((_=s.arrow)==null?void 0:_.y)??0)+l/2;let p="",m="";return c==="bottom"?(p=o?d:`${h}px`,m=`${-l}px`):c==="top"?(p=o?d:`${h}px`,m=`${n.floating.height+l}px`):c==="right"?(p=`${-l}px`,m=o?d:`${f}px`):c==="left"&&(p=`${n.floating.width+l}px`,m=o?d:`${f}px`),{data:{x:p,y:m}}}});function pR(t){const[e,r="center"]=t.split("-");return[e,r]}var Y6=lR,mR=uR,gR=dR,_R=fR,[d_,AJ]=Iu("Tooltip",[u_]),ib=u_(),yR="TooltipProvider",Q6=700,W2="tooltip.open",[J6,vR]=d_(yR),wR=t=>{const{__scopeTooltip:e,delayDuration:r=Q6,skipDelayDuration:n=300,disableHoverableContent:s=!1,children:i}=t,[o,a]=D.useState(!0),l=D.useRef(!1),c=D.useRef(0);return D.useEffect(()=>{const u=c.current;return()=>window.clearTimeout(u)},[]),G.jsx(J6,{scope:e,isOpenDelayed:o,delayDuration:r,onOpen:D.useCallback(()=>{window.clearTimeout(c.current),a(!1)},[]),onClose:D.useCallback(()=>{window.clearTimeout(c.current),c.current=window.setTimeout(()=>a(!0),n)},[n]),isPointerInTransitRef:l,onPointerInTransitChange:D.useCallback(u=>{l.current=u},[]),disableHoverableContent:s,children:i})};wR.displayName=yR;var xR="Tooltip",[$J,h_]=d_(xR),Qw="TooltipTrigger",Z6=D.forwardRef((t,e)=>{const{__scopeTooltip:r,...n}=t,s=h_(Qw,r),i=vR(Qw,r),o=ib(r),a=D.useRef(null),l=cr(e,a,s.onTriggerChange),c=D.useRef(!1),u=D.useRef(!1),d=D.useCallback(()=>c.current=!1,[]);return D.useEffect(()=>()=>document.removeEventListener("pointerup",d),[d]),G.jsx(mR,{asChild:!0,...o,children:G.jsx(Kt.button,{"aria-describedby":s.open?s.contentId:void 0,"data-state":s.stateAttribute,...n,ref:l,onPointerMove:$t(t.onPointerMove,h=>{h.pointerType!=="touch"&&!u.current&&!i.isPointerInTransitRef.current&&(s.onTriggerEnter(),u.current=!0)}),onPointerLeave:$t(t.onPointerLeave,()=>{s.onTriggerLeave(),u.current=!1}),onPointerDown:$t(t.onPointerDown,()=>{c.current=!0,document.addEventListener("pointerup",d,{once:!0})}),onFocus:$t(t.onFocus,()=>{c.current||s.onOpen()}),onBlur:$t(t.onBlur,s.onClose),onClick:$t(t.onClick,s.onClose)})})});Z6.displayName=Qw;var eH="TooltipPortal",[OJ,tH]=d_(eH,{forceMount:void 0}),Eu="TooltipContent",bR=D.forwardRef((t,e)=>{const r=tH(Eu,t.__scopeTooltip),{forceMount:n=r.forceMount,side:s="top",...i}=t,o=h_(Eu,t.__scopeTooltip);return G.jsx(Fu,{present:n||o.open,children:o.disableHoverableContent?G.jsx(MR,{side:s,...i,ref:e}):G.jsx(rH,{side:s,...i,ref:e})})}),rH=D.forwardRef((t,e)=>{const r=h_(Eu,t.__scopeTooltip),n=vR(Eu,t.__scopeTooltip),s=D.useRef(null),i=cr(e,s),[o,a]=D.useState(null),{trigger:l,onClose:c}=r,u=s.current,{onPointerInTransitChange:d}=n,h=D.useCallback(()=>{a(null),d(!1)},[d]),f=D.useCallback((p,m)=>{const y=p.currentTarget,g={x:p.clientX,y:p.clientY},_=oH(g,y.getBoundingClientRect()),v=aH(g,_),w=lH(m.getBoundingClientRect()),x=uH([...v,...w]);a(x),d(!0)},[d]);return D.useEffect(()=>()=>h(),[h]),D.useEffect(()=>{if(l&&u){const p=y=>f(y,u),m=y=>f(y,l);return l.addEventListener("pointerleave",p),u.addEventListener("pointerleave",m),()=>{l.removeEventListener("pointerleave",p),u.removeEventListener("pointerleave",m)}}},[l,u,f,h]),D.useEffect(()=>{if(o){const p=m=>{const y=m.target,g={x:m.clientX,y:m.clientY},_=(l==null?void 0:l.contains(y))||(u==null?void 0:u.contains(y)),v=!cH(g,o);_?h():v&&(h(),c())};return document.addEventListener("pointermove",p),()=>document.removeEventListener("pointermove",p)}},[l,u,o,c,h]),G.jsx(MR,{...t,ref:i})}),[nH,sH]=d_(xR,{isInside:!1}),MR=D.forwardRef((t,e)=>{const{__scopeTooltip:r,children:n,"aria-label":s,onEscapeKeyDown:i,onPointerDownOutside:o,...a}=t,l=h_(Eu,r),c=ib(r),{onClose:u}=l;return D.useEffect(()=>(document.addEventListener(W2,u),()=>document.removeEventListener(W2,u)),[u]),D.useEffect(()=>{if(l.trigger){const d=h=>{const f=h.target;f!=null&&f.contains(l.trigger)&&u()};return window.addEventListener("scroll",d,{capture:!0}),()=>window.removeEventListener("scroll",d,{capture:!0})}},[l.trigger,u]),G.jsx(rf,{asChild:!0,disableOutsidePointerEvents:!1,onEscapeKeyDown:i,onPointerDownOutside:o,onFocusOutside:d=>d.preventDefault(),onDismiss:u,children:G.jsxs(gR,{"data-state":l.stateAttribute,...c,...a,ref:e,style:{...a.style,"--radix-tooltip-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-tooltip-content-available-width":"var(--radix-popper-available-width)","--radix-tooltip-content-available-height":"var(--radix-popper-available-height)","--radix-tooltip-trigger-width":"var(--radix-popper-anchor-width)","--radix-tooltip-trigger-height":"var(--radix-popper-anchor-height)"},children:[G.jsx(U1,{children:n}),G.jsx(nH,{scope:r,isInside:!0,children:G.jsx(eG,{id:l.contentId,role:"tooltip",children:s||n})})]})})});bR.displayName=Eu;var TR="TooltipArrow",iH=D.forwardRef((t,e)=>{const{__scopeTooltip:r,...n}=t,s=ib(r);return sH(TR,r).isInside?null:G.jsx(_R,{...s,...n,ref:e})});iH.displayName=TR;function oH(t,e){const r=Math.abs(e.top-t.y),n=Math.abs(e.bottom-t.y),s=Math.abs(e.right-t.x),i=Math.abs(e.left-t.x);switch(Math.min(r,n,s,i)){case i:return"left";case s:return"right";case r:return"top";case n:return"bottom";default:throw new Error("unreachable")}}function aH(t,e,r=5){const n=[];switch(e){case"top":n.push({x:t.x-r,y:t.y+r},{x:t.x+r,y:t.y+r});break;case"bottom":n.push({x:t.x-r,y:t.y-r},{x:t.x+r,y:t.y-r});break;case"left":n.push({x:t.x+r,y:t.y-r},{x:t.x+r,y:t.y+r});break;case"right":n.push({x:t.x-r,y:t.y-r},{x:t.x-r,y:t.y+r});break}return n}function lH(t){const{top:e,right:r,bottom:n,left:s}=t;return[{x:s,y:e},{x:r,y:e},{x:r,y:n},{x:s,y:n}]}function cH(t,e){const{x:r,y:n}=t;let s=!1;for(let i=0,o=e.length-1;i<e.length;o=i++){const a=e[i].x,l=e[i].y,c=e[o].x,u=e[o].y;l>n!=u>n&&r<(c-a)*(n-l)/(u-l)+a&&(s=!s)}return s}function uH(t){const e=t.slice();return e.sort((r,n)=>r.x<n.x?-1:r.x>n.x?1:r.y<n.y?-1:r.y>n.y?1:0),dH(e)}function dH(t){if(t.length<=1)return t.slice();const e=[];for(let n=0;n<t.length;n++){const s=t[n];for(;e.length>=2;){const i=e[e.length-1],o=e[e.length-2];if((i.x-o.x)*(s.y-o.y)>=(i.y-o.y)*(s.x-o.x))e.pop();else break}e.push(s)}e.pop();const r=[];for(let n=t.length-1;n>=0;n--){const s=t[n];for(;r.length>=2;){const i=r[r.length-1],o=r[r.length-2];if((i.x-o.x)*(s.y-o.y)>=(i.y-o.y)*(s.x-o.x))r.pop();else break}r.push(s)}return r.pop(),e.length===1&&r.length===1&&e[0].x===r[0].x&&e[0].y===r[0].y?e:e.concat(r)}var hH=wR,CR=bR;const fH=hH,pH=D.forwardRef(({className:t,sideOffset:e=4,...r},n)=>G.jsx(CR,{ref:n,sideOffset:e,className:tr("z-50 overflow-hidden rounded-md border bg-popover px-3 py-1.5 text-sm text-popover-foreground shadow-md animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",t),...r}));pH.displayName=CR.displayName;var f_=class{constructor(){this.listeners=new Set,this.subscribe=this.subscribe.bind(this)}subscribe(t){return this.listeners.add(t),this.onSubscribe(),()=>{this.listeners.delete(t),this.onUnsubscribe()}}hasListeners(){return this.listeners.size>0}onSubscribe(){}onUnsubscribe(){}},p_=typeof window>"u"||"Deno"in globalThis;function Ti(){}function mH(t,e){return typeof t=="function"?t(e):t}function gH(t){return typeof t=="number"&&t>=0&&t!==1/0}function _H(t,e){return Math.max(t+(e||0)-Date.now(),0)}function U2(t,e){return typeof t=="function"?t(e):t}function yH(t,e){return typeof t=="function"?t(e):t}function G2(t,e){const{type:r="all",exact:n,fetchStatus:s,predicate:i,queryKey:o,stale:a}=t;if(o){if(n){if(e.queryHash!==ob(o,e.options))return!1}else if(!Nh(e.queryKey,o))return!1}if(r!=="all"){const l=e.isActive();if(r==="active"&&!l||r==="inactive"&&l)return!1}return!(typeof a=="boolean"&&e.isStale()!==a||s&&s!==e.state.fetchStatus||i&&!i(e))}function H2(t,e){const{exact:r,status:n,predicate:s,mutationKey:i}=t;if(i){if(!e.options.mutationKey)return!1;if(r){if(jh(e.options.mutationKey)!==jh(i))return!1}else if(!Nh(e.options.mutationKey,i))return!1}return!(n&&e.state.status!==n||s&&!s(e))}function ob(t,e){return((e==null?void 0:e.queryKeyHashFn)||jh)(t)}function jh(t){return JSON.stringify(t,(e,r)=>Jw(r)?Object.keys(r).sort().reduce((n,s)=>(n[s]=r[s],n),{}):r)}function Nh(t,e){return t===e?!0:typeof t!=typeof e?!1:t&&e&&typeof t=="object"&&typeof e=="object"?!Object.keys(e).some(r=>!Nh(t[r],e[r])):!1}function SR(t,e){if(t===e)return t;const r=K2(t)&&K2(e);if(r||Jw(t)&&Jw(e)){const n=r?t:Object.keys(t),s=n.length,i=r?e:Object.keys(e),o=i.length,a=r?[]:{};let l=0;for(let c=0;c<o;c++){const u=r?c:i[c];(!r&&n.includes(u)||r)&&t[u]===void 0&&e[u]===void 0?(a[u]=void 0,l++):(a[u]=SR(t[u],e[u]),a[u]===t[u]&&t[u]!==void 0&&l++)}return s===o&&l===s?t:a}return e}function K2(t){return Array.isArray(t)&&t.length===Object.keys(t).length}function Jw(t){if(!X2(t))return!1;const e=t.constructor;if(e===void 0)return!0;const r=e.prototype;return!(!X2(r)||!r.hasOwnProperty("isPrototypeOf")||Object.getPrototypeOf(t)!==Object.prototype)}function X2(t){return Object.prototype.toString.call(t)==="[object Object]"}function vH(t){return new Promise(e=>{setTimeout(e,t)})}function wH(t,e,r){return typeof r.structuralSharing=="function"?r.structuralSharing(t,e):r.structuralSharing!==!1?SR(t,e):e}function xH(t,e,r=0){const n=[...t,e];return r&&n.length>r?n.slice(1):n}function bH(t,e,r=0){const n=[e,...t];return r&&n.length>r?n.slice(0,-1):n}var ab=Symbol();function ER(t,e){return!t.queryFn&&(e!=null&&e.initialPromise)?()=>e.initialPromise:!t.queryFn||t.queryFn===ab?()=>Promise.reject(new Error(`Missing queryFn: '${t.queryHash}'`)):t.queryFn}var Rl,va,uu,BD,MH=(BD=class extends f_{constructor(){super();fr(this,Rl);fr(this,va);fr(this,uu);Bt(this,uu,e=>{if(!p_&&window.addEventListener){const r=()=>e();return window.addEventListener("visibilitychange",r,!1),()=>{window.removeEventListener("visibilitychange",r)}}})}onSubscribe(){Ve(this,va)||this.setEventListener(Ve(this,uu))}onUnsubscribe(){var e;this.hasListeners()||((e=Ve(this,va))==null||e.call(this),Bt(this,va,void 0))}setEventListener(e){var r;Bt(this,uu,e),(r=Ve(this,va))==null||r.call(this),Bt(this,va,e(n=>{typeof n=="boolean"?this.setFocused(n):this.onFocus()}))}setFocused(e){Ve(this,Rl)!==e&&(Bt(this,Rl,e),this.onFocus())}onFocus(){const e=this.isFocused();this.listeners.forEach(r=>{r(e)})}isFocused(){var e;return typeof Ve(this,Rl)=="boolean"?Ve(this,Rl):((e=globalThis.document)==null?void 0:e.visibilityState)!=="hidden"}},Rl=new WeakMap,va=new WeakMap,uu=new WeakMap,BD),PR=new MH,du,wa,hu,VD,TH=(VD=class extends f_{constructor(){super();fr(this,du,!0);fr(this,wa);fr(this,hu);Bt(this,hu,e=>{if(!p_&&window.addEventListener){const r=()=>e(!0),n=()=>e(!1);return window.addEventListener("online",r,!1),window.addEventListener("offline",n,!1),()=>{window.removeEventListener("online",r),window.removeEventListener("offline",n)}}})}onSubscribe(){Ve(this,wa)||this.setEventListener(Ve(this,hu))}onUnsubscribe(){var e;this.hasListeners()||((e=Ve(this,wa))==null||e.call(this),Bt(this,wa,void 0))}setEventListener(e){var r;Bt(this,hu,e),(r=Ve(this,wa))==null||r.call(this),Bt(this,wa,e(this.setOnline.bind(this)))}setOnline(e){Ve(this,du)!==e&&(Bt(this,du,e),this.listeners.forEach(n=>{n(e)}))}isOnline(){return Ve(this,du)}},du=new WeakMap,wa=new WeakMap,hu=new WeakMap,VD),_g=new TH;function CH(){let t,e;const r=new Promise((s,i)=>{t=s,e=i});r.status="pending",r.catch(()=>{});function n(s){Object.assign(r,s),delete r.resolve,delete r.reject}return r.resolve=s=>{n({status:"fulfilled",value:s}),t(s)},r.reject=s=>{n({status:"rejected",reason:s}),e(s)},r}function SH(t){return Math.min(1e3*2**t,3e4)}function kR(t){return(t??"online")==="online"?_g.isOnline():!0}var AR=class extends Error{constructor(t){super("CancelledError"),this.revert=t==null?void 0:t.revert,this.silent=t==null?void 0:t.silent}};function Ey(t){return t instanceof AR}function $R(t){let e=!1,r=0,n=!1,s;const i=CH(),o=m=>{var y;n||(h(new AR(m)),(y=t.abort)==null||y.call(t))},a=()=>{e=!0},l=()=>{e=!1},c=()=>PR.isFocused()&&(t.networkMode==="always"||_g.isOnline())&&t.canRun(),u=()=>kR(t.networkMode)&&t.canRun(),d=m=>{var y;n||(n=!0,(y=t.onSuccess)==null||y.call(t,m),s==null||s(),i.resolve(m))},h=m=>{var y;n||(n=!0,(y=t.onError)==null||y.call(t,m),s==null||s(),i.reject(m))},f=()=>new Promise(m=>{var y;s=g=>{(n||c())&&m(g)},(y=t.onPause)==null||y.call(t)}).then(()=>{var m;s=void 0,n||(m=t.onContinue)==null||m.call(t)}),p=()=>{if(n)return;let m;const y=r===0?t.initialPromise:void 0;try{m=y??t.fn()}catch(g){m=Promise.reject(g)}Promise.resolve(m).then(d).catch(g=>{var M;if(n)return;const _=t.retry??(p_?0:3),v=t.retryDelay??SH,w=typeof v=="function"?v(r,g):v,x=_===!0||typeof _=="number"&&r<_||typeof _=="function"&&_(r,g);if(e||!x){h(g);return}r++,(M=t.onFail)==null||M.call(t,r,g),vH(w).then(()=>c()?void 0:f()).then(()=>{e?h(g):p()})})};return{promise:i,cancel:o,continue:()=>(s==null||s(),i),cancelRetry:a,continueRetry:l,canStart:u,start:()=>(u()?p():f().then(p),i)}}function EH(){let t=[],e=0,r=a=>{a()},n=a=>{a()},s=a=>setTimeout(a,0);const i=a=>{e?t.push(a):s(()=>{r(a)})},o=()=>{const a=t;t=[],a.length&&s(()=>{n(()=>{a.forEach(l=>{r(l)})})})};return{batch:a=>{let l;e++;try{l=a()}finally{e--,e||o()}return l},batchCalls:a=>(...l)=>{i(()=>{a(...l)})},schedule:i,setNotifyFunction:a=>{r=a},setBatchNotifyFunction:a=>{n=a},setScheduler:a=>{s=a}}}var Zn=EH(),jl,WD,OR=(WD=class{constructor(){fr(this,jl)}destroy(){this.clearGcTimeout()}scheduleGc(){this.clearGcTimeout(),gH(this.gcTime)&&Bt(this,jl,setTimeout(()=>{this.optionalRemove()},this.gcTime))}updateGcTime(t){this.gcTime=Math.max(this.gcTime||0,t??(p_?1/0:5*60*1e3))}clearGcTimeout(){Ve(this,jl)&&(clearTimeout(Ve(this,jl)),Bt(this,jl,void 0))}},jl=new WeakMap,WD),fu,pu,Ys,Vn,qh,Nl,Ci,xo,UD,PH=(UD=class extends OR{constructor(e){super();fr(this,Ci);fr(this,fu);fr(this,pu);fr(this,Ys);fr(this,Vn);fr(this,qh);fr(this,Nl);Bt(this,Nl,!1),Bt(this,qh,e.defaultOptions),this.setOptions(e.options),this.observers=[],Bt(this,Ys,e.cache),this.queryKey=e.queryKey,this.queryHash=e.queryHash,Bt(this,fu,AH(this.options)),this.state=e.state??Ve(this,fu),this.scheduleGc()}get meta(){return this.options.meta}get promise(){var e;return(e=Ve(this,Vn))==null?void 0:e.promise}setOptions(e){this.options={...Ve(this,qh),...e},this.updateGcTime(this.options.gcTime)}optionalRemove(){!this.observers.length&&this.state.fetchStatus==="idle"&&Ve(this,Ys).remove(this)}setData(e,r){const n=wH(this.state.data,e,this.options);return Nn(this,Ci,xo).call(this,{data:n,type:"success",dataUpdatedAt:r==null?void 0:r.updatedAt,manual:r==null?void 0:r.manual}),n}setState(e,r){Nn(this,Ci,xo).call(this,{type:"setState",state:e,setStateOptions:r})}cancel(e){var n,s;const r=(n=Ve(this,Vn))==null?void 0:n.promise;return(s=Ve(this,Vn))==null||s.cancel(e),r?r.then(Ti).catch(Ti):Promise.resolve()}destroy(){super.destroy(),this.cancel({silent:!0})}reset(){this.destroy(),this.setState(Ve(this,fu))}isActive(){return this.observers.some(e=>yH(e.options.enabled,this)!==!1)}isDisabled(){return this.getObserversCount()>0?!this.isActive():this.options.queryFn===ab||this.state.dataUpdateCount+this.state.errorUpdateCount===0}isStale(){return this.state.isInvalidated?!0:this.getObserversCount()>0?this.observers.some(e=>e.getCurrentResult().isStale):this.state.data===void 0}isStaleByTime(e=0){return this.state.isInvalidated||this.state.data===void 0||!_H(this.state.dataUpdatedAt,e)}onFocus(){var r;const e=this.observers.find(n=>n.shouldFetchOnWindowFocus());e==null||e.refetch({cancelRefetch:!1}),(r=Ve(this,Vn))==null||r.continue()}onOnline(){var r;const e=this.observers.find(n=>n.shouldFetchOnReconnect());e==null||e.refetch({cancelRefetch:!1}),(r=Ve(this,Vn))==null||r.continue()}addObserver(e){this.observers.includes(e)||(this.observers.push(e),this.clearGcTimeout(),Ve(this,Ys).notify({type:"observerAdded",query:this,observer:e}))}removeObserver(e){this.observers.includes(e)&&(this.observers=this.observers.filter(r=>r!==e),this.observers.length||(Ve(this,Vn)&&(Ve(this,Nl)?Ve(this,Vn).cancel({revert:!0}):Ve(this,Vn).cancelRetry()),this.scheduleGc()),Ve(this,Ys).notify({type:"observerRemoved",query:this,observer:e}))}getObserversCount(){return this.observers.length}invalidate(){this.state.isInvalidated||Nn(this,Ci,xo).call(this,{type:"invalidate"})}fetch(e,r){var l,c,u;if(this.state.fetchStatus!=="idle"){if(this.state.data!==void 0&&(r!=null&&r.cancelRefetch))this.cancel({silent:!0});else if(Ve(this,Vn))return Ve(this,Vn).continueRetry(),Ve(this,Vn).promise}if(e&&this.setOptions(e),!this.options.queryFn){const d=this.observers.find(h=>h.options.queryFn);d&&this.setOptions(d.options)}const n=new AbortController,s=d=>{Object.defineProperty(d,"signal",{enumerable:!0,get:()=>(Bt(this,Nl,!0),n.signal)})},i=()=>{const d=ER(this.options,r),h={queryKey:this.queryKey,meta:this.meta};return s(h),Bt(this,Nl,!1),this.options.persister?this.options.persister(d,h,this):d(h)},o={fetchOptions:r,options:this.options,queryKey:this.queryKey,state:this.state,fetchFn:i};s(o),(l=this.options.behavior)==null||l.onFetch(o,this),Bt(this,pu,this.state),(this.state.fetchStatus==="idle"||this.state.fetchMeta!==((c=o.fetchOptions)==null?void 0:c.meta))&&Nn(this,Ci,xo).call(this,{type:"fetch",meta:(u=o.fetchOptions)==null?void 0:u.meta});const a=d=>{var h,f,p,m;Ey(d)&&d.silent||Nn(this,Ci,xo).call(this,{type:"error",error:d}),Ey(d)||((f=(h=Ve(this,Ys).config).onError)==null||f.call(h,d,this),(m=(p=Ve(this,Ys).config).onSettled)==null||m.call(p,this.state.data,d,this)),this.scheduleGc()};return Bt(this,Vn,$R({initialPromise:r==null?void 0:r.initialPromise,fn:o.fetchFn,abort:n.abort.bind(n),onSuccess:d=>{var h,f,p,m;if(d===void 0){a(new Error(`${this.queryHash} data is undefined`));return}try{this.setData(d)}catch(y){a(y);return}(f=(h=Ve(this,Ys).config).onSuccess)==null||f.call(h,d,this),(m=(p=Ve(this,Ys).config).onSettled)==null||m.call(p,d,this.state.error,this),this.scheduleGc()},onError:a,onFail:(d,h)=>{Nn(this,Ci,xo).call(this,{type:"failed",failureCount:d,error:h})},onPause:()=>{Nn(this,Ci,xo).call(this,{type:"pause"})},onContinue:()=>{Nn(this,Ci,xo).call(this,{type:"continue"})},retry:o.options.retry,retryDelay:o.options.retryDelay,networkMode:o.options.networkMode,canRun:()=>!0})),Ve(this,Vn).start()}},fu=new WeakMap,pu=new WeakMap,Ys=new WeakMap,Vn=new WeakMap,qh=new WeakMap,Nl=new WeakMap,Ci=new WeakSet,xo=function(e){const r=n=>{switch(e.type){case"failed":return{...n,fetchFailureCount:e.failureCount,fetchFailureReason:e.error};case"pause":return{...n,fetchStatus:"paused"};case"continue":return{...n,fetchStatus:"fetching"};case"fetch":return{...n,...kH(n.data,this.options),fetchMeta:e.meta??null};case"success":return{...n,data:e.data,dataUpdateCount:n.dataUpdateCount+1,dataUpdatedAt:e.dataUpdatedAt??Date.now(),error:null,isInvalidated:!1,status:"success",...!e.manual&&{fetchStatus:"idle",fetchFailureCount:0,fetchFailureReason:null}};case"error":const s=e.error;return Ey(s)&&s.revert&&Ve(this,pu)?{...Ve(this,pu),fetchStatus:"idle"}:{...n,error:s,errorUpdateCount:n.errorUpdateCount+1,errorUpdatedAt:Date.now(),fetchFailureCount:n.fetchFailureCount+1,fetchFailureReason:s,fetchStatus:"idle",status:"error"};case"invalidate":return{...n,isInvalidated:!0};case"setState":return{...n,...e.state}}};this.state=r(this.state),Zn.batch(()=>{this.observers.forEach(n=>{n.onQueryUpdate()}),Ve(this,Ys).notify({query:this,type:"updated",action:e})})},UD);function kH(t,e){return{fetchFailureCount:0,fetchFailureReason:null,fetchStatus:kR(e.networkMode)?"fetching":"paused",...t===void 0&&{error:null,status:"pending"}}}function AH(t){const e=typeof t.initialData=="function"?t.initialData():t.initialData,r=e!==void 0,n=r?typeof t.initialDataUpdatedAt=="function"?t.initialDataUpdatedAt():t.initialDataUpdatedAt:0;return{data:e,dataUpdateCount:0,dataUpdatedAt:r?n??Date.now():0,error:null,errorUpdateCount:0,errorUpdatedAt:0,fetchFailureCount:0,fetchFailureReason:null,fetchMeta:null,isInvalidated:!1,status:r?"success":"pending",fetchStatus:"idle"}}var to,GD,$H=(GD=class extends f_{constructor(e={}){super();fr(this,to);this.config=e,Bt(this,to,new Map)}build(e,r,n){const s=r.queryKey,i=r.queryHash??ob(s,r);let o=this.get(i);return o||(o=new PH({cache:this,queryKey:s,queryHash:i,options:e.defaultQueryOptions(r),state:n,defaultOptions:e.getQueryDefaults(s)}),this.add(o)),o}add(e){Ve(this,to).has(e.queryHash)||(Ve(this,to).set(e.queryHash,e),this.notify({type:"added",query:e}))}remove(e){const r=Ve(this,to).get(e.queryHash);r&&(e.destroy(),r===e&&Ve(this,to).delete(e.queryHash),this.notify({type:"removed",query:e}))}clear(){Zn.batch(()=>{this.getAll().forEach(e=>{this.remove(e)})})}get(e){return Ve(this,to).get(e)}getAll(){return[...Ve(this,to).values()]}find(e){const r={exact:!0,...e};return this.getAll().find(n=>G2(r,n))}findAll(e={}){const r=this.getAll();return Object.keys(e).length>0?r.filter(n=>G2(e,n)):r}notify(e){Zn.batch(()=>{this.listeners.forEach(r=>{r(e)})})}onFocus(){Zn.batch(()=>{this.getAll().forEach(e=>{e.onFocus()})})}onOnline(){Zn.batch(()=>{this.getAll().forEach(e=>{e.onOnline()})})}},to=new WeakMap,GD),ro,Qn,zl,no,fa,HD,OH=(HD=class extends OR{constructor(e){super();fr(this,no);fr(this,ro);fr(this,Qn);fr(this,zl);this.mutationId=e.mutationId,Bt(this,Qn,e.mutationCache),Bt(this,ro,[]),this.state=e.state||DH(),this.setOptions(e.options),this.scheduleGc()}setOptions(e){this.options=e,this.updateGcTime(this.options.gcTime)}get meta(){return this.options.meta}addObserver(e){Ve(this,ro).includes(e)||(Ve(this,ro).push(e),this.clearGcTimeout(),Ve(this,Qn).notify({type:"observerAdded",mutation:this,observer:e}))}removeObserver(e){Bt(this,ro,Ve(this,ro).filter(r=>r!==e)),this.scheduleGc(),Ve(this,Qn).notify({type:"observerRemoved",mutation:this,observer:e})}optionalRemove(){Ve(this,ro).length||(this.state.status==="pending"?this.scheduleGc():Ve(this,Qn).remove(this))}continue(){var e;return((e=Ve(this,zl))==null?void 0:e.continue())??this.execute(this.state.variables)}async execute(e){var s,i,o,a,l,c,u,d,h,f,p,m,y,g,_,v,w,x,M,T;Bt(this,zl,$R({fn:()=>this.options.mutationFn?this.options.mutationFn(e):Promise.reject(new Error("No mutationFn found")),onFail:(S,k)=>{Nn(this,no,fa).call(this,{type:"failed",failureCount:S,error:k})},onPause:()=>{Nn(this,no,fa).call(this,{type:"pause"})},onContinue:()=>{Nn(this,no,fa).call(this,{type:"continue"})},retry:this.options.retry??0,retryDelay:this.options.retryDelay,networkMode:this.options.networkMode,canRun:()=>Ve(this,Qn).canRun(this)}));const r=this.state.status==="pending",n=!Ve(this,zl).canStart();try{if(!r){Nn(this,no,fa).call(this,{type:"pending",variables:e,isPaused:n}),await((i=(s=Ve(this,Qn).config).onMutate)==null?void 0:i.call(s,e,this));const k=await((a=(o=this.options).onMutate)==null?void 0:a.call(o,e));k!==this.state.context&&Nn(this,no,fa).call(this,{type:"pending",context:k,variables:e,isPaused:n})}const S=await Ve(this,zl).start();return await((c=(l=Ve(this,Qn).config).onSuccess)==null?void 0:c.call(l,S,e,this.state.context,this)),await((d=(u=this.options).onSuccess)==null?void 0:d.call(u,S,e,this.state.context)),await((f=(h=Ve(this,Qn).config).onSettled)==null?void 0:f.call(h,S,null,this.state.variables,this.state.context,this)),await((m=(p=this.options).onSettled)==null?void 0:m.call(p,S,null,e,this.state.context)),Nn(this,no,fa).call(this,{type:"success",data:S}),S}catch(S){try{throw await((g=(y=Ve(this,Qn).config).onError)==null?void 0:g.call(y,S,e,this.state.context,this)),await((v=(_=this.options).onError)==null?void 0:v.call(_,S,e,this.state.context)),await((x=(w=Ve(this,Qn).config).onSettled)==null?void 0:x.call(w,void 0,S,this.state.variables,this.state.context,this)),await((T=(M=this.options).onSettled)==null?void 0:T.call(M,void 0,S,e,this.state.context)),S}finally{Nn(this,no,fa).call(this,{type:"error",error:S})}}finally{Ve(this,Qn).runNext(this)}}},ro=new WeakMap,Qn=new WeakMap,zl=new WeakMap,no=new WeakSet,fa=function(e){const r=n=>{switch(e.type){case"failed":return{...n,failureCount:e.failureCount,failureReason:e.error};case"pause":return{...n,isPaused:!0};case"continue":return{...n,isPaused:!1};case"pending":return{...n,context:e.context,data:void 0,failureCount:0,failureReason:null,error:null,isPaused:e.isPaused,status:"pending",variables:e.variables,submittedAt:Date.now()};case"success":return{...n,data:e.data,failureCount:0,failureReason:null,error:null,status:"success",isPaused:!1};case"error":return{...n,data:void 0,error:e.error,failureCount:n.failureCount+1,failureReason:e.error,isPaused:!1,status:"error"}}};this.state=r(this.state),Zn.batch(()=>{Ve(this,ro).forEach(n=>{n.onMutationUpdate(e)}),Ve(this,Qn).notify({mutation:this,type:"updated",action:e})})},HD);function DH(){return{context:void 0,data:void 0,error:null,failureCount:0,failureReason:null,isPaused:!1,status:"idle",variables:void 0,submittedAt:0}}var Es,Yh,KD,IH=(KD=class extends f_{constructor(e={}){super();fr(this,Es);fr(this,Yh);this.config=e,Bt(this,Es,new Map),Bt(this,Yh,Date.now())}build(e,r,n){const s=new OH({mutationCache:this,mutationId:++np(this,Yh)._,options:e.defaultMutationOptions(r),state:n});return this.add(s),s}add(e){const r=Cp(e),n=Ve(this,Es).get(r)??[];n.push(e),Ve(this,Es).set(r,n),this.notify({type:"added",mutation:e})}remove(e){var n;const r=Cp(e);if(Ve(this,Es).has(r)){const s=(n=Ve(this,Es).get(r))==null?void 0:n.filter(i=>i!==e);s&&(s.length===0?Ve(this,Es).delete(r):Ve(this,Es).set(r,s))}this.notify({type:"removed",mutation:e})}canRun(e){var n;const r=(n=Ve(this,Es).get(Cp(e)))==null?void 0:n.find(s=>s.state.status==="pending");return!r||r===e}runNext(e){var n;const r=(n=Ve(this,Es).get(Cp(e)))==null?void 0:n.find(s=>s!==e&&s.state.isPaused);return(r==null?void 0:r.continue())??Promise.resolve()}clear(){Zn.batch(()=>{this.getAll().forEach(e=>{this.remove(e)})})}getAll(){return[...Ve(this,Es).values()].flat()}find(e){const r={exact:!0,...e};return this.getAll().find(n=>H2(r,n))}findAll(e={}){return this.getAll().filter(r=>H2(e,r))}notify(e){Zn.batch(()=>{this.listeners.forEach(r=>{r(e)})})}resumePausedMutations(){const e=this.getAll().filter(r=>r.state.isPaused);return Zn.batch(()=>Promise.all(e.map(r=>r.continue().catch(Ti))))}},Es=new WeakMap,Yh=new WeakMap,KD);function Cp(t){var e;return((e=t.options.scope)==null?void 0:e.id)??String(t.mutationId)}function q2(t){return{onFetch:(e,r)=>{var u,d,h,f,p;const n=e.options,s=(h=(d=(u=e.fetchOptions)==null?void 0:u.meta)==null?void 0:d.fetchMore)==null?void 0:h.direction,i=((f=e.state.data)==null?void 0:f.pages)||[],o=((p=e.state.data)==null?void 0:p.pageParams)||[];let a={pages:[],pageParams:[]},l=0;const c=async()=>{let m=!1;const y=v=>{Object.defineProperty(v,"signal",{enumerable:!0,get:()=>(e.signal.aborted?m=!0:e.signal.addEventListener("abort",()=>{m=!0}),e.signal)})},g=ER(e.options,e.fetchOptions),_=async(v,w,x)=>{if(m)return Promise.reject();if(w==null&&v.pages.length)return Promise.resolve(v);const M={queryKey:e.queryKey,pageParam:w,direction:x?"backward":"forward",meta:e.options.meta};y(M);const T=await g(M),{maxPages:S}=e.options,k=x?bH:xH;return{pages:k(v.pages,T,S),pageParams:k(v.pageParams,w,S)}};if(s&&i.length){const v=s==="backward",w=v?FH:Y2,x={pages:i,pageParams:o},M=w(n,x);a=await _(x,M,v)}else{const v=t??i.length;do{const w=l===0?o[0]??n.initialPageParam:Y2(n,a);if(l>0&&w==null)break;a=await _(a,w),l++}while(l<v)}return a};e.options.persister?e.fetchFn=()=>{var m,y;return(y=(m=e.options).persister)==null?void 0:y.call(m,c,{queryKey:e.queryKey,meta:e.options.meta,signal:e.signal},r)}:e.fetchFn=c}}}function Y2(t,{pages:e,pageParams:r}){const n=e.length-1;return e.length>0?t.getNextPageParam(e[n],e,r[n],r):void 0}function FH(t,{pages:e,pageParams:r}){var n;return e.length>0?(n=t.getPreviousPageParam)==null?void 0:n.call(t,e[0],e,r[0],r):void 0}var qr,xa,ba,mu,gu,Ma,_u,yu,XD,LH=(XD=class{constructor(t={}){fr(this,qr);fr(this,xa);fr(this,ba);fr(this,mu);fr(this,gu);fr(this,Ma);fr(this,_u);fr(this,yu);Bt(this,qr,t.queryCache||new $H),Bt(this,xa,t.mutationCache||new IH),Bt(this,ba,t.defaultOptions||{}),Bt(this,mu,new Map),Bt(this,gu,new Map),Bt(this,Ma,0)}mount(){np(this,Ma)._++,Ve(this,Ma)===1&&(Bt(this,_u,PR.subscribe(async t=>{t&&(await this.resumePausedMutations(),Ve(this,qr).onFocus())})),Bt(this,yu,_g.subscribe(async t=>{t&&(await this.resumePausedMutations(),Ve(this,qr).onOnline())})))}unmount(){var t,e;np(this,Ma)._--,Ve(this,Ma)===0&&((t=Ve(this,_u))==null||t.call(this),Bt(this,_u,void 0),(e=Ve(this,yu))==null||e.call(this),Bt(this,yu,void 0))}isFetching(t){return Ve(this,qr).findAll({...t,fetchStatus:"fetching"}).length}isMutating(t){return Ve(this,xa).findAll({...t,status:"pending"}).length}getQueryData(t){var r;const e=this.defaultQueryOptions({queryKey:t});return(r=Ve(this,qr).get(e.queryHash))==null?void 0:r.state.data}ensureQueryData(t){const e=this.getQueryData(t.queryKey);if(e===void 0)return this.fetchQuery(t);{const r=this.defaultQueryOptions(t),n=Ve(this,qr).build(this,r);return t.revalidateIfStale&&n.isStaleByTime(U2(r.staleTime,n))&&this.prefetchQuery(r),Promise.resolve(e)}}getQueriesData(t){return Ve(this,qr).findAll(t).map(({queryKey:e,state:r})=>{const n=r.data;return[e,n]})}setQueryData(t,e,r){const n=this.defaultQueryOptions({queryKey:t}),s=Ve(this,qr).get(n.queryHash),i=s==null?void 0:s.state.data,o=mH(e,i);if(o!==void 0)return Ve(this,qr).build(this,n).setData(o,{...r,manual:!0})}setQueriesData(t,e,r){return Zn.batch(()=>Ve(this,qr).findAll(t).map(({queryKey:n})=>[n,this.setQueryData(n,e,r)]))}getQueryState(t){var r;const e=this.defaultQueryOptions({queryKey:t});return(r=Ve(this,qr).get(e.queryHash))==null?void 0:r.state}removeQueries(t){const e=Ve(this,qr);Zn.batch(()=>{e.findAll(t).forEach(r=>{e.remove(r)})})}resetQueries(t,e){const r=Ve(this,qr),n={type:"active",...t};return Zn.batch(()=>(r.findAll(t).forEach(s=>{s.reset()}),this.refetchQueries(n,e)))}cancelQueries(t={},e={}){const r={revert:!0,...e},n=Zn.batch(()=>Ve(this,qr).findAll(t).map(s=>s.cancel(r)));return Promise.all(n).then(Ti).catch(Ti)}invalidateQueries(t={},e={}){return Zn.batch(()=>{if(Ve(this,qr).findAll(t).forEach(n=>{n.invalidate()}),t.refetchType==="none")return Promise.resolve();const r={...t,type:t.refetchType??t.type??"active"};return this.refetchQueries(r,e)})}refetchQueries(t={},e){const r={...e,cancelRefetch:(e==null?void 0:e.cancelRefetch)??!0},n=Zn.batch(()=>Ve(this,qr).findAll(t).filter(s=>!s.isDisabled()).map(s=>{let i=s.fetch(void 0,r);return r.throwOnError||(i=i.catch(Ti)),s.state.fetchStatus==="paused"?Promise.resolve():i}));return Promise.all(n).then(Ti)}fetchQuery(t){const e=this.defaultQueryOptions(t);e.retry===void 0&&(e.retry=!1);const r=Ve(this,qr).build(this,e);return r.isStaleByTime(U2(e.staleTime,r))?r.fetch(e):Promise.resolve(r.state.data)}prefetchQuery(t){return this.fetchQuery(t).then(Ti).catch(Ti)}fetchInfiniteQuery(t){return t.behavior=q2(t.pages),this.fetchQuery(t)}prefetchInfiniteQuery(t){return this.fetchInfiniteQuery(t).then(Ti).catch(Ti)}ensureInfiniteQueryData(t){return t.behavior=q2(t.pages),this.ensureQueryData(t)}resumePausedMutations(){return _g.isOnline()?Ve(this,xa).resumePausedMutations():Promise.resolve()}getQueryCache(){return Ve(this,qr)}getMutationCache(){return Ve(this,xa)}getDefaultOptions(){return Ve(this,ba)}setDefaultOptions(t){Bt(this,ba,t)}setQueryDefaults(t,e){Ve(this,mu).set(jh(t),{queryKey:t,defaultOptions:e})}getQueryDefaults(t){const e=[...Ve(this,mu).values()];let r={};return e.forEach(n=>{Nh(t,n.queryKey)&&(r={...r,...n.defaultOptions})}),r}setMutationDefaults(t,e){Ve(this,gu).set(jh(t),{mutationKey:t,defaultOptions:e})}getMutationDefaults(t){const e=[...Ve(this,gu).values()];let r={};return e.forEach(n=>{Nh(t,n.mutationKey)&&(r={...r,...n.defaultOptions})}),r}defaultQueryOptions(t){if(t._defaulted)return t;const e={...Ve(this,ba).queries,...this.getQueryDefaults(t.queryKey),...t,_defaulted:!0};return e.queryHash||(e.queryHash=ob(e.queryKey,e)),e.refetchOnReconnect===void 0&&(e.refetchOnReconnect=e.networkMode!=="always"),e.throwOnError===void 0&&(e.throwOnError=!!e.suspense),!e.networkMode&&e.persister&&(e.networkMode="offlineFirst"),e.enabled!==!0&&e.queryFn===ab&&(e.enabled=!1),e}defaultMutationOptions(t){return t!=null&&t._defaulted?t:{...Ve(this,ba).mutations,...(t==null?void 0:t.mutationKey)&&this.getMutationDefaults(t.mutationKey),...t,_defaulted:!0}}clear(){Ve(this,qr).clear(),Ve(this,xa).clear()}},qr=new WeakMap,xa=new WeakMap,ba=new WeakMap,mu=new WeakMap,gu=new WeakMap,Ma=new WeakMap,_u=new WeakMap,yu=new WeakMap,XD),RH=D.createContext(void 0),jH=({client:t,children:e})=>(D.useEffect(()=>(t.mount(),()=>{t.unmount()}),[t]),G.jsx(RH.Provider,{value:t,children:e}));/**
 * @remix-run/router v1.20.0
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function yg(){return yg=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}return t},yg.apply(this,arguments)}var Sa;(function(t){t.Pop="POP",t.Push="PUSH",t.Replace="REPLACE"})(Sa||(Sa={}));const Q2="popstate";function NH(t){t===void 0&&(t={});function e(s,i){let{pathname:o="/",search:a="",hash:l=""}=of(s.location.hash.substr(1));return!o.startsWith("/")&&!o.startsWith(".")&&(o="/"+o),Zw("",{pathname:o,search:a,hash:l},i.state&&i.state.usr||null,i.state&&i.state.key||"default")}function r(s,i){let o=s.document.querySelector("base"),a="";if(o&&o.getAttribute("href")){let l=s.location.href,c=l.indexOf("#");a=c===-1?l:l.slice(0,c)}return a+"#"+(typeof i=="string"?i:DR(i))}function n(s,i){lb(s.pathname.charAt(0)==="/","relative pathnames are not supported in hash history.push("+JSON.stringify(i)+")")}return BH(e,r,n,t)}function ys(t,e){if(t===!1||t===null||typeof t>"u")throw new Error(e)}function lb(t,e){if(!t){typeof console<"u"&&console.warn(e);try{throw new Error(e)}catch{}}}function zH(){return Math.random().toString(36).substr(2,8)}function J2(t,e){return{usr:t.state,key:t.key,idx:e}}function Zw(t,e,r,n){return r===void 0&&(r=null),yg({pathname:typeof t=="string"?t:t.pathname,search:"",hash:""},typeof e=="string"?of(e):e,{state:r,key:e&&e.key||n||zH()})}function DR(t){let{pathname:e="/",search:r="",hash:n=""}=t;return r&&r!=="?"&&(e+=r.charAt(0)==="?"?r:"?"+r),n&&n!=="#"&&(e+=n.charAt(0)==="#"?n:"#"+n),e}function of(t){let e={};if(t){let r=t.indexOf("#");r>=0&&(e.hash=t.substr(r),t=t.substr(0,r));let n=t.indexOf("?");n>=0&&(e.search=t.substr(n),t=t.substr(0,n)),t&&(e.pathname=t)}return e}function BH(t,e,r,n){n===void 0&&(n={});let{window:s=document.defaultView,v5Compat:i=!1}=n,o=s.history,a=Sa.Pop,l=null,c=u();c==null&&(c=0,o.replaceState(yg({},o.state,{idx:c}),""));function u(){return(o.state||{idx:null}).idx}function d(){a=Sa.Pop;let y=u(),g=y==null?null:y-c;c=y,l&&l({action:a,location:m.location,delta:g})}function h(y,g){a=Sa.Push;let _=Zw(m.location,y,g);r&&r(_,y),c=u()+1;let v=J2(_,c),w=m.createHref(_);try{o.pushState(v,"",w)}catch(x){if(x instanceof DOMException&&x.name==="DataCloneError")throw x;s.location.assign(w)}i&&l&&l({action:a,location:m.location,delta:1})}function f(y,g){a=Sa.Replace;let _=Zw(m.location,y,g);r&&r(_,y),c=u();let v=J2(_,c),w=m.createHref(_);o.replaceState(v,"",w),i&&l&&l({action:a,location:m.location,delta:0})}function p(y){let g=s.location.origin!=="null"?s.location.origin:s.location.href,_=typeof y=="string"?y:DR(y);return _=_.replace(/ $/,"%20"),ys(g,"No window.location.(origin|href) available to create URL for href: "+_),new URL(_,g)}let m={get action(){return a},get location(){return t(s,o)},listen(y){if(l)throw new Error("A history only accepts one active listener");return s.addEventListener(Q2,d),l=y,()=>{s.removeEventListener(Q2,d),l=null}},createHref(y){return e(s,y)},createURL:p,encodeLocation(y){let g=p(y);return{pathname:g.pathname,search:g.search,hash:g.hash}},push:h,replace:f,go(y){return o.go(y)}};return m}var Z2;(function(t){t.data="data",t.deferred="deferred",t.redirect="redirect",t.error="error"})(Z2||(Z2={}));function VH(t,e,r){return r===void 0&&(r="/"),WH(t,e,r,!1)}function WH(t,e,r,n){let s=typeof e=="string"?of(e):e,i=LR(s.pathname||"/",r);if(i==null)return null;let o=IR(t);UH(o);let a=null;for(let l=0;a==null&&l<o.length;++l){let c=tK(i);a=ZH(o[l],c,n)}return a}function IR(t,e,r,n){e===void 0&&(e=[]),r===void 0&&(r=[]),n===void 0&&(n="");let s=(i,o,a)=>{let l={relativePath:a===void 0?i.path||"":a,caseSensitive:i.caseSensitive===!0,childrenIndex:o,route:i};l.relativePath.startsWith("/")&&(ys(l.relativePath.startsWith(n),'Absolute route path "'+l.relativePath+'" nested under path '+('"'+n+'" is not valid. An absolute child route path ')+"must start with the combined path of all its parent routes."),l.relativePath=l.relativePath.slice(n.length));let c=su([n,l.relativePath]),u=r.concat(l);i.children&&i.children.length>0&&(ys(i.index!==!0,"Index routes must not have child routes. Please remove "+('all child routes from route path "'+c+'".')),IR(i.children,e,u,c)),!(i.path==null&&!i.index)&&e.push({path:c,score:QH(c,i.index),routesMeta:u})};return t.forEach((i,o)=>{var a;if(i.path===""||!((a=i.path)!=null&&a.includes("?")))s(i,o);else for(let l of FR(i.path))s(i,o,l)}),e}function FR(t){let e=t.split("/");if(e.length===0)return[];let[r,...n]=e,s=r.endsWith("?"),i=r.replace(/\?$/,"");if(n.length===0)return s?[i,""]:[i];let o=FR(n.join("/")),a=[];return a.push(...o.map(l=>l===""?i:[i,l].join("/"))),s&&a.push(...o),a.map(l=>t.startsWith("/")&&l===""?"/":l)}function UH(t){t.sort((e,r)=>e.score!==r.score?r.score-e.score:JH(e.routesMeta.map(n=>n.childrenIndex),r.routesMeta.map(n=>n.childrenIndex)))}const GH=/^:[\w-]+$/,HH=3,KH=2,XH=1,qH=10,YH=-2,ek=t=>t==="*";function QH(t,e){let r=t.split("/"),n=r.length;return r.some(ek)&&(n+=YH),e&&(n+=KH),r.filter(s=>!ek(s)).reduce((s,i)=>s+(GH.test(i)?HH:i===""?XH:qH),n)}function JH(t,e){return t.length===e.length&&t.slice(0,-1).every((n,s)=>n===e[s])?t[t.length-1]-e[e.length-1]:0}function ZH(t,e,r){let{routesMeta:n}=t,s={},i="/",o=[];for(let a=0;a<n.length;++a){let l=n[a],c=a===n.length-1,u=i==="/"?e:e.slice(i.length)||"/",d=tk({path:l.relativePath,caseSensitive:l.caseSensitive,end:c},u),h=l.route;if(!d&&c&&r&&!n[n.length-1].route.index&&(d=tk({path:l.relativePath,caseSensitive:l.caseSensitive,end:!1},u)),!d)return null;Object.assign(s,d.params),o.push({params:s,pathname:su([i,d.pathname]),pathnameBase:rK(su([i,d.pathnameBase])),route:h}),d.pathnameBase!=="/"&&(i=su([i,d.pathnameBase]))}return o}function tk(t,e){typeof t=="string"&&(t={path:t,caseSensitive:!1,end:!0});let[r,n]=eK(t.path,t.caseSensitive,t.end),s=e.match(r);if(!s)return null;let i=s[0],o=i.replace(/(.)\/+$/,"$1"),a=s.slice(1);return{params:n.reduce((c,u,d)=>{let{paramName:h,isOptional:f}=u;if(h==="*"){let m=a[d]||"";o=i.slice(0,i.length-m.length).replace(/(.)\/+$/,"$1")}const p=a[d];return f&&!p?c[h]=void 0:c[h]=(p||"").replace(/%2F/g,"/"),c},{}),pathname:i,pathnameBase:o,pattern:t}}function eK(t,e,r){e===void 0&&(e=!1),r===void 0&&(r=!0),lb(t==="*"||!t.endsWith("*")||t.endsWith("/*"),'Route path "'+t+'" will be treated as if it were '+('"'+t.replace(/\*$/,"/*")+'" because the `*` character must ')+"always follow a `/` in the pattern. To get rid of this warning, "+('please change the route path to "'+t.replace(/\*$/,"/*")+'".'));let n=[],s="^"+t.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(o,a,l)=>(n.push({paramName:a,isOptional:l!=null}),l?"/?([^\\/]+)?":"/([^\\/]+)"));return t.endsWith("*")?(n.push({paramName:"*"}),s+=t==="*"||t==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):r?s+="\\/*$":t!==""&&t!=="/"&&(s+="(?:(?=\\/|$))"),[new RegExp(s,e?void 0:"i"),n]}function tK(t){try{return t.split("/").map(e=>decodeURIComponent(e).replace(/\//g,"%2F")).join("/")}catch(e){return lb(!1,'The URL path "'+t+'" could not be decoded because it is is a malformed URL segment. This is probably due to a bad percent '+("encoding ("+e+").")),t}}function LR(t,e){if(e==="/")return t;if(!t.toLowerCase().startsWith(e.toLowerCase()))return null;let r=e.endsWith("/")?e.length-1:e.length,n=t.charAt(r);return n&&n!=="/"?null:t.slice(r)||"/"}const su=t=>t.join("/").replace(/\/\/+/g,"/"),rK=t=>t.replace(/\/+$/,"").replace(/^\/*/,"/");function nK(t){return t!=null&&typeof t.status=="number"&&typeof t.statusText=="string"&&typeof t.internal=="boolean"&&"data"in t}const RR=["post","put","patch","delete"];new Set(RR);const sK=["get",...RR];new Set(sK);/**
 * React Router v6.27.0
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function vg(){return vg=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}return t},vg.apply(this,arguments)}const iK=D.createContext(null),oK=D.createContext(null),jR=D.createContext(null),m_=D.createContext(null),g_=D.createContext({outlet:null,matches:[],isDataRoute:!1}),NR=D.createContext(null);function cb(){return D.useContext(m_)!=null}function aK(){return cb()||ys(!1),D.useContext(m_).location}function lK(t,e){return cK(t,e)}function cK(t,e,r,n){cb()||ys(!1);let{navigator:s}=D.useContext(jR),{matches:i}=D.useContext(g_),o=i[i.length-1],a=o?o.params:{};o&&o.pathname;let l=o?o.pathnameBase:"/";o&&o.route;let c=aK(),u;if(e){var d;let y=typeof e=="string"?of(e):e;l==="/"||(d=y.pathname)!=null&&d.startsWith(l)||ys(!1),u=y}else u=c;let h=u.pathname||"/",f=h;if(l!=="/"){let y=l.replace(/^\//,"").split("/");f="/"+h.replace(/^\//,"").split("/").slice(y.length).join("/")}let p=VH(t,{pathname:f}),m=pK(p&&p.map(y=>Object.assign({},y,{params:Object.assign({},a,y.params),pathname:su([l,s.encodeLocation?s.encodeLocation(y.pathname).pathname:y.pathname]),pathnameBase:y.pathnameBase==="/"?l:su([l,s.encodeLocation?s.encodeLocation(y.pathnameBase).pathname:y.pathnameBase])})),i,r,n);return e&&m?D.createElement(m_.Provider,{value:{location:vg({pathname:"/",search:"",hash:"",state:null,key:"default"},u),navigationType:Sa.Pop}},m):m}function uK(){let t=yK(),e=nK(t)?t.status+" "+t.statusText:t instanceof Error?t.message:JSON.stringify(t),r=t instanceof Error?t.stack:null,s={padding:"0.5rem",backgroundColor:"rgba(200,200,200, 0.5)"};return D.createElement(D.Fragment,null,D.createElement("h2",null,"Unexpected Application Error!"),D.createElement("h3",{style:{fontStyle:"italic"}},e),r?D.createElement("pre",{style:s},r):null,null)}const dK=D.createElement(uK,null);class hK extends D.Component{constructor(e){super(e),this.state={location:e.location,revalidation:e.revalidation,error:e.error}}static getDerivedStateFromError(e){return{error:e}}static getDerivedStateFromProps(e,r){return r.location!==e.location||r.revalidation!=="idle"&&e.revalidation==="idle"?{error:e.error,location:e.location,revalidation:e.revalidation}:{error:e.error!==void 0?e.error:r.error,location:r.location,revalidation:e.revalidation||r.revalidation}}componentDidCatch(e,r){console.error("React Router caught the following error during render",e,r)}render(){return this.state.error!==void 0?D.createElement(g_.Provider,{value:this.props.routeContext},D.createElement(NR.Provider,{value:this.state.error,children:this.props.component})):this.props.children}}function fK(t){let{routeContext:e,match:r,children:n}=t,s=D.useContext(iK);return s&&s.static&&s.staticContext&&(r.route.errorElement||r.route.ErrorBoundary)&&(s.staticContext._deepestRenderedBoundaryId=r.route.id),D.createElement(g_.Provider,{value:e},n)}function pK(t,e,r,n){var s;if(e===void 0&&(e=[]),r===void 0&&(r=null),n===void 0&&(n=null),t==null){var i;if(!r)return null;if(r.errors)t=r.matches;else if((i=n)!=null&&i.v7_partialHydration&&e.length===0&&!r.initialized&&r.matches.length>0)t=r.matches;else return null}let o=t,a=(s=r)==null?void 0:s.errors;if(a!=null){let u=o.findIndex(d=>d.route.id&&(a==null?void 0:a[d.route.id])!==void 0);u>=0||ys(!1),o=o.slice(0,Math.min(o.length,u+1))}let l=!1,c=-1;if(r&&n&&n.v7_partialHydration)for(let u=0;u<o.length;u++){let d=o[u];if((d.route.HydrateFallback||d.route.hydrateFallbackElement)&&(c=u),d.route.id){let{loaderData:h,errors:f}=r,p=d.route.loader&&h[d.route.id]===void 0&&(!f||f[d.route.id]===void 0);if(d.route.lazy||p){l=!0,c>=0?o=o.slice(0,c+1):o=[o[0]];break}}}return o.reduceRight((u,d,h)=>{let f,p=!1,m=null,y=null;r&&(f=a&&d.route.id?a[d.route.id]:void 0,m=d.route.errorElement||dK,l&&(c<0&&h===0?(p=!0,y=null):c===h&&(p=!0,y=d.route.hydrateFallbackElement||null)));let g=e.concat(o.slice(0,h+1)),_=()=>{let v;return f?v=m:p?v=y:d.route.Component?v=D.createElement(d.route.Component,null):d.route.element?v=d.route.element:v=u,D.createElement(fK,{match:d,routeContext:{outlet:u,matches:g,isDataRoute:r!=null},children:v})};return r&&(d.route.ErrorBoundary||d.route.errorElement||h===0)?D.createElement(hK,{location:r.location,revalidation:r.revalidation,component:m,error:f,children:_(),routeContext:{outlet:null,matches:g,isDataRoute:!0}}):_()},null)}var ex=function(t){return t.UseBlocker="useBlocker",t.UseLoaderData="useLoaderData",t.UseActionData="useActionData",t.UseRouteError="useRouteError",t.UseNavigation="useNavigation",t.UseRouteLoaderData="useRouteLoaderData",t.UseMatches="useMatches",t.UseRevalidator="useRevalidator",t.UseNavigateStable="useNavigate",t.UseRouteId="useRouteId",t}(ex||{});function mK(t){let e=D.useContext(oK);return e||ys(!1),e}function gK(t){let e=D.useContext(g_);return e||ys(!1),e}function _K(t){let e=gK(),r=e.matches[e.matches.length-1];return r.route.id||ys(!1),r.route.id}function yK(){var t;let e=D.useContext(NR),r=mK(ex.UseRouteError),n=_K(ex.UseRouteError);return e!==void 0?e:(t=r.errors)==null?void 0:t[n]}function tx(t){ys(!1)}function vK(t){let{basename:e="/",children:r=null,location:n,navigationType:s=Sa.Pop,navigator:i,static:o=!1,future:a}=t;cb()&&ys(!1);let l=e.replace(/^\/*/,"/"),c=D.useMemo(()=>({basename:l,navigator:i,static:o,future:vg({v7_relativeSplatPath:!1},a)}),[l,a,i,o]);typeof n=="string"&&(n=of(n));let{pathname:u="/",search:d="",hash:h="",state:f=null,key:p="default"}=n,m=D.useMemo(()=>{let y=LR(u,l);return y==null?null:{location:{pathname:y,search:d,hash:h,state:f,key:p},navigationType:s}},[l,u,d,h,f,p,s]);return m==null?null:D.createElement(jR.Provider,{value:c},D.createElement(m_.Provider,{children:r,value:m}))}function wK(t){let{children:e,location:r}=t;return lK(rx(e),r)}new Promise(()=>{});function rx(t,e){e===void 0&&(e=[]);let r=[];return D.Children.forEach(t,(n,s)=>{if(!D.isValidElement(n))return;let i=[...e,s];if(n.type===D.Fragment){r.push.apply(r,rx(n.props.children,i));return}n.type!==tx&&ys(!1),!n.props.index||!n.props.children||ys(!1);let o={id:n.props.id||i.join("-"),caseSensitive:n.props.caseSensitive,element:n.props.element,Component:n.props.Component,index:n.props.index,path:n.props.path,loader:n.props.loader,action:n.props.action,errorElement:n.props.errorElement,ErrorBoundary:n.props.ErrorBoundary,hasErrorBoundary:n.props.ErrorBoundary!=null||n.props.errorElement!=null,shouldRevalidate:n.props.shouldRevalidate,handle:n.props.handle,lazy:n.props.lazy};n.props.children&&(o.children=rx(n.props.children,i)),r.push(o)}),r}/**
 * React Router DOM v6.27.0
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */const xK="6";try{window.__reactRouterVersion=xK}catch{}const bK="startTransition",rk=oI[bK];function MK(t){let{basename:e,children:r,future:n,window:s}=t,i=D.useRef();i.current==null&&(i.current=NH({window:s,v5Compat:!0}));let o=i.current,[a,l]=D.useState({action:o.action,location:o.location}),{v7_startTransition:c}=n||{},u=D.useCallback(d=>{c&&rk?rk(()=>l(d)):l(d)},[l,c]);return D.useLayoutEffect(()=>o.listen(u),[o,u]),D.createElement(vK,{basename:e,children:r,location:a.location,navigationType:a.action,navigator:o,future:n})}var nk;(function(t){t.UseScrollRestoration="useScrollRestoration",t.UseSubmit="useSubmit",t.UseSubmitFetcher="useSubmitFetcher",t.UseFetcher="useFetcher",t.useViewTransitionState="useViewTransitionState"})(nk||(nk={}));var sk;(function(t){t.UseFetcher="useFetcher",t.UseFetchers="useFetchers",t.UseScrollRestoration="useScrollRestoration"})(sk||(sk={}));const __=D.forwardRef(({className:t,...e},r)=>G.jsx("div",{ref:r,className:tr("rounded-lg border bg-card text-card-foreground shadow-sm",t),...e}));__.displayName="Card";const TK=D.forwardRef(({className:t,...e},r)=>G.jsx("div",{ref:r,className:tr("flex flex-col space-y-1.5 p-6",t),...e}));TK.displayName="CardHeader";const CK=D.forwardRef(({className:t,...e},r)=>G.jsx("h3",{ref:r,className:tr("text-2xl font-semibold leading-none tracking-tight",t),...e}));CK.displayName="CardTitle";const SK=D.forwardRef(({className:t,...e},r)=>G.jsx("p",{ref:r,className:tr("text-sm text-muted-foreground",t),...e}));SK.displayName="CardDescription";const EK=D.forwardRef(({className:t,...e},r)=>G.jsx("div",{ref:r,className:tr("p-6 pt-0",t),...e}));EK.displayName="CardContent";const PK=D.forwardRef(({className:t,...e},r)=>G.jsx("div",{ref:r,className:tr("flex items-center p-6 pt-0",t),...e}));PK.displayName="CardFooter";const ub=q1("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),oo=D.forwardRef(({className:t,variant:e,size:r,asChild:n=!1,...s},i)=>{const o=n?ql:"button";return G.jsx(o,{className:tr(ub({variant:e,size:r,className:t})),ref:i,...s})});oo.displayName="Button";const ik=({onImageUpload:t})=>{const[e,r]=D.useState(!1),n=D.useCallback(a=>{a.preventDefault(),r(!1);const c=Array.from(a.dataTransfer.files).find(u=>u.type.startsWith("image/"));c&&t(c)},[t]),s=D.useCallback(a=>{a.preventDefault(),r(!0)},[]),i=D.useCallback(a=>{a.preventDefault(),r(!1)},[]),o=a=>{var c;const l=(c=a.target.files)==null?void 0:c[0];l&&l.type.startsWith("image/")&&t(l)};return G.jsx(__,{className:"max-w-2xl mx-auto",children:G.jsx("div",{className:`p-12 border-2 border-dashed rounded-lg transition-all duration-200 ${e?"border-blue-400 bg-blue-50":"border-gray-300 hover:border-gray-400"}`,onDrop:n,onDragOver:s,onDragLeave:i,children:G.jsxs("div",{className:"text-center",children:[G.jsx("div",{className:"w-16 h-16 mx-auto mb-4 bg-gradient-to-r from-blue-500 to-purple-500 rounded-full flex items-center justify-center",children:G.jsx(NL,{className:"w-8 h-8 text-white"})}),G.jsx("h3",{className:"text-xl font-semibold mb-2",children:"Upload Your Photo"}),G.jsx("p",{className:"text-gray-600 mb-6",children:"Drag and drop your image here, or click to browse"}),G.jsxs("div",{className:"space-y-4",children:[G.jsx("input",{type:"file",accept:"image/*",onChange:o,className:"hidden",id:"photo-upload"}),G.jsx("label",{htmlFor:"photo-upload",children:G.jsx(oo,{asChild:!0,className:"bg-gradient-to-r from-blue-500 to-purple-500 hover:from-blue-600 hover:to-purple-600",children:G.jsxs("span",{className:"cursor-pointer inline-flex items-center gap-2",children:[G.jsx(PG,{className:"w-4 h-4"}),"Choose Photo"]})})})]}),G.jsx("p",{className:"text-sm text-gray-500 mt-4",children:"Supports JPG, PNG, GIF, and WebP formats"})]})})})},zR=D.forwardRef(({className:t,...e},r)=>G.jsx("textarea",{className:tr("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",t),ref:r,...e}));zR.displayName="Textarea";const BR=D.forwardRef(({className:t,type:e,...r},n)=>G.jsx("input",{type:e,className:tr("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",t),ref:n,...r}));BR.displayName="Input";var kK="Label",VR=D.forwardRef((t,e)=>G.jsx(Kt.label,{...t,ref:e,onMouseDown:r=>{var s;r.target.closest("button, input, select, textarea")||((s=t.onMouseDown)==null||s.call(t,r),!r.defaultPrevented&&r.detail>1&&r.preventDefault())}}));VR.displayName=kK;var WR=VR;const AK=q1("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),nx=D.forwardRef(({className:t,...e},r)=>G.jsx(WR,{ref:r,className:tr(AK(),t),...e}));nx.displayName=WR.displayName;const Om=new Map,Tl=[],$K=(t,e,r)=>{if(e&&typeof e.init=="function"&&typeof e.createInferenceSessionHandler=="function"){const n=Om.get(t);if(n===void 0)Om.set(t,{backend:e,priority:r});else{if(n.priority>r)return;if(n.priority===r&&n.backend!==e)throw new Error(`cannot register backend "${t}" using priority ${r}`)}if(r>=0){const s=Tl.indexOf(t);s!==-1&&Tl.splice(s,1);for(let i=0;i<Tl.length;i++)if(Om.get(Tl[i]).priority<=r){Tl.splice(i,0,t);return}Tl.push(t)}return}throw new TypeError("not a valid backend")},OK=async t=>{const e=Om.get(t);if(!e)return"backend not found.";if(e.initialized)return e.backend;if(e.aborted)return e.error;{const r=!!e.initPromise;try{return r||(e.initPromise=e.backend.init(t)),await e.initPromise,e.initialized=!0,e.backend}catch(n){return r||(e.error=`${n}`,e.aborted=!0),e.error}finally{delete e.initPromise}}},DK=async t=>{const e=t.executionProviders||[],r=e.map(l=>typeof l=="string"?l:l.name),n=r.length===0?Tl:r;let s;const i=[],o=new Set;for(const l of n){const c=await OK(l);typeof c=="string"?i.push({name:l,err:c}):(s||(s=c),s===c&&o.add(l))}if(!s)throw new Error(`no available backend found. ERR: ${i.map(l=>`[${l.name}] ${l.err}`).join(", ")}`);for(const{name:l,err:c}of i)r.includes(l)&&console.warn(`removing requested execution provider "${l}" from session options because it is not available: ${c}`);const a=e.filter(l=>o.has(typeof l=="string"?l:l.name));return[s,new Proxy(t,{get:(l,c)=>c==="executionProviders"?a:Reflect.get(l,c)})]},IK="1.21.0";let ok="warning";const Li={wasm:{},webgl:{},webgpu:{},versions:{common:IK},set logLevel(t){if(t!==void 0){if(typeof t!="string"||["verbose","info","warning","error","fatal"].indexOf(t)===-1)throw new Error(`Unsupported logging level: ${t}`);ok=t}},get logLevel(){return ok}};Object.defineProperty(Li,"logLevel",{enumerable:!0});const FK=Li,LK=(t,e)=>{const r=typeof document<"u"?document.createElement("canvas"):new OffscreenCanvas(1,1);r.width=t.dims[3],r.height=t.dims[2];const n=r.getContext("2d");if(n!=null){let s,i;(e==null?void 0:e.tensorLayout)!==void 0&&e.tensorLayout==="NHWC"?(s=t.dims[2],i=t.dims[3]):(s=t.dims[3],i=t.dims[2]);const o=(e==null?void 0:e.format)!==void 0?e.format:"RGB",a=e==null?void 0:e.norm;let l,c;a===void 0||a.mean===void 0?l=[255,255,255,255]:typeof a.mean=="number"?l=[a.mean,a.mean,a.mean,a.mean]:(l=[a.mean[0],a.mean[1],a.mean[2],0],a.mean[3]!==void 0&&(l[3]=a.mean[3])),a===void 0||a.bias===void 0?c=[0,0,0,0]:typeof a.bias=="number"?c=[a.bias,a.bias,a.bias,a.bias]:(c=[a.bias[0],a.bias[1],a.bias[2],0],a.bias[3]!==void 0&&(c[3]=a.bias[3]));const u=i*s;let d=0,h=u,f=u*2,p=-1;o==="RGBA"?(d=0,h=u,f=u*2,p=u*3):o==="RGB"?(d=0,h=u,f=u*2):o==="RBG"&&(d=0,f=u,h=u*2);for(let m=0;m<i;m++)for(let y=0;y<s;y++){const g=(t.data[d++]-c[0])*l[0],_=(t.data[h++]-c[1])*l[1],v=(t.data[f++]-c[2])*l[2],w=p===-1?255:(t.data[p++]-c[3])*l[3];n.fillStyle="rgba("+g+","+_+","+v+","+w+")",n.fillRect(y,m,1,1)}if("toDataURL"in r)return r.toDataURL();throw new Error("toDataURL is not supported")}else throw new Error("Can not access image data")},RK=(t,e)=>{const r=typeof document<"u"?document.createElement("canvas").getContext("2d"):new OffscreenCanvas(1,1).getContext("2d");let n;if(r!=null){let s,i,o;(e==null?void 0:e.tensorLayout)!==void 0&&e.tensorLayout==="NHWC"?(s=t.dims[2],i=t.dims[1],o=t.dims[3]):(s=t.dims[3],i=t.dims[2],o=t.dims[1]);const a=e!==void 0&&e.format!==void 0?e.format:"RGB",l=e==null?void 0:e.norm;let c,u;l===void 0||l.mean===void 0?c=[255,255,255,255]:typeof l.mean=="number"?c=[l.mean,l.mean,l.mean,l.mean]:(c=[l.mean[0],l.mean[1],l.mean[2],255],l.mean[3]!==void 0&&(c[3]=l.mean[3])),l===void 0||l.bias===void 0?u=[0,0,0,0]:typeof l.bias=="number"?u=[l.bias,l.bias,l.bias,l.bias]:(u=[l.bias[0],l.bias[1],l.bias[2],0],l.bias[3]!==void 0&&(u[3]=l.bias[3]));const d=i*s;if(e!==void 0&&(e.format!==void 0&&o===4&&e.format!=="RGBA"||o===3&&e.format!=="RGB"&&e.format!=="BGR"))throw new Error("Tensor format doesn't match input tensor dims");const h=4;let f=0,p=1,m=2,y=3,g=0,_=d,v=d*2,w=-1;a==="RGBA"?(g=0,_=d,v=d*2,w=d*3):a==="RGB"?(g=0,_=d,v=d*2):a==="RBG"&&(g=0,v=d,_=d*2),n=r.createImageData(s,i);for(let x=0;x<i*s;f+=h,p+=h,m+=h,y+=h,x++)n.data[f]=(t.data[g++]-u[0])*c[0],n.data[p]=(t.data[_++]-u[1])*c[1],n.data[m]=(t.data[v++]-u[2])*c[2],n.data[y]=w===-1?255:(t.data[w++]-u[3])*c[3]}else throw new Error("Can not access image data");return n},Py=(t,e)=>{if(t===void 0)throw new Error("Image buffer must be defined");if(e.height===void 0||e.width===void 0)throw new Error("Image height and width must be defined");if(e.tensorLayout==="NHWC")throw new Error("NHWC Tensor layout is not supported yet");const{height:r,width:n}=e,s=e.norm??{mean:255,bias:0};let i,o;typeof s.mean=="number"?i=[s.mean,s.mean,s.mean,s.mean]:i=[s.mean[0],s.mean[1],s.mean[2],s.mean[3]??255],typeof s.bias=="number"?o=[s.bias,s.bias,s.bias,s.bias]:o=[s.bias[0],s.bias[1],s.bias[2],s.bias[3]??0];const a=e.format!==void 0?e.format:"RGBA",l=e.tensorFormat!==void 0&&e.tensorFormat!==void 0?e.tensorFormat:"RGB",c=r*n,u=l==="RGBA"?new Float32Array(c*4):new Float32Array(c*3);let d=4,h=0,f=1,p=2,m=3,y=0,g=c,_=c*2,v=-1;a==="RGB"&&(d=3,h=0,f=1,p=2,m=-1),l==="RGBA"?v=c*3:l==="RBG"?(y=0,_=c,g=c*2):l==="BGR"&&(_=0,g=c,y=c*2);for(let x=0;x<c;x++,h+=d,p+=d,f+=d,m+=d)u[y++]=(t[h]+o[0])/i[0],u[g++]=(t[f]+o[1])/i[1],u[_++]=(t[p]+o[2])/i[2],v!==-1&&m!==-1&&(u[v++]=(t[m]+o[3])/i[3]);return l==="RGBA"?new Zs("float32",u,[1,4,r,n]):new Zs("float32",u,[1,3,r,n])},jK=async(t,e)=>{const r=typeof HTMLImageElement<"u"&&t instanceof HTMLImageElement,n=typeof ImageData<"u"&&t instanceof ImageData,s=typeof ImageBitmap<"u"&&t instanceof ImageBitmap,i=typeof t=="string";let o,a=e??{};const l=()=>{if(typeof document<"u")return document.createElement("canvas");if(typeof OffscreenCanvas<"u")return new OffscreenCanvas(1,1);throw new Error("Canvas is not supported")},c=u=>typeof HTMLCanvasElement<"u"&&u instanceof HTMLCanvasElement||u instanceof OffscreenCanvas?u.getContext("2d"):null;if(r){const u=l();u.width=t.width,u.height=t.height;const d=c(u);if(d!=null){let h=t.height,f=t.width;if(e!==void 0&&e.resizedHeight!==void 0&&e.resizedWidth!==void 0&&(h=e.resizedHeight,f=e.resizedWidth),e!==void 0){if(a=e,e.tensorFormat!==void 0)throw new Error("Image input config format must be RGBA for HTMLImageElement");a.tensorFormat="RGBA",a.height=h,a.width=f}else a.tensorFormat="RGBA",a.height=h,a.width=f;d.drawImage(t,0,0),o=d.getImageData(0,0,f,h).data}else throw new Error("Can not access image data")}else if(n){let u,d;if(e!==void 0&&e.resizedWidth!==void 0&&e.resizedHeight!==void 0?(u=e.resizedHeight,d=e.resizedWidth):(u=t.height,d=t.width),e!==void 0&&(a=e),a.format="RGBA",a.height=u,a.width=d,e!==void 0){const h=l();h.width=d,h.height=u;const f=c(h);if(f!=null)f.putImageData(t,0,0),o=f.getImageData(0,0,d,u).data;else throw new Error("Can not access image data")}else o=t.data}else if(s){if(e===void 0)throw new Error("Please provide image config with format for Imagebitmap");const u=l();u.width=t.width,u.height=t.height;const d=c(u);if(d!=null){const h=t.height,f=t.width;return d.drawImage(t,0,0,f,h),o=d.getImageData(0,0,f,h).data,a.height=h,a.width=f,Py(o,a)}else throw new Error("Can not access image data")}else{if(i)return new Promise((u,d)=>{const h=l(),f=c(h);if(!t||!f)return d();const p=new Image;p.crossOrigin="Anonymous",p.src=t,p.onload=()=>{h.width=p.width,h.height=p.height,f.drawImage(p,0,0,h.width,h.height);const m=f.getImageData(0,0,h.width,h.height);a.height=h.height,a.width=h.width,u(Py(m.data,a))}});throw new Error("Input data provided is not supported - aborted tensor creation")}if(o!==void 0)return Py(o,a);throw new Error("Input data provided is not supported - aborted tensor creation")},NK=(t,e)=>{const{width:r,height:n,download:s,dispose:i}=e,o=[1,n,r,4];return new Zs({location:"texture",type:"float32",texture:t,dims:o,download:s,dispose:i})},zK=(t,e)=>{const{dataType:r,dims:n,download:s,dispose:i}=e;return new Zs({location:"gpu-buffer",type:r??"float32",gpuBuffer:t,dims:n,download:s,dispose:i})},BK=(t,e)=>{const{dataType:r,dims:n,download:s,dispose:i}=e;return new Zs({location:"ml-tensor",type:r??"float32",mlTensor:t,dims:n,download:s,dispose:i})},VK=(t,e,r)=>new Zs({location:"cpu-pinned",type:t,data:e,dims:r??[e.length]}),Uc=new Map([["float32",Float32Array],["uint8",Uint8Array],["int8",Int8Array],["uint16",Uint16Array],["int16",Int16Array],["int32",Int32Array],["bool",Uint8Array],["float64",Float64Array],["uint32",Uint32Array],["int4",Uint8Array],["uint4",Uint8Array]]),Dm=new Map([[Float32Array,"float32"],[Uint8Array,"uint8"],[Int8Array,"int8"],[Uint16Array,"uint16"],[Int16Array,"int16"],[Int32Array,"int32"],[Float64Array,"float64"],[Uint32Array,"uint32"]]);let ak=!1;const WK=()=>{if(!ak){ak=!0;const t=typeof BigInt64Array<"u"&&BigInt64Array.from,e=typeof BigUint64Array<"u"&&BigUint64Array.from,r=globalThis.Float16Array,n=typeof r<"u"&&r.from;t&&(Uc.set("int64",BigInt64Array),Dm.set(BigInt64Array,"int64")),e&&(Uc.set("uint64",BigUint64Array),Dm.set(BigUint64Array,"uint64")),n?(Uc.set("float16",r),Dm.set(r,"float16")):Uc.set("float16",Uint16Array)}},UK=t=>{let e=1;for(let r=0;r<t.length;r++){const n=t[r];if(typeof n!="number"||!Number.isSafeInteger(n))throw new TypeError(`dims[${r}] must be an integer, got: ${n}`);if(n<0)throw new RangeError(`dims[${r}] must be a non-negative integer, got: ${n}`);e*=n}return e},GK=(t,e)=>{switch(t.location){case"cpu":return new Zs(t.type,t.data,e);case"cpu-pinned":return new Zs({location:"cpu-pinned",data:t.data,type:t.type,dims:e});case"texture":return new Zs({location:"texture",texture:t.texture,type:t.type,dims:e});case"gpu-buffer":return new Zs({location:"gpu-buffer",gpuBuffer:t.gpuBuffer,type:t.type,dims:e});case"ml-tensor":return new Zs({location:"ml-tensor",mlTensor:t.mlTensor,type:t.type,dims:e});default:throw new Error(`tensorReshape: tensor location ${t.location} is not supported`)}};let Zs=class{constructor(e,r,n){WK();let s,i;if(typeof e=="object"&&"location"in e)switch(this.dataLocation=e.location,s=e.type,i=e.dims,e.location){case"cpu-pinned":{const a=Uc.get(s);if(!a)throw new TypeError(`unsupported type "${s}" to create tensor from pinned buffer`);if(!(e.data instanceof a))throw new TypeError(`buffer should be of type ${a.name}`);this.cpuData=e.data;break}case"texture":{if(s!=="float32")throw new TypeError(`unsupported type "${s}" to create tensor from texture`);this.gpuTextureData=e.texture,this.downloader=e.download,this.disposer=e.dispose;break}case"gpu-buffer":{if(s!=="float32"&&s!=="float16"&&s!=="int32"&&s!=="int64"&&s!=="uint32"&&s!=="uint8"&&s!=="bool"&&s!=="uint4"&&s!=="int4")throw new TypeError(`unsupported type "${s}" to create tensor from gpu buffer`);this.gpuBufferData=e.gpuBuffer,this.downloader=e.download,this.disposer=e.dispose;break}case"ml-tensor":{if(s!=="float32"&&s!=="float16"&&s!=="int32"&&s!=="int64"&&s!=="uint32"&&s!=="uint64"&&s!=="int8"&&s!=="uint8"&&s!=="bool"&&s!=="uint4"&&s!=="int4")throw new TypeError(`unsupported type "${s}" to create tensor from MLTensor`);this.mlTensorData=e.mlTensor,this.downloader=e.download,this.disposer=e.dispose;break}default:throw new Error(`Tensor constructor: unsupported location '${this.dataLocation}'`)}else{let a,l;if(typeof e=="string")if(s=e,l=n,e==="string"){if(!Array.isArray(r))throw new TypeError("A string tensor's data must be a string array.");a=r}else{const c=Uc.get(e);if(c===void 0)throw new TypeError(`Unsupported tensor type: ${e}.`);if(Array.isArray(r)){if(e==="float16"&&c===Uint16Array||e==="uint4"||e==="int4")throw new TypeError(`Creating a ${e} tensor from number array is not supported. Please use ${c.name} as data.`);e==="uint64"||e==="int64"?a=c.from(r,BigInt):a=c.from(r)}else if(r instanceof c)a=r;else if(r instanceof Uint8ClampedArray)if(e==="uint8")a=Uint8Array.from(r);else throw new TypeError("A Uint8ClampedArray tensor's data must be type of uint8");else if(e==="float16"&&r instanceof Uint16Array&&c!==Uint16Array)a=new globalThis.Float16Array(r.buffer,r.byteOffset,r.length);else throw new TypeError(`A ${s} tensor's data must be type of ${c}`)}else if(l=r,Array.isArray(e)){if(e.length===0)throw new TypeError("Tensor type cannot be inferred from an empty array.");const c=typeof e[0];if(c==="string")s="string",a=e;else if(c==="boolean")s="bool",a=Uint8Array.from(e);else throw new TypeError(`Invalid element type of data array: ${c}.`)}else if(e instanceof Uint8ClampedArray)s="uint8",a=Uint8Array.from(e);else{const c=Dm.get(e.constructor);if(c===void 0)throw new TypeError(`Unsupported type for tensor data: ${e.constructor}.`);s=c,a=e}if(l===void 0)l=[a.length];else if(!Array.isArray(l))throw new TypeError("A tensor's dims must be a number array");i=l,this.cpuData=a,this.dataLocation="cpu"}const o=UK(i);if(this.cpuData&&o!==this.cpuData.length&&!((s==="uint4"||s==="int4")&&Math.ceil(o/2)===this.cpuData.length))throw new Error(`Tensor's size(${o}) does not match data length(${this.cpuData.length}).`);this.type=s,this.dims=i,this.size=o}static async fromImage(e,r){return jK(e,r)}static fromTexture(e,r){return NK(e,r)}static fromGpuBuffer(e,r){return zK(e,r)}static fromMLTensor(e,r){return BK(e,r)}static fromPinnedBuffer(e,r,n){return VK(e,r,n)}toDataURL(e){return LK(this,e)}toImageData(e){return RK(this,e)}get data(){if(this.ensureValid(),!this.cpuData)throw new Error("The data is not on CPU. Use `getData()` to download GPU data to CPU, or use `texture` or `gpuBuffer` property to access the GPU data directly.");return this.cpuData}get location(){return this.dataLocation}get texture(){if(this.ensureValid(),!this.gpuTextureData)throw new Error("The data is not stored as a WebGL texture.");return this.gpuTextureData}get gpuBuffer(){if(this.ensureValid(),!this.gpuBufferData)throw new Error("The data is not stored as a WebGPU buffer.");return this.gpuBufferData}get mlTensor(){if(this.ensureValid(),!this.mlTensorData)throw new Error("The data is not stored as a WebNN MLTensor.");return this.mlTensorData}async getData(e){switch(this.ensureValid(),this.dataLocation){case"cpu":case"cpu-pinned":return this.data;case"texture":case"gpu-buffer":case"ml-tensor":{if(!this.downloader)throw new Error("The current tensor is not created with a specified data downloader.");if(this.isDownloading)throw new Error("The current tensor is being downloaded.");try{this.isDownloading=!0;const r=await this.downloader();return this.downloader=void 0,this.dataLocation="cpu",this.cpuData=r,e&&this.disposer&&(this.disposer(),this.disposer=void 0),r}finally{this.isDownloading=!1}}default:throw new Error(`cannot get data from location: ${this.dataLocation}`)}}dispose(){if(this.isDownloading)throw new Error("The current tensor is being downloaded.");this.disposer&&(this.disposer(),this.disposer=void 0),this.cpuData=void 0,this.gpuTextureData=void 0,this.gpuBufferData=void 0,this.mlTensorData=void 0,this.downloader=void 0,this.isDownloading=void 0,this.dataLocation="none"}ensureValid(){if(this.dataLocation==="none")throw new Error("The tensor is disposed.")}reshape(e){if(this.ensureValid(),this.downloader||this.disposer)throw new Error("Cannot reshape a tensor that owns GPU resource.");return GK(this,e)}};const kc=Zs,UR=(t,e)=>{(typeof Li.trace>"u"?!Li.wasm.trace:!Li.trace)||console.timeStamp(`${t}::ORT::${e}`)},GR=(t,e)=>{var s;const r=((s=new Error().stack)==null?void 0:s.split(/\r\n|\r|\n/g))||[];let n=!1;for(let i=0;i<r.length;i++){if(n&&!r[i].includes("TRACE_FUNC")){let o=`FUNC_${t}::${r[i].trim().split(" ")[1]}`;e&&(o+=`::${e}`),UR("CPU",o);return}r[i].includes("TRACE_FUNC")&&(n=!0)}},sx=t=>{(typeof Li.trace>"u"?!Li.wasm.trace:!Li.trace)||GR("BEGIN",t)},ix=t=>{(typeof Li.trace>"u"?!Li.wasm.trace:!Li.trace)||GR("END",t)};let HK=class HR{constructor(e){this.handler=e}async run(e,r,n){sx();const s={};let i={};if(typeof e!="object"||e===null||e instanceof kc||Array.isArray(e))throw new TypeError("'feeds' must be an object that use input names as keys and OnnxValue as corresponding values.");let o=!0;if(typeof r=="object"){if(r===null)throw new TypeError("Unexpected argument[1]: cannot be null.");if(r instanceof kc)throw new TypeError("'fetches' cannot be a Tensor");if(Array.isArray(r)){if(r.length===0)throw new TypeError("'fetches' cannot be an empty array.");o=!1;for(const c of r){if(typeof c!="string")throw new TypeError("'fetches' must be a string array or an object.");if(this.outputNames.indexOf(c)===-1)throw new RangeError(`'fetches' contains invalid output name: ${c}.`);s[c]=null}if(typeof n=="object"&&n!==null)i=n;else if(typeof n<"u")throw new TypeError("'options' must be an object.")}else{let c=!1;const u=Object.getOwnPropertyNames(r);for(const d of this.outputNames)if(u.indexOf(d)!==-1){const h=r[d];(h===null||h instanceof kc)&&(c=!0,o=!1,s[d]=h)}if(c){if(typeof n=="object"&&n!==null)i=n;else if(typeof n<"u")throw new TypeError("'options' must be an object.")}else i=r}}else if(typeof r<"u")throw new TypeError("Unexpected argument[1]: must be 'fetches' or 'options'.");for(const c of this.inputNames)if(typeof e[c]>"u")throw new Error(`input '${c}' is missing in 'feeds'.`);if(o)for(const c of this.outputNames)s[c]=null;const a=await this.handler.run(e,s,i),l={};for(const c in a)if(Object.hasOwnProperty.call(a,c)){const u=a[c];u instanceof kc?l[c]=u:l[c]=new kc(u.type,u.data,u.dims)}return ix(),l}async release(){return this.handler.dispose()}static async create(e,r,n,s){sx();let i,o={};if(typeof e=="string"){if(i=e,typeof r=="object"&&r!==null)o=r;else if(typeof r<"u")throw new TypeError("'options' must be an object.")}else if(e instanceof Uint8Array){if(i=e,typeof r=="object"&&r!==null)o=r;else if(typeof r<"u")throw new TypeError("'options' must be an object.")}else if(e instanceof ArrayBuffer||typeof SharedArrayBuffer<"u"&&e instanceof SharedArrayBuffer){const u=e;let d=0,h=e.byteLength;if(typeof r=="object"&&r!==null)o=r;else if(typeof r=="number"){if(d=r,!Number.isSafeInteger(d))throw new RangeError("'byteOffset' must be an integer.");if(d<0||d>=u.byteLength)throw new RangeError(`'byteOffset' is out of range [0, ${u.byteLength}).`);if(h=e.byteLength-d,typeof n=="number"){if(h=n,!Number.isSafeInteger(h))throw new RangeError("'byteLength' must be an integer.");if(h<=0||d+h>u.byteLength)throw new RangeError(`'byteLength' is out of range (0, ${u.byteLength-d}].`);if(typeof s=="object"&&s!==null)o=s;else if(typeof s<"u")throw new TypeError("'options' must be an object.")}else if(typeof n<"u")throw new TypeError("'byteLength' must be a number.")}else if(typeof r<"u")throw new TypeError("'options' must be an object.");i=new Uint8Array(u,d,h)}else throw new TypeError("Unexpected argument[0]: must be 'path' or 'buffer'.");const[a,l]=await DK(o),c=await a.createInferenceSessionHandler(i,l);return ix(),new HR(c)}startProfiling(){this.handler.startProfiling()}endProfiling(){this.handler.endProfiling()}get inputNames(){return this.handler.inputNames}get outputNames(){return this.handler.outputNames}};const KK=HK,XK=Object.freeze(Object.defineProperty({__proto__:null,InferenceSession:KK,TRACE:UR,TRACE_FUNC_BEGIN:sx,TRACE_FUNC_END:ix,Tensor:kc,env:FK,registerBackend:$K},Symbol.toStringTag,{value:"Module"}));/*!
 * ONNX Runtime Web v1.22.0-dev.20250409-89f8206ba4
 * Copyright (c) Microsoft Corporation. All rights reserved.
 * Licensed under the MIT License.
 */var db=Object.defineProperty,qK=Object.getOwnPropertyDescriptor,YK=Object.getOwnPropertyNames,QK=Object.prototype.hasOwnProperty,JK=(t=>typeof require<"u"?require:typeof Proxy<"u"?new Proxy(t,{get:(e,r)=>(typeof require<"u"?require:e)[r]}):t)(function(t){if(typeof require<"u")return require.apply(this,arguments);throw Error('Dynamic require of "'+t+'" is not supported')}),Ke=(t,e)=>()=>(t&&(e=t(t=0)),e),Nu=(t,e)=>{for(var r in e)db(t,r,{get:e[r],enumerable:!0})},ZK=(t,e,r,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let s of YK(e))!QK.call(t,s)&&s!==r&&db(t,s,{get:()=>e[s],enumerable:!(n=qK(e,s))||n.enumerable});return t},zh=t=>ZK(db({},"__esModule",{value:!0}),t),Fd,la,Dl,lk,KR,XR=Ke(()=>{Fd=new Map,la=[],Dl=(t,e,r)=>{if(e&&typeof e.init=="function"&&typeof e.createInferenceSessionHandler=="function"){let n=Fd.get(t);if(n===void 0)Fd.set(t,{backend:e,priority:r});else{if(n.priority>r)return;if(n.priority===r&&n.backend!==e)throw new Error(`cannot register backend "${t}" using priority ${r}`)}if(r>=0){let s=la.indexOf(t);s!==-1&&la.splice(s,1);for(let i=0;i<la.length;i++)if(Fd.get(la[i]).priority<=r){la.splice(i,0,t);return}la.push(t)}return}throw new TypeError("not a valid backend")},lk=async t=>{let e=Fd.get(t);if(!e)return"backend not found.";if(e.initialized)return e.backend;if(e.aborted)return e.error;{let r=!!e.initPromise;try{return r||(e.initPromise=e.backend.init(t)),await e.initPromise,e.initialized=!0,e.backend}catch(n){return r||(e.error=`${n}`,e.aborted=!0),e.error}finally{delete e.initPromise}}},KR=async t=>{let e=t.executionProviders||[],r=e.map(l=>typeof l=="string"?l:l.name),n=r.length===0?la:r,s,i=[],o=new Set;for(let l of n){let c=await lk(l);typeof c=="string"?i.push({name:l,err:c}):(s||(s=c),s===c&&o.add(l))}if(!s)throw new Error(`no available backend found. ERR: ${i.map(l=>`[${l.name}] ${l.err}`).join(", ")}`);for(let{name:l,err:c}of i)r.includes(l)&&console.warn(`removing requested execution provider "${l}" from session options because it is not available: ${c}`);let a=e.filter(l=>o.has(typeof l=="string"?l:l.name));return[s,new Proxy(t,{get:(l,c)=>c==="executionProviders"?a:Reflect.get(l,c)})]}}),e9=Ke(()=>{XR()}),qR,t9=Ke(()=>{qR="1.22.0-dev.20250409-89f8206ba4"}),ky,qs,YR=Ke(()=>{t9(),ky="warning",qs={wasm:{},webgl:{},webgpu:{},versions:{common:qR},set logLevel(t){if(t!==void 0){if(typeof t!="string"||["verbose","info","warning","error","fatal"].indexOf(t)===-1)throw new Error(`Unsupported logging level: ${t}`);ky=t}},get logLevel(){return ky}},Object.defineProperty(qs,"logLevel",{enumerable:!0})}),Mr,r9=Ke(()=>{YR(),Mr=qs}),QR,JR,n9=Ke(()=>{QR=(t,e)=>{let r=typeof document<"u"?document.createElement("canvas"):new OffscreenCanvas(1,1);r.width=t.dims[3],r.height=t.dims[2];let n=r.getContext("2d");if(n!=null){let s,i;(e==null?void 0:e.tensorLayout)!==void 0&&e.tensorLayout==="NHWC"?(s=t.dims[2],i=t.dims[3]):(s=t.dims[3],i=t.dims[2]);let o=(e==null?void 0:e.format)!==void 0?e.format:"RGB",a=e==null?void 0:e.norm,l,c;a===void 0||a.mean===void 0?l=[255,255,255,255]:typeof a.mean=="number"?l=[a.mean,a.mean,a.mean,a.mean]:(l=[a.mean[0],a.mean[1],a.mean[2],0],a.mean[3]!==void 0&&(l[3]=a.mean[3])),a===void 0||a.bias===void 0?c=[0,0,0,0]:typeof a.bias=="number"?c=[a.bias,a.bias,a.bias,a.bias]:(c=[a.bias[0],a.bias[1],a.bias[2],0],a.bias[3]!==void 0&&(c[3]=a.bias[3]));let u=i*s,d=0,h=u,f=u*2,p=-1;o==="RGBA"?(d=0,h=u,f=u*2,p=u*3):o==="RGB"?(d=0,h=u,f=u*2):o==="RBG"&&(d=0,f=u,h=u*2);for(let m=0;m<i;m++)for(let y=0;y<s;y++){let g=(t.data[d++]-c[0])*l[0],_=(t.data[h++]-c[1])*l[1],v=(t.data[f++]-c[2])*l[2],w=p===-1?255:(t.data[p++]-c[3])*l[3];n.fillStyle="rgba("+g+","+_+","+v+","+w+")",n.fillRect(y,m,1,1)}if("toDataURL"in r)return r.toDataURL();throw new Error("toDataURL is not supported")}else throw new Error("Can not access image data")},JR=(t,e)=>{let r=typeof document<"u"?document.createElement("canvas").getContext("2d"):new OffscreenCanvas(1,1).getContext("2d"),n;if(r!=null){let s,i,o;(e==null?void 0:e.tensorLayout)!==void 0&&e.tensorLayout==="NHWC"?(s=t.dims[2],i=t.dims[1],o=t.dims[3]):(s=t.dims[3],i=t.dims[2],o=t.dims[1]);let a=e!==void 0&&e.format!==void 0?e.format:"RGB",l=e==null?void 0:e.norm,c,u;l===void 0||l.mean===void 0?c=[255,255,255,255]:typeof l.mean=="number"?c=[l.mean,l.mean,l.mean,l.mean]:(c=[l.mean[0],l.mean[1],l.mean[2],255],l.mean[3]!==void 0&&(c[3]=l.mean[3])),l===void 0||l.bias===void 0?u=[0,0,0,0]:typeof l.bias=="number"?u=[l.bias,l.bias,l.bias,l.bias]:(u=[l.bias[0],l.bias[1],l.bias[2],0],l.bias[3]!==void 0&&(u[3]=l.bias[3]));let d=i*s;if(e!==void 0&&(e.format!==void 0&&o===4&&e.format!=="RGBA"||o===3&&e.format!=="RGB"&&e.format!=="BGR"))throw new Error("Tensor format doesn't match input tensor dims");let h=4,f=0,p=1,m=2,y=3,g=0,_=d,v=d*2,w=-1;a==="RGBA"?(g=0,_=d,v=d*2,w=d*3):a==="RGB"?(g=0,_=d,v=d*2):a==="RBG"&&(g=0,v=d,_=d*2),n=r.createImageData(s,i);for(let x=0;x<i*s;f+=h,p+=h,m+=h,y+=h,x++)n.data[f]=(t.data[g++]-u[0])*c[0],n.data[p]=(t.data[_++]-u[1])*c[1],n.data[m]=(t.data[v++]-u[2])*c[2],n.data[y]=w===-1?255:(t.data[w++]-u[3])*c[3]}else throw new Error("Can not access image data");return n}}),Sp,ZR,e3,t3,r3,n3,s9=Ke(()=>{hb(),Sp=(t,e)=>{if(t===void 0)throw new Error("Image buffer must be defined");if(e.height===void 0||e.width===void 0)throw new Error("Image height and width must be defined");if(e.tensorLayout==="NHWC")throw new Error("NHWC Tensor layout is not supported yet");let{height:r,width:n}=e,s=e.norm??{mean:255,bias:0},i,o;typeof s.mean=="number"?i=[s.mean,s.mean,s.mean,s.mean]:i=[s.mean[0],s.mean[1],s.mean[2],s.mean[3]??255],typeof s.bias=="number"?o=[s.bias,s.bias,s.bias,s.bias]:o=[s.bias[0],s.bias[1],s.bias[2],s.bias[3]??0];let a=e.format!==void 0?e.format:"RGBA",l=e.tensorFormat!==void 0&&e.tensorFormat!==void 0?e.tensorFormat:"RGB",c=r*n,u=l==="RGBA"?new Float32Array(c*4):new Float32Array(c*3),d=4,h=0,f=1,p=2,m=3,y=0,g=c,_=c*2,v=-1;a==="RGB"&&(d=3,h=0,f=1,p=2,m=-1),l==="RGBA"?v=c*3:l==="RBG"?(y=0,_=c,g=c*2):l==="BGR"&&(_=0,g=c,y=c*2);for(let w=0;w<c;w++,h+=d,p+=d,f+=d,m+=d)u[y++]=(t[h]+o[0])/i[0],u[g++]=(t[f]+o[1])/i[1],u[_++]=(t[p]+o[2])/i[2],v!==-1&&m!==-1&&(u[v++]=(t[m]+o[3])/i[3]);return l==="RGBA"?new $s("float32",u,[1,4,r,n]):new $s("float32",u,[1,3,r,n])},ZR=async(t,e)=>{let r=typeof HTMLImageElement<"u"&&t instanceof HTMLImageElement,n=typeof ImageData<"u"&&t instanceof ImageData,s=typeof ImageBitmap<"u"&&t instanceof ImageBitmap,i=typeof t=="string",o,a=e??{},l=()=>{if(typeof document<"u")return document.createElement("canvas");if(typeof OffscreenCanvas<"u")return new OffscreenCanvas(1,1);throw new Error("Canvas is not supported")},c=u=>typeof HTMLCanvasElement<"u"&&u instanceof HTMLCanvasElement||u instanceof OffscreenCanvas?u.getContext("2d"):null;if(r){let u=l();u.width=t.width,u.height=t.height;let d=c(u);if(d!=null){let h=t.height,f=t.width;if(e!==void 0&&e.resizedHeight!==void 0&&e.resizedWidth!==void 0&&(h=e.resizedHeight,f=e.resizedWidth),e!==void 0){if(a=e,e.tensorFormat!==void 0)throw new Error("Image input config format must be RGBA for HTMLImageElement");a.tensorFormat="RGBA",a.height=h,a.width=f}else a.tensorFormat="RGBA",a.height=h,a.width=f;d.drawImage(t,0,0),o=d.getImageData(0,0,f,h).data}else throw new Error("Can not access image data")}else if(n){let u,d;if(e!==void 0&&e.resizedWidth!==void 0&&e.resizedHeight!==void 0?(u=e.resizedHeight,d=e.resizedWidth):(u=t.height,d=t.width),e!==void 0&&(a=e),a.format="RGBA",a.height=u,a.width=d,e!==void 0){let h=l();h.width=d,h.height=u;let f=c(h);if(f!=null)f.putImageData(t,0,0),o=f.getImageData(0,0,d,u).data;else throw new Error("Can not access image data")}else o=t.data}else if(s){if(e===void 0)throw new Error("Please provide image config with format for Imagebitmap");let u=l();u.width=t.width,u.height=t.height;let d=c(u);if(d!=null){let h=t.height,f=t.width;return d.drawImage(t,0,0,f,h),o=d.getImageData(0,0,f,h).data,a.height=h,a.width=f,Sp(o,a)}else throw new Error("Can not access image data")}else{if(i)return new Promise((u,d)=>{let h=l(),f=c(h);if(!t||!f)return d();let p=new Image;p.crossOrigin="Anonymous",p.src=t,p.onload=()=>{h.width=p.width,h.height=p.height,f.drawImage(p,0,0,h.width,h.height);let m=f.getImageData(0,0,h.width,h.height);a.height=h.height,a.width=h.width,u(Sp(m.data,a))}});throw new Error("Input data provided is not supported - aborted tensor creation")}if(o!==void 0)return Sp(o,a);throw new Error("Input data provided is not supported - aborted tensor creation")},e3=(t,e)=>{let{width:r,height:n,download:s,dispose:i}=e,o=[1,n,r,4];return new $s({location:"texture",type:"float32",texture:t,dims:o,download:s,dispose:i})},t3=(t,e)=>{let{dataType:r,dims:n,download:s,dispose:i}=e;return new $s({location:"gpu-buffer",type:r??"float32",gpuBuffer:t,dims:n,download:s,dispose:i})},r3=(t,e)=>{let{dataType:r,dims:n,download:s,dispose:i}=e;return new $s({location:"ml-tensor",type:r??"float32",mlTensor:t,dims:n,download:s,dispose:i})},n3=(t,e,r)=>new $s({location:"cpu-pinned",type:t,data:e,dims:r??[e.length]})}),Cl,Qd,Ay,s3,i9=Ke(()=>{Cl=new Map([["float32",Float32Array],["uint8",Uint8Array],["int8",Int8Array],["uint16",Uint16Array],["int16",Int16Array],["int32",Int32Array],["bool",Uint8Array],["float64",Float64Array],["uint32",Uint32Array],["int4",Uint8Array],["uint4",Uint8Array]]),Qd=new Map([[Float32Array,"float32"],[Uint8Array,"uint8"],[Int8Array,"int8"],[Uint16Array,"uint16"],[Int16Array,"int16"],[Int32Array,"int32"],[Float64Array,"float64"],[Uint32Array,"uint32"]]),Ay=!1,s3=()=>{if(!Ay){Ay=!0;let t=typeof BigInt64Array<"u"&&BigInt64Array.from,e=typeof BigUint64Array<"u"&&BigUint64Array.from,r=globalThis.Float16Array,n=typeof r<"u"&&r.from;t&&(Cl.set("int64",BigInt64Array),Qd.set(BigInt64Array,"int64")),e&&(Cl.set("uint64",BigUint64Array),Qd.set(BigUint64Array,"uint64")),n?(Cl.set("float16",r),Qd.set(r,"float16")):Cl.set("float16",Uint16Array)}}}),i3,o3,o9=Ke(()=>{hb(),i3=t=>{let e=1;for(let r=0;r<t.length;r++){let n=t[r];if(typeof n!="number"||!Number.isSafeInteger(n))throw new TypeError(`dims[${r}] must be an integer, got: ${n}`);if(n<0)throw new RangeError(`dims[${r}] must be a non-negative integer, got: ${n}`);e*=n}return e},o3=(t,e)=>{switch(t.location){case"cpu":return new $s(t.type,t.data,e);case"cpu-pinned":return new $s({location:"cpu-pinned",data:t.data,type:t.type,dims:e});case"texture":return new $s({location:"texture",texture:t.texture,type:t.type,dims:e});case"gpu-buffer":return new $s({location:"gpu-buffer",gpuBuffer:t.gpuBuffer,type:t.type,dims:e});case"ml-tensor":return new $s({location:"ml-tensor",mlTensor:t.mlTensor,type:t.type,dims:e});default:throw new Error(`tensorReshape: tensor location ${t.location} is not supported`)}}}),$s,hb=Ke(()=>{n9(),s9(),i9(),o9(),$s=class{constructor(t,e,r){s3();let n,s;if(typeof t=="object"&&"location"in t)switch(this.dataLocation=t.location,n=t.type,s=t.dims,t.location){case"cpu-pinned":{let o=Cl.get(n);if(!o)throw new TypeError(`unsupported type "${n}" to create tensor from pinned buffer`);if(!(t.data instanceof o))throw new TypeError(`buffer should be of type ${o.name}`);this.cpuData=t.data;break}case"texture":{if(n!=="float32")throw new TypeError(`unsupported type "${n}" to create tensor from texture`);this.gpuTextureData=t.texture,this.downloader=t.download,this.disposer=t.dispose;break}case"gpu-buffer":{if(n!=="float32"&&n!=="float16"&&n!=="int32"&&n!=="int64"&&n!=="uint32"&&n!=="uint8"&&n!=="bool"&&n!=="uint4"&&n!=="int4")throw new TypeError(`unsupported type "${n}" to create tensor from gpu buffer`);this.gpuBufferData=t.gpuBuffer,this.downloader=t.download,this.disposer=t.dispose;break}case"ml-tensor":{if(n!=="float32"&&n!=="float16"&&n!=="int32"&&n!=="int64"&&n!=="uint32"&&n!=="uint64"&&n!=="int8"&&n!=="uint8"&&n!=="bool"&&n!=="uint4"&&n!=="int4")throw new TypeError(`unsupported type "${n}" to create tensor from MLTensor`);this.mlTensorData=t.mlTensor,this.downloader=t.download,this.disposer=t.dispose;break}default:throw new Error(`Tensor constructor: unsupported location '${this.dataLocation}'`)}else{let o,a;if(typeof t=="string")if(n=t,a=r,t==="string"){if(!Array.isArray(e))throw new TypeError("A string tensor's data must be a string array.");o=e}else{let l=Cl.get(t);if(l===void 0)throw new TypeError(`Unsupported tensor type: ${t}.`);if(Array.isArray(e)){if(t==="float16"&&l===Uint16Array||t==="uint4"||t==="int4")throw new TypeError(`Creating a ${t} tensor from number array is not supported. Please use ${l.name} as data.`);t==="uint64"||t==="int64"?o=l.from(e,BigInt):o=l.from(e)}else if(e instanceof l)o=e;else if(e instanceof Uint8ClampedArray)if(t==="uint8")o=Uint8Array.from(e);else throw new TypeError("A Uint8ClampedArray tensor's data must be type of uint8");else if(t==="float16"&&e instanceof Uint16Array&&l!==Uint16Array)o=new globalThis.Float16Array(e.buffer,e.byteOffset,e.length);else throw new TypeError(`A ${n} tensor's data must be type of ${l}`)}else if(a=e,Array.isArray(t)){if(t.length===0)throw new TypeError("Tensor type cannot be inferred from an empty array.");let l=typeof t[0];if(l==="string")n="string",o=t;else if(l==="boolean")n="bool",o=Uint8Array.from(t);else throw new TypeError(`Invalid element type of data array: ${l}.`)}else if(t instanceof Uint8ClampedArray)n="uint8",o=Uint8Array.from(t);else{let l=Qd.get(t.constructor);if(l===void 0)throw new TypeError(`Unsupported type for tensor data: ${t.constructor}.`);n=l,o=t}if(a===void 0)a=[o.length];else if(!Array.isArray(a))throw new TypeError("A tensor's dims must be a number array");s=a,this.cpuData=o,this.dataLocation="cpu"}let i=i3(s);if(this.cpuData&&i!==this.cpuData.length&&!((n==="uint4"||n==="int4")&&Math.ceil(i/2)===this.cpuData.length))throw new Error(`Tensor's size(${i}) does not match data length(${this.cpuData.length}).`);this.type=n,this.dims=s,this.size=i}static async fromImage(t,e){return ZR(t,e)}static fromTexture(t,e){return e3(t,e)}static fromGpuBuffer(t,e){return t3(t,e)}static fromMLTensor(t,e){return r3(t,e)}static fromPinnedBuffer(t,e,r){return n3(t,e,r)}toDataURL(t){return QR(this,t)}toImageData(t){return JR(this,t)}get data(){if(this.ensureValid(),!this.cpuData)throw new Error("The data is not on CPU. Use `getData()` to download GPU data to CPU, or use `texture` or `gpuBuffer` property to access the GPU data directly.");return this.cpuData}get location(){return this.dataLocation}get texture(){if(this.ensureValid(),!this.gpuTextureData)throw new Error("The data is not stored as a WebGL texture.");return this.gpuTextureData}get gpuBuffer(){if(this.ensureValid(),!this.gpuBufferData)throw new Error("The data is not stored as a WebGPU buffer.");return this.gpuBufferData}get mlTensor(){if(this.ensureValid(),!this.mlTensorData)throw new Error("The data is not stored as a WebNN MLTensor.");return this.mlTensorData}async getData(t){switch(this.ensureValid(),this.dataLocation){case"cpu":case"cpu-pinned":return this.data;case"texture":case"gpu-buffer":case"ml-tensor":{if(!this.downloader)throw new Error("The current tensor is not created with a specified data downloader.");if(this.isDownloading)throw new Error("The current tensor is being downloaded.");try{this.isDownloading=!0;let e=await this.downloader();return this.downloader=void 0,this.dataLocation="cpu",this.cpuData=e,t&&this.disposer&&(this.disposer(),this.disposer=void 0),e}finally{this.isDownloading=!1}}default:throw new Error(`cannot get data from location: ${this.dataLocation}`)}}dispose(){if(this.isDownloading)throw new Error("The current tensor is being downloaded.");this.disposer&&(this.disposer(),this.disposer=void 0),this.cpuData=void 0,this.gpuTextureData=void 0,this.gpuBufferData=void 0,this.mlTensorData=void 0,this.downloader=void 0,this.isDownloading=void 0,this.dataLocation="none"}ensureValid(){if(this.dataLocation==="none")throw new Error("The tensor is disposed.")}reshape(t){if(this.ensureValid(),this.downloader||this.disposer)throw new Error("Cannot reshape a tensor that owns GPU resource.");return o3(this,t)}}}),Ai,a3=Ke(()=>{hb(),Ai=$s}),Bh,$y,Bi,ni,l3=Ke(()=>{YR(),Bh=(t,e)=>{(typeof qs.trace>"u"?!qs.wasm.trace:!qs.trace)||console.timeStamp(`${t}::ORT::${e}`)},$y=(t,e)=>{var s;let r=((s=new Error().stack)==null?void 0:s.split(/\r\n|\r|\n/g))||[],n=!1;for(let i=0;i<r.length;i++){if(n&&!r[i].includes("TRACE_FUNC")){let o=`FUNC_${t}::${r[i].trim().split(" ")[1]}`;e&&(o+=`::${e}`),Bh("CPU",o);return}r[i].includes("TRACE_FUNC")&&(n=!0)}},Bi=t=>{(typeof qs.trace>"u"?!qs.wasm.trace:!qs.trace)||$y("BEGIN",t)},ni=t=>{(typeof qs.trace>"u"?!qs.wasm.trace:!qs.trace)||$y("END",t)}}),c3,a9=Ke(()=>{XR(),a3(),l3(),c3=class u3{constructor(e){this.handler=e}async run(e,r,n){Bi();let s={},i={};if(typeof e!="object"||e===null||e instanceof Ai||Array.isArray(e))throw new TypeError("'feeds' must be an object that use input names as keys and OnnxValue as corresponding values.");let o=!0;if(typeof r=="object"){if(r===null)throw new TypeError("Unexpected argument[1]: cannot be null.");if(r instanceof Ai)throw new TypeError("'fetches' cannot be a Tensor");if(Array.isArray(r)){if(r.length===0)throw new TypeError("'fetches' cannot be an empty array.");o=!1;for(let c of r){if(typeof c!="string")throw new TypeError("'fetches' must be a string array or an object.");if(this.outputNames.indexOf(c)===-1)throw new RangeError(`'fetches' contains invalid output name: ${c}.`);s[c]=null}if(typeof n=="object"&&n!==null)i=n;else if(typeof n<"u")throw new TypeError("'options' must be an object.")}else{let c=!1,u=Object.getOwnPropertyNames(r);for(let d of this.outputNames)if(u.indexOf(d)!==-1){let h=r[d];(h===null||h instanceof Ai)&&(c=!0,o=!1,s[d]=h)}if(c){if(typeof n=="object"&&n!==null)i=n;else if(typeof n<"u")throw new TypeError("'options' must be an object.")}else i=r}}else if(typeof r<"u")throw new TypeError("Unexpected argument[1]: must be 'fetches' or 'options'.");for(let c of this.inputNames)if(typeof e[c]>"u")throw new Error(`input '${c}' is missing in 'feeds'.`);if(o)for(let c of this.outputNames)s[c]=null;let a=await this.handler.run(e,s,i),l={};for(let c in a)if(Object.hasOwnProperty.call(a,c)){let u=a[c];u instanceof Ai?l[c]=u:l[c]=new Ai(u.type,u.data,u.dims)}return ni(),l}async release(){return this.handler.dispose()}static async create(e,r,n,s){Bi();let i,o={};if(typeof e=="string"){if(i=e,typeof r=="object"&&r!==null)o=r;else if(typeof r<"u")throw new TypeError("'options' must be an object.")}else if(e instanceof Uint8Array){if(i=e,typeof r=="object"&&r!==null)o=r;else if(typeof r<"u")throw new TypeError("'options' must be an object.")}else if(e instanceof ArrayBuffer||typeof SharedArrayBuffer<"u"&&e instanceof SharedArrayBuffer){let u=e,d=0,h=e.byteLength;if(typeof r=="object"&&r!==null)o=r;else if(typeof r=="number"){if(d=r,!Number.isSafeInteger(d))throw new RangeError("'byteOffset' must be an integer.");if(d<0||d>=u.byteLength)throw new RangeError(`'byteOffset' is out of range [0, ${u.byteLength}).`);if(h=e.byteLength-d,typeof n=="number"){if(h=n,!Number.isSafeInteger(h))throw new RangeError("'byteLength' must be an integer.");if(h<=0||d+h>u.byteLength)throw new RangeError(`'byteLength' is out of range (0, ${u.byteLength-d}].`);if(typeof s=="object"&&s!==null)o=s;else if(typeof s<"u")throw new TypeError("'options' must be an object.")}else if(typeof n<"u")throw new TypeError("'byteLength' must be a number.")}else if(typeof r<"u")throw new TypeError("'options' must be an object.");i=new Uint8Array(u,d,h)}else throw new TypeError("Unexpected argument[0]: must be 'path' or 'buffer'.");let[a,l]=await KR(o),c=await a.createInferenceSessionHandler(i,l);return ni(),new u3(c)}startProfiling(){this.handler.startProfiling()}endProfiling(){this.handler.endProfiling()}get inputNames(){return this.handler.inputNames}get outputNames(){return this.handler.outputNames}get inputMetadata(){return this.handler.inputMetadata}get outputMetadata(){return this.handler.outputMetadata}}}),fb,l9=Ke(()=>{a9(),fb=c3}),c9=Ke(()=>{}),u9=Ke(()=>{}),d9=Ke(()=>{}),h9=Ke(()=>{}),d3={};Nu(d3,{InferenceSession:()=>fb,TRACE:()=>Bh,TRACE_FUNC_BEGIN:()=>Bi,TRACE_FUNC_END:()=>ni,Tensor:()=>Ai,env:()=>Mr,registerBackend:()=>Dl});var Vi=Ke(()=>{e9(),r9(),l9(),a3(),c9(),u9(),l3(),d9(),h9()}),pb=Ke(()=>{}),h3={};Nu(h3,{default:()=>f3});var Oy,Dy,f3,f9=Ke(()=>{var t;yz(),ic(),mb(),Oy="ort-wasm-proxy-worker",Dy=((t=globalThis.self)==null?void 0:t.name)===Oy,Dy&&(self.onmessage=e=>{let{type:r,in:n}=e.data;try{switch(r){case"init-wasm":gb(n.wasm).then(()=>{Ib(n).then(()=>{postMessage({type:r})},s=>{postMessage({type:r,err:s})})},s=>{postMessage({type:r,err:s})});break;case"init-ep":{let{epName:s,env:i}=n;Fb(i,s).then(()=>{postMessage({type:r})},o=>{postMessage({type:r,err:o})});break}case"copy-from":{let{buffer:s}=n,i=Sg(s);postMessage({type:r,out:i});break}case"create":{let{model:s,options:i}=n;Lb(s,i).then(o=>{postMessage({type:r,out:o})},o=>{postMessage({type:r,err:o})});break}case"release":Rb(n),postMessage({type:r});break;case"run":{let{sessionId:s,inputIndices:i,inputs:o,outputIndices:a,options:l}=n;jb(s,i,o,a,new Array(a.length).fill(null),l).then(c=>{c.some(u=>u[3]!=="cpu")?postMessage({type:r,err:"Proxy does not support non-cpu tensor location."}):postMessage({type:r,out:c},zb([...o,...c]))},c=>{postMessage({type:r,err:c})});break}case"end-profiling":Nb(n),postMessage({type:r});break;default:}}catch(s){postMessage({type:r,err:s})}}),f3=Dy?null:e=>new Worker(e??Ss,{type:"module",name:Oy})}),p3={};Nu(p3,{default:()=>m3});var Iy,Fy,m3,ck,p9=Ke(()=>{var t,e;Fy=(Iy=import.meta.url,async function(r={}){var yc;var n,s,i=r,o=new Promise((b,P)=>{n=b,s=P}),a=typeof window=="object",l=typeof WorkerGlobalScope<"u",c=l&&((yc=self.name)==null?void 0:yc.startsWith("em-pthread"));i.mountExternalData=(b,P)=>{b.startsWith("./")&&(b=b.substring(2)),(i.Eb||(i.Eb=new Map)).set(b,P)},i.unmountExternalData=()=>{delete i.Eb};var u=globalThis.SharedArrayBuffer??new WebAssembly.Memory({initial:0,maximum:0,pc:!0}).buffer.constructor;let d=b=>async(...P)=>{var F;try{if(i.Fb)throw Error("Session already started");let U=i.Fb={dc:P[0],errors:[]},ee=await b(...P);if(i.Fb!==U)throw Error("Session mismatch");(F=i.Jb)==null||F.flush();let me=U.errors;if(0<me.length){let Oe=await Promise.all(me);if(Oe=Oe.filter(Ge=>Ge),0<Oe.length)throw Error(Oe.join(`
`))}return ee}finally{i.Fb=null}};i.jsepInit=(b,P)=>{if(b==="webgpu"){[i.Jb,i.Ub,i.Yb,i.Kb,i.Xb,i.jb,i.Zb,i.ac,i.Vb,i.Wb,i.$b]=P;let F=i.Jb;i.jsepRegisterBuffer=(U,ee,me,Oe)=>F.registerBuffer(U,ee,me,Oe),i.jsepGetBuffer=U=>F.getBuffer(U),i.jsepCreateDownloader=(U,ee,me)=>F.createDownloader(U,ee,me),i.jsepOnCreateSession=U=>{F.onCreateSession(U)},i.jsepOnReleaseSession=U=>{F.onReleaseSession(U)},i.jsepOnRunStart=U=>F.onRunStart(U),i.bc=(U,ee)=>{F.upload(U,ee)}}else if(b==="webnn"){let F=P[0];[i.nc,i.Nb,i.webnnEnsureTensor,i.Ob,i.webnnDownloadTensor]=P.slice(1),i.webnnReleaseTensorId=i.Nb,i.webnnUploadTensor=i.Ob,i.webnnOnRunStart=U=>F.onRunStart(U),i.webnnOnRunEnd=F.onRunEnd.bind(F),i.webnnRegisterMLContext=(U,ee)=>{F.registerMLContext(U,ee)},i.webnnOnReleaseSession=U=>{F.onReleaseSession(U)},i.webnnCreateMLTensorDownloader=(U,ee)=>F.createMLTensorDownloader(U,ee),i.webnnRegisterMLTensor=(U,ee,me,Oe)=>F.registerMLTensor(U,ee,me,Oe),i.webnnCreateMLContext=U=>F.createMLContext(U),i.webnnRegisterMLConstant=(U,ee,me,Oe,Ge,tt)=>F.registerMLConstant(U,ee,me,Oe,Ge,i.Eb,tt),i.webnnRegisterGraphInput=F.registerGraphInput.bind(F),i.webnnIsGraphInput=F.isGraphInput.bind(F),i.webnnCreateTemporaryTensor=F.createTemporaryTensor.bind(F),i.webnnIsInt64Supported=F.isInt64Supported.bind(F)}};let h=()=>{let b=(P,F,U)=>(...ee)=>{let me=Tr,Oe=F==null?void 0:F();ee=P(...ee);let Ge=F==null?void 0:F();return Oe!==Ge&&(P=Ge,U(Oe),F=U=null),Tr!=me?new Promise((tt,ut)=>{Ms={resolve:tt,reject:ut}}):ee};(()=>{for(let P of["_OrtAppendExecutionProvider","_OrtCreateSession","_OrtRun","_OrtRunWithBinding","_OrtBindInput"])i[P]=b(i[P],()=>i[P],F=>i[P]=F)})(),d!==void 0&&(i._OrtRun=d(i._OrtRun),i._OrtRunWithBinding=d(i._OrtRunWithBinding)),h=void 0};i.asyncInit=()=>{h==null||h()};var f,p,m=Object.assign({},i),y=(b,P)=>{throw P},g="";(a||l)&&(l?g=self.location.href:typeof document<"u"&&document.currentScript&&(g=document.currentScript.src),Iy&&(g=Iy),g=g.startsWith("blob:")?"":g.slice(0,g.replace(/[?#].*/,"").lastIndexOf("/")+1),l&&(p=b=>{var P=new XMLHttpRequest;return P.open("GET",b,!1),P.responseType="arraybuffer",P.send(null),new Uint8Array(P.response)}),f=async b=>{if(z(b))return new Promise((F,U)=>{var ee=new XMLHttpRequest;ee.open("GET",b,!0),ee.responseType="arraybuffer",ee.onload=()=>{ee.status==200||ee.status==0&&ee.response?F(ee.response):U(ee.status)},ee.onerror=U,ee.send(null)});var P=await fetch(b,{credentials:"same-origin"});if(P.ok)return P.arrayBuffer();throw Error(P.status+" : "+P.url)});var _=console.log.bind(console),v=console.error.bind(console),w=_,x=v;Object.assign(i,m),m=null;var M,T,S,k,$,j,V,L,X,K,Y,J,N,ne=i.wasmBinary,te=!1,z=b=>b.startsWith("file://");function O(){return M.buffer!=k.buffer&&se(),k}function H(){return M.buffer!=k.buffer&&se(),$}function re(){return M.buffer!=k.buffer&&se(),j}function _e(){return M.buffer!=k.buffer&&se(),V}function oe(){return M.buffer!=k.buffer&&se(),L}function pe(){return M.buffer!=k.buffer&&se(),X}function $e(){return M.buffer!=k.buffer&&se(),K}function Ne(){return M.buffer!=k.buffer&&se(),N}if(c){let b=function(P){try{var F=P.data,U=F.Bb;if(U==="load"){let ee=[];self.onmessage=me=>ee.push(me),self.startWorker=()=>{postMessage({Bb:"loaded"});for(let me of ee)b(me);self.onmessage=b};for(let me of F.Rb)i[me]&&!i[me].proxy||(i[me]=(...Oe)=>{postMessage({Bb:"callHandler",Qb:me,args:Oe})},me=="print"&&(w=i[me]),me=="printErr"&&(x=i[me]));M=F.kc,se(),de(F.lc)}else if(U==="run"){W(F.Ab),fc(F.Ab,0,0,1,0,0),is(),Ae(F.Ab),q||(pd(),q=!0);try{ae(F.fc,F.Hb)}catch(ee){if(ee!="unwind")throw ee}}else F.target!=="setimmediate"&&(U==="checkMailbox"?q&&He():U&&(x(`worker: received unknown command ${U}`),x(F)))}catch(ee){throw pc(),ee}};var de,q=!1;x=function(...P){P=P.join(" "),console.error(P)},self.alert=function(...P){postMessage({Bb:"alert",text:P.join(" "),ic:ll()})},self.onunhandledrejection=P=>{throw P.reason||P},self.onmessage=b}function se(){var b=M.buffer;i.HEAP8=k=new Int8Array(b),i.HEAP16=j=new Int16Array(b),i.HEAPU8=$=new Uint8Array(b),i.HEAPU16=V=new Uint16Array(b),i.HEAP32=L=new Int32Array(b),i.HEAPU32=X=new Uint32Array(b),i.HEAPF32=K=new Float32Array(b),i.HEAPF64=N=new Float64Array(b),i.HEAP64=Y=new BigInt64Array(b),i.HEAPU64=J=new BigUint64Array(b)}function Q(){c?startWorker(i):xt.Ca()}c||(M=new WebAssembly.Memory({initial:256,maximum:65536,shared:!0}),se());var Me,Te=0,ke=null;function Pe(){if(--Te==0&&ke){var b=ke;ke=null,b()}}function Fe(b){throw x(b="Aborted("+b+")"),te=!0,b=new WebAssembly.RuntimeError(b+". Build with -sASSERTIONS for more info."),s(b),b}function Le(){return{a:{L:et,Aa:Ze,b:ze,$:Ot,A:ft,pa:rr,X:xr,Z:kn,qa:zs,na:li,ga:Bs,ma:Ui,J:Xn,Y:Gi,V:xs,oa:ci,W:Hi,va:Xi,E:_t,Q:Vs,O:Qa,D:Za,u:el,r:tl,P:qi,z:Z,R:ie,ja:he,T:rt,aa:ot,M:Et,F:Jt,ia:Ae,sa:qt,t:Jr,Ba:on,w:an,o:Kr,l:Hs,c:Us,n:df,j:Qo,v:pf,p:mf,f:gf,s:_f,m:yf,e:Yu,k:vf,i:wf,g:Qu,d:xf,da:Ju,ea:Mf,fa:ed,ba:td,ca:ol,N:rd,xa:Cf,ua:Ef,h:nd,C:Pf,G:sd,ta:Sf,x:_o,ra:kf,U:I_,q:Tf,y:Af,K:F_,S:$f,za:Of,ya:Df,ka:ad,la:ld,_:Rt,B:dc,I:cd,ha:ud,H:hd,a:M,wa:je}}}var We={829644:(b,P,F,U,ee)=>{if(i===void 0||!i.Eb)return 1;if((b=vt(Number(b>>>0))).startsWith("./")&&(b=b.substring(2)),!(b=i.Eb.get(b)))return 2;if(P=Number(P>>>0),F=Number(F>>>0),U=Number(U>>>0),P+F>b.byteLength)return 3;try{let me=b.subarray(P,P+F);switch(ee){case 0:H().set(me,U>>>0);break;case 1:i.mc?i.mc(U,me):i.bc(U,me);break;default:return 4}return 0}catch{return 4}},830468:(b,P,F)=>{i.Ob(b,H().subarray(P>>>0,P+F>>>0))},830532:()=>i.nc(),830574:b=>{i.Nb(b)},830611:()=>{i.Vb()},830642:()=>{i.Wb()},830671:()=>{i.$b()},830696:b=>i.Ub(b),830729:b=>i.Yb(b),830761:(b,P,F)=>{i.Kb(Number(b),Number(P),Number(F),!0)},830824:(b,P,F)=>{i.Kb(Number(b),Number(P),Number(F))},830881:()=>typeof wasmOffsetConverter<"u",830938:b=>{i.jb("Abs",b,void 0)},830989:b=>{i.jb("Neg",b,void 0)},831040:b=>{i.jb("Floor",b,void 0)},831093:b=>{i.jb("Ceil",b,void 0)},831145:b=>{i.jb("Reciprocal",b,void 0)},831203:b=>{i.jb("Sqrt",b,void 0)},831255:b=>{i.jb("Exp",b,void 0)},831306:b=>{i.jb("Erf",b,void 0)},831357:b=>{i.jb("Sigmoid",b,void 0)},831412:(b,P,F)=>{i.jb("HardSigmoid",b,{alpha:P,beta:F})},831491:b=>{i.jb("Log",b,void 0)},831542:b=>{i.jb("Sin",b,void 0)},831593:b=>{i.jb("Cos",b,void 0)},831644:b=>{i.jb("Tan",b,void 0)},831695:b=>{i.jb("Asin",b,void 0)},831747:b=>{i.jb("Acos",b,void 0)},831799:b=>{i.jb("Atan",b,void 0)},831851:b=>{i.jb("Sinh",b,void 0)},831903:b=>{i.jb("Cosh",b,void 0)},831955:b=>{i.jb("Asinh",b,void 0)},832008:b=>{i.jb("Acosh",b,void 0)},832061:b=>{i.jb("Atanh",b,void 0)},832114:b=>{i.jb("Tanh",b,void 0)},832166:b=>{i.jb("Not",b,void 0)},832217:(b,P,F)=>{i.jb("Clip",b,{min:P,max:F})},832286:b=>{i.jb("Clip",b,void 0)},832338:(b,P)=>{i.jb("Elu",b,{alpha:P})},832396:b=>{i.jb("Gelu",b,void 0)},832448:b=>{i.jb("Relu",b,void 0)},832500:(b,P)=>{i.jb("LeakyRelu",b,{alpha:P})},832564:(b,P)=>{i.jb("ThresholdedRelu",b,{alpha:P})},832634:(b,P)=>{i.jb("Cast",b,{to:P})},832692:b=>{i.jb("Add",b,void 0)},832743:b=>{i.jb("Sub",b,void 0)},832794:b=>{i.jb("Mul",b,void 0)},832845:b=>{i.jb("Div",b,void 0)},832896:b=>{i.jb("Pow",b,void 0)},832947:b=>{i.jb("Equal",b,void 0)},833e3:b=>{i.jb("Greater",b,void 0)},833055:b=>{i.jb("GreaterOrEqual",b,void 0)},833117:b=>{i.jb("Less",b,void 0)},833169:b=>{i.jb("LessOrEqual",b,void 0)},833228:(b,P,F,U,ee)=>{i.jb("ReduceMean",b,{keepDims:!!P,noopWithEmptyAxes:!!F,axes:U?Array.from(oe().subarray(Number(U)>>>0,Number(ee)>>>0)):[]})},833403:(b,P,F,U,ee)=>{i.jb("ReduceMax",b,{keepDims:!!P,noopWithEmptyAxes:!!F,axes:U?Array.from(oe().subarray(Number(U)>>>0,Number(ee)>>>0)):[]})},833577:(b,P,F,U,ee)=>{i.jb("ReduceMin",b,{keepDims:!!P,noopWithEmptyAxes:!!F,axes:U?Array.from(oe().subarray(Number(U)>>>0,Number(ee)>>>0)):[]})},833751:(b,P,F,U,ee)=>{i.jb("ReduceProd",b,{keepDims:!!P,noopWithEmptyAxes:!!F,axes:U?Array.from(oe().subarray(Number(U)>>>0,Number(ee)>>>0)):[]})},833926:(b,P,F,U,ee)=>{i.jb("ReduceSum",b,{keepDims:!!P,noopWithEmptyAxes:!!F,axes:U?Array.from(oe().subarray(Number(U)>>>0,Number(ee)>>>0)):[]})},834100:(b,P,F,U,ee)=>{i.jb("ReduceL1",b,{keepDims:!!P,noopWithEmptyAxes:!!F,axes:U?Array.from(oe().subarray(Number(U)>>>0,Number(ee)>>>0)):[]})},834273:(b,P,F,U,ee)=>{i.jb("ReduceL2",b,{keepDims:!!P,noopWithEmptyAxes:!!F,axes:U?Array.from(oe().subarray(Number(U)>>>0,Number(ee)>>>0)):[]})},834446:(b,P,F,U,ee)=>{i.jb("ReduceLogSum",b,{keepDims:!!P,noopWithEmptyAxes:!!F,axes:U?Array.from(oe().subarray(Number(U)>>>0,Number(ee)>>>0)):[]})},834623:(b,P,F,U,ee)=>{i.jb("ReduceSumSquare",b,{keepDims:!!P,noopWithEmptyAxes:!!F,axes:U?Array.from(oe().subarray(Number(U)>>>0,Number(ee)>>>0)):[]})},834803:(b,P,F,U,ee)=>{i.jb("ReduceLogSumExp",b,{keepDims:!!P,noopWithEmptyAxes:!!F,axes:U?Array.from(oe().subarray(Number(U)>>>0,Number(ee)>>>0)):[]})},834983:b=>{i.jb("Where",b,void 0)},835036:(b,P,F)=>{i.jb("Transpose",b,{perm:P?Array.from(oe().subarray(Number(P)>>>0,Number(F)>>>0)):[]})},835160:(b,P,F,U)=>{i.jb("DepthToSpace",b,{blocksize:P,mode:vt(F),format:U?"NHWC":"NCHW"})},835293:(b,P,F,U)=>{i.jb("DepthToSpace",b,{blocksize:P,mode:vt(F),format:U?"NHWC":"NCHW"})},835426:(b,P,F,U,ee,me,Oe,Ge,tt,ut,At,Ut,lr,ln,Qi)=>{i.jb("ConvTranspose",b,{format:tt?"NHWC":"NCHW",autoPad:P,dilations:[F],group:U,kernelShape:[ee],pads:[me,Oe],strides:[Ge],wIsConst:()=>!!O()[ut>>>0],outputPadding:At?Array.from(oe().subarray(Number(At)>>>0,Number(Ut)>>>0)):[],outputShape:lr?Array.from(oe().subarray(Number(lr)>>>0,Number(ln)>>>0)):[],activation:vt(Qi)})},835859:(b,P,F,U,ee,me,Oe,Ge,tt,ut,At,Ut,lr,ln)=>{i.jb("ConvTranspose",b,{format:Ge?"NHWC":"NCHW",autoPad:P,dilations:Array.from(oe().subarray(Number(F)>>>0,2+(Number(F)>>>0)>>>0)),group:U,kernelShape:Array.from(oe().subarray(Number(ee)>>>0,2+(Number(ee)>>>0)>>>0)),pads:Array.from(oe().subarray(Number(me)>>>0,4+(Number(me)>>>0)>>>0)),strides:Array.from(oe().subarray(Number(Oe)>>>0,2+(Number(Oe)>>>0)>>>0)),wIsConst:()=>!!O()[tt>>>0],outputPadding:ut?Array.from(oe().subarray(Number(ut)>>>0,Number(At)>>>0)):[],outputShape:Ut?Array.from(oe().subarray(Number(Ut)>>>0,Number(lr)>>>0)):[],activation:vt(ln)})},836520:(b,P,F,U,ee,me,Oe,Ge,tt,ut,At,Ut,lr,ln,Qi)=>{i.jb("ConvTranspose",b,{format:tt?"NHWC":"NCHW",autoPad:P,dilations:[F],group:U,kernelShape:[ee],pads:[me,Oe],strides:[Ge],wIsConst:()=>!!O()[ut>>>0],outputPadding:At?Array.from(oe().subarray(Number(At)>>>0,Number(Ut)>>>0)):[],outputShape:lr?Array.from(oe().subarray(Number(lr)>>>0,Number(ln)>>>0)):[],activation:vt(Qi)})},836953:(b,P,F,U,ee,me,Oe,Ge,tt,ut,At,Ut,lr,ln)=>{i.jb("ConvTranspose",b,{format:Ge?"NHWC":"NCHW",autoPad:P,dilations:Array.from(oe().subarray(Number(F)>>>0,2+(Number(F)>>>0)>>>0)),group:U,kernelShape:Array.from(oe().subarray(Number(ee)>>>0,2+(Number(ee)>>>0)>>>0)),pads:Array.from(oe().subarray(Number(me)>>>0,4+(Number(me)>>>0)>>>0)),strides:Array.from(oe().subarray(Number(Oe)>>>0,2+(Number(Oe)>>>0)>>>0)),wIsConst:()=>!!O()[tt>>>0],outputPadding:ut?Array.from(oe().subarray(Number(ut)>>>0,Number(At)>>>0)):[],outputShape:Ut?Array.from(oe().subarray(Number(Ut)>>>0,Number(lr)>>>0)):[],activation:vt(ln)})},837614:(b,P)=>{i.jb("GlobalAveragePool",b,{format:P?"NHWC":"NCHW"})},837705:(b,P,F,U,ee,me,Oe,Ge,tt,ut,At,Ut,lr,ln)=>{i.jb("AveragePool",b,{format:ln?"NHWC":"NCHW",auto_pad:P,ceil_mode:F,count_include_pad:U,storage_order:ee,dilations:me?Array.from(oe().subarray(Number(me)>>>0,Number(Oe)>>>0)):[],kernel_shape:Ge?Array.from(oe().subarray(Number(Ge)>>>0,Number(tt)>>>0)):[],pads:ut?Array.from(oe().subarray(Number(ut)>>>0,Number(At)>>>0)):[],strides:Ut?Array.from(oe().subarray(Number(Ut)>>>0,Number(lr)>>>0)):[]})},838184:(b,P)=>{i.jb("GlobalAveragePool",b,{format:P?"NHWC":"NCHW"})},838275:(b,P,F,U,ee,me,Oe,Ge,tt,ut,At,Ut,lr,ln)=>{i.jb("AveragePool",b,{format:ln?"NHWC":"NCHW",auto_pad:P,ceil_mode:F,count_include_pad:U,storage_order:ee,dilations:me?Array.from(oe().subarray(Number(me)>>>0,Number(Oe)>>>0)):[],kernel_shape:Ge?Array.from(oe().subarray(Number(Ge)>>>0,Number(tt)>>>0)):[],pads:ut?Array.from(oe().subarray(Number(ut)>>>0,Number(At)>>>0)):[],strides:Ut?Array.from(oe().subarray(Number(Ut)>>>0,Number(lr)>>>0)):[]})},838754:(b,P)=>{i.jb("GlobalMaxPool",b,{format:P?"NHWC":"NCHW"})},838841:(b,P,F,U,ee,me,Oe,Ge,tt,ut,At,Ut,lr,ln)=>{i.jb("MaxPool",b,{format:ln?"NHWC":"NCHW",auto_pad:P,ceil_mode:F,count_include_pad:U,storage_order:ee,dilations:me?Array.from(oe().subarray(Number(me)>>>0,Number(Oe)>>>0)):[],kernel_shape:Ge?Array.from(oe().subarray(Number(Ge)>>>0,Number(tt)>>>0)):[],pads:ut?Array.from(oe().subarray(Number(ut)>>>0,Number(At)>>>0)):[],strides:Ut?Array.from(oe().subarray(Number(Ut)>>>0,Number(lr)>>>0)):[]})},839316:(b,P)=>{i.jb("GlobalMaxPool",b,{format:P?"NHWC":"NCHW"})},839403:(b,P,F,U,ee,me,Oe,Ge,tt,ut,At,Ut,lr,ln)=>{i.jb("MaxPool",b,{format:ln?"NHWC":"NCHW",auto_pad:P,ceil_mode:F,count_include_pad:U,storage_order:ee,dilations:me?Array.from(oe().subarray(Number(me)>>>0,Number(Oe)>>>0)):[],kernel_shape:Ge?Array.from(oe().subarray(Number(Ge)>>>0,Number(tt)>>>0)):[],pads:ut?Array.from(oe().subarray(Number(ut)>>>0,Number(At)>>>0)):[],strides:Ut?Array.from(oe().subarray(Number(Ut)>>>0,Number(lr)>>>0)):[]})},839878:(b,P,F,U,ee)=>{i.jb("Gemm",b,{alpha:P,beta:F,transA:U,transB:ee})},839982:b=>{i.jb("MatMul",b,void 0)},840036:(b,P,F,U)=>{i.jb("ArgMax",b,{keepDims:!!P,selectLastIndex:!!F,axis:U})},840144:(b,P,F,U)=>{i.jb("ArgMin",b,{keepDims:!!P,selectLastIndex:!!F,axis:U})},840252:(b,P)=>{i.jb("Softmax",b,{axis:P})},840315:(b,P)=>{i.jb("Concat",b,{axis:P})},840375:(b,P,F,U,ee)=>{i.jb("Split",b,{axis:P,numOutputs:F,splitSizes:U?Array.from(oe().subarray(Number(U)>>>0,Number(ee)>>>0)):[]})},840531:b=>{i.jb("Expand",b,void 0)},840585:(b,P)=>{i.jb("Gather",b,{axis:Number(P)})},840656:(b,P)=>{i.jb("GatherElements",b,{axis:Number(P)})},840735:(b,P)=>{i.jb("GatherND",b,{batch_dims:Number(P)})},840814:(b,P,F,U,ee,me,Oe,Ge,tt,ut,At)=>{i.jb("Resize",b,{antialias:P,axes:F?Array.from(oe().subarray(Number(F)>>>0,Number(U)>>>0)):[],coordinateTransformMode:vt(ee),cubicCoeffA:me,excludeOutside:Oe,extrapolationValue:Ge,keepAspectRatioPolicy:vt(tt),mode:vt(ut),nearestMode:vt(At)})},841176:(b,P,F,U,ee,me,Oe)=>{i.jb("Slice",b,{starts:P?Array.from(oe().subarray(Number(P)>>>0,Number(F)>>>0)):[],ends:U?Array.from(oe().subarray(Number(U)>>>0,Number(ee)>>>0)):[],axes:me?Array.from(oe().subarray(Number(me)>>>0,Number(Oe)>>>0)):[]})},841440:b=>{i.jb("Tile",b,void 0)},841492:(b,P,F)=>{i.jb("InstanceNormalization",b,{epsilon:P,format:F?"NHWC":"NCHW"})},841606:(b,P,F)=>{i.jb("InstanceNormalization",b,{epsilon:P,format:F?"NHWC":"NCHW"})},841720:b=>{i.jb("Range",b,void 0)},841773:(b,P)=>{i.jb("Einsum",b,{equation:vt(P)})},841854:(b,P,F,U,ee)=>{i.jb("Pad",b,{mode:P,value:F,pads:U?Array.from(oe().subarray(Number(U)>>>0,Number(ee)>>>0)):[]})},841997:(b,P,F,U,ee,me)=>{i.jb("BatchNormalization",b,{epsilon:P,momentum:F,spatial:!!ee,trainingMode:!!U,format:me?"NHWC":"NCHW"})},842166:(b,P,F,U,ee,me)=>{i.jb("BatchNormalization",b,{epsilon:P,momentum:F,spatial:!!ee,trainingMode:!!U,format:me?"NHWC":"NCHW"})},842335:(b,P,F)=>{i.jb("CumSum",b,{exclusive:Number(P),reverse:Number(F)})},842432:(b,P,F)=>{i.jb("DequantizeLinear",b,{axis:P,blockSize:F})},842522:(b,P,F,U,ee)=>{i.jb("GridSample",b,{align_corners:P,mode:vt(F),padding_mode:vt(U),format:ee?"NHWC":"NCHW"})},842692:(b,P,F,U,ee)=>{i.jb("GridSample",b,{align_corners:P,mode:vt(F),padding_mode:vt(U),format:ee?"NHWC":"NCHW"})},842862:(b,P)=>{i.jb("ScatterND",b,{reduction:vt(P)})},842947:(b,P,F,U,ee,me,Oe,Ge,tt)=>{i.jb("Attention",b,{numHeads:P,isUnidirectional:F,maskFilterValue:U,scale:ee,doRotary:me,qkvHiddenSizes:Oe?Array.from(oe().subarray(Number(Ge)>>>0,Number(Ge)+Oe>>>0)):[],pastPresentShareBuffer:!!tt})},843219:b=>{i.jb("BiasAdd",b,void 0)},843274:b=>{i.jb("BiasSplitGelu",b,void 0)},843335:b=>{i.jb("FastGelu",b,void 0)},843391:(b,P,F,U,ee,me,Oe,Ge,tt,ut,At,Ut,lr,ln,Qi,Ff)=>{i.jb("Conv",b,{format:Ut?"NHWC":"NCHW",auto_pad:P,dilations:F?Array.from(oe().subarray(Number(F)>>>0,Number(U)>>>0)):[],group:ee,kernel_shape:me?Array.from(oe().subarray(Number(me)>>>0,Number(Oe)>>>0)):[],pads:Ge?Array.from(oe().subarray(Number(Ge)>>>0,Number(tt)>>>0)):[],strides:ut?Array.from(oe().subarray(Number(ut)>>>0,Number(At)>>>0)):[],w_is_const:()=>!!O()[Number(lr)>>>0],activation:vt(ln),activation_params:Qi?Array.from($e().subarray(Number(Qi)>>>0,Number(Ff)>>>0)):[]})},843975:b=>{i.jb("Gelu",b,void 0)},844027:(b,P,F,U,ee,me,Oe,Ge,tt)=>{i.jb("GroupQueryAttention",b,{numHeads:P,kvNumHeads:F,scale:U,softcap:ee,doRotary:me,rotaryInterleaved:Oe,smoothSoftmax:Ge,localWindowSize:tt})},844244:(b,P,F,U)=>{i.jb("LayerNormalization",b,{axis:P,epsilon:F,simplified:!!U})},844355:(b,P,F,U)=>{i.jb("LayerNormalization",b,{axis:P,epsilon:F,simplified:!!U})},844466:(b,P,F,U,ee,me)=>{i.jb("MatMulNBits",b,{k:P,n:F,accuracyLevel:U,bits:ee,blockSize:me})},844593:(b,P,F,U,ee,me)=>{i.jb("MultiHeadAttention",b,{numHeads:P,isUnidirectional:F,maskFilterValue:U,scale:ee,doRotary:me})},844752:(b,P)=>{i.jb("QuickGelu",b,{alpha:P})},844816:(b,P,F,U,ee)=>{i.jb("RotaryEmbedding",b,{interleaved:!!P,numHeads:F,rotaryEmbeddingDim:U,scale:ee})},844955:(b,P,F)=>{i.jb("SkipLayerNormalization",b,{epsilon:P,simplified:!!F})},845057:(b,P,F)=>{i.jb("SkipLayerNormalization",b,{epsilon:P,simplified:!!F})},845159:(b,P,F,U)=>{i.jb("GatherBlockQuantized",b,{gatherAxis:P,quantizeAxis:F,blockSize:U})},845280:b=>{i.Zb(b)},845314:(b,P)=>i.ac(Number(b),Number(P),i.Fb.dc,i.Fb.errors)};function Ze(b,P,F){return $n(async()=>{await i.Xb(Number(b),Number(P),Number(F))})}function et(){return typeof wasmOffsetConverter<"u"}class Re{constructor(P){ce(this,"name","ExitStatus");this.message=`Program terminated with exit(${P})`,this.status=P}}var qe=b=>{b.terminate(),b.onmessage=()=>{}},at=[],ct=b=>{Yt.length==0&&(le(),R(Yt[0]));var P=Yt.pop();if(!P)return 6;Xt.push(P),wr[b.Ab]=P,P.Ab=b.Ab;var F={Bb:"run",fc:b.ec,Hb:b.Hb,Ab:b.Ab};return P.postMessage(F,b.Mb),0},lt=0,Qe=(b,P,...F)=>{for(var U=2*F.length,ee=hl(),me=gc(8*U),Oe=me>>>3,Ge=0;Ge<F.length;Ge++){var tt=F[Ge];typeof tt=="bigint"?(Y[Oe+2*Ge]=1n,Y[Oe+2*Ge+1]=tt):(Y[Oe+2*Ge]=0n,Ne()[Oe+2*Ge+1>>>0]=tt)}return b=md(b,0,U,me,P),dl(ee),b};function je(b){if(c)return Qe(0,1,b);if(S=b,!(0<lt)){for(var P of Xt)qe(P);for(P of Yt)qe(P);Yt=[],Xt=[],wr={},te=!0}y(0,new Re(b))}function yt(b){if(c)return Qe(1,0,b);Rt(b)}var Rt=b=>{if(S=b,c)throw yt(b),"unwind";je(b)},Yt=[],Xt=[],Ur=[],wr={},Ct=b=>{var P=b.Ab;delete wr[P],Yt.push(b),Xt.splice(Xt.indexOf(b),1),b.Ab=0,gd(P)};function is(){Ur.forEach(b=>b())}var R=b=>new Promise(P=>{b.onmessage=ee=>{var me=(ee=ee.data).Bb;if(ee.Gb&&ee.Gb!=ll()){var Oe=wr[ee.Gb];Oe?Oe.postMessage(ee,ee.Mb):x(`Internal error! Worker sent a message "${me}" to target pthread ${ee.Gb}, but that thread no longer exists!`)}else me==="checkMailbox"?He():me==="spawnThread"?ct(ee):me==="cleanupThread"?Ct(wr[ee.hc]):me==="loaded"?(b.loaded=!0,P(b)):me==="alert"?alert(`Thread ${ee.ic}: ${ee.text}`):ee.target==="setimmediate"?b.postMessage(ee):me==="callHandler"?i[ee.Qb](...ee.args):me&&x(`worker sent an unknown command ${me}`)},b.onerror=ee=>{throw x(`worker sent an error! ${ee.filename}:${ee.lineno}: ${ee.message}`),ee};var F,U=[];for(F of[])i.propertyIsEnumerable(F)&&U.push(F);b.postMessage({Bb:"load",Rb:U,kc:M,lc:T})});function le(){var b=new Worker((()=>{let P=URL;return import.meta.url>"file:"&&import.meta.url<"file;"?new P("ort.bundle.min.mjs",import.meta.url):new URL(import.meta.url)})(),{type:"module",workerData:"em-pthread",name:"em-pthread"});Yt.push(b)}var W=b=>{se();var P=pe()[b+52>>>2>>>0];b=pe()[b+56>>>2>>>0],mc(P,P-b),dl(P)},ae=(b,P)=>{lt=0,b=vd(b,P),0<lt?S=b:ul(b)};class we{constructor(P){this.Ib=P-24}}function ze(b,P,F){var U=new we(b>>>=0);throw P>>>=0,F>>>=0,pe()[U.Ib+16>>>2>>>0]=0,pe()[U.Ib+4>>>2>>>0]=P,pe()[U.Ib+8>>>2>>>0]=F,b}function Ee(b,P,F,U){return c?Qe(2,1,b,P,F,U):Ot(b,P,F,U)}function Ot(b,P,F,U){if(b>>>=0,F>>>=0,U>>>=0,u===void 0)return 6;var ee=[];return c&&ee.length===0?Ee(b,P>>>=0,F,U):(b={ec:F,Ab:b,Hb:U,Mb:ee},c?(b.Bb="spawnThread",postMessage(b,ee),0):ct(b))}var Qt=typeof TextDecoder<"u"?new TextDecoder:void 0,Mt=(b,P=0,F=NaN)=>{var U=(P>>>=0)+F;for(F=P;b[F]&&!(F>=U);)++F;if(16<F-P&&b.buffer&&Qt)return Qt.decode(b.buffer instanceof ArrayBuffer?b.subarray(P,F):b.slice(P,F));for(U="";P<F;){var ee=b[P++];if(128&ee){var me=63&b[P++];if((224&ee)==192)U+=String.fromCharCode((31&ee)<<6|me);else{var Oe=63&b[P++];65536>(ee=(240&ee)==224?(15&ee)<<12|me<<6|Oe:(7&ee)<<18|me<<12|Oe<<6|63&b[P++])?U+=String.fromCharCode(ee):(ee-=65536,U+=String.fromCharCode(55296|ee>>10,56320|1023&ee))}}else U+=String.fromCharCode(ee)}return U},vt=(b,P)=>(b>>>=0)?Mt(H(),b,P):"";function ft(b,P,F){return c?Qe(3,1,b,P,F):0}function rr(b,P){if(c)return Qe(4,1,b,P)}var mr=b=>{for(var P=0,F=0;F<b.length;++F){var U=b.charCodeAt(F);127>=U?P++:2047>=U?P+=2:55296<=U&&57343>=U?(P+=4,++F):P+=3}return P},sn=(b,P,F)=>{var U=H();if(P>>>=0,0<F){var ee=P;F=P+F-1;for(var me=0;me<b.length;++me){var Oe=b.charCodeAt(me);if(55296<=Oe&&57343>=Oe&&(Oe=65536+((1023&Oe)<<10)|1023&b.charCodeAt(++me)),127>=Oe){if(P>=F)break;U[P++>>>0]=Oe}else{if(2047>=Oe){if(P+1>=F)break;U[P++>>>0]=192|Oe>>6}else{if(65535>=Oe){if(P+2>=F)break;U[P++>>>0]=224|Oe>>12}else{if(P+3>=F)break;U[P++>>>0]=240|Oe>>18,U[P++>>>0]=128|Oe>>12&63}U[P++>>>0]=128|Oe>>6&63}U[P++>>>0]=128|63&Oe}}U[P>>>0]=0,b=P-ee}else b=0;return b};function xr(b,P){if(c)return Qe(5,1,b,P)}function kn(b,P,F){if(c)return Qe(6,1,b,P,F)}function zs(b,P,F){return c?Qe(7,1,b,P,F):0}function li(b,P){if(c)return Qe(8,1,b,P)}function Bs(b,P,F){if(c)return Qe(9,1,b,P,F)}function Ui(b,P,F,U){if(c)return Qe(10,1,b,P,F,U)}function Xn(b,P,F,U){if(c)return Qe(11,1,b,P,F,U)}function Gi(b,P,F,U){if(c)return Qe(12,1,b,P,F,U)}function xs(b){if(c)return Qe(13,1,b)}function ci(b,P){if(c)return Qe(14,1,b,P)}function Hi(b,P,F){if(c)return Qe(15,1,b,P,F)}var Ki,Rr,Xi=()=>Fe(""),fn=b=>{for(var P="";H()[b>>>0];)P+=Ki[H()[b++>>>0]];return P},ui={},Rn={};function Be(b,P,F={}){return function(U,ee,me={}){var Oe=ee.name;if(!U)throw new Rr(`type "${Oe}" must have a positive integer typeid pointer`);if(Rn.hasOwnProperty(U)){if(me.Sb)return;throw new Rr(`Cannot register type '${Oe}' twice`)}Rn[U]=ee,ui.hasOwnProperty(U)&&(ee=ui[U],delete ui[U],ee.forEach(Ge=>Ge()))}(b,P,F)}var it=(b,P,F)=>{switch(P){case 1:return F?U=>O()[U>>>0]:U=>H()[U>>>0];case 2:return F?U=>re()[U>>>1>>>0]:U=>_e()[U>>>1>>>0];case 4:return F?U=>oe()[U>>>2>>>0]:U=>pe()[U>>>2>>>0];case 8:return F?U=>Y[U>>>3]:U=>J[U>>>3];default:throw new TypeError(`invalid integer width (${P}): ${b}`)}};function _t(b,P,F){F>>>=0,Be(b>>>=0,{name:P=fn(P>>>0),fromWireType:U=>U,toWireType:function(U,ee){if(typeof ee!="bigint"&&typeof ee!="number")throw ee=ee===null?"null":(U=typeof ee)=="object"||U==="array"||U==="function"?ee.toString():""+ee,new TypeError(`Cannot convert "${ee}" to ${this.name}`);return typeof ee=="number"&&(ee=BigInt(ee)),ee},Cb:nr,readValueFromPointer:it(P,F,P.indexOf("u")==-1),Db:null})}var nr=8;function Vs(b,P,F,U){Be(b>>>=0,{name:P=fn(P>>>0),fromWireType:function(ee){return!!ee},toWireType:function(ee,me){return me?F:U},Cb:nr,readValueFromPointer:function(ee){return this.fromWireType(H()[ee>>>0])},Db:null})}var Ws=[],Gr=[];function Us(b){9<(b>>>=0)&&--Gr[b+1]==0&&(Gr[b]=void 0,Ws.push(b))}var Hr=b=>{if(!b)throw new Rr("Cannot use deleted val. handle = "+b);return Gr[b]},Qr=b=>{switch(b){case void 0:return 2;case null:return 4;case!0:return 6;case!1:return 8;default:let P=Ws.pop()||Gr.length;return Gr[P]=b,Gr[P+1]=1,P}};function Gs(b){return this.fromWireType(pe()[b>>>2>>>0])}var di={name:"emscripten::val",fromWireType:b=>{var P=Hr(b);return Us(b),P},toWireType:(b,P)=>Qr(P),Cb:nr,readValueFromPointer:Gs,Db:null};function Qa(b){return Be(b>>>0,di)}var Ja=(b,P)=>{switch(P){case 4:return function(F){return this.fromWireType($e()[F>>>2>>>0])};case 8:return function(F){return this.fromWireType(Ne()[F>>>3>>>0])};default:throw new TypeError(`invalid float width (${P}): ${b}`)}};function Za(b,P,F){F>>>=0,Be(b>>>=0,{name:P=fn(P>>>0),fromWireType:U=>U,toWireType:(U,ee)=>ee,Cb:nr,readValueFromPointer:Ja(P,F),Db:null})}function el(b,P,F,U,ee){if(b>>>=0,F>>>=0,P=fn(P>>>0),ee===-1&&(ee=4294967295),ee=Ge=>Ge,U===0){var me=32-8*F;ee=Ge=>Ge<<me>>>me}var Oe=P.includes("unsigned")?function(Ge,tt){return tt>>>0}:function(Ge,tt){return tt};Be(b,{name:P,fromWireType:ee,toWireType:Oe,Cb:nr,readValueFromPointer:it(P,F,U!==0),Db:null})}function tl(b,P,F){function U(me){var Oe=pe()[me>>>2>>>0];return me=pe()[me+4>>>2>>>0],new ee(O().buffer,me,Oe)}var ee=[Int8Array,Uint8Array,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array,BigInt64Array,BigUint64Array][P];Be(b>>>=0,{name:F=fn(F>>>0),fromWireType:U,Cb:nr,readValueFromPointer:U},{Sb:!0})}function qi(b,P){Be(b>>>=0,{name:P=fn(P>>>0),fromWireType:function(F){for(var U,ee=pe()[F>>>2>>>0],me=F+4,Oe=me,Ge=0;Ge<=ee;++Ge){var tt=me+Ge;Ge!=ee&&H()[tt>>>0]!=0||(Oe=vt(Oe,tt-Oe),U===void 0?U=Oe:(U+="\0",U+=Oe),Oe=tt+1)}return os(F),U},toWireType:function(F,U){U instanceof ArrayBuffer&&(U=new Uint8Array(U));var ee=typeof U=="string";if(!(ee||U instanceof Uint8Array||U instanceof Uint8ClampedArray||U instanceof Int8Array))throw new Rr("Cannot pass non-string to std::string");var me=ee?mr(U):U.length,Oe=cl(4+me+1),Ge=Oe+4;if(pe()[Oe>>>2>>>0]=me,ee)sn(U,Ge,me+1);else if(ee)for(ee=0;ee<me;++ee){var tt=U.charCodeAt(ee);if(255<tt)throw os(Oe),new Rr("String has UTF-16 code units that do not fit in 8 bits");H()[Ge+ee>>>0]=tt}else for(ee=0;ee<me;++ee)H()[Ge+ee>>>0]=U[ee];return F!==null&&F.push(os,Oe),Oe},Cb:nr,readValueFromPointer:Gs,Db(F){os(F)}})}var Yo=typeof TextDecoder<"u"?new TextDecoder("utf-16le"):void 0,rl=(b,P)=>{for(var F=b>>1,U=F+P/2;!(F>=U)&&_e()[F>>>0];)++F;if(32<(F<<=1)-b&&Yo)return Yo.decode(H().slice(b,F));for(F="",U=0;!(U>=P/2);++U){var ee=re()[b+2*U>>>1>>>0];if(ee==0)break;F+=String.fromCharCode(ee)}return F},nl=(b,P,F)=>{if(F??(F=2147483647),2>F)return 0;var U=P;F=(F-=2)<2*b.length?F/2:b.length;for(var ee=0;ee<F;++ee){var me=b.charCodeAt(ee);re()[P>>>1>>>0]=me,P+=2}return re()[P>>>1>>>0]=0,P-U},sl=b=>2*b.length,Yi=(b,P)=>{for(var F=0,U="";!(F>=P/4);){var ee=oe()[b+4*F>>>2>>>0];if(ee==0)break;++F,65536<=ee?(ee-=65536,U+=String.fromCharCode(55296|ee>>10,56320|1023&ee)):U+=String.fromCharCode(ee)}return U},ve=(b,P,F)=>{if(P>>>=0,F??(F=2147483647),4>F)return 0;var U=P;F=U+F-4;for(var ee=0;ee<b.length;++ee){var me=b.charCodeAt(ee);if(55296<=me&&57343>=me&&(me=65536+((1023&me)<<10)|1023&b.charCodeAt(++ee)),oe()[P>>>2>>>0]=me,(P+=4)+4>F)break}return oe()[P>>>2>>>0]=0,P-U},I=b=>{for(var P=0,F=0;F<b.length;++F){var U=b.charCodeAt(F);55296<=U&&57343>=U&&++F,P+=4}return P};function Z(b,P,F){if(b>>>=0,P>>>=0,F=fn(F>>>=0),P===2)var U=rl,ee=nl,me=sl,Oe=Ge=>_e()[Ge>>>1>>>0];else P===4&&(U=Yi,ee=ve,me=I,Oe=Ge=>pe()[Ge>>>2>>>0]);Be(b,{name:F,fromWireType:Ge=>{for(var tt,ut=pe()[Ge>>>2>>>0],At=Ge+4,Ut=0;Ut<=ut;++Ut){var lr=Ge+4+Ut*P;Ut!=ut&&Oe(lr)!=0||(At=U(At,lr-At),tt===void 0?tt=At:(tt+="\0",tt+=At),At=lr+P)}return os(Ge),tt},toWireType:(Ge,tt)=>{if(typeof tt!="string")throw new Rr(`Cannot pass non-string to C++ string type ${F}`);var ut=me(tt),At=cl(4+ut+P);return pe()[At>>>2>>>0]=ut/P,ee(tt,At+4,ut+P),Ge!==null&&Ge.push(os,At),At},Cb:nr,readValueFromPointer:Gs,Db(Ge){os(Ge)}})}function ie(b,P){Be(b>>>=0,{Tb:!0,name:P=fn(P>>>0),Cb:0,fromWireType:()=>{},toWireType:()=>{}})}function he(b){fc(b>>>0,!l,1,!a,131072,!1),is()}var ye=b=>{if(!te)try{if(b(),!(0<lt))try{c?ul(S):Rt(S)}catch(P){P instanceof Re||P=="unwind"||y(0,P)}}catch(P){P instanceof Re||P=="unwind"||y(0,P)}};function Ae(b){b>>>=0,typeof Atomics.jc=="function"&&(Atomics.jc(oe(),b>>>2,b).value.then(He),b+=128,Atomics.store(oe(),b>>>2,1))}var He=()=>{var b=ll();b&&(Ae(b),ye(yd))};function rt(b,P){(b>>>=0)==P>>>0?setTimeout(He):c?postMessage({Gb:b,Bb:"checkMailbox"}):(b=wr[b])&&b.postMessage({Bb:"checkMailbox"})}var Je=[];function ot(b,P,F,U,ee){for(P>>>=0,U/=2,Je.length=U,F=ee>>>0>>>3,ee=0;ee<U;ee++)Je[ee]=Y[F+2*ee]?Y[F+2*ee+1]:Ne()[F+2*ee+1>>>0];return(P?We[P]:If[b])(...Je)}var Et=()=>{lt=0};function Jt(b){b>>>=0,c?postMessage({Bb:"cleanupThread",hc:b}):Ct(wr[b])}function qt(b){}var br=(b,P)=>{var F=Rn[b];if(F===void 0)throw b=hc(b),F=fn(b),os(b),new Rr(`${P} has unknown type ${F}`);return F},ar=(b,P,F)=>{var U=[];return b=b.toWireType(U,F),U.length&&(pe()[P>>>2>>>0]=Qr(U)),b};function Jr(b,P,F){return P>>>=0,F>>>=0,b=Hr(b>>>0),P=br(P,"emval::as"),ar(P,F,b)}function on(b,P){return P>>>=0,b=Hr(b>>>0),(P=br(P,"emval::as")).toWireType(null,b)}var pn=b=>{try{b()}catch(P){Fe(P)}},mn=0,Tr=null,hi=0,hr=[],Zr={},An={},bs=0,Ms=null,Mn=[];function $n(b){return function(P){if(!te){if(mn===0){var F=!1,U=!1;P((ee=0)=>{if(!te&&(hi=ee,F=!0,U)){mn=2,pn(()=>xd(Tr)),typeof MainLoop<"u"&&MainLoop.Pb&&MainLoop.resume(),ee=!1;try{var me=function(){var tt=oe()[Tr+8>>>2>>>0];return tt=xt[An[tt]],--lt,tt()}()}catch(tt){me=tt,ee=!0}var Oe=!1;if(!Tr){var Ge=Ms;Ge&&(Ms=null,(ee?Ge.reject:Ge.resolve)(me),Oe=!0)}if(ee&&!Oe)throw me}}),U=!0,F||(mn=1,Tr=function(){var ee=cl(65548),me=ee+12;pe()[ee>>>2>>>0]=me,pe()[ee+4>>>2>>>0]=me+65536,me=hr[0];var Oe=Zr[me];return Oe===void 0&&(Oe=bs++,Zr[me]=Oe,An[Oe]=me),me=Oe,oe()[ee+8>>>2>>>0]=me,ee}(),typeof MainLoop<"u"&&MainLoop.Pb&&MainLoop.pause(),pn(()=>wd(Tr)))}else mn===2?(mn=0,pn(bd),os(Tr),Tr=null,Mn.forEach(ye)):Fe(`invalid state: ${mn}`);return hi}}(P=>{b().then(P)})}function an(b){return b>>>=0,$n(async()=>{var P=await Hr(b);return Qr(P)})}var Cr=[];function Kr(b,P,F,U){return F>>>=0,U>>>=0,(b=Cr[b>>>0])(null,P=Hr(P>>>0),F,U)}var Xr={},Tn=b=>{var P=Xr[b];return P===void 0?fn(b):P};function Hs(b,P,F,U,ee){return F>>>=0,U>>>=0,ee>>>=0,(b=Cr[b>>>0])(P=Hr(P>>>0),P[F=Tn(F)],U,ee)}var il=()=>typeof globalThis=="object"?globalThis:Function("return this")();function df(b){return(b>>>=0)==0?Qr(il()):(b=Tn(b),Qr(il()[b]))}var hf=b=>{var P=Cr.length;return Cr.push(b),P},ff=(b,P)=>{for(var F=Array(b),U=0;U<b;++U)F[U]=br(pe()[P+4*U>>>2>>>0],"parameter "+U);return F},qu=(b,P)=>Object.defineProperty(P,"name",{value:b});function Qo(b,P,F){var U=(P=ff(b,P>>>0)).shift();b--;var ee=`return function (obj, func, destructorsRef, args) {
`,me=0,Oe=[];F===0&&Oe.push("obj");for(var Ge=["retType"],tt=[U],ut=0;ut<b;++ut)Oe.push("arg"+ut),Ge.push("argType"+ut),tt.push(P[ut]),ee+=`  var arg${ut} = argType${ut}.readValueFromPointer(args${me?"+"+me:""});
`,me+=P[ut].Cb;return ee+=`  var rv = ${F===1?"new func":"func.call"}(${Oe.join(", ")});
`,U.Tb||(Ge.push("emval_returnValue"),tt.push(ar),ee+=`  return emval_returnValue(retType, destructorsRef, rv);
`),Ge.push(ee+`};
`),b=function(At){var Ut=Function;if(!(Ut instanceof Function))throw new TypeError(`new_ called with constructor type ${typeof Ut} which is not a function`);var lr=qu(Ut.name||"unknownFunctionName",function(){});return lr.prototype=Ut.prototype,lr=new lr,(At=Ut.apply(lr,At))instanceof Object?At:lr}(Ge)(...tt),F=`methodCaller<(${P.map(At=>At.name).join(", ")}) => ${U.name}>`,hf(qu(F,b))}function pf(b){return b=Tn(b>>>0),Qr(i[b])}function mf(b,P){return P>>>=0,b=Hr(b>>>0),P=Hr(P),Qr(b[P])}function gf(b){9<(b>>>=0)&&(Gr[b+1]+=1)}function _f(){return Qr([])}function yf(b){b=Hr(b>>>0);for(var P=Array(b.length),F=0;F<b.length;F++)P[F]=b[F];return Qr(P)}function Yu(b){return Qr(Tn(b>>>0))}function vf(){return Qr({})}function wf(b){for(var P=Hr(b>>>=0);P.length;){var F=P.pop();P.pop()(F)}Us(b)}function Qu(b,P,F){P>>>=0,F>>>=0,b=Hr(b>>>0),P=Hr(P),F=Hr(F),b[P]=F}function xf(b,P){return P>>>=0,b=(b=br(b>>>0,"_emval_take_value")).readValueFromPointer(P),Qr(b)}function Ju(b,P){b=-9007199254740992>b||9007199254740992<b?NaN:Number(b),P>>>=0,b=new Date(1e3*b),oe()[P>>>2>>>0]=b.getUTCSeconds(),oe()[P+4>>>2>>>0]=b.getUTCMinutes(),oe()[P+8>>>2>>>0]=b.getUTCHours(),oe()[P+12>>>2>>>0]=b.getUTCDate(),oe()[P+16>>>2>>>0]=b.getUTCMonth(),oe()[P+20>>>2>>>0]=b.getUTCFullYear()-1900,oe()[P+24>>>2>>>0]=b.getUTCDay(),b=(b.getTime()-Date.UTC(b.getUTCFullYear(),0,1,0,0,0,0))/864e5|0,oe()[P+28>>>2>>>0]=b}var Zu=b=>b%4==0&&(b%100!=0||b%400==0),lc=[0,31,60,91,121,152,182,213,244,274,305,335],bf=[0,31,59,90,120,151,181,212,243,273,304,334];function Mf(b,P){b=-9007199254740992>b||9007199254740992<b?NaN:Number(b),P>>>=0,b=new Date(1e3*b),oe()[P>>>2>>>0]=b.getSeconds(),oe()[P+4>>>2>>>0]=b.getMinutes(),oe()[P+8>>>2>>>0]=b.getHours(),oe()[P+12>>>2>>>0]=b.getDate(),oe()[P+16>>>2>>>0]=b.getMonth(),oe()[P+20>>>2>>>0]=b.getFullYear()-1900,oe()[P+24>>>2>>>0]=b.getDay();var F=(Zu(b.getFullYear())?lc:bf)[b.getMonth()]+b.getDate()-1|0;oe()[P+28>>>2>>>0]=F,oe()[P+36>>>2>>>0]=-60*b.getTimezoneOffset(),F=new Date(b.getFullYear(),6,1).getTimezoneOffset();var U=new Date(b.getFullYear(),0,1).getTimezoneOffset();b=0|(F!=U&&b.getTimezoneOffset()==Math.min(U,F)),oe()[P+32>>>2>>>0]=b}function ed(b){b>>>=0;var P=new Date(oe()[b+20>>>2>>>0]+1900,oe()[b+16>>>2>>>0],oe()[b+12>>>2>>>0],oe()[b+8>>>2>>>0],oe()[b+4>>>2>>>0],oe()[b>>>2>>>0],0),F=oe()[b+32>>>2>>>0],U=P.getTimezoneOffset(),ee=new Date(P.getFullYear(),6,1).getTimezoneOffset(),me=new Date(P.getFullYear(),0,1).getTimezoneOffset(),Oe=Math.min(me,ee);return 0>F?oe()[b+32>>>2>>>0]=+(ee!=me&&Oe==U):0<F!=(Oe==U)&&(ee=Math.max(me,ee),P.setTime(P.getTime()+6e4*((0<F?Oe:ee)-U))),oe()[b+24>>>2>>>0]=P.getDay(),F=(Zu(P.getFullYear())?lc:bf)[P.getMonth()]+P.getDate()-1|0,oe()[b+28>>>2>>>0]=F,oe()[b>>>2>>>0]=P.getSeconds(),oe()[b+4>>>2>>>0]=P.getMinutes(),oe()[b+8>>>2>>>0]=P.getHours(),oe()[b+12>>>2>>>0]=P.getDate(),oe()[b+16>>>2>>>0]=P.getMonth(),oe()[b+20>>>2>>>0]=P.getYear(),b=P.getTime(),BigInt(isNaN(b)?-1:b/1e3)}function td(b,P,F,U,ee,me,Oe){return c?Qe(16,1,b,P,F,U,ee,me,Oe):-52}function ol(b,P,F,U,ee,me){if(c)return Qe(17,1,b,P,F,U,ee,me)}var Jo={},Tf=()=>performance.timeOrigin+performance.now();function rd(b,P){if(c)return Qe(18,1,b,P);if(Jo[b]&&(clearTimeout(Jo[b].id),delete Jo[b]),!P)return 0;var F=setTimeout(()=>{delete Jo[b],ye(()=>_d(b,performance.timeOrigin+performance.now()))},P);return Jo[b]={id:F,qc:P},0}function Cf(b,P,F,U){b>>>=0,P>>>=0,F>>>=0,U>>>=0;var ee=new Date().getFullYear(),me=new Date(ee,0,1).getTimezoneOffset();ee=new Date(ee,6,1).getTimezoneOffset();var Oe=Math.max(me,ee);pe()[b>>>2>>>0]=60*Oe,oe()[P>>>2>>>0]=+(me!=ee),b=(P=Ge=>{var tt=Math.abs(Ge);return`UTC${0<=Ge?"-":"+"}${String(Math.floor(tt/60)).padStart(2,"0")}${String(tt%60).padStart(2,"0")}`})(me),P=P(ee),ee<me?(sn(b,F,17),sn(P,U,17)):(sn(b,U,17),sn(P,F,17))}var Sf=()=>Date.now();function Ef(b,P,F){return 0<=b&&3>=b?(b===0?b=Date.now():b=performance.timeOrigin+performance.now(),Y[F>>>0>>>3]=BigInt(Math.round(1e6*b)),0):28}var cc=[],al=(b,P)=>{cc.length=0;for(var F;F=H()[b++>>>0];){var U=F!=105;P+=(U&=F!=112)&&P%8?4:0,cc.push(F==112?pe()[P>>>2>>>0]:F==106?Y[P>>>3]:F==105?oe()[P>>>2>>>0]:Ne()[P>>>3>>>0]),P+=U?8:4}return cc};function nd(b,P,F){return b>>>=0,P=al(P>>>0,F>>>0),We[b](...P)}function Pf(b,P,F){return b>>>=0,P=al(P>>>0,F>>>0),We[b](...P)}var sd=()=>{};function _o(b,P){return x(vt(b>>>0,P>>>0))}var kf=()=>{throw lt+=1,"unwind"};function I_(){return 4294901760}var Af=()=>navigator.hardwareConcurrency;function F_(){return Fe("Cannot use emscripten_pc_get_function without -sUSE_OFFSET_CONVERTER"),0}function $f(b){b>>>=0;var P=H().length;if(b<=P||4294901760<b)return!1;for(var F=1;4>=F;F*=2){var U=P*(1+.2/F);U=Math.min(U,b+100663296);e:{U=(Math.min(4294901760,65536*Math.ceil(Math.max(b,U)/65536))-M.buffer.byteLength+65535)/65536|0;try{M.grow(U),se();var ee=1;break e}catch{}ee=void 0}if(ee)return!0}return!1}var Zo=()=>(Fe("Cannot use convertFrameToPC (needed by __builtin_return_address) without -sUSE_OFFSET_CONVERTER"),0),ea={},id=b=>{b.forEach(P=>{Zo()})};function Of(){var b=Error().stack.toString().split(`
`);return b[0]=="Error"&&b.shift(),id(b),ea.Lb=Zo(),ea.cc=b,ea.Lb}function Df(b,P,F){if(b>>>=0,P>>>=0,ea.Lb==b)var U=ea.cc;else(U=Error().stack.toString().split(`
`))[0]=="Error"&&U.shift(),id(U);for(var ee=3;U[ee]&&Zo()!=b;)++ee;for(b=0;b<F&&U[b+ee];++b)oe()[P+4*b>>>2>>>0]=Zo();return b}var uc,ta={},od=()=>{if(!uc){var b,P={USER:"web_user",LOGNAME:"web_user",PATH:"/",PWD:"/",HOME:"/home/web_user",LANG:(typeof navigator=="object"&&navigator.languages&&navigator.languages[0]||"C").replace("-","_")+".UTF-8",_:"./this.program"};for(b in ta)ta[b]===void 0?delete P[b]:P[b]=ta[b];var F=[];for(b in P)F.push(`${b}=${P[b]}`);uc=F}return uc};function ad(b,P){if(c)return Qe(19,1,b,P);b>>>=0,P>>>=0;var F=0;return od().forEach((U,ee)=>{var me=P+F;for(ee=pe()[b+4*ee>>>2>>>0]=me,me=0;me<U.length;++me)O()[ee++>>>0]=U.charCodeAt(me);O()[ee>>>0]=0,F+=U.length+1}),0}function ld(b,P){if(c)return Qe(20,1,b,P);b>>>=0,P>>>=0;var F=od();pe()[b>>>2>>>0]=F.length;var U=0;return F.forEach(ee=>U+=ee.length+1),pe()[P>>>2>>>0]=U,0}function dc(b){return c?Qe(21,1,b):52}function cd(b,P,F,U){return c?Qe(22,1,b,P,F,U):52}function ud(b,P,F,U){return c?Qe(23,1,b,P,F,U):70}var dd=[null,[],[]];function hd(b,P,F,U){if(c)return Qe(24,1,b,P,F,U);P>>>=0,F>>>=0,U>>>=0;for(var ee=0,me=0;me<F;me++){var Oe=pe()[P>>>2>>>0],Ge=pe()[P+4>>>2>>>0];P+=8;for(var tt=0;tt<Ge;tt++){var ut=H()[Oe+tt>>>0],At=dd[b];ut===0||ut===10?((b===1?w:x)(Mt(At)),At.length=0):At.push(ut)}ee+=Ge}return pe()[U>>>2>>>0]=ee,0}c||function(){for(var b=i.numThreads-1;b--;)le();at.unshift(()=>{Te++,function(P){c?P():Promise.all(Yt.map(R)).then(P)}(()=>Pe())})}();for(var fd=Array(256),ra=0;256>ra;++ra)fd[ra]=String.fromCharCode(ra);Ki=fd,Rr=i.BindingError=class extends Error{constructor(b){super(b),this.name="BindingError"}},i.InternalError=class extends Error{constructor(b){super(b),this.name="InternalError"}},Gr.push(0,1,void 0,1,null,1,!0,1,!1,1),i.count_emval_handles=()=>Gr.length/2-5-Ws.length;var xt,If=[je,yt,Ee,ft,rr,xr,kn,zs,li,Bs,Ui,Xn,Gi,xs,ci,Hi,td,ol,rd,ad,ld,dc,cd,ud,hd];(async function(){function b(U,ee){return xt=U.exports,xt=function(){var me=xt,Oe={};for(let[Ge,tt]of Object.entries(me))Oe[Ge]=typeof tt=="function"?(...ut)=>{hr.push(Ge);try{return tt(...ut)}finally{te||(hr.pop(),Tr&&mn===1&&hr.length===0&&(mn=0,lt+=1,pn(_c),typeof Fibers<"u"&&Fibers.rc()))}}:tt;return Oe}(),xt=function(){var me=xt,Oe=tt=>ut=>tt(ut)>>>0,Ge=tt=>()=>tt()>>>0;return(me=Object.assign({},me)).Da=Oe(me.Da),me.fb=Ge(me.fb),me.hb=Oe(me.hb),me.tb=Oe(me.tb),me.ub=Ge(me.ub),me.__cxa_get_exception_ptr=Oe(me.__cxa_get_exception_ptr),me}(),Ur.push(xt.ib),T=ee,Pe(),xt}Te++;var P=Le();if(i.instantiateWasm)return new Promise(U=>{i.instantiateWasm(P,(ee,me)=>{b(ee,me),U(ee.exports)})});if(c)return new Promise(U=>{de=ee=>{var me=new WebAssembly.Instance(ee,Le());U(b(me,ee))}});Me??(Me=i.locateFile?i.locateFile?i.locateFile("ort-wasm-simd-threaded.jsep.wasm",g):g+"ort-wasm-simd-threaded.jsep.wasm":new URL("/caption-creator/assets/ort-wasm-simd-threaded.jsep-B0T3yYHD.wasm",import.meta.url).href);try{var F=await async function(U){var ee=Me;if(!ne&&typeof WebAssembly.instantiateStreaming=="function"&&!z(ee))try{var me=fetch(ee,{credentials:"same-origin"});return await WebAssembly.instantiateStreaming(me,U)}catch(Oe){x(`wasm streaming compile failed: ${Oe}`),x("falling back to ArrayBuffer instantiation")}return async function(Oe,Ge){try{var tt=await async function(ut){if(!ne)try{var At=await f(ut);return new Uint8Array(At)}catch{}if(ut==Me&&ne)ut=new Uint8Array(ne);else{if(!p)throw"both async and sync fetching of the wasm failed";ut=p(ut)}return ut}(Oe);return await WebAssembly.instantiate(tt,Ge)}catch(ut){x(`failed to asynchronously prepare wasm: ${ut}`),Fe(ut)}}(ee,U)}(P);return b(F.instance,F.module)}catch(U){return s(U),Promise.reject(U)}})();var hc=b=>(hc=xt.Da)(b),pd=()=>(pd=xt.Ea)();i._OrtInit=(b,P)=>(i._OrtInit=xt.Fa)(b,P),i._OrtGetLastError=(b,P)=>(i._OrtGetLastError=xt.Ga)(b,P),i._OrtCreateSessionOptions=(b,P,F,U,ee,me,Oe,Ge,tt,ut)=>(i._OrtCreateSessionOptions=xt.Ha)(b,P,F,U,ee,me,Oe,Ge,tt,ut),i._OrtAppendExecutionProvider=(b,P,F,U,ee)=>(i._OrtAppendExecutionProvider=xt.Ia)(b,P,F,U,ee),i._OrtAddFreeDimensionOverride=(b,P,F)=>(i._OrtAddFreeDimensionOverride=xt.Ja)(b,P,F),i._OrtAddSessionConfigEntry=(b,P,F)=>(i._OrtAddSessionConfigEntry=xt.Ka)(b,P,F),i._OrtReleaseSessionOptions=b=>(i._OrtReleaseSessionOptions=xt.La)(b),i._OrtCreateSession=(b,P,F)=>(i._OrtCreateSession=xt.Ma)(b,P,F),i._OrtReleaseSession=b=>(i._OrtReleaseSession=xt.Na)(b),i._OrtGetInputOutputCount=(b,P,F)=>(i._OrtGetInputOutputCount=xt.Oa)(b,P,F),i._OrtGetInputOutputMetadata=(b,P,F,U)=>(i._OrtGetInputOutputMetadata=xt.Pa)(b,P,F,U),i._OrtFree=b=>(i._OrtFree=xt.Qa)(b),i._OrtCreateTensor=(b,P,F,U,ee,me)=>(i._OrtCreateTensor=xt.Ra)(b,P,F,U,ee,me),i._OrtGetTensorData=(b,P,F,U,ee)=>(i._OrtGetTensorData=xt.Sa)(b,P,F,U,ee),i._OrtReleaseTensor=b=>(i._OrtReleaseTensor=xt.Ta)(b),i._OrtCreateRunOptions=(b,P,F,U)=>(i._OrtCreateRunOptions=xt.Ua)(b,P,F,U),i._OrtAddRunConfigEntry=(b,P,F)=>(i._OrtAddRunConfigEntry=xt.Va)(b,P,F),i._OrtReleaseRunOptions=b=>(i._OrtReleaseRunOptions=xt.Wa)(b),i._OrtCreateBinding=b=>(i._OrtCreateBinding=xt.Xa)(b),i._OrtBindInput=(b,P,F)=>(i._OrtBindInput=xt.Ya)(b,P,F),i._OrtBindOutput=(b,P,F,U)=>(i._OrtBindOutput=xt.Za)(b,P,F,U),i._OrtClearBoundOutputs=b=>(i._OrtClearBoundOutputs=xt._a)(b),i._OrtReleaseBinding=b=>(i._OrtReleaseBinding=xt.$a)(b),i._OrtRunWithBinding=(b,P,F,U,ee)=>(i._OrtRunWithBinding=xt.ab)(b,P,F,U,ee),i._OrtRun=(b,P,F,U,ee,me,Oe,Ge)=>(i._OrtRun=xt.bb)(b,P,F,U,ee,me,Oe,Ge),i._OrtEndProfiling=b=>(i._OrtEndProfiling=xt.cb)(b),i._JsepOutput=(b,P,F)=>(i._JsepOutput=xt.db)(b,P,F),i._JsepGetNodeName=b=>(i._JsepGetNodeName=xt.eb)(b);var ll=()=>(ll=xt.fb)(),os=i._free=b=>(os=i._free=xt.gb)(b),cl=i._malloc=b=>(cl=i._malloc=xt.hb)(b),fc=(b,P,F,U,ee,me)=>(fc=xt.kb)(b,P,F,U,ee,me),pc=()=>(pc=xt.lb)(),md=(b,P,F,U,ee)=>(md=xt.mb)(b,P,F,U,ee),gd=b=>(gd=xt.nb)(b),ul=b=>(ul=xt.ob)(b),_d=(b,P)=>(_d=xt.pb)(b,P),yd=()=>(yd=xt.qb)(),mc=(b,P)=>(mc=xt.rb)(b,P),dl=b=>(dl=xt.sb)(b),gc=b=>(gc=xt.tb)(b),hl=()=>(hl=xt.ub)(),vd=i.dynCall_ii=(b,P)=>(vd=i.dynCall_ii=xt.vb)(b,P),wd=b=>(wd=xt.wb)(b),_c=()=>(_c=xt.xb)(),xd=b=>(xd=xt.yb)(b),bd=()=>(bd=xt.zb)();return i.stackSave=()=>hl(),i.stackRestore=b=>dl(b),i.stackAlloc=b=>gc(b),i.setValue=function(b,P,F="i8"){switch(F.endsWith("*")&&(F="*"),F){case"i1":case"i8":O()[b>>>0]=P;break;case"i16":re()[b>>>1>>>0]=P;break;case"i32":oe()[b>>>2>>>0]=P;break;case"i64":Y[b>>>3]=BigInt(P);break;case"float":$e()[b>>>2>>>0]=P;break;case"double":Ne()[b>>>3>>>0]=P;break;case"*":pe()[b>>>2>>>0]=P;break;default:Fe(`invalid type for setValue: ${F}`)}},i.getValue=function(b,P="i8"){switch(P.endsWith("*")&&(P="*"),P){case"i1":case"i8":return O()[b>>>0];case"i16":return re()[b>>>1>>>0];case"i32":return oe()[b>>>2>>>0];case"i64":return Y[b>>>3];case"float":return $e()[b>>>2>>>0];case"double":return Ne()[b>>>3>>>0];case"*":return pe()[b>>>2>>>0];default:Fe(`invalid type for getValue: ${P}`)}},i.UTF8ToString=vt,i.stringToUTF8=sn,i.lengthBytesUTF8=mr,function b(){if(0<Te)ke=b;else if(c)n(i),Q();else{for(;0<at.length;)at.shift()(i);0<Te?ke=b:(i.calledRun=!0,te||(Q(),n(i)))}}(),i.PTR_SIZE=4,o}),m3=Fy,ck=(e=(t=globalThis.self)==null?void 0:t.name)==null?void 0:e.startsWith("em-pthread"),ck&&Fy()}),Ly,ox,uk,Ss,g3,Ep,dk,hk,Ry,fk,jy,_3,Ny,y3,mb=Ke(()=>{pb(),Ly=typeof location>"u"?void 0:location.origin,ox=import.meta.url>"file:"&&import.meta.url<"file;",uk=()=>{{if(ox){let t=URL;return new URL(new t("ort.bundle.min.mjs",import.meta.url).href,Ly).href}return import.meta.url}},Ss=uk(),g3=()=>{if(Ss&&!Ss.startsWith("blob:"))return Ss.substring(0,Ss.lastIndexOf("/")+1)},Ep=(t,e)=>{try{let r=e??Ss;return(r?new URL(t,r):new URL(t)).origin===Ly}catch{return!1}},dk=(t,e)=>{let r=e??Ss;try{return(r?new URL(t,r):new URL(t)).href}catch{return}},hk=(t,e)=>`${e??"./"}${t}`,Ry=async t=>{let e=await(await fetch(t,{credentials:"same-origin"})).blob();return URL.createObjectURL(e)},fk=async t=>(await import(t)).default,jy=(f9(),zh(h3)).default,_3=async()=>{if(!Ss)throw new Error("Failed to load proxy worker: cannot determine the script source URL.");if(Ep(Ss))return[void 0,jy()];let t=await Ry(Ss);return[t,jy(t)]},Ny=(p9(),zh(p3)).default,y3=async(t,e,r)=>{if(!t&&!e&&Ny&&Ss&&Ep(Ss))return[void 0,Ny];{let n="ort-wasm-simd-threaded.jsep.mjs",s=t??dk(n,e),i=r&&s&&!Ep(s,e),o=i?await Ry(s):s??hk(n,e);return[i?o:void 0,await fk(o)]}}}),zy,Pp,Ld,By,pk,mk,gk,gb,vr,ic=Ke(()=>{mb(),Pp=!1,Ld=!1,By=!1,pk=()=>{if(typeof SharedArrayBuffer>"u")return!1;try{return typeof MessageChannel<"u"&&new MessageChannel().port1.postMessage(new SharedArrayBuffer(1)),WebAssembly.validate(new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,2,1,0,5,4,1,3,1,1,10,11,1,9,0,65,0,254,16,2,0,26,11]))}catch{return!1}},mk=()=>{try{return WebAssembly.validate(new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,2,1,0,10,30,1,28,0,65,0,253,15,253,12,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,253,186,1,26,11]))}catch{return!1}},gk=()=>{try{return WebAssembly.validate(new Uint8Array([0,97,115,109,1,0,0,0,1,5,1,96,0,1,123,3,2,1,0,10,19,1,17,0,65,1,253,15,65,2,253,15,65,3,253,15,253,147,2,11]))}catch{return!1}},gb=async t=>{if(Pp)return Promise.resolve();if(Ld)throw new Error("multiple calls to 'initializeWebAssembly()' detected.");if(By)throw new Error("previous call to 'initializeWebAssembly()' failed.");Ld=!0;let e=t.initTimeout,r=t.numThreads;if(t.simd!==!1){if(t.simd==="relaxed"){if(!gk())throw new Error("Relaxed WebAssembly SIMD is not supported in the current environment.")}else if(!mk())throw new Error("WebAssembly SIMD is not supported in the current environment.")}let n=pk();r>1&&!n&&(typeof self<"u"&&!self.crossOriginIsolated&&console.warn("env.wasm.numThreads is set to "+r+", but this will not work unless you enable crossOriginIsolated mode. See https://web.dev/cross-origin-isolation-guide/ for more info."),console.warn("WebAssembly multi-threading is not supported in the current environment. Falling back to single-threading."),t.numThreads=r=1);let s=t.wasmPaths,i=typeof s=="string"?s:void 0,o=s==null?void 0:s.mjs,a=(o==null?void 0:o.href)??o,l=s==null?void 0:s.wasm,c=(l==null?void 0:l.href)??l,u=t.wasmBinary,[d,h]=await y3(a,i,r>1),f=!1,p=[];if(e>0&&p.push(new Promise(m=>{setTimeout(()=>{f=!0,m()},e)})),p.push(new Promise((m,y)=>{let g={numThreads:r};if(u)g.wasmBinary=u;else if(c||i)g.locateFile=_=>c??i+_;else if(a&&a.indexOf("blob:")!==0)g.locateFile=_=>new URL(_,a).href;else if(d){let _=g3();_&&(g.locateFile=v=>_+v)}h(g).then(_=>{Ld=!1,Pp=!0,zy=_,m(),d&&URL.revokeObjectURL(d)},_=>{Ld=!1,By=!0,y(_)})})),await Promise.race(p),f)throw new Error(`WebAssembly backend initializing failed due to timeout: ${e}ms`)},vr=()=>{if(Pp&&zy)return zy;throw new Error("WebAssembly is not initialized yet.")}}),ki,wg,ur,_b=Ke(()=>{ic(),ki=(t,e)=>{let r=vr(),n=r.lengthBytesUTF8(t)+1,s=r._malloc(n);return r.stringToUTF8(t,s,n),e.push(s),s},wg=(t,e,r,n)=>{if(typeof t=="object"&&t!==null){if(r.has(t))throw new Error("Circular reference in options");r.add(t)}Object.entries(t).forEach(([s,i])=>{let o=e?e+s:s;if(typeof i=="object")wg(i,o+".",r,n);else if(typeof i=="string"||typeof i=="number")n(o,i.toString());else if(typeof i=="boolean")n(o,i?"1":"0");else throw new Error(`Can't handle extra config type: ${typeof i}`)})},ur=t=>{let e=vr(),r=e.stackSave();try{let n=e.PTR_SIZE,s=e.stackAlloc(2*n);e._OrtGetLastError(s,s+n);let i=Number(e.getValue(s,n===4?"i32":"i64")),o=e.getValue(s+n,"*"),a=o?e.UTF8ToString(o):"";throw new Error(`${t} ERROR_CODE: ${i}, ERROR_MESSAGE: ${a}`)}finally{e.stackRestore(r)}}}),v3,m9=Ke(()=>{ic(),_b(),v3=t=>{let e=vr(),r=0,n=[],s=t||{};try{if((t==null?void 0:t.logSeverityLevel)===void 0)s.logSeverityLevel=2;else if(typeof t.logSeverityLevel!="number"||!Number.isInteger(t.logSeverityLevel)||t.logSeverityLevel<0||t.logSeverityLevel>4)throw new Error(`log serverity level is not valid: ${t.logSeverityLevel}`);if((t==null?void 0:t.logVerbosityLevel)===void 0)s.logVerbosityLevel=0;else if(typeof t.logVerbosityLevel!="number"||!Number.isInteger(t.logVerbosityLevel))throw new Error(`log verbosity level is not valid: ${t.logVerbosityLevel}`);(t==null?void 0:t.terminate)===void 0&&(s.terminate=!1);let i=0;return(t==null?void 0:t.tag)!==void 0&&(i=ki(t.tag,n)),r=e._OrtCreateRunOptions(s.logSeverityLevel,s.logVerbosityLevel,!!s.terminate,i),r===0&&ur("Can't create run options."),(t==null?void 0:t.extra)!==void 0&&wg(t.extra,"",new WeakSet,(o,a)=>{let l=ki(o,n),c=ki(a,n);e._OrtAddRunConfigEntry(r,l,c)!==0&&ur(`Can't set a run config entry: ${o} - ${a}.`)}),[r,n]}catch(i){throw r!==0&&e._OrtReleaseRunOptions(r),n.forEach(o=>e._free(o)),i}}}),_k,yk,vk,Rd,wk,w3,g9=Ke(()=>{ic(),_b(),_k=t=>{switch(t){case"disabled":return 0;case"basic":return 1;case"extended":return 2;case"all":return 99;default:throw new Error(`unsupported graph optimization level: ${t}`)}},yk=t=>{switch(t){case"sequential":return 0;case"parallel":return 1;default:throw new Error(`unsupported execution mode: ${t}`)}},vk=t=>{t.extra||(t.extra={}),t.extra.session||(t.extra.session={});let e=t.extra.session;e.use_ort_model_bytes_directly||(e.use_ort_model_bytes_directly="1"),t.executionProviders&&t.executionProviders.some(r=>(typeof r=="string"?r:r.name)==="webgpu")&&(t.enableMemPattern=!1)},Rd=(t,e,r,n)=>{let s=ki(e,n),i=ki(r,n);vr()._OrtAddSessionConfigEntry(t,s,i)!==0&&ur(`Can't set a session config entry: ${e} - ${r}.`)},wk=async(t,e,r)=>{for(let n of e){let s=typeof n=="string"?n:n.name,i=[];switch(s){case"webnn":if(s="WEBNN",typeof n!="string"){let u=n==null?void 0:n.deviceType;u&&Rd(t,"deviceType",u,r)}break;case"webgpu":if(s="JS",typeof n!="string"){let u=n;if(u!=null&&u.preferredLayout){if(u.preferredLayout!=="NCHW"&&u.preferredLayout!=="NHWC")throw new Error(`preferredLayout must be either 'NCHW' or 'NHWC': ${u.preferredLayout}`);Rd(t,"preferredLayout",u.preferredLayout,r)}}break;case"wasm":case"cpu":continue;default:throw new Error(`not supported execution provider: ${s}`)}let o=ki(s,r),a=i.length,l=0,c=0;if(a>0){l=vr()._malloc(a*vr().PTR_SIZE),r.push(l),c=vr()._malloc(a*vr().PTR_SIZE),r.push(c);for(let u=0;u<a;u++)vr().setValue(l+u*vr().PTR_SIZE,i[u][0],"*"),vr().setValue(c+u*vr().PTR_SIZE,i[u][1],"*")}await vr()._OrtAppendExecutionProvider(t,o,l,c,a)!==0&&ur(`Can't append execution provider: ${s}.`)}},w3=async t=>{let e=vr(),r=0,n=[],s=t||{};vk(s);try{let i=_k(s.graphOptimizationLevel??"all"),o=yk(s.executionMode??"sequential"),a=typeof s.logId=="string"?ki(s.logId,n):0,l=s.logSeverityLevel??2;if(!Number.isInteger(l)||l<0||l>4)throw new Error(`log serverity level is not valid: ${l}`);let c=s.logVerbosityLevel??0;if(!Number.isInteger(c)||c<0||c>4)throw new Error(`log verbosity level is not valid: ${c}`);let u=typeof s.optimizedModelFilePath=="string"?ki(s.optimizedModelFilePath,n):0;if(r=e._OrtCreateSessionOptions(i,!!s.enableCpuMemArena,!!s.enableMemPattern,o,!!s.enableProfiling,0,a,l,c,u),r===0&&ur("Can't create session options."),s.executionProviders&&await wk(r,s.executionProviders,n),s.enableGraphCapture!==void 0){if(typeof s.enableGraphCapture!="boolean")throw new Error(`enableGraphCapture must be a boolean value: ${s.enableGraphCapture}`);Rd(r,"enableGraphCapture",s.enableGraphCapture.toString(),n)}if(s.freeDimensionOverrides)for(let[d,h]of Object.entries(s.freeDimensionOverrides)){if(typeof d!="string")throw new Error(`free dimension override name must be a string: ${d}`);if(typeof h!="number"||!Number.isInteger(h)||h<0)throw new Error(`free dimension override value must be a non-negative integer: ${h}`);let f=ki(d,n);e._OrtAddFreeDimensionOverride(r,f,h)!==0&&ur(`Can't set a free dimension override: ${d} - ${h}.`)}return s.extra!==void 0&&wg(s.extra,"",new WeakSet,(d,h)=>{Rd(r,d,h,n)}),[r,n]}catch(i){throw r!==0&&e._OrtReleaseSessionOptions(r)!==0&&ur("Can't release session options."),n.forEach(o=>e._free(o)),i}}}),Ac,Eo,Sl,yb,xg,vb,wb,ax,St=Ke(()=>{Ac=t=>{switch(t){case"int8":return 3;case"uint8":return 2;case"bool":return 9;case"int16":return 5;case"uint16":return 4;case"int32":return 6;case"uint32":return 12;case"float16":return 10;case"float32":return 1;case"float64":return 11;case"string":return 8;case"int64":return 7;case"uint64":return 13;case"int4":return 22;case"uint4":return 21;default:throw new Error(`unsupported data type: ${t}`)}},Eo=t=>{switch(t){case 3:return"int8";case 2:return"uint8";case 9:return"bool";case 5:return"int16";case 4:return"uint16";case 6:return"int32";case 12:return"uint32";case 10:return"float16";case 1:return"float32";case 11:return"float64";case 8:return"string";case 7:return"int64";case 13:return"uint64";case 22:return"int4";case 21:return"uint4";default:throw new Error(`unsupported data type: ${t}`)}},Sl=(t,e)=>{let r=[-1,4,1,1,2,2,4,8,-1,1,2,8,4,8,-1,-1,-1,-1,-1,-1,-1,.5,.5][t],n=typeof e=="number"?e:e.reduce((s,i)=>s*i,1);return r>0?Math.ceil(n*r):void 0},yb=t=>{switch(t){case"float16":return typeof Float16Array<"u"&&Float16Array.from?Float16Array:Uint16Array;case"float32":return Float32Array;case"uint8":return Uint8Array;case"int8":return Int8Array;case"uint16":return Uint16Array;case"int16":return Int16Array;case"int32":return Int32Array;case"bool":return Uint8Array;case"float64":return Float64Array;case"uint32":return Uint32Array;case"int64":return BigInt64Array;case"uint64":return BigUint64Array;default:throw new Error(`unsupported type: ${t}`)}},xg=t=>{switch(t){case"verbose":return 0;case"info":return 1;case"warning":return 2;case"error":return 3;case"fatal":return 4;default:throw new Error(`unsupported logging level: ${t}`)}},vb=t=>t==="float32"||t==="float16"||t==="int32"||t==="int64"||t==="uint32"||t==="uint8"||t==="bool"||t==="uint4"||t==="int4",wb=t=>t==="float32"||t==="float16"||t==="int32"||t==="int64"||t==="uint32"||t==="uint64"||t==="int8"||t==="uint8"||t==="bool"||t==="uint4"||t==="int4",ax=t=>{switch(t){case"none":return 0;case"cpu":return 1;case"cpu-pinned":return 2;case"texture":return 3;case"gpu-buffer":return 4;case"ml-tensor":return 5;default:throw new Error(`unsupported data location: ${t}`)}}}),xb,x3=Ke(()=>{pb(),xb=async t=>{if(typeof t=="string"){let e=await fetch(t);if(!e.ok)throw new Error(`failed to load external data file: ${t}`);let r=e.headers.get("Content-Length"),n=r?parseInt(r,10):0;if(n<1073741824)return new Uint8Array(await e.arrayBuffer());{if(!e.body)throw new Error(`failed to load external data file: ${t}, no response body.`);let s=e.body.getReader(),i;try{i=new ArrayBuffer(n)}catch(a){if(a instanceof RangeError){let l=Math.ceil(n/65536);i=new WebAssembly.Memory({initial:l,maximum:l}).buffer}else throw a}let o=0;for(;;){let{done:a,value:l}=await s.read();if(a)break;let c=l.byteLength;new Uint8Array(i,o,c).set(l),o+=c}return new Uint8Array(i,0,n)}}else return t instanceof Blob?new Uint8Array(await t.arrayBuffer()):t instanceof Uint8Array?t:new Uint8Array(t)}}),xk,bk,Mk,Tk,bb,Ck,Gt,Ho=Ke(()=>{St(),xk=["V","I","W","E","F"],bk=(t,e)=>{console.log(`[${xk[t]},${new Date().toISOString()}]${e}`)},bb=(t,e)=>{Mk=t,Tk=e},Ck=(t,e)=>{let r=xg(t),n=xg(Mk);r>=n&&bk(r,typeof e=="function"?e():e)},Gt=(...t)=>{Tk&&Ck(...t)}}),Sk,Pu,Se,bg,b3,M3,T3,It=Ke(()=>{Sk=class{static calcMatMulShape(t,e){return t[1]!==e[0]?void 0:[t[0],e[1]]}},Pu=class{static calcShape(t,e,r=!1){let n=t.length,s=e.length;if(n===0)return e;if(s===0)return t;let i=Math.max(t.length,e.length),o=new Array(i);if(r){if(n<2||s<2)return;let a=Sk.calcMatMulShape([t[n-2],t[n-1]],[e[s-2],e[s-1]]);if(a===void 0)return;[o[i-2],o[i-1]]=a}for(let a=r?3:1;a<=i;a++){let l=n-a<0?1:t[n-a],c=s-a<0?1:e[s-a];if(l!==c&&l>1&&c>1)return;let u=Math.max(l,c);if(l&&c)o[i-a]=Math.max(l,c);else{if(u>1)return;o[i-a]=0}}return o}static isValidBroadcast(t,e){let r=t.length,n=e.length;if(r>n)return!1;for(let s=1;s<=r;s++)if(t[r-s]!==1&&t[r-s]!==e[n-s])return!1;return!0}},Se=class Im{static size(e){return Im.getSizeFromDimensionRange(e,0,e.length)}static convertShape(e,r=4){let n=e.length;if(n===0)return[];let s=new Array(n),i=n-1;for(;i>=0;){if(e[i]%r===0){s[i]=e[i]/r;break}if(r%e[i]!==0)throw new Error("cannot convert shape");s[i]=1,r/=e[i],i--}for(i--;i>=0;i--)s[i]=e[i];return s}static sizeFromDimension(e,r){if(r<0||r>e.length)throw new Error(`invalid dimension of ${r} for sizeFromDimension as Tensor has ${e.length} dimensions.`);return Im.getSizeFromDimensionRange(e,r,e.length)}static sizeToDimension(e,r){if(r<0||r>e.length)throw new Error(`invalid dimension of ${r} for sizeToDimension as Tensor has ${e.length} dimensions.`);return Im.getSizeFromDimensionRange(e,0,r)}static getSizeFromDimensionRange(e,r,n){let s=1;for(let i=r;i<n;i++){if(e[i]<0)throw new Error("cannot get valid size from specified dimension range. Most likely the range contains negative values in them.");s*=Number(e[i])}return s}static computeStrides(e){let r=e.length;if(r===0)return[];if(r===1)return[1];let n=new Array(r);n[r-1]=1,n[r-2]=e[r-1];for(let s=r-3;s>=0;--s)n[s]=n[s+1]*e[s+1];return n}static normalizeAxis(e,r){if(e<-r&&e>=r)throw new Error("unsupported axis for this operation.");return e<0?e+r:e}static normalizeAxes(e,r){return e.map(n=>this.normalizeAxis(n,r??e.length))}static sortBasedOnPerm(e,r){return r?r.map(n=>e[n]):e.slice().reverse()}static padShape(e,r){let n=e.length;return e.map((s,i)=>s+r[i]+r[i+n])}static areEqual(e,r){return e.length!==r.length?!1:e.every((n,s)=>n===r[s])}},bg=class Jd{static adjustPoolAttributes(e,r,n,s,i,o){if(!e&&n.length!==r.length-2)throw new Error("length of specified kernel shapes should be 2 less than length of input dimensions");if(e)for(let a=0;a<r.length-2;a++)a>=n.length?n.push(r[a+2]):n[a]=r[a+2];for(let a=0;a<n.length;a++)if(a<s.length){if(s[a]<0)throw new Error("strides should be greater than or equal to 1")}else s.push(1);for(let a=0;a<n.length;a++)if(a<i.length){if(i[a]<0)throw new Error("dilations should be greater than or equal to 1")}else i.push(1);for(let a=0;a<n.length*2;a++)if(a<o.length){if(o[a]<0)throw new Error("pad should be greater than or equal to 1")}else o.push(0);for(let a=0;a<n.length;a++){if(n[a]<=0)throw new Error("kernel shapes need to be greater than 0");if(o[a]>=n[a]||o[a+n.length]>=n[a])throw new Error("pads should be smaller than kernel")}}static adjustPadsBasedOnAutoPad(e,r,n,s,i,o,a){if(a){if(i.length!==2*(e.length-2))throw new Error("length of pads should be twice the length of data dimensions");if(r.length!==e.length-2)throw new Error("length of strides should be the length of data dimensions");if(s.length!==e.length-2)throw new Error("length of kernel shapes should be the length of data dimensions");for(let l=0;l<e.length-2;l++)Jd.adjustPadAndReturnShape(e[l+(o?1:2)],r[l],n[l],s[l],i,l,l+e.length-2,a)}}static computePoolOutputShape(e,r,n,s,i,o,a){if(r.length<=0)throw new Error("input shape must be of size greater than 0");let l=[r[0],r[1]];return Jd.computeShapeHelper(e,r,l,n,s,i,o,a),l}static computeConvOutputShape(e,r,n,s,i,o,a){if(e.length<=0||r.length<=0)throw new Error("invalid input tensor dims or invalid filter tensor dims");let l=[e[0],r[0]];return Jd.computeShapeHelper(!1,e,l,n,s,i,o,a),l}static computeShapeHelper(e,r,n,s,i,o,a,l){if(e)for(let c=0;c<r.length-2;c++)n.push(1);else for(let c=0;c<r.length-2;c++)n.push(Jd.adjustPadAndReturnShape(r[c+2],s[c],i[c],o[c],a,c,c+r.length-2,l))}static adjustPadAndReturnShape(e,r,n,s,i,o,a,l){let c=n*(s-1)+1;if(l&&l!=="NOTSET")switch(l){case"VALID":return i[o]=0,i[a]=0,Math.floor((e-c)/r+1);case"SAME_LOWER":case"SAME_UPPER":if(n!==1)throw new Error("Dilation not supported for SAME_UPPER or SAME_LOWER");{let u=((e+r-1)/r-1)*r+s-e;return i[o]=Math.floor(l==="SAME_LOWER"?(u+1)/2:u/2),i[a]=u-i[o],Math.floor((e+u-s)/r+1)}default:throw new Error("Unsupported AutoPad type")}else return Math.floor((e+i[o]+i[a]-c)/r+1)}},b3=class{static getShapeOfGemmResult(t,e,r,n,s){if(t.length!==2||r.length!==2)throw new Error("shape need to be of size 2");let i,o,a;e?(i=t[1],o=t[0]):(i=t[0],o=t[1]);let l=-1;if(n?(a=r[0],l=1):(a=r[1],l=0),r[l]!==o)throw new Error("dimension mismatch");if(i<=0||a<=0||o<=0)throw new Error("invalid shape specified");if(s&&!Pu.isValidBroadcast(s,[i,a]))throw new Error("gemm: invalid bias shape for broadcast");return[i,a,o]}},M3=-34028234663852886e22,T3=34028234663852886e22}),Mb,C3=Ke(()=>{St(),Mb=(t,e)=>new(yb(e))(t)}),lx,Vy,Ek,Wy,Pk,Uy,Gy,Hy,kk,S3,_9=Ke(()=>{Ho(),lx=(t,e=!0)=>{if(t.byteLength%8!==0)throw new Error("Invalid Uint8Array length - must be a multiple of 8 (BigInt).");let r=t.byteLength/8,n=new BigInt64Array(t.buffer,t.byteOffset,r),s=new Int32Array(r);for(let i=0;i<r;i++){let o=n[i];if(o>2147483647n||o<-2147483648n)throw new Error(`Overflow occurred when converting BigInt to Int32 at index ${i}: ${o}`);s[i]=Number(o)}return e?new Uint8Array(s.buffer):s},Vy=(t,e=!0)=>{if(t.byteLength%4!==0)throw new Error("Invalid Uint8Array length - must be a multiple of 4 (Int32).");let r=t.byteLength/4,n=new Int32Array(t.buffer,t.byteOffset,r),s=BigInt64Array.from(n,BigInt);return e?new Uint8Array(s.buffer):s},Ek=1,Wy=()=>Ek++,Pk=new Map([["float32",32],["float16",16],["int32",32],["uint32",32],["int64",64],["uint64",64],["int8",8],["uint8",8],["int4",4],["uint4",4]]),Uy=(t,e)=>{let r=Pk.get(t);if(!r)throw new Error("Unsupported data type.");return e.length>0?Math.ceil(e.reduce((n,s)=>n*s)*r/8):0},Gy=class{constructor(t){this.shouldConvertInt64toInt32=!1,this.isInt64ToInt32Converted=!1;let{sessionId:e,context:r,tensor:n,dataType:s,shape:i,shouldConvertInt64toInt32:o=!1}=t;this.sessionId=e,this.mlContext=r,this.mlTensor=n,this.dataType=s,this.tensorShape=i,this.shouldConvertInt64toInt32=o}get tensor(){return this.mlTensor}get type(){return this.dataType}get shape(){return this.tensorShape}get byteLength(){return Uy(this.dataType,this.tensorShape)}destroy(){Gt("verbose",()=>"[WebNN] TensorWrapper.destroy"),this.mlTensor.destroy()}write(t){this.mlContext.writeTensor(this.mlTensor,t)}async read(t,e){if(t){let r=await this.mlContext.readTensor(this.mlTensor),n=Vy(new Uint8Array(r));if(e){(e instanceof ArrayBuffer?new Uint8Array(e):new Uint8Array(e.buffer,e.byteOffset,e.byteLength)).set(n);return}else return n.buffer}else return e?this.mlContext.readTensor(this.mlTensor,e):this.mlContext.readTensor(this.mlTensor)}canReuseTensor(t,e,r){return this.mlContext===t&&this.dataType===e&&this.tensorShape.length===r.length&&this.tensorShape.every((n,s)=>n===r[s])}setIsInt64ToInt32Converted(t){this.isInt64ToInt32Converted=t}},Hy=class{constructor(t,e){this.tensorManager=t,this.wrapper=e}get tensorWrapper(){return this.wrapper}releaseTensor(){this.tensorWrapper&&(this.tensorManager.releaseTensor(this.tensorWrapper),this.wrapper=void 0)}async ensureTensor(t,e,r,n){let s=e,i=this.tensorManager.getMLContext(t),o=s==="int64"&&!i.opSupportLimits().input.dataTypes.includes("int64");if(o&&(s="int32",Gt("verbose",()=>"[WebNN] TensorIdTracker.ensureTensor: convert dataType from int64 to int32")),this.wrapper){if(this.wrapper.canReuseTensor(i,s,r))return this.wrapper.tensor;if(n){if(this.wrapper.byteLength!==Uy(s,r))throw new Error("Unable to copy data to tensor with different size.");this.activeUpload=new Uint8Array(await this.wrapper.read())}this.tensorManager.releaseTensor(this.wrapper)}let a=typeof MLTensorUsage>"u"?void 0:MLTensorUsage.READ|MLTensorUsage.WRITE;return this.wrapper=await this.tensorManager.getCachedTensor(t,s,r,a,!0,!0,o),n&&this.activeUpload&&(this.wrapper.write(this.activeUpload),this.activeUpload=void 0),this.wrapper.tensor}upload(t){let e=t;if(this.wrapper)if(this.wrapper.shouldConvertInt64toInt32&&(e=lx(t,!0),this.wrapper.setIsInt64ToInt32Converted(!0)),e.byteLength===this.wrapper.byteLength){this.wrapper.write(e);return}else Gt("verbose",()=>"Data size does not match tensor size. Releasing tensor."),this.releaseTensor();this.activeUpload?this.activeUpload.set(e):this.activeUpload=new Uint8Array(e)}async download(t){var e,r,n;if(this.activeUpload){let s=(e=this.wrapper)!=null&&e.isInt64ToInt32Converted?Vy(this.activeUpload):this.activeUpload;if(t){t instanceof ArrayBuffer?new Uint8Array(t).set(s):new Uint8Array(t.buffer,t.byteOffset,t.byteLength).set(s);return}else return s.buffer}if(!this.wrapper)throw new Error("Tensor has not been created.");return t?this.wrapper.read((r=this.wrapper)==null?void 0:r.shouldConvertInt64toInt32,t):this.wrapper.read((n=this.wrapper)==null?void 0:n.shouldConvertInt64toInt32)}},kk=class{constructor(t){this.backend=t,this.tensorTrackersById=new Map,this.freeTensors=[],this.externalTensors=new Set}getMLContext(t){let e=this.backend.getMLContext(t);if(!e)throw new Error("MLContext not found for session.");return e}reserveTensorId(){let t=Wy();return this.tensorTrackersById.set(t,new Hy(this)),t}releaseTensorId(t){let e=this.tensorTrackersById.get(t);e&&(this.tensorTrackersById.delete(t),e.tensorWrapper&&this.releaseTensor(e.tensorWrapper))}async ensureTensor(t,e,r,n,s){Gt("verbose",()=>`[WebNN] TensorManager.ensureTensor {tensorId: ${e}, dataType: ${r}, shape: ${n}, copyOld: ${s}}`);let i=this.tensorTrackersById.get(e);if(!i)throw new Error("Tensor not found.");return i.ensureTensor(t,r,n,s)}upload(t,e){let r=this.tensorTrackersById.get(t);if(!r)throw new Error("Tensor not found.");r.upload(e)}async download(t,e){Gt("verbose",()=>`[WebNN] TensorManager.download {tensorId: ${t}, dstBuffer: ${e==null?void 0:e.byteLength}}`);let r=this.tensorTrackersById.get(t);if(!r)throw new Error("Tensor not found.");return r.download(e)}releaseTensorsForSession(t){for(let e of this.freeTensors)e.sessionId===t&&e.destroy();this.freeTensors=this.freeTensors.filter(e=>e.sessionId!==t)}registerTensor(t,e,r,n){let s=this.getMLContext(t),i=Wy(),o=new Gy({sessionId:t,context:s,tensor:e,dataType:r,shape:n});return this.tensorTrackersById.set(i,new Hy(this,o)),this.externalTensors.add(o),i}async getCachedTensor(t,e,r,n,s,i,o=!1){let a=this.getMLContext(t);for(let[c,u]of this.freeTensors.entries())if(u.canReuseTensor(a,e,r)){Gt("verbose",()=>`[WebNN] Reusing tensor {dataType: ${e}, shape: ${r}}`);let d=this.freeTensors.splice(c,1)[0];return d.sessionId=t,d}Gt("verbose",()=>`[WebNN] MLContext.createTensor {dataType: ${e}, shape: ${r}}`);let l=await a.createTensor({dataType:e,shape:r,dimensions:r,usage:n,writable:s,readable:i});return new Gy({sessionId:t,context:a,tensor:l,dataType:e,shape:r,shouldConvertInt64toInt32:o})}releaseTensor(t){this.externalTensors.has(t)&&this.externalTensors.delete(t),this.freeTensors.push(t)}},S3=(...t)=>new kk(...t)}),kp,Ak,E3,y9=Ke(()=>{St(),ic(),C3(),_9(),Ho(),kp=new Map([[1,"float32"],[10,"float16"],[6,"int32"],[12,"uint32"],[7,"int64"],[13,"uint64"],[22,"int4"],[21,"uint4"],[3,"int8"],[2,"uint8"],[9,"uint8"]]),Ak=(t,e)=>{if(t===e)return!0;if(t===void 0||e===void 0)return!1;let r=Object.keys(t).sort(),n=Object.keys(e).sort();return r.length===n.length&&r.every((s,i)=>s===n[i]&&t[s]===e[s])},E3=class{constructor(t){this.tensorManager=S3(this),this.mlContextBySessionId=new Map,this.sessionIdsByMLContext=new Map,this.mlContextCache=[],this.sessionGraphInputs=new Map,this.temporaryGraphInputs=[],this.temporarySessionTensorIds=new Map,bb(t.logLevel,!!t.debug)}get currentSessionId(){if(this.activeSessionId===void 0)throw new Error("No active session");return this.activeSessionId}onRunStart(t){Gt("verbose",()=>`[WebNN] onRunStart {sessionId: ${t}}`),this.activeSessionId=t}onRunEnd(t){Gt("verbose",()=>`[WebNN] onRunEnd {sessionId: ${t}}`);let e=this.temporarySessionTensorIds.get(t);if(e){for(let r of e)Gt("verbose",()=>`[WebNN] releasing temporary tensor {tensorId: ${r}}`),this.tensorManager.releaseTensorId(r);this.temporarySessionTensorIds.delete(t),this.activeSessionId=void 0}}async createMLContext(t){if(t instanceof GPUDevice){let r=this.mlContextCache.findIndex(n=>n.gpuDevice===t);if(r!==-1)return this.mlContextCache[r].mlContext;{let n=await navigator.ml.createContext(t);return this.mlContextCache.push({gpuDevice:t,mlContext:n}),n}}else if(t===void 0){let r=this.mlContextCache.findIndex(n=>n.options===void 0&&n.gpuDevice===void 0);if(r!==-1)return this.mlContextCache[r].mlContext;{let n=await navigator.ml.createContext();return this.mlContextCache.push({mlContext:n}),n}}let e=this.mlContextCache.findIndex(r=>Ak(r.options,t));if(e!==-1)return this.mlContextCache[e].mlContext;{let r=await navigator.ml.createContext(t);return this.mlContextCache.push({options:t,mlContext:r}),r}}registerMLContext(t,e){this.mlContextBySessionId.set(t,e);let r=this.sessionIdsByMLContext.get(e);r||(r=new Set,this.sessionIdsByMLContext.set(e,r)),r.add(t),this.temporaryGraphInputs.length>0&&(this.sessionGraphInputs.set(t,this.temporaryGraphInputs),this.temporaryGraphInputs=[])}onReleaseSession(t){this.sessionGraphInputs.delete(t);let e=this.mlContextBySessionId.get(t);if(!e)return;this.tensorManager.releaseTensorsForSession(t),this.mlContextBySessionId.delete(t);let r=this.sessionIdsByMLContext.get(e);if(r.delete(t),r.size===0){this.sessionIdsByMLContext.delete(e);let n=this.mlContextCache.findIndex(s=>s.mlContext===e);n!==-1&&this.mlContextCache.splice(n,1)}}getMLContext(t){return this.mlContextBySessionId.get(t)}reserveTensorId(){return this.tensorManager.reserveTensorId()}releaseTensorId(t){Gt("verbose",()=>`[WebNN] releaseTensorId {tensorId: ${t}}`),this.tensorManager.releaseTensorId(t)}async ensureTensor(t,e,r,n,s){let i=kp.get(r);if(!i)throw new Error(`Unsupported ONNX data type: ${r}`);return this.tensorManager.ensureTensor(t??this.currentSessionId,e,i,n,s)}async createTemporaryTensor(t,e,r){Gt("verbose",()=>`[WebNN] createTemporaryTensor {onnxDataType: ${e}, shape: ${r}}`);let n=kp.get(e);if(!n)throw new Error(`Unsupported ONNX data type: ${e}`);let s=this.tensorManager.reserveTensorId();await this.tensorManager.ensureTensor(t,s,n,r,!1);let i=this.temporarySessionTensorIds.get(t);return i?i.push(s):this.temporarySessionTensorIds.set(t,[s]),s}uploadTensor(t,e){if(!vr().shouldTransferToMLTensor)throw new Error("Trying to upload to a MLTensor while shouldTransferToMLTensor is false");Gt("verbose",()=>`[WebNN] uploadTensor {tensorId: ${t}, data: ${e.byteLength}}`),this.tensorManager.upload(t,e)}async downloadTensor(t,e){return this.tensorManager.download(t,e)}createMLTensorDownloader(t,e){return async()=>{let r=await this.tensorManager.download(t);return Mb(r,e)}}registerMLTensor(t,e,r,n){let s=kp.get(r);if(!s)throw new Error(`Unsupported ONNX data type: ${r}`);let i=this.tensorManager.registerTensor(t,e,s,n);return Gt("verbose",()=>`[WebNN] registerMLTensor {tensor: ${e}, dataType: ${s}, dimensions: ${n}} -> {tensorId: ${i}}`),i}registerMLConstant(t,e,r,n,s,i,o=!1){if(!i)throw new Error("External mounted files are not available.");let a=t;t.startsWith("./")&&(a=t.substring(2));let l=i.get(a);if(!l)throw new Error(`File with name ${a} not found in preloaded files.`);if(e+r>l.byteLength)throw new Error("Out of bounds: data offset and length exceed the external file data size.");let c=l.slice(e,e+r).buffer,u;switch(s.dataType){case"float32":u=new Float32Array(c);break;case"float16":u=typeof Float16Array<"u"&&Float16Array.from?new Float16Array(c):new Uint16Array(c);break;case"int32":u=new Int32Array(c);break;case"uint32":u=new Uint32Array(c);break;case"int64":o?(u=lx(new Uint8Array(c),!1),s.dataType="int32"):u=new BigInt64Array(c);break;case"uint64":u=new BigUint64Array(c);break;case"int8":u=new Int8Array(c);break;case"int4":case"uint4":case"uint8":u=new Uint8Array(c);break;default:throw new Error(`Unsupported data type: ${s.dataType} in creating WebNN Constant from external data.`)}return Gt("verbose",()=>`[WebNN] registerMLConstant {dataType: ${s.dataType}, shape: ${s.shape}}} ${o?"(Note: it was int64 data type and registered to int32 as workaround)":""}`),n.constant(s,u)}registerGraphInput(t){this.temporaryGraphInputs.push(t)}isGraphInput(t,e){let r=this.sessionGraphInputs.get(t);return r?r.includes(e):!1}isInt64Supported(t){var e;return!!((e=this.mlContextBySessionId.get(t))!=null&&e.opSupportLimits().input.dataTypes.includes("int64"))}flush(){}}}),Tb=Ke(()=>{}),Ky,Ap,$p,$k,Ok,Xy,cx,Dk,P3,v9=Ke(()=>{Ho(),Tb(),Ky=new Map([[64,250],[128,200],[256,200],[512,200],[2048,230],[4096,200],[8192,50],[16384,50],[32768,50],[65536,50],[131072,50],[262144,50],[524288,50],[1048576,50],[2097152,30],[4194304,20],[8388608,10],[12582912,10],[16777216,10],[26214400,15],[33554432,22],[44236800,2],[58982400,6],[67108864,6],[134217728,6],[167772160,6]]),Ap=[],$p=t=>Math.ceil(Number(t)/16)*16,$k=t=>{for(let e=0;e<Ap.length;e++){let r=Ap[e];if(t<=r)return r}return Math.ceil(t/16)*16},Ok=1,Xy=()=>Ok++,cx=async(t,e,r,n)=>{let s=$p(r),i=t.device.createBuffer({size:s,usage:GPUBufferUsage.COPY_DST|GPUBufferUsage.MAP_READ});try{let o=t.getCommandEncoder();t.endComputePass(),o.copyBufferToBuffer(e,0,i,0,s),t.flush(),await i.mapAsync(GPUMapMode.READ);let a=i.getMappedRange();if(n){let l=n();return l.set(new Uint8Array(a,0,r)),l}else return new Uint8Array(a.slice(0,r))}finally{i.destroy()}},Dk=class{constructor(t){this.backend=t,this.storageCache=new Map,this.freeBuffers=new Map,this.freeUniformBuffers=new Map,this.buffersPending=[],this.capturedPendingBuffers=new Map;for(let[e]of Ky)Ap.push(e),this.freeBuffers.set(e,[]),this.freeUniformBuffers.set(e,[]);this.sessionCount=0}upload(t,e){let r=e.buffer,n=e.byteOffset,s=e.byteLength,i=$p(s),o=this.storageCache.get(t);if(!o)throw new Error("gpu data for uploading does not exist");if(Number(o.originalSize)!==s)throw new Error(`inconsistent data size. gpu data size=${o.originalSize}, data size=${s}`);let a=this.backend.device.createBuffer({mappedAtCreation:!0,size:i,usage:GPUBufferUsage.MAP_WRITE|GPUBufferUsage.COPY_SRC}),l=a.getMappedRange();new Uint8Array(l).set(new Uint8Array(r,n,s)),a.unmap();let c=this.backend.device.createCommandEncoder();c.copyBufferToBuffer(a,0,o.gpuData.buffer,0,i),this.backend.device.queue.submit([c.finish()]),a.destroy(),Gt("verbose",()=>`[WebGPU] GpuDataManager.upload(id=${t})`)}memcpy(t,e){let r=this.storageCache.get(t);if(!r)throw new Error("source gpu data for memcpy does not exist");let n=this.storageCache.get(e);if(!n)throw new Error("destination gpu data for memcpy does not exist");if(r.originalSize!==n.originalSize)throw new Error("inconsistent source and destination gpu data size");let s=$p(r.originalSize),i=this.backend.getCommandEncoder();this.backend.endComputePass(),i.copyBufferToBuffer(r.gpuData.buffer,0,n.gpuData.buffer,0,s)}registerExternalBuffer(t,e,r){let n;if(r){if(n=r[0],t===r[1])return Gt("verbose",()=>`[WebGPU] GpuDataManager.registerExternalBuffer(size=${e}) => id=${n}, buffer is the same, skip.`),n;if(this.backend.capturedCommandList.has(this.backend.currentSessionId))throw new Error(`Registering a different external buffer under graph capture mode is not supported yet.
             Please use the previous external buffer!`)}else n=Xy();return this.storageCache.set(n,{gpuData:{id:n,type:0,buffer:t},originalSize:e}),Gt("verbose",()=>`[WebGPU] GpuDataManager.registerExternalBuffer(size=${e}) => id=${n}, registered.`),n}unregisterExternalBuffer(t){t!==void 0&&(this.storageCache.delete(t),Gt("verbose",()=>`[WebGPU] GpuDataManager.unregisterExternalBuffer() => id=${t}`))}create(t,e=GPUBufferUsage.STORAGE|GPUBufferUsage.COPY_SRC|GPUBufferUsage.COPY_DST){let r=$k(t),n,s=(e&GPUBufferUsage.STORAGE)===GPUBufferUsage.STORAGE,i=(e&GPUBufferUsage.UNIFORM)===GPUBufferUsage.UNIFORM;if(s||i){let a=(s?this.freeBuffers:this.freeUniformBuffers).get(r);a?a.length>0?n=a.pop():n=this.backend.device.createBuffer({size:r,usage:e}):n=this.backend.device.createBuffer({size:r,usage:e})}else n=this.backend.device.createBuffer({size:r,usage:e});let o={id:Xy(),type:0,buffer:n};return this.storageCache.set(o.id,{gpuData:o,originalSize:Number(t)}),Gt("verbose",()=>`[WebGPU] GpuDataManager.create(size=${t}) => id=${o.id}`),o}get(t){var e;return(e=this.storageCache.get(t))==null?void 0:e.gpuData}release(t){let e=typeof t=="bigint"?Number(t):t,r=this.storageCache.get(e);if(!r){if(this.storageCache.size===0)return 0;throw new Error("releasing data does not exist")}return Gt("verbose",()=>`[WebGPU] GpuDataManager.release(id=${e}), gpuDataId=${r.gpuData.id}`),this.storageCache.delete(e),this.buffersPending.push(r.gpuData.buffer),r.originalSize}async download(t,e){let r=this.storageCache.get(Number(t));if(!r)throw new Error("data does not exist");await cx(this.backend,r.gpuData.buffer,r.originalSize,e)}refreshPendingBuffers(){if(this.buffersPending.length!==0)if(this.backend.sessionStatus==="default"){for(let t of this.buffersPending){let e=Ky.get(t.size);if((t.usage&GPUBufferUsage.STORAGE)===GPUBufferUsage.STORAGE){let r=this.freeBuffers.get(t.size)||[];e===void 0||r.length>=e?t.destroy():r.push(t)}else if((t.usage&GPUBufferUsage.UNIFORM)===GPUBufferUsage.UNIFORM){let r=this.freeUniformBuffers.get(t.size)||[];e===void 0||r.length>=e?t.destroy():r.push(t)}else t.destroy()}this.buffersPending=[]}else{let t=this.capturedPendingBuffers.get(this.backend.currentSessionId);t||(t=[],this.capturedPendingBuffers.set(this.backend.currentSessionId,t));for(let e of this.buffersPending)t.push(e);this.buffersPending=[]}}dispose(){this.freeBuffers.forEach(t=>{t.forEach(e=>{e.destroy()})}),this.freeUniformBuffers.forEach(t=>{t.forEach(e=>{e.destroy()})}),this.storageCache.forEach(t=>{t.gpuData.buffer.destroy()}),this.capturedPendingBuffers.forEach(t=>{t.forEach(e=>{e.destroy()})}),this.storageCache=new Map,this.freeBuffers=new Map,this.freeUniformBuffers=new Map,this.capturedPendingBuffers=new Map}onCreateSession(){this.sessionCount+=1}onReleaseSession(t){let e=this.capturedPendingBuffers.get(t);e&&(e.forEach(r=>{r.destroy()}),this.capturedPendingBuffers.delete(t)),this.sessionCount-=1,this.sessionCount===0&&(Gt("warning",()=>"[WebGPU] Clearing webgpu buffer cache"),this.storageCache.forEach(r=>{r.gpuData.buffer.destroy()}),this.storageCache=new Map)}},P3=(...t)=>new Dk(...t)}),Ik,or,Wr=Ke(()=>{Ik=class{constructor(t){Object.assign(this,t)}get cacheKey(){return this.key||(this.key=Object.getOwnPropertyNames(this).sort().map(t=>`${this[t]}`).join(";")),this.key}},or=t=>new Ik(t)}),ku,Op,wn,Wn,wt,Ir,ux,Gc,Ba,gt,jd,Ie,dt,k3,Cb,Fk,A3,Ft=Ke(()=>{St(),It(),ku=64,Op=(t,e)=>{if(e===3)throw new Error("vec3 has same alignment as vec4, use vec4 instead");switch(Number(t)){case 10:return e>1?`vec${e}<f16>`:"f16";case 1:return e>1?`vec${e}<f32>`:"f32";case 6:return e>1?`vec${e}<i32>`:"i32";case 12:return e>1?`vec${e}<u32>`:"u32";case 7:if(e>1)throw new Error("currently not supported vecX of uint64 yet");return["vec2<u32>","i32"];case 13:if(e>1)throw new Error("currently not supported vecX of uint64 yet");return["vec2<u32>","u32"];case 9:if(e!==4)throw new Error("bool must be vec4");return["u32","vec4<bool>"];case 22:return"i32";case 21:return"u32";default:throw new Error(`Unknown data type: ${t}`)}},wn=(t,e=1)=>{let r=Op(t,e);return typeof r=="string"?r:r[0]},Wn=(t,e=1)=>{let r=Op(t,e);return typeof r=="string"?r:r[1]},wt=(...t)=>{let e=[];return t.forEach(r=>{r.length!==0&&e.push({type:12,data:r},{type:12,data:Se.computeStrides(r)})}),e},Ir=t=>t%4===0?4:t%2===0?2:1,ux=(t="f32",e,r="0")=>!e||e===1?`${t}(${r})`:`vec${e}<${t}>(${r})`,Gc=(t,e,r)=>t==="f32"?r:e===1?`f32(${r})`:`vec${e}<f32>(${r})`,Ba=(t,e)=>e===4?`(${t}.x + ${t}.y + ${t}.z + ${t}.w)`:e===2?`(${t}.x + ${t}.y)`:e===3?`(${t}.x + ${t}.y + ${t}.z)`:t,gt=(t,e,r,n)=>t.startsWith("uniforms.")&&r>4?typeof e=="string"?n==="f16"?`${t}[(${e}) / 8][(${e}) % 8 / 4][(${e}) % 8 % 4]`:`${t}[(${e}) / 4][(${e}) % 4]`:n==="f16"?`${t}[${Math.floor(e/8)}][${Math.floor(e%8/4)}][${e%8%4}]`:`${t}[${Math.floor(e/4)}][${e%4}]`:r>1?`${t}[${e}]`:t,jd=(t,e,r,n,s)=>{let i=typeof r=="number",o=i?r:r.length,a=[...new Array(o).keys()],l=o<2?"u32":o<=4?`vec${o}<u32>`:`array<u32, ${o}>`,c=Op(e,s),u=typeof c=="string"?c:c[1],d=typeof c=="string"?c:c[0],h={indices:l,value:u,storage:d,tensor:e},f=z=>typeof z=="string"?z:`${z}u`,p={offsetToIndices:!1,indicesToOffset:!1,broadcastedIndicesToOffset:!1,set:!1,setByIndices:!1,get:!1,getByIndices:!1},m=i?"uniforms.":"",y=`${m}${t}_shape`,g=`${m}${t}_strides`,_="";for(let z=0;z<o-1;z++)_+=`
    let dim${z} = current / ${gt(g,z,o)};
    let rest${z} = current % ${gt(g,z,o)};
    indices[${z}] = dim${z};
    current = rest${z};
    `;_+=`indices[${o-1}] = current;`;let v=o<2?"":`
  fn o2i_${t}(offset: u32) -> ${h.indices} {
    var indices: ${h.indices};
    var current = offset;
    ${_}
    return indices;
  }`,w=z=>(p.offsetToIndices=!0,o<2?z:`o2i_${t}(${z})`),x=[];if(o>=2)for(let z=o-1;z>=0;z--)x.push(`${gt(g,z,o)} * (indices[${z}])`);let M=o<2?"":`
  fn i2o_${t}(indices: ${h.indices}) -> u32 {
    return ${x.join("+")};
  }`,T=z=>(p.indicesToOffset=!0,o<2?z:`i2o_${t}(${z})`),S=(...z)=>o===0?"0u":`${h.indices}(${z.map(f).join(",")})`,k=(z,O)=>o<2?`${z}`:`${gt(z,O,o)}`,$=(z,O,H)=>o<2?`${z}=${H};`:`${gt(z,O,o)}=${H};`,j={},V=(z,O)=>{p.broadcastedIndicesToOffset=!0;let H=`${O.name}broadcastedIndicesTo${t}Offset`;if(H in j)return`${H}(${z})`;let re=[];for(let _e=o-1;_e>=0;_e--){let oe=O.indicesGet("outputIndices",_e+O.rank-o);re.push(`${k(g,_e)} * (${oe} % ${k(y,_e)})`)}return j[H]=`fn ${H}(outputIndices: ${O.type.indices}) -> u32 {
             return ${re.length>0?re.join("+"):"0u"};
           }`,`${H}(${z})`},L=(z,O)=>(()=>{if(h.storage===h.value)return`${t}[${z}]=${O};`;if(h.storage==="vec2<u32>"&&h.value==="i32")return`${t}[${z}]=vec2<u32>(u32(${O}), select(0u, 0xFFFFFFFFu, ${O} < 0));`;if(h.storage==="vec2<u32>"&&h.value==="u32")return`${t}[${z}]=vec2<u32>(u32(${O}), 0u);`;if(h.storage==="u32"&&h.value==="vec4<bool>")return`${t}[${z}]=dot(vec4<u32>(0x1, 0x100, 0x10000, 0x1000000), vec4<u32>(${O}));`;throw new Error(`not supported combination of storage type ${h.storage} and value type ${h.value} yet`)})(),X=z=>(()=>{if(h.storage===h.value)return`${t}[${z}]`;if(h.storage==="vec2<u32>"&&h.value==="i32")return`i32(${t}[${z}].x)`;if(h.storage==="vec2<u32>"&&h.value==="u32")return`u32(${t}[${z}].x)`;if(h.storage==="u32"&&h.value==="vec4<bool>")return`vec4<bool>(bool(${t}[${z}] & 0xFFu), bool(${t}[${z}] & 0xFF00u), bool(${t}[${z}] & 0xFF0000u), bool(${t}[${z}] & 0xFF000000u))`;throw new Error(`not supported combination of storage type ${h.storage} and value type ${h.value} yet`)})(),K=o<2?"":`
  fn get_${t}ByIndices(indices: ${h.indices}) -> ${u} {
    return ${X(`i2o_${t}(indices)`)};
  }`,Y=o<2?"":(()=>{let z=a.map(H=>`d${H}: u32`).join(", "),O=a.map(H=>`d${H}`).join(", ");return`
  fn get_${t}(${z}) -> ${u} {
    return get_${t}ByIndices(${S(O)});
  }`})(),J=(...z)=>{if(z.length!==o)throw new Error(`indices length must be ${o}`);let O=z.map(f).join(",");return o===0?X("0u"):o===1?X(O[0]):(p.get=!0,p.getByIndices=!0,p.indicesToOffset=!0,`get_${t}(${O})`)},N=z=>o<2?X(z):(p.getByIndices=!0,p.indicesToOffset=!0,`get_${t}ByIndices(${z})`),ne=o<2?"":`
  fn set_${t}ByIndices(indices: ${h.indices}, value: ${u}) {
    ${L(`i2o_${t}(indices)`,"value")}
  }`,te=o<2?"":(()=>{let z=a.map(H=>`d${H}: u32`).join(", "),O=a.map(H=>`d${H}`).join(", ");return`
  fn set_${t}(${z}, value: ${u}) {
    set_${t}ByIndices(${S(O)}, value);
  }`})();return{impl:()=>{let z=[],O=!1;return p.offsetToIndices&&(z.push(v),O=!0),p.indicesToOffset&&(z.push(M),O=!0),p.broadcastedIndicesToOffset&&(Object.values(j).forEach(H=>z.push(H)),O=!0),p.set&&(z.push(te),O=!0),p.setByIndices&&(z.push(ne),O=!0),p.get&&(z.push(Y),O=!0),p.getByIndices&&(z.push(K),O=!0),!i&&O&&z.unshift(`const ${y} = ${h.indices}(${r.join(",")});`,`const ${g} = ${h.indices}(${Se.computeStrides(r).join(",")});`),z.join(`
`)},type:h,offsetToIndices:w,indicesToOffset:T,broadcastedIndicesToOffset:V,indices:S,indicesGet:k,indicesSet:$,set:(...z)=>{if(z.length!==o+1)throw new Error(`indices length must be ${o}`);let O=z[o];if(typeof O!="string")throw new Error("value must be string");let H=z.slice(0,o).map(f).join(",");return o===0?L("0u",O):o===1?L(H[0],O):(p.set=!0,p.setByIndices=!0,p.indicesToOffset=!0,`set_${t}(${H}, ${O})`)},setByOffset:L,setByIndices:(z,O)=>o<2?L(z,O):(p.setByIndices=!0,p.indicesToOffset=!0,`set_${t}ByIndices(${z}, ${O});`),get:J,getByOffset:X,getByIndices:N,usage:n,name:t,strides:g,shape:y,rank:o}},Ie=(t,e,r,n=1)=>jd(t,e,r,"input",n),dt=(t,e,r,n=1)=>jd(t,e,r,"output",n),k3=(t,e,r)=>jd(t,e,r,"atomicOutput",1),Cb=(t,e,r,n=1)=>jd(t,e,r,"internal",n),Fk=class{constructor(t,e){this.normalizedDispatchGroup=t,this.limits=e,this.internalVariables=[],this.variables=[],this.uniforms=[],this.variableIndex=0}guardAgainstOutOfBoundsWorkgroupSizes(t){return`if (global_idx >= ${typeof t=="number"?`${t}u`:t}) { return; }`}mainStart(t=ku){let e=typeof t=="number"?t:t[0],r=typeof t=="number"?1:t[1],n=typeof t=="number"?1:t[2];if(e>this.limits.maxComputeWorkgroupSizeX||r>this.limits.maxComputeWorkgroupSizeY||n>this.limits.maxComputeWorkgroupSizeZ)throw new Error(`workgroup size [${e}, ${r}, ${n}] exceeds the maximum workgroup size [${this.limits.maxComputeWorkgroupSizeX}, ${this.limits.maxComputeWorkgroupSizeY}, ${this.limits.maxComputeWorkgroupSizeZ}].`);if(e*r*n>this.limits.maxComputeInvocationsPerWorkgroup)throw new Error(`workgroup size [${e}, ${r}, ${n}] exceeds the maximum workgroup invocations ${this.limits.maxComputeInvocationsPerWorkgroup}.`);let s=this.normalizedDispatchGroup[1]===1&&this.normalizedDispatchGroup[2]===1,i=s?`@builtin(global_invocation_id) global_id : vec3<u32>,
    @builtin(workgroup_id) workgroup_id : vec3<u32>,
    @builtin(local_invocation_index) local_idx : u32,
    @builtin(local_invocation_id) local_id : vec3<u32>`:`@builtin(global_invocation_id) global_id : vec3<u32>,
                                             @builtin(local_invocation_id) local_id : vec3<u32>,
    @builtin(local_invocation_index) local_idx : u32,
    @builtin(workgroup_id) workgroup_id : vec3<u32>,
    @builtin(num_workgroups) num_workgroups : vec3<u32>`,o=s?`let global_idx = global_id.x;
         let workgroup_index = workgroup_id.x;`:`let workgroup_index = workgroup_id.z * num_workgroups[0] * num_workgroups[1] +
             workgroup_id.y * num_workgroups[0] + workgroup_id.x;
         let global_idx = workgroup_index * ${e*r*n}u + local_idx;`;return`@compute @workgroup_size(${e}, ${r}, ${n})
  fn main(${i}) {
    ${o}
  `}appendVariableUniforms(t){t.rank!==0&&(t.shape.startsWith("uniforms.")&&this.uniforms.push({name:t.shape.replace("uniforms.",""),type:"u32",length:t.rank}),t.strides.startsWith("uniforms.")&&this.uniforms.push({name:t.strides.replace("uniforms.",""),type:"u32",length:t.rank}))}declareVariable(t,e){if(t.usage==="internal")throw new Error("cannot use internal variable with declareVariable(). use registerInternalVariables() instead.");this.variables.push(t),this.appendVariableUniforms(t);let r=t.usage==="input"?"read":"read_write",n=t.usage==="atomicOutput"?"atomic<i32>":t.type.storage;return`@group(0) @binding(${e}) var<storage, ${r}> ${t.name}: array<${n}>;`}declareVariables(...t){return t.map(e=>this.declareVariable(e,this.variableIndex++)).join(`
`)}registerInternalVariable(t){if(t.usage!=="internal")throw new Error("cannot use input or output variable with registerInternalVariable(). use declareVariables() instead.");this.internalVariables.push(t),this.appendVariableUniforms(t)}registerInternalVariables(...t){return t.forEach(e=>this.registerInternalVariable(e)),this}registerUniform(t,e,r=1){return this.uniforms.push({name:t,type:e,length:r}),this}registerUniforms(t){return this.uniforms=this.uniforms.concat(t),this}uniformDeclaration(){if(this.uniforms.length===0)return"";let t=[];for(let{name:e,type:r,length:n}of this.uniforms)if(n&&n>4)r==="f16"?t.push(`@align(16) ${e}:array<mat2x4<${r}>, ${Math.ceil(n/8)}>`):t.push(`${e}:array<vec4<${r}>, ${Math.ceil(n/4)}>`);else{let s=n==null||n===1?r:`vec${n}<${r}>`;t.push(`${e}:${s}`)}return`
      struct Uniforms { ${t.join(", ")} };
      @group(0) @binding(${this.variableIndex}) var<uniform> uniforms: Uniforms;`}get additionalImplementations(){return this.uniformDeclaration()+this.variables.map(t=>t.impl()).join(`
`)+this.internalVariables.map(t=>t.impl()).join(`
`)}get variablesInfo(){if(this.uniforms.length===0)return;let t=e=>[12,10,1,6][["u32","f16","f32","i32"].indexOf(e)];return this.uniforms.map(e=>[t(e.type),e.length??1])}},A3=(t,e)=>new Fk(t,e)}),Lk,qy,Rk,jk,Nk,zk,Fs,$3,O3,Ka=Ke(()=>{St(),It(),Wr(),Ft(),Lk=(t,e)=>{if(!t||t.length!==1)throw new Error("Transpose requires 1 input.");if(e.length!==0&&e.length!==t[0].dims.length)throw new Error(`perm size ${e.length} does not match input rank ${t[0].dims.length}`)},qy=(t,e)=>e.length!==0?e:[...new Array(t).keys()].reverse(),Rk=(t,e)=>Se.sortBasedOnPerm(t,qy(t.length,e)),jk=(t,e,r,n)=>{let s=`fn perm(i: ${n.type.indices}) -> ${r.type.indices} {
    var a: ${r.type.indices};`;for(let i=0;i<e;++i)s+=`a[${t[i]}]=i[${i}];`;return s+="return a;}"},Nk=(t,e)=>{let r=[],n=[];for(let s=0;s<t.length;++s)t[s]!==1&&r.push(t[s]),t[e[s]]!==1&&n.push(e[s]);return{newShape:r,newPerm:n}},zk=(t,e)=>{let r=0;for(let n=0;n<t.length;++n)if(e[t[n]]!==1){if(t[n]<r)return!1;r=t[n]}return!0},Fs=(t,e)=>{let r=t.dataType,n=t.dims.length,s=qy(n,e),i=Rk(t.dims,s),o=t.dims,a=i,l=n<2||zk(s,t.dims),c;if(l)return c=p=>{let m=Ie("input",r,o,4),y=dt("output",r,a,4);return`
  ${p.registerUniform("output_size","u32").declareVariables(m,y)}
  ${p.mainStart()}
    ${p.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}
    output[global_idx] = input[global_idx];
  }`},{name:"TransposeCopy",shaderCache:{inputDependencies:["type"]},getRunData:()=>{let p=Se.size(i);return{outputs:[{dims:i,dataType:t.dataType}],dispatchGroup:{x:Math.ceil(p/64/4)},programUniforms:[{type:12,data:Math.ceil(p/4)}]}},getShaderSource:c};let{newShape:u,newPerm:d}=Nk(t.dims,s),h=Se.areEqual(d,[2,3,1]),f=Se.areEqual(d,[3,1,2]);if(u.length===2||h||f){o=h?[u[0],u[1]*u[2]]:f?[u[0]*u[1],u[2]]:u,a=[o[1],o[0]];let p=16;return c=m=>{let y=Ie("a",r,o.length),g=dt("output",r,a.length);return`
  ${m.registerUniform("output_size","u32").declareVariables(y,g)}
  var<workgroup> tile : array<array<${g.type.value}, ${p+1}>, ${p}>;
  ${m.mainStart([p,p,1])}
    let stride = (uniforms.output_shape[1] - 1) / ${p} + 1;
    let workgroup_id_x = workgroup_index % stride;
    let workgroup_id_y = workgroup_index / stride;
    let input_col = workgroup_id_y * ${p}u + local_id.x;
    let input_row = workgroup_id_x * ${p}u + local_id.y;
    if (input_row < uniforms.a_shape[0] && input_col < uniforms.a_shape[1]) {
      tile[local_id.y][local_id.x] = ${y.getByIndices(`${y.type.indices}(input_row, input_col)`)};
    }
    workgroupBarrier();

    let output_col = workgroup_id_x * ${p}u + local_id.x;
    let output_row = workgroup_id_y * ${p}u + local_id.y;
    if (output_row < uniforms.output_shape[0] && output_col < uniforms.output_shape[1]) {
      ${g.setByIndices(`${g.type.indices}(output_row, output_col)`,"tile[local_id.x][local_id.y]")}
    }
  }`},{name:"TransposeShared",shaderCache:{inputDependencies:["type"]},getRunData:()=>{let m=Se.size(i);return{outputs:[{dims:i,dataType:t.dataType}],dispatchGroup:{x:Math.ceil(a[1]/p),y:Math.ceil(a[0]/p)},programUniforms:[{type:12,data:m},...wt(o,a)]}},getShaderSource:c}}return c=p=>{let m=Ie("a",r,o.length),y=dt("output",r,a.length);return`
  ${p.registerUniform("output_size","u32").declareVariables(m,y)}

  ${jk(s,n,m,y)}

  ${p.mainStart()}
    ${p.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}

    let indices = ${y.offsetToIndices("global_idx")};
    let aIndices = perm(indices);

    ${y.setByOffset("global_idx",m.getByIndices("aIndices"))}
  }`},{name:"Transpose",shaderCache:{hint:`${e}`,inputDependencies:["rank"]},getRunData:()=>{let p=Se.size(i);return{outputs:[{dims:i,dataType:t.dataType}],dispatchGroup:{x:Math.ceil(p/64)},programUniforms:[{type:12,data:p},...wt(o,a)]}},getShaderSource:c}},$3=(t,e)=>{Lk(t.inputs,e.perm),t.compute(Fs(t.inputs[0],e.perm))},O3=t=>or({perm:t.perm})}),Bk,Vk,Wk,Uk,Gk,Hk,Kk,Xk,qk,Yk,mi,D3,I3,F3,L3,R3,j3,N3,z3,B3,V3,w9=Ke(()=>{St(),It(),Ft(),Sb(),Ka(),Bk={max:"select(bestValue, candidate, candidate > bestValue)",min:"select(bestValue, candidate, candidate < bestValue)",mean:"bestValue + candidate",sum:"bestValue + candidate",prod:"bestValue * candidate",sumSquare:"bestValue + candidate * candidate",logSumExp:"bestValue + exp(candidate)",l1:"bestValue + abs(candidate)",l2:"bestValue + candidate * candidate",logSum:"bestValue + candidate"},Vk={max:"select(bestValue, candidate, candidate > bestValue)",min:"select(bestValue, candidate, candidate < bestValue)",mean:"bestValue + candidate",sum:"bestValue + candidate",prod:"bestValue * candidate",sumSquare:"bestValue + candidate",logSumExp:"bestValue + candidate",l1:"bestValue + candidate",l2:"bestValue + candidate",logSum:"bestValue + candidate"},Wk={max:"_A[offset]",min:"_A[offset]",mean:"0",sum:"0",prod:"1",sumSquare:"0",logSumExp:"0",l1:"0",l2:"0",logSum:"0"},Uk={max:"bestValue",min:"bestValue",sum:"bestValue",prod:"bestValue",sumSquare:"bestValue",logSumExp:"log(bestValue)",l1:"bestValue",l2:"sqrt(bestValue)",logSum:"log(bestValue)"},Gk=(t,e)=>{let r=[];for(let n=e-t;n<e;++n)r.push(n);return r},Hk=(t,e)=>{let r=[],n=t.length;for(let i=0;i<n;i++)e.indexOf(i)===-1&&r.push(t[i]);let s=e.map(i=>t[i]);return[r,s]},Kk=(t,e)=>{let r=t.length+e.length,n=[],s=0;for(let i=0;i<r;i++)e.indexOf(i)===-1?n.push(t[s++]):n.push(1);return n},Xk=(t,e)=>{for(let r=0;r<t.length;++r)if(t[t.length-r-1]!==e-1-r)return!1;return!0},qk=(t,e)=>{let r=[];if(!Xk(t,e)){for(let n=0;n<e;++n)t.indexOf(n)===-1&&r.push(n);t.forEach(n=>r.push(n))}return r},Yk=(t,e,r,n,s,i,o)=>{let a=r[0].dims,l=Se.size(i),c=Se.size(o),u=Ie("_A",r[0].dataType,a),d=dt("output",s,i),h=64;l===1&&(h=256);let f=`
          var<workgroup> aBestValues : array<f32, ${h}>;
       `,p=m=>`
        ${m.registerUniform("reduceSize","u32").declareVariables(u,d)}
        ${f}
        fn DIV_CEIL(a : u32, b : u32) -> u32 {
          return ((a - 1u) / b + 1u);
         }
         ${m.mainStart(h)}

          let outputIndex = global_idx / ${h};
          let offset = outputIndex * uniforms.reduceSize;

          var bestValue = f32(${Wk[n]});
          let Length = uniforms.reduceSize;
          for (var k = local_idx; k < Length; k = k + ${h}) {
           let candidate = f32(${u.getByOffset("offset + k")});
           bestValue = ${Bk[n]};
          }
          aBestValues[local_idx] = bestValue;
          workgroupBarrier();

         var reduceSize = min(Length, ${h}u);
         for (var currentSize = reduceSize / 2u; reduceSize > 1u;
             currentSize = reduceSize / 2u) {
           let interval = DIV_CEIL(reduceSize, 2u);
           if (local_idx < currentSize) {
            let candidate = aBestValues[local_idx + interval];
            bestValue = ${Vk[n]};
            aBestValues[local_idx] = bestValue;
           }
           reduceSize = interval;
           workgroupBarrier();
         }

         if (local_idx == 0u) {
          ${d.setByOffset("outputIndex",`${n==="mean"?`${d.type.storage}(bestValue / f32(uniforms.reduceSize))`:`${d.type.storage}(${Uk[n]})`}`)};
         }
        }`;return{name:t,shaderCache:{hint:`${e};${h}`,inputDependencies:["type"]},getShaderSource:p,getRunData:()=>({outputs:[{dims:i,dataType:s}],dispatchGroup:{x:l},programUniforms:[{type:12,data:c}]})}},mi=(t,e,r,n)=>{let s=t.inputs.length===1?r:dx(t.inputs,r),i=s.axes;i.length===0&&!s.noopWithEmptyAxes&&(i=t.inputs[0].dims.map((f,p)=>p));let o=Se.normalizeAxes(i,t.inputs[0].dims.length),a=o,l=t.inputs[0],c=qk(a,t.inputs[0].dims.length);c.length>0&&(l=t.compute(Fs(t.inputs[0],c),{inputs:[0],outputs:[-1]})[0],a=Gk(a.length,l.dims.length));let[u,d]=Hk(l.dims,a),h=u;s.keepDims&&(h=Kk(u,o)),t.compute(Yk(e,s.cacheKey,[l],n,t.inputs[0].dataType,h,d),{inputs:[l]})},D3=(t,e)=>{mi(t,"ReduceMeanShared",e,"mean")},I3=(t,e)=>{mi(t,"ReduceL1Shared",e,"l1")},F3=(t,e)=>{mi(t,"ReduceL2Shared",e,"l2")},L3=(t,e)=>{mi(t,"ReduceLogSumExpShared",e,"logSumExp")},R3=(t,e)=>{mi(t,"ReduceMaxShared",e,"max")},j3=(t,e)=>{mi(t,"ReduceMinShared",e,"min")},N3=(t,e)=>{mi(t,"ReduceProdShared",e,"prod")},z3=(t,e)=>{mi(t,"ReduceSumShared",e,"sum")},B3=(t,e)=>{mi(t,"ReduceSumSquareShared",e,"sumSquare")},V3=(t,e)=>{mi(t,"ReduceLogSumShared",e,"logSum")}}),gi,Qk,Mg,dx,_i,Jk,Zk,eA,tA,rA,nA,sA,iA,oA,aA,yi,W3,U3,G3,H3,K3,X3,q3,Y3,Q3,J3,Sb=Ke(()=>{St(),It(),Wr(),Ft(),w9(),gi=t=>{if(!t||t.length===0||t.length>2)throw new Error("Reduce op requires 1 or 2 inputs.");if(t.length===2&&t[1].dims.length!==1)throw new Error("Invalid axes input dims.")},Qk=t=>["","",`var value = ${t.getByIndices("input_indices")};`,""],Mg=(t,e,r,n,s,i,o=!1,a=!1)=>{let l=[],c=r[0].dims,u=c.length,d=Se.normalizeAxes(s,u),h=!a&&d.length===0;c.forEach((m,y)=>{h||d.indexOf(y)>=0?o&&l.push(1):l.push(m)});let f=l.length,p=Se.size(l);return{name:t,shaderCache:e,getShaderSource:m=>{let y=[],g=Ie("_A",r[0].dataType,u),_=dt("output",i,f),v=n(g,_,d),w=v[2];for(let x=0,M=0;x<u;x++)h||d.indexOf(x)>=0?(o&&M++,w=`for(var j${x}: u32 = 0; j${x} < ${c[x]}; j${x}++) {
                  ${v[2].includes("last_index")?`let last_index = j${x};`:""}
                  ${g.indicesSet("input_indices",x,`j${x}`)}
                  ${w}
                }`):(y.push(`${g.indicesSet("input_indices",x,_.indicesGet("output_indices",M))};`),M++);return`

        ${m.registerUniform("output_size","u32").declareVariables(g,_)}

        ${m.mainStart()}
          ${m.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}
          var input_indices: ${g.type.indices};
          let output_indices = ${_.offsetToIndices("global_idx")};

          ${y.join(`
`)}
          ${v[0]}       // init ops for reduce max/min
          ${v[1]}
          ${w}
          ${v[3]}
          ${v.length===4?_.setByOffset("global_idx","value"):v.slice(4).join(`
`)}
        }`},getRunData:()=>({outputs:[{dims:l,dataType:i}],dispatchGroup:{x:Math.ceil(p/64)},programUniforms:[{type:12,data:p},...wt(c,l)]})}},dx=(t,e)=>{let r=[];return t[1].dims[0]>0&&t[1].getBigInt64Array().forEach(n=>r.push(Number(n))),or({axes:r,keepDims:e.keepDims,noopWithEmptyAxes:e.noopWithEmptyAxes})},_i=(t,e,r,n)=>{let s=t.inputs,i=s.length===1?r:dx(s,r);t.compute(Mg(e,{hint:i.cacheKey,inputDependencies:["rank"]},[s[0]],i.noopWithEmptyAxes&&i.axes.length===0?Qk:n,i.axes,s[0].dataType,i.keepDims,i.noopWithEmptyAxes),{inputs:[0]})},Jk=(t,e)=>{gi(t.inputs),_i(t,"ReduceLogSum",e,(r,n)=>[`var value = ${n.type.storage}(0);`,"",`value += ${r.getByIndices("input_indices")};`,"value = log(value);"])},Zk=(t,e)=>{gi(t.inputs),_i(t,"ReduceL1",e,(r,n)=>[`var value = ${n.type.storage}(0);`,"",`value += abs(${r.getByIndices("input_indices")});`,""])},eA=(t,e)=>{gi(t.inputs),_i(t,"ReduceL2",e,(r,n)=>[`var t = ${n.type.value}(0); var value = ${n.type.value}(0);`,"",`t = ${r.getByIndices("input_indices")}; value += (t * t);`,"value = sqrt(value);"])},tA=(t,e)=>{gi(t.inputs),_i(t,"ReduceLogSumExp",e,(r,n)=>[`var value = ${n.type.storage}(0);`,"",`value += exp(${r.getByIndices("input_indices")});`,"value = log(value);"])},rA=(t,e)=>{gi(t.inputs),_i(t,"ReduceMax",e,(r,n,s)=>{let i=[];for(let o=0;o<r.rank;o++)(s.indexOf(o)>=0||s.length===0)&&i.push(r.indicesSet("input_indices",o,0));return[`${i.join(`
`)}`,`var value = ${r.getByIndices("input_indices")};`,`value = max(value, ${r.getByIndices("input_indices")});`,""]})},nA=(t,e)=>{gi(t.inputs),_i(t,"ReduceMean",e,(r,n,s)=>{let i=1;for(let o=0;o<r.rank;o++)(s.indexOf(o)>=0||s.length===0)&&(i*=t.inputs[0].dims[o]);return["var sum = f32(0);","",`sum += f32(${r.getByIndices("input_indices")});`,`let value = ${n.type.value}(sum / ${i});`]})},sA=(t,e)=>{gi(t.inputs),_i(t,"ReduceMin",e,(r,n,s)=>{let i=[];for(let o=0;o<r.rank;o++)(s.indexOf(o)>=0||s.length===0)&&i.push(`input_indices[${o}] = 0;`);return[`${i.join(`
`)}`,`var value = ${r.getByIndices("input_indices")};`,`value = min(value, ${r.getByIndices("input_indices")});`,""]})},iA=(t,e)=>{gi(t.inputs),_i(t,"ReduceProd",e,(r,n)=>[`var value = ${n.type.storage}(1);`,"",`value *= ${r.getByIndices("input_indices")};`,""])},oA=(t,e)=>{gi(t.inputs),_i(t,"ReduceSum",e,(r,n)=>[`var value = ${n.type.storage}(0);`,"",`value += ${r.getByIndices("input_indices")};`,""])},aA=(t,e)=>{gi(t.inputs),_i(t,"ReduceSumSquare",e,(r,n)=>[`var t = ${n.type.value}(0); var value = ${n.type.value}(0);`,"",`t = ${r.getByIndices("input_indices")}; value += t * t;`,""])},yi=(t,e,r)=>{if(e.length===0)return r;let n=1,s=1;for(let i=0;i<e.length;i++)e.indexOf(i)===-1?n*=t[i]:s*=t[i];return s<32&&n>1024},W3=(t,e)=>{yi(t.inputs[0].dims,e.axes,e.noopWithEmptyAxes)?nA(t,e):D3(t,e)},U3=(t,e)=>{yi(t.inputs[0].dims,e.axes,e.noopWithEmptyAxes)?Zk(t,e):I3(t,e)},G3=(t,e)=>{yi(t.inputs[0].dims,e.axes,e.noopWithEmptyAxes)?eA(t,e):F3(t,e)},H3=(t,e)=>{yi(t.inputs[0].dims,e.axes,e.noopWithEmptyAxes)?tA(t,e):L3(t,e)},K3=(t,e)=>{yi(t.inputs[0].dims,e.axes,e.noopWithEmptyAxes)?rA(t,e):R3(t,e)},X3=(t,e)=>{yi(t.inputs[0].dims,e.axes,e.noopWithEmptyAxes)?sA(t,e):j3(t,e)},q3=(t,e)=>{yi(t.inputs[0].dims,e.axes,e.noopWithEmptyAxes)?iA(t,e):N3(t,e)},Y3=(t,e)=>{yi(t.inputs[0].dims,e.axes,e.noopWithEmptyAxes)?oA(t,e):z3(t,e)},Q3=(t,e)=>{yi(t.inputs[0].dims,e.axes,e.noopWithEmptyAxes)?aA(t,e):B3(t,e)},J3=(t,e)=>{yi(t.inputs[0].dims,e.axes,e.noopWithEmptyAxes)?Jk(t,e):V3(t,e)}}),Yy,Z3,ej,hx,x9=Ke(()=>{St(),Wr(),Sb(),Yy=t=>{if(!t||t.length===0||t.length>2)throw new Error("ArgMinMaxOp op requires 1 or 2 inputs.");if(t[0].dataType!==1)throw new Error("Invalid input type.")},Z3=(t,e)=>{Yy(t.inputs);let r=(n,s,i)=>{let o=[];for(let a=0;a<n.rank;a++)(i.indexOf(a)>=0||i.length===0)&&o.push(`input_indices[${a}] = 0;`);return[`${o.join(`
`)}`,`var value = ${n.getByIndices("input_indices")};
var best_index : i32 = 0;`,`if (${n.getByIndices("input_indices")} ${e.selectLastIndex>0?"<=":"<"} value) {
         value = ${n.getByIndices("input_indices")};
         best_index = i32(last_index);
       }`,"",s.setByOffset("global_idx","best_index")]};t.compute(Mg("ArgMin",{hint:e.cacheKey,inputDependencies:["rank"]},[t.inputs[0]],r,[e.axis],7,e.keepDims),{inputs:[0]})},ej=(t,e)=>{Yy(t.inputs);let r=(n,s,i)=>{let o=[];for(let a=0;a<n.rank;a++)(i.indexOf(a)>=0||i.length===0)&&o.push(`input_indices[${a}] = 0;`);return[`${o.join(`
`)}`,`var value = ${n.getByIndices("input_indices")};
var best_index : i32 = 0;`,`if (${n.getByIndices("input_indices")} ${e.selectLastIndex>0?">=":">"} value) {
         value = ${n.getByIndices("input_indices")};
         best_index = i32(last_index);
       }`,"",s.setByOffset("global_idx","best_index")]};t.compute(Mg("argMax",{hint:e.cacheKey,inputDependencies:["rank"]},[t.inputs[0]],r,[e.axis],7,e.keepDims),{inputs:[0]})},hx=t=>or(t)}),lA,Dp,cA,uA,dA,Vh,hA,tj,Eb=Ke(()=>{St(),It(),Tb(),Ft(),lA=(t,e)=>{let r=t[0],n=t[1],s=t[2],i=t[3],o=t[4],a=t[5];if(o&&a)throw new Error("Attention cannot have both past and attention_bias");if(r.dims.length!==3)throw new Error('Input "input" must have 3 dimensions');let l=r.dims[0],c=r.dims[1],u=r.dims[2];if(s.dims.length!==1)throw new Error('Input "bias" is expected to have 1 dimensions');if(n.dims.length!==2)throw new Error('Input "weights" is expected to have 2 dimensions');if(n.dims[0]!==u)throw new Error("Input 1 dimension 0 should have same length as dimension 2 of input 0");if(s.dims[0]!==n.dims[1])throw new Error('Input "bias" dimension 0 should have same length as dimension 1 of input "weights"');let d=s.dims[0]/3,h=d,f=h;if(e.qkvHiddenSizes.length>0){if(e.qkvHiddenSizes.length!==3)throw new Error("qkv_hidden_sizes attribute should have 3 elements");for(let v of e.qkvHiddenSizes)if(v%e.numHeads!==0)throw new Error("qkv_hidden_sizes should be divisible by num_heads");d=e.qkvHiddenSizes[0],h=e.qkvHiddenSizes[1],f=e.qkvHiddenSizes[2]}let p=c;if(d!==h)throw new Error("qkv_hidden_sizes first element should be same as the second");if(s.dims[0]!==d+h+f)throw new Error('Input "bias" dimension 0 should have same length as sum of Q/K/V hidden sizes');let m=0;if(o){if(h!==f)throw new Error('Input "past" expect k_hidden_size == v_hidden_size');if(o.dims.length!==5)throw new Error('Input "past" must have 5 dimensions');if(o.dims[0]!==2)throw new Error('Input "past" first dimension must be 2');if(o.dims[1]!==l)throw new Error('Input "past" second dimension must be batch_size');if(o.dims[2]!==e.numHeads)throw new Error('Input "past" third dimension must be num_heads');if(o.dims[4]!==h/e.numHeads)throw new Error('Input "past" fifth dimension must be k_hidden_size / num_heads');e.pastPresentShareBuffer||(m=o.dims[3])}let y=p+m,g=-1,_=0;if(i)throw new Error("Mask not supported");if(o)throw new Error("past is not supported");if(a){if(a.dims.length!==4)throw new Error('Input "attention_bias" must have 4 dimensions');if(a.dims[0]!==l||a.dims[1]!==e.numHeads||a.dims[2]!==c||a.dims[3]!==y)throw new Error('Expect "attention_bias" shape (batch_size, num_heads, sequence_length, total_sequence_length)')}return{batchSize:l,sequenceLength:c,pastSequenceLength:m,kvSequenceLength:p,totalSequenceLength:y,maxSequenceLength:g,inputHiddenSize:u,hiddenSize:d,vHiddenSize:f,headSize:Math.floor(d/e.numHeads),vHeadSize:Math.floor(f/e.numHeads),numHeads:e.numHeads,isUnidirectional:!1,pastPresentShareBuffer:!1,maskFilterValue:e.maskFilterValue,maskType:_,scale:e.scale,broadcastResPosBias:!1,passPastInKv:!1,qkvFormat:1}},Dp=(t,e,r)=>e&&t?`
      let total_sequence_length_input = u32(${e.getByOffset("0")});
      let present_sequence_length = max(total_sequence_length_input, uniforms.past_sequence_length);
      let is_subsequent_prompt: bool = sequence_length > 1 && sequence_length != total_sequence_length_input;
      let is_first_prompt: bool = is_subsequent_prompt == false && sequence_length == total_sequence_length_input;
      total_sequence_length = u32(${t==null?void 0:t.getByOffset("batchIdx")}) + 1;
      var past_sequence_length: u32 = 0;
      if (is_first_prompt == false) {
        past_sequence_length = total_sequence_length - sequence_length;
      }
       `:`
    ${r?"let past_sequence_length = uniforms.past_sequence_length":""};
    let present_sequence_length = total_sequence_length;
    `,cA=(t,e,r,n,s,i,o,a)=>{let l=Ir(o?1:i),c=64,u=i/l;u<c&&(c=32);let d=Math.ceil(i/l/c),h=[{type:12,data:e},{type:12,data:r},{type:12,data:n},{type:12,data:s},{type:12,data:u},{type:12,data:d}],f=wn(t.dataType,l),p=Wn(1,l),m=["type"];o&&m.push("type"),a&&m.push("type");let y=g=>{let _=dt("x",t.dataType,t.dims,l),v=[_],w=o?Ie("seq_lens",o.dataType,o.dims):void 0;w&&v.push(w);let x=a?Ie("total_sequence_length_input",a.dataType,a.dims):void 0;x&&v.push(x);let M=Wn(t.dataType),T=[{name:"batch_size",type:"u32"},{name:"num_heads",type:"u32"},{name:"past_sequence_length",type:"u32"},{name:"sequence_length",type:"u32"},{name:"total_sequence_length",type:"u32"},{name:"elements_per_thread",type:"u32"}];return`
  var<workgroup> thread_max: array<f32, ${c}>;
  var<workgroup> thread_sum: array<f32, ${c}>;
  ${g.registerUniforms(T).declareVariables(...v)}
  ${g.mainStart([c,1,1])}
    let batchIdx = workgroup_id.z / uniforms.num_heads;
    let headIdx = workgroup_id.z % uniforms.num_heads;
    let sequence_length = uniforms.sequence_length;
    var total_sequence_length = uniforms.total_sequence_length;
    ${Dp(w,x,!1)}
    let local_offset = local_idx * uniforms.elements_per_thread;
    let offset = (global_idx / ${c}) * uniforms.total_sequence_length + local_offset;
    let seq_causal_length = ${o?"u32(past_sequence_length + workgroup_id.y + 1)":"total_sequence_length"};
    var thread_max_vector = ${p}(-3.402823e+38f);
    for (var i: u32 = 0; i < uniforms.elements_per_thread && i + local_offset < seq_causal_length; i++) {
      thread_max_vector = max(${p}(x[offset + i]), thread_max_vector);
    }
    thread_max[local_idx] = ${(()=>{switch(l){case 1:return"thread_max_vector";case 2:return"max(thread_max_vector.x, thread_max_vector.y)";case 4:return"max(max(thread_max_vector.x, thread_max_vector.y), max(thread_max_vector.z, thread_max_vector.w))";default:throw new Error(`Unsupported components: ${l}`)}})()};
    workgroupBarrier();

    var max_value =  f32(-3.402823e+38f);
    for (var i = 0u; i < ${c}; i++) {
      max_value = max(thread_max[i], max_value);
    }

    var sum_vector = ${p}(0);
    for (var i: u32 = 0; i < uniforms.elements_per_thread && i + local_offset < seq_causal_length; i++) {
      sum_vector += exp(${p}(x[offset + i]) - max_value);
    }
    thread_sum[local_idx] = ${(()=>{switch(l){case 1:return"sum_vector";case 2:return"sum_vector.x + sum_vector.y";case 4:return"sum_vector.x + sum_vector.y + sum_vector.z + sum_vector.w";default:throw new Error(`Unsupported components: ${l}`)}})()};
    workgroupBarrier();

    var sum: f32 = 0;
    for (var i = 0u; i < ${c}; i++) {
      sum += thread_sum[i];
    }

    if (sum == 0) {
      for (var i: u32 = 0; i < uniforms.elements_per_thread && i + local_offset < seq_causal_length; i++) {
        x[offset + i] = ${_.type.value}(${M}(1.0) / ${M}(seq_causal_length));
      }
    } else {
      for (var i: u32 = 0; i < uniforms.elements_per_thread && i + local_offset < seq_causal_length; i++) {
        var f32input = ${p}(x[offset + i]);
        x[offset + i] = ${_.type.value}(exp(f32input - max_value) / sum);
      }
    }
      ${o?`
        for (var total_seq_id: u32 = seq_causal_length; total_seq_id + local_offset < uniforms.total_sequence_length; total_seq_id++) {
          x[offset + total_seq_id] = ${_.type.value}(${M}(0));
        }`:""};
  }`};return{name:"AttentionProbsSoftmax",shaderCache:{hint:`${c};${f};${l}`,inputDependencies:m},getShaderSource:y,getRunData:()=>({outputs:[],dispatchGroup:{x:1,y:s,z:e*r},programUniforms:h})}},uA=(t,e,r,n,s,i,o,a,l)=>{let c=o+i.kvSequenceLength,u=[i.batchSize,i.numHeads,i.sequenceLength,c],d=t>1&&n,h=i.kvNumHeads?i.kvNumHeads:i.numHeads,f=d?[i.batchSize,h,c,i.headSize]:void 0,p=i.nReps?i.nReps:1,m=i.scale===0?1/Math.sqrt(i.headSize):i.scale,y=Ir(i.headSize),g=i.headSize/y,_=12,v={x:Math.ceil(c/_),y:Math.ceil(i.sequenceLength/_),z:i.batchSize*i.numHeads},w=[{type:12,data:i.sequenceLength},{type:12,data:g},{type:12,data:c},{type:12,data:i.numHeads},{type:12,data:i.headSize},{type:1,data:m},{type:12,data:o},{type:12,data:i.kvSequenceLength},{type:12,data:p}],x=d&&n&&Se.size(n.dims)>0,M=["type","type"];x&&M.push("type"),s&&M.push("type"),a&&M.push("type"),l&&M.push("type");let T=[{dims:u,dataType:e.dataType,gpuDataType:0}];d&&T.push({dims:f,dataType:e.dataType,gpuDataType:0});let S=k=>{let $=Ie("q",e.dataType,e.dims,y),j=Ie("key",r.dataType,r.dims,y),V=[$,j];if(x){let ne=Ie("past_key",n.dataType,n.dims,y);V.push(ne)}s&&V.push(Ie("attention_bias",s.dataType,s.dims));let L=a?Ie("seq_lens",a.dataType,a.dims):void 0;L&&V.push(L);let X=l?Ie("total_sequence_length_input",l.dataType,l.dims):void 0;X&&V.push(X);let K=dt("output",e.dataType,u),Y=[K];d&&Y.push(dt("present_key",e.dataType,f,y));let J=Wn(1,y),N=[{name:"M",type:"u32"},{name:"K",type:"u32"},{name:"N",type:"u32"},{name:"num_heads",type:"u32"},{name:"head_size",type:"u32"},{name:"alpha",type:"f32"},{name:"past_sequence_length",type:"u32"},{name:"kv_sequence_length",type:"u32"},{name:"n_reps",type:"u32"}];return`
  const TILE_SIZE = ${_}u;

  var<workgroup> tileQ: array<${$.type.storage}, ${_*_}>;
  var<workgroup> tileK: array<${$.type.storage}, ${_*_}>;
  ${k.registerUniforms(N).declareVariables(...V,...Y)}
  ${k.mainStart([_,_,1])}
    // x holds the N and y holds the M
    let headIdx = workgroup_id.z % uniforms.num_heads;
    let kvHeadIdx = ${p===1?"headIdx":"headIdx / uniforms.n_reps"};
    let kv_num_heads = ${p===1?"uniforms.num_heads":"uniforms.num_heads / uniforms.n_reps"};
    let batchIdx = workgroup_id.z / uniforms.num_heads;
    let m = workgroup_id.y * TILE_SIZE;
    let n = workgroup_id.x * TILE_SIZE;
    let sequence_length = uniforms.M;
    var total_sequence_length = uniforms.N;
    ${Dp(L,X,!0)}
    let absKvHeadIdx = batchIdx * kv_num_heads + kvHeadIdx;
    let qOffset = workgroup_id.z * uniforms.M * uniforms.K + m * uniforms.K;
    ${x&&d?"let pastKeyOffset = absKvHeadIdx * uniforms.past_sequence_length * uniforms.K;":""};
    let kOffset = absKvHeadIdx * uniforms.kv_sequence_length * uniforms.K;
    ${d?"let presentKeyOffset = absKvHeadIdx * uniforms.N * uniforms.K;":""}
    var value = ${J}(0);
    for (var w: u32 = 0u; w < uniforms.K; w += TILE_SIZE) {
      if (global_id.y < uniforms.M && w + local_id.x < uniforms.K) {
        tileQ[TILE_SIZE * local_id.y + local_id.x] = q[qOffset + local_id.y * uniforms.K + w + local_id.x];
      }
      if (n + local_id.y < uniforms.N && w + local_id.x < uniforms.K) {
        var idx = TILE_SIZE * local_id.y + local_id.x;
      ${x&&d?`
              if (n + local_id.y < past_sequence_length) {
                tileK[idx] = past_key[pastKeyOffset + (n + local_id.y) * uniforms.K + w + local_id.x];
              } else if (n + local_id.y - past_sequence_length < uniforms.kv_sequence_length) {
                tileK[idx] = key[kOffset + (n + local_id.y - past_sequence_length) * uniforms.K + w + local_id.x];
              }`:`
          if (n + local_id.y < uniforms.kv_sequence_length) {
            tileK[idx] = key[kOffset + (n + local_id.y) * uniforms.K + w + local_id.x];
          }`}
      ${d?`if (n + local_id.y < present_sequence_length) {
        present_key[presentKeyOffset + (n + local_id.y) * uniforms.K + w + local_id.x] = tileK[idx];
      }`:""}
      }
      workgroupBarrier();

      for (var k: u32 = 0u; k < TILE_SIZE && w+k < uniforms.K; k++) {
          value += ${J}(tileQ[TILE_SIZE * local_id.y + k] * tileK[TILE_SIZE * local_id.x + k]);
      }

      workgroupBarrier();
    }

    if (global_id.y < uniforms.M && global_id.x < total_sequence_length) {
      let headOffset = workgroup_id.z * uniforms.M * uniforms.N;
      let outputIdx = headOffset + global_id.y * uniforms.N + global_id.x;
      var sum: f32 = ${(()=>{switch(y){case 1:return"value";case 2:return"value.x + value.y";case 4:return"value.x + value.y + value.z + value.w";default:throw new Error(`Unsupported components: ${y}`)}})()};
        output[outputIdx] = ${K.type.value} (sum * uniforms.alpha) + ${s?"attention_bias[outputIdx]":"0.0"};
    }
  }`};return{name:"AttentionProbs",shaderCache:{hint:`${y};${s!==void 0};${n!==void 0};${t}`,inputDependencies:M},getRunData:()=>({outputs:T,dispatchGroup:v,programUniforms:w}),getShaderSource:S}},dA=(t,e,r,n,s,i,o=void 0,a=void 0)=>{let l=i+s.kvSequenceLength,c=s.nReps?s.nReps:1,u=s.vHiddenSize*c,d=t>1&&n,h=s.kvNumHeads?s.kvNumHeads:s.numHeads,f=d?[s.batchSize,h,l,s.headSize]:void 0,p=[s.batchSize,s.sequenceLength,u],m=12,y={x:Math.ceil(s.vHeadSize/m),y:Math.ceil(s.sequenceLength/m),z:s.batchSize*s.numHeads},g=[{type:12,data:s.sequenceLength},{type:12,data:l},{type:12,data:s.vHeadSize},{type:12,data:s.numHeads},{type:12,data:s.headSize},{type:12,data:u},{type:12,data:i},{type:12,data:s.kvSequenceLength},{type:12,data:c}],_=d&&n&&Se.size(n.dims)>0,v=["type","type"];_&&v.push("type"),o&&v.push("type"),a&&v.push("type");let w=[{dims:p,dataType:e.dataType,gpuDataType:0}];d&&w.push({dims:f,dataType:e.dataType,gpuDataType:0});let x=M=>{let T=Ie("probs",e.dataType,e.dims),S=Ie("v",r.dataType,r.dims),k=[T,S];_&&k.push(Ie("past_value",n.dataType,n.dims));let $=o?Ie("seq_lens",o.dataType,o.dims):void 0;o&&k.push($);let j=a?Ie("total_sequence_length_input",a.dataType,a.dims):void 0;a&&k.push(j);let V=[dt("output",e.dataType,p)];d&&V.push(dt("present_value",e.dataType,f));let L=[{name:"M",type:"u32"},{name:"K",type:"u32"},{name:"N",type:"u32"},{name:"num_heads",type:"u32"},{name:"head_size",type:"u32"},{name:"v_hidden_size",type:"u32"},{name:"past_sequence_length",type:"u32"},{name:"kv_sequence_length",type:"u32"},{name:"n_reps",type:"u32"}];return`
  const TILE_SIZE = ${m}u;
  var<workgroup> tileQ: array<${T.type.value}, ${m*m}>;
  var<workgroup> tileV: array<${T.type.value}, ${m*m}>;
  ${M.registerUniforms(L).declareVariables(...k,...V)}
  ${M.mainStart([m,m,1])}
   let headIdx = workgroup_id.z % uniforms.num_heads;
   let batchIdx = workgroup_id.z / uniforms.num_heads;
   let kvHeadIdx = ${c===1?"headIdx":"headIdx / uniforms.n_reps"};
   let kv_num_heads = ${c===1?"uniforms.num_heads":"uniforms.num_heads / uniforms.n_reps"};
   let m = global_id.y;
   let n = global_id.x;
   let sequence_length = uniforms.M;
   var total_sequence_length = uniforms.K;
   ${Dp($,j,!0)}
   let offsetA = workgroup_id.z * uniforms.M * uniforms.K + m * uniforms.K;
   let absKvHeadIdx = batchIdx * kv_num_heads + kvHeadIdx; // kvHeadIdx is relative to the batch
   ${_&&d?"let pastValueOffset = absKvHeadIdx * uniforms.N * uniforms.past_sequence_length + n;":""};
   let vOffset = absKvHeadIdx * uniforms.N * uniforms.kv_sequence_length + n;
   ${d?"let presentValueOffset = absKvHeadIdx * uniforms.N * uniforms.K + n;":""}
   var value = ${T.type.storage}(0);
   for (var w: u32 = 0u; w < uniforms.K; w += TILE_SIZE) {
      if (m < uniforms.M && w + local_id.x < uniforms.K) {
        tileQ[TILE_SIZE * local_id.y + local_id.x] = probs[offsetA + w + local_id.x];
      }
      if (n < uniforms.N && w + local_id.y < uniforms.K) {
        var idx = TILE_SIZE * local_id.y + local_id.x;
        ${_&&d?`
        if (w + local_id.y < past_sequence_length) {
          tileV[idx] = past_value[pastValueOffset + (w + local_id.y) * uniforms.N];
        } else if (w + local_id.y - past_sequence_length < uniforms.kv_sequence_length) {
          tileV[idx] = v[vOffset + (w + local_id.y - past_sequence_length) * uniforms.N];
        }
      `:`
            if (w + local_id.y < uniforms.kv_sequence_length) {
              tileV[idx] = v[vOffset + (w + local_id.y) * uniforms.N];
            }`}
        ${d?`
            if (w + local_id.y < present_sequence_length) {
          present_value[presentValueOffset + (w + local_id.y) * uniforms.N] = tileV[idx];
        }`:""}
      }
     workgroupBarrier();
     for (var k: u32 = 0u; k < TILE_SIZE && w+k < total_sequence_length; k++) {
       value += tileQ[TILE_SIZE * local_id.y + k] * tileV[TILE_SIZE * k + local_id.x];
     }
     workgroupBarrier();
   }

   // we need to transpose output from BNSH_v to BSND_v
   if (m < uniforms.M && n < uniforms.N) {
     let outputIdx = batchIdx * uniforms.M * uniforms.v_hidden_size + m * uniforms.v_hidden_size
       + headIdx * uniforms.N + n;
     output[outputIdx] = value;
   }
  }`};return{name:"AttentionScore",shaderCache:{hint:`${n!==void 0};${t}`,inputDependencies:v},getRunData:()=>({outputs:w,dispatchGroup:y,programUniforms:g}),getShaderSource:x}},Vh=(t,e,r,n,s,i,o,a,l,c,u=void 0,d=void 0)=>{let h=Math.min(t.outputCount,1+(o?1:0)+(a?1:0)),f=h>1?c.pastSequenceLength:0,p=f+c.kvSequenceLength,m=l&&Se.size(l.dims)>0?l:void 0,y=[e,r];h>1&&o&&Se.size(o.dims)>0&&y.push(o),m&&y.push(m),u&&y.push(u),d&&y.push(d);let g=t.compute(uA(h,e,r,o,m,c,f,u,d),{inputs:y,outputs:h>1?[-1,1]:[-1]})[0];t.compute(cA(g,c.batchSize,c.numHeads,f,c.sequenceLength,p,u,d),{inputs:u&&d?[g,u,d]:[g],outputs:[]});let _=[g,n];h>1&&a&&Se.size(a.dims)>0&&_.push(a),u&&_.push(u),d&&_.push(d),t.compute(dA(h,g,n,a,c,f,u,d),{inputs:_,outputs:h>1?[0,2]:[0]})},hA=(t,e)=>{let r=[e.batchSize,e.numHeads,e.sequenceLength,e.headSize],n=e.sequenceLength,s=e.inputHiddenSize,i=e.headSize,o=12,a={x:Math.ceil(e.headSize/o),y:Math.ceil(e.sequenceLength/o),z:e.batchSize*e.numHeads},l=[t.inputs[0],t.inputs[1],t.inputs[2]],c=[{type:12,data:n},{type:12,data:s},{type:12,data:i},{type:12,data:e.numHeads},{type:12,data:e.headSize},{type:12,data:e.hiddenSize},{type:12,data:e.hiddenSize+e.hiddenSize+e.vHiddenSize}],u=d=>{let h=dt("output_q",l[0].dataType,r),f=dt("output_k",l[0].dataType,r),p=dt("output_v",l[0].dataType,r),m=Ie("input",l[0].dataType,l[0].dims),y=Ie("weight",l[1].dataType,l[1].dims),g=Ie("bias",l[2].dataType,l[2].dims),_=m.type.storage,v=[{name:"M",type:"u32"},{name:"K",type:"u32"},{name:"N",type:"u32"},{name:"num_heads",type:"u32"},{name:"head_size",type:"u32"},{name:"hidden_size",type:"u32"},{name:"ldb",type:"u32"}];return`
  const TILE_SIZE = ${o}u;
  var<workgroup> tileInput: array<${_}, ${o*o}>;
  var<workgroup> tileWeightQ: array<${_}, ${o*o}>;
  var<workgroup> tileWeightK: array<${_}, ${o*o}>;
  var<workgroup> tileWeightV: array<${_}, ${o*o}>;
  ${d.registerUniforms(v).declareVariables(m,y,g,h,f,p)}
  ${d.mainStart([o,o,1])}
    let batchIndex = workgroup_id.z / uniforms.num_heads;
    let headNumber = workgroup_id.z % uniforms.num_heads;
    let m = global_id.y;
    let n = global_id.x;

    let inputOffset = batchIndex * (uniforms.M * uniforms.K) + m * uniforms.K;
    let biasOffsetQ = headNumber * uniforms.head_size;
    let biasOffsetK = uniforms.hidden_size + biasOffsetQ;
    let biasOffsetV = uniforms.hidden_size + biasOffsetK;

    var valueQ = ${_}(0);
    var valueK = ${_}(0);
    var valueV = ${_}(0);
    for (var w: u32 = 0u; w < uniforms.K; w += TILE_SIZE) {
      if (m < uniforms.M && w + local_id.x < uniforms.K) {
        tileInput[TILE_SIZE * local_id.y + local_id.x] = input[inputOffset + w + local_id.x];
      }
      if (n < uniforms.N && w + local_id.y < uniforms.K) {
        let offset = n + (w + local_id.y) * uniforms.ldb;
        tileWeightQ[TILE_SIZE * local_id.y + local_id.x] = weight[biasOffsetQ + offset];
        tileWeightK[TILE_SIZE * local_id.y + local_id.x] = weight[biasOffsetK + offset];
        tileWeightV[TILE_SIZE * local_id.y + local_id.x] = weight[biasOffsetV + offset];
      }
      workgroupBarrier();
      for (var k: u32 = 0u; k<TILE_SIZE && w+k < uniforms.K; k++) {
        let inputTileOffset = TILE_SIZE * local_id.y + k;
        let weightTileOffset = TILE_SIZE * k + local_id.x;
        valueQ += tileInput[inputTileOffset] * tileWeightQ[weightTileOffset];
        valueK += tileInput[inputTileOffset] * tileWeightK[weightTileOffset];
        valueV += tileInput[inputTileOffset] * tileWeightV[weightTileOffset];
      }

      workgroupBarrier();
    }

    let headOffset = (m * uniforms.N + n) % uniforms.head_size;
    valueQ += bias[headOffset + biasOffsetQ];
    valueK += bias[headOffset + biasOffsetK];
    valueV += bias[headOffset + biasOffsetV];

    let offset = workgroup_id.z * uniforms.M * uniforms.N;
    if (m < uniforms.M && n < uniforms.N) {
      let outputIdx = offset + m * uniforms.N + n;
      output_q[outputIdx] = valueQ;
      output_k[outputIdx] = valueK;
      output_v[outputIdx] = valueV;
    }
  }`};return t.compute({name:"AttentionPrepare",shaderCache:{inputDependencies:["type","type","type"]},getRunData:()=>({outputs:[{dims:r,dataType:t.inputs[0].dataType,gpuDataType:0},{dims:r,dataType:t.inputs[0].dataType,gpuDataType:0},{dims:r,dataType:t.inputs[0].dataType,gpuDataType:0}],dispatchGroup:a,programUniforms:c}),getShaderSource:u},{inputs:l,outputs:[-1,-1,-1]})},tj=(t,e)=>{let r=lA(t.inputs,e),[n,s,i]=hA(t,r);return Vh(t,n,s,i,t.inputs[4],void 0,void 0,void 0,t.inputs[5],r)}}),fA,pA,mA,rj,b9=Ke(()=>{Vi(),St(),It(),Wr(),Ft(),fA=(t,e)=>{if(!t||t.length!==5)throw new Error("BatchNormalization requires 5 inputs");let r=(n,s,i)=>{let o=s.length;if(o!==n.length)throw new Error(`${i}: num dimensions != ${o}`);s.forEach((a,l)=>{if(a!==n[l])throw new Error(`${i}: dim[${l}] do not match`)})};if(t[0].dims.length>1){let n=e.format==="NHWC"?e.spatial?t[0].dims.slice(-1):t[0].dims.slice(-1).concat(t[0].dims.slice(1,t[0].dims.length-1)):t[0].dims.slice(1,e.spatial?2:void 0);r(t[1].dims,n,"Invalid input scale"),r(t[2].dims,n,"Invalid input B"),r(t[3].dims,n,"Invalid input mean"),r(t[4].dims,n,"Invalid input var")}else r(t[1].dims,[1],"Invalid input scale"),r(t[2].dims,[1],"Invalid input B"),r(t[3].dims,[1],"Invalid input mean"),r(t[4].dims,[1],"Invalid input var")},pA=(t,e)=>{let{epsilon:r,spatial:n,format:s}=e,i=t[0].dims,o=n?Ir(i[i.length-1]):1,a=s==="NHWC"&&i.length>1?o:1,l=Se.size(i)/o,c=n,u=c?i.length:i,d=Ie("x",t[0].dataType,t[0].dims,o),h=Ie("scale",t[1].dataType,t[1].dims,a),f=Ie("bias",t[2].dataType,t[2].dims,a),p=Ie("inputMean",t[3].dataType,t[3].dims,a),m=Ie("inputVar",t[4].dataType,t[4].dims,a),y=dt("y",t[0].dataType,u,o),g=()=>{let v="";if(n)v=`let cOffset = ${i.length===1?"0u":s==="NHWC"?`outputIndices[${i.length-1}] / ${o}`:"outputIndices[1]"};`;else if(s==="NCHW")v=`
            ${y.indicesSet("outputIndices","0","0")}
            let cOffset = ${y.indicesToOffset("outputIndices")};`;else{v=`var cIndices = ${h.type.indices}(0);
                       cIndices[0] = outputIndices[${i.length-1}];`;for(let w=1;w<h.rank;w++)v+=`cIndices[${w}] = outputIndices[${w}];`;v+=`let cOffset = ${h.indicesToOffset("cIndices")};`}return v},_=v=>`
  const epsilon = ${r};
  ${v.registerUniform("outputSize","u32").declareVariables(d,h,f,p,m,y)}
  ${v.mainStart()}
  ${v.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.outputSize")}
    var outputIndices = ${y.offsetToIndices(`global_idx * ${o}`)};
    ${g()}
    let scale = ${h.getByOffset("cOffset")};
    let bias = ${f.getByOffset("cOffset")};
    let inputMean = ${p.getByOffset("cOffset")};
    let inputVar = ${m.getByOffset("cOffset")};
    let x = ${d.getByOffset("global_idx")};
    let value = (x - inputMean) * inverseSqrt(inputVar + epsilon) * scale + bias;
    ${y.setByOffset("global_idx","value")}
  }`;return{name:"BatchNormalization",shaderCache:{hint:`${e.epsilon}_${e.format}_${n}_${o}`,inputDependencies:c?["rank","type","type","type","type"]:void 0},getShaderSource:_,getRunData:()=>({outputs:[{dims:t[0].dims,dataType:t[0].dataType}],dispatchGroup:{x:Math.ceil(l/64)},programUniforms:c?[{type:12,data:l},...wt(i)]:[{type:12,data:l}]})}},mA=t=>or(t),rj=(t,e)=>{let{inputs:r,outputCount:n}=t,s=mA({...e,outputCount:n});if(Mr.webgpu.validateInputContent&&fA(r,s),e.trainingMode)throw new Error("BatchNormalization trainingMode is not supported yet.");t.compute(pA(r,s))}}),gA,_A,nj,M9=Ke(()=>{It(),Ft(),gA=t=>{if(t[0].dims.length!==3)throw new Error("input should have 3 dimensions");if(![320,640,1280].includes(t[0].dims[2]))throw new Error("number of channels should be 320, 640 or 1280");if(t[1].dims.length!==1)throw new Error("bias is expected to have 1 dimensions");if(t[0].dims[2]!==t[1].dims[0])throw new Error("last dimension of input and bias are not the same")},_A=t=>{let e=t[0].dims,r=t[0].dims[2],n=Se.size(e)/4,s=t[0].dataType,i=Ie("input",s,e,4),o=Ie("bias",s,[r],4),a=Ie("residual",s,e,4),l=dt("output",s,e,4);return{name:"BiasAdd",getRunData:()=>({outputs:[{dims:e,dataType:t[0].dataType}],dispatchGroup:{x:Math.ceil(n/64)}}),getShaderSource:c=>`
  const channels = ${r}u / 4;
  ${c.declareVariables(i,o,a,l)}

  ${c.mainStart()}
    ${c.guardAgainstOutOfBoundsWorkgroupSizes(n)}
    let value = ${i.getByOffset("global_idx")}
      + ${o.getByOffset("global_idx % channels")} + ${a.getByOffset("global_idx")};
    ${l.setByOffset("global_idx","value")}
  }`}},nj=t=>{gA(t.inputs),t.compute(_A(t.inputs))}}),yA,er,sj,ij,oj,aj,lj,cj,uj,dj,hj,vA,fj,pj,mj,gj,Zd,_j,Fm,yj,vj,wj,xj,bj,Mj,Tj,Cj,Sj,Ej,Pj,kj,Aj,$j,Oj,Dj,Qy,Ij,fx,px,Fj,Lj,Rj,wA,xA,jj,Pb=Ke(()=>{St(),It(),Wr(),Ft(),yA=(t,e,r,n,s,i,o)=>{let a=Math.ceil(e/4),l="";typeof s=="string"?l=`${s}(a)`:l=s("a");let c=Ie("inputData",r,[a],4),u=dt("outputData",n,[a],4),d=[{name:"vec_size",type:"u32"}];return o&&d.push(...o),`
      ${t.registerUniforms(d).declareVariables(c,u)}

  ${i??""}

  ${t.mainStart()}
    ${t.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.vec_size")}

    let a = ${c.getByOffset("global_idx")};
    ${u.setByOffset("global_idx",l)}
  }`},er=(t,e,r,n,s,i=t.dataType,o,a)=>{let l=[{type:12,data:Math.ceil(Se.size(t.dims)/4)}];return o&&l.push(...o),{name:e,shaderCache:{hint:s,inputDependencies:["type"]},getShaderSource:c=>yA(c,Se.size(t.dims),t.dataType,i,r,n,a),getRunData:c=>({outputs:[{dims:t.dims,dataType:i}],dispatchGroup:{x:Math.ceil(Se.size(c[0].dims)/64/4)},programUniforms:l})}},sj=t=>{t.compute(er(t.inputs[0],"Abs","abs"))},ij=t=>{t.compute(er(t.inputs[0],"Acos","acos"))},oj=t=>{t.compute(er(t.inputs[0],"Acosh","acosh"))},aj=t=>{t.compute(er(t.inputs[0],"Asin","asin"))},lj=t=>{t.compute(er(t.inputs[0],"Asinh","asinh"))},cj=t=>{t.compute(er(t.inputs[0],"Atan","atan"))},uj=t=>{t.compute(er(t.inputs[0],"Atanh","atanh"))},dj=t=>or(t),hj=(t,e)=>{let r;switch(e.to){case 10:r="vec4<f16>";break;case 1:r="vec4<f32>";break;case 12:r="vec4<u32>";break;case 6:r="vec4<i32>";break;case 9:r="vec4<bool>";break;default:throw new RangeError(`not supported type (specified in attribute 'to' from 'Cast' operator): ${e.to}`)}t.compute(er(t.inputs[0],"Cast",r,void 0,e.cacheKey,e.to))},vA=t=>{let e,r,n=t.length>=2&&t[1].data!==0,s=t.length>=3&&t[2].data!==0;switch(t[0].dataType){case 1:e=n?t[1].getFloat32Array()[0]:-34028234663852886e22,r=s?t[2].getFloat32Array()[0]:34028234663852886e22;break;case 10:e=n?t[1].getUint16Array()[0]:64511,r=s?t[2].getUint16Array()[0]:31743;break;default:throw new Error("Unsupport data type")}return or({min:e,max:r})},fj=(t,e)=>{let r=e||vA(t.inputs),n=Wn(t.inputs[0].dataType);t.compute(er(t.inputs[0],"Clip",s=>`clamp(${s}, vec4<${n}>(uniforms.min), vec4<${n}>(uniforms.max))`,void 0,r.cacheKey,void 0,[{type:t.inputs[0].dataType,data:r.min},{type:t.inputs[0].dataType,data:r.max}],[{name:"min",type:n},{name:"max",type:n}]),{inputs:[0]})},pj=t=>{t.compute(er(t.inputs[0],"Ceil","ceil"))},mj=t=>{t.compute(er(t.inputs[0],"Cos","cos"))},gj=t=>{t.compute(er(t.inputs[0],"Cosh","cosh"))},Zd=t=>or(t),_j=(t,e)=>{let r=Wn(t.inputs[0].dataType);t.compute(er(t.inputs[0],"Elu",n=>`elu_vf32(${n})`,`
  const elu_alpha_ = ${r}(${e.alpha});

  fn elu_f32(a: ${r}) -> ${r} {
  return select((exp(a) - 1.0) * elu_alpha_, a, a >= 0.0);
  }

  fn elu_vf32(v: vec4<${r}>) -> vec4<${r}> {
  return vec4(elu_f32(v.x), elu_f32(v.y), elu_f32(v.z), elu_f32(v.w));
  }`,e.cacheKey))},Fm=(t="f32")=>`
const r0: ${t} = 0.3275911;
const r1: ${t} = 0.254829592;
const r2: ${t} = -0.284496736;
const r3: ${t} = 1.421413741;
const r4: ${t} = -1.453152027;
const r5: ${t} = 1.061405429;

fn erf_vf32(v: vec4<${t}>) -> vec4<${t}> {
  let absv = abs(v);
  let x = 1.0 / (1.0 + r0 * absv);
  return sign(v) * (1.0 - ((((r5 * x + r4) * x + r3) * x + r2) * x + r1) * x * exp(-absv * absv));
}`,yj=t=>{let e=Wn(t.inputs[0].dataType);t.compute(er(t.inputs[0],"Erf",r=>`erf_vf32(${r})`,Fm(e)))},vj=t=>{t.compute(er(t.inputs[0],"Exp","exp"))},wj=t=>{t.compute(er(t.inputs[0],"Floor","floor"))},xj=t=>{let e=Wn(t.inputs[0].dataType);t.compute(er(t.inputs[0],"Gelu",r=>`0.5 * ${r} * (1.0 + erf_vf32(${r} * 0.7071067811865475))`,Fm(e)))},bj=(t,e)=>{let r=Wn(t.inputs[0].dataType);t.compute(er(t.inputs[0],"LeakyRelu",n=>`select(leaky_relu_alpha_ * ${n}, ${n}, ${n} >= vec4<${r}>(0.0))`,`const leaky_relu_alpha_ = ${r}(${e.alpha});`,e.cacheKey))},Mj=t=>{t.compute(er(t.inputs[0],"Not",e=>`!${e}`))},Tj=t=>{t.compute(er(t.inputs[0],"Neg",e=>`-${e}`))},Cj=t=>{t.compute(er(t.inputs[0],"Reciprocal",e=>`1.0/${e}`))},Sj=t=>{let e=Wn(t.inputs[0].dataType);t.compute(er(t.inputs[0],"Relu",r=>`select(vec4<${e}>(0.0), ${r}, ${r} > vec4<${e}>(0.0))`))},Ej=t=>{t.compute(er(t.inputs[0],"Sigmoid",e=>`(1.0 / (1.0 + exp(-${e})))`))},Pj=t=>or(t),kj=(t,e)=>{let r=Wn(t.inputs[0].dataType);t.compute(er(t.inputs[0],"HardSigmoid",n=>`max(vec4<${r}>(0.0), min(vec4<${r}>(1.0), ${e.alpha} * ${n} + vec4<${r}>(${e.beta})))`,void 0,e.cacheKey))},Aj=t=>{t.compute(er(t.inputs[0],"Sin","sin"))},$j=t=>{t.compute(er(t.inputs[0],"Sinh","sinh"))},Oj=t=>{t.compute(er(t.inputs[0],"Sqrt","sqrt"))},Dj=t=>{t.compute(er(t.inputs[0],"Tan","tan"))},Qy=t=>`sign(${t}) * (1 - exp(-2 * abs(${t}))) / (1 + exp(-2 * abs(${t})))`,Ij=t=>{t.compute(er(t.inputs[0],"Tanh",Qy))},fx=(t="f32")=>`
const fast_gelu_a: ${t} = 0.5;
const fast_gelu_b: ${t} = 0.7978845608028654;
const fast_gelu_c: ${t} = 0.035677408136300125;

fn tanh_v(v: vec4<${t}>) -> vec4<${t}> {
  return ${Qy("v")};
}
`,px=t=>`(fast_gelu_a + fast_gelu_a * tanh_v(${t} * (fast_gelu_c * ${t} * ${t} + fast_gelu_b))) * ${t}`,Fj=t=>{let e=Wn(t.inputs[0].dataType);t.compute(er(t.inputs[0],"FastGelu",px,fx(e),void 0,t.inputs[0].dataType))},Lj=(t,e)=>{let r=Wn(t.inputs[0].dataType);return t.compute(er(t.inputs[0],"ThresholdedRelu",n=>`select(vec4<${r}>(0.0), ${n}, ${n} > thresholded_relu_alpha_)`,`const thresholded_relu_alpha_ = vec4<${r}>(${e.alpha});`,e.cacheKey)),0},Rj=t=>{t.compute(er(t.inputs[0],"Log","log"))},wA=(t,e)=>`
const alpha = vec4<${t}>(${e});
const one = ${t}(1.0);
const zero = ${t}(0.0);

fn quick_gelu_impl(x: vec4<${t}>) -> vec4<${t}> {
  let v = x *alpha;
  var x1 : vec4<${t}>;
  for (var i = 0; i < 4; i = i + 1) {
    if (v[i] >= zero) {
      x1[i] = one / (one + exp(-v[i]));
    } else {
      x1[i] = one - one / (one + exp(v[i]));
    }
  }
  return x * x1;
}
`,xA=t=>`quick_gelu_impl(${t})`,jj=(t,e)=>{let r=Wn(t.inputs[0].dataType);t.compute(er(t.inputs[0],"QuickGelu",xA,wA(r,e.alpha),e.cacheKey,t.inputs[0].dataType))}}),bA,MA,Nj,T9=Ke(()=>{It(),Ft(),Pb(),bA=t=>{if(t[0].dims.length!==3)throw new Error("input should have 3 dimensions");if(![2560,5120,10240].includes(t[0].dims[2]))throw new Error("hidden state should be 2560, 5120 or 10240");if(t[1].dims.length!==1)throw new Error("bias is expected to have 1 dimensions");if(t[0].dims[2]!==t[1].dims[0])throw new Error("last dimension of input and bias are not the same")},MA=t=>{let e=t[0].dims.slice();e[2]=e[2]/2;let r=Ie("input",t[0].dataType,t[0].dims,4),n=Ie("bias",t[0].dataType,[t[0].dims[2]],4),s=dt("output",t[0].dataType,e,4),i=Se.size(e)/4,o=wn(t[0].dataType);return{name:"BiasSplitGelu",getRunData:()=>({outputs:[{dims:e,dataType:t[0].dataType}],dispatchGroup:{x:Math.ceil(i/64)}}),getShaderSource:a=>`
  const M_SQRT2 = sqrt(2.0);
  const halfChannels = ${t[0].dims[2]/4/2}u;

  ${a.declareVariables(r,n,s)}

  ${Fm(o)}

  ${a.mainStart()}
    ${a.guardAgainstOutOfBoundsWorkgroupSizes(i)}
    let biasIdx = global_idx % halfChannels;
    let batchIndex = global_idx / halfChannels;
    let inputOffset = biasIdx + batchIndex * halfChannels * 2;
    let valueLeft = input[inputOffset] + bias[biasIdx];
    let valueRight = input[inputOffset + halfChannels] + bias[biasIdx + halfChannels];
    let geluRight = valueRight * 0.5 * (erf_vf32(valueRight / M_SQRT2) + 1);

    ${s.setByOffset("global_idx","valueLeft * geluRight")}
  }`}},Nj=t=>{bA(t.inputs),t.compute(MA(t.inputs))}}),TA,CA,vi,zj,Bj,Vj,Wj,Uj,Gj,Hj,Kj,Xj,qj,C9=Ke(()=>{St(),It(),Ft(),TA=(t,e,r,n,s,i,o,a,l,c,u,d)=>{let h,f;typeof a=="string"?h=f=(_,v)=>`${a}((${_}),(${v}))`:typeof a=="function"?h=f=a:(h=a.scalar,f=a.vector);let p=dt("outputData",u,n.length,4),m=Ie("aData",l,e.length,4),y=Ie("bData",c,r.length,4),g;if(s)if(i){let _=Se.size(e)===1,v=Se.size(r)===1,w=e.length>0&&e[e.length-1]%4===0,x=r.length>0&&r[r.length-1]%4===0;_||v?g=p.setByOffset("global_idx",f(_?`${m.type.value}(${m.getByOffset("0")}.x)`:m.getByOffset("global_idx"),v?`${y.type.value}(${y.getByOffset("0")}.x)`:y.getByOffset("global_idx"))):g=`
            let outputIndices = ${p.offsetToIndices("global_idx * 4u")};
            let offsetA = ${m.broadcastedIndicesToOffset("outputIndices",p)};
            let offsetB = ${y.broadcastedIndicesToOffset("outputIndices",p)};
            ${p.setByOffset("global_idx",f(o||w?m.getByOffset("offsetA / 4u"):`${m.type.value}(${m.getByOffset("offsetA / 4u")}[offsetA % 4u])`,o||x?y.getByOffset("offsetB / 4u"):`${y.type.value}(${y.getByOffset("offsetB / 4u")}[offsetB % 4u])`))}
          `}else g=p.setByOffset("global_idx",f(m.getByOffset("global_idx"),y.getByOffset("global_idx")));else{if(!i)throw new Error("no necessary to use scalar implementation for element-wise binary op implementation.");let _=(v,w,x="")=>{let M=`aData[indexA${w}][componentA${w}]`,T=`bData[indexB${w}][componentB${w}]`;return`
            let outputIndices${w} = ${p.offsetToIndices(`global_idx * 4u + ${w}u`)};
            let offsetA${w} = ${m.broadcastedIndicesToOffset(`outputIndices${w}`,p)};
            let offsetB${w} = ${y.broadcastedIndicesToOffset(`outputIndices${w}`,p)};
            let indexA${w} = offsetA${w} / 4u;
            let indexB${w} = offsetB${w} / 4u;
            let componentA${w} = offsetA${w} % 4u;
            let componentB${w} = offsetB${w} % 4u;
            ${v}[${w}] = ${x}(${h(M,T)});
          `};u===9?g=`
            var data = vec4<u32>(0);
            ${_("data",0,"u32")}
            ${_("data",1,"u32")}
            ${_("data",2,"u32")}
            ${_("data",3,"u32")}
            outputData[global_idx] = dot(vec4<u32>(0x1, 0x100, 0x10000, 0x1000000), vec4<u32>(data));`:g=`
            ${_("outputData[global_idx]",0)}
            ${_("outputData[global_idx]",1)}
            ${_("outputData[global_idx]",2)}
            ${_("outputData[global_idx]",3)}
          `}return`
        ${t.registerUniform("vec_size","u32").declareVariables(m,y,p)}

        ${d??""}

        ${t.mainStart()}
        ${t.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.vec_size")}
        ${g}
      }`},CA=(t,e,r,n,s,i,o=r.dataType)=>{let a=r.dims.map(m=>Number(m)??1),l=n.dims.map(m=>Number(m)??1),c=!Se.areEqual(a,l),u=a,d=Se.size(a),h=!1,f=!1,p=[c];if(c){let m=Pu.calcShape(a,l,!1);if(!m)throw new Error("Can't perform binary op on the given tensors");u=m.slice(),d=Se.size(u);let y=Se.size(a)===1,g=Se.size(l)===1,_=a.length>0&&a[a.length-1]%4===0,v=l.length>0&&l[l.length-1]%4===0;p.push(y),p.push(g),p.push(_),p.push(v);let w=1;for(let x=1;x<u.length;x++){let M=a[a.length-x],T=l[l.length-x];if(M===T)w*=M;else break}w%4===0?(f=!0,h=!0):(y||g||_||v)&&(h=!0)}else h=!0;return p.push(h),{name:t,shaderCache:{hint:e+p.map(m=>m.toString()).join("_"),inputDependencies:["rank","rank"]},getShaderSource:m=>TA(m,a,l,u,h,c,f,s,r.dataType,n.dataType,o,i),getRunData:()=>({outputs:[{dims:u,dataType:o}],dispatchGroup:{x:Math.ceil(d/64/4)},programUniforms:[{type:12,data:Math.ceil(Se.size(u)/4)},...wt(a,l,u)]})}},vi=(t,e,r,n,s,i)=>{t.compute(CA(e,s??"",t.inputs[0],t.inputs[1],r,n,i))},zj=t=>{vi(t,"Add",(e,r)=>`${e}+${r}`)},Bj=t=>{vi(t,"Div",(e,r)=>`${e}/${r}`)},Vj=t=>{vi(t,"Equal",{scalar:(e,r)=>`u32(${e}==${r})`,vector:(e,r)=>`vec4<u32>(${e}==${r})`},void 0,void 0,9)},Wj=t=>{vi(t,"Mul",(e,r)=>`${e}*${r}`)},Uj=t=>{let e=Ie("input",t.inputs[0].dataType,t.inputs[0].dims).type.value;vi(t,"Pow",{scalar:(r,n)=>`pow_custom(${r},${n})`,vector:(r,n)=>`pow_vector_custom(${r},${n})`},`
    fn pow_custom(a : ${e}, b : ${e}) -> ${e} {
      if (b == ${e}(0.0)) {
        return ${e}(1.0);
      } else if (a < ${e}(0.0) && f32(b) != floor(f32(b))) {
        return ${e}(pow(f32(a), f32(b))); // NaN
      }
      return select(sign(a), ${e}(1.0), round(f32(abs(b) % ${e}(2.0))) != 1.0) * ${e}(${e==="i32"?"round":""}(pow(f32(abs(a)), f32(b))));
    }
    fn pow_vector_custom(a : vec4<${e}>, b : vec4<${e}>) -> vec4<${e}> {
      // TODO: implement vectorized pow
      return vec4<${e}>(pow_custom(a.x, b.x), pow_custom(a.y, b.y), pow_custom(a.z, b.z), pow_custom(a.w, b.w));
    }
      `)},Gj=t=>{vi(t,"Sub",(e,r)=>`${e}-${r}`)},Hj=t=>{vi(t,"Greater",{scalar:(e,r)=>`u32(${e}>${r})`,vector:(e,r)=>`vec4<u32>(${e}>${r})`},void 0,void 0,9)},Kj=t=>{vi(t,"Less",{scalar:(e,r)=>`u32(${e}<${r})`,vector:(e,r)=>`vec4<u32>(${e}<${r})`},void 0,void 0,9)},Xj=t=>{vi(t,"GreaterOrEqual",{scalar:(e,r)=>`u32(${e}>=${r})`,vector:(e,r)=>`vec4<u32>(${e}>=${r})`},void 0,void 0,9)},qj=t=>{vi(t,"LessOrEqual",{scalar:(e,r)=>`u32(${e}<=${r})`,vector:(e,r)=>`vec4<u32>(${e}<=${r})`},void 0,void 0,9)}}),SA,EA,PA,kA,Yj,Qj,S9=Ke(()=>{St(),It(),Wr(),Ft(),SA=(t,e)=>{if(!t||t.length<1)throw new Error("too few inputs");let r=0,n=t[r],s=n.dataType,i=n.dims.length;t.forEach((o,a)=>{if(a!==r){if(o.dataType!==s)throw new Error("input tensors should be one type");if(o.dims.length!==i)throw new Error("input tensors should have the same shape");o.dims.forEach((l,c)=>{if(c!==e&&l!==n.dims[c])throw new Error("non concat dimensions must match")})}})},EA=(t,e)=>`
  fn calculateInputIndex(index: u32) -> u32 {
    let sizeInConcatAxis = array<u32, ${t}u>(${e});
    for (var i: u32 = 0u; i < ${t}; i += 1u ) {
      if (index < sizeInConcatAxis[i]) {
        return i;
      }
    }
    return ${t}u;
  }`,PA=(t,e)=>{let r=t.length,n=[];for(let s=0;s<r;++s){let i=e.setByOffset("global_idx",t[s].getByIndices("indices"));r===1?n.push(i):s===0?n.push(`if (inputIndex == ${s}u) { ${i} }`):s===r-1?n.push(`else { ${i} }`):n.push(`else if (inputIndex == ${s}) { ${i} }`)}return n.join(`
`)},kA=(t,e,r,n)=>{let s=Se.size(r),i=new Array(t.length),o=new Array(t.length),a=0,l=[],c=[],u=[{type:12,data:s}];for(let m=0;m<t.length;++m)a+=t[m].dims[e],i[m]=a,c.push(t[m].dims.length),o[m]=Ie(`input${m}`,n,c[m]),l.push("rank"),u.push({type:12,data:i[m]});for(let m=0;m<t.length;++m)u.push(...wt(t[m].dims));u.push(...wt(r));let d=dt("output",n,r.length),h=d.indicesGet("indices",e),f=Array.from(Array(i.length).keys()).map(m=>`uniforms.sizeInConcatAxis${m}`).join(","),p=m=>`

  ${(()=>{m.registerUniform("outputSize","u32");for(let y=0;y<t.length;y++)m.registerUniform(`sizeInConcatAxis${y}`,"u32");return m.declareVariables(...o,d)})()}

  ${EA(i.length,f)}

  ${m.mainStart()}
    ${m.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.outputSize")}

    var indices = ${d.offsetToIndices("global_idx")};

    let inputIndex = calculateInputIndex(${h});
    if (inputIndex != 0u) {
      let sizeInConcatAxis = array<u32, ${i.length}u>(${f});
      ${h} -= sizeInConcatAxis[inputIndex - 1u];
    }

    ${PA(o,d)}
  }`;return{name:"Concat",shaderCache:{hint:`${e}`,inputDependencies:l},getRunData:()=>({outputs:[{dims:r,dataType:n}],dispatchGroup:{x:Math.ceil(s/64)},programUniforms:u}),getShaderSource:p}},Yj=(t,e)=>{let r=t.inputs,n=r[0].dims,s=Se.normalizeAxis(e.axis,n.length);SA(r,s);let i=n.slice();i[s]=r.reduce((a,l)=>a+(l.dims.length>s?l.dims[s]:0),0);let o=r.filter(a=>Se.size(a.dims)>0);t.compute(kA(o,s,i,r[0].dataType),{inputs:o})},Qj=t=>or({axis:t.axis})}),Ql,Jl,Zl,kb,oc=Ke(()=>{St(),It(),Ql=(t,e,r="f32")=>{switch(t.activation){case"Relu":return`value = max(value, ${e}(0.0));`;case"Sigmoid":return`value = (${e}(1.0) / (${e}(1.0) + exp(-value)));`;case"Clip":return`value = clamp(value, ${e}(${r}(uniforms.clip_min)), ${e}(${r}(uniforms.clip_max)));`;case"HardSigmoid":return`value = max(${e}(0.0), min(${e}(1.0), ${r}(uniforms.alpha) * value + ${r}(uniforms.beta)));`;case"LeakyRelu":return`value = select(${r}(uniforms.alpha) * value, value, value >= ${e}(0.0));`;case"Tanh":return`let e2x = exp(-2.0 * abs(value));
              value = sign(value) * (1.0 - e2x) / (1.0 + e2x);
        `;case"":return"";default:throw new Error(`Unsupported activation ${t.activation}`)}},Jl=(t,e)=>{t.activation==="Clip"?e.push({type:1,data:t.clipMax},{type:1,data:t.clipMin}):t.activation==="HardSigmoid"?e.push({type:1,data:t.alpha},{type:1,data:t.beta}):t.activation==="LeakyRelu"&&e.push({type:1,data:t.alpha})},Zl=(t,e)=>{t.activation==="Clip"?e.push({name:"clip_max",type:"f32"},{name:"clip_min",type:"f32"}):t.activation==="HardSigmoid"?e.push({name:"alpha",type:"f32"},{name:"beta",type:"f32"}):t.activation==="LeakyRelu"&&e.push({name:"alpha",type:"f32"})},kb=t=>{let e=(t==null?void 0:t.activation)||"";if(e==="HardSigmoid"){let[r,n]=(t==null?void 0:t.activation_params)||[.2,.5];return{activation:e,alpha:r,beta:n}}else if(e==="Clip"){let[r,n]=(t==null?void 0:t.activation_params)||[M3,T3];return{activation:e,clipMax:n,clipMin:r}}else if(e==="LeakyRelu"){let[r]=(t==null?void 0:t.activation_params)||[.01];return{activation:e,alpha:r}}return{activation:e}}}),Sn,Jj,Ab=Ke(()=>{Sn=(t,e)=>{switch(t){case 1:return e;case 2:return`vec2<${e}>`;case 3:return`vec3<${e}>`;case 4:return`vec4<${e}>`;default:throw new Error(`${t}-component is not supported.`)}},Jj=t=>`
      ${t?"value = value + getBiasByOutputCoords(coords);":""}
      `}),Zj,E9=Ke(()=>{Zj=t=>`
fn getIndexFromCoords4D(coords : vec4<i32>, shape : vec4<i32>) -> i32 {
  return dot(coords, vec4<i32>(
      shape.y * shape.z * shape.w, shape.z * shape.w, shape.w, 1));
}
fn getOutputIndexFromCoords(coords : vec4<i32>) -> i32 {
  return dot(coords, vec4<i32>(
    i32(${t}.x), i32(${t}.y), i32(${t}.z), 1));
}
`}),fh,$b,Ob=Ke(()=>{St(),It(),Ft(),oc(),fh=(t,e,r,n,s)=>{let i=n-r;return`
      ${Array.from({length:r}).map((o,a)=>`
      if (${gt(e.shape,a,e.rank)} != 1) {
        ${e.indicesSet(t,a,gt(s,a+i,n))}
      } else {
        ${e.indicesSet(t,a,0)}
      }`).join("")}
`},$b=(t,e,r,n,s=!1,i)=>{let o=t[0].dims,a=t[1].dims,l=o[o.length-2],c=a[a.length-1],u=o[o.length-1],d=Ir(c),h=Ir(u),f=Ir(l),p=Se.size(r)/d/f,m=t.length>2,y=n?n.slice(0,-2):r.slice(0,-2),g=[Se.size(y),l,c],_=[{type:12,data:p},{type:12,data:l},{type:12,data:c},{type:12,data:u}];Jl(e,_),_.push(...wt(y,o,a)),m&&_.push(...wt(t[2].dims)),_.push(...wt(g));let v=w=>{let x=Cb("batch_dims",t[0].dataType,y.length),M=Ie("a",t[0].dataType,o.length,h),T=Ie("b",t[1].dataType,a.length,d),S=dt("output",t[0].dataType,g.length,d),k=wn(S.type.tensor),$=Ql(e,S.type.value,k),j=[M,T],V="";if(m){let K=s?d:1;j.push(Ie("bias",t[2].dataType,t[2].dims.length,K)),V=`${s?`value += bias[col / ${K}];`:`value += ${S.type.value}(bias[row + i]);`}`}let L=[{name:"output_size",type:"u32"},{name:"M",type:"u32"},{name:"N",type:"u32"},{name:"K",type:"u32"}];Zl(e,L);let X=()=>{let K=`var a_data: ${M.type.value};`;for(let Y=0;Y<h;Y++)K+=`
              let b_data${Y} = b[(b_offset + (k + ${Y}) * uniforms.N + col) / ${d}];`;for(let Y=0;Y<f;Y++){K+=`a_data = a[(a_offset + (row + ${Y}) * uniforms.K + k) / ${h}];`;for(let J=0;J<h;J++)K+=`
            values[${Y}] = fma(${T.type.value}(a_data${h===1?"":`[${J}]`}), b_data${J}, values[${Y}]);
`}return K};return`
  ${w.registerUniforms(L).registerInternalVariables(x).declareVariables(...j,S)}
  ${w.mainStart()}
    ${w.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}
    let col = (global_idx % (uniforms.N / ${d})) * ${d};
    var index1 = global_idx / (uniforms.N / ${d});
    let stride1 = uniforms.M / ${f};
    let row = (index1 % stride1) * ${f};
    let batch = index1 / stride1;

    ${r.length===2?"":`let batch_indices = ${x.offsetToIndices("batch")};`}

    var a_indices: ${M.type.indices};
    ${fh("a_indices",M,M.rank-2,x.rank,"batch_indices")}
    ${M.indicesSet("a_indices",M.rank-2,0)}
    ${M.indicesSet("a_indices",M.rank-1,0)}
    let a_offset = ${M.indicesToOffset("a_indices")};

    var b_indices: ${T.type.indices};
    ${fh("b_indices",T,T.rank-2,x.rank,"batch_indices")}
    ${T.indicesSet("b_indices",T.rank-2,0)}
    ${T.indicesSet("b_indices",T.rank-1,0)}
    let b_offset = ${T.indicesToOffset("b_indices")};
    var values: array<${S.type.value}, ${f}>;
    for (var k: u32 = 0u; k < uniforms.K; k = k + ${h}) {
      ${X()}
    }
    for (var i = 0u; i < ${f}u; i++) {
      var value = values[i];
      ${V}
      ${$}
      let cur_indices = ${S.type.indices}(batch, row + i, col);
      let offset = ${S.indicesToOffset("cur_indices")};
      ${S.setByOffset(`offset / ${d}`,"value")};
    }
  }
  `};return{name:"MatMulNaive",shaderCache:{hint:`${e.activation};${d};${h};${f};${s}`,inputDependencies:m?["rank","rank","rank"]:["rank","rank"]},getRunData:()=>({outputs:[{dims:i?i(r):r,dataType:t[0].dataType}],dispatchGroup:{x:Math.ceil(p/64)},programUniforms:_}),getShaderSource:v}}}),AA,$A,mx,Jy,OA,gx,DA,Tg,Db=Ke(()=>{St(),It(),Ft(),oc(),Ob(),Ab(),AA=(t,e)=>t?`
        mm_Asub[inputRow][inputCol] = mm_readA(batch,
          kStart + inputRow,
          globalRowStart / innerElementSize + inputCol${e?", batchIndices":""});
        `:`
        mm_Asub[inputRow][inputCol] = mm_readA(batch,
          globalRow + innerRow,
          kStart / innerElementSize + inputCol${e?", batchIndices":""});
        `,$A=(t,e)=>t?`
        let ACached0 = mm_Asub[k * innerElementSize][localRow];
        let ACached1 = mm_Asub[k * innerElementSize + 1][localRow];
        let ACached2 = mm_Asub[k * innerElementSize + 2][localRow];
        ${e===3?"":"let ACached3 = mm_Asub[k * innerElementSize + 3][localRow];"}
        for (var i = 0; i < rowPerThread; i = i + 1) {
          acc[i] = BCached0 * ACached0[i] + acc[i];
          acc[i] = BCached1 * ACached1[i] + acc[i];
          acc[i] = BCached2 * ACached2[i] + acc[i];
          ${e===3?"":"acc[i] = BCached3 * ACached3[i] + acc[i];"}
        }`:`
        for (var i = 0; i < rowPerThread; i = i + 1) {
          let ACached = mm_Asub[tileRow + i][k];
          acc[i] = BCached0 * ACached.x + acc[i];
          acc[i] = BCached1 * ACached.y + acc[i];
          acc[i] = BCached2 * ACached.z + acc[i];
          ${e===3?"":"acc[i] = BCached3 * ACached.w + acc[i];"}
        }`,mx=(t,e,r="f32",n,s=!1,i=32,o=!1,a=32)=>{let l=e[1]*t[1],c=e[0]*t[0],u=s?l:i,d=s?i:l,h=u/e[0],f=i/e[1];if(!((s&&h===4&&t[1]===4||!s&&(h===3||h===4))&&u%e[0]===0&&i%e[1]===0&&t[0]===4))throw new Error(`If transposeA ${s} is true, innerElementSize ${h} and workPerThread[1] ${t[1]} must be 4.
      Otherwise, innerElementSize ${h} must be 3 or 4.
  tileAWidth ${u} must be divisible by workgroupSize[0]${e[0]}. tileInner ${i} must be divisible by workgroupSize[1] ${e[1]}. colPerThread ${t[0]} must be 4.`);return`
var<workgroup> mm_Asub: array<array<vec${h}<${r}>, ${u/h}>, ${d}>;
var<workgroup> mm_Bsub: array<array<vec4<${r}>, ${c/t[0]}>, ${i}>;

const rowPerThread = ${t[1]};
const colPerThread = ${t[0]};
const innerElementSize = ${h};
const tileInner = ${i};

@compute @workgroup_size(${e[0]}, ${e[1]}, ${e[2]})
fn main(@builtin(local_invocation_id) localId : vec3<u32>,
        @builtin(global_invocation_id) globalId : vec3<u32>,
        @builtin(workgroup_id) workgroupId : vec3<u32>) {
  let localRow = i32(localId.y);
  let tileRow = localRow * rowPerThread;
  let tileCol = i32(localId.x);

  let globalRow =i32(globalId.y) * rowPerThread;
  let globalCol = i32(globalId.x);
  let batch = ${o?"0":"i32(globalId.z)"};
  ${n?`let batchIndices = ${n.offsetToIndices("u32(batch)")};`:""}
  let globalRowStart = i32(workgroupId.y) * ${l};

  let num_tiles = ${o?`${Math.ceil(a/i)}`:"(uniforms.dim_inner - 1) / tileInner + 1"};
  var kStart = ${o?`i32(globalId.z) * ${a}`:"0"};

  var acc: array<vec4<${r}>, rowPerThread>;

  // Loop over shared dimension.
  let tileRowB = localRow * ${f};
  for (var t = 0; t < num_tiles; t = t + 1) {
      // Load one tile of A into local memory.
      for (var innerRow = 0; innerRow < rowPerThread; innerRow = innerRow + 1) {
          let inputRow = tileRow + innerRow;
          let inputCol = tileCol;
          ${AA(s,n)}
      }

      // Load one tile of B into local memory.
      for (var innerRow = 0; innerRow < ${f}; innerRow = innerRow + 1) {
          let inputRow = tileRowB + innerRow;
          let inputCol = tileCol;
          mm_Bsub[inputRow][inputCol] = mm_readB(batch, kStart + inputRow, globalCol${n?", batchIndices":""});
      }
      kStart = kStart + tileInner;
      workgroupBarrier();

      // Compute acc values for a single thread.
      for (var k = 0; k < tileInner / innerElementSize; k = k + 1) {
          let BCached0 = mm_Bsub[k * innerElementSize][tileCol];
          let BCached1 = mm_Bsub[k * innerElementSize + 1][tileCol];
          let BCached2 = mm_Bsub[k * innerElementSize + 2][tileCol];
          ${h===3?"":"let BCached3 = mm_Bsub[k * innerElementSize + 3][tileCol];"}

          ${$A(s,h)}
      }

      workgroupBarrier();
  }

  for (var innerRow = 0; innerRow < rowPerThread; innerRow = innerRow + 1) {
      mm_write(batch, globalRow + innerRow, globalCol, acc[innerRow]);
  }
}`},Jy=(t,e)=>t?`
            mm_Asub[inputRow][inputCol] = mm_readA(batch,
              kStart + inputRow,
              globalRowStart + inputCol${e?", batchIndices":""});
            `:`
            mm_Asub[inputRow][inputCol] = mm_readA(batch,
              globalRowStart + inputRow,
              kStart + inputCol${e?", batchIndices":""});
            `,OA=t=>t?"let ACached = mm_Asub[k][tileRow + innerRow];":"let ACached = mm_Asub[tileRow + innerRow][k];",gx=(t,e,r="f32",n,s=!1,i=32,o=!1,a=32,l=!1)=>{let c=t[1]*e[1],u=t[0]*e[0],d=s?c:i,h=s?i:c;if(!(h%e[1]===0&&d%e[0]===0&&i%e[1]===0))throw new Error(`tileAHight ${h} must be divisible by workgroupSize[1]${e[1]}, tileAWidth ${d} must be divisible by workgroupSize[0]${e[0]}, tileInner ${i} must be divisible by workgroupSize[1]${e[1]}`);let f=h/e[1],p=d/e[0],m=i/e[1],y=l?`
    let localRow = i32(localId.y);
    let localCol = i32(localId.x);
    let globalRowStart = i32(workgroupId.y) * ${c};
    let globalColStart = i32(workgroupId.x) * ${u};

    // Loop over shared dimension.
    for (var t = 0; t < num_tiles; t = t + 1) {
      // Load one tile of A into local memory.
      for (var inputRow = localRow; inputRow < ${h}; inputRow = inputRow + ${e[1]}) {
        for (var inputCol = localCol; inputCol < ${d}; inputCol = inputCol + ${e[0]}) {
          ${Jy(s,n)}
        }
      }
      // Load one tile of B into local memory.
      for (var inputRow = localRow; inputRow < ${i}; inputRow = inputRow + ${e[1]}) {
            for (var inputCol = localCol; inputCol < ${u}; inputCol = inputCol + ${e[0]}) {
          mm_Bsub[inputRow][inputCol] = mm_readB(batch,
            kStart + inputRow,
            globalColStart + inputCol${n?", batchIndices":""});
        }
      }
      kStart = kStart + tileInner;
      workgroupBarrier();

      // Compute acc values for a single thread.
      var BCached : array<${r}, colPerThread>;
      for (var k = 0; k < tileInner; k = k + 1) {
        for (var inner = 0; inner < colPerThread; inner = inner + 1) {
          BCached[inner] = mm_Bsub[k][localCol + inner * ${e[0]}];
        }
        for (var innerRow = 0; innerRow < rowPerThread; innerRow = innerRow + 1) {
          let ACached = ${s?`mm_Asub[k][localRow + innerRow * ${e[1]}];`:`mm_Asub[localRow + innerRow * ${e[1]}][k];`}
          for (var innerCol = 0; innerCol < colPerThread; innerCol = innerCol + 1) {
            acc[innerRow][innerCol] = acc[innerRow][innerCol] +
                ACached * BCached[innerCol];
          }
        }
      }
      workgroupBarrier();
    }
    for (var innerRow = 0; innerRow < rowPerThread; innerRow = innerRow + 1) {
      let gRow = globalRowStart + localRow + innerRow * ${e[1]};
      for (var innerCol = 0; innerCol < colPerThread; innerCol = innerCol + 1) {
        let gCol = globalColStart + localCol + innerCol * ${e[0]};
        mm_write(batch, gRow, gCol, acc[innerRow][innerCol]);
      }
    }
    `:`
let tileRow = i32(localId.y) * rowPerThread;
let tileCol = i32(localId.x) * colPerThread;

let globalRow = i32(globalId.y) * rowPerThread;
let globalCol = i32(globalId.x) * colPerThread;
let globalRowStart = i32(workgroupId.y) * ${c};

let tileRowA = i32(localId.y) * ${f};
let tileColA = i32(localId.x) * ${p};
let tileRowB = i32(localId.y) * ${m};
// Loop over shared dimension.
for (var t = 0; t < num_tiles; t = t + 1) {
  // Load one tile of A into local memory.
  for (var innerRow = 0; innerRow < ${f}; innerRow = innerRow + 1) {
    for (var innerCol = 0; innerCol < ${p}; innerCol = innerCol + 1) {
      let inputRow = tileRowA + innerRow;
      let inputCol = tileColA + innerCol;
      ${Jy(s,n)}
    }
  }

  // Load one tile of B into local memory.
  for (var innerRow = 0; innerRow < ${m}; innerRow = innerRow + 1) {
    for (var innerCol = 0; innerCol < colPerThread; innerCol = innerCol + 1) {
      let inputRow = tileRowB + innerRow;
      let inputCol = tileCol + innerCol;
      mm_Bsub[inputRow][inputCol] = mm_readB(batch,
        kStart + inputRow,
        globalCol + innerCol${n?", batchIndices":""});
    }
  }
  kStart = kStart + tileInner;
  workgroupBarrier();

  // Compute acc values for a single thread.
  var BCached : array<${r}, colPerThread>;
  for (var k = 0; k < tileInner; k = k + 1) {
    for (var inner = 0; inner < colPerThread; inner = inner + 1) {
      BCached[inner] = mm_Bsub[k][tileCol + inner];
    }

    for (var innerRow = 0; innerRow < rowPerThread; innerRow = innerRow + 1) {
      ${OA(s)}
      for (var innerCol = 0; innerCol < colPerThread; innerCol = innerCol + 1) {
        acc[innerRow][innerCol] = acc[innerRow][innerCol] + ACached * BCached[innerCol];
      }
    }
  }

  workgroupBarrier();
}

for (var innerRow = 0; innerRow < rowPerThread; innerRow = innerRow + 1) {
  for (var innerCol = 0; innerCol < colPerThread; innerCol = innerCol + 1) {
    mm_write(batch, globalRow + innerRow, globalCol + innerCol,
        acc[innerRow][innerCol]);
  }
}
`;return`
  var<workgroup> mm_Asub : array<array<${r}, ${d}>, ${h}>;
  var<workgroup> mm_Bsub : array<array<${r}, ${u}>, ${i}>;
  const rowPerThread = ${t[1]};
  const colPerThread = ${t[0]};
  const tileInner = ${i};

@compute @workgroup_size(${e[0]}, ${e[1]}, ${e[2]})
fn main(@builtin(local_invocation_id) localId : vec3<u32>,
        @builtin(global_invocation_id) globalId : vec3<u32>,
        @builtin(workgroup_id) workgroupId : vec3<u32>) {
    let batch = ${o?"0":"i32(globalId.z)"};
    ${n?`let batchIndices = ${n.offsetToIndices("u32(batch)")};`:""}
    let num_tiles = ${o?`${Math.ceil(a/i)}`:"(uniforms.dim_inner - 1) / tileInner + 1"};
    var kStart = ${o?`i32(globalId.z) * ${a}`:"0"};

    var acc : array<array<${r}, colPerThread>, rowPerThread>;
    ${y}
  }
`},DA=(t,e,r,n,s=!1)=>{let[i,o,a,l]=n,c=wn(n[0].type.tensor);return`
    fn mm_readA(batch: i32, row: i32, colIn: i32, batchIndices: ${i.type.indices}) -> ${Sn(t,c)} {
      var value = ${Sn(t,c)}(0.0);
      let col = colIn * ${t};
      if(row < uniforms.dim_a_outer && col < uniforms.dim_inner)
      {
        var aIndices: ${o.type.indices};
        ${fh("aIndices",o,o.rank-2,i.rank,"batchIndices")}
        ${o.indicesSet("aIndices",o.rank-2,"u32(row)")}
        ${o.indicesSet("aIndices",o.rank-1,"u32(colIn)")}
        value = ${o.getByIndices("aIndices")};
      }
      return value;
    }

    fn mm_readB(batch: i32, row: i32, colIn: i32, batchIndices: ${i.type.indices}) -> ${Sn(t,c)} {
      var value = ${Sn(t,c)}(0.0);
      let col = colIn * ${t};
      if(row < uniforms.dim_inner && col < uniforms.dim_b_outer)
      {
        var bIndices: ${a.type.indices};
        ${fh("bIndices",a,a.rank-2,i.rank,"batchIndices")}
        ${a.indicesSet("bIndices",a.rank-2,"u32(row)")}
        ${a.indicesSet("bIndices",a.rank-1,"u32(colIn)")}
        value = ${a.getByIndices("bIndices")};
      }
      return value;
    }

    fn mm_write(batch: i32, row: i32, colIn: i32, valueIn: ${Sn(t,c)}) {
      let col = colIn * ${t};
      if (row < uniforms.dim_a_outer && col < uniforms.dim_b_outer) {
        var value = valueIn;
        let coords = vec3<i32>(batch, row, colIn);
        ${e?`value = value + ${s?"bias[colIn]":`${Sn(t,c)}(bias[row])`};`:""}
        ${r}
        ${l.setByIndices("vec3<u32>(coords)","value")}
      }
    }
    `},Tg=(t,e,r,n,s=!1,i)=>{let o=t[0].dims,a=t[1].dims,l=o.slice(0,-2),c=a.slice(0,-2),u=n?n.slice(0,-2):r.slice(0,-2),d=Se.size(u),h=o[o.length-2],f=o[o.length-1],p=a[a.length-1],m=f%4===0&&p%4===0,y=h<=8?[4,1,1]:[4,4,1],g=[8,8,1],_=[Math.ceil(p/g[0]/y[0]),Math.ceil(h/g[1]/y[1]),Math.ceil(d/g[2]/y[2])],v=m?4:1,w=[...l,h,f/v],x=w.length,M=[...c,f,p/v],T=M.length,S=[d,h,p/v],k=[{type:6,data:h},{type:6,data:p},{type:6,data:f}];Jl(e,k),k.push(...wt(u,w,M));let $=["rank","rank"],j=t.length>2;j&&(k.push(...wt(t[2].dims)),$.push("rank")),k.push(...wt(S));let V=L=>{let X=u.length,K=Cb("batchDims",t[0].dataType,X,1),Y=wn(t[0].dataType),J=Ie("a",t[0].dataType,x,v),N=Ie("b",t[1].dataType,T,v),ne=dt("result",t[0].dataType,S.length,v),te=[J,N];if(j){let _e=s?v:1;te.push(Ie("bias",t[2].dataType,t[2].dims.length,_e))}let z=[{name:"dim_a_outer",type:"i32"},{name:"dim_b_outer",type:"i32"},{name:"dim_inner",type:"i32"}];Zl(e,z);let O=wn(ne.type.tensor),H=Ql(e,ne.type.value,O),re=DA(v,j,H,[K,J,N,ne],s);return`
  ${L.registerUniforms(z).registerInternalVariables(K).declareVariables(...te,ne)}
  ${re}
  ${m?mx(y,g,Y,K):gx(y,g,Y,K)}
                   `};return{name:"MatMul",shaderCache:{hint:`${y};${e.activation};${m};${s}`,inputDependencies:$},getRunData:()=>({outputs:[{dims:i?i(r):r,dataType:t[0].dataType}],dispatchGroup:{x:_[0],y:_[1],z:_[2]},programUniforms:k}),getShaderSource:V}}}),IA,eN,P9=Ke(()=>{St(),Ho(),Ft(),oc(),Ab(),E9(),Db(),IA=(t,e,r,n,s=!1,i,o=4,a=4,l=4,c="f32")=>{let u=k=>{switch(k){case 1:return"resData = x[xIndex];";case 3:return`resData = vec3<${c}>(x[xIndex], x[xIndex + 1], x[xIndex + 2]);`;case 4:return"resData = x[xIndex / 4];";default:throw new Error(`innerElementSize ${k} is not supported.`)}},d=k=>{switch(k){case 1:return"return w[row * i32(uniforms.w_shape[3]) + colIn];";case 4:return"return w[row * i32(uniforms.w_shape[3]) / 4 + colIn];";default:throw new Error(`innerElementSize ${k} is not supported.`)}},h=t?`
    let coord = vec4<i32>(batch, xRow, xCol, xCh);
    `:`
    let coord = vec4<i32>(batch, xCh, xRow, xCol);
    `,f=t?`
    let coords = vec4<i32>(
      batch,
      row / outWidth,
      row % outWidth,
      col);
    `:`
    let coords = vec4<i32>(
      batch,
      row,
      col / outWidth,
      col % outWidth);
    `,p=t?"i32(uniforms.x_shape[1])":"i32(uniforms.x_shape[2])",m=t?"i32(uniforms.x_shape[2])":"i32(uniforms.x_shape[3])",y=t?"row":"col",g=t?"col":"row",_=`
    let inChannels = i32(uniforms.w_shape[2]);
    let outWidth = ${t?"i32(uniforms.result_shape[2])":"i32(uniforms.result_shape[3])"};
    let outRow = ${y} / outWidth;
    let outCol = ${y} % outWidth;

    let WRow = ${g} / (i32(uniforms.w_shape[1]) * inChannels);
    let WCol = ${g} / inChannels % i32(uniforms.w_shape[1]);
    let xRow = outRow * uniforms.stride[0] + uniforms.dilation[0] * WRow - uniforms.pad[0];
    let xCol = outCol * uniforms.stride[1] + uniforms.dilation[1] * WCol - uniforms.pad[1];
    let xCh = ${g} % inChannels;
    var resData = ${Sn(o,c)}(0.0);
    // The bounds checking is always needed since we use it to pad zero for
    // the 'same' padding type.
    if (xRow >= 0 && xRow < ${p} && xCol >= 0 && xCol < ${m}) {
      ${h}
      let xIndex = getIndexFromCoords4D(coord, vec4<i32>(uniforms.x_shape));
      ${u(o)}
    }
    return resData;`,v=t?e&&n?`
    let col = colIn * ${o};
    ${_}`:`
    let col = colIn * ${o};
    if (row < uniforms.dim_a_outer && col < uniforms.dim_inner) {
      ${_}
    }
    return ${Sn(o,c)}(0.0);`:n&&r?`
    let col = colIn * ${o};
    ${_}`:`
    let col = colIn * ${o};
    if (row < uniforms.dim_inner && col < uniforms.dim_b_outer) {
      ${_}
    }
    return ${Sn(o,c)}(0.0);`,w=t?n&&r?d(a):`
    let col = colIn * ${a};
    if (row < uniforms.dim_inner && col < uniforms.dim_b_outer) {
      ${d(a)}
    }
    return ${Sn(a,c)}(0.0);`:`
    let col = colIn * ${a};
    if (row < uniforms.dim_inner && col < uniforms.dim_a_outer) {
      ${d(a)}
    }
    return ${Sn(a,c)}(0.0);`,x=Sn(l,c),M=Sn(t?o:a,c),T=Sn(t?a:o,c),S=Ql(i,x,c);return`
    fn mm_readA(batch: i32, row : i32, colIn : i32) -> ${M} {
      ${t?v:w}
    }

    fn mm_readB(batch: i32, row : i32, colIn : i32) -> ${T} {
      ${t?w:v}
    }

    fn mm_write(batch: i32, row : i32, colIn : i32, valueIn : ${x}) {
      let col = colIn * ${l};
      if (row < uniforms.dim_a_outer && col < uniforms.dim_b_outer)
      {
      var value = valueIn;
      let outWidth = ${t?"i32(uniforms.result_shape[2])":"i32(uniforms.result_shape[3])"};
      ${f}
      ${Jj(s)}
      ${S}
      setOutputAtCoords(coords[0], coords[1], coords[2], coords[3], value);
      }
    }`},eN=(t,e,r,n,s,i,o,a,l)=>{let c=e.format==="NHWC",u=c?t[0].dims[3]:t[0].dims[1],d=r[0],h=c?r[2]:r[3],f=c?r[1]:r[2],p=c?r[3]:r[1],m=c&&(u%4===0||u%3===0)&&p%4===0,y=c?p:h*f,g=c?h*f:p,_=[8,8,1],v=n<=8?[4,1,1]:[4,4,1],w=[Math.ceil(y/_[0]/v[0]),Math.ceil(g/_[1]/v[1]),Math.ceil(d/_[2]/v[2])];Gt("verbose",()=>`[conv2d_mm_webgpu] dispatch = ${w}`);let x=m?c&&u%4!==0?3:4:1,M=_[1]*v[1],T=_[0]*v[0],S=Math.max(_[0]*x,_[1]),k=n%M===0,$=s%T===0,j=i%S===0,V=m?[x,4,4]:[1,1,1],L=[{type:6,data:n},{type:6,data:s},{type:6,data:i},{type:6,data:[e.pads[0],e.pads[1]]},{type:6,data:e.strides},{type:6,data:e.dilations}];Jl(e,L),L.push(...wt(t[0].dims,t[1].dims));let X=["rank","rank"];o&&(L.push(...wt(t[2].dims)),X.push("rank")),L.push(...wt(r));let K=Y=>{let J=[{name:"dim_a_outer",type:"i32"},{name:"dim_b_outer",type:"i32"},{name:"dim_inner",type:"i32"},{name:"pad",type:"i32",length:2},{name:"stride",type:"i32",length:2},{name:"dilation",type:"i32",length:2}];Zl(e,J);let N=m?4:1,ne=wn(t[0].dataType),te=`
      fn setOutputAtIndex(flatIndex : i32, value : ${m?`vec4<${ne}>`:ne}) {
        result[flatIndex] = ${m?`vec4<${ne}>`:ne}(value);
      }
      fn setOutputAtCoords(d0 : i32, d1 : i32, d2 : i32, d3 : i32, value : ${m?`vec4<${ne}>`:ne}) {
        let flatIndex = getOutputIndexFromCoords(vec4<i32>(d0, d1, d2, d3));
        setOutputAtIndex(flatIndex ${m?"/ 4":""}, value);
      }`,z=Ie("x",t[0].dataType,t[0].dims.length,x===3?1:x),O=Ie("w",t[1].dataType,t[1].dims.length,N),H=[z,O],re=dt("result",t[0].dataType,r.length,N);if(o){let _e=Ie("bias",t[2].dataType,t[2].dims.length,N);H.push(_e),te+=`
        fn getBiasByOutputCoords(coords : vec4<i32>) -> ${m?`vec4<${ne}>`:ne} {
          return bias[coords.${c?"w":"y"}${m?"/ 4":""}];
        }`}return`
        ${Zj("uniforms.result_strides")}
        //struct Uniforms { xShape : vec4<i32>, wShape : vec4<i32>, outShape : vec4<i32>,
        //  outShapeStrides: vec3<i32>, filterDims : vec2<i32>, pad : vec2<i32>, stride : vec2<i32>,
        //  dilation : vec2<i32>, dimAOuter : i32, dimBOuter : i32, dimInner : i32 };
        ${Y.registerUniforms(J).declareVariables(...H,re)}
        ${te}
        ${IA(c,k,$,j,o,e,V[0],V[1],V[2],ne)}
        ${m?mx(v,_,ne,void 0,!c,S):gx(v,_,ne,void 0,!c,S,!1,void 0,a)}`};return{name:"Conv2DMatMul",shaderCache:{hint:`${e.cacheKey};${x};${m};${k};${$};${j};${M};${T};${S}`,inputDependencies:X},getRunData:()=>({outputs:[{dims:l?l(r):r,dataType:t[0].dataType}],dispatchGroup:{x:w[0],y:w[1],z:w[2]},programUniforms:L}),getShaderSource:K}}}),FA,Zy,Nd,LA,ev,RA,tN,rN,k9=Ke(()=>{St(),Ho(),It(),Ft(),oc(),Ab(),FA=t=>{let e=1;for(let r=0;r<t.length;r++)e*=t[r];return e},Zy=t=>typeof t=="number"?[t,t,t]:t,Nd=(t,e)=>e<=1?t:t+(t-1)*(e-1),LA=(t,e,r,n=1)=>{let s=Nd(e,n);return Math.floor((t[0]*(r-1)-r+s)/2)},ev=(t,e,r,n,s)=>{s==null&&(s=LA(t,e[0],n[0]));let i=[0,0,0,r];for(let o=0;o<3;o++)t[o]+2*s>=e[o]&&(i[o]=Math.trunc((t[o]-e[o]+2*s)/n[o]+1));return i},RA=(t,e,r,n,s,i,o,a,l,c)=>{let u,d,h,f;if(t==="VALID"&&(t=0),typeof t=="number"){u={top:t,bottom:t,left:t,right:t,front:t,back:t};let p=ev([e,r,n,1],[a,l,c],1,[s,i,o],t);d=p[0],h=p[1],f=p[2]}else if(Array.isArray(t)){if(!t.every((m,y,g)=>m===g[0]))throw Error(`Unsupported padding parameter: ${t}`);u={top:t[0],bottom:t[1],left:t[2],right:t[3],front:t[4],back:t[5]};let p=ev([e,r,n,1],[a,l,c],1,[s,i,o],t[0]);d=p[0],h=p[1],f=p[2]}else if(t==="SAME_UPPER"){d=Math.ceil(e/s),h=Math.ceil(r/i),f=Math.ceil(n/o);let p=(d-1)*s+a-e,m=(h-1)*i+l-r,y=(f-1)*o+c-n,g=Math.floor(p/2),_=p-g,v=Math.floor(m/2),w=m-v,x=Math.floor(y/2),M=y-x;u={top:v,bottom:w,left:x,right:M,front:g,back:_}}else throw Error(`Unknown padding parameter: ${t}`);return{padInfo:u,outDepth:d,outHeight:h,outWidth:f}},tN=(t,e,r,n,s,i=!1,o="channelsLast")=>{let a,l,c,u,d;if(o==="channelsLast")[a,l,c,u,d]=t;else if(o==="channelsFirst")[a,d,l,c,u]=t;else throw new Error(`Unknown dataFormat ${o}`);let[h,,f,p,m]=e,[y,g,_]=Zy(r),[v,w,x]=Zy(n),M=Nd(f,v),T=Nd(p,w),S=Nd(m,x),{padInfo:k,outDepth:$,outHeight:j,outWidth:V}=RA(s,l,c,u,y,g,_,M,T,S),L=i?h*d:h,X=[0,0,0,0,0];return o==="channelsFirst"?X=[a,L,$,j,V]:o==="channelsLast"&&(X=[a,$,j,V,L]),{batchSize:a,dataFormat:o,inDepth:l,inHeight:c,inWidth:u,inChannels:d,outDepth:$,outHeight:j,outWidth:V,outChannels:L,padInfo:k,strideDepth:y,strideHeight:g,strideWidth:_,filterDepth:f,filterHeight:p,filterWidth:m,effectiveFilterDepth:M,effectiveFilterHeight:T,effectiveFilterWidth:S,dilationDepth:v,dilationHeight:w,dilationWidth:x,inShape:t,outShape:X,filterShape:e}},rN=(t,e,r,n,s,i)=>{let o=i==="channelsLast";o?t[0].dims[3]:t[0].dims[1];let a=[64,1,1],l={x:r.map((y,g)=>g)},c=[Math.ceil(FA(l.x.map(y=>r[y]))/a[0]),1,1];Gt("verbose",()=>`[conv3d_naive_webgpu] dispatch = ${c}`);let u=1,d=Se.size(r),h=[{type:12,data:d},{type:12,data:n},{type:12,data:s},{type:12,data:e.strides},{type:12,data:e.dilations}];Jl(e,h),h.push(...wt(t[0].dims,t[1].dims));let f=["rank","rank"],p=t.length===3;p&&(h.push(...wt(t[2].dims)),f.push("rank")),h.push(...wt(r));let m=y=>{let g=[{name:"output_size",type:"u32"},{name:"filter_dims",type:"u32",length:n.length},{name:"pads",type:"u32",length:s.length},{name:"strides",type:"u32",length:e.strides.length},{name:"dilations",type:"u32",length:e.dilations.length}];Zl(e,g);let _=1,v=wn(t[0].dataType),w=Ie("x",t[0].dataType,t[0].dims.length,u),x=Ie("W",t[1].dataType,t[1].dims.length,_),M=[w,x],T=dt("result",t[0].dataType,r.length,_),S="";if(p){let j=Ie("bias",t[2].dataType,t[2].dims.length,_);M.push(j),S+=`
        fn getBiasByOutputCoords(coords : array<u32, 5>) -> ${v} {
          return bias[${o?gt("coords",4,5):gt("coords",1,5)}];
        }`}let k=Sn(u,v),$=Ql(e,k,v);return`
            ${S}
            fn getX(d0 : u32, d1 : u32, d2 : u32, d3 : u32, d4 : u32) -> f32 {
              let aIndices = array<u32, 5>(d0, d1, d2, d3, d4);
              return ${w.getByIndices("aIndices")};
            }
            fn getW(d0 : u32, d1 : u32, d2 : u32, d3 : u32, d4 : u32) -> f32 {
              let aIndices = array<u32, 5>(d0, d1, d2, d3, d4);
              return ${x.getByIndices("aIndices")};
            }
          ${y.registerUniforms(g).declareVariables(...M,T)}
          ${y.mainStart()}
          ${y.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}
              let coords = ${T.offsetToIndices("global_idx")};
              let batch = ${gt("coords",0,w.rank)};
              let d2 = ${o?gt("coords",w.rank-1,w.rank):gt("coords",1,w.rank)};
              let xFRCCorner = vec3<u32>(${o?gt("coords",1,w.rank):gt("coords",2,w.rank)},
              ${o?gt("coords",2,w.rank):gt("coords",3,w.rank)},
              ${o?gt("coords",3,w.rank):gt("coords",4,w.rank)}) * uniforms.strides - uniforms.pads;
              let xFCorner = xFRCCorner.x;
              let xRCorner = xFRCCorner.y;
              let xCCorner = xFRCCorner.z;
              let xShapeY = ${o?gt("uniforms.x_shape",1,w.rank):gt("uniforms.x_shape",2,w.rank)};
              let xShapeZ = ${o?gt("uniforms.x_shape",2,w.rank):gt("uniforms.x_shape",3,w.rank)};
              let xShapeW = ${o?gt("uniforms.x_shape",3,w.rank):gt("uniforms.x_shape",4,w.rank)};
              let xShapeU = ${o?gt("uniforms.x_shape",4,w.rank):gt("uniforms.x_shape",1,w.rank)};
              let inputDepthNearestVec4 = (xShapeU / 4) * 4;
              let inputDepthVec4Remainder = xShapeU % 4;

              var value = 0.0;
              for (var wF = 0u; wF < uniforms.filter_dims[0]; wF++) {
                let xF = xFCorner + wF * uniforms.dilations[0];
                if (xF < 0 || xF >= xShapeY) {
                  continue;
                }

                for (var wR = 0u; wR < uniforms.filter_dims[1]; wR++) {
                  let xR = xRCorner + wR * uniforms.dilations[1];
                  if (xR < 0 || xR >= xShapeZ) {
                    continue;
                  }

                  for (var wC = 0u; wC < uniforms.filter_dims[2]; wC++) {
                    let xC = xCCorner + wC * uniforms.dilations[2];
                    if (xC < 0 || xC >= xShapeW) {
                      continue;
                    }

                    for (var d1 = 0u; d1 < inputDepthNearestVec4; d1 += 4) {
                      ${o?`let xValues = vec4<f32>(
                               getX(batch, xF, xR, xC, d1),
                               getX(batch, xF, xR, xC, d1 + 1),
                               getX(batch, xF, xR, xC, d1 + 2),
                               getX(batch, xF, xR, xC, d1 + 3));
                            `:`let xValues = vec4<f32>(
                               getX(batch, d1, xF, xR, xC),
                               getX(batch, d1 + 1, xF, xR, xC),
                               getX(batch, d1 + 2, xF, xR, xC),
                               getX(batch, d1 + 3, xF, xR, xC));
                            `}
                            let wValues = vec4<f32>(
                              getW(d2, d1, wF, wR, wC),
                              getW(d2, d1 + 1, wF, wR, wC),
                              getW(d2, d1 + 2, wF, wR, wC),
                              getW(d2, d1 + 3, wF, wR, wC));
                      value += dot(xValues, wValues);
                    }
                    if (inputDepthVec4Remainder == 1) {
                        ${o?`value += getX(batch, xF, xR, xC, inputDepthNearestVec4)
                          * getW(d2, inputDepthNearestVec4, wF, wR, wC);`:`value += getX(batch, inputDepthNearestVec4, xF, xR, xC)
                          * getW(d2, inputDepthNearestVec4, wF, wR, wC);`}
                    } else if (inputDepthVec4Remainder == 2) {
                      ${o?`let xValues = vec2<f32>(
                        getX(batch, xF, xR, xC, inputDepthNearestVec4),
                        getX(batch, xF, xR, xC, inputDepthNearestVec4 + 1));
                      `:`let xValues = vec2<f32>(
                        getX(batch, inputDepthNearestVec4, xF, xR, xC),
                        getX(batch, inputDepthNearestVec4 + 1, xF, xR, xC));
                    `}
                    let wValues = vec2<f32>(
                      getW(d2, inputDepthNearestVec4, wF, wR, wC),
                      getW(d2, inputDepthNearestVec4 + 1, wF, wR, wC));
                      value += dot(xValues, wValues);
                    } else if (inputDepthVec4Remainder == 3) {
                      ${o?`let xValues = vec3<f32>(
                        getX(batch, xF, xR, xC, inputDepthNearestVec4),
                        getX(batch, xF, xR, xC, inputDepthNearestVec4 + 1),
                        getX(batch, xF, xR, xC, inputDepthNearestVec4 + 2));
                      `:`let xValues = vec3<f32>(
                        getX(batch, inputDepthNearestVec4, xF, xR, xC),
                        getX(batch, inputDepthNearestVec4 + 1, xF, xR, xC),
                        getX(batch, inputDepthNearestVec4 + 2, xF, xR, xC));
                    `}
                    let wValues = vec3<f32>(
                      getW(d2, inputDepthNearestVec4, wF, wR, wC),
                      getW(d2, inputDepthNearestVec4 + 1, wF, wR, wC),
                      getW(d2, inputDepthNearestVec4 + 2, wF, wR, wC));
                      value += dot(xValues, wValues);
                    }
                  }
                }
              }
              ${p?"value = value + getBiasByOutputCoords(coords)":""};
              ${$}
              result[global_idx] = f32(value);
          }`};return{name:"Conv3DNaive",shaderCache:{hint:`${e.cacheKey};${o};${u};${p}`,inputDependencies:f},getRunData:()=>({outputs:[{dims:r,dataType:t[0].dataType}],dispatchGroup:{x:c[0],y:c[1],z:c[2]},programUniforms:h}),getShaderSource:m}}}),nN,sN,A9=Ke(()=>{St(),It(),Ft(),oc(),nN=(t,e,r,n)=>{let s=t.length>2,i=s?"value += b[output_channel];":"",o=t[0].dims,a=t[1].dims,l=e.format==="NHWC",c=l?r[3]:r[1],u=c/e.group,d=l&&u>=4?Ir(c):1,h=Se.size(r)/d,f=[{type:12,data:h},{type:12,data:e.dilations},{type:12,data:[e.strides[0],e.strides[1]]},{type:12,data:[e.pads[0],e.pads[1]]},{type:12,data:u}];Jl(e,f),f.push(...wt(o,[a[0],a[1],a[2],a[3]/d]));let p=s?["rank","rank","rank"]:["rank","rank"];f.push(...wt([r[0],r[1],r[2],r[3]/d]));let m=y=>{let g=dt("output",t[0].dataType,r.length,d),_=wn(g.type.tensor),v=Ql(e,g.type.value,_),w=Ie("x",t[0].dataType,o.length),x=Ie("w",t[1].dataType,a.length,d),M=[w,x];s&&M.push(Ie("b",t[2].dataType,t[2].dims,d));let T=[{name:"output_size",type:"u32"},{name:"dilations",type:"u32",length:e.dilations.length},{name:"strides",type:"u32",length:2},{name:"pads",type:"u32",length:2},{name:"output_channels_per_group",type:"u32"}];Zl(e,T);let S=l?`
      for (var wHeight: u32 = 0u; wHeight < uniforms.w_shape[0]; wHeight++) {
        let xHeight = xRCCorner.x + wHeight * uniforms.dilations[0];

        if (xHeight < 0u || xHeight >= uniforms.x_shape[1]) {
          continue;
        }

        for (var wWidth: u32 = 0u; wWidth < uniforms.w_shape[1]; wWidth++) {
          let xWidth = xRCCorner.y + wWidth * uniforms.dilations[1];
          if (xWidth < 0u || xWidth >= uniforms.x_shape[2]) {
            continue;
          }

          for (var wInChannel: u32 = 0u; wInChannel < uniforms.w_shape[2]; wInChannel++) {
            let input_channel = in_channel_offset + wInChannel;
            let xVal = ${w.get("batch","xHeight","xWidth","input_channel")};
            let wVal = ${x.get("wHeight","wWidth","wInChannel","output_channel")};
            value += xVal * wVal;
          }
        }
      }
      `:`
      for (var wInChannel: u32 = 0u; wInChannel < uniforms.w_shape[1]; wInChannel++) {
        let input_channel = in_channel_offset + wInChannel;
        for (var wHeight: u32 = 0u; wHeight < uniforms.w_shape[2]; wHeight++) {
          let xHeight = xRCCorner.x + wHeight * uniforms.dilations[0];

          if (xHeight < 0u || xHeight >= uniforms.x_shape[2]) {
            continue;
          }

          for (var wWidth: u32 = 0u; wWidth < uniforms.w_shape[3]; wWidth++) {
            let xWidth = xRCCorner.y + wWidth * uniforms.dilations[1];
            if (xWidth < 0u || xWidth >= uniforms.x_shape[3]) {
              continue;
            }

            let xVal = ${w.get("batch","input_channel","xHeight","xWidth")};
            let wVal = ${x.get("output_channel","wInChannel","wHeight","wWidth")};
            value += xVal * wVal;
          }
        }
      }
      `;return`
  ${y.registerUniforms(T).declareVariables(...M,g)}

  ${y.mainStart()}
    ${y.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}

    let outputIndices = ${g.offsetToIndices("global_idx")};
    let batch: u32 = outputIndices[0];
    let output_channel: u32 = outputIndices[${l?3:1}];
    let xRCCorner: vec2<u32> = vec2<u32>(outputIndices[${l?1:2}], outputIndices[${l?2:3}]) * uniforms.strides - uniforms.pads;
    let group_id: u32 = output_channel * ${d} / uniforms.output_channels_per_group;
    var in_channel_offset = group_id * uniforms.w_shape[${l?2:1}];

    var value: ${g.type.value} = ${g.type.value}(0);
    ${S}
    ${i}
    ${v}
    ${g.setByOffset("global_idx","value")}
  }`};return{name:"GroupedConv",shaderCache:{hint:`${e.cacheKey}_${d}`,inputDependencies:p},getRunData:()=>({outputs:[{dims:n?n(r):r,dataType:t[0].dataType}],dispatchGroup:{x:Math.ceil(h/64)},programUniforms:f}),getShaderSource:m}},sN=(t,e,r,n)=>{let s=t.length>2,i=Ir(r[3]),o=Ir(r[2]),a=Se.size(r)/i/o,l=[t[0].dims[0],t[0].dims[1],t[0].dims[2],t[0].dims[3]/i],c=[t[1].dims[0],t[1].dims[1],t[1].dims[2],t[1].dims[3]/i],u=[r[0],r[1],r[2],r[3]/i],d=[{type:12,data:a},{type:6,data:[e.strides[0],e.strides[1]]},{type:6,data:[e.pads[0],e.pads[1]]}];Jl(e,d),d.push(...wt(l,c,u));let h=(o-1)*e.strides[1]+c[1],f=p=>{let m=dt("output",t[0].dataType,u.length,i),y=wn(m.type.tensor),g=Ql(e,m.type.value,y),_=Ie("x",t[0].dataType,l.length,i),v=Ie("w",t[1].dataType,c.length,i),w=[_,v];s&&w.push(Ie("b",t[2].dataType,t[2].dims,i));let x=s?"value += b[output_channel];":"",M=[{name:"output_size",type:"u32"},{name:"strides",type:"i32",length:2},{name:"pads",type:"i32",length:2}];return Zl(e,M),`
  ${p.registerUniforms(M).declareVariables(...w,m)}
  ${p.mainStart()}
    ${p.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}
    let width0 = uniforms.output_shape[3];
    let output_channel = global_idx % width0;
    var index1 = global_idx / width0;
    let width1 = uniforms.output_shape[2] / ${o}u;
    let col = (index1 % width1) * ${o}u;
    index1 = index1 / width1;
    let row = index1 % uniforms.output_shape[1];
    let batch = index1 / uniforms.output_shape[1];

    let x_corner = vec2<i32>(i32(row), i32(col)) * uniforms.strides - uniforms.pads;

    var x_vals: array<${_.type.value}, ${h}>;
    var values: array<${m.type.value}, ${o}>;
    let input_channel = output_channel;
    // Use constant instead of uniform can give better performance for w's height/width.
    for (var w_height: u32 = 0u; w_height < ${c[0]}; w_height++) {
      let x_height = x_corner.x + i32(w_height);
      if (x_height >= 0 && u32(x_height) < uniforms.x_shape[1]) {
        for (var i = 0; i < ${h}; i++) {
          let x_width = x_corner.y + i;
          if (x_width >= 0 && u32(x_width) < uniforms.x_shape[2]) {
            x_vals[i] = ${_.get("batch","u32(x_height)","u32(x_width)","input_channel")};
          } else {
            x_vals[i] = ${_.type.value}(0);
          }
        }
        for (var w_width: u32 = 0u; w_width < ${c[1]}; w_width++) {
          let w_val = ${v.get("w_height","w_width","0","output_channel")};
          for (var i = 0u; i < ${o}u; i++) {
            values[i] = fma(x_vals[i * u32(uniforms.strides[1]) + w_width], w_val, values[i]);
          }
        }
      }
    }

    for (var i = 0u; i < ${o}u; i++) {
      var value = values[i];
      ${x}
      ${g}
      ${m.set("batch","row","col + i","output_channel","value")};
    }
  }`};return{name:"GroupedConv-Vectorize",shaderCache:{hint:`${e.cacheKey};${i};${o};${h};${c[0]};${c[1]}`,inputDependencies:s?["rank","rank","type"]:["rank","rank"]},getRunData:()=>({outputs:[{dims:n?n(r):r,dataType:t[0].dataType}],dispatchGroup:{x:Math.ceil(a/64)},programUniforms:d}),getShaderSource:f}}}),jA,Ip,NA,Fp,_x,tv,zA,BA,yx,$9=Ke(()=>{It(),P9(),k9(),Db(),A9(),oc(),Ob(),Ka(),jA=(t,e,r,n,s,i)=>{let o=t[0],a=t.slice(i?1:2,i?3:4),l=a.length,c=e[0],u=e.slice(2).map((h,f)=>h+(h-1)*(r[f]-1)),d=a.map((h,f)=>h+n[f]+n[f+l]).map((h,f)=>Math.floor((h-u[f]+s[f])/s[f]));return d.splice(0,0,o),d.splice(i?3:1,0,c),d},Ip=[2,3,1,0],NA=(t,e)=>{if(!t||t.length!==2&&t.length!==3)throw new Error("Conv requires 2 or 3 inputs");if(t[0].dims.length>5)throw new Error("greater than 5D is not supported");if(t[0].dims.length!==t[1].dims.length)throw new Error("filter does not have same dimension as input");let r=t[0].dims[e.format==="NHWC"?t[0].dims.length-1:1],n=t[1].dims[1]*e.group;if(r!==n)throw new Error("FILTER_IN_CHANNEL should be equal to DATA_CHANNEL");if(t.length===3&&(t[2].dims.length!==1||t[1].dims[0]!==t[2].dims[0]))throw new Error("invalid bias");let s=t[0].dims.length-2;if(e.dilations.length!==s)throw new Error(`dilations should be ${s}D`);if(e.strides.length!==s)throw new Error(`strides should be ${s}D`);if(e.pads.length!==s*2)throw new Error(`pads should be ${s*2}D`);if(e.kernelShape.length!==0&&e.kernelShape.length!==t[1].dims.length-2)throw new Error("invalid kernel shape")},Fp=(t,e)=>{let r=t.kernelShape.slice();r.length<e[1].dims.length-2&&r.push(...Array(e[1].dims.length-2-r.length).fill(0));for(let i=2;i<e[1].dims.length;++i)r[i-2]===0&&(r[i-2]=e[1].dims[i]);let n=t.pads.slice();bg.adjustPadsBasedOnAutoPad(e[0].dims,t.strides,t.dilations,r,n,t.format==="NHWC",t.autoPad);let s=Object.assign({},t);return Object.assign(s,{kernelShape:r,pads:n}),s},_x=t=>{let e=kb(t),r=t.format,n=["NOTSET","VALID","SAME_UPPER","SAME_LOWER"][t.auto_pad],s=t.dilations,i=t.group,o=t.kernel_shape,a=t.pads,l=t.strides,c=t.w_is_const();return{autoPad:n,format:r,dilations:s,group:i,kernelShape:o,pads:a,strides:l,wIsConst:c,...e,cacheKey:`${t.format};${e.activation};`}},tv=(t,e,r,n)=>{let s=r.format==="NHWC",i=jA(e[0].dims,e[1].dims,r.dilations,r.pads,r.strides,s);if(r.group!==1){let M=[e[0]];if(s){let T=t.kernelCustomData.wT??t.compute(Fs(e[1],Ip),{inputs:[1],outputs:[r.wIsConst?-2:-1]})[0];r.wIsConst&&!t.kernelCustomData.wT&&(t.kernelCustomData.wT=T),M.push(T)}else M.push(e[1]);e.length===3&&M.push(e[2]),!t.adapterInfo.isArchitecture("ampere")&&s&&e[1].dims[0]===r.group&&e[1].dims[1]===1&&r.dilations[0]===1&&r.dilations[1]===1?t.compute(sN(M,r,i,n),{inputs:M}):t.compute(nN(M,r,i,n),{inputs:M});return}let o=e.length===3,a=e[0].dims[s?1:2],l=e[0].dims[s?2:3],c=e[0].dims[s?3:1],u=e[1].dims[2],d=e[1].dims[3],h=i[s?1:2],f=i[s?2:3],p=i[s?3:1],m=s&&u===a&&d===l&&r.pads[0]===0&&r.pads[1]===0;if(m||u===1&&d===1&&r.dilations[0]===1&&r.dilations[1]===1&&r.strides[0]===1&&r.strides[1]===1&&r.pads[0]===0&&r.pads[1]===0){let M=i[0],T,S,k,$=[];if(s){let L=t.kernelCustomData.wT??t.compute(Fs(e[1],Ip),{inputs:[1],outputs:[r.wIsConst?-2:-1]})[0];if(r.wIsConst&&!t.kernelCustomData.wT&&(t.kernelCustomData.wT=L),m){let X=a*l*c;T=e[0].reshape([1,M,X]),S=L.reshape([1,X,p]),k=[1,M,p]}else T=e[0].reshape([M,a*l,c]),S=L.reshape([1,c,p]),k=[M,h*f,p];$.push(T),$.push(S)}else T=e[0].reshape([M,c,a*l]),S=e[1].reshape([1,p,c]),k=[M,p,h*f],$.push(S),$.push(T);o&&$.push(e[2]);let j=k[2],V=$[0].dims[$[0].dims.length-1];j<8&&V<8?t.compute($b($,r,i,k,s,n),{inputs:$}):t.compute(Tg($,r,i,k,s,n),{inputs:$});return}let y=!0,g=t.kernelCustomData.wT??t.compute(Fs(e[1],Ip),{inputs:[1],outputs:[r.wIsConst?-2:-1]})[0];r.wIsConst&&!t.kernelCustomData.wT&&(t.kernelCustomData.wT=g);let _=[e[0],g];o&&_.push(e[2]);let v=s?h*f:p,w=s?p:h*f,x=u*d*c;t.compute(eN(_,r,i,v,w,x,o,y,n),{inputs:_})},zA=(t,e)=>{let r=e.format==="NHWC",n=[t.inputs[0].reshape(r?[t.inputs[0].dims[0],1,t.inputs[0].dims[1],t.inputs[0].dims[2]]:[t.inputs[0].dims[0],t.inputs[0].dims[1],1,t.inputs[0].dims[2]]),t.inputs[1].reshape([t.inputs[1].dims[0],t.inputs[1].dims[1],1,t.inputs[1].dims[2]])];t.inputs.length===3&&n.push(t.inputs[2]);let s=[0,e.pads[0],0,e.pads[1]],i=[1].concat(e.strides),o=[1].concat(e.dilations),a=[1].concat(e.kernelShape),l=Fp({...e,pads:s,strides:i,dilations:o,kernelShape:a},n);tv(t,n,l,c=>r?[c[0],c[2],c[3]]:[c[0],c[1],c[3]])},BA=(t,e,r)=>{let n=r.format==="NHWC"?"channelsLast":"channelsFirst",s=Fp(r,e),i=r.autoPad==="NOTSET"?r.pads:r.autoPad,o=tN(e[0].dims,e[1].dims,r.strides,r.dilations,i,!1,n);t.compute(rN(e,s,o.outShape,[o.filterDepth,o.filterHeight,o.filterWidth],[o.padInfo.front,o.padInfo.top,o.padInfo.left],n))},yx=(t,e)=>{if(NA(t.inputs,e),t.inputs[0].dims.length===3)zA(t,e);else if(t.inputs[0].dims.length===5)BA(t,t.inputs,e);else{let r=Fp(e,t.inputs);tv(t,t.inputs,r)}}}),iN,O9=Ke(()=>{St(),Ho(),It(),Ft(),iN=(t,e,r)=>{let n=t.length>2,s=e.outputShape,i=e.format==="NHWC",o=e.group,a=t[1].dims,l=a[2]/o,c=a[3],u=i?Ir(l):1,d=i&&c===1&&l>=4,h=d?Math.floor(l/4)*4:Math.floor(l/u)*u,f=l-h,p=i?Ir(c):1,m=i?c===1?u:p:1,y=Se.size(s)/p,g=[Math.ceil(y/64),1,1];Gt("verbose",()=>`[conv2d_backprop_webgpu] dispatch = ${g}`);let _=["rank","rank"],v=[e.strides[0],e.strides[1]],w=[e.kernelShape[i?1:2],e.kernelShape[i?2:3]],x=[e.dilations[0],e.dilations[1]],M=[w[0]+(e.dilations[0]<=1?0:(e.kernelShape[i?1:2]-1)*(e.dilations[0]-1)),w[1]+(e.dilations[1]<=1?0:(e.kernelShape[i?2:3]-1)*(e.dilations[1]-1))],T=[M[0]-1-Math.floor((e.pads[0]+e.pads[2])/2),M[1]-1-Math.floor((e.pads[1]+e.pads[3])/2)],S=[{type:12,data:y},{type:12,data:v},{type:12,data:w},{type:12,data:x},{type:12,data:M},{type:6,data:T},{type:12,data:h},{type:12,data:l},{type:12,data:c},...wt(t[0].dims,t[1].dims)];n&&(S.push(...wt(t[2].dims)),_.push("rank")),S.push(...wt(s));let k=$=>{let j=[{name:"output_size",type:"u32"},{name:"strides",type:"u32",length:v.length},{name:"filter_dims",type:"u32",length:w.length},{name:"dilations",type:"u32",length:w.length},{name:"effective_filter_dims",type:"u32",length:M.length},{name:"pads",type:"i32",length:T.length},{name:"input_channels_per_group_int",type:"u32"},{name:"input_channels_per_group",type:"u32"},{name:"output_channels_per_group",type:"u32"}],V=wn(t[0].dataType),L=i?1:2,X=i?2:3,K=i?3:1,Y=Ie("W",t[1].dataType,t[1].dims.length,m),J=Ie("Dy",t[0].dataType,t[0].dims.length,u),N=[J,Y];n&&N.push(Ie("bias",t[2].dataType,[s[K]].length,p));let ne=dt("result",t[0].dataType,s.length,p),te=()=>{let H="";if(d)u===4?H+=`
        let xValue = ${J.getByOffset("x_offset")};
        let wValue = ${Y.getByOffset("w_offset")};
        dotProd = dotProd + dot(xValue, wValue);
        x_offset += 1u;
        w_offset += 1u;`:u===2?H+=`
          dotProd = dotProd + dot(vec4<${V}>(${J.getByOffset("x_offset")}, ${J.getByOffset("x_offset + 1u")}), vec4<${V}>(${Y.getByOffset("w_offset")}, ${Y.getByOffset("w_offset + 1u")}));
          x_offset += 2u;
          w_offset += 2u;`:u===1&&(H+=`
          dotProd = dotProd + dot(vec4<${V}>(${J.getByOffset("x_offset")}, ${J.getByOffset("x_offset + 1u")}, ${J.getByOffset("x_offset + 2u")}, ${J.getByOffset("x_offset + 3u")}), vec4<${V}>(${Y.getByOffset("w_offset")}, ${Y.getByOffset("w_offset + 1u")}, ${Y.getByOffset("w_offset + 2u")}, ${Y.getByOffset("w_offset + 3u")}));
          x_offset += 4u;
          w_offset += 4u;`);else if(H+=`
                  let xValue = ${i?J.getByOffset(`${J.indicesToOffset(`${J.type.indices}(batch, idyR, idyC, inputChannel)`)} / ${u}`):J.get("batch","inputChannel","idyR","idyC")};
        `,u===1)H+=`
          let w_offset = ${Y.indicesToOffset(`${Y.type.indices}(u32(wRPerm), u32(wCPerm), inputChannel, wOutChannel)`)};
          let wValue = ${Y.getByOffset(`w_offset / ${m}`)};
          dotProd = dotProd + xValue * wValue;`;else for(let re=0;re<u;re++)H+=`
            let wValue${re} = ${Y.getByOffset(`${Y.indicesToOffset(`${Y.type.indices}(u32(wRPerm), u32(wCPerm), inputChannel + ${re}, wOutChannel)`)} / ${m}`)};
            dotProd = dotProd + xValue[${re}] * wValue${re};`;return H},z=()=>{if(f===0)return"";if(!d)throw new Error(`packInputAs4 ${d} is not true.`);let H="";if(u===1){H+="dotProd = dotProd";for(let re=0;re<f;re++)H+=`
            + ${J.getByOffset(`x_offset + ${re}`)} * ${Y.getByOffset(`w_offset + ${re}`)}`;H+=";"}else if(u===2){if(f!==2)throw new Error(`Invalid inputChannelsRemainder ${f}.`);H+=`
          let xValue = ${J.getByOffset("x_offset")};
          let wValue = ${Y.getByOffset("w_offset")};
          dotProd = dotProd + dot(xValue, wValue);`}return H},O=`
            let outputIndices = ${ne.offsetToIndices(`global_idx * ${p}`)};
            let batch = ${ne.indicesGet("outputIndices",0)};
            let d1 = ${ne.indicesGet("outputIndices",K)};
            let r = ${ne.indicesGet("outputIndices",L)};
            let c = ${ne.indicesGet("outputIndices",X)};
            let dyCorner = vec2<i32>(i32(r), i32(c)) - uniforms.pads;
            let dyRCorner = dyCorner.x;
            let dyCCorner = dyCorner.y;
            let groupId = d1 / uniforms.output_channels_per_group;
            let wOutChannel = d1 - groupId * uniforms.output_channels_per_group;
            // Convolve dy(?, ?, d2) with w(:, :, d1, d2) to compute dx(xR, xC, d1).
            // ? = to be determined. : = across all values in that axis.
            var dotProd = ${ne.type.value}(0.0);
            var wR: u32 = 0;
            if (uniforms.dilations.x == 1) {
              // Minimum wR >= 0 that satisfies (dyRCorner + wR) % (uniforms.strides.x) == 0
              wR = u32(((dyRCorner + i32(uniforms.strides.x) - 1) / i32(uniforms.strides.x)) * i32(uniforms.strides.x) - dyRCorner);
            }
            for (; wR < uniforms.effective_filter_dims.x; wR = wR + 1) {
              if (wR % uniforms.dilations.x != 0) {
                continue;
              }
              let dyR = (${V}(dyRCorner) + ${V}(wR)) / ${V}(uniforms.strides[0]);
              let wRPerm = uniforms.filter_dims.x - 1 - wR / uniforms.dilations.x;
              if (dyR < 0.0 || dyR >= ${V}(uniforms.Dy_shape[${L}]) || fract(dyR) > 0.0 ||
                  wRPerm < 0) {
                continue;
              }
              let idyR: u32 = u32(dyR);
              var wC: u32 = 0;
              if (uniforms.dilations.y == 1) {
                // Minimum wC >= 0 that satisfies (dyCCorner + wC) % (uniforms.strides.y) == 0
                wC = u32(((dyCCorner + i32(uniforms.strides.y) - 1) / i32(uniforms.strides.y)) * i32(uniforms.strides.y) - dyCCorner);
              }
              for (; wC < uniforms.effective_filter_dims.y; wC = wC + 1) {
                if (wC % uniforms.dilations.y != 0) {
                  continue;
                }
                let dyC = (${V}(dyCCorner) + ${V}(wC)) / ${V}(uniforms.strides.y);
                let wCPerm = uniforms.filter_dims.y - 1 - wC / uniforms.dilations.y;
                if (dyC < 0.0 || dyC >= ${V}(uniforms.Dy_shape[${X}]) ||
                    fract(dyC) > 0.0 || wCPerm < 0) {
                  continue;
                }
                let idyC: u32 = u32(dyC);
                var inputChannel = groupId * uniforms.input_channels_per_group;
                ${d?`
                var x_offset = ${J.indicesToOffset(`${J.type.indices}(batch, idyR, idyC, inputChannel)`)} / ${u};
                var w_offset = ${Y.indicesToOffset(`${Y.type.indices}(wRPerm, wCPerm, inputChannel, wOutChannel)`)} / ${m};
                  `:""}
                for (var d2: u32 = 0; d2 < uniforms.input_channels_per_group_int; d2 = d2 + ${d?4:u}) {
                  ${te()}
                  inputChannel = inputChannel + ${d?4:u};
                }
                ${z()}
                wC = wC + uniforms.strides.y - 1;
              }
              wR = wR + uniforms.strides[0] - 1;
            }
            let value = dotProd${n?` + bias[d1 / ${p}]`:""};
            ${ne.setByOffset("global_idx","value")};
          `;return`
    ${$.registerUniforms(j).declareVariables(...N,ne)}
      ${$.mainStart()}
      ${$.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")};
    ${O}}`};return{name:"ConvTranspose2D",shaderCache:{hint:`${e.cacheKey};${u}${m}${p}${d}${f}`,inputDependencies:_},getRunData:()=>({dispatchGroup:{x:g[0],y:g[1],z:g[2]},outputs:[{dims:r?r(s):s,dataType:t[0].dataType}],programUniforms:S}),getShaderSource:k}}}),VA,WA,UA,rv,oN,GA,nv,HA,aN,D9=Ke(()=>{O9(),oc(),Ka(),VA=(t,e,r,n,s,i)=>(t-1)*e+r+(n-1)*s+1-i,WA=(t,e,r,n,s)=>{let i=Math.floor(t/2);e==="SAME_UPPER"?(r[n]=i,r[s]=t-i):e==="SAME_LOWER"&&(r[n]=t-i,r[s]=i)},UA=(t,e,r,n,s,i,o,a,l,c)=>{let u=t.length-2,d=c.length===0;l.length<u&&l.push(...Array(u-l.length).fill(0));let h=t[0],f=e[a?3:1]*s;for(let p=0,m=t.length-u-(a?1:0);p<u;++p,++m){let y=t[m],g=d?y*o[p]:c[p],_=VA(y,o[p],i[p],e[m],r[p],g);WA(_,n,i,p,p+u),d&&c.push(o[p]*(y-1)+l[p]+(e[m]-1)*r[p]+1-i[p]-i[p+u])}c.splice(0,0,h),c.splice(a?3:1,0,f)},rv=(t,e)=>{let r=t.kernelShape.slice();if(t.kernelShape.length===0||t.kernelShape.reduce((d,h)=>d*h,1)===0){r.length=0;for(let d=2;d<e[1].dims.length;++d)r.push(e[1].dims[d])}let n=t.format==="NHWC";r.splice(0,0,e[1].dims[0]),r.splice(n?3:1,0,e[1].dims[1]);let s=t.pads.slice(),i=t.outputShape.slice(),o=t.outputPadding.slice(),a=e[0].dims,l=t.dilations.slice();if(l.reduce((d,h)=>d+h,0)===0){let d=e[0].dims.length-2;l=new Array(d).fill(1)}let c=t.strides.slice();if(c.reduce((d,h)=>d+h,0)===0){let d=e[0].dims.length-2;c=new Array(d).fill(1)}UA(a,r,l,t.autoPad,t.group,s,c,n,o,i);let u=Object.assign({},t);return Object.assign(u,{kernelShape:r,pads:s,outputPadding:o,outputShape:i,dilations:l,strides:c}),u},oN=t=>{let e=kb(t),r=t.format,n=["NOTSET","VALID","SAME_UPPER","SAME_LOWER"][typeof t.autoPad>"u"?0:t.autoPad],s=t.dilations,i=t.group,o=t.kernelShape,a=t.pads,l=t.strides,c=t.wIsConst(),u=t.outputPadding,d=t.outputShape;return{autoPad:n,format:r,dilations:s,group:i,kernelShape:o,outputPadding:u,outputShape:d,pads:a,strides:l,wIsConst:c,...e,cacheKey:`${t.format};${e.activation};`}},GA=(t,e)=>{if(!t||t.length!==2&&t.length!==3)throw new Error("Conv requires 2 or 3 inputs");if(t[0].dims.length!==4&&t[0].dims.length!==3)throw new Error("currently only support 2-dimensional conv");if(t[0].dims.length!==t[1].dims.length)throw new Error("filter does not have same dimension as input");let r=t[0].dims[e.format==="NHWC"?t[0].dims.length-1:1],n=t[1].dims[0];if(r!==n)throw new Error("FILTER_IN_CHANNEL should be equal to DATA_CHANNEL");let s=t[1].dims[1]*e.group;if(t.length===3&&(t[2].dims.length!==1||t[2].dims[0]!==s))throw new Error("invalid bias");let i=t[0].dims.length-2;if(e.dilations.reduce((o,a)=>o+a,0)>0&&e.dilations.length!==i)throw new Error(`dilations should be ${i}D`);if(e.strides.reduce((o,a)=>o+a,0)>0&&e.strides.length!==i)throw new Error(`strides should be ${i}D`);if(e.pads.reduce((o,a)=>o+a,0)>0&&e.pads.length!==i*2)throw new Error(`pads should be ${i*2}D`);if(e.outputPadding.length!==i&&e.outputPadding.length!==0)throw new Error(`output_padding should be ${i}D`);if(e.kernelShape.reduce((o,a)=>o+a,0)>0&&e.kernelShape.length!==0&&e.kernelShape.length!==t[1].dims.length-2)throw new Error("invalid kernel shape");if(e.outputShape.length!==0&&e.outputShape.length!==t[0].dims.length-2)throw new Error("invalid output shape")},nv=(t,e,r,n)=>{let s=t.kernelCustomData.wT??t.compute(Fs(e[1],[2,3,0,1]),{inputs:[1],outputs:[r.wIsConst?-2:-1]})[0];r.wIsConst&&!t.kernelCustomData.wT&&(t.kernelCustomData.wT=s);let i=[e[0],s];e.length===3&&i.push(e[2]),t.compute(iN(i,r,n),{inputs:i})},HA=(t,e)=>{let r=e.format==="NHWC",n=[t.inputs[0].reshape(r?[t.inputs[0].dims[0],1,t.inputs[0].dims[1],t.inputs[0].dims[2]]:[t.inputs[0].dims[0],t.inputs[0].dims[1],1,t.inputs[0].dims[2]]),t.inputs[1].reshape([t.inputs[1].dims[0],t.inputs[1].dims[1],1,t.inputs[1].dims[2]])];t.inputs.length===3&&n.push(t.inputs[2]);let s=e.kernelShape;(s.length===0||s[0]===0)&&(s=[t.inputs[1].dims[2]]);let i=e.dilations;(i.length===0||i[0]===0)&&(i=[1]);let o=e.strides;(o.length===0||o[0]===0)&&(o=[1]);let a=e.pads;a.length===0&&(a=[0,0]),a=[0,a[0],0,a[1]],o=[1].concat(o),i=[1].concat(i),s=[1].concat(s);let l=e.outputPadding;l=[0].concat(l);let c=rv({...e,pads:a,strides:o,dilations:i,kernelShape:s,outputPadding:l},n);nv(t,n,c,u=>r?[u[0],u[2],u[3]]:[u[0],u[1],u[3]])},aN=(t,e)=>{if(GA(t.inputs,e),t.inputs[0].dims.length===3)HA(t,e);else{let r=rv(e,t.inputs);nv(t,t.inputs,r)}}}),KA,lN,cN,I9=Ke(()=>{St(),It(),Wr(),Ft(),KA=(t,e,r,n)=>{let s=Se.size(e),i=e.length,o=Ie("input",t,i),a=dt("output",t,i),l=r.dataType===6?r.getInt32Array()[0]:Number(r.getBigInt64Array()[0]),c=Se.normalizeAxis(l,i),u=d=>{let h=` i32(${o.indicesGet("inputIndices","uniforms.axis")}) `,f=gt("uniforms.input_shape","uniforms.axis",i),p=n.reverse?h+(n.exclusive?" + 1":""):"0",m=n.reverse?f:h+(n.exclusive?"":" + 1");return`
                ${d.registerUniform("outputSize","u32").registerUniform("axis","u32").declareVariables(o,a)}
                ${d.mainStart()}
                  ${d.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.outputSize")}
                  var inputIndices = ${a.offsetToIndices("global_idx")};
                  var sum = ${a.type.value}(0);
                  let first : i32 = ${p};
                  let last : i32 = ${m};
                  for (var i : i32 = first; i < last; i++) {
                    ${o.indicesSet("inputIndices","uniforms.axis","u32(i)")};
                    sum = sum + ${o.getByIndices("inputIndices")};
                  }
                  ${a.setByOffset("global_idx","sum")};
                }`};return{name:"CumSum",shaderCache:{hint:n.cacheKey,inputDependencies:["rank"]},getRunData:()=>({outputs:[{dims:e,dataType:t}],dispatchGroup:{x:Math.ceil(s/64)},programUniforms:[{type:12,data:s},{type:12,data:c},...wt(e,e)]}),getShaderSource:u}},lN=(t,e)=>{let r=t.inputs[0].dims,n=t.inputs[0].dataType,s=t.inputs[1];t.compute(KA(n,r,s,e),{inputs:[0]})},cN=t=>{let e=t.exclusive===1,r=t.reverse===1;return or({exclusive:e,reverse:r})}}),XA,qA,YA,uN,dN,F9=Ke(()=>{St(),It(),Wr(),Ft(),XA=t=>{if(!t||t.length!==1)throw new Error("DepthToSpace requires 1 input.");if(t[0].dims.length!==4)throw new Error("DepthToSpace requires 4D input.")},qA=(t,e,r,n)=>{let s=[];s.push(`fn perm(i: ${n.type.indices}) -> ${r.type.indices} {
    var a: ${r.type.indices};`);for(let i=0;i<e;++i)s.push(r.indicesSet("a",t[i],`i[${i}]`));return s.push("return a;}"),s.join(`
`)},YA=(t,e)=>{let r,n,s,i,o,a,l=e.format==="NHWC",c=e.blocksize,u=e.mode==="DCR";l?([r,n,s,i]=t.dims,o=u?[r,n,s,c,c,i/c**2]:[r,n,s,i/c**2,c,c],a=u?[0,1,3,2,4,5]:[0,1,4,2,5,3]):([r,n,s,i]=[t.dims[0],t.dims[2],t.dims[3],t.dims[1]],o=u?[r,c,c,i/c**2,n,s]:[r,i/c**2,c,c,n,s],a=u?[0,3,4,1,5,2]:[0,1,4,2,5,3]);let d=t.reshape(o),h=d.dims.length,f=t.dataType,p=Ie("a",f,h),m=dt("output",f,h),y=g=>`
  ${g.registerUniform("output_size","u32").declareVariables(p,m)}

  ${qA(a,h,p,m)}

  ${g.mainStart()}
    ${g.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}

    let indices = ${m.offsetToIndices("global_idx")};
    let aIndices = perm(indices);

    ${m.setByOffset("global_idx",p.getByIndices("aIndices"))}
  }`;return{name:"DepthToSpace",shaderCache:{hint:`${t.dims};${e.blocksize};${e.mode}`,inputDependencies:["rank"]},getRunData:g=>{let _=l?[r,n*c,s*c,i/c**2]:[r,i/c**2,n*c,s*c],v=Se.size(_),w=d.dims,x=Se.sortBasedOnPerm(w,a);return{outputs:[{dims:_,dataType:g[0].dataType}],dispatchGroup:{x:Math.ceil(v/64)},programUniforms:[{type:12,data:v},...wt(w,x)]}},getShaderSource:y}},uN=(t,e)=>{XA(t.inputs),t.compute(YA(t.inputs[0],e))},dN=t=>or({blocksize:t.blocksize,mode:t.mode,format:t.format})}),Lp,zd,sv,QA,JA,ZA,e$,iv,t$,hN,fN,L9=Ke(()=>{St(),It(),Wr(),Ft(),Lp="[a-zA-Z]|\\.\\.\\.",zd="("+Lp+")+",sv="^"+zd+"$",QA="("+zd+",)*"+zd,JA="^"+QA+"$",ZA=class{constructor(t=-1){this.symbolToIndices=new Map,this.inputIndex=t}addSymbol(t,e){let r=this.symbolToIndices.get(t);r===void 0?r=[e]:r.push(e),this.symbolToIndices.set(t,r)}},e$=class{constructor(t,e){var s;this.equation=e,this.hasEllipsis=!1,this.symbolToInfo=new Map,this.lhs=new Array,this.outputDims=[];let[r,n]=e.includes("->")?e.split("->",2):[e,""];if(!r.match(RegExp(JA)))throw new Error("Invalid LHS term");if(r.split(",").forEach((i,o)=>{let a=t[o].dims.slice();if(!i.match(RegExp(sv)))throw new Error("Invalid LHS term");let l=this.processTerm(i,!0,a,o);this.lhs.push(l)}),n==="")n+=[...this.symbolToInfo.entries()].filter(([i,o])=>o.count===1||i==="...").map(([i])=>i).join("");else if(!n.match(RegExp(zd)))throw new Error("Invalid RHS");(s=n.match(RegExp(Lp,"g")))==null||s.forEach(i=>{if(i==="...")this.outputDims=this.outputDims.concat(this.ellipsisDims);else{let o=this.symbolToInfo.get(i);if(o===void 0)throw new Error("Invalid RHS symbol");this.outputDims.push(o.dimValue)}}),this.rhs=this.processTerm(n,!1,this.outputDims)}addSymbol(t,e,r){let n=this.symbolToInfo.get(t);if(n!==void 0){if(n.dimValue!==e&&n.count!==1)throw new Error("Dimension mismatch");n.count++,n.inputIndices.push(r)}else n={count:1,dimValue:e,inputIndices:[r]};this.symbolToInfo.set(t,n)}processTerm(t,e,r,n=-1){let s=r.length,i=!1,o=[],a=0;if(!t.match(RegExp(sv))&&!e&&t!=="")throw new Error("Invalid LHS term");let l=t.match(RegExp(Lp,"g")),c=new ZA(n);return l==null||l.forEach((u,d)=>{if(u==="..."){if(i)throw new Error("Only one ellipsis is allowed per input term");i=!0;let h=s-l.length+1;if(h<0)throw new Error("Ellipsis out of bounds");if(o=r.slice(a,a+h),this.hasEllipsis){if(this.ellipsisDims.length!==o.length||this.ellipsisDims.toString()!==o.toString())throw new Error("Ellipsis dimensions mismatch")}else if(e)this.hasEllipsis=!0,this.ellipsisDims=o;else throw new Error("Ellipsis must be specified in the LHS");for(let f=0;f<o.length;f++){let p=String.fromCharCode(48+f);c.addSymbol(p,d+f),this.addSymbol(p,r[a++],n)}}else c.addSymbol(u,d+(this.hasEllipsis?this.ellipsisDims.length-1:0)),this.addSymbol(u,r[a++],n)}),c}},iv=t=>t+"_max",t$=(t,e,r,n)=>{let s=t.map(c=>c.length).map((c,u)=>Ie(`input${u}`,e,c)),i=Se.size(n),o=dt("output",e,n.length),a=[...r.symbolToInfo.keys()].filter(c=>!r.rhs.symbolToIndices.has(c)),l=c=>{let u=[],d="var prod = 1.0;",h="var sum = 0.0;",f="sum += prod;",p=[],m=[],y=[],g=[],_=r.symbolToInfo.size===r.rhs.symbolToIndices.size;r.symbolToInfo.forEach((w,x)=>{var M;if(r.rhs.symbolToIndices.has(x)){let T=(M=r.rhs.symbolToIndices.get(x))==null?void 0:M[0];T!==void 0&&r.lhs.forEach((S,k)=>{if(w.inputIndices.includes(k)){let $=S.symbolToIndices.get(x);if($===void 0)throw new Error("Invalid symbol error");$.forEach(j=>{u.push(`${s[k].indicesSet(`input${k}Indices`,j,o.indicesGet("outputIndices",T))}`)})}})}else r.lhs.forEach((T,S)=>{if(w.inputIndices.includes(S)){let k=T.symbolToIndices.get(x);if(k===void 0)throw new Error("Invalid symbol error");k.forEach($=>{p.push(`${s[S].indicesSet(`input${S}Indices`,$,`${x}`)}`)}),g.push(`prod *= ${s[S].getByIndices(`input${S}Indices`)};`)}}),m.push(`for(var ${x}: u32 = 0; ${x} < uniforms.${iv(x)}; ${x}++) {`),y.push("}")});let v=_?[...u,`let sum = ${s.map((w,x)=>w.getByIndices(`input${x}Indices`)).join(" * ")};`]:[...u,h,...m,...p,d,...g,f,...y];return`
            ${c.registerUniforms(a.map(w=>({name:`${iv(w)}`,type:"u32"}))).registerUniform("outputSize","u32").declareVariables(...s,o)}

            ${c.mainStart()}
            ${c.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.outputSize")}
            var outputIndices = ${o.offsetToIndices("global_idx")};
            ${s.map((w,x)=>`var input${x}Indices: ${s[x].type.indices};`).join(`
`)}
            ${v.join(`
`)};
            ${o.setByOffset("global_idx","sum")};
          }`};return{name:"Einsum",shaderCache:{hint:r.equation,inputDependencies:t.map(()=>"rank")},getRunData:()=>{let c=a.filter(d=>r.symbolToInfo.has(d)).map(d=>{var h;return{type:12,data:((h=r.symbolToInfo.get(d))==null?void 0:h.dimValue)||0}});c.push({type:12,data:i});let u=t.map((d,h)=>[...wt(d)]).reduce((d,h)=>d.concat(h),c);return u.push(...wt(n)),{outputs:[{dims:n,dataType:e}],dispatchGroup:{x:Math.ceil(i/64)},programUniforms:u}},getShaderSource:l}},hN=(t,e)=>{let r=new e$(t.inputs,e.equation),n=r.outputDims,s=t.inputs.map((i,o)=>i.dims);t.compute(t$(s,t.inputs[0].dataType,r,n))},fN=t=>{let e=t.equation.replace(/\s+/g,"");return or({equation:e})}}),r$,ov,n$,s$,pN,R9=Ke(()=>{St(),It(),Ft(),r$=t=>{if(!t||t.length!==2)throw new Error("Expand requires 2 input.");let e=t[0].dims,r=Array.from(t[1].getBigInt64Array(),Number),n=r.length<e.length?0:r.length-e.length,s=e.length<r.length?0:e.length-r.length;for(;n<r.length&&s<e.length;++n,++s)if(r[n]!==e[s]&&r[n]!==1&&e[s]!==1)throw new Error("Expand requires shape to be broadcastable to input")},ov=(t,e)=>{let r=t.length-e.length,n=[];for(let s=0;s<r;++s)n.push(t[s]);for(let s=0;s<e.length;++s)n.push(e[s]===1?t[s+r]:e[s]);return n},n$=(t,e)=>t.length>e.length?ov(t,e):ov(e,t),s$=t=>{let e=t[0].dims,r=Array.from(t[1].getBigInt64Array(),Number),n=n$(e,r),s=t[0].dataType,i=s===9||Se.size(e)===1,o=s===9||e.length>0&&e[e.length-1]%4===0?4:1,a=i||n.length>0&&n[n.length-1]%4===0?4:1,l=Math.ceil(Se.size(n)/a),c=d=>{let h=Ie("input",s,e.length,o),f=dt("output",s,n.length,a),p;if(s===9){let m=(y,g,_="")=>`
          let outputIndices${g} = ${f.offsetToIndices(`outputOffset + ${g}u`)};
          let offset${g} = ${h.broadcastedIndicesToOffset(`outputIndices${g}`,f)};
          let index${g} = offset${g} / 4u;
          let component${g} = offset${g} % 4u;
          ${y}[${g}] = ${_}(${h.getByOffset(`index${g}`)}[component${g}]);
        `;p=`
        let outputOffset = global_idx * ${a};
        var data = vec4<u32>(0);
        ${m("data",0,"u32")}
        ${m("data",1,"u32")}
        ${m("data",2,"u32")}
        ${m("data",3,"u32")}
        ${f.setByOffset("global_idx","data")}
      }`}else p=`
        let outputIndices = ${f.offsetToIndices(`global_idx * ${a}`)};
        let inputOffset = ${h.broadcastedIndicesToOffset("outputIndices",f)};
        let data = ${f.type.value}(${h.getByOffset(`inputOffset / ${o}`)});
        ${f.setByOffset("global_idx","data")}
      }`;return`
    ${d.registerUniform("vec_size","u32").declareVariables(h,f)}
    ${d.mainStart()}
    ${d.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.vec_size")}
    ${p}`},u=[{type:12,data:l},...wt(e,n)];return{name:"Expand",shaderCache:{hint:`${n.length};${o}${a}`,inputDependencies:["rank"]},getShaderSource:c,getRunData:()=>({outputs:[{dims:n,dataType:t[0].dataType}],dispatchGroup:{x:Math.ceil(l/64)},programUniforms:u})}},pN=t=>{r$(t.inputs),t.compute(s$(t.inputs),{inputs:[0]})}}),i$,mN,j9=Ke(()=>{St(),It(),Ft(),Pb(),i$=t=>{let e=t[0].dataType,r=Se.size(t[0].dims),n=Se.size(t[1].dims),s=n%4===0,i=o=>{let a=Ie("x",e,[1],4),l=Ie("bias",e,[1],4),c=dt("y",e,[1],4),u=[{name:"output_vec_size",type:"u32"},{name:"bias_size",type:"u32"}],d=f=>`
      let bias${f}_offset: u32 = (global_idx * 4 + ${f}) % uniforms.bias_size;
      let bias${f} = ${l.getByOffset(`bias${f}_offset / 4`)}[bias${f}_offset % 4];`,h=s?`
      let bias = ${l.getByOffset("global_idx % (uniforms.bias_size / 4)")};`:`${d(0)}${d(1)}${d(2)}${d(3)}
      let bias = ${a.type.value}(bias0, bias1, bias2, bias3);`;return`${o.registerUniforms(u).declareVariables(a,l,c)}

    ${fx(Wn(e))}

    ${o.mainStart(ku)}
      ${o.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_vec_size")}

      let x = ${a.getByOffset("global_idx")};
      ${h}
      let x_in = x + bias;
      ${c.setByOffset("global_idx",px("x_in"))}
    }`};return{name:"FastGeluWithBias",shaderCache:{hint:`${s}`,inputDependencies:["type","type"]},getShaderSource:i,getRunData:o=>({outputs:[{dims:o[0].dims,dataType:o[0].dataType}],programUniforms:[{type:12,data:Math.ceil(r/4)},{type:12,data:n}],dispatchGroup:{x:Math.ceil(r/ku/4)}})}},mN=t=>{t.inputs.length<2||Se.size(t.inputs[1].dims)===0?Fj(t):t.compute(i$(t.inputs))}}),o$,a$,gN,_N,N9=Ke(()=>{St(),It(),Wr(),Ft(),o$=t=>{if(!t||t.length!==2)throw new Error("Gather requires 2 inputs.")},a$=(t,e)=>{let r=t[0].dims,n=t[1].dims,s=r.length,i=Se.normalizeAxis(e.axis,s),o=r.slice(0);o.splice(i,1,...n);let a=r[i],l=t[0].dataType===9?4:1,c=Math.ceil(Se.size(o)/l),u=[{type:12,data:c},{type:6,data:a},{type:12,data:i},...wt(t[0].dims,t[1].dims,o)],d=h=>{let f=Ie("data",t[0].dataType,t[0].dims.length,l),p=Ie("inputIndices",t[1].dataType,t[1].dims.length),m=dt("output",t[0].dataType,o.length,l),y=_=>{let v=n.length,w=`var indicesIndices${_}  = ${p.type.indices}(0);`;for(let x=0;x<v;x++)w+=`${v>1?`indicesIndices${_}[${x}]`:`indicesIndices${_}`} = ${o.length>1?`outputIndices${_}[uniforms.axis + ${x}]`:`outputIndices${_}`};`;w+=`
          var idx${_} = ${p.getByIndices(`indicesIndices${_}`)};
          if (idx${_} < 0) {
            idx${_} = idx${_} + uniforms.axisDimLimit;
          }
          var dataIndices${_} : ${f.type.indices};
        `;for(let x=0,M=0;x<s;x++)x===i?(w+=`${s>1?`dataIndices${_}[${x}]`:`dataIndices${_}`} = u32(idx${_});`,M+=v):(w+=`${s>1?`dataIndices${_}[${x}]`:`dataIndices${_}`} = ${o.length>1?`outputIndices${_}[${M}]`:`outputIndices${_}`};`,M++);return w},g;if(t[0].dataType===9){let _=(v,w,x="")=>`
          let outputIndices${w} = ${m.offsetToIndices(`outputOffset + ${w}u`)};
          ${y(w)};
          let offset${w} = ${f.indicesToOffset(`dataIndices${w}`)};
          let index${w} = offset${w} / 4u;
          let component${w} = offset${w} % 4u;
          ${v}[${w}] = ${x}(${f.getByOffset(`index${w}`)}[component${w}]);
        `;g=`
        let outputOffset = global_idx * ${l};
        var value = vec4<u32>(0);
        ${_("value",0,"u32")}
        ${_("value",1,"u32")}
        ${_("value",2,"u32")}
        ${_("value",3,"u32")}
        ${m.setByOffset("global_idx","value")}
      `}else g=`
      let outputIndices = ${m.offsetToIndices("global_idx")};
      ${y("")};
      let value = ${f.getByIndices("dataIndices")};
      ${m.setByOffset("global_idx","value")};
      `;return`
      ${h.registerUniform("outputSize","u32").registerUniform("axisDimLimit","i32").registerUniform("axis","u32").declareVariables(f,p,m)}
      ${h.mainStart()}
        ${h.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.outputSize")}
        ${g}
      }`};return{name:"Gather",shaderCache:{hint:e.cacheKey,inputDependencies:["rank","rank"]},getRunData:()=>({outputs:[{dims:o,dataType:t[0].dataType}],dispatchGroup:{x:Math.ceil(c/64)},programUniforms:u}),getShaderSource:d}},gN=t=>or({axis:t.axis}),_N=(t,e)=>{let r=t.inputs;o$(r),t.compute(a$(t.inputs,e))}}),l$,yN,vN,z9=Ke(()=>{St(),It(),Ft(),l$=(t,e,r,n,s,i,o,a,l)=>{let c=[{type:12,data:i},{type:12,data:n},{type:12,data:s},{type:12,data:r},{type:12,data:o},{type:12,data:a},{type:12,data:l}],u=[i];c.push(...wt(e.dims,u));let d=h=>{let f=Ie("indices_data",e.dataType,e.dims.length),p=dt("input_slice_offsets_data",12,1,1),m=[f,p],y=[{name:"output_size",type:"u32"},{name:"batch_dims",type:"u32"},{name:"input_dims",type:"u32",length:s.length},{name:"sizes_from_slice_dims_data",type:"u32",length:r.length},{name:"num_slices_per_batch",type:"u32"},{name:"input_batch_stride",type:"u32"},{name:"num_slice_dims",type:"u32"}];return`
  ${h.registerUniforms(y).declareVariables(...m)}
  ${h.mainStart()}
    ${h.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}
    let batch_idx = global_idx / uniforms.num_slices_per_batch;
    let base_offset = batch_idx * uniforms.input_batch_stride;

    let slice_indices_base_offset = global_idx * uniforms.num_slice_dims;
    var relative_slice_offset = 0;
    for (var dim_idx = 0u; dim_idx < uniforms.num_slice_dims; dim_idx ++) {
      var index = i32(indices_data[dim_idx + slice_indices_base_offset].x);
      let input_dim_idx = uniforms.batch_dims + dim_idx;
      if (index < 0) {
        ${s.length===1?"index += i32(uniforms.input_dims);":"index += i32(uniforms.input_dims[input_dim_idx]);"}
      }
      ${r.length===1?"relative_slice_offset += index * i32(uniforms.sizes_from_slice_dims_data);":"relative_slice_offset += index * i32(uniforms.sizes_from_slice_dims_data[dim_idx]);"}
    }

    input_slice_offsets_data[global_idx] =  base_offset + u32(relative_slice_offset);
  }`};return t.compute({name:"computeSliceOffsets",shaderCache:{hint:`${s.length}_${r.length}`,inputDependencies:["rank"]},getRunData:()=>({outputs:[{dims:u,dataType:t.inputs[1].dataType}],dispatchGroup:{x:Math.ceil(i/64)},programUniforms:c}),getShaderSource:d},{inputs:[e],outputs:[-1]})[0]},yN=(t,e)=>{let r=t.inputs,n=r[0].dims,s=r[0].dataType,i=r[1].dims,o=i[i.length-1],a=Se.sizeToDimension(i,i.length-1),l=Se.sizeFromDimension(n,e.batchDims+o),c=Se.sizeToDimension(n,e.batchDims),u=Se.sizeFromDimension(n,e.batchDims),d=a/c,h=new Array(o),f=l;for(let w=0;w<o;++w)h[o-1-w]=f,f*=n[e.batchDims+o-1-w];let p=l$(t,r[1],h,e.batchDims,n,a,d,u,o),m=e.batchDims+o;if(m>n.length)throw new Error("last dimension of indices must not be larger than rank of input tensor");let y=i.slice(0,-1).concat(n.slice(m)),g=Se.size(y),_=[{type:12,data:g},{type:12,data:l},...wt(r[0].dims,p.dims,y)],v=w=>{let x=Ie("data",r[0].dataType,r[0].dims.length),M=Ie("slice_offsets",12,p.dims.length),T=dt("output",r[0].dataType,y.length);return`
          ${w.registerUniform("output_size","u32").registerUniform("slice_size","u32").declareVariables(x,M,T)}
            ${w.mainStart()}
            ${w.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}
          let slice_offset = slice_offsets[global_idx / uniforms.slice_size];
          output[global_idx] = data[u32(slice_offset) + global_idx % uniforms.slice_size];
        }`};t.compute({name:"GatherND",shaderCache:{hint:e.cacheKey,inputDependencies:["rank","rank"]},getRunData:()=>({outputs:[{dims:y,dataType:s}],dispatchGroup:{x:Math.ceil(g/64)},programUniforms:_}),getShaderSource:v},{inputs:[r[0],p]})},vN=t=>({batchDims:t.batch_dims,cacheKey:""})}),c$,u$,wN,xN,B9=Ke(()=>{St(),It(),Wr(),Ft(),c$=(t,e)=>{if(t.length<3||t.length>4)throw new Error("GatherBlockQuantized requires 3 or 4 inputs.");let r=Se.normalizeAxis(e.quantizeAxis,t[0].dims.length),n=e.blockSize,s=t[0],i=t[2],o=t.length===4?t[3]:void 0;if(i.dims.length!==s.dims.length||!s.dims.map((a,l)=>l===r?Math.ceil(a/n)===i.dims[l]:a===i.dims[l]).reduce((a,l)=>a&&l,!0))throw new Error("Scales must have the same rank as the input tensor and the dims should match except on gatherAxis.");if(o){if(o.dataType!==s.dataType)throw new Error("Zero point must have the same data type as the input tensor.");if(o.dims.length!==i.dims.length||!o.dims.map((a,l)=>a===i.dims[l]).reduce((a,l)=>a&&l,!0))throw new Error("Zero point must have the same rank as the input tensor and the dims should match except on quantizeAxis.")}},u$=(t,e)=>{let r=t[0].dims,n=t[1].dims,s=r.length,i=Se.normalizeAxis(e.gatherAxis,s),o=Se.normalizeAxis(e.quantizeAxis,s),a=r.slice(0);a.splice(i,1,...n);let l=Se.size(a),c=t[2].dataType,u=t[0].dataType===22,d=[{type:12,data:l},{type:12,data:o},{type:12,data:i},{type:12,data:e.blockSize},...wt(...t.map((f,p)=>f.dims),a)],h=f=>{let p=Ie("data",t[0].dataType,t[0].dims.length),m=Ie("inputIndices",t[1].dataType,t[1].dims.length),y=Ie("scales",t[2].dataType,t[2].dims.length),g=t.length>3?Ie("zeroPoint",t[3].dataType,t[3].dims.length):void 0,_=dt("output",c,a.length),v=[p,m,y];g&&v.push(g);let w=[{name:"output_size",type:"u32"},{name:"quantize_axis",type:"u32"},{name:"gather_axis",type:"u32"},{name:"block_size",type:"u32"}];return`
        ${f.registerUniforms(w).declareVariables(...v,_)}
        ${f.mainStart()}
        let output_indices = ${_.offsetToIndices("global_idx")};
        var indices_indices = ${m.type.indices}(0);
        ${n.length>1?`
          for (var i: u32 = 0; i < ${n.length}; i++) {
            let index = ${_.indicesGet("output_indices","uniforms.gather_axis + i")};
            ${m.indicesSet("indices_indices","i","index")};
          }`:`indices_indices = ${_.indicesGet("output_indices","uniforms.gather_axis")};`};
        var data_indices = ${p.type.indices}(0);
        for (var i: u32 = 0; i < uniforms.gather_axis; i++) {
          let index = ${_.indicesGet("output_indices","i")};
          ${p.indicesSet("data_indices","i","index")};
        }
        var index_from_indices = ${m.getByIndices("indices_indices")};
        if (index_from_indices < 0) {
          index_from_indices += ${r[i]};
        }
        ${p.indicesSet("data_indices","uniforms.gather_axis","u32(index_from_indices)")};
        for (var i = uniforms.gather_axis + 1; i < ${a.length}; i++) {
          let index = ${_.indicesGet("output_indices",`i + ${n.length} - 1`)};
          ${p.indicesSet("data_indices","i","index")};
        }
        let data_offset = ${p.indicesToOffset("data_indices")};
        let data_index = data_offset % 8;
        // Convert 4-bit packed data to 8-bit packed data.
        let packed_4bit_quantized_data = ${p.getByOffset("data_offset / 8")};
        let packed_8bit_quantized_data = (packed_4bit_quantized_data >> (4 * (data_index % 2))) & 0x0f0f0f0f;
        let quantized_data_vec = ${u?"unpack4xI8":"unpack4xU8"}(u32(packed_8bit_quantized_data));
        let quantized_data = quantized_data_vec[data_index / 2];
        var scale_indices = data_indices;
        let quantize_axis_index = ${y.indicesGet("data_indices","uniforms.quantize_axis")} / uniforms.block_size;
        ${y.indicesSet("scale_indices","uniforms.quantize_axis","quantize_axis_index")};
        var scale = ${y.getByIndices("scale_indices")};
        ${g?`
              let zero_point_indices = scale_indices;
              let zero_point_offset = ${g.indicesToOffset("zero_point_indices")};
              let zero_point_index = zero_point_offset % 8;
              let packed_4bit_zero_points = ${g.getByOffset("zero_point_offset / 8")};
              let packed_8bit_zero_points = (packed_4bit_zero_points >> (4 * (zero_point_index % 2))) & 0x0f0f0f0f;
              let zero_point_vec = ${u?"unpack4xI8":"unpack4xU8"}(u32(packed_8bit_zero_points));
              let zero_point = zero_point_vec[zero_point_index / 2];`:"var zero_point = 0"};
        let dequantized_data = ${Wn(c)}(quantized_data - zero_point) * scale;
        ${_.setByOffset("global_idx","dequantized_data")};
    }`};return{name:"GatherBlockQuantized",shaderCache:{hint:`${e.cacheKey};${t.filter((f,p)=>p!==1).map(f=>f.dims.join("_")).join(";")}`,inputDependencies:Array.from({length:t.length},(f,p)=>"rank")},getRunData:()=>({outputs:[{dims:a,dataType:c}],dispatchGroup:{x:Math.ceil(l/64)},programUniforms:d}),getShaderSource:h}},wN=(t,e)=>{let r=t.inputs;c$(r,e),t.compute(u$(t.inputs,e))},xN=t=>or({blockSize:t.blockSize,gatherAxis:t.gatherAxis,quantizeAxis:t.quantizeAxis})}),d$,h$,bN,MN,V9=Ke(()=>{St(),It(),Wr(),Ft(),d$=t=>{if(!t||t.length!==2)throw new Error("GatherElements requires 2 inputs.");if(t[0].dims.length<1)throw new Error("GatherElements requires that the data input be rank >= 1.");if(t[0].dims.length!==t[1].dims.length)throw new Error(`GatherElements requires that the data input and
                     indices input tensors be of same rank.`)},h$=(t,e)=>{let r=t[0].dims,n=t[0].dataType,s=r.length,i=t[1].dims,o=t[1].dataType,a=Se.normalizeAxis(e.axis,s),l=r[a],c=i.slice(0),u=Se.size(c),d=Ie("input",n,s),h=Ie("indicesInput",o,i.length),f=dt("output",n,c.length),p=[{type:12,data:u},{type:6,data:l},{type:12,data:a}];return p.push(...wt(r,i,c)),{name:"GatherElements",shaderCache:{inputDependencies:["rank","rank"]},getRunData:()=>({outputs:[{dims:c,dataType:t[0].dataType}],dispatchGroup:{x:Math.ceil(u/64)},programUniforms:p}),getShaderSource:m=>`
      ${m.registerUniform("outputSize","u32").registerUniform("axisDimLimit","i32").registerUniform("axis","u32").declareVariables(d,h,f)}
      ${m.mainStart()}
      ${m.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.outputSize")}

      let outputIndices = ${f.offsetToIndices("global_idx")};

      var idx = ${h.getByOffset("global_idx")};
      if (idx < 0) {
        idx = idx + uniforms.axisDimLimit;
      }
      var inputIndices = ${d.type.indices}(outputIndices);
      ${d.indicesSet("inputIndices","uniforms.axis","u32(idx)")};
      let value = ${d.getByIndices("inputIndices")};

      ${f.setByOffset("global_idx","value")};
  }`}},bN=t=>or({axis:t.axis}),MN=(t,e)=>{let r=t.inputs;d$(r),t.compute(h$(t.inputs,e))}}),f$,p$,TN,CN,W9=Ke(()=>{St(),It(),Ft(),f$=t=>{if(!t)throw new Error("Input is missing");if(t.length<2||t.length>3)throw new Error("Invaid input number.");if(t.length===3&&t[2].dims.length>2)throw new Error("Invalid input shape of C");if(t[0].dataType!==t[1].dataType||t.length===3&&t[0].dataType!==t[2].dataType)throw new Error("Input types are mismatched")},p$=(t,e)=>{let r=t[0].dims.slice(),n=t[1].dims.slice(),[s,i,o]=b3.getShapeOfGemmResult(r,e.transA,n,e.transB,t.length===3?t[2].dims:void 0),a=[s,i];if(!a)throw new Error("Can't use gemm on the given tensors");let l=16,c=Math.ceil(i/l),u=Math.ceil(s/l),d=!0,h=Se.size(a),f=[{type:12,data:d?c:h},{type:12,data:s},{type:12,data:i},{type:12,data:o},{type:1,data:e.alpha},{type:1,data:e.beta}],p=["type","type"];t.length===3&&(f.push(...wt(t[2].dims)),p.push("rank")),f.push(...wt(a));let m=g=>{let _="";e.transA&&e.transB?_="value += a[k * uniforms.M + m] * b[n * uniforms.K + k];":e.transA&&!e.transB?_="value += a[k * uniforms.M + m] * b[k * uniforms.N + n];":!e.transA&&e.transB?_="value += a[m * uniforms.K + k] * b[n * uniforms.K + k];":!e.transA&&!e.transB&&(_="value += a[m * uniforms.K + k] * b[k * uniforms.N + n];");let v=e.alpha===1?"":"value *= uniforms.alpha;",w=Ie("a",t[0].dataType,t[0].dims),x=Ie("b",t[1].dataType,t[1].dims),M=w.type.value,T=null,S=[w,x];t.length===3&&(T=Ie("c",t[2].dataType,t[2].dims.length),S.push(T));let k=dt("output",t[0].dataType,a.length);S.push(k);let $=[{name:"output_size",type:"u32"},{name:"M",type:"u32"},{name:"N",type:"u32"},{name:"K",type:"u32"},{name:"alpha",type:"f32"},{name:"beta",type:"f32"}];return`
  ${g.registerUniforms($).declareVariables(...S)}

  ${g.mainStart()}
    ${g.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}

    let m = global_idx / uniforms.N;
    let n = global_idx % uniforms.N;

    var value = ${M}(0);
    for (var k: u32 = 0u; k < uniforms.K; k++) {
      ${_}
    }

    ${v}
    ${T!=null?`let cOffset = ${T.broadcastedIndicesToOffset("vec2(m, n)",k)}; value += ${M}(uniforms.beta) * ${T.getByOffset("cOffset")};`:""}
    output[global_idx] = value;
  }`},y=g=>{let _=Ie("a",t[0].dataType,t[0].dims),v=Ie("b",t[1].dataType,t[1].dims),w=null,x=[_,v];t.length===3&&(w=Ie("c",t[2].dataType,t[2].dims.length),x.push(w));let M=dt("output",t[0].dataType,a.length);x.push(M);let T=[{name:"num_tile_n",type:"u32"},{name:"M",type:"u32"},{name:"N",type:"u32"},{name:"K",type:"u32"},{name:"alpha",type:"f32"},{name:"beta",type:"f32"}],S="",k="";e.transA&&e.transB?(k=`
      var col = tile_row_start + local_id.x;
      var row = k_start + local_id.y;
      if (col < uniforms.M && row < uniforms.K) {
        tile_a[local_id.y][local_id.x] = a[row * uniforms.M + col];
      } else {
        tile_a[local_id.y][local_id.x] = ${_.type.value}(0);
      }

      col = k_start + local_id.x;
      row = tile_col_start + local_id.y;
      if (col < uniforms.K && row < uniforms.N) {
        tile_b[local_id.y][local_id.x] = b[row * uniforms.K + col];
      } else {
        tile_b[local_id.y][local_id.x] = ${v.type.value}(0);
      }
      `,S="value += tile_a[k][local_id.y] * tile_b[local_id.x][k];"):e.transA&&!e.transB?(k=`
      var col = tile_row_start + local_id.x;
      var row = k_start + local_id.y;
      if (col < uniforms.M && row < uniforms.K) {
        tile_a[local_id.y][local_id.x] = a[row * uniforms.M + col];
      } else {
        tile_a[local_id.y][local_id.x] = ${_.type.value}(0);
      }

      col = tile_col_start + local_id.x;
      row = k_start + local_id.y;
      if (col < uniforms.N && row < uniforms.K) {
        tile_b[local_id.y][local_id.x] = b[row * uniforms.N + col];
      } else {
        tile_b[local_id.y][local_id.x] = ${v.type.value}(0);
      }
      `,S="value += tile_a[k][local_id.y] * tile_b[k][local_id.x];"):!e.transA&&e.transB?(k=`
      var col = k_start + local_id.x;
      var row = tile_row_start + local_id.y;
      if (col < uniforms.K && row < uniforms.M) {
        tile_a[local_id.y][local_id.x] = a[row * uniforms.K + col];
      } else {
        tile_a[local_id.y][local_id.x] = ${_.type.value}(0);
      }

      col = k_start + local_id.x;
      row = tile_col_start + local_id.y;
      if (col < uniforms.K && row < uniforms.N) {
        tile_b[local_id.y][local_id.x] = b[row * uniforms.K + col];
      } else {
        tile_b[local_id.y][local_id.x] = ${v.type.value}(0);
      }
      `,S="value += tile_a[local_id.y][k] * tile_b[local_id.x][k];"):!e.transA&&!e.transB&&(k=`
      var col = k_start + local_id.x;
      var row = tile_row_start + local_id.y;
      if (col < uniforms.K && row < uniforms.M) {
        tile_a[local_id.y][local_id.x] = a[row * uniforms.K + col];
      } else {
        tile_a[local_id.y][local_id.x] = ${_.type.value}(0);
      }

      col = tile_col_start + local_id.x;
      row = k_start + local_id.y;
      if (col < uniforms.N && row < uniforms.K) {
        tile_b[local_id.y][local_id.x] = b[row * uniforms.N + col];
      } else {
        tile_b[local_id.y][local_id.x] = ${v.type.value}(0);
      }
      `,S="value += tile_a[local_id.y][k] * tile_b[k][local_id.x];");let $=e.alpha===1?"":"value *= uniforms.alpha;";return`
  ${g.registerUniforms(T).declareVariables(...x)}
  var<workgroup> tile_a: array<array<${_.type.storage}, ${l}>, ${l}>;
  var<workgroup> tile_b: array<array<${v.type.storage}, ${l}>, ${l}>;
  ${g.mainStart([l,l,1])}
    let tile_col_start = (workgroup_index % uniforms.num_tile_n) * ${l};
    let tile_row_start = (workgroup_index / uniforms.num_tile_n) * ${l};
    let num_tiles = (uniforms.K - 1) / ${l} + 1;
    var k_start = 0u;
    var value = ${M.type.value}(0);
    for (var t: u32 = 0u; t < num_tiles; t++) {
      ${k}
      k_start = k_start + ${l};
      workgroupBarrier();

      for (var k: u32 = 0u; k < ${l}; k++) {
        ${S}
      }
      workgroupBarrier();
    }

    ${$}
    let m = tile_row_start + local_id.y;
    let n = tile_col_start + local_id.x;
    ${w!=null?`let cOffset = ${w.broadcastedIndicesToOffset("vec2(m, n)",M)}; value += ${M.type.value}(uniforms.beta) * ${w.getByOffset("cOffset")};`:""}
    if (m < uniforms.M && n < uniforms.N) {
      output[m * uniforms.N + n] = value;
    }
  }`};return d?{name:"GemmShared",shaderCache:{hint:`${e.cacheKey}`,inputDependencies:p},getRunData:()=>({outputs:[{dims:a,dataType:t[0].dataType}],dispatchGroup:{x:c*u},programUniforms:f}),getShaderSource:y}:{name:"Gemm",shaderCache:{hint:`${e.cacheKey}`,inputDependencies:p},getRunData:()=>({outputs:[{dims:a,dataType:t[0].dataType}],dispatchGroup:{x:Math.ceil(h/64)},programUniforms:f}),getShaderSource:m}},TN=t=>{let e=t.transA,r=t.transB,n=t.alpha,s=t.beta;return{transA:e,transB:r,alpha:n,beta:s,cacheKey:`${t.transA};${t.transB};${t.alpha===1}`}},CN=(t,e)=>{f$(t.inputs),t.compute(p$(t.inputs,e))}}),Zi,vo,yl,vl,m$,g$,_$,y$,v$,w$,x$,b$,SN,EN,U9=Ke(()=>{St(),It(),Wr(),Ft(),[Zi,vo,yl,vl]=[0,1,2,3],m$=t=>{if(t[0].dims.length!==4)throw new Error("only 4-D tensor is supported.");if(t[0].dims.length!==t[1].dims.length)throw new Error("input dimensions must be equal to grid dimensions");if(t[0].dims.length-2!==t[1].dims[t[1].dims.length-1])throw new Error(`last dimension of grid must be equal to ${t[0].dims.length-2}`);if(t[0].dims[0]!==t[1].dims[0])throw new Error("grid batch size must match input batch size")},g$=`
  fn gs_get_cubic_coeffs(x: f32) -> vec4<f32> {
    let cubic_alpha = -0.75f;
    let x_abs = abs(x);
    var coeffs: vec4<f32>;
    coeffs[0] = (((cubic_alpha * (x_abs + 1) - 5 * cubic_alpha) * (x_abs + 1) + 8 * cubic_alpha) * (x_abs + 1) - 4 * cubic_alpha);
    coeffs[1] = (((cubic_alpha + 2) * x_abs - (cubic_alpha + 3)) * x_abs * x_abs + 1);
    coeffs[2] = (((cubic_alpha + 2) * (1 - x_abs) - (cubic_alpha + 3)) * (1 - x_abs) * (1 - x_abs) + 1);
    coeffs[3] = (((cubic_alpha * (2 - x_abs) - 5 * cubic_alpha) * (2 - x_abs) + 8 * cubic_alpha) * (2 - x_abs) - 4 * cubic_alpha);
    return coeffs;
  }
`,_$=t=>`
  fn gs_bicubic_interpolate(p: mat4x4<${t}>, x: f32, y: f32) -> ${t} {
    var v: vec4<f32>;
    var coeffs = gs_get_cubic_coeffs(x);
    for (var i = 0; i < 4; i++) {
      v[i] = coeffs[0] * p[i][0] + coeffs[1] * p[i][1] + coeffs[2] * p[i][2] + coeffs[3] * p[i][3];
    }
    coeffs = gs_get_cubic_coeffs(y);
    let pixel = ${t}(coeffs[0] * v[0] + coeffs[1] * v[1] + coeffs[2] * v[2] + coeffs[3] * v[3]);
    return pixel;
  }
`,y$=t=>`
  fn gs_denormalize(n: f32, length: i32) -> f32 {
    ${t.alignCorners===0?`
    // alignCorners: false => [-1, 1] to [-0.5, length - 0.5]
    return ((n + 1.0) * f32(length) - 1.0) / 2.0;
    `:`
    // alignCorners: true => [-1, 1] to [0, length - 1]
    return (n + 1.0) / 2.0 * (f32(length - 1));
    `}
  }
`,v$=t=>`
  ${t.paddingMode==="reflection"?`
      fn gs_reflect(x: i32, x_min: f32, x_max: f32) -> u32 {
        var dx = 0.0;
        var fx = f32(x);
        let range = x_max - x_min;
        if (fx < x_min) {
          dx = x_min - fx;
          let n = u32(dx / range);
          let r = dx - f32(n) * range;
          if (n % 2 == 0) {
            fx = x_min + r;
          } else {
            fx = x_max - r;
          }
        } else if (fx > x_max) {
          dx = fx - x_max;
          let n = u32(dx / range);
          let r = dx - f32(n) * range;
          if (n % 2 == 0) {
            fx = x_max - r;
          } else {
            fx = x_min + r;
          }
        }
        return u32(fx);
      }`:""}
`,w$=(t,e,r)=>`
  fn pixel_at_grid(r: i32, c: i32, H: i32, W: i32, batch: u32, channel: u32, border: vec4<f32>) -> ${e} {
     var pixel = ${e}(0);
     var indices = vec4<u32>(0);
     indices[${Zi}] = batch;
     indices[${vo}] = channel;`+(()=>{switch(r.paddingMode){case"zeros":return`
          if (r >= 0 && r < H && c >=0 && c < W) {
            indices[${yl}] = u32(r);
            indices[${vl}] = u32(c);
          } else {
            return ${e}(0);
          }
        `;case"border":return`
          indices[${yl}] = u32(clamp(r, 0, H - 1));
          indices[${vl}] = u32(clamp(c, 0, W - 1));
        `;case"reflection":return`
          indices[${yl}] = gs_reflect(r, border[1], border[3]);
          indices[${vl}] = gs_reflect(c, border[0], border[2]);
        `;default:throw new Error(`padding mode ${r.paddingMode} is not supported`)}})()+`
    return ${t.getByIndices("indices")};
  }
`,x$=(t,e,r)=>(()=>{switch(r.mode){case"nearest":return`
          let result = pixel_at_grid(i32(round(y)), i32(round(x)), H_in, W_in, indices[${Zi}], indices[${vo}], border);
        `;case"bilinear":return`
          let x1 = i32(floor(x));
          let y1 = i32(floor(y));
          let x2 = x1 + 1;
          let y2 = y1 + 1;

          let p11 = pixel_at_grid(y1, x1, H_in, W_in, indices[${Zi}], indices[${vo}], border);
          let p12 = pixel_at_grid(y1, x2, H_in, W_in, indices[${Zi}], indices[${vo}], border);
          let p21 = pixel_at_grid(y2, x1, H_in, W_in, indices[${Zi}], indices[${vo}], border);
          let p22 = pixel_at_grid(y2, x2, H_in, W_in, indices[${Zi}], indices[${vo}], border);

          let dx2 = ${e}(f32(x2) - x);
          let dx1 = ${e}(x - f32(x1));
          let dy2 = ${e}(f32(y2) - y);
          let dy1 = ${e}(y - f32(y1));
          let result = dy2 * (dx2 * p11 + dx1 * p12) + dy1 * (dx2 * p21 + dx1 * p22);
        `;case"bicubic":return`
          let x0 = i32(floor(x)) - 1;
          let y0 = i32(floor(y)) - 1;
          var p: mat4x4<${e}>;
          for (var h = 0; h < 4; h++) {
            for (var w = 0; w < 4; w++) {
              p[h][w] = pixel_at_grid(h + y0, w + x0, H_in, W_in, indices[${Zi}], indices[${vo}], border);
            }
          }

          let dx = x - f32(x0 + 1);
          let dy = y - f32(y0 + 1);
          let result = gs_bicubic_interpolate(p, dx, dy);
        `;default:throw new Error(`mode ${r.mode} is not supported`)}})()+`${t.setByOffset("global_idx","result")}`,b$=(t,e)=>{let r=Ie("x",t[0].dataType,t[0].dims.length),n=[t[1].dims[0],t[1].dims[1],t[1].dims[2]],s=Ie("grid",t[1].dataType,n.length,2),i=[t[0].dims[0],t[0].dims[1],t[1].dims[1],t[1].dims[2]];e.format==="NHWC"&&(i=[t[0].dims[0],t[1].dims[1],t[1].dims[2],t[0].dims[3]],[Zi,vo,yl,vl]=[0,3,1,2]);let o=dt("output",t[0].dataType,i.length),a=r.type.value,l=Se.size(i),c=[{type:12,data:l},...wt(t[0].dims,n,i)],u=d=>`
  ${d.registerUniform("output_size","u32").declareVariables(r,s,o)}
  ${g$}
  ${_$(a)}
  ${y$(e)}
  ${v$(e)}
  ${w$(r,a,e)}

  ${d.mainStart()}
    ${d.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}
      let H_in = i32(uniforms.x_shape[${yl}]);
      let W_in = i32(uniforms.x_shape[${vl}]);

      ${e.alignCorners===0?`
      let x_min = -0.5;
      let x_max = f32(W_in) - 0.5;
      let y_min = -0.5;
      let y_max = f32(H_in) - 0.5;
      `:`
      let x_min = 0.0;
      let x_max = f32(W_in) - 1.0;
      let y_min = 0.0;
      let y_max = f32(H_in) - 1.0;
      `};
      let border = vec4<f32>(x_min, y_min, x_max, y_max);

      let indices = ${o.offsetToIndices("global_idx")};
      var grid_indices = vec3<u32>(indices[${Zi}], indices[${yl}], indices[${vl}]);
      let nxy = ${s.getByIndices("grid_indices")};
      var x = gs_denormalize(f32(nxy[0]), W_in);
      var y = gs_denormalize(f32(nxy[1]), H_in);

      ${x$(o,a,e)}
  }`;return{name:"GridSample",shaderCache:{hint:`${e.cacheKey}`,inputDependencies:["type","type"]},getRunData:d=>{let h=Se.size(i);return{outputs:[{dims:i,dataType:d[0].dataType}],dispatchGroup:{x:Math.ceil(h/64)},programUniforms:c}},getShaderSource:u}},SN=(t,e)=>{m$(t.inputs),t.compute(b$(t.inputs,e))},EN=t=>or({alignCorners:t.align_corners,mode:t.mode,paddingMode:t.padding_mode,format:t.format})}),Yn,M$,PN,av,T$,eh,kN,AN=Ke(()=>{St(),It(),Wr(),Tb(),Eb(),Ft(),Ka(),Yn=(t,e)=>t.length>e&&t[e].dims.length>0?t[e]:void 0,M$=(t,e)=>{let r=t[0],n=Yn(t,1),s=Yn(t,2),i=Yn(t,3),o=Yn(t,4),a=Yn(t,5),l=Yn(t,6),c=Yn(t,7);if(r.dims.length!==3&&r.dims.length!==5)throw new Error("Input query is expected to have 3 or 5 dimensions");let u=r.dims[0],d=r.dims[1],h=r.dims.length===3?r.dims[2]:e.numHeads*r.dims[4],f=d,p=0,m=0,y=Math.floor(h/e.numHeads);if(l&&c&&Se.size(l.dims)&&Se.size(c.dims)){if(l.dims.length!==4)throw new Error('Input "past_key" is expected to have 4 dimensions');if(l.dims[0]!==u||l.dims[1]!==e.numHeads||l.dims[3]!==y)throw new Error('Input "past_key" shape (batch_size, num_heads, past_sequence_length, head_size)');if(c.dims[0]!==u||c.dims[1]!==e.numHeads||c.dims[3]!==y)throw new Error('Input "past_value" shape (batch_size, num_heads, past_sequence_length, head_size)');if(l.dims[2]!==c.dims[2])throw new Error('Input "past_key" and "past_value" shall have same dim 2 (past_sequence_length)');if(c.dims.length!==4)throw new Error('Input "past_value" is expected to have 4 dimensions');p=l.dims[2],m=l.dims[2]}else if(l&&Se.size(l.dims)||c&&Se.size(c.dims))throw new Error('Input "past_key" and "past_value" shall be both present or both absent');let g;if(n&&Se.size(n.dims)>0){if(r.dims.length!==3)throw new Error('Input "query" is expected to have 3 dimensions when key is given');if(n.dims.length<3||n.dims.length>5)throw new Error('Input "key" is expected to have 3, 4, or 5 dimensions');if(r.dims[0]!==n.dims[0])throw new Error('Input "query" and "key" shall have same dim 0 (batch size)');if(n.dims.length===3){if(n.dims[2]!==r.dims[2])throw new Error('Input "query" and "key" shall have same dim 2 (hidden_size)');g=2,f=n.dims[1]}else if(n.dims.length===5){if(n.dims[2]!==e.numHeads||n.dims[3]!==2||n.dims[4]!==y)throw new Error('Expect "key" shape (batch_size, kv_sequence_length, num_heads, 2, head_size) for packed kv');if(s)throw new Error('Expect "value" be none when "key" has packed kv format.');g=5,f=n.dims[1]}else{if(n.dims[1]!==e.numHeads||n.dims[3]!==y)throw new Error('Expect "key" shape (batch_size, num_heads, kv_sequence_length, head_size) for past_key');g=0,f=n.dims[2]}}else{if(r.dims.length!==5)throw new Error('Input "query" is expected to have 5 dimensions when key is empty');if(r.dims[2]!==e.numHeads||r.dims[3]!==3)throw new Error('Expect "query" shape (batch_size, kv_sequence_length, num_heads, 3, head_size) for packed kv');g=3}if(i&&Se.size(i.dims)>0){if(i.dims.length!==1)throw new Error('Input "bias" is expected to have 1 dimension');if(n&&n.dims.length===5&&n.dims[3]===2)throw new Error("bias is not allowed for packed kv.")}let _=p+f,v=0;if(o&&Se.size(o.dims)>0){v=8;let T=o.dims;throw T.length===1?T[0]===u?v=1:T[0]===3*u+2&&(v=3):T.length===2&&T[0]===u&&T[1]===_&&(v=5),v===8?new Error('Input "key_padding_mask" shape shall be (batch_size) or (batch_size, total_sequence_length)'):new Error("Mask not supported")}let w=!1,x=h;if(s&&Se.size(s.dims)>0){if(s.dims.length!==3&&s.dims.length!==4)throw new Error('Input "value" is expected to have 3 or 4 dimensions');if(r.dims[0]!==s.dims[0])throw new Error('Input "query" and "value" shall have same dim 0 (batch_size)');if(s.dims.length===3){if(f!==s.dims[1])throw new Error('Input "key" and "value" shall have the same dim 1 (kv_sequence_length)');x=s.dims[2]}else{if(f!==s.dims[2])throw new Error('Input "key" and "value" shall have the same dim 2 (kv_sequence_length)');x=s.dims[1]*s.dims[3],w=!0}}let M=!1;if(o&&Se.size(o.dims)>0)throw new Error("Key padding mask is not supported");if(a&&Se.size(a.dims)>0){if(a.dims.length!==4)throw new Error('Input "attention_bias" is expected to have 4 dimensions');if(a.dims[0]!==u||a.dims[1]!==e.numHeads||a.dims[2]!==d||a.dims[3]!==_)throw new Error('Expect "attention_bias" shape (batch_size, num_heads, sequence_length, total_sequence_length)')}return{batchSize:u,sequenceLength:d,pastSequenceLength:p,kvSequenceLength:f,totalSequenceLength:_,maxSequenceLength:m,inputHiddenSize:0,hiddenSize:h,vHiddenSize:x,headSize:y,vHeadSize:Math.floor(x/e.numHeads),numHeads:e.numHeads,isUnidirectional:!1,pastPresentShareBuffer:!1,maskFilterValue:e.maskFilterValue,maskType:v,scale:e.scale,broadcastResPosBias:M,passPastInKv:w,qkvFormat:g}},PN=t=>or({...t}),av=or({perm:[0,2,1,3]}),T$=(t,e,r,n,s,i,o)=>{let a=[n,s,i],l=Se.size(a),c=[{type:12,data:l},{type:12,data:o},{type:12,data:i}],u=d=>{let h=dt("qkv_with_bias",e.dataType,a),f=Ie("qkv",e.dataType,a),p=Ie("bias",r.dataType,a),m=[{name:"output_size",type:"u32"},{name:"bias_offset",type:"u32"},{name:"hidden_size",type:"u32"}];return`
  ${d.registerUniforms(m).declareVariables(f,p,h)}
  ${d.mainStart()}
    ${d.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}
    let bias_offset_idx = (global_idx % uniforms.hidden_size) + uniforms.bias_offset;

    qkv_with_bias[global_idx] = qkv[global_idx] + bias[bias_offset_idx];
  }`};return t.compute({name:"MultiHeadAttentionAddBias",shaderCache:{inputDependencies:["type","type"]},getRunData:()=>({outputs:[{dims:a,dataType:e.dataType,gpuDataType:0}],dispatchGroup:{x:Math.ceil(l/64)},programUniforms:c}),getShaderSource:u},{inputs:[e,r],outputs:[-1]})[0]},eh=(t,e,r,n,s,i,o,a)=>{let l=i;if(o&&Se.size(o.dims)>0){if(n===1)throw new Error("AddBiasReshape is not implemented. Please export your model with packed QKV or KV");return l=T$(t,i,o,e,n,r*s,a),l=l.reshape([e,n,r,s]),r===1||n===1?l:t.compute(Fs(l,av.perm),{inputs:[l],outputs:[-1]})[0]}else return i.dims.length===3&&(l=i.reshape([e,n,r,s])),r===1||n===1?l:t.compute(Fs(l,av.perm),{inputs:[l],outputs:[-1]})[0]},kN=(t,e)=>{let r=M$(t.inputs,e),n=t.inputs[0],s=Yn(t.inputs,1),i=Yn(t.inputs,2),o=Yn(t.inputs,3),a=Yn(t.inputs,4),l=Yn(t.inputs,5),c=Yn(t.inputs,6),u=Yn(t.inputs,7);if(n.dims.length===5)throw new Error("Packed QKV is not implemented");if((s==null?void 0:s.dims.length)===5)throw new Error("Packed KV is not implemented");let d=s&&i&&s.dims.length===4&&i.dims.length===4,h=eh(t,r.batchSize,r.numHeads,r.sequenceLength,r.headSize,n,o,0);if(d)return Vh(t,h,s,i,a,void 0,c,u,l,r);if(!s||!i)throw new Error("key and value must be provided");let f=eh(t,r.batchSize,r.numHeads,r.kvSequenceLength,r.headSize,s,o,r.hiddenSize),p=eh(t,r.batchSize,r.numHeads,r.kvSequenceLength,r.vHeadSize,i,o,2*r.hiddenSize);Vh(t,h,f,p,a,void 0,c,u,l,r)}}),C$,S$,E$,P$,vx,$N,ON,DN=Ke(()=>{St(),It(),Wr(),Ft(),C$=t=>{if(!t||t.length<1)throw new Error("too few inputs")},S$=(t,e)=>{let r=[],n=e.numOutputs;return t[1].dims[0]>0&&(t[1].getBigInt64Array().forEach(s=>r.push(Number(s))),n=r.length),or({numOutputs:n,axis:e.axis,splitSizes:r})},E$=t=>`
fn calculateOutputIndex(index: u32) -> u32 {
    for (var i: u32 = 0u; i < ${t}u; i += 1u ) {
    if (index < ${gt("uniforms.size_in_split_axis","i",t)}) {
        return i;
    }
    }
    return ${t}u;
}`,P$=t=>{let e=t.length,r=[];for(let n=0;n<e;++n){let s=t[n].setByIndices("indices","input[global_idx]");e===1?r.push(s):n===0?r.push(`if (output_number == ${n}u) { ${s} }`):n===e-1?r.push(`else { ${s} }`):r.push(`else if (output_number == ${n}) { ${s} }`)}return`
      fn writeBufferData(output_number: u32, indices: ${t[0].type.indices}, global_idx: u32) {
        ${r.join(`
`)}
      }`},vx=(t,e)=>{let r=t[0].dims,n=Se.size(r),s=t[0].dataType,i=Se.normalizeAxis(e.axis,r.length),o=new Array(e.numOutputs),a=Ie("input",s,r.length),l=new Array(e.numOutputs),c=[],u=[],d=0,h=[{type:12,data:n}];for(let p=0;p<e.numOutputs;p++){d+=e.splitSizes[p],l[p]=d;let m=r.slice();m[i]=e.splitSizes[p],u.push(m),o[p]=dt(`output${p}`,s,m.length),c.push({dims:u[p],dataType:t[0].dataType})}h.push({type:12,data:l},...wt(r,...u));let f=p=>`
  ${p.registerUniform("input_size","u32").registerUniform("size_in_split_axis","u32",l.length).declareVariables(a,...o)}
  ${E$(l.length)}
  ${P$(o)}

  ${p.mainStart()}
    ${p.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.input_size")}

    var indices = ${a.offsetToIndices("global_idx")};
    var index = ${a.indicesGet("indices",i)};
    let output_number = calculateOutputIndex(index);
    if (output_number != 0) {
      index -= ${gt("uniforms.size_in_split_axis","output_number - 1u",l.length)};
      ${a.indicesSet("indices",i,"index")};
    }
    writeBufferData(output_number, indices, global_idx);
  }`;return{name:"Split",shaderCache:{hint:e.cacheKey,inputDependencies:["rank"]},getShaderSource:f,getRunData:()=>({outputs:c,dispatchGroup:{x:Math.ceil(n/64)},programUniforms:h})}},$N=(t,e)=>{C$(t.inputs);let r=t.inputs.length===1?e:S$(t.inputs,e);t.compute(vx(t.inputs,r),{inputs:[0]})},ON=t=>{let e=t.axis,r=t.splitSizes,n=t.numOutputs<0?r.length:t.numOutputs;if(n!==r.length)throw new Error("numOutputs and splitSizes lengh must be equal");return or({axis:e,numOutputs:n,splitSizes:r})}}),k$,Cg,IN,FN=Ke(()=>{St(),It(),Wr(),Ft(),k$=(t,e)=>{let[r,n,s,i]=t,{numHeads:o,rotaryEmbeddingDim:a}=e;if(r.dims.length!==3&&r.dims.length!==4)throw new Error(`Input 'x' is expected to have 3 or 4 dimensions, got ${r.dims.length}`);if(!Se.areEqual(n.dims,[])&&!Se.areEqual(n.dims,[1])&&n.dims.length!==2)throw new Error(`Input 'position_ids' is expected to have 0, 1, or 2 dimensions, got ${n.dims.length}`);if(s.dims.length!==2)throw new Error(`Input 'cos_cache' is expected to have 2 dimensions, got ${s.dims.length}`);if(i.dims.length!==2)throw new Error(`Input 'sin_cache' is expected to have 2 dimensions, got ${i.dims.length}`);if(!Se.areEqual(s.dims,i.dims))throw new Error("Inputs 'cos_cache' and 'sin_cache' are expected to have the same shape");if(a>0&&o===0)throw new Error("num_heads must be provided if rotary_embedding_dim is specified");let l=r.dims[0],c=r.dims[r.dims.length-2],u=s.dims[0],d=Se.sizeFromDimension(r.dims,1)/c,h=a===0?s.dims[1]*2:d/o;if(a>h)throw new Error("rotary_embedding_dim must be less than or equal to head_size");if(n.dims.length===2){if(l!==n.dims[0])throw new Error(`Input 'position_ids' dimension 0 should be of size batch_size, got ${n.dims[0]}`);if(c!==n.dims[1])throw new Error(`Input 'position_ids' dimension 1 should be of size sequence_length, got ${n.dims[1]}`)}if(h/2!==s.dims[1]&&a/2!==s.dims[1])throw new Error(`Input 'cos_cache' dimension 1 should be same as head_size / 2 or rotary_embedding_dim / 2, got ${s.dims[1]}`);if(c>u)throw new Error("Updating cos_cache and sin_cache in RotaryEmbedding is not currently supported")},Cg=(t,e)=>{let{interleaved:r,numHeads:n,rotaryEmbeddingDim:s,scale:i}=e,o=t[0].dims[0],a=Se.sizeFromDimension(t[0].dims,1),l=t[0].dims[t[0].dims.length-2],c=a/l,u=t[2].dims[1],d=s===0?u*2:c/n,h=new Array(o,l,c/d,d-u),f=Se.computeStrides(h),p=[{type:1,data:i},{type:12,data:h},{type:12,data:f},...t[0].dims.length===3?new Array({type:12,data:[a,c,d,1]}):[],...t[0].dims.length===4?new Array({type:12,data:[a,d,l*d,1]}):[],...wt(t[0].dims,t[1].dims,t[2].dims,t[3].dims,t[0].dims)],m=y=>{let g=Ie("input",t[0].dataType,t[0].dims.length),_=Ie("position_ids",t[1].dataType,t[1].dims.length),v=Ie("cos_cache",t[2].dataType,t[2].dims.length),w=Ie("sin_cache",t[3].dataType,t[3].dims.length),x=dt("output",t[0].dataType,t[0].dims.length);return y.registerUniforms([{name:"scale",type:"f32"},{name:"global_shape",type:"u32",length:h.length},{name:"global_strides",type:"u32",length:f.length},{name:"input_output_strides",type:"u32",length:f.length}]),`
        ${y.declareVariables(g,_,v,w,x)}

        ${y.mainStart(ku)}
          let half_rotary_emb_dim = uniforms.${v.name}_shape[1];
          let bsnh = global_idx / uniforms.global_strides % uniforms.global_shape;
          let size = uniforms.global_shape[0] * uniforms.global_strides[0];
          ${y.guardAgainstOutOfBoundsWorkgroupSizes("size")}

          if (bsnh[3] < half_rotary_emb_dim) {
            let position_ids_idx =
                ${_.broadcastedIndicesToOffset("bsnh.xy",dt("",_.type.tensor,2))};
            let position_id =
                u32(${_.getByOffset("position_ids_idx")}) + select(0, bsnh[1], position_ids_idx == 0);
            let i = dot(bsnh, uniforms.input_output_strides) + select(0, bsnh[3], ${r});
            let j = i + select(half_rotary_emb_dim, 1, ${r});
            let re = ${g.getByOffset("i")} * ${v.get("position_id","bsnh[3]")} -
                ${g.getByOffset("j")} * ${w.get("position_id","bsnh[3]")};
            ${x.setByOffset("i","re")}
            let im = ${g.getByOffset("i")} * ${w.get("position_id","bsnh[3]")} +
                ${g.getByOffset("j")} * ${v.get("position_id","bsnh[3]")};
            ${x.setByOffset("j","im")}
          } else {
            let k = dot(bsnh, uniforms.input_output_strides) + half_rotary_emb_dim;
            ${x.setByOffset("k",g.getByOffset("k"))}
          }
        }`};return{name:"RotaryEmbedding",shaderCache:{hint:or({interleaved:r}).cacheKey,inputDependencies:["rank","rank","rank","rank"]},getShaderSource:m,getRunData:()=>({outputs:[{dims:t[0].dims,dataType:t[0].dataType}],dispatchGroup:{x:Math.ceil(Se.size(h)/ku)},programUniforms:p})}},IN=(t,e)=>{k$(t.inputs,e),t.compute(Cg(t.inputs,e))}}),A$,$$,lv,O$,LN,G9=Ke(()=>{Wr(),St(),Eb(),AN(),DN(),Ka(),FN(),Ft(),A$=(t,e)=>{if(e.doRotary&&t.length<=7)throw new Error("cos_cache and sin_cache inputs are required if do_rotary is specified");let r=t[0],n=t[1],s=t[2],i=t[3],o=t[4];if(e.doRotary!==0&&t.length<=7)throw new Error("cos_cast and sin_cache are expected if do_rotary attribute is non-zero");if(e.localWindowSize!==-1)throw new Error("Local attention is not supported");if(e.softcap!==0)throw new Error("Softcap is not supported");if(e.rotaryInterleaved!==0)throw new Error("Rotary interleaved is not supported");if(e.smoothSoftmax)throw new Error("Smooth softmax is not supported");if(r.dims.length!==3&&r.dims.length!==5)throw new Error("Input query is expected to have 3 or 5 dimensions");let a=!1,l=r.dims[0],c=r.dims[1],u=r.dims.length===3?a?r.dims[2]/3:r.dims[2]:e.numHeads*r.dims[4],d=c,h=0,f=!n||n.dims.length===0,p=Math.floor(f?u/(e.numHeads+2*e.kvNumHeads):u/e.numHeads);f&&(u=p*e.numHeads);let m=i&&i.dims.length!==0,y=o&&o.dims.length!==0;if(m&&i.dims.length===4&&i.dims[0]===l&&i.dims[1]!==e.kvNumHeads&&i.dims[2]===e.kvNumHeads&&i.dims[3]===p)throw new Error("BSNH pastKey/pastValue is not supported");if(m&&y){if(i.dims.length!==4)throw new Error('Input "past_key" is expected to have 4 dimensions');if(o.dims.length!==4)throw new Error('Input "past_value" is expected to have 4 dimensions');h=i.dims[2]}else if(m||y)throw new Error('Input "past_key" and "past_value" shall be both present or both absent');let g=1;if(n&&n.dims.length>0){if(r.dims.length!==3)throw new Error('Input "query" is expected to have 3 dimensions when key is given');if(n.dims.length<3||n.dims.length>5)throw new Error('Input "key" is expected to have 3, 4, or 5 dimensions');if(r.dims[0]!==n.dims[0])throw new Error('Input "query" and "key" shall have same dim 0 (batch size)');if(n.dims.length===3){if(r.dims[2]%n.dims[2]!==0)throw new Error('Dimension 2 of "query" should be a multiple of "key"');d=n.dims[1]}else if(n.dims.length===5){if(n.dims[2]!==e.numHeads||n.dims[3]!==2||n.dims[4]!==p)throw new Error('Expect "key" shape (batch_size, kv_sequence_length, num_heads, 2, head_size) for packed kv');if(s)throw new Error('Expect "value" be none when "key" has packed kv format.');d=n.dims[1]}else{if(n.dims[1]!==e.numHeads||n.dims[3]!==p)throw new Error('Expect "key" shape (batch_size, num_heads, kv_sequence_length, head_size) for past_key');d=n.dims[2]}}else{if(r.dims.length!==3&&r.dims.length!==5)throw new Error('Input "query" is expected to have 3 or 5 dimensions when key is empty');if(r.dims.length===5&&(r.dims[2]!==e.numHeads||r.dims[3]!==3))throw new Error('Expect "query" shape (batch_size, kv_sequence_length, num_heads, 3, head_size) for packed kv');g=3}let _=0,v=!1,w=e.kvNumHeads?p*e.kvNumHeads:u;if(s&&s.dims.length>0){if(s.dims.length!==3&&s.dims.length!==4)throw new Error('Input "value" is expected to have 3 or 4 dimensions');if(r.dims[0]!==s.dims[0])throw new Error('Input "query" and "value" shall have same dim 0 (batch_size)');if(s.dims.length===3){if(d!==s.dims[1])throw new Error('Input "key" and "value" shall have the same dim 1 (kv_sequence_length)');w=s.dims[2]}else{if(d!==s.dims[2])throw new Error('Input "past_key" and "past_value" shall have the same dim 2 (kv_sequence_length)');w=s.dims[1]*s.dims[3],v=!0}}let x=t.length>4?t[5]:void 0;if(x&&x.dims.length!==1&&x.dims[0]!==l)throw new Error('Input "seqlens" is expected to have 1 dimension and the same dim 0 as batch_size');return{batchSize:l,sequenceLength:c,pastSequenceLength:h,kvSequenceLength:d,totalSequenceLength:-1,maxSequenceLength:-1,inputHiddenSize:0,hiddenSize:u,vHiddenSize:w,headSize:p,vHeadSize:Math.floor(w/e.kvNumHeads),numHeads:e.numHeads,kvNumHeads:e.kvNumHeads,nReps:e.numHeads/e.kvNumHeads,pastPresentShareBuffer:!1,maskType:_,scale:e.scale,broadcastResPosBias:!1,passPastInKv:v,qkvFormat:g}},$$=or({perm:[0,2,1,3]}),lv=(t,e,r)=>{let n=e,s=r.kvNumHeads;return e.dims.length===3&&r.kvSequenceLength!==0&&(n=e.reshape([r.batchSize,r.kvSequenceLength,s,r.headSize]),n=t.compute(Fs(n,$$.perm),{inputs:[n],outputs:[-1]})[0]),n},O$=(t,e,r,n)=>{let s=7,i=["type","type"],o=[t*e],a=t*e,l=[{type:12,data:a},{type:12,data:e},{type:12,data:t}],c=u=>{let d=Ie("seq_lens",r.dataType,r.dims),h=Ie("total_seq_lens",n.dataType,n.dims),f=dt("pos_ids",s,o),p=[{name:"output_size",type:"u32"},{name:"sequence_length",type:"u32"},{name:"batch_size",type:"u32"}];return`
  ${u.registerUniforms(p).declareVariables(d,h,f)}
  ${u.mainStart()}
    ${u.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}
    let total_sequence_length = u32(${h.getByOffset("0")});
    let is_subsequent_prompt = uniforms.sequence_length > 1 && uniforms.sequence_length != total_sequence_length;
    let is_first_prompt = !is_subsequent_prompt && uniforms.sequence_length == total_sequence_length;
    let batch_idx = global_idx / uniforms.sequence_length;
    let sequence_idx = i32(global_idx % uniforms.sequence_length);
    var pos_id: i32 = 0;
    let seqlen = ${d.getByOffset("batch_idx")};
    let total_seqlen = seqlen + 1;
    if (is_first_prompt) {
      if (sequence_idx < total_seqlen) {
        pos_id = sequence_idx;
      } else {
        pos_id = 1;
      }
      ${f.setByOffset("global_idx","pos_id")}
    } else if (is_subsequent_prompt) {
      let past_seqlen = total_seqlen - i32(uniforms.sequence_length);
      if (past_seqlen + sequence_idx < total_seqlen) {
        pos_id = past_seqlen + sequence_idx;
      } else {
        pos_id = 1;
      }
      ${f.setByOffset("global_idx","pos_id")}
    } else if (global_idx < uniforms.batch_size) {
      ${f.setByOffset("global_idx","seqlen")}
    };
  }
  `};return{name:"GeneratePositionIds",shaderCache:{hint:`${t};${e}`,inputDependencies:i},getRunData:()=>({outputs:[{dims:o,dataType:s}],dispatchGroup:{x:Math.ceil(a/64)},programUniforms:l}),getShaderSource:c}},LN=(t,e)=>{var w;let r=A$(t.inputs,e);if(t.inputs[0].dims.length===5)throw new Error("Packed QKV is not implemented");if(((w=t.inputs[1])==null?void 0:w.dims.length)===5)throw new Error("Packed KV is not implemented");let n=t.inputs[0],s=t.inputs[1]&&t.inputs[1].dims.length>0?t.inputs[1]:void 0,i=t.inputs[2]&&t.inputs[2].dims.length>0?t.inputs[2]:void 0,o=t.inputs[3]&&t.inputs[3].dims.length!==0?t.inputs[3]:void 0,a=t.inputs[4]&&t.inputs[4].dims.length!==0?t.inputs[4]:void 0,l=t.inputs.length>4?t.inputs[5]:void 0,c=t.inputs.length>5?t.inputs[6]:void 0,u=r.kvNumHeads?r.kvNumHeads:r.numHeads,d=or({axis:2,numOutputs:3,splitSizes:[r.numHeads*r.headSize,u*r.headSize,u*r.headSize]}),[h,f,p]=!s&&!i?t.compute(vx([n],d),{inputs:[n],outputs:[-1,-1,-1]}):[n,s,i],m,y;if(e.doRotary){let x=t.compute(O$(r.batchSize,r.sequenceLength,l,c),{inputs:[l,c],outputs:[-1]})[0],M=t.inputs[7],T=t.inputs[8],S=or({interleaved:e.rotaryInterleaved!==0,numHeads:r.numHeads,rotaryEmbeddingDim:0,scale:e.scale}),k=[h,x,M,T],$=[-1];m=t.compute(Cg(k,S),{inputs:k,outputs:$})[0],k.splice(0,1,f);let j=or({interleaved:e.rotaryInterleaved!==0,numHeads:r.kvNumHeads,rotaryEmbeddingDim:0,scale:e.scale});y=t.compute(Cg(k,j),{inputs:k,outputs:$})[0]}let g=eh(t,r.batchSize,r.numHeads,r.sequenceLength,r.headSize,e.doRotary?m:h,void 0,0),_=lv(t,e.doRotary?y:f,r),v=lv(t,p,r);Vh(t,g,_,v,void 0,void 0,o,a,void 0,r,l,c)}}),cv,D$,I$,RN,H9=Ke(()=>{St(),It(),Ka(),Ft(),cv=(t,e,r,n,s,i,o,a)=>{let l=Ir(i),c=l===1?"f32":`vec${l}f`,u=l===1?"vec2f":`mat2x${l}f`,d=s*o,h=64;d===1&&(h=256);let f=[s,o,i/l],p=[s,o,2],m=["rank","type","type"],y=[];y.push(...wt(f,p));let g=_=>{let v=Ie("x",e.dataType,3,l),w=Ie("scale",r.dataType,r.dims),x=Ie("bias",n.dataType,n.dims),M=dt("output",1,3,2),T=[v,w,x,M];return`
  var<workgroup> workgroup_shared : array<${u}, ${h}>;
  const workgroup_size = ${h}u;
  ${_.declareVariables(...T)}
  ${_.mainStart(h)}
    let batch = workgroup_index / uniforms.x_shape[1];
    let channel = workgroup_index % uniforms.x_shape[1];
    let hight = uniforms.x_shape[2];
    // initialize workgroup memory
    var sum = ${c}(0);
    var squared_sum = ${c}(0);
    for (var h = local_idx; h < hight; h += workgroup_size) {
      let value = ${c}(${v.get("batch","channel","h")});
      sum += value;
      squared_sum += value * value;
    }
    workgroup_shared[local_idx] = ${u}(sum, squared_sum);
    workgroupBarrier();

    for (var currSize = workgroup_size >> 1;  currSize > 0; currSize = currSize >> 1) {
      if (local_idx < currSize) {
        workgroup_shared[local_idx] = workgroup_shared[local_idx] + workgroup_shared[local_idx + currSize];
      }
      workgroupBarrier();
    }
    if (local_idx == 0) {
      let sum_final = ${Ba("workgroup_shared[0][0]",l)} / f32(hight * ${l});
      let squared_sum_final = ${Ba("workgroup_shared[0][1]",l)} / f32(hight * ${l});

      let inv_std_dev = inverseSqrt(squared_sum_final - sum_final * sum_final + f32(${a}));
      let channel_scale = inv_std_dev * f32(scale[channel]);
      let channel_shift = f32(bias[channel]) - sum_final * channel_scale;
      output[workgroup_index] = vec2f(channel_scale, channel_shift);
    }
  }`};return t.compute({name:"InstanceNormComputeChannelScaleShift",shaderCache:{hint:`${l};${a};${h}`,inputDependencies:m},getRunData:()=>({outputs:[{dims:p,dataType:1}],dispatchGroup:{x:d},programUniforms:y}),getShaderSource:g},{inputs:[e,r,n],outputs:[-1]})[0]},D$=(t,e,r)=>{let n=e[0].dims,s=n,i=2,o=n[0],a=n[1],l=Se.sizeFromDimension(n,i),c=Ir(l),u=Se.size(s)/c,d=cv(t,e[0],e[1],e[2],o,l,a,r.epsilon),h=[o,a,l/c],f=[o,a],p=["type","none"],m=y=>{let g=Ie("x",e[0].dataType,h.length,c),_=Ie("scale_shift",1,f.length,2),v=dt("output",e[0].dataType,h.length,c),w=[g,_,v];return`
  ${y.registerUniform("output_size","u32").declareVariables(...w)}
  ${y.mainStart()}
  ${y.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}
      let outputIndices = ${v.offsetToIndices("global_idx")};
      let batch = outputIndices[0];
      let channel = outputIndices[1];
      let scale_shift = ${_.getByIndices("vec2<u32>(batch, channel)")};
      let value = ${g.getByOffset("global_idx")} * ${v.type.value}(scale_shift.x) + ${v.type.value}(scale_shift.y);
      ${v.setByOffset("global_idx","value")};
  }`};t.compute({name:"InstanceNormalization",shaderCache:{hint:`${c}`,inputDependencies:p},getRunData:()=>({outputs:[{dims:s,dataType:e[0].dataType}],dispatchGroup:{x:Math.ceil(u/64)},programUniforms:[{type:12,data:u},...wt(h,f,h)]}),getShaderSource:m},{inputs:[e[0],d]})},I$=(t,e,r)=>{let n=e[0].dims,s=n,i=n[0],o=n[n.length-1],a=Se.sizeFromDimension(n,1)/o,l=Ir(o),c=Se.size(s)/l,u=[{type:12,data:a},{type:12,data:Math.floor(o/l)}],d=["type","type"],h=!1,f=[0,n.length-1];for(let g=0;g<n.length-2;g++)h=h||n[g+1]!==1,f.push(g+1);h=h&&n[n.length-1]!==1;let p=h?t.compute(Fs(t.inputs[0],f),{inputs:[t.inputs[0]],outputs:[-1]})[0]:t.inputs[0].reshape(Array.from({length:n.length},(g,_)=>n[f[_]])),m=cv(t,p,e[1],e[2],i,a,o,r.epsilon),y=g=>{let _=wn(e[0].dataType),v=l===1?"vec2f":`mat${l}x2f`,w=T=>{let S=T===0?"x":"y",k=l===1?"f32":`vec${l}f`;switch(l){case 1:return`${_}(${k}(scale.${S}))`;case 2:return`vec2<${_}>(${k}(scale[0].${S}, scale[1].${S}))`;case 4:return`vec4<${_}>(${k}(scale[0].${S}, scale[1].${S}, scale[2].${S}, scale[3].${S}))`;default:throw new Error(`Not supported compoents ${l}`)}},x=Ie("input",e[0].dataType,e[0].dims,l),M=dt("output",e[0].dataType,s,l);return`
  @group(0) @binding(0) var<storage, read> input : array<${x.type.storage}>;
  @group(0) @binding(1) var<storage, read> scale_input : array<${v}>;
  @group(0) @binding(2) var<storage, read_write> output : array<${M.type.storage}>;
  struct Uniforms {H: u32, C : u32};
  @group(0) @binding(3) var<uniform> uniforms: Uniforms;

  ${g.mainStart()}
    let current_image_number = global_idx / (uniforms.C * uniforms.H);
    let current_channel_number = global_idx % uniforms.C;

    let scale_offset = current_image_number * uniforms.C + current_channel_number;
    let scale = scale_input[scale_offset];
    output[global_idx] = fma(input[global_idx], ${w(0)}, ${w(1)});
  }`};t.compute({name:"InstanceNormalizationNHWC",shaderCache:{hint:`${l}`,inputDependencies:d},getRunData:()=>({outputs:[{dims:s,dataType:e[0].dataType}],dispatchGroup:{x:Math.ceil(c/64)},programUniforms:u}),getShaderSource:y},{inputs:[e[0],m]})},RN=(t,e)=>{e.format==="NHWC"?I$(t,t.inputs,e):D$(t,t.inputs,e)}}),F$,L$,jN,K9=Ke(()=>{St(),It(),Ft(),F$=t=>{if(!t||t.length<2)throw new Error("layerNorm requires at least 2 inputs.")},L$=(t,e,r)=>{let n=e.simplified,s=t[0].dims,i=t[1],o=!n&&t[2],a=s,l=Se.normalizeAxis(e.axis,s.length),c=Se.sizeToDimension(s,l),u=Se.sizeFromDimension(s,l),d=Se.size(i.dims),h=o?Se.size(o.dims):0;if(d!==u||o&&h!==u)throw new Error(`Size of X.shape()[axis:] == ${u}.
       Size of scale and bias (if provided) must match this.
       Got scale size of ${d} and bias size of ${h}`);let f=[];for(let x=0;x<s.length;++x)x<l?f.push(s[x]):f.push(1);let p=Ir(u),m=["type","type"],y=[{type:12,data:c},{type:1,data:u},{type:12,data:Math.floor(u/p)},{type:1,data:e.epsilon}];o&&m.push("type");let g=r>1,_=r>2,v=x=>{let M=wn(t[0].dataType),T=[Ie("x",t[0].dataType,t[0].dims,p),Ie("scale",i.dataType,i.dims,p)];o&&T.push(Ie("bias",o.dataType,o.dims,p)),T.push(dt("output",t[0].dataType,a,p)),g&&T.push(dt("mean_data_output",1,f)),_&&T.push(dt("inv_std_output",1,f));let S=[{name:"norm_count",type:"u32"},{name:"norm_size",type:"f32"},{name:"norm_size_vectorized",type:"u32"},{name:"epsilon",type:"f32"}];return`
  ${x.registerUniforms(S).declareVariables(...T)}
  ${x.mainStart()}
    ${x.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.norm_count")}
    let offset = global_idx * uniforms.norm_size_vectorized;
    var mean_vector = ${ux("f32",p)};
    var mean_square_vector = ${ux("f32",p)};

    for (var h: u32 = 0u; h < uniforms.norm_size_vectorized; h++) {
      let value = ${Gc(M,p,"x[h + offset]")};
      mean_vector += value;
      mean_square_vector += value * value;
    }
    let mean = ${Ba("mean_vector",p)} / uniforms.norm_size;
    let inv_std_dev = inverseSqrt(${Ba("mean_square_vector",p)} / uniforms.norm_size ${n?"":"- mean * mean"} + uniforms.epsilon);

    for (var j: u32 = 0; j < uniforms.norm_size_vectorized; j++) {
      let f32input = ${Gc(M,p,"x[j + offset]")};
      let f32scale = ${Gc(M,p,"scale[j]")};
      output[j + offset] = ${T[0].type.value}((f32input ${n?"":"- mean"}) * inv_std_dev * f32scale
        ${o?`+ ${Gc(M,p,"bias[j]")}`:""}
      );
    }

    ${g?"mean_data_output[global_idx] = mean":""};
    ${_?"inv_std_output[global_idx] = inv_std_dev":""};
  }`},w=[{dims:a,dataType:t[0].dataType}];return g&&w.push({dims:f,dataType:1}),_&&w.push({dims:f,dataType:1}),{name:"LayerNormalization",shaderCache:{hint:`${p};${r};${n}`,inputDependencies:m},getRunData:()=>({outputs:w,dispatchGroup:{x:Math.ceil(c/64)},programUniforms:y}),getShaderSource:v}},jN=(t,e)=>{F$(t.inputs),t.compute(L$(t.inputs,e,t.outputCount))}}),R$,NN,X9=Ke(()=>{It(),Ob(),Db(),R$=t=>{if(!t||t.length!==2)throw new Error("MatMul requires 2 inputs.");if(t[0].dims[t[0].dims.length-1]!==t[1].dims[t[1].dims.length-2])throw new Error("shared dimension does not match.")},NN=t=>{R$(t.inputs);let e=Pu.calcShape(t.inputs[0].dims,t.inputs[1].dims,!0);if(!e)throw new Error("Can't use matmul on the given tensors");let r=e[e.length-1],n=t.inputs[0].dims[t.inputs[0].dims.length-1];if(r<8&&n<8)t.compute($b(t.inputs,{activation:""},e));else{let s=e[e.length-2],i=Se.size(t.inputs[0].dims.slice(0,-2)),o=Se.size(t.inputs[1].dims.slice(0,-2));if(i!==1&&s===1&&o===1){let a=t.inputs[0].reshape([1,i,n]),l=t.inputs[1].reshape([1,n,r]),c=[1,i,r],u=[a,l];t.compute(Tg(u,{activation:""},e,c),{inputs:u})}else t.compute(Tg(t.inputs,{activation:""},e))}}}),j$,N$,z$,zN,BN,q9=Ke(()=>{St(),It(),Wr(),Ft(),j$=(t,e)=>{if(t.length<3||t.length>4)throw new Error("MatMulNBits requires 3 or 4 inputs");let r=t[0],n=r.dims.length;if(r.dims[n-1]!==e.k)throw new Error("The last dim of input shape does not match the k value");let s=Math.floor((e.k+e.blockSize-1)/e.blockSize),i=e.blockSize/8*e.bits,o=t[1];if(!Se.areEqual(o.dims,[e.n,s,i]))throw new Error("The second inputs must be 3D tensor with shape N X nBlocksPerCol X blobSize");let a=t[2].dims;if(Se.size(a)!==e.n*s)throw new Error("scales input size error.");if(t.length===4){let l=t[3].dims,c=e.bits>4?e.n*s:e.n*Math.floor((s+1)/2);if(Se.size(l)!==c)throw new Error("zeroPoints input size error.")}},N$=(t,e)=>{let r=t[0].dims,n=r.length,s=r[n-2],i=e.k,o=e.n,a=r.slice(0,n-2),l=Se.size(a),c=t[1].dims[2]/4,u=t[0].dataType,d=Ir(e.k),h=Ir(c),f=Ir(o),p=a.concat([s,o]),m=s>1&&o/f%2===0?2:1,y=Se.size(p)/f/m,g=64,_=[],v=[l,s,i/d],w=Se.convertShape(t[1].dims).slice();w.splice(-1,1,c/h),_.push(...wt(v)),_.push(...wt(w)),_.push(...wt(t[2].dims)),t.length===4&&_.push(...wt(Se.convertShape(t[3].dims)));let x=[l,s,o/f];_.push(...wt(x));let M=T=>{let S=v.length,k=Ie("a",t[0].dataType,S,d),$=Ie("b",12,w.length,h),j=Ie("scales",t[2].dataType,t[2].dims.length),V=[k,$,j],L=t.length===4?Ie("zero_points",12,t[3].dims.length):void 0;L&&V.push(L);let X=x.length,K=dt("output",t[0].dataType,X,f),Y=wn(t[0].dataType),J=(()=>{switch(d){case 1:return`array<${Y}, 8>`;case 2:return`mat4x2<${Y}>`;case 4:return`mat2x4<${Y}>`;default:throw new Error(`${d}-component is not supported.`)}})(),N=()=>{let z=`
          // reuse a data
            var input_offset = ${k.indicesToOffset(`${k.type.indices}(batch, row, word_offset)`)};
            var a_data: ${J};
            for (var j: u32 = 0; j < ${8/d}; j++) {
              a_data[j] = ${k.getByOffset("input_offset")};
              input_offset++;
            }
          `;for(let O=0;O<f*m;O++)z+=`
            b_value = ${h===1?`b${O}_data`:`b${O}_data[i]`};
            b_value_lower = unpack4xU8(b_value & b_mask);
            b_value_upper = unpack4xU8((b_value >> 4) & b_mask);
            b_quantized_values = ${J}(${Array.from({length:4},(H,re)=>`${Y}(b_value_lower[${re}]), ${Y}(b_value_upper[${re}])`).join(", ")});
            b_dequantized_values = ${d===1?`${J}(${Array.from({length:8},(H,re)=>`(b_quantized_values[${re}] - ${L?`zero_point${O}`:"zero_point"}) * scale${O}`).join(", ")});`:`(b_quantized_values - ${J}(${Array(8).fill(`${L?`zero_point${O}`:"zero_point"}`).join(",")})) * scale${O};`};
            workgroup_shared[local_id.x * ${m} + ${Math.floor(O/f)}]${f>1?`[${O%f}]`:""} += ${Array.from({length:8/d},(H,re)=>`${d===1?`a_data[${re}] * b_dequantized_values[${re}]`:`dot(a_data[${re}], b_dequantized_values[${re}])`}`).join(" + ")};
          `;return z},ne=()=>{let z=`
            var col_index = col * ${f};
            ${L?`
            let zero_point_bytes_per_col = (nBlocksPerCol + 1) / 2;
            var zero_point_byte_count: u32;
            var zero_point_word_index: u32;
            var zero_point_byte_offset: u32;
            let zero_point_nibble_offset: u32 = block & 0x1u;
            var zero_point_bits_offset: u32;
            var zero_point_word: u32;`:`
            // The default zero point is 8 for unsigned 4-bit quantization.
            let zero_point = ${Y}(8);`}
            `;for(let O=0;O<f*m;O++)z+=`
            let scale${O} = ${j.getByOffset("col_index * nBlocksPerCol + block")};
            ${L?`
            zero_point_byte_count = col_index * zero_point_bytes_per_col + (block >> 0x1u);
            zero_point_word_index = zero_point_byte_count >> 0x2u;
            zero_point_byte_offset = zero_point_byte_count & 0x3u;
            zero_point_bits_offset = (zero_point_byte_offset << 3) + (zero_point_nibble_offset << 2);
            zero_point_word = ${L.getByOffset("zero_point_word_index")} >> zero_point_bits_offset;
            let zero_point${O} = ${Y}((zero_point_word) & 0xFu);`:""}
            col_index += 1;`;return z},te=()=>{let z=`col_index = col * ${f};`;for(let O=0;O<f*m;O++)z+=`
            let b${O}_data = ${$.getByIndices(`${$.type.indices}(col_index, block, word)`)};
            col_index += 1;`;return z+=`
            var b_value: u32;
            let b_mask: u32 = 0x0F0F0F0Fu;
            var b_value_lower: vec4<u32>;
            var b_value_upper: vec4<u32>;
            var b_quantized_values: ${J};
            var b_dequantized_values: ${J};`,z};return`
        var<workgroup> workgroup_shared: array<${K.type.value}, ${m*g}>;
        ${T.declareVariables(...V,K)}
        ${T.mainStart([g,1,1])}
          let output_indices = ${K.offsetToIndices(`(global_idx / ${g}) * ${m}`)};
          let col = output_indices[2];
          let row = output_indices[1];
          let batch = output_indices[0];
          let nBlocksPerCol = uniforms.b_shape[1];

          for (var block = local_id.x; block < nBlocksPerCol; block += ${g}) {
            //process one block
            var word_offset: u32 = block * ${e.blockSize/d};
            ${ne()}
            for (var word: u32 = 0; word < ${c}; word += ${h}) {
              ${te()}
              for (var i: u32 = 0; i < ${h}; i++) {
                ${N()}
                word_offset += ${8/d};
              }
            }
          }
          workgroupBarrier();

          if (local_id.x < ${m}) {
            var output_value: ${K.type.value} = ${K.type.value}(0);
            var workgroup_shared_offset: u32 = local_id.x;
            for (var b: u32 = 0u; b < ${g}u; b++) {
              output_value += workgroup_shared[workgroup_shared_offset];
              workgroup_shared_offset += ${m};
            }
            ${K.setByIndices(`${K.type.indices}(batch, row, col + local_id.x)`,"output_value")};
          }
        }`};return{name:"MatMulNBits",shaderCache:{hint:`${e.blockSize};${e.bits};${d};${h};${f};${m};${g}`,inputDependencies:Array(t.length).fill("rank")},getRunData:()=>({outputs:[{dims:p,dataType:u}],dispatchGroup:{x:y},programUniforms:_}),getShaderSource:M}},z$=(t,e)=>{let r=t[0].dims,n=r.length,s=r[n-2],i=e.k,o=e.n,a=r.slice(0,n-2),l=Se.size(a),c=t[1].dims[2]/4,u=t[0].dataType,d=Ir(e.k),h=Ir(c),f=a.concat([s,o]),p=128,m=o%8===0?8:o%4===0?4:1,y=p/m,g=y*h*8,_=g/d,v=g/e.blockSize,w=Se.size(f)/m,x=[],M=[l,s,i/d],T=Se.convertShape(t[1].dims).slice();T.splice(-1,1,c/h),x.push(...wt(M)),x.push(...wt(T)),x.push(...wt(t[2].dims)),t.length===4&&x.push(...wt(Se.convertShape(t[3].dims)));let S=[l,s,o];x.push(...wt(S));let k=$=>{let j=M.length,V=Ie("a",t[0].dataType,j,d),L=Ie("b",12,T.length,h),X=Ie("scales",t[2].dataType,t[2].dims.length),K=[V,L,X],Y=t.length===4?Ie("zero_points",12,t[3].dims.length):void 0;Y&&K.push(Y);let J=S.length,N=dt("output",t[0].dataType,J),ne=wn(t[0].dataType),te=()=>{switch(d){case 1:return`
          let a_data0 = vec4<${ne}>(sub_a[word_offset], sub_a[word_offset + 1], sub_a[word_offset + 2], sub_a[word_offset + 3]);
          let a_data1 = vec4<${ne}>(sub_a[word_offset + 4], sub_a[word_offset + 5], sub_a[word_offset + 6], sub_a[word_offset + 7]);`;case 2:return`
          let a_data0 = vec4<${ne}>(sub_a[word_offset], sub_a[word_offset + 1]);
          let a_data1 = vec4<${ne}>(sub_a[word_offset + 2], sub_a[word_offset + 3]);`;case 4:return`
          let a_data0 = sub_a[word_offset];
          let a_data1 = sub_a[word_offset + 1];`;default:throw new Error(`${d}-component is not supported.`)}};return`
        var<workgroup> sub_a: array<${V.type.value}, ${_}>;
        var<workgroup> inter_results: array<array<${N.type.value}, ${y}>, ${m}>;
        ${$.declareVariables(...K,N)}
        ${$.mainStart([y,m,1])}
          let output_indices = ${N.offsetToIndices(`workgroup_index * ${m}`)};
          let col = output_indices[2];
          let row = output_indices[1];
          let batch = output_indices[0];
          let n_blocks_per_col = uniforms.b_shape[1];
          let num_tiles =  (n_blocks_per_col - 1) / ${v} + 1;

          // Loop over shared dimension.
          for (var tile: u32 = 0; tile < num_tiles; tile += 1) {
            let a_col_start = tile * ${_};
            // load one tile A data into shared memory.
            for (var a_offset = local_idx; a_offset < ${_}; a_offset += ${p})
            {
              let a_col = a_col_start + a_offset;
              if (a_col < uniforms.a_shape[2])
              {
                sub_a[a_offset] = ${V.getByIndices(`${V.type.indices}(batch, row, a_col)`)};
              } else {
                sub_a[a_offset] = ${V.type.value}(0);
              }
            }
            workgroupBarrier();

            // each thread process one block
            let b_row = col + local_id.y;
            let block = tile * ${v} + local_id.x;
            ${Y?`
            let zero_point_bytes_per_col = (n_blocks_per_col + 1) / 2;
            let zero_point_byte_count = b_row * zero_point_bytes_per_col + (block >> 0x1u);
            let zero_point_word_index = zero_point_byte_count >> 0x2u;
            let zero_point_byte_offset = zero_point_byte_count & 0x3u;
            let zero_point_nibble_offset: u32 = block & 0x1u;
            let zero_point_bits_offset = (zero_point_byte_offset << 3) + (zero_point_nibble_offset << 2);
            let zero_point_word = ${Y.getByOffset("zero_point_word_index")} >> zero_point_bits_offset;
            let zero_point = ${ne}((zero_point_word) & 0xFu);`:`
            // The default zero point is 8 for unsigned 4-bit quantization.
            let zero_point = ${ne}(8);`}
            let scale = ${X.getByOffset("b_row * n_blocks_per_col + block")};
            let b_data = ${L.getByIndices(`${L.type.indices}(b_row, block, 0)`)};
            var word_offset = local_id.x * ${e.blockSize/d};
            for (var i: u32 = 0; i < ${h}; i++) {
              ${te()}
              let b_value = ${h===1?"b_data":"b_data[i]"};
              let b_value_lower = unpack4xU8(b_value & 0x0F0F0F0Fu);
              let b_value_upper = unpack4xU8((b_value >> 4) & 0x0F0F0F0Fu);
              let b_quantized_values = mat2x4<${ne}>(${Array.from({length:4},(z,O)=>`${ne}(b_value_lower[${O}]), ${ne}(b_value_upper[${O}])`).join(", ")});
              let b_dequantized_values = (b_quantized_values - mat2x4<${ne}>(${Array(8).fill("zero_point").join(",")})) * scale;
              inter_results[local_id.y][local_id.x] += ${Array.from({length:2},(z,O)=>`${`dot(a_data${O}, b_dequantized_values[${O}])`}`).join(" + ")};
              word_offset += ${8/d};
            }
            workgroupBarrier();
          }

          if (local_idx < ${m}) {
            var output_value: ${N.type.value} = ${N.type.value}(0);
            for (var b = 0u; b < ${y}; b++) {
              output_value += inter_results[local_idx][b];
            }
            if (col + local_idx < uniforms.output_shape[2])
            {
              ${N.setByIndices(`${N.type.indices}(batch, row, col + local_idx)`,"output_value")}
            }
          }
        }`};return{name:"BlockwiseMatMulNBits32",shaderCache:{hint:`${e.blockSize};${d};${h};${y};${m}`,inputDependencies:Array(t.length).fill("rank")},getRunData:()=>({outputs:[{dims:f,dataType:u}],dispatchGroup:{x:w},programUniforms:x}),getShaderSource:k}},zN=(t,e)=>{j$(t.inputs,e),e.blockSize===32&&t.adapterInfo.isVendor("intel")&&t.adapterInfo.isArchitecture("gen-12lp")?t.compute(z$(t.inputs,e)):t.compute(N$(t.inputs,e))},BN=t=>or(t)}),B$,V$,W$,U$,G$,H$,K$,X$,VN,Y9=Ke(()=>{St(),It(),Ft(),B$=t=>{if(!t||t.length<1)throw new Error("Too few inputs");if(t[0].dataType!==1&&t[0].dataType!==10)throw new Error("Input type must be float or float16.");if(t.length>=2){let e=t[0].dims.length*2===t[1].dims[0];if(t.length===4&&(e=t[3].dims[0]*2===t[1].dims[0]),!e)throw new Error("The pads should be a 1D tensor of shape [2 * input_rank] or [2 * num_axes].")}},V$=(t,e,r)=>{let n="";for(let s=e-1;s>=0;--s)n+=`
            k = i32(${t.indicesGet("indices",s)}) - ${gt("uniforms.pads",s,r)};
            if (k < 0) {
              break;
            }
            if (k >= i32(${gt("uniforms.x_shape",s,e)})) {
              break;
            }
            offset += k * i32(${gt("uniforms.x_strides",s,e)});
        `;return`
          value = ${t.type.value}(uniforms.constant_value);
          for (var i = 0; i < 1; i++) {
            var offset = 0;
            var k = 0;
            ${n}
            value = x[offset];
          }
      `},W$=(t,e,r)=>{let n="";for(let s=e-1;s>=0;--s)n+=`
                k = i32(${t.indicesGet("indices",s)}) - ${gt("uniforms.pads",s,r)};
                if (k < 0) {
                  k = -k;
                }
                {
                  let _2n_1 = 2 * (i32(${gt("uniforms.x_shape",s,e)}) - 1);
                  k = k % _2n_1;
                  if(k >= i32(${gt("uniforms.x_shape",s,e)})) {
                    k = _2n_1 - k;
                  }
                }
                offset += k * i32(${gt("uniforms.x_strides",s,e)});
            `;return`
              var offset = 0;
              var k = 0;
              ${n}
              value = x[offset];
          `},U$=(t,e,r)=>{let n="";for(let s=e-1;s>=0;--s)n+=`
                k = i32(${t.indicesGet("indices",s)}) - ${gt("uniforms.pads",s,r)};
                if (k < 0) {
                  k = 0;
                }
                if (k >= i32(${gt("uniforms.x_shape",s,e)})) {
                  k = i32(${gt("uniforms.x_shape",s,e)}) - 1;
                }
                offset += k * i32(${gt("uniforms.x_strides",s,e)});
            `;return`
              var offset = 0;
              var k = 0;
              ${n}
              value = x[offset];
          `},G$=(t,e,r)=>{let n="";for(let s=e-1;s>=0;--s)n+=`
                k = i32(${t.indicesGet("indices",s)}) - ${gt("uniforms.pads",s,r)};
                if (k < 0)  {
                  k += i32(${gt("uniforms.x_shape",s,e)}]);
                }
                if (k >= i32(${gt("uniforms.x_shape",s,e)})) {
                  k -= i32(${gt("uniforms.x_shape",s,e)});
                }
                offset += k * i32(${gt("uniforms.x_strides",s,e)});
            `;return`
              var offset = 0;
              var k = 0;
              ${n}
              value = x[offset];
          `},H$=(t,e,r)=>{switch(r.mode){case 0:return V$(t,e,r.pads.length);case 1:return W$(t,e,r.pads.length);case 2:return U$(t,e,r.pads.length);case 3:return G$(t,e,r.pads.length);default:throw new Error("Invalid mode")}},K$=(t,e)=>{let r=Se.padShape(t[0].dims.slice(),e.pads),n=t[0].dims,s=Se.size(r),i=[{type:12,data:s},{type:6,data:e.pads}],o=t.length>=3&&t[2].data;e.mode===0&&i.push({type:o?t[2].dataType:1,data:e.value}),i.push(...wt(t[0].dims,r));let a=["rank"],l=c=>{let u=dt("output",t[0].dataType,r.length),d=Ie("x",t[0].dataType,n.length),h=d.type.value,f=H$(u,n.length,e),p=[{name:"output_size",type:"u32"},{name:"pads",type:"i32",length:e.pads.length}];return e.mode===0&&p.push({name:"constant_value",type:o?h:"f32"}),`
            ${c.registerUniforms(p).declareVariables(d,u)}
            ${c.mainStart()}
            ${c.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}

            let indices = ${u.offsetToIndices("global_idx")};

            var value = ${h}(0);
            ${f}
            output[global_idx] = value;
        }`};return{name:"Pad",shaderCache:{hint:`${e.mode}${o}`,inputDependencies:a},getRunData:()=>({outputs:[{dims:r,dataType:t[0].dataType}],dispatchGroup:{x:Math.ceil(Se.size(r)/64)},programUniforms:i}),getShaderSource:l}},X$=(t,e)=>{if(t.length>1){let r=t[1].getBigInt64Array(),n=t.length>=3&&t[2].data?t[2].dataType===10?t[2].getUint16Array()[0]:t[2].getFloat32Array()[0]:0,s=t[0].dims.length,i=new Int32Array(2*s).fill(0);if(t.length>=4){let a=t[3].getBigInt64Array();for(let l=0;l<a.length;l++)i[Number(a[l])]=Number(r[l]),i[Number(a[l])+s]=Number(r[l+a.length])}else r.forEach((a,l)=>i[Number(l)]=Number(a));let o=[];return i.forEach(a=>o.push(a)),{mode:e.mode,value:n,pads:o}}else return e},VN=(t,e)=>{B$(t.inputs);let r=X$(t.inputs,e);t.compute(K$(t.inputs,r),{inputs:[0]})}}),Bd,uv,dv,hv,fv,q$,Y$,pv,mv,WN,UN,gv,GN,HN,_v,KN,XN,qN,YN,Q9=Ke(()=>{Vi(),St(),It(),Ft(),Bd=t=>{if(Mr.webgpu.validateInputContent&&(!t||t.length!==1))throw new Error("Pool ops requires 1 input.")},uv=(t,e,r)=>{let n=e.format==="NHWC",s=t.dims.slice();n&&s.splice(1,0,s.pop());let i=Object.hasOwnProperty.call(e,"dilations"),o=e.kernelShape.slice(),a=e.strides.slice(),l=i?e.dilations.slice():[],c=e.pads.slice();bg.adjustPoolAttributes(r,s,o,a,l,c);let u=bg.computePoolOutputShape(r,s,a,l,o,c,e.autoPad),d=Object.assign({},e);i?Object.assign(d,{kernelShape:o,strides:a,pads:c,dilations:l,cacheKey:e.cacheKey}):Object.assign(d,{kernelShape:o,strides:a,pads:c,cacheKey:e.cacheKey});let h=u.slice();return h.push(h.splice(1,1)[0]),[d,n?h:u]},dv=(t,e)=>{let r=e.format==="NHWC",n=Se.size(t),s=Se.size(e.kernelShape),i=[{type:12,data:n},{type:12,data:s}],o=[{name:"outputSize",type:"u32"},{name:"kernelSize",type:"u32"}];if(e.kernelShape.length<=2){let a=e.kernelShape[e.kernelShape.length-1],l=e.strides[e.strides.length-1],c=e.pads[e.pads.length/2-1],u=e.pads[e.pads.length-1],d=!!(c+u);i.push({type:12,data:a},{type:12,data:l},{type:12,data:c},{type:12,data:u}),o.push({name:"kw",type:"u32"},{name:"sw",type:"u32"},{name:"pwStart",type:"u32"},{name:"pwEnd",type:"u32"});let h=!1;if(e.kernelShape.length===2){let f=e.kernelShape[e.kernelShape.length-2],p=e.strides[e.strides.length-2],m=e.pads[e.pads.length/2-2],y=e.pads[e.pads.length-2];h=!!(m+y),i.push({type:12,data:f},{type:12,data:p},{type:12,data:m},{type:12,data:y}),o.push({name:"kh",type:"u32"},{name:"sh",type:"u32"},{name:"phStart",type:"u32"},{name:"phEnd",type:"u32"})}return[i,o,!0,d,h]}else{if(r)throw new Error("Pooling with kernelShape.length > 2 is not supported for NHWC format.");let a=Se.computeStrides(e.kernelShape);i.push({type:12,data:a},{type:12,data:e.pads},{type:12,data:e.strides}),o.push({name:"kernelStrides",type:"u32",length:a.length},{name:"pads",type:"u32",length:e.pads.length},{name:"strides",type:"u32",length:e.strides.length});let l=e.pads.reduce((c,u)=>c+u);return[i,o,!!l,!1,!1]}},hv=(t,e,r,n,s,i,o,a,l,c,u,d)=>{let h=s.format==="NHWC",f=e.type.value,p=dt("output",e.type.tensor,n);if(s.kernelShape.length<=2){let m="",y="",g="",_=r-(h?2:1);if(u?m=`
                for (var i: u32 = 0u; i < uniforms.kw; i++) {
                  xIndices[${_}] = indices[${_}] * uniforms.sw - uniforms.pwStart + i;
                  if (xIndices[${_}] < 0 || xIndices[${_}]
                      >= uniforms.x_shape[${_}]) {
                    pad++;
                    continue;
                  }
                  let x_val = x[${e.indicesToOffset("xIndices")}];
                  ${i}
                }`:m=`
                for (var i: u32 = 0u; i < uniforms.kw; i++) {
                  xIndices[${_}] = indices[${_}] * uniforms.sw - uniforms.pwStart + i;
                  let x_val = x[${e.indicesToOffset("xIndices")}];
                  ${i}
                }`,s.kernelShape.length===2){let v=r-(h?3:2);d?y=`
                for (var j: u32 = 0u; j < uniforms.kh; j++) {
                  xIndices[${v}] = indices[${v}] * uniforms.sh - uniforms.phStart + j;
                  if (xIndices[${v}] < 0 || xIndices[${v}] >= uniforms.x_shape[${v}]) {
                    pad += i32(uniforms.kw);
                    continue;
                  }
              `:y=`
                for (var j: u32 = 0u; j < uniforms.kh; j++) {
                  xIndices[${v}] = indices[${v}] * uniforms.sh - uniforms.phStart + j;
                `,g=`
              }
            `}return`
            ${t.registerUniforms(l).declareVariables(e,p)}

            ${t.mainStart()}
              ${t.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.outputSize")}

              let indices = ${p.offsetToIndices("global_idx")};
              var xIndices = ${p.offsetToIndices("global_idx")};

              var value = ${f}(${a});
              var pad = 0;
              ${y}
              ${m}
              ${g}
              ${o}

              output[global_idx] = value;
            }`}else{if(h)throw new Error("Pooling with kernelShape.length > 2 is not supported for NHWC format.");let m=s.kernelShape.length,y=s.pads.length,g="";return c?g=`
                if (xIndices[j] >= uniforms.x_shape[j]) {
                  pad++;
                  isPad = true;
                  break;
                }
              }
              if (!isPad) {
                let x_val = x[${e.indicesToOffset("xIndices")}];
                ${i}
              }`:g=`
              }
              let x_val = x[${e.indicesToOffset("xIndices")}];
              ${i}
            `,`
            ${t.registerUniforms(l).declareVariables(e,p)}

            ${t.mainStart()}
              ${t.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.outputSize")}
              let indices = ${p.offsetToIndices("global_idx")};
              var xIndices = ${p.offsetToIndices("global_idx")};

              var offsets: array<u32, ${m}>;

              var value = ${f}(${a});
              var pad = 0;
              var isPad = false;

              for (var i: u32 = 0u; i < uniforms.kernelSize; i++) {
                var offset = i;
                for (var j = 0u; j < ${m-1}u; j++) {
                  offsets[j] = offset / ${gt("uniforms.kernelStrides","j",m)};
                  offset -= offsets[j] * ${gt("uniforms.kernelStrides","j",m)};
                }
                offsets[${m-1}] = offset;

                isPad = false;
                for (var j = ${r-m}u; j < ${r}u; j++) {
                  xIndices[j] = indices[j] * ${gt("uniforms.strides",`j - ${r-m}u`,m)}
                    + offsets[j - ${r-m}u] - ${gt("uniforms.pads","j - 2u",y)};
                  ${g}
              }
              ${o}

              output[global_idx] = value;
            }`}},fv=t=>`${t.format};${t.ceilMode};${t.autoPad};${t.kernelShape.length}`,q$=t=>`${fv(t)};${t.countIncludePad}`,Y$=t=>`${fv(t)};${t.storageOrder};${t.dilations}`,pv=t=>({format:t.format,autoPad:["NOTSET","VALID","SAME_UPPER","SAME_LOWER"][t.auto_pad],ceilMode:t.ceil_mode,kernelShape:t.kernel_shape,strides:t.strides,pads:t.pads}),mv=(t,e,r,n)=>{let[s,i]=uv(e,n,r),o=Ie("x",e.dataType,e.dims.length),a=o.type.value,l="value += x_val;",c="";s.countIncludePad?c+=`value /= ${a}(uniforms.kernelSize);`:c+=`value /= ${a}(i32(uniforms.kernelSize) - pad);`;let[u,d,h,f,p]=dv(i,s);u.push(...wt(e.dims,i));let m=["rank"];return{name:t,shaderCache:{hint:`${n.cacheKey};${h};${f};${p}`,inputDependencies:m},getRunData:()=>({outputs:[{dims:i,dataType:e.dataType}],dispatchGroup:{x:Math.ceil(Se.size(i)/64)},programUniforms:u}),getShaderSource:y=>hv(y,o,e.dims.length,i.length,s,l,c,0,d,h,f,p)}},WN=t=>{let e=t.count_include_pad!==0,r=pv(t);if(r.ceilMode!==0)throw new Error("using ceil() in shape computation is not yet supported for AveragePool");let n={countIncludePad:e,...r,cacheKey:""};return{...n,cacheKey:q$(n)}},UN=(t,e)=>{Bd(t.inputs),t.compute(mv("AveragePool",t.inputs[0],!1,e))},gv={autoPad:"",ceilMode:0,countIncludePad:!1,kernelShape:[],strides:[],pads:[],storageOrder:0,dilations:[]},GN=t=>{let e=t.format;return{format:e,...gv,cacheKey:e}},HN=(t,e)=>{Bd(t.inputs),t.compute(mv("GlobalAveragePool",t.inputs[0],!0,e))},_v=(t,e,r,n)=>{let[s,i]=uv(e,n,r),o=`
      value = max(x_val, value);
    `,a="",l=Ie("x",e.dataType,e.dims.length),c=["rank"],[u,d,h,f,p]=dv(i,s);return u.push(...wt(e.dims,i)),{name:t,shaderCache:{hint:`${n.cacheKey};${h};${f};${p}`,inputDependencies:c},getRunData:()=>({outputs:[{dims:i,dataType:e.dataType}],dispatchGroup:{x:Math.ceil(Se.size(i)/64)},programUniforms:u}),getShaderSource:m=>hv(m,l,e.dims.length,i.length,s,o,a,e.dataType===10?-65504:-1e5,d,h,f,p)}},KN=(t,e)=>{Bd(t.inputs),t.compute(_v("MaxPool",t.inputs[0],!1,e))},XN=t=>{let e=t.storage_order,r=t.dilations,n=pv(t);if(e!==0)throw new Error("column major storage order is not yet supported for MaxPool");if(n.ceilMode!==0)throw new Error("using ceil() in shape computation is not yet supported for MaxPool");let s={storageOrder:e,dilations:r,...n,cacheKey:""};return{...s,cacheKey:Y$(s)}},qN=t=>{let e=t.format;return{format:e,...gv,cacheKey:e}},YN=(t,e)=>{Bd(t.inputs),t.compute(_v("GlobalMaxPool",t.inputs[0],!0,e))}}),Q$,J$,QN,JN,J9=Ke(()=>{St(),It(),Wr(),Ft(),Q$=(t,e)=>{if(t.length<2||t.length>3)throw new Error("DequantizeLinear requires 2 or 3 inputs.");if(t.length===3&&t[1].dims===t[2].dims)throw new Error("x-scale and x-zero-point must have the same shape.");if(t.length===3&&t[0].dataType!==t[2].dataType)throw new Error("x and x-zero-point must have the same data type.");if(t[0].dataType===6&&t.length>2)throw new Error("In the case of dequantizing int32 there is no zero point.");if(t[1].dims.length!==0&&t[1].dims.length!==1&&t[1].dims.length!==t[0].dims.length)throw new Error("scale input must be a scalar, a 1D tensor, or have the same rank as the input tensor.");if(t.length>2){if(t[0].dataType!==t[2].dataType)throw new Error("x and x-zero-point must have the same data type.");if(t[1].dims.length!==t[2].dims.length)throw new Error("scale and zero-point inputs must have the same rank.");if(!t[1].dims.map((r,n)=>r===t[2].dims[n]).reduce((r,n)=>r&&n,!0))throw new Error("scale and zero-point inputs must have the same shape.")}if(e.blockSize>0){if(t[1].dims.length===0||t[1].dims.length===1&&t[1].dims[0]===1)throw new Error("blockSize must be set only for block quantization.");if(!t[1].dims.map((s,i)=>i===e.axis||s===t[0].dims[i]).reduce((s,i)=>s&&i,!0))throw new Error("For block qunatization, scale input shape to match the input shape except for the axis");if(t[1].dims.length!==t[0].dims.length)throw new Error("For block qunatization the scale input rank must be the same as the x rank.");let r=t[0].dims[e.axis],n=t[1].dims[e.axis];if(e.blockSize<Math.ceil(r/n)||e.blockSize>Math.ceil(r/(n-1)-1))throw new Error("blockSize must be with in the range [ceil(dI / Si), ceil(dI / (Si - 1) - 1)].")}},J$=(t,e)=>{let r=Se.normalizeAxis(e.axis,t[0].dims.length),n=t[0].dataType,s=n===3,i=t[0].dims,o=t[1].dataType,a=Se.size(i),l=n===3||n===2,c=l?[Math.ceil(Se.size(t[0].dims)/4)]:t[0].dims,u=t[1].dims,d=t.length>2?t[2]:void 0,h=d?l?[Math.ceil(Se.size(d.dims)/4)]:d.dims:void 0,f=u.length===0||u.length===1&&u[0]===1,p=f===!1&&u.length===1,m=Ir(a),y=f&&(!l||m===4),g=y?m:1,_=y&&!l?m:1,v=Ie("input",l?12:n,c.length,_),w=Ie("scale",o,u.length),x=d?Ie("zero_point",l?12:n,h.length):void 0,M=dt("output",o,i.length,g),T=[v,w];x&&T.push(x);let S=[c,u];d&&S.push(h);let k=[{type:12,data:a/g},{type:12,data:r},{type:12,data:e.blockSize},...wt(...S,i)],$=j=>{let V=[{name:"output_size",type:"u32"},{name:"axis",type:"u32"},{name:"block_size",type:"u32"}];return`
      ${j.registerUniforms(V).declareVariables(...T,M)}
      ${j.mainStart()}
          ${j.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}
          let output_indices = ${M.offsetToIndices("global_idx")};

          // Set input x
          ${l?`
            let input = ${v.getByOffset("global_idx / 4")};
            let x_vec = ${s?"unpack4xI8(input)":"unpack4xU8(input)"};
            let x_value = ${g===1?"x_vec[global_idx % 4]":"x_vec"};`:`let x_value = ${v.getByOffset("global_idx")};`};

          // Set scale input
          ${f?`let scale_value= ${w.getByOffset("0")}`:p?`
            let scale_index = ${M.indicesGet("output_indices","uniforms.axis")};
            let scale_value= ${w.getByOffset("scale_index")};`:`
            var scale_indices: ${w.type.indices} = output_indices;
            let index = ${w.indicesGet("scale_indices","uniforms.axis")} / uniforms.block_size;
            ${w.indicesSet("scale_indices","uniforms.axis","index")};
            let scale_value= ${w.getByIndices("scale_indices")};`};

          // Set zero-point input
          ${x?f?l?`
                let zero_point_input = ${x.getByOffset("0")};
                let zero_point_vec =  ${s?"unpack4xI8(zero_point_input)":"unpack4xU8(zero_point_input)"};
                let zero_point_value= zero_point_vec[0]`:`let zero_point_value = ${x.getByOffset("0")}`:p?l?`
                let zero_point_index = ${M.indicesGet("output_indices","uniforms.axis")};
                let zero_point_input = ${x.getByOffset("zero_point_index / 4")};
                let zero_point_vec =  ${s?"unpack4xI8(zero_point_input)":"unpack4xU8(zero_point_input)"};
                let zero_point_value = zero_point_vec[zero_point_index % 4]`:`
                let zero_point_index = ${M.indicesGet("output_indices","uniforms.axis")};
                let zero_point_value = ${x.getByOffset("zero_point_index")};`:l?`
                let zero_point_offset = ${w.indicesToOffset("scale_indices")};
                let zero_point_input = ${x.getByOffset("zero_point_offset / 4")};
                let zero_point_vec = ${s?"unpack4xI8(zero_point_input)":"unpack4xU8(zero_point_input)"};
                let zero_point_value = zero_point_vec[zero_point_offset % 4];`:`let zero_point_value = ${x.getByIndices("scale_indices")};`:`let zero_point_value = ${l?s?"i32":"u32":v.type.value}(0);`};
      // Compute and write output
      ${M.setByOffset("global_idx",`${M.type.value}(x_value - zero_point_value) * scale_value`)};
      }`};return{name:"DequantizeLinear",shaderCache:{hint:e.cacheKey,inputDependencies:x?["rank","rank","rank"]:["rank","rank"]},getShaderSource:$,getRunData:()=>({outputs:[{dims:i,dataType:o}],dispatchGroup:{x:Math.ceil(a/g/64),y:1,z:1},programUniforms:k})}},QN=(t,e)=>{Q$(t.inputs,e),t.compute(J$(t.inputs,e))},JN=t=>or({axis:t.axis,blockSize:t.blockSize})}),Z$,eO,ZN,Z9=Ke(()=>{Vi(),St(),Ft(),Z$=(t,e,r)=>{let n=t===e,s=t<e&&r<0,i=t>e&&r>0;if(n||s||i)throw new Error("Range these inputs' contents are invalid.")},eO=(t,e,r,n)=>{let s=Math.abs(Math.ceil((e-t)/r)),i=[s],o=s,a=[{type:12,data:o},{type:n,data:t},{type:n,data:r},...wt(i)],l=c=>{let u=dt("output",n,i.length),d=u.type.value,h=[{name:"outputSize",type:"u32"},{name:"start",type:d},{name:"delta",type:d}];return`
        ${c.registerUniforms(h).declareVariables(u)}
        ${c.mainStart()}
        ${c.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.outputSize")}
        output[global_idx] = uniforms.start + ${d}(global_idx) * uniforms.delta;
      }`};return{name:"Range",shaderCache:{hint:`${n}`},getShaderSource:l,getRunData:()=>({outputs:[{dims:i,dataType:n}],dispatchGroup:{x:Math.ceil(o/64)},programUniforms:a})}},ZN=t=>{let e=0,r=0,n=0;t.inputs[0].dataType===6?(e=t.inputs[0].getInt32Array()[0],r=t.inputs[1].getInt32Array()[0],n=t.inputs[2].getInt32Array()[0]):t.inputs[0].dataType===1&&(e=t.inputs[0].getFloat32Array()[0],r=t.inputs[1].getFloat32Array()[0],n=t.inputs[2].getFloat32Array()[0]),Mr.webgpu.validateInputContent&&Z$(e,r,n),t.compute(eO(e,r,n,t.inputs[0].dataType),{inputs:[]})}}),tO,yv,vv,rO,ez,tz,eX=Ke(()=>{St(),It(),Wr(),Ft(),tO=(t,e,r,n)=>{if(t!=="none"&&n!=="i32"&&n!=="u32"&&n!=="f32")throw new Error(`Input ${n} is not supported with reduction ${t}.`);let s=`{
                var oldValue = 0;
                loop {
                  let newValueF32 =`,i=`;
                  let newValue = bitcast<i32>(newValueF32);
                  let res = atomicCompareExchangeWeak(&${e}, oldValue, newValue);
                  if res.exchanged {
                    break;
                  }
                  oldValue = res.old_value;
                }
              }`;switch(t){case"none":return`${e}=${r};`;case"add":return n==="i32"||n==="u32"?`atomicAdd(&${e}, bitcast<${n}>(${r}));`:`
              ${s}bitcast<${n}>(oldValue) + (${r})${i}`;case"max":return n==="i32"||n==="u32"?`atomicMax(&${e}, bitcast<${n}>(${r}));`:`
                ${s}max(bitcast<f32>(oldValue), (${r}))${i}`;case"min":return n==="i32"||n==="u32"?`atomicMin(&${e}, bitcast<${n}>(${r}));`:`${s}min(bitcast<${n}>(oldValue), (${r}))${i}`;case"mul":return`${s}(bitcast<${n}>(oldValue) * (${r}))${i}`;default:throw new Error(`Reduction ${t} is not supported.`)}},yv=(t,e)=>`${t===1?`
    let element_count_dim = uniforms.output_strides;
    let dim_value = uniforms.output_shape;`:`
    let element_count_dim = uniforms.output_strides[${e?"i - indices_start":"i"}];
    let dim_value = uniforms.output_shape[${e?"i - indices_start":"i"} + uniforms.last_index_dimension];`}
    
    if (index >= 0) {
      if (index >= i32(dim_value)) {
        index = i32(dim_value - 1);
      }
    } else {
      if (index < -i32(dim_value)) {
        index = 0;
      } else {
        index += i32(dim_value);
      }
    }
    data_offset += u32((u32(index) * element_count_dim));`,vv=(t,e,r)=>`for (var i = 0u; i < uniforms.num_updates_elements; i++) {
        let value = updates[uniforms.num_updates_elements * ${r?"global_idx":"idx"} + i];
        ${tO(t.reduction,"output[data_offset + i]","value",e)}
      }`,rO=(t,e)=>{let r=t[0].dims,n=t[1].dims,s=r,i=1,o=Math.ceil(Se.size(n)/i),a=n[n.length-1],l=Se.sizeFromDimension(r,a),c=Se.sizeFromDimension(n,0)/a,u=[{type:12,data:o},{type:12,data:a},{type:12,data:l},...wt(t[1].dims,t[2].dims,s)],d=h=>{let f=Ie("indices",t[1].dataType,t[1].dims.length),p=Ie("updates",t[2].dataType,t[2].dims.length,i),m=e.reduction!=="none"&&e.reduction!==""?k3("output",t[0].dataType,s.length):dt("output",t[0].dataType,s.length,i);return`
      ${h.registerUniform("output_size","u32").registerUniform("last_index_dimension","u32").registerUniform("num_updates_elements","u32").declareVariables(f,p,m)}
      ${h.mainStart()}
        ${h.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}
  var hasDuplicates = false;
  if (${e.reduction==="none"}) {
    for (var i = 0; i < ${c}; i = i + 1) {
      for (var j = i + 1; j < ${c}; j = j + 1) {
        var index_i = i32(indices[i].x);
        var index_j = i32(indices[j].x);
        if (index_i == index_j) {
          hasDuplicates = true;
          break;
        }
      }
      if (hasDuplicates) {
        break;
      }
    }
  }

  if (${e.reduction==="none"} && hasDuplicates) {
    if (global_idx != 0u) {
      return;
    }
    // Process each index-update pair individually when duplicates exist
    for (var idx = 0u; idx < ${c}u; idx++) {
      var data_offset = 0u;
      for (var i = 0u; i < uniforms.last_index_dimension; i++) {
        var index = i32(indices[idx * uniforms.last_index_dimension + i].x);
        ${yv(r.length,!1)}
      }
      ${vv(e,m.type.value,!1)}
    }
    return;
  }

  var data_offset = 0u;
  var indices_start = uniforms.last_index_dimension * global_idx;
  var indices_end = indices_start + uniforms.last_index_dimension;
  for (var i = indices_start; i < indices_end; i++) {
    var index = i32(indices[i].x);
    ${yv(r.length,!0)}
  }
  ${vv(e,m.type.value,!0)}
  }`};return{name:"ScatterND",shaderCache:{hint:`${e.cacheKey}_${e.reduction}`,inputDependencies:["rank","rank"]},getRunData:()=>({outputs:[{dims:s,dataType:t[0].dataType}],dispatchGroup:{x:Math.ceil(o/64)},programUniforms:u}),getShaderSource:d}},ez=t=>or({reduction:t.reduction}),tz=(t,e)=>{t.compute(rO(t.inputs,e),{inputs:[t.inputs[1],t.inputs[2]],outputs:[]})}}),nO,sO,iO,wv,oO,aO,lO,cO,uO,dO,hO,fO,xv,pO,mO,gO,_O,yO,rz,nz,tX=Ke(()=>{St(),It(),Wr(),Ft(),nO=(t,e)=>{if(t.every(r=>r>0||(()=>{throw new Error("Resize requires scales input values to be positive")})),t.length>0){if(e.mode==="linear"){if(!(t.length===2||t.length===3||t.length===4&&t[0]===1&&t[1]===1||t.length===4&&t[0]===1&&t[3]===1||t.length===5&&t[0]===1&&t[1]===1))throw new Error(`For linear mode, Resize requires scales to be 2D, 3D, 4D with either two outermost or one innermost and
            one outermost scale values equal to 1, or 5D with two outermost scale values equal to 1`)}else if(e.mode==="cubic"&&!(t.length===2||t.length===4&&t[0]===1&&t[1]===1||t.length===4&&t[0]===1&&t[3]===1))throw new Error("Resize requires scales input size to be 2 or 4 for cubic mode")}},sO=(t,e,r)=>{e.every(s=>s>=0&&s<r||(()=>{throw new Error("Resize requires axes input values to be positive and less than rank")}));let n=new Array(r).fill(1);return e.forEach((s,i)=>n[s]=t[i]),n},iO=(t,e,r,n,s,i)=>{let[o,a,l]=r>10?[1,2,3]:[-1,t.length>1?1:-1,-1],c=t[0].dims.length;if(o>0&&t.length>o&&t[o].dims.length>0)t[o].getFloat32Array().forEach(u=>i.push(u));else if(e.coordinateTransformMode==="tf_crop_and_resize")throw new Error("Resize requires RoI input to be specified when coordinateTransformMode is tfCropAndResize");if(a>0&&t.length>a&&t[a].dims.length===1&&t[a].dims[0]>0){if(t[a].getFloat32Array().forEach(u=>n.push(u)),n.length!==0&&n.length!==c&&r>=18&&n.length!==e.axes.length)throw new Error("Resize requires scales input size to be same as input rank or axes size for opset 18 and up");nO(n,e),e.axes.length>0&&sO(n,e.axes,c).forEach((u,d)=>n[d]=u)}if(l>0&&t.length>l&&t[l].dims.length===1&&t[l].dims[0]>0&&(t[l].getBigInt64Array().forEach(u=>s.push(Number(u))),s.length!==0&&s.length!==c&&r>=18&&s.length!==e.axes.length))throw new Error("Resize requires sizes input size to be same as input rank or axes size for opset 18 and up");if(e.axes.length>0){if(n.length!==0&&n.length!==e.axes.length)throw new Error('Resize requires "scales" input size to be of axes rank when axes attributes is specified');if(s.length!==0&&s.length!==e.axes.length)throw new Error('Resize requires "sizes" input size to be of rank axes rank when axes attributes is specified')}if(typeof n<"u"&&typeof s<"u"&&n.length>0&&s.length>c)throw new Error("Resize requires only of scales or sizes to be specified")},wv=(t,e,r,n)=>`
  // The whole part and the fractional part are calculated separately due to inaccuracy of floating
  // point division. As an example, f32(21) / f32(7) may evaluate to 2.99... instead of 3, causing an
  // offset-by-one error later in floor().
  let big = (${t}) * (${e});
  let whole = ${n}(big / (${r}));
  let fract = ${n}(big % (${r})) / ${n}(${r});
  return whole + fract;
`,oO=(t,e)=>`fn getOriginalCoordinateFromResizedCoordinate(xResized: u32, xScale: f32, lengthResized: u32,
     lengthOriginal: u32, roiStart: f32, roiEnd: f32) -> ${e} { `+(()=>{switch(t){case"asymmetric":return`
          if (xScale < 1.0 || floor(xScale) != xScale) {
            return ${e}(xResized) / ${e}(xScale);
          } else {
            ${wv("xResized","lengthOriginal","lengthResized",e)}
          }
        `;case"pytorch_half_pixel":return`if (lengthResized > 1) {
                    return (${e}(xResized) + 0.5) / ${e}(xScale) - 0.5;
                  } else {
                    return 0.0;
                  }`;case"tf_half_pixel_for_nn":return`return (${e}(xResized) + 0.5) / ${e}(xScale);`;case"align_corners":return`if (lengthResized == 1) {
                    return 0.0;
                  } else {
                    ${wv("xResized","lengthOriginal - 1","lengthResized - 1",e)}
                  }`;case"tf_crop_and_resize":return`if (lengthResized > 1) {
                    return ${e}(roiStart) * ${e}(lengthOriginal - 1) +
                        (${e}(xResized) * ${e}(roiEnd - roiStart) * ${e}(lengthOriginal - 1)) /
                        ${e}(lengthResized - 1);
                  } else {
                    return 0.5 * ${e}(roiStart + roiEnd) * ${e}(lengthOriginal - 1);
                  }`;case"half_pixel_symmetric":return`const outputWidth = ${e}xScale * ${e}(lengthResized);
                  const adjustment = ${e}(lengthResized) / outputWidth;
                  const center = ${e}(lengthOriginal) / 2;
                  const offset = center * (1 - adjustment);
                  return offset + ((${e}(xResized) + 0.5) / ${e}(xScale)) - 0.5;`;case"half_pixel":return`return ((${e}(xResized) + 0.5) / ${e}(xScale)) - 0.5;`;default:throw new Error(`Coordinate transform mode ${t} is not supported`)}})()+"}",aO=(t,e,r)=>`fn getNearestPixelFromOriginal(xOriginal: ${r}, isDownSample: bool) -> ${r} {`+(()=>{switch(t){case"round_prefer_ceil":return"if (fract(xOriginal) == 0.5) {             return ceil(xOriginal);           } else {             return round(xOriginal);           }";case"floor":return"return floor(xOriginal);";case"ceil":return"return ceil(xOriginal);";case"round_prefer_floor":return"if (fract(xOriginal) == 0.5) {                     return floor(xOriginal);                   } else {                     return round(xOriginal);                   }";case"simple":default:if(e<11)return"if (isDownSample)                     {                       return ceil(xOriginal);                     } else {                       return xOriginal;                     }";throw new Error(`Nearest mode ${t} is not supported`)}})()+"}",lO=(t,e,r)=>{let n=new Array(r).fill(0).concat(new Array(r).fill(1)),s=t.length===0?n:t.slice();return e.length>0?(e.forEach((i,o)=>{n[i]=s[o],n[o+r]=s[e.length+o]}),n):s},cO=(t,e,r,n)=>{let s=[];if(r.length>0)if(n.length>0){if(t.forEach(i=>s.push(i)),Math.max(...n)>t.length)throw new Error("axes is out of bound");n.forEach((i,o)=>s[i]=r[o])}else r.forEach(i=>s.push(i));else{if(e.length===0)throw new Error("Resize requires either scales or sizes.");s=t.map((i,o)=>Math.round(i*e[o]))}return s},uO=(t,e,r)=>{let n=(()=>{switch(r.keepAspectRatioPolicy){case"not_larger":return r.axes.length>0?Math.min(...r.axes.map(i=>e[i]),Number.MAX_VALUE):Math.min(...e,Number.MAX_VALUE);case"not_smaller":return r.axes.length>0?Math.max(...r.axes.map(i=>e[i]),Number.MIN_VALUE):Math.max(...e,Number.MIN_VALUE);default:throw new Error(`Keep aspect ratio policy ${r.keepAspectRatioPolicy} is not supported`)}})();e.fill(1,0,e.length);let s=t.slice();return r.axes.length>0?(r.axes.forEach(i=>e[i]=n),r.axes.forEach(i=>s[i]=Math.round(t[i]*e[i]))):(e.fill(n,0,e.length),s.forEach((i,o)=>s[o]=Math.round(i*e[o]))),s},dO=(t,e,r,n,s)=>`
    fn calculateOriginalIndicesFromOutputIndices(output_indices: ${t.type.indices}) -> array<${t.type.value}, ${r.length}> {
      var original_indices: array<${t.type.value}, ${r.length}>;
      for (var i:u32 = 0; i < ${r.length}; i++) {
        var output_index = ${t.indicesGet("output_indices","i")};
        var scale = ${gt("uniforms.scales","i",n)};
        var roi_low = ${gt("uniforms.roi","i",s)};
        var roi_hi = ${gt("uniforms.roi",`i + ${e.length}`,s)};
        if (scale == 1.0) {
          original_indices[i] = ${t.type.value}(output_index);
        } else {
          var input_shape_i = ${gt("uniforms.input_shape","i",e.length)};
          var output_shape_i = ${gt("uniforms.output_shape","i",r.length)};
          original_indices[i] = getOriginalCoordinateFromResizedCoordinate(output_index, scale, output_shape_i,
                                                                           input_shape_i, roi_low, roi_hi);
        }
      }
      return original_indices;
    }`,hO=(t,e,r,n,s,i,o)=>`
    fn calculateInputIndicesFromOutputIndices(output_indices: ${e.type.indices}) -> ${t.type.indices} {
      var input_indices: ${t.type.indices};
      for (var i:u32 = 0; i < ${n.length}; i++) {
        var output_index = ${e.indicesGet("output_indices","i")};
        var input_index: u32;
        var scale = ${gt("uniforms.scales","i",s)};
        if (scale == 1.0) {
          input_index = output_index;
        } else {
          var roi_low = ${gt("uniforms.roi","i",i)};
          var roi_hi = ${gt("uniforms.roi",`i + ${r.length}`,i)};
          var input_shape_i = ${gt("uniforms.input_shape","i",r.length)};
          var output_shape_i = ${gt("uniforms.output_shape","i",n.length)};
          var original_idx = getOriginalCoordinateFromResizedCoordinate(output_index, scale, output_shape_i,
                                                                        input_shape_i, roi_low, roi_hi);
          if (!${o} || (original_idx >= 0 && original_idx < ${e.type.value}(input_shape_i))) {
            if (original_idx < 0) {
              input_index = 0;
            } else if (original_idx > ${e.type.value}(input_shape_i - 1)) {
              input_index = input_shape_i - 1;
            } else {
              input_index = u32(getNearestPixelFromOriginal(original_idx, scale < 1));
            }
          } else {
            input_index = u32(original_idx);
          }
        }
        ${t.indicesSet("input_indices","i","input_index")}
      }
      return input_indices;
    }`,fO=(t,e)=>`
    fn checkInputIndices(input_indices: ${t.type.indices}) -> bool {
      for (var i:u32 = 0; i < ${e.length}; i++) {
        var input_index = ${t.indicesGet("input_indices","i")};
        if (input_index < 0 || input_index >= ${gt("uniforms.input_shape","i",e.length)}) {
          return false;
        }
      }
      return true;
    }`,xv=(t,e,r,n)=>t.rank>n?`
    ${t.indicesSet("input_indices",e,"channel")};
    ${t.indicesSet("input_indices",r,"batch")};
`:"",pO=(t,e,r,n,s)=>{let[i,o,a,l]=r.length===2?[-1,0,1,-1]:[0,2,3,1],c=t.type.value;return`
    fn getInputValue(batch: u32, channel: u32, row: u32, col: u32) -> ${c} {
      var input_indices: ${t.type.indices};
      ${t.indicesSet("input_indices",o,`max(0, min(row, ${r[o]} - 1))`)};
      ${t.indicesSet("input_indices",a,`max(0, min(col, ${r[a]} - 1))`)};
      ${xv(t,l,i,2)}
      return ${t.getByIndices("input_indices")};
    }

    fn bilinearInterpolation(output_indices: ${e.type.indices}) -> ${c} {
      var originalIndices = calculateOriginalIndicesFromOutputIndices(output_indices);
      var row:${c} = originalIndices[${o}];
      var col:${c} = originalIndices[${a}];
      ${n?`if (row < 0 || row > (${r[o]} - 1) || col < 0 || col > (${r[a]} - 1)) {
        return ${s};
      }`:""};
      row = max(0, min(row, ${r[o]} - 1));
      col = max(0, min(col, ${r[a]} - 1));
      var row1: u32 = u32(row);
      var col1: u32 = u32(col);
      var row2: u32 = u32(row + 1);
      var col2: u32 = u32(col + 1);
      var channel: u32 = ${r.length>2?`u32(originalIndices[${l}])`:"0"};
      var batch: u32 =  ${r.length>2?`u32(originalIndices[${i}])`:"0"};
      var x11: ${c} = getInputValue(batch, channel, row1, col1);
      var x12: ${c} = getInputValue(batch, channel, row1, col2);
      var x21: ${c} = getInputValue(batch, channel, row2, col1);
      var x22: ${c} = getInputValue(batch, channel, row2, col2);
      var dx1: ${c} = abs(row - ${c}(row1));
      var dx2: ${c} = abs(${c}(row2) - row);
      var dy1: ${c} = abs(col - ${c}(col1));
      var dy2: ${c} = abs(${c}(col2) - col);
      if (row1 == row2) {
        dx1 = 0.5;
        dx2 = 0.5;
      }
      if (col1 == col2) {
        dy1 = 0.5;
        dy2 = 0.5;
      }
      return (x11 * dx2 * dy2 + x12 * dx2 * dy1 + x21 * dx1 * dy2 + x22 * dx1 * dy1);
    }`},mO=(t,e,r,n,s,i,o,a,l,c)=>{let u=r.length===2,[d,h]=u?[0,1]:[2,3],f=t.type.value,p=m=>{let y=m===d?"row":"col";return`
      fn ${y}CubicInterpolation(input_indices: ${t.type.indices}, output_indices: ${e.type.indices}) -> ${f} {
        var output_index = ${e.indicesGet("output_indices",m)};
        var originalIdx: ${f} = getOriginalCoordinateFromResizedCoordinate(output_index, ${s[m]},
        ${n[m]}, ${r[m]}, ${i[m]}, ${i[m]} + ${r.length});
        var fractOriginalIdx: ${f} = originalIdx - floor(originalIdx);
        var coefs = getCubicInterpolationCoefs(fractOriginalIdx);

        if (${a} && (originalIdx < 0 || originalIdx > (${r[m]} - 1))) {
          return ${l};
        }
        var data: array<${f}, 4> = array<${f}, 4>(0.0, 0.0, 0.0, 0.0);
        for (var i: i32 = -1; i < 3; i++) {
          var ${y}: ${f} = originalIdx + ${f}(i);
          if (${y} < 0 || ${y} >= ${r[m]}) {
            ${c?`coefs[i + 1] = 0.0;
                        continue;`:a?`return ${l};`:`${y} = max(0, min(${y}, ${r[m]} - 1));`};
          }
        var input_indices_copy: ${t.type.indices} = input_indices;
          ${t.indicesSet("input_indices_copy",m,`u32(${y})`)};
          data[i + 1] = ${m===d?t.getByIndices("input_indices_copy"):"rowCubicInterpolation(input_indices_copy, output_indices)"};
        }
        return cubicInterpolation1D(data, coefs);
      }`};return`
    ${p(d)};
    ${p(h)};
  fn getCubicInterpolationCoefs(s: ${f}) -> array<${f}, 4> {
    var absS = abs(s);
    var coeffs: array<${f}, 4> = array<${f}, 4>(0.0, 0.0, 0.0, 0.0);
    var oneMinusAbsS: ${f} = 1.0 - absS;
    var twoMinusAbsS: ${f} = 2.0 - absS;
    var onePlusAbsS: ${f} = 1.0 + absS;
    coeffs[0] = ((${o} * onePlusAbsS - 5 * ${o}) * onePlusAbsS + 8 * ${o}) * onePlusAbsS - 4 * ${o};
    coeffs[1] = ((${o} + 2) * absS - (${o} + 3)) * absS * absS + 1;
    coeffs[2] = ((${o} + 2) * oneMinusAbsS - (${o} + 3)) * oneMinusAbsS * oneMinusAbsS + 1;
    coeffs[3] = ((${o} * twoMinusAbsS - 5 * ${o}) * twoMinusAbsS + 8 * ${o}) * twoMinusAbsS - 4 * ${o};
    return coeffs;
  }

  fn cubicInterpolation1D(x: array<${f}, 4>, coefs: array<${f}, 4>) -> ${f} {
    var coefsSum: ${f} = coefs[0] + coefs[1] + coefs[2] + coefs[3];
    return (x[0] * coefs[0] + x[1] * coefs[1]+ x[2] * coefs[2]+ x[3] * coefs[3]) / coefsSum;
  }

  fn bicubicInterpolation(output_indices: ${e.type.indices}) -> ${f} {
    var input_indices: ${t.type.indices} = output_indices;
    return colCubicInterpolation(input_indices, output_indices);
  }
    `},gO=(t,e,r,n,s)=>{let[i,o,a,l,c]=r.length===3?[-1,0,1,2,-1]:[0,2,3,4,1],u=t.type.value;return`
    fn getInputValue(batch: u32, channel: u32, depth:u32, height: u32, width: u32) -> ${u} {
      var input_indices: ${t.type.indices};
      ${t.indicesSet("input_indices",o,`max(0, min(depth, ${r[o]} - 1))`)};
      ${t.indicesSet("input_indices",a,`max(0, min(height, ${r[a]} - 1))`)};
      ${t.indicesSet("input_indices",l,`max(0, min(width, ${r[l]} - 1))`)};
      ${xv(t,c,i,3)}
      return ${t.getByIndices("input_indices")};
    }

    fn trilinearInterpolation(output_indices: ${e.type.indices}) -> ${u} {
      var originalIndices = calculateOriginalIndicesFromOutputIndices(output_indices);
      var depth:${u} = originalIndices[${o}];
      var height:${u} = originalIndices[${a}];
      var width:${u} = originalIndices[${l}];
      ${n?`if (depth < 0 || depth > (${r[o]} - 1) || height < 0 || height > (${r[a]} - 1) || width < 0 || (width > ${r[l]} - 1)) {
      return ${s};
        }`:""};

    depth = max(0, min(depth, ${r[o]} - 1));
      height = max(0, min(height, ${r[a]} - 1));
      width = max(0, min(width, ${r[l]} - 1));
      var depth1: u32 = u32(depth);
      var height1: u32 = u32(height);
      var width1: u32 = u32(width);
      var depth2: u32 = u32(depth + 1);
      var height2: u32 = u32(height + 1);
      var width2: u32 = u32(width + 1);
      var channel: u32 = ${r.length>3?`u32(originalIndices[${c}])`:"0"};
      var batch: u32 =  ${r.length>3?`u32(originalIndices[${i}])`:"0"};

      var x111: ${u} = getInputValue(batch, channel, depth1, height1, width1);
      var x112: ${u} = getInputValue(batch, channel, depth1, height1, width2);
      var x121: ${u} = getInputValue(batch, channel, depth1, height2, width1);
      var x122: ${u} = getInputValue(batch, channel, depth1, height2, width2);
      var x211: ${u} = getInputValue(batch, channel, depth2, height1, width1);
      var x212: ${u} = getInputValue(batch, channel, depth2, height1, width2);
      var x221: ${u} = getInputValue(batch, channel, depth2, height2, width1);
      var x222: ${u} = getInputValue(batch, channel, depth2, height2, width2);
      var dx1: ${u} = abs(depth - ${u}(depth1));
      var dx2: ${u} = abs(${u}(depth2) - depth);
      var dy1: ${u} = abs(height - ${u}(height1));
      var dy2: ${u} = abs(${u}(height2) - height);
      var dz1: ${u} = abs(width - ${u}(width1));
      var dz2: ${u} = abs(${u}(width2) - width);
      if (depth1 == depth2) {
        dx1 = 0.5;
        dx2 = 0.5;
      }
      if (height1 == height2) {
        dy1 = 0.5;
        dy2 = 0.5;
      }
      if (width1 == width2) {
        dz1 = 0.5;
        dz2 = 0.5;
      }
      return (x111 * dx2 * dy2 * dz2 + x112 * dx2 * dy2 * dz1 + x121 * dx2 * dy1 *dz2 + x122 * dx2 * dy1 * dz1 +
              x211 * dx1 * dy2 * dz2 + x212 * dx1 * dy2 * dz1 + x221 * dx1 * dy1 *dz2 + x222 * dx1 * dy1 * dz1);
    }`},_O=(t,e,r,n,s,i)=>{let o=t.dims,a=lO(i,e.axes,o.length),l=cO(o,n,s,e.axes),c=n.slice();n.length===0&&(c=o.map((_,v)=>_===0?1:l[v]/_),e.keepAspectRatioPolicy!=="stretch"&&(l=uO(o,c,e)));let u=dt("output",t.dataType,l.length),d=Ie("input",t.dataType,o.length),h=Se.size(l),f=o.length===l.length&&o.every((_,v)=>_===l[v]),p=e.coordinateTransformMode==="tf_crop_and_resize",m=e.extrapolationValue,y=d.type.value,g=_=>`
      ${f?"":`
      ${oO(e.coordinateTransformMode,y)};
      ${(()=>{switch(e.mode){case"nearest":return`
              ${fO(d,o)};
              ${aO(e.nearestMode,r,y)};
              ${hO(d,u,o,l,c.length,a.length,p)};
              `;case"linear":return`
              ${dO(u,o,l,c.length,a.length)};
              ${(()=>{if(o.length===2||o.length===4)return`${pO(d,u,o,p,m)}`;if(o.length===3||o.length===5)return`${gO(d,u,o,p,m)}`;throw Error("Linear mode only supports input dims 2, 3, 4 and 5 are supported in linear mode.")})()};
            `;case"cubic":return`
            ${(()=>{if(o.length===2||o.length===4)return`${mO(d,u,o,l,c,a,e.cubicCoeffA,p,e.extrapolationValue,e.excludeOutside)}`;throw Error("Cubic mode only supports input dims 2 and 4 are supported in linear mode.")})()};
            `;default:throw Error("Invalid resize mode")}})()};
      `}
      ${_.registerUniform("output_size","u32").registerUniform("scales","f32",c.length).registerUniform("roi","f32",a.length).declareVariables(d,u)}
      ${_.mainStart()}
        ${_.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}
        ${f?"output[global_idx] = input[global_idx];":`
        let output_indices = ${u.offsetToIndices("global_idx")};
        var input_indices: ${d.type.indices};
        ${(()=>{switch(e.mode){case"nearest":return`input_indices = calculateInputIndicesFromOutputIndices(output_indices);
                if (checkInputIndices(input_indices)) {
                  output[global_idx] = ${d.getByIndices("input_indices")};
                } else {
                  output[global_idx] = ${e.extrapolationValue};
                }`;case"linear":return`output[global_idx] = ${o.length===2||o.length===4?"bilinearInterpolation":"trilinearInterpolation"}(output_indices);`;case"cubic":return"output[global_idx] = bicubicInterpolation(output_indices);";default:throw Error(`Unsupported resize mode: ${e.mode}`)}})()};
`}
      }`;return{name:"Resize",shaderCache:{hint:`${e.cacheKey}|${r}|${c.length>0?e.mode==="cubic"?c:c.length:""}|${s.length>0?s:""}|${a.length>0?a:""}|${f}|${e.mode==="nearest"?o.length:o}`,inputDependencies:["rank"]},getShaderSource:g,getRunData:()=>({outputs:[{dims:l,dataType:t.dataType}],dispatchGroup:{x:Math.ceil(h/64)},programUniforms:[{type:12,data:h},{type:1,data:c},{type:1,data:a},...wt(o,l)]})}},yO=t=>{let e=t.customDataBuffer;return new Uint32Array(e,e.byteOffset,1)[0]},rz=(t,e)=>{let r=[],n=[],s=[],i=yO(t);if(e.antialias!==0)throw Error("Only default value (0) for Antialias attribute is supported");iO(t.inputs,e,i,r,n,s),t.compute(_O(t.inputs[0],e,i,r,n,s),{inputs:[0]})},nz=t=>{let e=t.antialias,r=t.axes,n=t.coordinateTransformMode,s=t.cubicCoeffA,i=t.excludeOutside!==0,o=t.extrapolationValue,a=t.keepAspectRatioPolicy,l=t.mode,c=t.nearestMode===""?"simple":t.nearestMode;return or({antialias:e,axes:r,coordinateTransformMode:n,cubicCoeffA:s,excludeOutside:i,extrapolationValue:o,keepAspectRatioPolicy:a,mode:l,nearestMode:c})}}),vO,wO,sz,rX=Ke(()=>{St(),It(),Ft(),vO=t=>{if(!t||t.length<3)throw new Error("layerNorm requires at least 3 inputs.");let e=t[0],r=t[1],n=t[2];if(e.dataType!==r.dataType||e.dataType!==n.dataType)throw new Error("All inputs must have the same data type");if(e.dims.length!==3&&e.dims.length!==2)throw new Error("Input must be 2D or 3D");if(r.dims.length!==3&&r.dims.length!==2)throw new Error("Skip must be 2D or 3D");let s=e.dims[e.dims.length-1],i=e.dims[e.dims.length-2];if(r.dims[r.dims.length-1]!==s)throw new Error("Skip must have the same hidden size as input");if(r.dims[r.dims.length-2]!==i)throw new Error("Skip must have the same sequence length as input");if(n.dims.length!==1)throw new Error("Gamma must be 1D");if(n.dims[n.dims.length-1]!==s)throw new Error("Gamma must have the same hidden size as input");if(t.length>3){let o=t[3];if(o.dims.length!==1)throw new Error("Beta must be 1D");if(o.dims[o.dims.length-1]!==s)throw new Error("Beta must have the same hidden size as input")}if(t.length>4){let o=t[4];if(o.dims.length!==1)throw new Error("Bias must be 1D");if(o.dims[o.dims.length-1]!==s)throw new Error("Bias must have the same hidden size as input")}},wO=(t,e,r,n)=>{let s=e.simplified,i=t[0].dims,o=Se.size(i),a=i,l=o,c=i.slice(-1)[0],u=n?i.slice(0,-1).concat(1):[],d=!s&&t.length>3,h=t.length>4,f=n&&r>1,p=n&&r>2,m=r>3,y=64,g=Ir(c),_=[{type:12,data:l},{type:12,data:g},{type:12,data:c},{type:1,data:e.epsilon}],v=x=>{let M=[{name:"output_size",type:"u32"},{name:"components",type:"u32"},{name:"hidden_size",type:"u32"},{name:"epsilon",type:"f32"}],T=[Ie("x",t[0].dataType,t[0].dims,g),Ie("skip",t[1].dataType,t[1].dims,g),Ie("gamma",t[2].dataType,t[2].dims,g)];d&&T.push(Ie("beta",t[3].dataType,t[3].dims,g)),h&&T.push(Ie("bias",t[4].dataType,t[4].dims,g)),T.push(dt("output",t[0].dataType,a,g)),f&&T.push(dt("mean_output",1,u)),p&&T.push(dt("inv_std_output",1,u)),m&&T.push(dt("input_skip_bias_sum",t[0].dataType,a,g));let S=wn(t[0].dataType),k=wn(1,g);return`

      ${x.registerUniforms(M).declareVariables(...T)}
      var<workgroup> sum_shared : array<${k}, ${y}>;
      var<workgroup> sum_squared_shared : array<${k}, ${y}>;

      ${x.mainStart([y,1,1])}
        let ix = local_id.x;
        let iy = global_id.x / ${y};

        let hidden_size_vectorized: u32 = uniforms.hidden_size / uniforms.components;
        var stride = hidden_size_vectorized / ${y};
        let offset = ix * stride + iy * hidden_size_vectorized;
        let offset1d = stride * ix;
        if (ix == ${y-1}) {
          stride = hidden_size_vectorized - stride * ix;
        }
        for (var i: u32 = 0; i < stride; i++) {
          let skip_value = skip[offset + i];
          let bias_value = ${h?"bias[offset1d + i]":S+"(0.0)"};
          let input_value = x[offset + i];
          let value = input_value + skip_value + bias_value;
          ${m?"input_skip_bias_sum[offset + i] = value;":""}
          output[offset + i] = value;
          let f32_value = ${Gc(S,g,"value")};
          sum_shared[ix] += f32_value;
          sum_squared_shared[ix] += f32_value * f32_value;
        }
        workgroupBarrier();

        var reduce_size : u32 = ${y};
        for (var curr_size = reduce_size >> 1;  curr_size > 0; curr_size = reduce_size >> 1) {
          reduce_size = curr_size + (reduce_size & 1);
          if (ix < curr_size) {
            sum_shared[ix] += sum_shared[ix + reduce_size];
            sum_squared_shared[ix] += sum_squared_shared[ix + reduce_size];
          }
          workgroupBarrier();
        }

        let sum = sum_shared[0];
        let square_sum = sum_squared_shared[0];
        let mean = ${Ba("sum",g)} / f32(uniforms.hidden_size);
        let inv_std_dev = inverseSqrt(${Ba("square_sum",g)} / f32(uniforms.hidden_size) ${s?"":"- mean * mean"} + uniforms.epsilon);
        ${f?"mean_output[global_idx] = mean;":""}
        ${p?"inv_std_output[global_idx] = inv_std_dev;":""}

        for (var i: u32 = 0; i < stride; i++) {
          output[offset + i] = (output[offset + i] ${s?"":`- ${S}(mean)`}) *
            ${S}(inv_std_dev) * gamma[offset1d + i]
            ${d?"+ beta[offset1d + i]":""};
        }
      }`},w=[{dims:a,dataType:t[0].dataType}];return r>1&&w.push({dims:u,dataType:1}),r>2&&w.push({dims:u,dataType:1}),r>3&&w.push({dims:i,dataType:t[0].dataType}),{name:"SkipLayerNormalization",shaderCache:{hint:`${g};${f};${p};${m}`,inputDependencies:t.map((x,M)=>"type")},getShaderSource:v,getRunData:()=>({outputs:w,dispatchGroup:{x:Math.ceil(l/c)},programUniforms:_})}},sz=(t,e)=>{vO(t.inputs);let r=[0];t.outputCount>1&&r.push(-3),t.outputCount>2&&r.push(-3),t.outputCount>3&&r.push(3),t.compute(wO(t.inputs,e,t.outputCount,!1),{outputs:r})}}),xO,Vd,bO,bv,MO,TO,iz,oz,nX=Ke(()=>{St(),It(),Wr(),Ft(),xO=(t,e)=>{if(!t||t.length<1)throw new Error("too few inputs");if(e.axes.length!==0){if(e.axes.length!==e.starts.length||e.axes.length!==e.ends.length)throw new Error("axes, starts and ends must have the same length")}else if(e.starts.length!==e.ends.length)throw new Error("starts and ends must have the same length");t.slice(1).forEach((r,n)=>{if(t[n+1].dataType!==6&&t[n+1].dataType!==7)throw new Error(`Input ${n} must be an array of int32 or int64`)})},Vd=(t,e)=>{let r=[];if(t.length>e)if(t[e].dataType===7)t[e].getBigInt64Array().forEach(n=>r.push(Number(n)));else if(t[e].dataType===6)t[e].getInt32Array().forEach(n=>r.push(Number(n)));else throw new Error(`Input ${e} must be an array of int32 or int64`);return r},bO=(t,e)=>{if(t.length>1){let r=Vd(t,1),n=Vd(t,2),s=Vd(t,3);return s.length===0&&(s=[...Array(t[0].dims.length).keys()]),or({starts:r,ends:n,axes:s})}else return e},bv=(t,e,r,n,s)=>{let i=t;return t<0&&(i+=r[n[e]]),s[e]<0?Math.max(0,Math.min(i,r[n[e]]-1)):Math.max(0,Math.min(i,r[n[e]]))},MO=(t,e,r)=>`fn calculateInputIndices(output_indices: ${e.type.indices}) -> ${t.type.indices} {
          var input_indices: ${t.type.indices};
          var carry = 0u;
          for (var i = ${r.length}; i >= 0; i--) {
            let input_shape_i = ${gt("uniforms.input_shape","i",r.length)};
            let steps_i = ${gt("uniforms.steps","i",r.length)};
            let signs_i = ${gt("uniforms.signs","i",r.length)};
            let starts_i = ${gt("uniforms.starts","i",r.length)};
            var output_index = ${e.indicesGet("output_indices","i")};
            var input_index = output_index * steps_i + starts_i + carry;
            carry = input_index / input_shape_i;
            input_index = input_index % input_shape_i;
            if (signs_i < 0) {
              input_index = input_shape_i - input_index - 1u + starts_i;
            }
            ${t.indicesSet("input_indices","i","input_index")};
          }
          return input_indices;
      }`,TO=(t,e)=>{let r=t[0].dims,n=Se.size(r),s=e.axes.length>0?Se.normalizeAxes(e.axes,r.length):[...Array(r.length).keys()],i=Vd(t,4);i.forEach(g=>g!==0||(()=>{throw new Error("step cannot be 0")})),i.length===0&&(i=Array(s.length).fill(1));let o=e.starts.map((g,_)=>bv(g,_,r,s,i)),a=e.ends.map((g,_)=>bv(g,_,r,s,i));if(s.length!==o.length||s.length!==a.length)throw new Error("start, ends and axes should have the same number of elements");if(s.length!==r.length)for(let g=0;g<r.length;++g)s.includes(g)||(o.splice(g,0,0),a.splice(g,0,r[g]),i.splice(g,0,1));let l=i.map(g=>Math.sign(g));i.forEach((g,_,v)=>{if(g<0){let w=(a[_]-o[_])/g,x=o[_],M=x+w*i[_];o[_]=M,a[_]=x,v[_]=-g}});let c=r.slice(0);s.forEach((g,_)=>{c[g]=Math.ceil((a[g]-o[g])/i[g])});let u={dims:c,dataType:t[0].dataType},d=dt("output",t[0].dataType,c.length),h=Ie("input",t[0].dataType,t[0].dims.length),f=Se.size(c),p=[{name:"outputSize",type:"u32"},{name:"starts",type:"u32",length:o.length},{name:"signs",type:"i32",length:l.length},{name:"steps",type:"u32",length:i.length}],m=[{type:12,data:f},{type:12,data:o},{type:6,data:l},{type:12,data:i},...wt(t[0].dims,c)],y=g=>`
      ${g.registerUniforms(p).declareVariables(h,d)}
        ${MO(h,d,r)}
        ${g.mainStart()}
          ${g.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.outputSize")}
          let output_indices = ${d.offsetToIndices("global_idx")};
          let input_indices = calculateInputIndices(output_indices);
          ${d.setByOffset("global_idx",h.getByIndices("input_indices"))}
      }`;return{name:"Slice",shaderCache:{hint:`${l.length}_${o.length}_${i.length}`,inputDependencies:["rank"]},getShaderSource:y,getRunData:()=>({outputs:[u],dispatchGroup:{x:Math.ceil(n/64)},programUniforms:m})}},iz=(t,e)=>{xO(t.inputs,e);let r=bO(t.inputs,e);t.compute(TO(t.inputs,r),{inputs:[0]})},oz=t=>{let e=t.starts,r=t.ends,n=t.axes;return or({starts:e,ends:r,axes:n})}}),CO,SO,az,lz,sX=Ke(()=>{St(),It(),Wr(),Ka(),Ft(),CO=t=>{if(!t||t.length!==1)throw new Error("Softmax op requires 1 input.")},SO=(t,e)=>{let r=t.inputs[0],n=r.dims,s=Se.size(n),i=n.length,o=Se.normalizeAxis(e.axis,i),a=o<n.length-1,l,c=[];a?(c=Array.from({length:i},(T,S)=>S),c[o]=i-1,c[i-1]=o,l=t.compute(Fs(r,c),{inputs:[r],outputs:[-1]})[0]):l=r;let u=l.dims,d=u[i-1],h=s/d,f=Ir(d),p=d/f,m=64;h===1&&(m=256);let y=(T,S)=>S===4?`max(max(${T}.x, ${T}.y), max(${T}.z, ${T}.w))`:S===2?`max(${T}.x, ${T}.y)`:S===3?`max(max(${T}.x, ${T}.y), ${T}.z)`:T,g=Ie("x",l.dataType,l.dims,f),_=dt("result",l.dataType,l.dims,f),v=g.type.value,w=wn(l.dataType)==="f32"?`var threadMax = ${v}(-3.402823e+38f);`:`var threadMax = ${v}(-65504.0h);`,x=T=>`
      var<workgroup> rowMaxShared : ${v};
      var<workgroup> rowSumShared : ${v};
      var<workgroup> threadShared : array<${v}, ${m}>;

      fn getValue(row: i32, col: i32, row_stride: i32) -> ${v} {
        let index = row * row_stride + col;
        return x[index];
      }

      fn setValue(row: i32, col: i32, row_stride: i32, value: ${v}) {
        let index = row * row_stride + col;
        result[index] = value;
      }
      ${T.registerUniform("packedCols","i32").declareVariables(g,_)}
      ${T.mainStart(m)}
        let gindex = i32(global_idx);
        let lindex = i32(local_idx);
        const wg = ${m};
        let row = gindex / wg;
        let cols = uniforms.packedCols;
        let row_stride : i32 = uniforms.packedCols;

        // find the rows max
        ${w}
        for (var col = lindex; col < cols; col += wg) {
          let value = getValue(row, col, row_stride);
          threadMax = max(threadMax, value);
        }
        if (lindex < cols) {
          threadShared[lindex] = threadMax;
        }
        workgroupBarrier();

        var reduceSize = min(cols, wg);
        for (var currSize = reduceSize >> 1;  currSize > 0; currSize = reduceSize >> 1) {
          reduceSize = currSize + (reduceSize & 1);
          if (lindex < currSize) {
            threadShared[lindex] = max(threadShared[lindex], threadShared[lindex + reduceSize]);
          }
          workgroupBarrier();
        }
        if (lindex == 0) {
          rowMaxShared = ${v}(${y("threadShared[0]",f)});
        }
        workgroupBarrier();

        // find the rows sum
        var threadSum = ${v}(0.0);
        for (var col = lindex; col < cols; col += wg) {
          let subExp = exp(getValue(row, col, row_stride) - rowMaxShared);
          threadSum += subExp;
        }
        threadShared[lindex] = threadSum;
        workgroupBarrier();

        for (var currSize = wg >> 1;  currSize > 0; currSize = currSize >> 1) {
          if (lindex < currSize) {
            threadShared[lindex] = threadShared[lindex] + threadShared[lindex + currSize];
          }
          workgroupBarrier();
        }
        if (lindex == 0) {
          rowSumShared = ${v}(${Ba("threadShared[0]",f)});
        }
        workgroupBarrier();

        // calculate final value for each element in the row
        for (var col = lindex; col < cols; col += wg) {
          let value = exp(getValue(row, col, row_stride) - rowMaxShared) / rowSumShared;
          setValue(row, col, row_stride, value);
        }
      }`,M=t.compute({name:"Softmax",shaderCache:{hint:`${f};${m}`,inputDependencies:["type"]},getRunData:()=>({outputs:[{dims:u,dataType:l.dataType}],dispatchGroup:{x:h},programUniforms:[{type:6,data:p}]}),getShaderSource:x},{inputs:[l],outputs:[a?-1:0]})[0];a&&t.compute(Fs(M,c),{inputs:[M]})},az=(t,e)=>{CO(t.inputs),SO(t,e)},lz=t=>or({axis:t.axis})}),Mv,EO,PO,kO,cz,iX=Ke(()=>{St(),It(),Ft(),Mv=t=>Array.from(t.getBigInt64Array(),Number),EO=t=>{if(!t||t.length!==2)throw new Error("Tile requires 2 inputs.");if(t[0].dataType!==1&&t[0].dataType!==10&&t[0].dataType!==6&&t[0].dataType!==12)throw new Error("Tile only support float, float16, int32, and uint32 data types");if(t[1].dataType!==7)throw new Error("Tile `repeats` input should be of int64 data type");if(t[1].dims.length!==1)throw new Error("Tile `repeats` input should be 1-D");if(Mv(t[1]).length!==t[0].dims.length)throw new Error("Tile `repeats` input should have same number of elements as rank of input data tensor")},PO=(t,e)=>{let r=[];for(let n=0;n<t.length;++n)r.push(t[n]*e[n]);return r},kO=(t,e)=>{let r=t[0].dims,n=e??Mv(t[1]),s=PO(r,n),i=Se.size(s),o=t[0].dataType,a=Ie("input",o,r.length),l=dt("output",o,s.length),c=u=>`
      const inputShape = ${a.indices(...r)};
      ${u.registerUniform("output_size","u32").declareVariables(a,l)}
      ${u.mainStart()}
      ${u.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}
      let output_indices = ${l.offsetToIndices("global_idx")};
      var input_indices: ${a.type.indices};
      for (var i = 0; i < ${r.length}; i++) {
        let input_dim_i = ${a.indicesGet("uniforms.input_shape","i")};
        let input_dim_value = ${l.indicesGet("output_indices","i")}  % input_dim_i;

        ${a.indicesSet("input_indices","i","input_dim_value")}
      }
      ${l.setByOffset("global_idx",a.getByIndices("input_indices"))}
    }`;return{name:"Tile",shaderCache:{hint:`${n}`,inputDependencies:["rank"]},getRunData:()=>({outputs:[{dims:s,dataType:t[0].dataType}],dispatchGroup:{x:Math.ceil(i/64)},programUniforms:[{type:12,data:i},...wt(t[0].dims,s)]}),getShaderSource:c}},cz=t=>{EO(t.inputs),t.compute(kO(t.inputs),{inputs:[0]})}}),AO,$O,uz,oX=Ke(()=>{St(),It(),Ft(),AO=(t,e,r,n,s)=>{let i=dt("output_data",s,r.length,4),o=Ie("a_data",e[1].dataType,e[1].dims.length,4),a=Ie("b_data",e[2].dataType,e[2].dims.length,4),l=Ie("c_data",e[0].dataType,e[0].dims.length,4),c,u=(d,h,f)=>`select(${h}, ${d}, ${f})`;if(!n)c=i.setByOffset("global_idx",u(o.getByOffset("global_idx"),a.getByOffset("global_idx"),l.getByOffset("global_idx")));else{let d=(h,f,p="")=>{let m=`a_data[index_a${f}][component_a${f}]`,y=`b_data[index_b${f}][component_b${f}]`,g=`bool(c_data[index_c${f}] & (0xffu << (component_c${f} * 8)))`;return`
            let output_indices${f} = ${i.offsetToIndices(`global_idx * 4u + ${f}u`)};
            let offset_a${f} = ${o.broadcastedIndicesToOffset(`output_indices${f}`,i)};
            let offset_b${f} = ${a.broadcastedIndicesToOffset(`output_indices${f}`,i)};
            let offset_c${f} = ${l.broadcastedIndicesToOffset(`output_indices${f}`,i)};
            let index_a${f} = offset_a${f} / 4u;
            let index_b${f} = offset_b${f} / 4u;
            let index_c${f} = offset_c${f} / 4u;
            let component_a${f} = offset_a${f} % 4u;
            let component_b${f} = offset_b${f} % 4u;
            let component_c${f} = offset_c${f} % 4u;
            ${h}[${f}] = ${p}(${u(m,y,g)});
          `};s===9?c=`
            var data = vec4<u32>(0);
            ${d("data",0,"u32")}
            ${d("data",1,"u32")}
            ${d("data",2,"u32")}
            ${d("data",3,"u32")}
            output_data[global_idx] = dot(vec4<u32>(0x1, 0x100, 0x10000, 0x1000000), vec4<u32>(data));`:c=`
            ${d("output_data[global_idx]",0)}
            ${d("output_data[global_idx]",1)}
            ${d("output_data[global_idx]",2)}
            ${d("output_data[global_idx]",3)}
          `}return`
        ${t.registerUniform("vec_size","u32").declareVariables(l,o,a,i)}
        ${t.mainStart()}
        ${t.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.vec_size")}
        ${c}
      }`},$O=t=>{let e=t[1].dims,r=t[2].dims,n=t[0].dims,s=t[1].dataType,i=!(Se.areEqual(e,r)&&Se.areEqual(r,n)),o=e,a=Se.size(e);if(i){let c=Pu.calcShape(Pu.calcShape(e,r,!1),n,!1);if(!c)throw new Error("Can't perform where op on the given tensors");o=c,a=Se.size(o)}let l=Math.ceil(a/4);return{name:"Where",shaderCache:{inputDependencies:["rank","rank","rank"]},getShaderSource:c=>AO(c,t,o,i,s),getRunData:()=>({outputs:[{dims:o,dataType:s}],dispatchGroup:{x:Math.ceil(a/64/4)},programUniforms:[{type:12,data:l},...wt(n,e,r,o)]})}},uz=t=>{t.compute($O(t.inputs))}}),dz,aX=Ke(()=>{x9(),Eb(),b9(),M9(),T9(),C9(),S9(),$9(),D9(),I9(),F9(),L9(),R9(),j9(),N9(),z9(),B9(),V9(),W9(),U9(),G9(),H9(),K9(),X9(),q9(),AN(),Y9(),Q9(),J9(),Z9(),eX(),Sb(),tX(),FN(),rX(),nX(),sX(),DN(),iX(),Ka(),Pb(),oX(),dz=new Map([["Abs",[sj]],["Acos",[ij]],["Acosh",[oj]],["Add",[zj]],["ArgMax",[ej,hx]],["ArgMin",[Z3,hx]],["Asin",[aj]],["Asinh",[lj]],["Atan",[cj]],["Atanh",[uj]],["Attention",[tj]],["AveragePool",[UN,WN]],["BatchNormalization",[rj]],["BiasAdd",[nj]],["BiasSplitGelu",[Nj]],["Cast",[hj,dj]],["Ceil",[pj]],["Clip",[fj]],["Concat",[Yj,Qj]],["Conv",[yx,_x]],["ConvTranspose",[aN,oN]],["Cos",[mj]],["Cosh",[gj]],["CumSum",[lN,cN]],["DepthToSpace",[uN,dN]],["DequantizeLinear",[QN,JN]],["Div",[Bj]],["Einsum",[hN,fN]],["Elu",[_j,Zd]],["Equal",[Vj]],["Erf",[yj]],["Exp",[vj]],["Expand",[pN]],["FastGelu",[mN]],["Floor",[wj]],["FusedConv",[yx,_x]],["Gather",[_N,gN]],["GatherElements",[MN,bN]],["GatherBlockQuantized",[wN,xN]],["GatherND",[yN,vN]],["Gelu",[xj]],["Gemm",[CN,TN]],["GlobalAveragePool",[HN,GN]],["GlobalMaxPool",[YN,qN]],["Greater",[Hj]],["GreaterOrEqual",[Xj]],["GridSample",[SN,EN]],["GroupQueryAttention",[LN]],["HardSigmoid",[kj,Pj]],["InstanceNormalization",[RN]],["LayerNormalization",[jN]],["LeakyRelu",[bj,Zd]],["Less",[Kj]],["LessOrEqual",[qj]],["Log",[Rj]],["MatMul",[NN]],["MatMulNBits",[zN,BN]],["MaxPool",[KN,XN]],["Mul",[Wj]],["MultiHeadAttention",[kN,PN]],["Neg",[Tj]],["Not",[Mj]],["Pad",[VN]],["Pow",[Uj]],["QuickGelu",[jj,Zd]],["Range",[ZN]],["Reciprocal",[Cj]],["ReduceMin",[X3]],["ReduceMean",[W3]],["ReduceMax",[K3]],["ReduceSum",[Y3]],["ReduceProd",[q3]],["ReduceL1",[U3]],["ReduceL2",[G3]],["ReduceLogSum",[J3]],["ReduceLogSumExp",[H3]],["ReduceSumSquare",[Q3]],["Relu",[Sj]],["Resize",[rz,nz]],["RotaryEmbedding",[IN]],["ScatterND",[tz,ez]],["Sigmoid",[Ej]],["Sin",[Aj]],["Sinh",[$j]],["Slice",[iz,oz]],["SkipLayerNormalization",[sz]],["Split",[$N,ON]],["Sqrt",[Oj]],["Softmax",[az,lz]],["Sub",[Gj]],["Tan",[Dj]],["Tanh",[Ij]],["ThresholdedRelu",[Lj,Zd]],["Tile",[cz]],["Transpose",[$3,O3]],["Where",[uz]]])}),hz,lX=Ke(()=>{Vi(),Ho(),Ft(),hz=class{constructor(t){this.backend=t,this.repo=new Map,this.attributesBound=!1}getArtifact(t){return this.repo.get(t)}setArtifact(t,e){this.repo.set(t,e)}run(t,e,r,n,s){Bi(t.programInfo.name);let i=this.backend.device,o=this.backend.getComputePassEncoder();this.backend.writeTimestamp(this.backend.pendingDispatchNumber*2);let a=[];for(let c of e)a.push({binding:a.length,resource:{buffer:c.buffer}});for(let c of r)a.push({binding:a.length,resource:{buffer:c.buffer}});s&&a.push({binding:a.length,resource:s});let l=i.createBindGroup({layout:t.computePipeline.getBindGroupLayout(0),entries:a,label:t.programInfo.name});if(this.backend.sessionStatus==="capturing"){let c={kernelId:this.backend.currentKernelId,computePipeline:t.computePipeline,bindGroup:l,dispatchGroup:n};this.backend.capturedCommandList.get(this.backend.currentSessionId).push(c)}o.setPipeline(t.computePipeline),o.setBindGroup(0,l),o.dispatchWorkgroups(...n),this.backend.writeTimestamp(this.backend.pendingDispatchNumber*2+1),this.backend.pendingDispatchNumber++,(this.backend.pendingDispatchNumber>=this.backend.maxDispatchNumber||this.backend.queryType==="at-passes")&&this.backend.endComputePass(),this.backend.pendingDispatchNumber>=this.backend.maxDispatchNumber&&this.backend.flush(),ni(t.programInfo.name)}dispose(){}build(t,e){Bi(t.name);let r=this.backend.device,n=[];[{feature:"shader-f16",extension:"f16"},{feature:"subgroups",extension:"subgroups"}].forEach(c=>{r.features.has(c.feature)&&n.push(`enable ${c.extension};`)});let s=A3(e,this.backend.device.limits),i=t.getShaderSource(s),o=`${n.join(`
`)}
${s.additionalImplementations}
${i}`,a=r.createShaderModule({code:o,label:t.name});Gt("verbose",()=>`[WebGPU] ${t.name} shader code: ${o}`);let l=r.createComputePipeline({compute:{module:a,entryPoint:"main"},layout:"auto",label:t.name});return ni(t.name),{programInfo:t,computePipeline:l,uniformVariablesInfo:s.variablesInfo}}normalizeDispatchGroupSize(t){let e=typeof t=="number"?t:t.x,r=typeof t=="number"?1:t.y||1,n=typeof t=="number"?1:t.z||1,s=this.backend.device.limits.maxComputeWorkgroupsPerDimension;if(e<=s&&r<=s&&n<=s)return[e,r,n];let i=e*r*n,o=Math.ceil(Math.sqrt(i));if(o>s){if(o=Math.ceil(Math.cbrt(i)),o>s)throw new Error("Total dispatch size exceeds WebGPU maximum.");return[o,o,o]}else return[o,o,1]}}}),fz={};Nu(fz,{WebGpuBackend:()=>pz});var OO,DO,IO,pz,cX=Ke(()=>{Vi(),St(),Ho(),C3(),v9(),aX(),lX(),OO=(t,e)=>{if(e.length!==t.length)throw new Error(`inputDependencies length ${e.length} is not equal to inputTensors length ${t.length}.`);let r=[];for(let n=0;n<t.length;++n){let s=t[n].dataType;switch(e[n]){case"none":{r.push("");break}case"type":{r.push(`${s}`);break}case"rank":{let i=t[n].dims.length;r.push(`${s};${i}`);break}case"dims":{let i=t[n].dims.join(",");r.push(`${s};${i}`);break}default:throw new Error(`unsupported input dependency: ${e[n]}`)}}return r.join("|")},DO=(t,e,r)=>{var s,i;let n=t.name;return(s=t.shaderCache)!=null&&s.hint&&(n+="["+t.shaderCache.hint+"]"),n+=":"+r+`:${OO(e,((i=t.shaderCache)==null?void 0:i.inputDependencies)??new Array(e.length).fill("dims"))}`,n},IO=class{constructor(t){t&&(this.architecture=t.architecture,this.vendor=t.vendor)}isArchitecture(t){return this.architecture===t}isVendor(t){return this.vendor===t}},pz=class{constructor(){this.currentSessionId=null,this.currentKernelId=null,this.commandEncoder=null,this.computePassEncoder=null,this.maxDispatchNumber=16,this.pendingDispatchNumber=0,this.pendingKernels=[],this.pendingQueries=new Map,this.sessionStatus="default",this.capturedCommandList=new Map,this.capturedPendingKernels=new Map,this.sessionExternalDataMapping=new Map}get currentKernelCustomData(){if(this.currentKernelId===null)throw new Error("currentKernelCustomData(): currentKernelId is null. (should not happen)");let t=this.kernelCustomData.get(this.currentKernelId);return t||(t={},this.kernelCustomData.set(this.currentKernelId,t)),t}async initialize(t,e){this.env=t;let r=[],n={requiredLimits:{maxComputeWorkgroupStorageSize:e.limits.maxComputeWorkgroupStorageSize,maxComputeWorkgroupsPerDimension:e.limits.maxComputeWorkgroupsPerDimension,maxStorageBufferBindingSize:e.limits.maxStorageBufferBindingSize,maxBufferSize:e.limits.maxBufferSize,maxComputeInvocationsPerWorkgroup:e.limits.maxComputeInvocationsPerWorkgroup,maxComputeWorkgroupSizeX:e.limits.maxComputeWorkgroupSizeX,maxComputeWorkgroupSizeY:e.limits.maxComputeWorkgroupSizeY,maxComputeWorkgroupSizeZ:e.limits.maxComputeWorkgroupSizeZ},requiredFeatures:r},s=i=>e.features.has(i)&&r.push(i)&&!0;s("chromium-experimental-timestamp-query-inside-passes")||s("timestamp-query"),s("shader-f16"),s("subgroups"),this.device=await e.requestDevice(n),this.adapterInfo=new IO(e.info||await e.requestAdapterInfo()),this.gpuDataManager=P3(this),this.programManager=new hz(this),this.kernels=new Map,this.kernelPersistentData=new Map,this.kernelCustomData=new Map,bb(t.logLevel,!!t.debug),this.device.onuncapturederror=i=>{i.error instanceof GPUValidationError&&console.error(`An uncaught WebGPU validation error was raised: ${i.error.message}`)},Object.defineProperty(this.env.webgpu,"device",{value:this.device,writable:!1,enumerable:!0,configurable:!1}),Object.defineProperty(this.env.webgpu,"adapter",{value:e,writable:!1,enumerable:!0,configurable:!1}),this.setQueryType()}dispose(){typeof this.querySet<"u"&&this.querySet.destroy(),this.gpuDataManager.dispose()}getCommandEncoder(){return this.commandEncoder||(this.commandEncoder=this.device.createCommandEncoder()),this.commandEncoder}getComputePassEncoder(){if(!this.computePassEncoder){let t=this.getCommandEncoder(),e={};this.queryType==="at-passes"&&(e.timestampWrites={querySet:this.querySet,beginningOfPassWriteIndex:this.pendingDispatchNumber*2,endOfPassWriteIndex:this.pendingDispatchNumber*2+1}),this.computePassEncoder=t.beginComputePass(e)}return this.computePassEncoder}endComputePass(){this.computePassEncoder&&(this.computePassEncoder.end(),this.computePassEncoder=null)}flush(){if(!this.commandEncoder)return;Bi(),this.endComputePass();let t;this.queryType!=="none"&&(this.commandEncoder.resolveQuerySet(this.querySet,0,this.pendingDispatchNumber*2,this.queryResolveBuffer,0),t=this.device.createBuffer({size:this.pendingDispatchNumber*2*8,usage:GPUBufferUsage.MAP_READ|GPUBufferUsage.COPY_DST}),this.pendingQueries.set(t,this.pendingKernels),this.pendingKernels=[],this.commandEncoder.copyBufferToBuffer(this.queryResolveBuffer,0,t,0,this.pendingDispatchNumber*2*8)),this.device.queue.submit([this.commandEncoder.finish()]),this.gpuDataManager.refreshPendingBuffers(),this.commandEncoder=null,this.pendingDispatchNumber=0,this.queryType!=="none"&&t.mapAsync(GPUMapMode.READ).then(()=>{var n;let e=new BigUint64Array(t.getMappedRange()),r=this.pendingQueries.get(t);for(let s=0;s<e.length/2;s++){let i=r[s],o=i.kernelId,a=this.kernels.get(o),l=a.kernelType,c=a.kernelName,u=i.programName,d=i.inputTensorViews,h=i.outputTensorViews,f=e[s*2],p=e[s*2+1];typeof this.queryTimeBase>"u"&&(this.queryTimeBase=f);let m=Number(f-this.queryTimeBase),y=Number(p-this.queryTimeBase);if(!Number.isSafeInteger(m)||!Number.isSafeInteger(y))throw new RangeError("incorrect timestamp range");if((n=this.env.webgpu.profiling)!=null&&n.ondata)this.env.webgpu.profiling.ondata({version:1,inputsMetadata:d.map(g=>({dims:g.dims,dataType:Eo(g.dataType)})),outputsMetadata:h.map(g=>({dims:g.dims,dataType:Eo(g.dataType)})),kernelId:o,kernelType:l,kernelName:c,programName:u,startTime:m,endTime:y});else{let g="";d.forEach((v,w)=>{g+=`input[${w}]: [${v.dims}] | ${Eo(v.dataType)}, `});let _="";h.forEach((v,w)=>{_+=`output[${w}]: [${v.dims}] | ${Eo(v.dataType)}, `}),console.log(`[profiling] kernel "${o}|${l}|${c}|${u}" ${g}${_}execution time: ${y-m} ns`)}Bh("GPU",`${u}::${f}::${p}`)}t.unmap(),this.pendingQueries.delete(t)}),ni()}run(t,e,r,n,s,i){Bi(t.name);let o=[];for(let _=0;_<e.length;++_){let v=e[_].data;if(v===0)continue;let w=this.gpuDataManager.get(v);if(!w)throw new Error(`no GPU data for input: ${v}`);o.push(w)}let{outputs:a,dispatchGroup:l,programUniforms:c}=t.getRunData(e),u=r.length===0?a.map((_,v)=>v):r;if(u.length!==a.length)throw new Error(`Output size ${u.length} must be equal to ${a.length}.`);let d=[],h=[];for(let _=0;_<a.length;++_){if(!Number.isInteger(u[_])||u[_]<-3||u[_]>=i)throw new Error(`Invalid output index: ${u[_]}`);if(u[_]===-3)continue;let v=u[_]===-1,w=u[_]===-2,x=v||w?s(a[_].dataType,a[_].dims):n(u[_],a[_].dataType,a[_].dims);if(d.push(x),x.data===0)continue;let M=this.gpuDataManager.get(x.data);if(!M)throw new Error(`no GPU data for output: ${x.data}`);if(v&&this.temporaryData.push(M),w){let T=this.kernelPersistentData.get(this.currentKernelId);T||(T=[],this.kernelPersistentData.set(this.currentKernelId,T)),T.push(M)}h.push(M)}if(o.length!==e.length||h.length!==d.length){if(h.length===0)return ni(t.name),d;throw new Error(`Program ${t.name} has zero-sized tensor(s) in inputs or outputs. This is not supported now.`)}let f;if(c){let _=0,v=[];c.forEach(T=>{let S=typeof T.data=="number"?[T.data]:T.data;if(S.length===0)return;let k=T.type===10?2:4,$,j;T.type===10?(j=S.length>4?16:S.length>2?8:S.length*k,$=S.length>4?16:k*S.length):(j=S.length<=2?S.length*k:16,$=16),_=Math.ceil(_/j)*j,v.push(_);let V=T.type===10?8:4;_+=S.length>4?Math.ceil(S.length/V)*$:S.length*k});let w=16;_=Math.ceil(_/w)*w;let x=new ArrayBuffer(_);c.forEach((T,S)=>{let k=v[S],$=typeof T.data=="number"?[T.data]:T.data;if(T.type===6)new Int32Array(x,k,$.length).set($);else if(T.type===12)new Uint32Array(x,k,$.length).set($);else if(T.type===10)new Uint16Array(x,k,$.length).set($);else if(T.type===1)new Float32Array(x,k,$.length).set($);else throw new Error(`Unsupported uniform type: ${Eo(T.type)}`)});let M=this.gpuDataManager.create(_,GPUBufferUsage.COPY_DST|GPUBufferUsage.UNIFORM);this.device.queue.writeBuffer(M.buffer,0,x,0,_),this.gpuDataManager.release(M.id),f={offset:0,size:_,buffer:M.buffer}}let p=this.programManager.normalizeDispatchGroupSize(l),m=p[1]===1&&p[2]===1,y=DO(t,e,m),g=this.programManager.getArtifact(y);if(g||(g=this.programManager.build(t,p),this.programManager.setArtifact(y,g),Gt("info",()=>`[artifact] key: ${y}, programName: ${t.name}`)),c&&g.uniformVariablesInfo){if(c.length!==g.uniformVariablesInfo.length)throw new Error(`Uniform variables count mismatch: expect ${g.uniformVariablesInfo.length}, got ${c.length} in program "${g.programInfo.name}".`);for(let _=0;_<c.length;_++){let v=c[_],w=v.type,x=typeof v.data=="number"?1:v.data.length,[M,T]=g.uniformVariablesInfo[_];if(w!==M||x!==T)throw new Error(`Uniform variable ${_} mismatch: expect type ${M} with size ${T}, got type ${w} with size ${x} in program "${g.programInfo.name}".`)}}if(Gt("info",()=>`[ProgramManager] run "${t.name}" (key=${y}) with ${p[0]}x${p[1]}x${p[2]}`),this.queryType!=="none"||this.sessionStatus==="capturing"){let _={kernelId:this.currentKernelId,programName:g.programInfo.name,inputTensorViews:e,outputTensorViews:d};this.pendingKernels.push(_),this.sessionStatus==="capturing"&&this.capturedPendingKernels.get(this.currentSessionId).push(_)}return this.programManager.run(g,o,h,p,f),ni(t.name),d}upload(t,e){this.gpuDataManager.upload(t,e)}memcpy(t,e){this.gpuDataManager.memcpy(t,e)}async download(t,e){await this.gpuDataManager.download(t,e)}alloc(t){return this.gpuDataManager.create(t).id}free(t){return this.gpuDataManager.release(t)}createKernel(t,e,r,n){let s=dz.get(t);if(!s)throw new Error(`kernel not implemented: ${t}`);let i={kernelType:t,kernelName:n,kernelEntry:s[0],attributes:[s[1],r]};this.kernels.set(e,i)}releaseKernel(t){let e=this.kernelPersistentData.get(t);if(e){for(let r of e)this.gpuDataManager.release(r.id);this.kernelPersistentData.delete(t)}this.kernelCustomData.delete(t),this.kernels.delete(t)}computeKernel(t,e,r){let n=this.kernels.get(t);if(!n)throw new Error(`kernel not created: ${t}`);let s=n.kernelType,i=n.kernelName,o=n.kernelEntry,a=n.attributes;if(this.currentKernelId!==null)throw new Error(`kernel "[${s}] ${i}" is not allowed to be called recursively`);this.currentKernelId=t,a[0]&&(a[1]=a[0](a[1]),a[0]=void 0),Gt("info",()=>`[WebGPU] Start to run kernel "[${s}] ${i}"...`);let l=this.env.debug;this.temporaryData=[];try{return l&&this.device.pushErrorScope("validation"),o(e,a[1]),0}catch(c){return r.push(Promise.resolve(`[WebGPU] Kernel "[${s}] ${i}" failed. ${c}`)),1}finally{l&&r.push(this.device.popErrorScope().then(c=>c?`GPU validation error for kernel "[${s}] ${i}": ${c.message}`:null));for(let c of this.temporaryData)this.gpuDataManager.release(c.id);this.temporaryData=[],this.currentKernelId=null}}registerBuffer(t,e,r,n){let s=this.sessionExternalDataMapping.get(t);s||(s=new Map,this.sessionExternalDataMapping.set(t,s));let i=s.get(e),o=this.gpuDataManager.registerExternalBuffer(r,n,i);return s.set(e,[o,r]),o}unregisterBuffers(t){let e=this.sessionExternalDataMapping.get(t);e&&(e.forEach(r=>this.gpuDataManager.unregisterExternalBuffer(r[0])),this.sessionExternalDataMapping.delete(t))}getBuffer(t){let e=this.gpuDataManager.get(t);if(!e)throw new Error(`no GPU data for buffer: ${t}`);return e.buffer}createDownloader(t,e,r){return async()=>{let n=await cx(this,t,e);return Mb(n.buffer,r)}}writeTimestamp(t){this.queryType==="inside-passes"&&this.computePassEncoder.writeTimestamp(this.querySet,t)}setQueryType(){var t;this.queryType="none",(((t=this.env.webgpu.profiling)==null?void 0:t.mode)==="default"||(typeof this.env.trace>"u"?this.env.wasm.trace:this.env.trace))&&(this.device.features.has("chromium-experimental-timestamp-query-inside-passes")?this.queryType="inside-passes":this.device.features.has("timestamp-query")&&(this.queryType="at-passes"),this.queryType!=="none"&&typeof this.querySet>"u"&&(this.querySet=this.device.createQuerySet({type:"timestamp",count:this.maxDispatchNumber*2}),this.queryResolveBuffer=this.device.createBuffer({size:this.maxDispatchNumber*2*8,usage:GPUBufferUsage.COPY_SRC|GPUBufferUsage.QUERY_RESOLVE})))}captureBegin(){Gt("info","captureBegin"),this.capturedCommandList.get(this.currentSessionId)||this.capturedCommandList.set(this.currentSessionId,[]),this.capturedPendingKernels.get(this.currentSessionId)||this.capturedPendingKernels.set(this.currentSessionId,[]),this.flush(),this.sessionStatus="capturing"}captureEnd(){Gt("info","captureEnd"),this.flush(),this.sessionStatus="default"}replay(){Gt("info","replay"),this.sessionStatus="replaying";let t=this.capturedCommandList.get(this.currentSessionId),e=this.capturedPendingKernels.get(this.currentSessionId),r=t.length;this.pendingKernels=[];for(let n=0;n<r;n++){let s=this.getComputePassEncoder(),i=t[n];this.writeTimestamp(this.pendingDispatchNumber*2),s.setPipeline(i.computePipeline),s.setBindGroup(0,i.bindGroup),s.dispatchWorkgroups(...i.dispatchGroup),this.writeTimestamp(this.pendingDispatchNumber*2+1),this.pendingDispatchNumber++,this.queryType!=="none"&&this.pendingKernels.push(e[n]),(this.pendingDispatchNumber>=this.maxDispatchNumber||this.queryType==="at-passes")&&this.endComputePass(),this.pendingDispatchNumber>=this.maxDispatchNumber&&this.flush()}this.flush(),this.sessionStatus="default"}onCreateSession(){this.gpuDataManager.onCreateSession()}onReleaseSession(t){this.unregisterBuffers(t),this.capturedCommandList.has(t)&&this.capturedCommandList.delete(t),this.capturedPendingKernels.has(t)&&this.capturedPendingKernels.delete(t),this.gpuDataManager.onReleaseSession(t)}onRunStart(t){this.currentSessionId=t,this.setQueryType()}}}),mz={};Nu(mz,{init:()=>gz});var Rp,FO,gz,uX=Ke(()=>{St(),Ho(),It(),y9(),Rp=class _z{constructor(e,r,n,s){this.module=e,this.dataType=r,this.data=n,this.dims=s}getFloat32Array(){if(this.dataType!==1)throw new Error("Invalid data type");let e=Se.size(this.dims);return e===0?new Float32Array:new Float32Array(this.module.HEAP8.buffer,this.data,e)}getBigInt64Array(){if(this.dataType!==7)throw new Error("Invalid data type");let e=Se.size(this.dims);return e===0?new BigInt64Array:new BigInt64Array(this.module.HEAP8.buffer,this.data,e)}getInt32Array(){if(this.dataType!==6)throw new Error("Invalid data type");let e=Se.size(this.dims);return e===0?new Int32Array:new Int32Array(this.module.HEAP8.buffer,this.data,e)}getUint16Array(){if(this.dataType!==10&&this.dataType!==4)throw new Error("Invalid data type");let e=Se.size(this.dims);return e===0?new Uint16Array:new Uint16Array(this.module.HEAP8.buffer,this.data,e)}reshape(e){if(Se.size(e)!==Se.size(this.dims))throw new Error("Invalid new shape");return new _z(this.module,this.dataType,this.data,e)}},FO=class{constructor(t,e,r){this.module=t,this.backend=e,this.customDataOffset=0,this.customDataSize=0,this.adapterInfo=e.adapterInfo;let n=t.PTR_SIZE,s=r/t.PTR_SIZE,i=n===4?"i32":"i64";this.opKernelContext=Number(t.getValue(n*s++,i));let o=Number(t.getValue(n*s++,i));this.outputCount=Number(t.getValue(n*s++,i)),this.customDataOffset=Number(t.getValue(n*s++,"*")),this.customDataSize=Number(t.getValue(n*s++,i));let a=[];for(let l=0;l<o;l++){let c=Number(t.getValue(n*s++,i)),u=Number(t.getValue(n*s++,"*")),d=Number(t.getValue(n*s++,i)),h=[];for(let f=0;f<d;f++)h.push(Number(t.getValue(n*s++,i)));a.push(new Rp(t,c,u,h))}this.inputs=a}get kernelCustomData(){return this.backend.currentKernelCustomData}get customDataBuffer(){return this.module.HEAPU8.subarray(this.customDataOffset,this.customDataOffset+this.customDataSize)}compute(t,e){var o;let r=((o=e==null?void 0:e.inputs)==null?void 0:o.map(a=>typeof a=="number"?this.inputs[a]:a))??this.inputs,n=(e==null?void 0:e.outputs)??[],s=(a,l,c)=>new Rp(this.module,l,this.output(a,c),c),i=(a,l)=>{let c=Sl(a,l);if(!c)throw new Error(`Unsupported data type: ${a}`);let u=c>0?this.backend.gpuDataManager.create(c).id:0;return new Rp(this.module,a,u,l)};return this.backend.run(t,r,n,s,i,this.outputCount)}output(t,e){let r=this.module.stackSave();try{let n=this.module.PTR_SIZE,s=n===4?"i32":"i64",i=this.module.stackAlloc((1+e.length)*n);this.module.setValue(i,e.length,s);for(let o=0;o<e.length;o++)this.module.setValue(i+n*(o+1),e[o],s);return this.module._JsepOutput(this.opKernelContext,t,i)}catch(n){throw new Error(`Failed to generate kernel's output[${t}] with dims [${e}]. If you are running with pre-allocated output, please make sure the output type/dims are correct. Error: ${n}`)}finally{this.module.stackRestore(r)}}},gz=async(t,e,r,n)=>{let s=e.jsepInit;if(!s)throw new Error("Failed to initialize JSEP. The WebAssembly module is not built with JSEP support.");if(t==="webgpu"){let i=(cX(),zh(fz)).WebGpuBackend,o=new i;await o.initialize(r,n),s("webgpu",[o,a=>o.alloc(Number(a)),a=>o.free(a),(a,l,c,u=!1)=>{if(u)Gt("verbose",()=>`[WebGPU] jsepCopyGpuToGpu: src=${Number(a)}, dst=${Number(l)}, size=${Number(c)}`),o.memcpy(Number(a),Number(l));else{Gt("verbose",()=>`[WebGPU] jsepCopyCpuToGpu: dataOffset=${Number(a)}, gpuDataId=${Number(l)}, size=${Number(c)}`);let d=e.HEAPU8.subarray(Number(a>>>0),Number(a>>>0)+Number(c));o.upload(Number(l),d)}},async(a,l,c)=>{Gt("verbose",()=>`[WebGPU] jsepCopyGpuToCpu: gpuDataId=${a}, dataOffset=${l}, size=${c}`),await o.download(Number(a),()=>e.HEAPU8.subarray(Number(l)>>>0,Number(l+c)>>>0))},(a,l,c)=>o.createKernel(a,Number(l),c,e.UTF8ToString(e._JsepGetNodeName(Number(l)))),a=>o.releaseKernel(a),(a,l,c,u)=>{Gt("verbose",()=>`[WebGPU] jsepRun: sessionHandle=${c}, kernel=${a}, contextDataOffset=${l}`);let d=new FO(e,o,Number(l));return o.computeKernel(Number(a),d,u)},()=>o.captureBegin(),()=>o.captureEnd(),()=>o.replay()])}else{let i=new E3(r);s("webnn",[i,()=>i.reserveTensorId(),o=>i.releaseTensorId(o),async(o,a,l,c,u)=>i.ensureTensor(o,a,l,c,u),(o,a)=>{i.uploadTensor(o,a)},async(o,a)=>i.downloadTensor(o,a)])}}}),LO,Ib,Fb,ca,RO,Tv,Sg,Lb,Rb,Cv,jb,Nb,zb,yz=Ke(()=>{m9(),g9(),St(),ic(),_b(),x3(),LO=(t,e)=>{vr()._OrtInit(t,e)!==0&&ur("Can't initialize onnxruntime.")},Ib=async t=>{LO(t.wasm.numThreads,xg(t.logLevel))},Fb=async(t,e)=>{var r,n;(n=(r=vr()).asyncInit)==null||n.call(r);{let s=(uX(),zh(mz)).init;if(e==="webgpu"){if(typeof navigator>"u"||!navigator.gpu)throw new Error("WebGPU is not supported in current environment");let i=t.webgpu.adapter;if(i){if(typeof i.limits!="object"||typeof i.features!="object"||typeof i.requestDevice!="function")throw new Error("Invalid GPU adapter set in `env.webgpu.adapter`. It must be a GPUAdapter object.")}else{let o=t.webgpu.powerPreference;if(o!==void 0&&o!=="low-power"&&o!=="high-performance")throw new Error(`Invalid powerPreference setting: "${o}"`);let a=t.webgpu.forceFallbackAdapter;if(a!==void 0&&typeof a!="boolean")throw new Error(`Invalid forceFallbackAdapter setting: "${a}"`);if(i=await navigator.gpu.requestAdapter({powerPreference:o,forceFallbackAdapter:a}),!i)throw new Error('Failed to get GPU adapter. You may need to enable flag "--enable-unsafe-webgpu" if you are using Chrome.')}await s("webgpu",vr(),t,i)}if(e==="webnn"){if(typeof navigator>"u"||!navigator.ml)throw new Error("WebNN is not supported in current environment");await s("webnn",vr(),t)}}},ca=new Map,RO=t=>{let e=vr(),r=e.stackSave();try{let n=e.PTR_SIZE,s=e.stackAlloc(2*n);e._OrtGetInputOutputCount(t,s,s+n)!==0&&ur("Can't get session input/output count.");let i=n===4?"i32":"i64";return[Number(e.getValue(s,i)),Number(e.getValue(s+n,i))]}finally{e.stackRestore(r)}},Tv=(t,e)=>{let r=vr(),n=r.stackSave(),s=0;try{let i=r.PTR_SIZE,o=r.stackAlloc(2*i);r._OrtGetInputOutputMetadata(t,e,o,o+i)!==0&&ur("Can't get session input/output metadata.");let a=Number(r.getValue(o,"*"));s=Number(r.getValue(o+i,"*"));let l=r.HEAP32[s/4];if(l===0)return[a,0];let c=r.HEAPU32[s/4+1],u=[];for(let d=0;d<c;d++){let h=Number(r.getValue(s+8+d*i,"*"));u.push(h!==0?r.UTF8ToString(h):Number(r.getValue(s+8+(d+c)*i,"*")))}return[a,l,u]}finally{r.stackRestore(n),s!==0&&r._OrtFree(s)}},Sg=t=>{let e=vr(),r=e._malloc(t.byteLength);if(r===0)throw new Error(`Can't create a session. failed to allocate a buffer of size ${t.byteLength}.`);return e.HEAPU8.set(t,r),[r,t.byteLength]},Lb=async(t,e)=>{var d,h,f,p;let r,n,s=vr();Array.isArray(t)?[r,n]=t:t.buffer===s.HEAPU8.buffer?[r,n]=[t.byteOffset,t.byteLength]:[r,n]=Sg(t);let i=0,o=0,a=0,l=[],c=[],u=[];try{if([o,l]=await w3(e),(e==null?void 0:e.externalData)&&s.mountExternalData){let S=[];for(let k of e.externalData){let $=typeof k=="string"?k:k.path;S.push(xb(typeof k=="string"?k:k.data).then(j=>{s.mountExternalData($,j)}))}await Promise.all(S)}for(let S of(e==null?void 0:e.executionProviders)??[])if((typeof S=="string"?S:S.name)==="webnn"){if(s.shouldTransferToMLTensor=!1,typeof S!="string"){let k=S,$=k==null?void 0:k.context,j=k==null?void 0:k.gpuDevice,V=k==null?void 0:k.deviceType,L=k==null?void 0:k.powerPreference;$?s.currentContext=$:j?s.currentContext=await s.webnnCreateMLContext(j):s.currentContext=await s.webnnCreateMLContext({deviceType:V,powerPreference:L})}else s.currentContext=await s.webnnCreateMLContext();break}i=await s._OrtCreateSession(r,n,o),(d=s.webgpuOnCreateSession)==null||d.call(s,i),i===0&&ur("Can't create a session."),(h=s.jsepOnCreateSession)==null||h.call(s),s.currentContext&&(s.webnnRegisterMLContext(i,s.currentContext),s.currentContext=void 0,s.shouldTransferToMLTensor=!0);let[m,y]=RO(i),g=!!(e!=null&&e.enableGraphCapture),_=[],v=[],w=[],x=[],M=[];for(let S=0;S<m;S++){let[k,$,j]=Tv(i,S);k===0&&ur("Can't get an input name."),c.push(k);let V=s.UTF8ToString(k);_.push(V),w.push($===0?{name:V,isTensor:!1}:{name:V,isTensor:!0,type:Eo($),shape:j})}for(let S=0;S<y;S++){let[k,$,j]=Tv(i,S+m);k===0&&ur("Can't get an output name."),u.push(k);let V=s.UTF8ToString(k);v.push(V),x.push($===0?{name:V,isTensor:!1}:{name:V,isTensor:!0,type:Eo($),shape:j});{if(g&&(e==null?void 0:e.preferredOutputLocation)===void 0){M.push("gpu-buffer");continue}let L=typeof(e==null?void 0:e.preferredOutputLocation)=="string"?e.preferredOutputLocation:((f=e==null?void 0:e.preferredOutputLocation)==null?void 0:f[V])??"cpu";if(L!=="cpu"&&L!=="cpu-pinned"&&L!=="gpu-buffer"&&L!=="ml-tensor")throw new Error(`Not supported preferred output location: ${L}.`);if(g&&L!=="gpu-buffer")throw new Error(`Not supported preferred output location: ${L}. Only 'gpu-buffer' location is supported when enableGraphCapture is true.`);M.push(L)}}let T=null;return M.some(S=>S==="gpu-buffer"||S==="ml-tensor")&&(a=s._OrtCreateBinding(i),a===0&&ur("Can't create IO binding."),T={handle:a,outputPreferredLocations:M,outputPreferredLocationsEncoded:M.map(S=>ax(S))}),ca.set(i,[i,c,u,T,g,!1]),[i,_,v,w,x]}catch(m){throw c.forEach(y=>s._OrtFree(y)),u.forEach(y=>s._OrtFree(y)),a!==0&&s._OrtReleaseBinding(a)!==0&&ur("Can't release IO binding."),i!==0&&s._OrtReleaseSession(i)!==0&&ur("Can't release session."),m}finally{s._free(r),o!==0&&s._OrtReleaseSessionOptions(o)!==0&&ur("Can't release session options."),l.forEach(m=>s._free(m)),(p=s.unmountExternalData)==null||p.call(s)}},Rb=t=>{var l,c,u;let e=vr(),r=ca.get(t);if(!r)throw new Error(`cannot release session. invalid session id: ${t}`);let[n,s,i,o,a]=r;o&&(a&&e._OrtClearBoundOutputs(o.handle)!==0&&ur("Can't clear bound outputs."),e._OrtReleaseBinding(o.handle)!==0&&ur("Can't release IO binding.")),(l=e.jsepOnReleaseSession)==null||l.call(e,t),(c=e.webnnOnReleaseSession)==null||c.call(e,t),(u=e.webgpuOnReleaseSession)==null||u.call(e,t),s.forEach(d=>e._OrtFree(d)),i.forEach(d=>e._OrtFree(d)),e._OrtReleaseSession(n)!==0&&ur("Can't release session."),ca.delete(t)},Cv=async(t,e,r,n,s,i,o=!1)=>{if(!t){e.push(0);return}let a=vr(),l=a.PTR_SIZE,c=t[0],u=t[1],d=t[3],h=d,f,p;if(c==="string"&&(d==="gpu-buffer"||d==="ml-tensor"))throw new Error("String tensor is not supported on GPU.");if(o&&d!=="gpu-buffer")throw new Error(`External buffer must be provided for input/output index ${i} when enableGraphCapture is true.`);if(d==="gpu-buffer"){let g=t[2].gpuBuffer;p=Sl(Ac(c),u);{let _=a.jsepRegisterBuffer;if(!_)throw new Error('Tensor location "gpu-buffer" is not supported without using WebGPU.');f=_(n,i,g,p)}}else if(d==="ml-tensor"){let g=t[2].mlTensor;p=Sl(Ac(c),u);let _=a.webnnRegisterMLTensor;if(!_)throw new Error('Tensor location "ml-tensor" is not supported without using WebNN.');f=_(n,g,Ac(c),u)}else{let g=t[2];if(Array.isArray(g)){p=l*g.length,f=a._malloc(p),r.push(f);for(let _=0;_<g.length;_++){if(typeof g[_]!="string")throw new TypeError(`tensor data at index ${_} is not a string`);a.setValue(f+_*l,ki(g[_],r),"*")}}else{let _=a.webnnIsGraphInput;if(c!=="string"&&_){let v=a.UTF8ToString(s);if(_(n,v)){let w=Ac(c);p=Sl(w,u),h="ml-tensor";let x=a.webnnCreateTemporaryTensor,M=a.webnnUploadTensor;if(!x||!M)throw new Error('Tensor location "ml-tensor" is not supported without using WebNN.');let T=await x(n,w,u);M(T,new Uint8Array(g.buffer,g.byteOffset,g.byteLength)),f=T}else p=g.byteLength,f=a._malloc(p),r.push(f),a.HEAPU8.set(new Uint8Array(g.buffer,g.byteOffset,p),f)}else p=g.byteLength,f=a._malloc(p),r.push(f),a.HEAPU8.set(new Uint8Array(g.buffer,g.byteOffset,p),f)}}let m=a.stackSave(),y=a.stackAlloc(4*u.length);try{u.forEach((_,v)=>a.setValue(y+v*l,_,l===4?"i32":"i64"));let g=a._OrtCreateTensor(Ac(c),f,p,y,u.length,ax(h));g===0&&ur(`Can't create tensor for input/output. session=${n}, index=${i}.`),e.push(g)}finally{a.stackRestore(m)}},jb=async(t,e,r,n,s,i)=>{var j,V,L,X;let o=vr(),a=o.PTR_SIZE,l=ca.get(t);if(!l)throw new Error(`cannot run inference. invalid session id: ${t}`);let c=l[0],u=l[1],d=l[2],h=l[3],f=l[4],p=l[5],m=e.length,y=n.length,g=0,_=[],v=[],w=[],x=[],M=o.stackSave(),T=o.stackAlloc(m*a),S=o.stackAlloc(m*a),k=o.stackAlloc(y*a),$=o.stackAlloc(y*a);try{[g,_]=v3(i);for(let J=0;J<m;J++)await Cv(r[J],v,x,t,u[e[J]],e[J],f);for(let J=0;J<y;J++)await Cv(s[J],w,x,t,d[n[J]],m+n[J],f);for(let J=0;J<m;J++)o.setValue(T+J*a,v[J],"*"),o.setValue(S+J*a,u[e[J]],"*");for(let J=0;J<y;J++)o.setValue(k+J*a,w[J],"*"),o.setValue($+J*a,d[n[J]],"*");if(h&&!p){let{handle:J,outputPreferredLocations:N,outputPreferredLocationsEncoded:ne}=h;if(u.length!==m)throw new Error(`input count from feeds (${m}) is expected to be always equal to model's input count (${u.length}).`);for(let te=0;te<m;te++){let z=e[te];await o._OrtBindInput(J,u[z],v[te])!==0&&ur(`Can't bind input[${te}] for session=${t}.`)}for(let te=0;te<y;te++){let z=n[te];(j=s[te])!=null&&j[3]?o._OrtBindOutput(J,d[z],w[te],0)!==0&&ur(`Can't bind pre-allocated output[${te}] for session=${t}.`):o._OrtBindOutput(J,d[z],0,ne[z])!==0&&ur(`Can't bind output[${te}] to ${N[te]} for session=${t}.`)}ca.set(t,[c,u,d,h,f,!0])}(V=o.jsepOnRunStart)==null||V.call(o,c),(L=o.webnnOnRunStart)==null||L.call(o,c);let K;h?K=await o._OrtRunWithBinding(c,h.handle,y,k,g):K=await o._OrtRun(c,S,T,m,$,y,k,g),K!==0&&ur("failed to call OrtRun().");let Y=[];for(let J=0;J<y;J++){let N=Number(o.getValue(k+J*a,"*"));if(N===w[J]){Y.push(s[J]);continue}let ne=o.stackSave(),te=o.stackAlloc(4*a),z=!1,O,H=0;try{o._OrtGetTensorData(N,te,te+a,te+2*a,te+3*a)!==0&&ur(`Can't access output tensor data on index ${J}.`);let re=a===4?"i32":"i64",_e=Number(o.getValue(te,re));H=o.getValue(te+a,"*");let oe=o.getValue(te+a*2,"*"),pe=Number(o.getValue(te+a*3,re)),$e=[];for(let q=0;q<pe;q++)$e.push(Number(o.getValue(oe+q*a,re)));o._OrtFree(oe)!==0&&ur("Can't free memory for tensor dims.");let Ne=$e.reduce((q,se)=>q*se,1);O=Eo(_e);let de=h==null?void 0:h.outputPreferredLocations[n[J]];if(O==="string"){if(de==="gpu-buffer"||de==="ml-tensor")throw new Error("String tensor is not supported on GPU.");let q=[];for(let se=0;se<Ne;se++){let Q=o.getValue(H+se*a,"*"),Me=o.getValue(H+(se+1)*a,"*"),Te=se===Ne-1?void 0:Me-Q;q.push(o.UTF8ToString(Q,Te))}Y.push([O,$e,q,"cpu"])}else if(de==="gpu-buffer"&&Ne>0){let q=o.jsepGetBuffer;if(!q)throw new Error('preferredLocation "gpu-buffer" is not supported without using WebGPU.');let se=q(H),Q=Sl(_e,Ne);if(Q===void 0||!vb(O))throw new Error(`Unsupported data type: ${O}`);z=!0,Y.push([O,$e,{gpuBuffer:se,download:o.jsepCreateDownloader(se,Q,O),dispose:()=>{o._OrtReleaseTensor(N)!==0&&ur("Can't release tensor.")}},"gpu-buffer"])}else if(de==="ml-tensor"&&Ne>0){let q=o.webnnEnsureTensor,se=o.webnnIsInt64Supported;if(!q||!se)throw new Error('preferredLocation "ml-tensor" is not supported without using WebNN.');if(Sl(_e,Ne)===void 0||!wb(O))throw new Error(`Unsupported data type: ${O}`);if(O==="int64"&&!se(t))throw new Error('preferredLocation "ml-tensor" for int64 output is not supported by current WebNN Context.');let Q=await q(t,H,_e,$e,!1);z=!0,Y.push([O,$e,{mlTensor:Q,download:o.webnnCreateMLTensorDownloader(H,O),dispose:()=>{o.webnnReleaseTensorId(H),o._OrtReleaseTensor(N)}},"ml-tensor"])}else{let q=yb(O),se=new q(Ne);new Uint8Array(se.buffer,se.byteOffset,se.byteLength).set(o.HEAPU8.subarray(H,H+se.byteLength)),Y.push([O,$e,se,"cpu"])}}finally{o.stackRestore(ne),O==="string"&&H&&o._free(H),z||o._OrtReleaseTensor(N),(X=o.webnnOnRunEnd)==null||X.call(o,c)}}return h&&!f&&(o._OrtClearBoundOutputs(h.handle)!==0&&ur("Can't clear bound outputs."),ca.set(t,[c,u,d,h,f,!1])),Y}finally{o.stackRestore(M),v.forEach(K=>o._OrtReleaseTensor(K)),w.forEach(K=>o._OrtReleaseTensor(K)),x.forEach(K=>o._free(K)),g!==0&&o._OrtReleaseRunOptions(g),_.forEach(K=>o._free(K))}},Nb=t=>{let e=vr(),r=ca.get(t);if(!r)throw new Error("invalid session id");let n=r[0],s=e._OrtEndProfiling(n);s===0&&ur("Can't get an profile file name."),e._OrtFree(s)},zb=t=>{let e=[];for(let r of t){let n=r[2];!Array.isArray(n)&&"buffer"in n&&e.push(n.buffer)}return e}}),ua,as,Mc,Wd,Ud,jp,Sv,Np,wl,xl,jO,vz,wz,xz,bz,Mz,Tz,Cz,Sz=Ke(()=>{Vi(),yz(),ic(),mb(),ua=()=>!!Mr.wasm.proxy&&typeof document<"u",Mc=!1,Wd=!1,Ud=!1,Np=new Map,wl=(t,e)=>{let r=Np.get(t);r?r.push(e):Np.set(t,[e])},xl=()=>{if(Mc||!Wd||Ud||!as)throw new Error("worker not ready")},jO=t=>{switch(t.data.type){case"init-wasm":Mc=!1,t.data.err?(Ud=!0,Sv[1](t.data.err)):(Wd=!0,Sv[0]()),jp&&(URL.revokeObjectURL(jp),jp=void 0);break;case"init-ep":case"copy-from":case"create":case"release":case"run":case"end-profiling":{let e=Np.get(t.data.type);t.data.err?e.shift()[1](t.data.err):e.shift()[0](t.data.out);break}}},vz=async()=>{if(!Wd){if(Mc)throw new Error("multiple calls to 'initWasm()' detected.");if(Ud)throw new Error("previous call to 'initWasm()' failed.");if(Mc=!0,ua())return new Promise((t,e)=>{as==null||as.terminate(),_3().then(([r,n])=>{try{as=n,as.onerror=i=>e(i),as.onmessage=jO,Sv=[t,e];let s={type:"init-wasm",in:Mr};!s.in.wasm.wasmPaths&&(r||ox)&&(s.in.wasm.wasmPaths={wasm:new URL("/caption-creator/assets/ort-wasm-simd-threaded.jsep-B0T3yYHD.wasm",import.meta.url).href}),as.postMessage(s),jp=r}catch(s){e(s)}},e)});try{await gb(Mr.wasm),await Ib(Mr),Wd=!0}catch(t){throw Ud=!0,t}finally{Mc=!1}}},wz=async t=>{if(ua())return xl(),new Promise((e,r)=>{wl("init-ep",[e,r]);let n={type:"init-ep",in:{epName:t,env:Mr}};as.postMessage(n)});await Fb(Mr,t)},xz=async t=>ua()?(xl(),new Promise((e,r)=>{wl("copy-from",[e,r]);let n={type:"copy-from",in:{buffer:t}};as.postMessage(n,[t.buffer])})):Sg(t),bz=async(t,e)=>{if(ua()){if(e!=null&&e.preferredOutputLocation)throw new Error('session option "preferredOutputLocation" is not supported for proxy.');return xl(),new Promise((r,n)=>{wl("create",[r,n]);let s={type:"create",in:{model:t,options:{...e}}},i=[];t instanceof Uint8Array&&i.push(t.buffer),as.postMessage(s,i)})}else return Lb(t,e)},Mz=async t=>{if(ua())return xl(),new Promise((e,r)=>{wl("release",[e,r]);let n={type:"release",in:t};as.postMessage(n)});Rb(t)},Tz=async(t,e,r,n,s,i)=>{if(ua()){if(r.some(o=>o[3]!=="cpu"))throw new Error("input tensor on GPU is not supported for proxy.");if(s.some(o=>o))throw new Error("pre-allocated output tensor is not supported for proxy.");return xl(),new Promise((o,a)=>{wl("run",[o,a]);let l=r,c={type:"run",in:{sessionId:t,inputIndices:e,inputs:l,outputIndices:n,options:i}};as.postMessage(c,zb(l))})}else return jb(t,e,r,n,s,i)},Cz=async t=>{if(ua())return xl(),new Promise((e,r)=>{wl("end-profiling",[e,r]);let n={type:"end-profiling",in:t};as.postMessage(n)});Nb(t)}}),Ev,NO,Ez,dX=Ke(()=>{Vi(),Sz(),St(),pb(),x3(),Ev=(t,e)=>{switch(t.location){case"cpu":return[t.type,t.dims,t.data,"cpu"];case"gpu-buffer":return[t.type,t.dims,{gpuBuffer:t.gpuBuffer},"gpu-buffer"];case"ml-tensor":return[t.type,t.dims,{mlTensor:t.mlTensor},"ml-tensor"];default:throw new Error(`invalid data location: ${t.location} for ${e()}`)}},NO=t=>{switch(t[3]){case"cpu":return new Ai(t[0],t[2],t[1]);case"gpu-buffer":{let e=t[0];if(!vb(e))throw new Error(`not supported data type: ${e} for deserializing GPU tensor`);let{gpuBuffer:r,download:n,dispose:s}=t[2];return Ai.fromGpuBuffer(r,{dataType:e,dims:t[1],download:n,dispose:s})}case"ml-tensor":{let e=t[0];if(!wb(e))throw new Error(`not supported data type: ${e} for deserializing MLTensor tensor`);let{mlTensor:r,download:n,dispose:s}=t[2];return Ai.fromMLTensor(r,{dataType:e,dims:t[1],download:n,dispose:s})}default:throw new Error(`invalid data location: ${t[3]}`)}},Ez=class{async fetchModelAndCopyToWasmMemory(t){return xz(await xb(t))}async loadModel(t,e){Bi();let r;typeof t=="string"?r=await this.fetchModelAndCopyToWasmMemory(t):r=t,[this.sessionId,this.inputNames,this.outputNames,this.inputMetadata,this.outputMetadata]=await bz(r,e),ni()}async dispose(){return Mz(this.sessionId)}async run(t,e,r){Bi();let n=[],s=[];Object.entries(t).forEach(d=>{let h=d[0],f=d[1],p=this.inputNames.indexOf(h);if(p===-1)throw new Error(`invalid input '${h}'`);n.push(f),s.push(p)});let i=[],o=[];Object.entries(e).forEach(d=>{let h=d[0],f=d[1],p=this.outputNames.indexOf(h);if(p===-1)throw new Error(`invalid output '${h}'`);i.push(f),o.push(p)});let a=n.map((d,h)=>Ev(d,()=>`input "${this.inputNames[s[h]]}"`)),l=i.map((d,h)=>d?Ev(d,()=>`output "${this.outputNames[o[h]]}"`):null),c=await Tz(this.sessionId,s,a,o,l,r),u={};for(let d=0;d<c.length;d++)u[this.outputNames[o[d]]]=i[d]??NO(c[d]);return ni(),u}startProfiling(){}endProfiling(){Cz(this.sessionId)}}}),Pz={};Nu(Pz,{OnnxruntimeWebAssemblyBackend:()=>xx,initializeFlags:()=>wx,wasmBackend:()=>kz});var wx,xx,kz,hX=Ke(()=>{Vi(),Sz(),dX(),wx=()=>{(typeof Mr.wasm.initTimeout!="number"||Mr.wasm.initTimeout<0)&&(Mr.wasm.initTimeout=0);let t=Mr.wasm.simd;if(typeof t!="boolean"&&t!==void 0&&t!=="fixed"&&t!=="relaxed"&&(console.warn(`Property "env.wasm.simd" is set to unknown value "${t}". Reset it to \`false\` and ignore SIMD feature checking.`),Mr.wasm.simd=!1),typeof Mr.wasm.proxy!="boolean"&&(Mr.wasm.proxy=!1),typeof Mr.wasm.trace!="boolean"&&(Mr.wasm.trace=!1),typeof Mr.wasm.numThreads!="number"||!Number.isInteger(Mr.wasm.numThreads)||Mr.wasm.numThreads<=0)if(typeof self<"u"&&!self.crossOriginIsolated)Mr.wasm.numThreads=1;else{let e=typeof navigator>"u"?JK("node:os").cpus().length:navigator.hardwareConcurrency;Mr.wasm.numThreads=Math.min(4,Math.ceil((e||1)/2))}},xx=class{async init(t){wx(),await vz(),await wz(t)}async createInferenceSessionHandler(t,e){let r=new Ez;return await r.loadModel(t,e),r}},kz=new xx});Vi();Vi();Vi();var fX="1.22.0-dev.20250409-89f8206ba4",pX=d3;{let t=(hX(),zh(Pz)).wasmBackend;Dl("webgpu",t,5),Dl("webnn",t,5),Dl("cpu",t,10),Dl("wasm",t,10)}Object.defineProperty(Mr.versions,"web",{value:fX,enumerable:!0});/**
* @license
* Copyright 2021 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*//**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 *//**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const mX=Object.freeze(Object.defineProperty({__proto__:null,get InferenceSession(){return fb},get TRACE(){return Bh},get TRACE_FUNC_BEGIN(){return Bi},get TRACE_FUNC_END(){return ni},get Tensor(){return Ai},default:pX,get env(){return Mr},get registerBackend(){return Dl}},Symbol.toStringTag,{value:"Module"}));var wo={},gX={"onnxruntime-common":t=>{t.exports=XK},"onnxruntime-web":t=>{t.exports=mX},"?2ce3":()=>{},"?7a2c":()=>{},"?a42a":()=>{},"?2b25":()=>{},"?569f":()=>{},"?3f59":()=>{},"?154a":()=>{},"./node_modules/@huggingface/jinja/dist/index.js":(t,e,r)=>{r.r(e),r.d(e,{Environment:()=>We,Interpreter:()=>Ze,Template:()=>is,parse:()=>H,tokenize:()=>d});var n=Object.freeze({Text:"Text",NumericLiteral:"NumericLiteral",BooleanLiteral:"BooleanLiteral",NullLiteral:"NullLiteral",StringLiteral:"StringLiteral",Identifier:"Identifier",Equals:"Equals",OpenParen:"OpenParen",CloseParen:"CloseParen",OpenStatement:"OpenStatement",CloseStatement:"CloseStatement",OpenExpression:"OpenExpression",CloseExpression:"CloseExpression",OpenSquareBracket:"OpenSquareBracket",CloseSquareBracket:"CloseSquareBracket",OpenCurlyBracket:"OpenCurlyBracket",CloseCurlyBracket:"CloseCurlyBracket",Comma:"Comma",Dot:"Dot",Colon:"Colon",Pipe:"Pipe",CallOperator:"CallOperator",AdditiveBinaryOperator:"AdditiveBinaryOperator",MultiplicativeBinaryOperator:"MultiplicativeBinaryOperator",ComparisonBinaryOperator:"ComparisonBinaryOperator",UnaryOperator:"UnaryOperator",Set:"Set",If:"If",For:"For",In:"In",Is:"Is",NotIn:"NotIn",Else:"Else",EndSet:"EndSet",EndIf:"EndIf",ElseIf:"ElseIf",EndFor:"EndFor",And:"And",Or:"Or",Not:"UnaryOperator",Macro:"Macro",EndMacro:"EndMacro",Break:"Break",Continue:"Continue"}),s=Object.freeze({set:n.Set,for:n.For,in:n.In,is:n.Is,if:n.If,else:n.Else,endset:n.EndSet,endif:n.EndIf,elif:n.ElseIf,endfor:n.EndFor,and:n.And,or:n.Or,not:n.Not,"not in":n.NotIn,macro:n.Macro,endmacro:n.EndMacro,break:n.Break,continue:n.Continue,true:n.BooleanLiteral,false:n.BooleanLiteral,none:n.NullLiteral,True:n.BooleanLiteral,False:n.BooleanLiteral,None:n.NullLiteral}),i=class{constructor(R,le){this.value=R,this.type=le}};function o(R){return/\w/.test(R)}function a(R){return/[0-9]/.test(R)}var l=[["{%",n.OpenStatement],["%}",n.CloseStatement],["{{",n.OpenExpression],["}}",n.CloseExpression],["(",n.OpenParen],[")",n.CloseParen],["{",n.OpenCurlyBracket],["}",n.CloseCurlyBracket],["[",n.OpenSquareBracket],["]",n.CloseSquareBracket],[",",n.Comma],[".",n.Dot],[":",n.Colon],["|",n.Pipe],["<=",n.ComparisonBinaryOperator],[">=",n.ComparisonBinaryOperator],["==",n.ComparisonBinaryOperator],["!=",n.ComparisonBinaryOperator],["<",n.ComparisonBinaryOperator],[">",n.ComparisonBinaryOperator],["+",n.AdditiveBinaryOperator],["-",n.AdditiveBinaryOperator],["*",n.MultiplicativeBinaryOperator],["/",n.MultiplicativeBinaryOperator],["%",n.MultiplicativeBinaryOperator],["=",n.Equals]],c=new Map([["n",`
`],["t","	"],["r","\r"],["b","\b"],["f","\f"],["v","\v"],["'","'"],['"','"'],["\\","\\"]]);function u(R,le={}){return R.endsWith(`
`)&&(R=R.slice(0,-1)),R=R.replace(/{#.*?#}/gs,"{##}"),le.lstrip_blocks&&(R=R.replace(/^[ \t]*({[#%])/gm,"$1")),le.trim_blocks&&(R=R.replace(/([#%]})\n/g,"$1")),R.replace(/{##}/g,"").replace(/-%}\s*/g,"%}").replace(/\s*{%-/g,"{%").replace(/-}}\s*/g,"}}").replace(/\s*{{-/g,"{{")}function d(R,le={}){var Ee,Ot,Qt;const W=[],ae=u(R,le);let we=0;const ze=Mt=>{let vt="";for(;Mt(ae[we]);){if(ae[we]==="\\"){if(++we,we>=ae.length)throw new SyntaxError("Unexpected end of input");const ft=ae[we++],rr=c.get(ft);if(rr===void 0)throw new SyntaxError(`Unexpected escaped character: ${ft}`);vt+=rr;continue}if(vt+=ae[we++],we>=ae.length)throw new SyntaxError("Unexpected end of input")}return vt};e:for(;we<ae.length;){const Mt=(Ee=W.at(-1))==null?void 0:Ee.type;if(Mt===void 0||Mt===n.CloseStatement||Mt===n.CloseExpression){let ft="";for(;we<ae.length&&!(ae[we]==="{"&&(ae[we+1]==="%"||ae[we+1]==="{"));)ft+=ae[we++];if(ft.length>0){W.push(new i(ft,n.Text));continue}}ze(ft=>/\s/.test(ft));const vt=ae[we];if(vt==="-"||vt==="+"){const ft=(Ot=W.at(-1))==null?void 0:Ot.type;if(ft===n.Text||ft===void 0)throw new SyntaxError(`Unexpected character: ${vt}`);switch(ft){case n.Identifier:case n.NumericLiteral:case n.BooleanLiteral:case n.NullLiteral:case n.StringLiteral:case n.CloseParen:case n.CloseSquareBracket:break;default:{++we;const rr=ze(a);W.push(new i(`${vt}${rr}`,rr.length>0?n.NumericLiteral:n.UnaryOperator));continue}}}for(const[ft,rr]of l)if(ae.slice(we,we+ft.length)===ft){W.push(new i(ft,rr)),we+=ft.length;continue e}if(vt==="'"||vt==='"'){++we;const ft=ze(rr=>rr!==vt);W.push(new i(ft,n.StringLiteral)),++we;continue}if(a(vt)){const ft=ze(a);W.push(new i(ft,n.NumericLiteral));continue}if(o(vt)){const ft=ze(o),rr=Object.hasOwn(s,ft)?s[ft]:n.Identifier;rr===n.In&&((Qt=W.at(-1))==null?void 0:Qt.type)===n.Not?(W.pop(),W.push(new i("not in",n.NotIn))):W.push(new i(ft,rr));continue}throw new SyntaxError(`Unexpected character: ${vt}`)}return W}var h=class{constructor(){ce(this,"type","Statement")}},f=class extends h{constructor(le){super();ce(this,"type","Program");this.body=le}},p=class extends h{constructor(le,W,ae){super();ce(this,"type","If");this.test=le,this.body=W,this.alternate=ae}},m=class extends h{constructor(le,W,ae,we){super();ce(this,"type","For");this.loopvar=le,this.iterable=W,this.body=ae,this.defaultBlock=we}},y=class extends h{constructor(){super(...arguments);ce(this,"type","Break")}},g=class extends h{constructor(){super(...arguments);ce(this,"type","Continue")}},_=class extends h{constructor(le,W,ae){super();ce(this,"type","Set");this.assignee=le,this.value=W,this.body=ae}},v=class extends h{constructor(le,W,ae){super();ce(this,"type","Macro");this.name=le,this.args=W,this.body=ae}},w=class extends h{constructor(){super(...arguments);ce(this,"type","Expression")}},x=class extends w{constructor(le,W,ae){super();ce(this,"type","MemberExpression");this.object=le,this.property=W,this.computed=ae}},M=class extends w{constructor(le,W){super();ce(this,"type","CallExpression");this.callee=le,this.args=W}},T=class extends w{constructor(le){super();ce(this,"type","Identifier");this.value=le}},S=class extends w{constructor(le){super();ce(this,"type","Literal");this.value=le}},k=class extends S{constructor(){super(...arguments);ce(this,"type","NumericLiteral")}},$=class extends S{constructor(){super(...arguments);ce(this,"type","StringLiteral")}},j=class extends S{constructor(){super(...arguments);ce(this,"type","BooleanLiteral")}},V=class extends S{constructor(){super(...arguments);ce(this,"type","NullLiteral")}},L=class extends S{constructor(){super(...arguments);ce(this,"type","ArrayLiteral")}},X=class extends S{constructor(){super(...arguments);ce(this,"type","TupleLiteral")}},K=class extends S{constructor(){super(...arguments);ce(this,"type","ObjectLiteral")}},Y=class extends w{constructor(le,W,ae){super();ce(this,"type","BinaryExpression");this.operator=le,this.left=W,this.right=ae}},J=class extends w{constructor(le,W){super();ce(this,"type","FilterExpression");this.operand=le,this.filter=W}},N=class extends w{constructor(le,W){super();ce(this,"type","SelectExpression");this.iterable=le,this.test=W}},ne=class extends w{constructor(le,W,ae){super();ce(this,"type","TestExpression");this.operand=le,this.negate=W,this.test=ae}},te=class extends w{constructor(le,W){super();ce(this,"type","UnaryExpression");this.operator=le,this.argument=W}},z=class extends w{constructor(le=void 0,W=void 0,ae=void 0){super();ce(this,"type","SliceExpression");this.start=le,this.stop=W,this.step=ae}},O=class extends w{constructor(le,W){super();ce(this,"type","KeywordArgumentExpression");this.key=le,this.value=W}};function H(R){const le=new f([]);let W=0;function ae(Be,it){const _t=R[W++];if(!_t||_t.type!==Be)throw new Error(`Parser Error: ${it}. ${_t.type} !== ${Be}.`);return _t}function we(){switch(R[W].type){case n.Text:return Ot();case n.OpenStatement:return Qt();case n.OpenExpression:return Mt();default:throw new SyntaxError(`Unexpected token type: ${R[W].type}`)}}function ze(...Be){return W+Be.length<=R.length&&Be.some((it,_t)=>it!==R[W+_t].type)}function Ee(...Be){return W+Be.length<=R.length&&Be.every((it,_t)=>it===R[W+_t].type)}function Ot(){return new $(ae(n.Text,"Expected text token").value)}function Qt(){ae(n.OpenStatement,"Expected opening statement token");let Be;switch(R[W].type){case n.Set:++W,Be=vt(),ae(n.CloseStatement,"Expected closing statement token");break;case n.If:++W,Be=ft(),ae(n.OpenStatement,"Expected {% token"),ae(n.EndIf,"Expected endif token"),ae(n.CloseStatement,"Expected %} token");break;case n.Macro:++W,Be=rr(),ae(n.OpenStatement,"Expected {% token"),ae(n.EndMacro,"Expected endmacro token"),ae(n.CloseStatement,"Expected %} token");break;case n.For:++W,Be=sn(),ae(n.OpenStatement,"Expected {% token"),ae(n.EndFor,"Expected endfor token"),ae(n.CloseStatement,"Expected %} token");break;case n.Break:++W,ae(n.CloseStatement,"Expected closing statement token"),Be=new y;break;case n.Continue:++W,ae(n.CloseStatement,"Expected closing statement token"),Be=new g;break;default:throw new SyntaxError(`Unknown statement type: ${R[W].type}`)}return Be}function Mt(){ae(n.OpenExpression,"Expected opening expression token");const Be=xr();return ae(n.CloseExpression,"Expected closing expression token"),Be}function vt(){var it,_t;const Be=xr();if(Ee(n.Equals)){++W;const nr=xr();return new _(Be,nr,[])}else{const nr=[];for(ae(n.CloseStatement,"Expected %} token");!(((it=R[W])==null?void 0:it.type)===n.OpenStatement&&((_t=R[W+1])==null?void 0:_t.type)===n.EndSet);){const Vs=we();nr.push(Vs)}return ae(n.OpenStatement,"Expected {% token"),ae(n.EndSet,"Expected endset token"),new _(Be,null,nr)}}function ft(){var nr,Vs,Ws,Gr,Us,Hr,Qr,Gs;const Be=xr();ae(n.CloseStatement,"Expected closing statement token");const it=[],_t=[];for(;!(((nr=R[W])==null?void 0:nr.type)===n.OpenStatement&&(((Vs=R[W+1])==null?void 0:Vs.type)===n.ElseIf||((Ws=R[W+1])==null?void 0:Ws.type)===n.Else||((Gr=R[W+1])==null?void 0:Gr.type)===n.EndIf));)it.push(we());if(((Us=R[W])==null?void 0:Us.type)===n.OpenStatement&&((Hr=R[W+1])==null?void 0:Hr.type)!==n.EndIf)if(++W,Ee(n.ElseIf))ae(n.ElseIf,"Expected elseif token"),_t.push(ft());else for(ae(n.Else,"Expected else token"),ae(n.CloseStatement,"Expected closing statement token");!(((Qr=R[W])==null?void 0:Qr.type)===n.OpenStatement&&((Gs=R[W+1])==null?void 0:Gs.type)===n.EndIf);)_t.push(we());return new p(Be,it,_t)}function rr(){const Be=Rn();if(Be.type!=="Identifier")throw new SyntaxError("Expected identifier following macro statement");const it=ci();ae(n.CloseStatement,"Expected closing statement token");const _t=[];for(;ze(n.OpenStatement,n.EndMacro);)_t.push(we());return new v(Be,it,_t)}function mr(Be=!1){const it=Be?Rn:xr,_t=[it()],nr=Ee(n.Comma);for(;nr&&(++W,_t.push(it()),!!Ee(n.Comma)););return nr?new X(_t):_t[0]}function sn(){const Be=mr(!0);if(!(Be instanceof T||Be instanceof X))throw new SyntaxError(`Expected identifier/tuple for the loop variable, got ${Be.type} instead`);ae(n.In,"Expected `in` keyword following loop variable");const it=xr();ae(n.CloseStatement,"Expected closing statement token");const _t=[];for(;ze(n.OpenStatement,n.EndFor)&&ze(n.OpenStatement,n.Else);)_t.push(we());const nr=[];if(Ee(n.OpenStatement,n.Else))for(++W,++W,ae(n.CloseStatement,"Expected closing statement token");ze(n.OpenStatement,n.EndFor);)nr.push(we());return new m(Be,it,_t,nr)}function xr(){return kn()}function kn(){const Be=zs();if(Ee(n.If)){++W;const it=zs();if(Ee(n.Else)){++W;const _t=zs();return new p(it,[Be],[_t])}else return new N(Be,it)}return Be}function zs(){let Be=li();for(;Ee(n.Or);){const it=R[W];++W;const _t=li();Be=new Y(it,Be,_t)}return Be}function li(){let Be=Bs();for(;Ee(n.And);){const it=R[W];++W;const _t=Bs();Be=new Y(it,Be,_t)}return Be}function Bs(){let Be;for(;Ee(n.Not);){const it=R[W];++W;const _t=Bs();Be=new te(it,_t)}return Be??Ui()}function Ui(){let Be=Xn();for(;Ee(n.ComparisonBinaryOperator)||Ee(n.In)||Ee(n.NotIn);){const it=R[W];++W;const _t=Xn();Be=new Y(it,Be,_t)}return Be}function Xn(){let Be=Xi();for(;Ee(n.AdditiveBinaryOperator);){const it=R[W];++W;const _t=Xi();Be=new Y(it,Be,_t)}return Be}function Gi(){const Be=Rr(Rn());return Ee(n.OpenParen)?xs(Be):Be}function xs(Be){let it=new M(Be,ci());return it=Rr(it),Ee(n.OpenParen)&&(it=xs(it)),it}function ci(){ae(n.OpenParen,"Expected opening parenthesis for arguments list");const Be=Hi();return ae(n.CloseParen,"Expected closing parenthesis for arguments list"),Be}function Hi(){const Be=[];for(;!Ee(n.CloseParen);){let it=xr();if(Ee(n.Equals)){if(++W,!(it instanceof T))throw new SyntaxError("Expected identifier for keyword argument");const _t=xr();it=new O(it,_t)}Be.push(it),Ee(n.Comma)&&++W}return Be}function Ki(){const Be=[];let it=!1;for(;!Ee(n.CloseSquareBracket);)Ee(n.Colon)?(Be.push(void 0),++W,it=!0):(Be.push(xr()),Ee(n.Colon)&&(++W,it=!0));if(Be.length===0)throw new SyntaxError("Expected at least one argument for member/slice expression");if(it){if(Be.length>3)throw new SyntaxError("Expected 0-3 arguments for slice expression");return new z(...Be)}return Be[0]}function Rr(Be){for(;Ee(n.Dot)||Ee(n.OpenSquareBracket);){const it=R[W];++W;let _t;const nr=it.type!==n.Dot;if(nr)_t=Ki(),ae(n.CloseSquareBracket,"Expected closing square bracket");else if(_t=Rn(),_t.type!=="Identifier")throw new SyntaxError("Expected identifier following dot operator");Be=new x(Be,_t,nr)}return Be}function Xi(){let Be=fn();for(;Ee(n.MultiplicativeBinaryOperator);){const it=R[W];++W;const _t=fn();Be=new Y(it,Be,_t)}return Be}function fn(){let Be=ui();for(;Ee(n.Is);){++W;const it=Ee(n.Not);it&&++W;let _t=Rn();if(_t instanceof j?_t=new T(_t.value.toString()):_t instanceof V&&(_t=new T("none")),!(_t instanceof T))throw new SyntaxError("Expected identifier for the test");Be=new ne(Be,it,_t)}return Be}function ui(){let Be=Gi();for(;Ee(n.Pipe);){++W;let it=Rn();if(!(it instanceof T))throw new SyntaxError("Expected identifier for the filter");Ee(n.OpenParen)&&(it=xs(it)),Be=new J(Be,it)}return Be}function Rn(){const Be=R[W];switch(Be.type){case n.NumericLiteral:return++W,new k(Number(Be.value));case n.StringLiteral:return++W,new $(Be.value);case n.BooleanLiteral:return++W,new j(Be.value.toLowerCase()==="true");case n.NullLiteral:return++W,new V(null);case n.Identifier:return++W,new T(Be.value);case n.OpenParen:{++W;const it=mr();if(R[W].type!==n.CloseParen)throw new SyntaxError(`Expected closing parenthesis, got ${R[W].type} instead`);return++W,it}case n.OpenSquareBracket:{++W;const it=[];for(;!Ee(n.CloseSquareBracket);)it.push(xr()),Ee(n.Comma)&&++W;return++W,new L(it)}case n.OpenCurlyBracket:{++W;const it=new Map;for(;!Ee(n.CloseCurlyBracket);){const _t=xr();ae(n.Colon,"Expected colon between key and value in object literal");const nr=xr();it.set(_t,nr),Ee(n.Comma)&&++W}return++W,new K(it)}default:throw new SyntaxError(`Unexpected token: ${Be.type}`)}}for(;W<R.length;)le.body.push(we());return le}function re(R,le,W=1){le===void 0&&(le=R,R=0);const ae=[];for(let we=R;we<le;we+=W)ae.push(we);return ae}function _e(R,le,W,ae=1){const we=Math.sign(ae);we>=0?(le=(le??(le=0))<0?Math.max(R.length+le,0):Math.min(le,R.length),W=(W??(W=R.length))<0?Math.max(R.length+W,0):Math.min(W,R.length)):(le=(le??(le=R.length-1))<0?Math.max(R.length+le,-1):Math.min(le,R.length-1),W=(W??(W=-1))<-1?Math.max(R.length+W,-1):Math.min(W,R.length-1));const ze=[];for(let Ee=le;we*Ee<we*W;Ee+=ae)ze.push(R[Ee]);return ze}function oe(R){return R.replace(/\b\w/g,le=>le.toUpperCase())}var pe=class extends Error{},$e=class extends Error{},Ne=class{constructor(R=void 0){ce(this,"type","RuntimeValue");ce(this,"value");ce(this,"builtins",new Map);this.value=R}__bool__(){return new se(!!this.value)}},de=class extends Ne{constructor(){super(...arguments);ce(this,"type","NumericValue")}},q=class extends Ne{constructor(){super(...arguments);ce(this,"type","StringValue");ce(this,"builtins",new Map([["upper",new Pe(()=>new q(this.value.toUpperCase()))],["lower",new Pe(()=>new q(this.value.toLowerCase()))],["strip",new Pe(()=>new q(this.value.trim()))],["title",new Pe(()=>new q(oe(this.value)))],["length",new de(this.value.length)],["rstrip",new Pe(()=>new q(this.value.trimEnd()))],["lstrip",new Pe(()=>new q(this.value.trimStart()))],["startswith",new Pe(le=>{if(le.length===0)throw new Error("startswith() requires at least one argument");const W=le[0];if(!(W instanceof q))throw new Error("startswith() argument must be a string");return new se(this.value.startsWith(W.value))})],["endswith",new Pe(le=>{if(le.length===0)throw new Error("endswith() requires at least one argument");const W=le[0];if(!(W instanceof q))throw new Error("endswith() argument must be a string");return new se(this.value.endsWith(W.value))})],["split",new Pe(le=>{const W=le[0]??new Fe;if(!(W instanceof q||W instanceof Fe))throw new Error("sep argument must be a string or null");const ae=le[1]??new de(-1);if(!(ae instanceof de))throw new Error("maxsplit argument must be a number");let we=[];if(W instanceof Fe){const ze=this.value.trimStart();for(const{0:Ee,index:Ot}of ze.matchAll(/\S+/g)){if(ae.value!==-1&&we.length>=ae.value&&Ot!==void 0){we.push(Ee+ze.slice(Ot+Ee.length));break}we.push(Ee)}}else{if(W.value==="")throw new Error("empty separator");we=this.value.split(W.value),ae.value!==-1&&we.length>ae.value&&we.push(we.splice(ae.value).join(W.value))}return new Te(we.map(ze=>new q(ze)))})]]))}},se=class extends Ne{constructor(){super(...arguments);ce(this,"type","BooleanValue")}},Q=class extends Ne{constructor(){super(...arguments);ce(this,"type","ObjectValue");ce(this,"builtins",new Map([["get",new Pe(([le,W])=>{if(!(le instanceof q))throw new Error(`Object key must be a string: got ${le.type}`);return this.value.get(le.value)??W??new Fe})],["items",new Pe(()=>new Te(Array.from(this.value.entries()).map(([le,W])=>new Te([new q(le),W]))))]]))}__bool__(){return new se(this.value.size>0)}},Me=class extends Q{constructor(){super(...arguments);ce(this,"type","KeywordArgumentsValue")}},Te=class extends Ne{constructor(){super(...arguments);ce(this,"type","ArrayValue");ce(this,"builtins",new Map([["length",new de(this.value.length)]]))}__bool__(){return new se(this.value.length>0)}},ke=class extends Te{constructor(){super(...arguments);ce(this,"type","TupleValue")}},Pe=class extends Ne{constructor(){super(...arguments);ce(this,"type","FunctionValue")}},Fe=class extends Ne{constructor(){super(...arguments);ce(this,"type","NullValue")}},Le=class extends Ne{constructor(){super(...arguments);ce(this,"type","UndefinedValue")}},We=class{constructor(R){ce(this,"variables",new Map([["namespace",new Pe(R=>{if(R.length===0)return new Q(new Map);if(R.length!==1||!(R[0]instanceof Q))throw new Error("`namespace` expects either zero arguments or a single object argument");return R[0]})]]));ce(this,"tests",new Map([["boolean",R=>R.type==="BooleanValue"],["callable",R=>R instanceof Pe],["odd",R=>{if(R.type!=="NumericValue")throw new Error(`Cannot apply test "odd" to type: ${R.type}`);return R.value%2!==0}],["even",R=>{if(R.type!=="NumericValue")throw new Error(`Cannot apply test "even" to type: ${R.type}`);return R.value%2===0}],["false",R=>R.type==="BooleanValue"&&!R.value],["true",R=>R.type==="BooleanValue"&&R.value],["none",R=>R.type==="NullValue"],["string",R=>R.type==="StringValue"],["number",R=>R.type==="NumericValue"],["integer",R=>R.type==="NumericValue"&&Number.isInteger(R.value)],["iterable",R=>R.type==="ArrayValue"||R.type==="StringValue"],["mapping",R=>R.type==="ObjectValue"],["lower",R=>{const le=R.value;return R.type==="StringValue"&&le===le.toLowerCase()}],["upper",R=>{const le=R.value;return R.type==="StringValue"&&le===le.toUpperCase()}],["none",R=>R.type==="NullValue"],["defined",R=>R.type!=="UndefinedValue"],["undefined",R=>R.type==="UndefinedValue"],["equalto",(R,le)=>R.value===le.value],["eq",(R,le)=>R.value===le.value]]));this.parent=R}set(R,le){return this.declareVariable(R,et(le))}declareVariable(R,le){if(this.variables.has(R))throw new SyntaxError(`Variable already declared: ${R}`);return this.variables.set(R,le),le}setVariable(R,le){return this.variables.set(R,le),le}resolve(R){if(this.variables.has(R))return this;if(this.parent)return this.parent.resolve(R);throw new Error(`Unknown variable: ${R}`)}lookupVariable(R){try{return this.resolve(R).variables.get(R)??new Le}catch{return new Le}}},Ze=class{constructor(R){ce(this,"global");this.global=R??new We}run(R){return this.evaluate(R,this.global)}evaluateBinaryExpression(R,le){const W=this.evaluate(R.left,le);switch(R.operator.value){case"and":return W.__bool__().value?this.evaluate(R.right,le):W;case"or":return W.__bool__().value?W:this.evaluate(R.right,le)}const ae=this.evaluate(R.right,le);switch(R.operator.value){case"==":return new se(W.value==ae.value);case"!=":return new se(W.value!=ae.value)}if(W instanceof Le||ae instanceof Le)throw new Error("Cannot perform operation on undefined values");if(W instanceof Fe||ae instanceof Fe)throw new Error("Cannot perform operation on null values");if(W instanceof de&&ae instanceof de)switch(R.operator.value){case"+":return new de(W.value+ae.value);case"-":return new de(W.value-ae.value);case"*":return new de(W.value*ae.value);case"/":return new de(W.value/ae.value);case"%":return new de(W.value%ae.value);case"<":return new se(W.value<ae.value);case">":return new se(W.value>ae.value);case">=":return new se(W.value>=ae.value);case"<=":return new se(W.value<=ae.value)}else if(W instanceof Te&&ae instanceof Te)switch(R.operator.value){case"+":return new Te(W.value.concat(ae.value))}else if(ae instanceof Te){const we=ae.value.find(ze=>ze.value===W.value)!==void 0;switch(R.operator.value){case"in":return new se(we);case"not in":return new se(!we)}}if(W instanceof q||ae instanceof q)switch(R.operator.value){case"+":return new q(W.value.toString()+ae.value.toString())}if(W instanceof q&&ae instanceof q)switch(R.operator.value){case"in":return new se(ae.value.includes(W.value));case"not in":return new se(!ae.value.includes(W.value))}if(W instanceof q&&ae instanceof Q)switch(R.operator.value){case"in":return new se(ae.value.has(W.value));case"not in":return new se(!ae.value.has(W.value))}throw new SyntaxError(`Unknown operator "${R.operator.value}" between ${W.type} and ${ae.type}`)}evaluateArguments(R,le){const W=[],ae=new Map;for(const we of R)if(we.type==="KeywordArgumentExpression"){const ze=we;ae.set(ze.key.value,this.evaluate(ze.value,le))}else{if(ae.size>0)throw new Error("Positional arguments must come before keyword arguments");W.push(this.evaluate(we,le))}return[W,ae]}evaluateFilterExpression(R,le){const W=this.evaluate(R.operand,le);if(R.filter.type==="Identifier"){const ae=R.filter;if(ae.value==="tojson")return new q(Re(W));if(W instanceof Te)switch(ae.value){case"list":return W;case"first":return W.value[0];case"last":return W.value[W.value.length-1];case"length":return new de(W.value.length);case"reverse":return new Te(W.value.reverse());case"sort":return new Te(W.value.sort((we,ze)=>{if(we.type!==ze.type)throw new Error(`Cannot compare different types: ${we.type} and ${ze.type}`);switch(we.type){case"NumericValue":return we.value-ze.value;case"StringValue":return we.value.localeCompare(ze.value);default:throw new Error(`Cannot compare type: ${we.type}`)}}));case"join":return new q(W.value.map(we=>we.value).join(""));case"string":return new q(Re(W));default:throw new Error(`Unknown ArrayValue filter: ${ae.value}`)}else if(W instanceof q)switch(ae.value){case"length":return new de(W.value.length);case"upper":return new q(W.value.toUpperCase());case"lower":return new q(W.value.toLowerCase());case"title":return new q(oe(W.value));case"capitalize":return new q(W.value.charAt(0).toUpperCase()+W.value.slice(1));case"trim":return new q(W.value.trim());case"indent":return new q(W.value.split(`
`).map((we,ze)=>ze===0||we.length===0?we:"    "+we).join(`
`));case"join":case"string":return W;default:throw new Error(`Unknown StringValue filter: ${ae.value}`)}else if(W instanceof de)switch(ae.value){case"abs":return new de(Math.abs(W.value));default:throw new Error(`Unknown NumericValue filter: ${ae.value}`)}else if(W instanceof Q)switch(ae.value){case"items":return new Te(Array.from(W.value.entries()).map(([we,ze])=>new Te([new q(we),ze])));case"length":return new de(W.value.size);default:throw new Error(`Unknown ObjectValue filter: ${ae.value}`)}throw new Error(`Cannot apply filter "${ae.value}" to type: ${W.type}`)}else if(R.filter.type==="CallExpression"){const ae=R.filter;if(ae.callee.type!=="Identifier")throw new Error(`Unknown filter: ${ae.callee.type}`);const we=ae.callee.value;if(we==="tojson"){const[,ze]=this.evaluateArguments(ae.args,le),Ee=ze.get("indent")??new Fe;if(!(Ee instanceof de||Ee instanceof Fe))throw new Error("If set, indent must be a number");return new q(Re(W,Ee.value))}else if(we==="join"){let ze;if(W instanceof q)ze=Array.from(W.value);else if(W instanceof Te)ze=W.value.map(Mt=>Mt.value);else throw new Error(`Cannot apply filter "${we}" to type: ${W.type}`);const[Ee,Ot]=this.evaluateArguments(ae.args,le),Qt=Ee.at(0)??Ot.get("separator")??new q("");if(!(Qt instanceof q))throw new Error("separator must be a string");return new q(ze.join(Qt.value))}if(W instanceof Te){switch(we){case"selectattr":case"rejectattr":{const ze=we==="selectattr";if(W.value.some(ft=>!(ft instanceof Q)))throw new Error(`\`${we}\` can only be applied to array of objects`);if(ae.args.some(ft=>ft.type!=="StringLiteral"))throw new Error(`arguments of \`${we}\` must be strings`);const[Ee,Ot,Qt]=ae.args.map(ft=>this.evaluate(ft,le));let Mt;if(Ot){const ft=le.tests.get(Ot.value);if(!ft)throw new Error(`Unknown test: ${Ot.value}`);Mt=ft}else Mt=(...ft)=>ft[0].__bool__().value;const vt=W.value.filter(ft=>{const rr=ft.value.get(Ee.value),mr=rr?Mt(rr,Qt):!1;return ze?mr:!mr});return new Te(vt)}case"map":{const[,ze]=this.evaluateArguments(ae.args,le);if(ze.has("attribute")){const Ee=ze.get("attribute");if(!(Ee instanceof q))throw new Error("attribute must be a string");const Ot=ze.get("default"),Qt=W.value.map(Mt=>{if(!(Mt instanceof Q))throw new Error("items in map must be an object");return Mt.value.get(Ee.value)??Ot??new Le});return new Te(Qt)}else throw new Error("`map` expressions without `attribute` set are not currently supported.")}}throw new Error(`Unknown ArrayValue filter: ${we}`)}else if(W instanceof q){switch(we){case"indent":{const[ze,Ee]=this.evaluateArguments(ae.args,le),Ot=ze.at(0)??Ee.get("width")??new de(4);if(!(Ot instanceof de))throw new Error("width must be a number");const Qt=ze.at(1)??Ee.get("first")??new se(!1),Mt=ze.at(2)??Ee.get("blank")??new se(!1),vt=W.value.split(`
`),ft=" ".repeat(Ot.value),rr=vt.map((mr,sn)=>!Qt.value&&sn===0||!Mt.value&&mr.length===0?mr:ft+mr);return new q(rr.join(`
`))}}throw new Error(`Unknown StringValue filter: ${we}`)}else throw new Error(`Cannot apply filter "${we}" to type: ${W.type}`)}throw new Error(`Unknown filter: ${R.filter.type}`)}evaluateTestExpression(R,le){const W=this.evaluate(R.operand,le),ae=le.tests.get(R.test.value);if(!ae)throw new Error(`Unknown test: ${R.test.value}`);const we=ae(W);return new se(R.negate?!we:we)}evaluateUnaryExpression(R,le){const W=this.evaluate(R.argument,le);switch(R.operator.value){case"not":return new se(!W.value);default:throw new SyntaxError(`Unknown operator: ${R.operator.value}`)}}evalProgram(R,le){return this.evaluateBlock(R.body,le)}evaluateBlock(R,le){let W="";for(const ae of R){const we=this.evaluate(ae,le);we.type!=="NullValue"&&we.type!=="UndefinedValue"&&(W+=we.value)}return new q(W)}evaluateIdentifier(R,le){return le.lookupVariable(R.value)}evaluateCallExpression(R,le){const[W,ae]=this.evaluateArguments(R.args,le);ae.size>0&&W.push(new Me(ae));const we=this.evaluate(R.callee,le);if(we.type!=="FunctionValue")throw new Error(`Cannot call something that is not a function: got ${we.type}`);return we.value(W,le)}evaluateSliceExpression(R,le,W){if(!(R instanceof Te||R instanceof q))throw new Error("Slice object must be an array or string");const ae=this.evaluate(le.start,W),we=this.evaluate(le.stop,W),ze=this.evaluate(le.step,W);if(!(ae instanceof de||ae instanceof Le))throw new Error("Slice start must be numeric or undefined");if(!(we instanceof de||we instanceof Le))throw new Error("Slice stop must be numeric or undefined");if(!(ze instanceof de||ze instanceof Le))throw new Error("Slice step must be numeric or undefined");return R instanceof Te?new Te(_e(R.value,ae.value,we.value,ze.value)):new q(_e(Array.from(R.value),ae.value,we.value,ze.value).join(""))}evaluateMemberExpression(R,le){const W=this.evaluate(R.object,le);let ae;if(R.computed){if(R.property.type==="SliceExpression")return this.evaluateSliceExpression(W,R.property,le);ae=this.evaluate(R.property,le)}else ae=new q(R.property.value);let we;if(W instanceof Q){if(!(ae instanceof q))throw new Error(`Cannot access property with non-string: got ${ae.type}`);we=W.value.get(ae.value)??W.builtins.get(ae.value)}else if(W instanceof Te||W instanceof q)if(ae instanceof de)we=W.value.at(ae.value),W instanceof q&&(we=new q(W.value.at(ae.value)));else if(ae instanceof q)we=W.builtins.get(ae.value);else throw new Error(`Cannot access property with non-string/non-number: got ${ae.type}`);else{if(!(ae instanceof q))throw new Error(`Cannot access property with non-string: got ${ae.type}`);we=W.builtins.get(ae.value)}return we instanceof Ne?we:new Le}evaluateSet(R,le){const W=R.value?this.evaluate(R.value,le):this.evaluateBlock(R.body,le);if(R.assignee.type==="Identifier"){const ae=R.assignee.value;le.setVariable(ae,W)}else if(R.assignee.type==="MemberExpression"){const ae=R.assignee,we=this.evaluate(ae.object,le);if(!(we instanceof Q))throw new Error("Cannot assign to member of non-object");if(ae.property.type!=="Identifier")throw new Error("Cannot assign to member with non-identifier property");we.value.set(ae.property.value,W)}else throw new Error(`Invalid LHS inside assignment expression: ${JSON.stringify(R.assignee)}`);return new Fe}evaluateIf(R,le){const W=this.evaluate(R.test,le);return this.evaluateBlock(W.__bool__().value?R.body:R.alternate,le)}evaluateFor(R,le){const W=new We(le);let ae,we;if(R.iterable.type==="SelectExpression"){const Mt=R.iterable;we=this.evaluate(Mt.iterable,W),ae=Mt.test}else we=this.evaluate(R.iterable,W);if(!(we instanceof Te))throw new Error(`Expected iterable type in for loop: got ${we.type}`);const ze=[],Ee=[];for(let Mt=0;Mt<we.value.length;++Mt){const vt=new We(W),ft=we.value[Mt];let rr;if(R.loopvar.type==="Identifier")rr=mr=>mr.setVariable(R.loopvar.value,ft);else if(R.loopvar.type==="TupleLiteral"){const mr=R.loopvar;if(ft.type!=="ArrayValue")throw new Error(`Cannot unpack non-iterable type: ${ft.type}`);const sn=ft;if(mr.value.length!==sn.value.length)throw new Error(`Too ${mr.value.length>sn.value.length?"few":"many"} items to unpack`);rr=xr=>{for(let kn=0;kn<mr.value.length;++kn){if(mr.value[kn].type!=="Identifier")throw new Error(`Cannot unpack non-identifier type: ${mr.value[kn].type}`);xr.setVariable(mr.value[kn].value,sn.value[kn])}}}else throw new Error(`Invalid loop variable(s): ${R.loopvar.type}`);ae&&(rr(vt),!this.evaluate(ae,vt).__bool__().value)||(ze.push(ft),Ee.push(rr))}let Ot="",Qt=!0;for(let Mt=0;Mt<ze.length;++Mt){const vt=new Map([["index",new de(Mt+1)],["index0",new de(Mt)],["revindex",new de(ze.length-Mt)],["revindex0",new de(ze.length-Mt-1)],["first",new se(Mt===0)],["last",new se(Mt===ze.length-1)],["length",new de(ze.length)],["previtem",Mt>0?ze[Mt-1]:new Le],["nextitem",Mt<ze.length-1?ze[Mt+1]:new Le]]);W.setVariable("loop",new Q(vt)),Ee[Mt](W);try{const ft=this.evaluateBlock(R.body,W);Ot+=ft.value}catch(ft){if(ft instanceof $e)continue;if(ft instanceof pe)break;throw ft}Qt=!1}if(Qt){const Mt=this.evaluateBlock(R.defaultBlock,W);Ot+=Mt.value}return new q(Ot)}evaluateMacro(R,le){return le.setVariable(R.name.value,new Pe((W,ae)=>{var Ee;const we=new We(ae);W=W.slice();let ze;((Ee=W.at(-1))==null?void 0:Ee.type)==="KeywordArgumentsValue"&&(ze=W.pop());for(let Ot=0;Ot<R.args.length;++Ot){const Qt=R.args[Ot],Mt=W[Ot];if(Qt.type==="Identifier"){const vt=Qt;if(!Mt)throw new Error(`Missing positional argument: ${vt.value}`);we.setVariable(vt.value,Mt)}else if(Qt.type==="KeywordArgumentExpression"){const vt=Qt,ft=Mt??(ze==null?void 0:ze.value.get(vt.key.value))??this.evaluate(vt.value,we);we.setVariable(vt.key.value,ft)}else throw new Error(`Unknown argument type: ${Qt.type}`)}return this.evaluateBlock(R.body,we)})),new Fe}evaluate(R,le){if(R===void 0)return new Le;switch(R.type){case"Program":return this.evalProgram(R,le);case"Set":return this.evaluateSet(R,le);case"If":return this.evaluateIf(R,le);case"For":return this.evaluateFor(R,le);case"Macro":return this.evaluateMacro(R,le);case"Break":throw new pe;case"Continue":throw new $e;case"NumericLiteral":return new de(Number(R.value));case"StringLiteral":return new q(R.value);case"BooleanLiteral":return new se(R.value);case"NullLiteral":return new Fe(R.value);case"ArrayLiteral":return new Te(R.value.map(W=>this.evaluate(W,le)));case"TupleLiteral":return new ke(R.value.map(W=>this.evaluate(W,le)));case"ObjectLiteral":{const W=new Map;for(const[ae,we]of R.value){const ze=this.evaluate(ae,le);if(!(ze instanceof q))throw new Error(`Object keys must be strings: got ${ze.type}`);W.set(ze.value,this.evaluate(we,le))}return new Q(W)}case"Identifier":return this.evaluateIdentifier(R,le);case"CallExpression":return this.evaluateCallExpression(R,le);case"MemberExpression":return this.evaluateMemberExpression(R,le);case"UnaryExpression":return this.evaluateUnaryExpression(R,le);case"BinaryExpression":return this.evaluateBinaryExpression(R,le);case"FilterExpression":return this.evaluateFilterExpression(R,le);case"TestExpression":return this.evaluateTestExpression(R,le);default:throw new SyntaxError(`Unknown node type: ${R.type}`)}}};function et(R){switch(typeof R){case"number":return new de(R);case"string":return new q(R);case"boolean":return new se(R);case"undefined":return new Le;case"object":return R===null?new Fe:Array.isArray(R)?new Te(R.map(et)):new Q(new Map(Object.entries(R).map(([le,W])=>[le,et(W)])));case"function":return new Pe((le,W)=>{const ae=R(...le.map(we=>we.value))??null;return et(ae)});default:throw new Error(`Cannot convert to runtime value: ${R}`)}}function Re(R,le,W){const ae=W??0;switch(R.type){case"NullValue":case"UndefinedValue":return"null";case"NumericValue":case"StringValue":case"BooleanValue":return JSON.stringify(R.value);case"ArrayValue":case"ObjectValue":{const we=le?" ".repeat(le):"",ze=`
`+we.repeat(ae),Ee=ze+we;if(R.type==="ArrayValue"){const Ot=R.value.map(Qt=>Re(Qt,le,ae+1));return le?`[${Ee}${Ot.join(`,${Ee}`)}${ze}]`:`[${Ot.join(", ")}]`}else{const Ot=Array.from(R.value.entries()).map(([Qt,Mt])=>{const vt=`"${Qt}": ${Re(Mt,le,ae+1)}`;return le?`${Ee}${vt}`:vt});return le?`{${Ot.join(",")}${ze}}`:`{${Ot.join(", ")}}`}}default:throw new Error(`Cannot convert to JSON: ${R.type}`)}}var qe=`
`,at="{%- ",ct=" -%}",lt={MultiplicativeBinaryOperator:2,AdditiveBinaryOperator:1,ComparisonBinaryOperator:0};function Qe(R,le="	"){const W=typeof le=="number"?" ".repeat(le):le;return yt(R.body,0,W).replace(/\n$/,"")}function je(...R){return at+R.join(" ")+ct}function yt(R,le,W){return R.map(ae=>Rt(ae,le,W)).join(qe)}function Rt(R,le,W){const ae=W.repeat(le);switch(R.type){case"Program":return yt(R.body,le,W);case"If":return Yt(R,le,W);case"For":return Xt(R,le,W);case"Set":return Ur(R,le,W);case"Macro":return wr(R,le,W);case"Break":return ae+je("break");case"Continue":return ae+je("continue");default:return ae+"{{- "+Ct(R)+" -}}"}}function Yt(R,le,W){const ae=W.repeat(le),we=[];let ze=R;for(;ze&&(we.push({test:ze.test,body:ze.body}),ze.alternate.length===1&&ze.alternate[0].type==="If");)ze=ze.alternate[0];let Ee=ae+je("if",Ct(we[0].test))+qe+yt(we[0].body,le+1,W);for(let Ot=1;Ot<we.length;Ot++)Ee+=qe+ae+je("elif",Ct(we[Ot].test))+qe+yt(we[Ot].body,le+1,W);return ze&&ze.alternate.length>0&&(Ee+=qe+ae+je("else")+qe+yt(ze.alternate,le+1,W)),Ee+=qe+ae+je("endif"),Ee}function Xt(R,le,W){const ae=W.repeat(le);let we="";if(R.iterable.type==="SelectExpression"){const Ee=R.iterable;we=`${Ct(Ee.iterable)} if ${Ct(Ee.test)}`}else we=Ct(R.iterable);let ze=ae+je("for",Ct(R.loopvar),"in",we)+qe+yt(R.body,le+1,W);return R.defaultBlock.length>0&&(ze+=qe+ae+je("else")+qe+yt(R.defaultBlock,le+1,W)),ze+=qe+ae+je("endfor"),ze}function Ur(R,le,W){const ae=W.repeat(le),we=Ct(R.assignee),ze=R.value?Ct(R.value):"",Ee=ae+je("set",`${we}${R.value?" = "+ze:""}`);return R.body.length===0?Ee:Ee+qe+yt(R.body,le+1,W)+qe+ae+je("endset")}function wr(R,le,W){const ae=W.repeat(le),we=R.args.map(Ct).join(", ");return ae+je("macro",`${R.name.value}(${we})`)+qe+yt(R.body,le+1,W)+qe+ae+je("endmacro")}function Ct(R,le=-1){switch(R.type){case"Identifier":return R.value;case"NullLiteral":return"none";case"NumericLiteral":case"BooleanLiteral":return`${R.value}`;case"StringLiteral":return JSON.stringify(R.value);case"BinaryExpression":{const W=R,ae=lt[W.operator.type]??0,we=Ct(W.left,ae),ze=Ct(W.right,ae+1),Ee=`${we} ${W.operator.value} ${ze}`;return ae<le?`(${Ee})`:Ee}case"UnaryExpression":{const W=R;return W.operator.value+(W.operator.value==="not"?" ":"")+Ct(W.argument,1/0)}case"LogicalNegationExpression":return`not ${Ct(R.argument,1/0)}`;case"CallExpression":{const W=R,ae=W.args.map(we=>Ct(we,-1)).join(", ");return`${Ct(W.callee,-1)}(${ae})`}case"MemberExpression":{const W=R;let ae=Ct(W.object,-1);W.object.type!=="Identifier"&&(ae=`(${ae})`);let we=Ct(W.property,-1);return!W.computed&&W.property.type!=="Identifier"&&(we=`(${we})`),W.computed?`${ae}[${we}]`:`${ae}.${we}`}case"FilterExpression":{const W=R,ae=Ct(W.operand,1/0);return W.filter.type==="CallExpression"?`${ae} | ${Ct(W.filter,-1)}`:`${ae} | ${W.filter.value}`}case"SelectExpression":{const W=R;return`${Ct(W.iterable,-1)} | select(${Ct(W.test,-1)})`}case"TestExpression":{const W=R;return`${Ct(W.operand,-1)} is${W.negate?" not":""} ${W.test.value}`}case"ArrayLiteral":case"TupleLiteral":{const W=R.value.map(we=>Ct(we,-1)),ae=R.type==="ArrayLiteral"?"[]":"()";return`${ae[0]}${W.join(", ")}${ae[1]}`}case"ObjectLiteral":return`{ ${Array.from(R.value.entries()).map(([ae,we])=>`${Ct(ae,-1)}: ${Ct(we,-1)}`).join(", ")} }`;case"SliceExpression":{const W=R,ae=W.start?Ct(W.start,-1):"",we=W.stop?Ct(W.stop,-1):"",ze=W.step?`:${Ct(W.step,-1)}`:"";return`${ae}:${we}${ze}`}case"KeywordArgumentExpression":{const W=R;return`${W.key.value}=${Ct(W.value,-1)}`}case"If":{const W=R,ae=Ct(W.test,-1),we=Ct(W.body[0],0),ze=Ct(W.alternate[0],-1);return`${we} if ${ae} else ${ze}`}default:throw new Error(`Unknown expression type: ${R.type}`)}}var is=class{constructor(R){ce(this,"parsed");const le=d(R,{lstrip_blocks:!0,trim_blocks:!0});this.parsed=H(le)}render(R){const le=new We;if(le.set("false",!1),le.set("true",!0),le.set("raise_exception",we=>{throw new Error(we)}),le.set("range",re),R)for(const[we,ze]of Object.entries(R))le.set(we,ze);return new Ze(le).run(this.parsed).value}format(R){return Qe(this.parsed,(R==null?void 0:R.indent)||"	")}}},"./src/backends/onnx.js":(t,e,r)=>{var n;r.r(e),r.d(e,{Tensor:()=>a.Tensor,createInferenceSession:()=>y,deviceToExecutionProviders:()=>p,isONNXProxy:()=>v,isONNXTensor:()=>g});var s=r("./src/env.js"),i=r("?2ce3"),o=r("onnxruntime-web"),a=r("onnxruntime-common");const l=Object.freeze({auto:null,gpu:null,cpu:"cpu",wasm:"wasm",webgpu:"webgpu",cuda:"cuda",dml:"dml",webnn:{name:"webnn",deviceType:"cpu"},"webnn-npu":{name:"webnn",deviceType:"npu"},"webnn-gpu":{name:"webnn",deviceType:"gpu"},"webnn-cpu":{name:"webnn",deviceType:"cpu"}}),c=[];let u,d;const h=Symbol.for("onnxruntime");if(h in globalThis)d=globalThis[h];else if(s.apis.IS_NODE_ENV){switch(d=i??(n||(n=r.t(i,2))),process.platform){case"win32":c.push("dml");break;case"linux":process.arch==="x64"&&c.push("cuda");break}c.push("cpu"),u=["cpu"]}else d=o,s.apis.IS_WEBNN_AVAILABLE&&c.push("webnn-npu","webnn-gpu","webnn-cpu","webnn"),s.apis.IS_WEBGPU_AVAILABLE&&c.push("webgpu"),c.push("wasm"),u=["wasm"];const f=d.InferenceSession;function p(w=null){if(!w)return u;switch(w){case"auto":return c;case"gpu":return c.filter(x=>["webgpu","cuda","dml","webnn-gpu"].includes(x))}if(c.includes(w))return[l[w]??w];throw new Error(`Unsupported device: "${w}". Should be one of: ${c.join(", ")}.`)}let m=null;async function y(w,x,M){m&&await m;const T=f.create(w,x);m??(m=T);const S=await T;return S.config=M,S}function g(w){return w instanceof d.Tensor}const _=d==null?void 0:d.env;_!=null&&_.wasm&&(!(typeof ServiceWorkerGlobalScope<"u"&&self instanceof ServiceWorkerGlobalScope)&&!_.wasm.wasmPaths&&(_.wasm.wasmPaths=`https://cdn.jsdelivr.net/npm/@huggingface/transformers@${s.env.version}/dist/`),_.wasm.proxy=!1),_!=null&&_.webgpu&&(_.webgpu.powerPreference="high-performance");function v(){var w;return(w=_==null?void 0:_.wasm)==null?void 0:w.proxy}s.env.backends.onnx=_},"./src/base/feature_extraction_utils.js":(t,e,r)=>{r.r(e),r.d(e,{FeatureExtractor:()=>o,validate_audio_inputs:()=>a});var n=r("./src/utils/constants.js"),s=r("./src/utils/generic.js"),i=r("./src/utils/hub.js");class o extends s.Callable{constructor(c){super(),this.config=c}static async from_pretrained(c,u){const d=await(0,i.getModelJSON)(c,n.FEATURE_EXTRACTOR_NAME,!0,u);return new this(d)}}function a(l,c){var u;if(!(l instanceof Float32Array||l instanceof Float64Array))throw new Error(`${c} expects input to be a Float32Array or a Float64Array, but got ${((u=l==null?void 0:l.constructor)==null?void 0:u.name)??typeof l} instead. If using the feature extractor directly, remember to use \`read_audio(url, sampling_rate)\` to obtain the raw audio data of the file/url.`)}},"./src/base/image_processors_utils.js":(t,e,r)=>{r.r(e),r.d(e,{ImageProcessor:()=>w,center_to_corners_format:()=>d,post_process_instance_segmentation:()=>v,post_process_object_detection:()=>h,post_process_panoptic_segmentation:()=>_,post_process_semantic_segmentation:()=>f});var n=r("./src/utils/generic.js"),s=r("./src/utils/tensor.js"),i=r("./src/utils/maths.js");r("./src/utils/image.js");var o=r("./src/utils/core.js"),a=r("./src/utils/hub.js"),l=r("./src/utils/constants.js");function c(x,M,T=0,S=null){const k=x/M;let $=(0,i.bankers_round)(k)*M;return S!==null&&$>S&&($=Math.floor(k)*M),$<T&&($=Math.ceil(k)*M),$}function u([x,M],T){return[Math.max(Math.floor(x/T),1)*T,Math.max(Math.floor(M/T),1)*T]}function d([x,M,T,S]){return[x-T/2,M-S/2,x+T/2,M+S/2]}function h(x,M=.5,T=null,S=!1){const k=x.logits,$=x.pred_boxes,[j,V,L]=k.dims;if(T!==null&&T.length!==j)throw Error("Make sure that you pass in as many target sizes as the batch dimension of the logits");let X=[];for(let K=0;K<j;++K){let Y=T!==null?T[K]:null,J={boxes:[],classes:[],scores:[]},N=k[K],ne=$[K];for(let te=0;te<V;++te){let z=N[te],O=[],H;if(S){H=z.sigmoid().data;for(let re=0;re<H.length;++re)H[re]>M&&O.push(re)}else{let re=(0,i.max)(z.data)[1];if(re===L-1||(H=(0,i.softmax)(z.data),H[re]<M))continue;O.push(re)}for(const re of O){let _e=ne[te].data;_e=d(_e),Y!==null&&(_e=_e.map((oe,pe)=>oe*Y[(pe+1)%2])),J.boxes.push(_e),J.classes.push(re),J.scores.push(H[re])}}X.push(J)}return X}function f(x,M=null){const T=x.logits,S=T.dims[0];if(M!==null&&M.length!==S)throw Error("Make sure that you pass in as many target sizes as the batch dimension of the logits");const k=[];for(let $=0;$<S;++$){const j=M!==null?M[$]:null;let V=T[$];j!==null&&(V=(0,s.interpolate)(V,j,"bilinear",!1));const[L,X]=j??V.dims.slice(-2),K=new s.Tensor("int32",new Int32Array(L*X),[L,X]),Y=V[0].data,J=K.data;for(let te=1;te<V.dims[0];++te){const z=V[te].data;for(let O=0;O<z.length;++O)z[O]>Y[O]&&(Y[O]=z[O],J[O]=te)}const N=new Array(V.dims[0]);for(let te=0;te<J.length;++te){const z=J[te];N[z]=z}const ne=N.filter(te=>te!==void 0);k.push({segmentation:K,labels:ne})}return k}function p(x,M,T,S){const k=[],$=[],j=[];for(let V=0;V<x.dims[0];++V){const L=x[V],X=M[V],K=(0,i.max)(L.data)[1];if(K===S)continue;const J=(0,i.softmax)(L.data)[K];J>T&&(k.push(X),$.push(J),j.push(K))}return[k,$,j]}function m(x,M,T,S=.5,k=.8){const $=[];let j=0,V=0;const L=M[T].data;for(let K=0;K<x.length;++K)x[K]===T&&($.push(K),++j),L[K]>=S&&++V;let X=j>0&&V>0;return X&&(X=j/V>k),[X,$]}function y(x,M,T,S,k,$=null,j=null){const[V,L]=j??x[0].dims,X=new s.Tensor("int32",new Int32Array(V*L),[V,L]),K=[];if(j!==null)for(let te=0;te<x.length;++te)x[te]=(0,s.interpolate)(x[te],j,"bilinear",!1);const Y=new Int32Array(x[0].data.length),J=new Float32Array(x[0].data.length);for(let te=0;te<x.length;++te){let z=M[te];const O=x[te].data;for(let H=0;H<O.length;++H)O[H]*=z,O[H]>J[H]&&(Y[H]=te,J[H]=O[H])}let N=0;const ne=X.data;for(let te=0;te<T.length;++te){const z=T[te],[O,H]=m(Y,x,te,S,k);if(O){++N;for(const re of H)ne[re]=N;K.push({id:N,label_id:z,score:M[te]})}}return[X,K]}function g(x,M,T=28,S=56*56,k=14*14*4*1280){if(x<T||M<T)throw new Error(`height:${x} or width:${M} must be larger than factor:${T}`);if(Math.max(x,M)/Math.min(x,M)>200)throw new Error(`absolute aspect ratio must be smaller than 200, got ${Math.max(x,M)/Math.min(x,M)}`);let $=Math.round(x/T)*T,j=Math.round(M/T)*T;if($*j>k){const V=Math.sqrt(x*M/k);$=Math.floor(x/V/T)*T,j=Math.floor(M/V/T)*T}else if($*j<S){const V=Math.sqrt(S/(x*M));$=Math.ceil(x*V/T)*T,j=Math.ceil(M*V/T)*T}return[$,j]}function _(x,M=.5,T=.5,S=.8,k=null,$=null){k===null&&(console.warn("`label_ids_to_fuse` unset. No instance will be fused."),k=new Set);const j=x.class_queries_logits??x.logits,L=(x.masks_queries_logits??x.pred_masks).sigmoid();let[X,K,Y]=j.dims;if(Y-=1,$!==null&&$.length!==X)throw Error("Make sure that you pass in as many target sizes as the batch dimension of the logits");let J=[];for(let N=0;N<X;++N){let ne=$!==null?$[N]:null,te=j[N],z=L[N],[O,H,re]=p(te,z,M,Y);if(re.length===0){let[pe,$e]=ne??z.dims.slice(-2),Ne=new s.Tensor("int32",new Int32Array(pe*$e).fill(-1),[pe,$e]);J.push({segmentation:Ne,segments_info:[]});continue}let[_e,oe]=y(O,H,re,T,S,k,ne);J.push({segmentation:_e,segments_info:oe})}return J}function v(x,M=.5,T=null){throw new Error("`post_process_instance_segmentation` is not yet implemented.")}class w extends n.Callable{constructor(M){super(),this.image_mean=M.image_mean??M.mean,this.image_std=M.image_std??M.std,this.resample=M.resample??2,this.do_rescale=M.do_rescale??!0,this.rescale_factor=M.rescale_factor??1/255,this.do_normalize=M.do_normalize,this.do_thumbnail=M.do_thumbnail,this.size=M.size??M.image_size,this.do_resize=M.do_resize??this.size!==void 0,this.size_divisibility=M.size_divisibility??M.size_divisor,this.do_center_crop=M.do_center_crop,this.crop_size=M.crop_size,this.do_convert_rgb=M.do_convert_rgb??!0,this.do_crop_margin=M.do_crop_margin,this.pad_size=M.pad_size,this.do_pad=M.do_pad,this.min_pixels=M.min_pixels,this.max_pixels=M.max_pixels,this.do_pad&&!this.pad_size&&this.size&&this.size.width!==void 0&&this.size.height!==void 0&&(this.pad_size=this.size),this.do_flip_channel_order=M.do_flip_channel_order??!1,this.config=M}async thumbnail(M,T,S=2){const k=M.height,$=M.width,j=T.height,V=T.width;let L=Math.min(k,j),X=Math.min($,V);return L===k&&X===$?M:(k>$?X=Math.floor($*L/k):$>k&&(L=Math.floor(k*X/$)),await M.resize(X,L,{resample:S}))}async crop_margin(M,T=200){const S=M.clone().grayscale(),k=(0,i.min)(S.data)[0],j=(0,i.max)(S.data)[0]-k;if(j===0)return M;const V=T/255;let L=S.width,X=S.height,K=0,Y=0;const J=S.data;for(let N=0;N<S.height;++N){const ne=N*S.width;for(let te=0;te<S.width;++te)(J[ne+te]-k)/j<V&&(L=Math.min(L,te),X=Math.min(X,N),K=Math.max(K,te),Y=Math.max(Y,N))}return M=await M.crop([L,X,K,Y]),M}pad_image(M,T,S,{mode:k="constant",center:$=!1,constant_values:j=0}={}){const[V,L,X]=T;let K,Y;if(typeof S=="number"?(K=S,Y=S):S==="square"?K=Y=Math.max(V,L):(K=S.width,Y=S.height),K!==L||Y!==V){const J=new Float32Array(K*Y*X);if(Array.isArray(j))for(let te=0;te<J.length;++te)J[te]=j[te%X];else j!==0&&J.fill(j);const[N,ne]=$?[Math.floor((K-L)/2),Math.floor((Y-V)/2)]:[0,0];for(let te=0;te<V;++te){const z=(te+ne)*K,O=te*L;for(let H=0;H<L;++H){const re=(z+H+N)*X,_e=(O+H)*X;for(let oe=0;oe<X;++oe)J[re+oe]=M[_e+oe]}}if(k==="symmetric"){if($)throw new Error("`center` padding is not supported when `mode` is set to `symmetric`.");const te=V-1,z=L-1;for(let O=0;O<Y;++O){const H=O*K,re=(0,o.calculateReflectOffset)(O,te)*L;for(let _e=0;_e<K;++_e){if(O<V&&_e<L)continue;const oe=(H+_e)*X,pe=(re+(0,o.calculateReflectOffset)(_e,z))*X;for(let $e=0;$e<X;++$e)J[oe+$e]=M[pe+$e]}}}M=J,T=[Y,K,X]}return[M,T]}rescale(M){for(let T=0;T<M.length;++T)M[T]=this.rescale_factor*M[T]}get_resize_output_image_size(M,T){const[S,k]=M.size;let $,j;if(this.do_thumbnail){const{height:V,width:L}=T;$=Math.min(V,L)}else Number.isInteger(T)?($=T,j=this.config.max_size??$):T!==void 0&&($=T.shortest_edge,j=T.longest_edge);if($!==void 0||j!==void 0){const V=$===void 0?1:Math.max($/S,$/k),L=S*V,X=k*V,K=j===void 0?1:Math.min(j/L,j/X);let Y=Math.floor(Number((L*K).toFixed(2))),J=Math.floor(Number((X*K).toFixed(2)));return this.size_divisibility!==void 0&&([Y,J]=u([Y,J],this.size_divisibility)),[Y,J]}else if(T!==void 0&&T.width!==void 0&&T.height!==void 0){let V=T.width,L=T.height;if(this.config.keep_aspect_ratio&&this.config.ensure_multiple_of){let X=L/k,K=V/S;Math.abs(1-K)<Math.abs(1-X)?X=K:K=X,L=c(X*k,this.config.ensure_multiple_of),V=c(K*S,this.config.ensure_multiple_of)}return[V,L]}else{if(this.size_divisibility!==void 0)return u([S,k],this.size_divisibility);if(this.min_pixels!==void 0&&this.max_pixels!==void 0){const V=this.config.patch_size*this.config.merge_size;return g(k,S,V,this.min_pixels,this.max_pixels)}else throw new Error(`Could not resize image due to unsupported \`this.size\` option in config: ${JSON.stringify(T)}`)}}async resize(M){const[T,S]=this.get_resize_output_image_size(M,this.size);return await M.resize(T,S,{resample:this.resample})}async preprocess(M,{do_normalize:T=null,do_pad:S=null,do_convert_rgb:k=null,do_convert_grayscale:$=null,do_flip_channel_order:j=null}={}){this.do_crop_margin&&(M=await this.crop_margin(M));const[V,L]=M.size;if(k??this.do_convert_rgb?M=M.rgb():$&&(M=M.grayscale()),this.do_resize&&(M=await this.resize(M)),this.do_thumbnail&&(M=await this.thumbnail(M,this.size,this.resample)),this.do_center_crop){let N,ne;Number.isInteger(this.crop_size)?(N=this.crop_size,ne=this.crop_size):(N=this.crop_size.width,ne=this.crop_size.height),M=await M.center_crop(N,ne)}const X=[M.height,M.width];let K=Float32Array.from(M.data),Y=[M.height,M.width,M.channels];if(this.do_rescale&&this.rescale(K),T??this.do_normalize){let N=this.image_mean;Array.isArray(this.image_mean)||(N=new Array(M.channels).fill(N));let ne=this.image_std;if(Array.isArray(this.image_std)||(ne=new Array(M.channels).fill(N)),N.length!==M.channels||ne.length!==M.channels)throw new Error(`When set to arrays, the length of \`image_mean\` (${N.length}) and \`image_std\` (${ne.length}) must match the number of channels in the image (${M.channels}).`);for(let te=0;te<K.length;te+=M.channels)for(let z=0;z<M.channels;++z)K[te+z]=(K[te+z]-N[z])/ne[z]}if(S??this.do_pad){if(this.pad_size)[K,Y]=this.pad_image(K,[M.height,M.width,M.channels],this.pad_size);else if(this.size_divisibility){const[N,ne]=u([Y[1],Y[0]],this.size_divisibility);[K,Y]=this.pad_image(K,Y,{width:N,height:ne})}}if(j??this.do_flip_channel_order){if(Y[2]!==3)throw new Error("Flipping channel order is only supported for RGB images.");for(let N=0;N<K.length;N+=3){const ne=K[N];K[N]=K[N+2],K[N+2]=ne}}const J=new s.Tensor("float32",K,Y).permute(2,0,1);return{original_size:[L,V],reshaped_input_size:X,pixel_values:J}}async _call(M,...T){Array.isArray(M)||(M=[M]);const S=await Promise.all(M.map($=>this.preprocess($)));return{pixel_values:(0,s.stack)(S.map($=>$.pixel_values),0),original_sizes:S.map($=>$.original_size),reshaped_input_sizes:S.map($=>$.reshaped_input_size)}}static async from_pretrained(M,T){const S=await(0,a.getModelJSON)(M,l.IMAGE_PROCESSOR_NAME,!0,T);return new this(S)}}},"./src/base/processing_utils.js":(t,e,r)=>{r.r(e),r.d(e,{Processor:()=>o});var n=r("./src/utils/constants.js"),s=r("./src/utils/generic.js"),i=r("./src/utils/hub.js");class o extends s.Callable{constructor(l,c){super(),this.config=l,this.components=c}get image_processor(){return this.components.image_processor}get tokenizer(){return this.components.tokenizer}get feature_extractor(){return this.components.feature_extractor}apply_chat_template(l,c={}){if(!this.tokenizer)throw new Error("Unable to apply chat template without a tokenizer.");return this.tokenizer.apply_chat_template(l,{tokenize:!1,...c})}batch_decode(...l){if(!this.tokenizer)throw new Error("Unable to decode without a tokenizer.");return this.tokenizer.batch_decode(...l)}decode(...l){if(!this.tokenizer)throw new Error("Unable to decode without a tokenizer.");return this.tokenizer.decode(...l)}async _call(l,...c){for(const u of[this.image_processor,this.feature_extractor,this.tokenizer])if(u)return u(l,...c);throw new Error("No image processor, feature extractor, or tokenizer found.")}static async from_pretrained(l,c){const[u,d]=await Promise.all([this.uses_processor_config?(0,i.getModelJSON)(l,n.PROCESSOR_NAME,!0,c):{},Promise.all(this.classes.filter(h=>h in this).map(async h=>{const f=await this[h].from_pretrained(l,c);return[h.replace(/_class$/,""),f]})).then(Object.fromEntries)]);return new this(u,d)}}ce(o,"classes",["image_processor_class","tokenizer_class","feature_extractor_class"]),ce(o,"uses_processor_config",!1)},"./src/configs.js":(t,e,r)=>{r.r(e),r.d(e,{AutoConfig:()=>c,PretrainedConfig:()=>l,getKeyValueShapes:()=>a});var n=r("./src/utils/core.js"),s=r("./src/utils/hub.js");async function i(u,d){return await(0,s.getModelJSON)(u,"config.json",!0,d)}function o(u){const d={};let h={};switch(u.model_type){case"llava":case"paligemma":case"gemma3":case"florence2":case"llava_onevision":case"idefics3":case"ultravox":case"smolvlm":h=o(u.text_config);break;case"moondream1":h=o(u.phi_config);break;case"musicgen":h=o(u.decoder);break;case"multi_modality":h=o(u.language_config);break;case"gpt2":case"gptj":case"jais":case"codegen":case"gpt_bigcode":d.num_heads="n_head",d.num_layers="n_layer",d.hidden_size="n_embd";break;case"gpt_neox":case"stablelm":case"opt":case"falcon":d.num_heads="num_attention_heads",d.num_layers="num_hidden_layers",d.hidden_size="hidden_size";break;case"llama":case"olmo":case"olmo2":case"mobilellm":case"granite":case"cohere":case"mistral":case"starcoder2":case"qwen2":case"qwen2_vl":case"phi":case"phi3":case"phi3_v":d.num_heads="num_key_value_heads",d.num_layers="num_hidden_layers",d.hidden_size="hidden_size",d.num_attention_heads="num_attention_heads";break;case"qwen3":case"gemma":case"gemma2":case"gemma3_text":case"glm":case"helium":d.num_heads="num_key_value_heads",d.num_layers="num_hidden_layers",d.dim_kv="head_dim";break;case"openelm":d.num_heads="num_kv_heads",d.num_layers="num_transformer_layers",d.dim_kv="head_dim";break;case"gpt_neo":case"donut-swin":d.num_heads="num_heads",d.num_layers="num_layers",d.hidden_size="hidden_size";break;case"bloom":d.num_heads="n_head",d.num_layers="n_layer",d.hidden_size="hidden_size";break;case"mpt":d.num_heads="n_heads",d.num_layers="n_layers",d.hidden_size="d_model";break;case"exaone":d.num_heads="num_key_value_heads",d.num_layers="num_layers",d.dim_kv="head_dim",d.num_attention_heads="num_attention_heads";break;case"t5":case"mt5":case"longt5":d.num_decoder_layers="num_decoder_layers",d.num_decoder_heads="num_heads",d.decoder_dim_kv="d_kv",d.num_encoder_layers="num_layers",d.num_encoder_heads="num_heads",d.encoder_dim_kv="d_kv";break;case"bart":case"mbart":case"marian":case"whisper":case"lite-whisper":case"m2m_100":case"blenderbot":case"blenderbot-small":case"florence2_language":d.num_decoder_layers="decoder_layers",d.num_decoder_heads="decoder_attention_heads",d.decoder_hidden_size="d_model",d.num_encoder_layers="encoder_layers",d.num_encoder_heads="encoder_attention_heads",d.encoder_hidden_size="d_model";break;case"speecht5":d.num_decoder_layers="decoder_layers",d.num_decoder_heads="decoder_attention_heads",d.decoder_hidden_size="hidden_size",d.num_encoder_layers="encoder_layers",d.num_encoder_heads="encoder_attention_heads",d.encoder_hidden_size="hidden_size";break;case"trocr":d.num_encoder_layers=d.num_decoder_layers="decoder_layers",d.num_encoder_heads=d.num_decoder_heads="decoder_attention_heads",d.encoder_hidden_size=d.decoder_hidden_size="d_model";break;case"musicgen_decoder":d.num_encoder_layers=d.num_decoder_layers="num_hidden_layers",d.num_encoder_heads=d.num_decoder_heads="num_attention_heads",d.encoder_hidden_size=d.decoder_hidden_size="hidden_size";break;case"moonshine":d.num_decoder_layers="decoder_num_hidden_layers",d.num_decoder_heads="decoder_num_key_value_heads",d.num_encoder_layers="encoder_num_hidden_layers",d.num_encoder_heads="encoder_num_key_value_heads",d.encoder_hidden_size=d.decoder_hidden_size="hidden_size";break;case"vision-encoder-decoder":const p=o(u.decoder),m="num_decoder_layers"in p,y=(0,n.pick)(u,["model_type","is_encoder_decoder"]);return m?(y.num_decoder_layers=p.num_decoder_layers,y.num_decoder_heads=p.num_decoder_heads,y.decoder_hidden_size=p.decoder_hidden_size,y.num_encoder_layers=p.num_encoder_layers,y.num_encoder_heads=p.num_encoder_heads,y.encoder_hidden_size=p.encoder_hidden_size):(y.num_layers=p.num_layers,y.num_heads=p.num_heads,y.hidden_size=p.hidden_size),y}const f={...h,...(0,n.pick)(u,["model_type","multi_query","is_encoder_decoder"])};for(const p in d)f[p]=u[d[p]];return f}function a(u,{prefix:d="past_key_values",batch_size:h=1}={}){const f={},p=u.normalized_config;if(p.is_encoder_decoder&&"num_encoder_heads"in p&&"num_decoder_heads"in p){const m=p.encoder_dim_kv??p.encoder_hidden_size/p.num_encoder_heads,y=p.decoder_dim_kv??p.decoder_hidden_size/p.num_decoder_heads,g=[h,p.num_encoder_heads,0,m],_=[h,p.num_decoder_heads,0,y];for(let v=0;v<p.num_decoder_layers;++v)f[`${d}.${v}.encoder.key`]=g,f[`${d}.${v}.encoder.value`]=g,f[`${d}.${v}.decoder.key`]=_,f[`${d}.${v}.decoder.value`]=_}else{const m=p.num_heads,y=p.num_layers,g=p.dim_kv??p.hidden_size/(p.num_attention_heads??m);if(p.model_type==="falcon"){const _=[h*m,0,g];for(let v=0;v<y;++v)f[`${d}.${v}.key`]=_,f[`${d}.${v}.value`]=_}else if(p.multi_query){const _=[h*m,0,2*g];for(let v=0;v<y;++v)f[`${d}.${v}.key_value`]=_}else if(p.model_type==="bloom"){const _=[h*m,g,0],v=[h*m,0,g];for(let w=0;w<y;++w)f[`${d}.${w}.key`]=_,f[`${d}.${w}.value`]=v}else if(p.model_type==="openelm")for(let _=0;_<y;++_){const v=[h,m[_],0,g];f[`${d}.${_}.key`]=v,f[`${d}.${_}.value`]=v}else{const _=[h,m,0,g];for(let v=0;v<y;++v)f[`${d}.${v}.key`]=_,f[`${d}.${v}.value`]=_}}return f}class l{constructor(d){ce(this,"model_type",null);ce(this,"is_encoder_decoder",!1);ce(this,"max_position_embeddings");ce(this,"transformers.js_config");Object.assign(this,d),this.normalized_config=o(this)}static async from_pretrained(d,{progress_callback:h=null,config:f=null,cache_dir:p=null,local_files_only:m=!1,revision:y="main"}={}){f&&!(f instanceof l)&&(f=new l(f));const g=f??await i(d,{progress_callback:h,config:f,cache_dir:p,local_files_only:m,revision:y});return new this(g)}}class c{static async from_pretrained(...d){return l.from_pretrained(...d)}}},"./src/env.js":(t,e,r)=>{var S,k;r.r(e),r.d(e,{apis:()=>y,env:()=>M});var n=r("?569f"),s=r("?3f59"),i=r("?154a");const o="3.5.2",a=typeof window<"u"&&typeof window.document<"u",l=typeof self<"u"&&((S=self.constructor)==null?void 0:S.name)==="DedicatedWorkerGlobalScope",c=typeof self<"u"&&"caches"in self,u=typeof navigator<"u"&&"gpu"in navigator,d=typeof navigator<"u"&&"ml"in navigator,h=typeof process<"u",f=h&&((k=process==null?void 0:process.release)==null?void 0:k.name)==="node",p=!T(n),m=!T(s),y=Object.freeze({IS_BROWSER_ENV:a,IS_WEBWORKER_ENV:l,IS_WEB_CACHE_AVAILABLE:c,IS_WEBGPU_AVAILABLE:u,IS_WEBNN_AVAILABLE:d,IS_PROCESS_AVAILABLE:h,IS_NODE_ENV:f,IS_FS_AVAILABLE:p,IS_PATH_AVAILABLE:m}),g=p&&m;let _="./";if(g){const $=Object(import.meta).url;$?_=s.dirname(s.dirname(i.fileURLToPath($))):typeof __dirname<"u"&&(_=s.dirname(__dirname))}const v=g?s.join(_,"/.cache/"):null,w="/models/",x=g?s.join(_,w):w,M={version:o,backends:{onnx:{}},allowRemoteModels:!0,remoteHost:"https://huggingface.co/",remotePathTemplate:"{model}/resolve/{revision}/",allowLocalModels:!(a||l),localModelPath:x,useFS:p,useBrowserCache:c,useFSCache:p,cacheDir:v,useCustomCache:!1,customCache:null};function T($){return Object.keys($).length===0}},"./src/generation/configuration_utils.js":(t,e,r)=>{r.r(e),r.d(e,{GenerationConfig:()=>s});var n=r("./src/utils/core.js");class s{constructor(o){ce(this,"max_length",20);ce(this,"max_new_tokens",null);ce(this,"min_length",0);ce(this,"min_new_tokens",null);ce(this,"early_stopping",!1);ce(this,"max_time",null);ce(this,"do_sample",!1);ce(this,"num_beams",1);ce(this,"num_beam_groups",1);ce(this,"penalty_alpha",null);ce(this,"use_cache",!0);ce(this,"temperature",1);ce(this,"top_k",50);ce(this,"top_p",1);ce(this,"typical_p",1);ce(this,"epsilon_cutoff",0);ce(this,"eta_cutoff",0);ce(this,"diversity_penalty",0);ce(this,"repetition_penalty",1);ce(this,"encoder_repetition_penalty",1);ce(this,"length_penalty",1);ce(this,"no_repeat_ngram_size",0);ce(this,"bad_words_ids",null);ce(this,"force_words_ids",null);ce(this,"renormalize_logits",!1);ce(this,"constraints",null);ce(this,"forced_bos_token_id",null);ce(this,"forced_eos_token_id",null);ce(this,"remove_invalid_values",!1);ce(this,"exponential_decay_length_penalty",null);ce(this,"suppress_tokens",null);ce(this,"streamer",null);ce(this,"begin_suppress_tokens",null);ce(this,"forced_decoder_ids",null);ce(this,"guidance_scale",null);ce(this,"num_return_sequences",1);ce(this,"output_attentions",!1);ce(this,"output_hidden_states",!1);ce(this,"output_scores",!1);ce(this,"return_dict_in_generate",!1);ce(this,"pad_token_id",null);ce(this,"bos_token_id",null);ce(this,"eos_token_id",null);ce(this,"encoder_no_repeat_ngram_size",0);ce(this,"decoder_start_token_id",null);ce(this,"generation_kwargs",{});Object.assign(this,(0,n.pick)(o,Object.getOwnPropertyNames(this)))}}},"./src/generation/logits_process.js":(t,e,r)=>{r.r(e),r.d(e,{ClassifierFreeGuidanceLogitsProcessor:()=>g,ForcedBOSTokenLogitsProcessor:()=>l,ForcedEOSTokenLogitsProcessor:()=>c,LogitsProcessor:()=>i,LogitsProcessorList:()=>a,LogitsWarper:()=>o,MinLengthLogitsProcessor:()=>p,MinNewTokensLengthLogitsProcessor:()=>m,NoBadWordsLogitsProcessor:()=>y,NoRepeatNGramLogitsProcessor:()=>h,RepetitionPenaltyLogitsProcessor:()=>f,SuppressTokensAtBeginLogitsProcessor:()=>u,TemperatureLogitsWarper:()=>_,TopKLogitsWarper:()=>w,TopPLogitsWarper:()=>v,WhisperTimeStampLogitsProcessor:()=>d});var n=r("./src/utils/generic.js");r("./src/utils/tensor.js");var s=r("./src/utils/maths.js");class i extends n.Callable{_call(M,T){throw Error("`_call` should be implemented in a subclass")}}class o extends n.Callable{_call(M,T){throw Error("`_call` should be implemented in a subclass")}}class a extends n.Callable{constructor(){super(),this.processors=[]}push(M){this.processors.push(M)}extend(M){this.processors.push(...M)}_call(M,T){let S=T;for(const k of this.processors)S=k(M,S);return S}[Symbol.iterator](){return this.processors.values()}}class l extends i{constructor(M){super(),this.bos_token_id=M}_call(M,T){for(let S=0;S<M.length;++S)if(M[S].length===1){const k=T[S].data;k.fill(-1/0),k[this.bos_token_id]=0}return T}}class c extends i{constructor(M,T){super(),this.max_length=M,this.eos_token_id=Array.isArray(T)?T:[T]}_call(M,T){for(let S=0;S<M.length;++S)if(M[S].length===this.max_length-1){const k=T[S].data;k.fill(-1/0);for(const $ of this.eos_token_id)k[$]=0}return T}}class u extends i{constructor(M,T){super(),this.begin_suppress_tokens=M,this.begin_index=T}_call(M,T){for(let S=0;S<M.length;++S)if(M[S].length===this.begin_index){const k=T[S].data;for(const $ of this.begin_suppress_tokens)k[$]=-1/0}return T}}class d extends i{constructor(M,T){super(),this.eos_token_id=Array.isArray(M.eos_token_id)?M.eos_token_id[0]:M.eos_token_id,this.no_timestamps_token_id=M.no_timestamps_token_id,this.timestamp_begin=this.no_timestamps_token_id+1,this.begin_index=T.length,T.at(-1)===this.no_timestamps_token_id&&(this.begin_index-=1),this.max_initial_timestamp_index=M.max_initial_timestamp_index}_call(M,T){for(let S=0;S<M.length;++S){const k=T[S].data;if(k[this.no_timestamps_token_id]=-1/0,M[S].length===this.begin_index-1){k.fill(-1/0),k[this.timestamp_begin]=0;continue}const $=M[S].slice(this.begin_index),j=$.length>=1&&$[$.length-1]>=this.timestamp_begin,V=$.length<2||$[$.length-2]>=this.timestamp_begin;if(j&&(V?k.subarray(this.timestamp_begin).fill(-1/0):k.subarray(0,this.eos_token_id).fill(-1/0)),M[S].length===this.begin_index&&this.max_initial_timestamp_index!==null){const Y=this.timestamp_begin+this.max_initial_timestamp_index;k.subarray(Y+1).fill(-1/0)}const L=(0,s.log_softmax)(k),X=Math.log(L.subarray(this.timestamp_begin).map(Math.exp).reduce((Y,J)=>Y+J)),K=(0,s.max)(L.subarray(0,this.timestamp_begin))[0];X>K&&k.subarray(0,this.timestamp_begin).fill(-1/0)}return T}}class h extends i{constructor(M){super(),this.no_repeat_ngram_size=M}getNgrams(M){const T=M.length,S=[];for(let $=0;$<T+1-this.no_repeat_ngram_size;++$){const j=[];for(let V=0;V<this.no_repeat_ngram_size;++V)j.push(M[$+V]);S.push(j.map(Number))}const k=new Map;for(const $ of S){const j=$.slice(0,$.length-1),V=JSON.stringify(j),L=k.get(V)??[];L.push($[$.length-1]),k.set(V,L)}return k}getGeneratedNgrams(M,T){const S=T.slice(T.length+1-this.no_repeat_ngram_size,T.length);return M.get(JSON.stringify(S.map(Number)))??[]}calcBannedNgramTokens(M){const T=[];if(M.length+1<this.no_repeat_ngram_size)return T;{const S=this.getNgrams(M);return this.getGeneratedNgrams(S,M)}}_call(M,T){for(let S=0;S<M.length;++S){const k=T[S].data,$=this.calcBannedNgramTokens(M[S]);for(const j of $)k[j]=-1/0}return T}}class f extends i{constructor(M){super(),this.penalty=M}_call(M,T){for(let S=0;S<M.length;++S){const k=T[S].data;for(const $ of new Set(M[S])){const j=Number($);k[j]<0?k[j]*=this.penalty:k[j]/=this.penalty}}return T}}class p extends i{constructor(M,T){super(),this.min_length=M,this.eos_token_id=Array.isArray(T)?T:[T]}_call(M,T){for(let S=0;S<M.length;++S)if(M[S].length<this.min_length){const k=T[S].data;for(const $ of this.eos_token_id)k[$]=-1/0}return T}}class m extends i{constructor(M,T,S){super(),this.prompt_length_to_skip=M,this.min_new_tokens=T,this.eos_token_id=Array.isArray(S)?S:[S]}_call(M,T){for(let S=0;S<M.length;++S)if(M[S].length-this.prompt_length_to_skip<this.min_new_tokens){const $=T[S].data;for(const j of this.eos_token_id)$[j]=-1/0}return T}}class y extends i{constructor(M,T){super(),this.bad_words_ids=M,this.eos_token_id=Array.isArray(T)?T:[T]}_call(M,T){for(let S=0;S<M.length;++S){const k=T[S].data,$=M[S];for(const j of this.bad_words_ids){if($.length<j.length-1)continue;let V=!0;for(let L=1;L<=j.length-1;++L)if(j.at(-L-1)!=$.at(-L)){V=!1;break}V&&(k[j.at(-1)]=-1/0)}}return T}}class g extends i{constructor(M){if(super(),M<=1)throw new Error(`Require guidance scale >1 to use the classifier free guidance processor, got guidance scale ${M}.`);this.guidance_scale=M}_call(M,T){if(T.dims[0]!==2*M.length)throw new Error(`Logits should have twice the batch size of the input ids, the first half of batches corresponding to the conditional inputs, and the second half of batches corresponding to the unconditional inputs. Got batch size ${T.dims[0]} for the logits and ${M.length} for the input ids.`);const S=M.length,k=T.slice([0,S],null),$=T.slice([S,T.dims[0]],null);for(let j=0;j<$.data.length;++j)$.data[j]+=(k.data[j]-$.data[j])*this.guidance_scale;return $}}class _ extends o{constructor(M){super(),this.temperature=M}_call(M,T){const S=T.data;for(let k=0;k<S.length;++k)S[k]/=this.temperature;return T}}class v extends o{constructor(M,{filter_value:T=-1/0,min_tokens_to_keep:S=1}={}){if(super(),M<0||M>1)throw new Error(`\`top_p\` must be a float > 0 and < 1, but is ${M}`);if(!Number.isInteger(S)||S<1)throw new Error(`\`min_tokens_to_keep\` must be a positive integer, but is ${S}`);this.top_p=M,this.filter_value=T,this.min_tokens_to_keep=S}}class w extends o{constructor(M,{filter_value:T=-1/0,min_tokens_to_keep:S=1}={}){if(super(),!Number.isInteger(M)||M<0)throw new Error(`\`top_k\` must be a positive integer, but is ${M}`);this.top_k=Math.max(M,S),this.filter_value=T}}},"./src/generation/logits_sampler.js":(t,e,r)=>{r.r(e),r.d(e,{LogitsSampler:()=>o});var n=r("./src/utils/generic.js"),s=r("./src/utils/tensor.js"),i=r("./src/utils/maths.js");r("./src/generation/configuration_utils.js");class o extends n.Callable{constructor(d){super(),this.generation_config=d}async _call(d){return this.sample(d)}async sample(d){throw Error("sample should be implemented in subclasses.")}getLogits(d,h){let f=d.dims.at(-1),p=d.data;if(h===-1)p=p.slice(-f);else{let m=h*f;p=p.slice(m,m+f)}return p}randomSelect(d){let h=0;for(let p=0;p<d.length;++p)h+=d[p];let f=Math.random()*h;for(let p=0;p<d.length;++p)if(f-=d[p],f<=0)return p;return 0}static getSampler(d){if(d.do_sample)return new l(d);if(d.num_beams>1)return new c(d);if(d.num_return_sequences>1)throw Error(`num_return_sequences has to be 1 when doing greedy search, but is ${d.num_return_sequences}.`);return new a(d)}}class a extends o{async sample(d){const h=(0,i.max)(d.data)[1];return[[BigInt(h),0]]}}class l extends o{async sample(d){let h=d.dims.at(-1);this.generation_config.top_k>0&&(h=Math.min(this.generation_config.top_k,h));const[f,p]=await(0,s.topk)(d,h),m=(0,i.softmax)(f.data);return Array.from({length:this.generation_config.num_beams},()=>{const y=this.randomSelect(m);return[p.data[y],Math.log(m[y])]})}}class c extends o{async sample(d){let h=d.dims.at(-1);this.generation_config.top_k>0&&(h=Math.min(this.generation_config.top_k,h));const[f,p]=await(0,s.topk)(d,h),m=(0,i.softmax)(f.data);return Array.from({length:this.generation_config.num_beams},(y,g)=>[p.data[g],Math.log(m[g])])}}},"./src/generation/stopping_criteria.js":(t,e,r)=>{r.r(e),r.d(e,{EosTokenCriteria:()=>a,InterruptableStoppingCriteria:()=>l,MaxLengthCriteria:()=>o,StoppingCriteria:()=>s,StoppingCriteriaList:()=>i});var n=r("./src/utils/generic.js");class s extends n.Callable{_call(u,d){throw Error("StoppingCriteria needs to be subclassed")}}class i extends n.Callable{constructor(){super(),this.criteria=[]}push(u){this.criteria.push(u)}extend(u){u instanceof i?u=u.criteria:u instanceof s&&(u=[u]),this.criteria.push(...u)}_call(u,d){const h=new Array(u.length).fill(!1);for(const f of this.criteria){const p=f(u,d);for(let m=0;m<h.length;++m)h[m]||(h[m]=p[m])}return h}[Symbol.iterator](){return this.criteria.values()}}class o extends s{constructor(u,d=null){super(),this.max_length=u,this.max_position_embeddings=d}_call(u){return u.map(d=>d.length>=this.max_length)}}class a extends s{constructor(u){super(),Array.isArray(u)||(u=[u]),this.eos_token_id=u}_call(u,d){return u.map(h=>{const f=h.at(-1);return this.eos_token_id.some(p=>f==p)})}}class l extends s{constructor(){super(),this.interrupted=!1}interrupt(){this.interrupted=!0}reset(){this.interrupted=!1}_call(u,d){return new Array(u.length).fill(this.interrupted)}}},"./src/generation/streamers.js":(t,e,r)=>{r.r(e),r.d(e,{BaseStreamer:()=>o,TextStreamer:()=>l,WhisperTextStreamer:()=>c});var n=r("./src/utils/core.js"),s=r("./src/tokenizers.js"),i=r("./src/env.js");class o{put(d){throw Error("Not implemented")}end(){throw Error("Not implemented")}}const a=i.apis.IS_PROCESS_AVAILABLE?u=>process.stdout.write(u):u=>console.log(u);class l extends o{constructor(d,{skip_prompt:h=!1,callback_function:f=null,token_callback_function:p=null,skip_special_tokens:m=!0,decode_kwargs:y={},...g}={}){super(),this.tokenizer=d,this.skip_prompt=h,this.callback_function=f??a,this.token_callback_function=p,this.decode_kwargs={skip_special_tokens:m,...y,...g},this.token_cache=[],this.print_len=0,this.next_tokens_are_prompt=!0}put(d){var y;if(d.length>1)throw Error("TextStreamer only supports batch size of 1");const h=this.next_tokens_are_prompt;if(h&&(this.next_tokens_are_prompt=!1,this.skip_prompt))return;const f=d[0];(y=this.token_callback_function)==null||y.call(this,f),this.token_cache=(0,n.mergeArrays)(this.token_cache,f);const p=this.tokenizer.decode(this.token_cache,this.decode_kwargs);let m;h||p.endsWith(`
`)?(m=p.slice(this.print_len),this.token_cache=[],this.print_len=0):p.length>0&&(0,s.is_chinese_char)(p.charCodeAt(p.length-1))?(m=p.slice(this.print_len),this.print_len+=m.length):(m=p.slice(this.print_len,p.lastIndexOf(" ")+1),this.print_len+=m.length),this.on_finalized_text(m,!1)}end(){let d;this.token_cache.length>0?(d=this.tokenizer.decode(this.token_cache,this.decode_kwargs).slice(this.print_len),this.token_cache=[],this.print_len=0):d="",this.next_tokens_are_prompt=!0,this.on_finalized_text(d,!0)}on_finalized_text(d,h){var f,p;d.length>0&&((f=this.callback_function)==null||f.call(this,d)),h&&this.callback_function===a&&i.apis.IS_PROCESS_AVAILABLE&&((p=this.callback_function)==null||p.call(this,`
`))}}class c extends l{constructor(d,{skip_prompt:h=!1,callback_function:f=null,token_callback_function:p=null,on_chunk_start:m=null,on_chunk_end:y=null,on_finalize:g=null,time_precision:_=.02,skip_special_tokens:v=!0,decode_kwargs:w={}}={}){super(d,{skip_prompt:h,skip_special_tokens:v,callback_function:f,token_callback_function:p,decode_kwargs:w}),this.timestamp_begin=d.timestamp_begin,this.on_chunk_start=m,this.on_chunk_end=y,this.on_finalize=g,this.time_precision=_,this.waiting_for_timestamp=!1}put(d){var f,p,m;if(d.length>1)throw Error("WhisperTextStreamer only supports batch size of 1");const h=d[0];if(h.length===1){const y=Number(h[0])-this.timestamp_begin;if(y>=0){const g=y*this.time_precision;this.waiting_for_timestamp?(f=this.on_chunk_end)==null||f.call(this,g):(p=this.on_chunk_start)==null||p.call(this,g),this.waiting_for_timestamp=!this.waiting_for_timestamp,(m=this.token_callback_function)==null||m.call(this,h);return}}return super.put(d)}end(){var d;super.end(),(d=this.on_finalize)==null||d.call(this)}}},"./src/models.js":(t,e,r)=>{r.r(e),r.d(e,{ASTForAudioClassification:()=>wf,ASTModel:()=>vf,ASTPreTrainedModel:()=>Yu,AlbertForMaskedLM:()=>ie,AlbertForQuestionAnswering:()=>Z,AlbertForSequenceClassification:()=>I,AlbertModel:()=>ve,AlbertPreTrainedModel:()=>Yi,AutoModel:()=>z0,AutoModelForAudioClassification:()=>YE,AutoModelForAudioFrameClassification:()=>JE,AutoModelForAudioTextToText:()=>aP,AutoModelForCTC:()=>qE,AutoModelForCausalLM:()=>jE,AutoModelForDepthEstimation:()=>rP,AutoModelForDocumentQuestionAnswering:()=>ZE,AutoModelForImageClassification:()=>VE,AutoModelForImageFeatureExtraction:()=>iP,AutoModelForImageMatting:()=>eP,AutoModelForImageSegmentation:()=>WE,AutoModelForImageTextToText:()=>oP,AutoModelForImageToImage:()=>tP,AutoModelForMaskGeneration:()=>XE,AutoModelForMaskedLM:()=>NE,AutoModelForNormalEstimation:()=>nP,AutoModelForObjectDetection:()=>HE,AutoModelForPoseEstimation:()=>sP,AutoModelForQuestionAnswering:()=>zE,AutoModelForSemanticSegmentation:()=>UE,AutoModelForSeq2SeqLM:()=>IE,AutoModelForSequenceClassification:()=>OE,AutoModelForSpeechSeq2Seq:()=>FE,AutoModelForTextToSpectrogram:()=>LE,AutoModelForTextToWaveform:()=>RE,AutoModelForTokenClassification:()=>DE,AutoModelForUniversalSegmentation:()=>GE,AutoModelForVision2Seq:()=>BE,AutoModelForXVector:()=>QE,AutoModelForZeroShotObjectDetection:()=>KE,BartForConditionalGeneration:()=>ar,BartForSequenceClassification:()=>Jr,BartModel:()=>br,BartPretrainedModel:()=>qt,BaseModelOutput:()=>Te,BeitForImageClassification:()=>pT,BeitModel:()=>fT,BeitPreTrainedModel:()=>n0,BertForMaskedLM:()=>Fe,BertForQuestionAnswering:()=>Ze,BertForSequenceClassification:()=>Le,BertForTokenClassification:()=>We,BertModel:()=>Pe,BertPreTrainedModel:()=>ke,BlenderbotForConditionalGeneration:()=>An,BlenderbotModel:()=>Zr,BlenderbotPreTrainedModel:()=>hr,BlenderbotSmallForConditionalGeneration:()=>Mn,BlenderbotSmallModel:()=>Ms,BlenderbotSmallPreTrainedModel:()=>bs,BloomForCausalLM:()=>LM,BloomModel:()=>FM,BloomPreTrainedModel:()=>G_,CLIPModel:()=>kf,CLIPPreTrainedModel:()=>_o,CLIPSegForImageSegmentation:()=>ud,CLIPSegModel:()=>cd,CLIPSegPreTrainedModel:()=>dc,CLIPTextModel:()=>I_,CLIPTextModelWithProjection:()=>Af,CLIPVisionModel:()=>F_,CLIPVisionModelWithProjection:()=>$f,CamembertForMaskedLM:()=>ft,CamembertForQuestionAnswering:()=>sn,CamembertForSequenceClassification:()=>rr,CamembertForTokenClassification:()=>mr,CamembertModel:()=>vt,CamembertPreTrainedModel:()=>Mt,CausalLMOutput:()=>fl,CausalLMOutputWithPast:()=>GV,ChineseCLIPModel:()=>uc,ChineseCLIPPreTrainedModel:()=>Df,ClapAudioModelWithProjection:()=>pS,ClapModel:()=>hS,ClapPreTrainedModel:()=>Vf,ClapTextModelWithProjection:()=>fS,CodeGenForCausalLM:()=>gc,CodeGenModel:()=>dl,CodeGenPreTrainedModel:()=>mc,CohereForCausalLM:()=>gM,CohereModel:()=>mM,CoherePreTrainedModel:()=>L_,ConvBertForMaskedLM:()=>is,ConvBertForQuestionAnswering:()=>W,ConvBertForSequenceClassification:()=>R,ConvBertForTokenClassification:()=>le,ConvBertModel:()=>Ct,ConvBertPreTrainedModel:()=>wr,ConvNextForImageClassification:()=>lC,ConvNextModel:()=>aC,ConvNextPreTrainedModel:()=>y0,ConvNextV2ForImageClassification:()=>uC,ConvNextV2Model:()=>cC,ConvNextV2PreTrainedModel:()=>v0,DFineForObjectDetection:()=>ET,DFineModel:()=>ST,DFinePreTrainedModel:()=>c0,DPTForDepthEstimation:()=>WT,DPTModel:()=>VT,DPTPreTrainedModel:()=>m0,DacDecoderModel:()=>rE,DacDecoderOutput:()=>ZS,DacEncoderModel:()=>tE,DacEncoderOutput:()=>JS,DacModel:()=>eE,DacPreTrainedModel:()=>qf,DebertaForMaskedLM:()=>zs,DebertaForQuestionAnswering:()=>Ui,DebertaForSequenceClassification:()=>li,DebertaForTokenClassification:()=>Bs,DebertaModel:()=>kn,DebertaPreTrainedModel:()=>xr,DebertaV2ForMaskedLM:()=>xs,DebertaV2ForQuestionAnswering:()=>Ki,DebertaV2ForSequenceClassification:()=>ci,DebertaV2ForTokenClassification:()=>Hi,DebertaV2Model:()=>Gi,DebertaV2PreTrainedModel:()=>Xn,DecisionTransformerModel:()=>FS,DecisionTransformerPreTrainedModel:()=>IS,DeiTForImageClassification:()=>OT,DeiTModel:()=>$T,DeiTPreTrainedModel:()=>d0,DepthAnythingForDepthEstimation:()=>GT,DepthAnythingPreTrainedModel:()=>UT,DepthProForDepthEstimation:()=>YT,DepthProPreTrainedModel:()=>qT,DetrForObjectDetection:()=>gT,DetrForSegmentation:()=>s0,DetrModel:()=>mT,DetrObjectDetectionOutput:()=>i0,DetrPreTrainedModel:()=>Lf,DetrSegmentationOutput:()=>_T,Dinov2ForImageClassification:()=>hC,Dinov2Model:()=>dC,Dinov2PreTrainedModel:()=>w0,Dinov2WithRegistersForImageClassification:()=>pC,Dinov2WithRegistersModel:()=>fC,Dinov2WithRegistersPreTrainedModel:()=>x0,DistilBertForMaskedLM:()=>Be,DistilBertForQuestionAnswering:()=>Rn,DistilBertForSequenceClassification:()=>fn,DistilBertForTokenClassification:()=>ui,DistilBertModel:()=>Xi,DistilBertPreTrainedModel:()=>Rr,DonutSwinModel:()=>oC,DonutSwinPreTrainedModel:()=>iC,EfficientNetForImageClassification:()=>xS,EfficientNetModel:()=>wS,EfficientNetPreTrainedModel:()=>$0,ElectraForMaskedLM:()=>ze,ElectraForQuestionAnswering:()=>Qt,ElectraForSequenceClassification:()=>Ee,ElectraForTokenClassification:()=>Ot,ElectraModel:()=>we,ElectraPreTrainedModel:()=>ae,EsmForMaskedLM:()=>nr,EsmForSequenceClassification:()=>Vs,EsmForTokenClassification:()=>Ws,EsmModel:()=>_t,EsmPreTrainedModel:()=>it,ExaoneForCausalLM:()=>ee,ExaoneModel:()=>U,ExaonePreTrainedModel:()=>F,FalconForCausalLM:()=>dS,FalconModel:()=>uS,FalconPreTrainedModel:()=>P0,FastViTForImageClassification:()=>rT,FastViTModel:()=>tT,FastViTPreTrainedModel:()=>J_,Florence2ForConditionalGeneration:()=>Cf,Florence2PreTrainedModel:()=>rd,GLPNForDepthEstimation:()=>sC,GLPNModel:()=>nC,GLPNPreTrainedModel:()=>_0,GPT2LMHeadModel:()=>fd,GPT2Model:()=>hd,GPT2PreTrainedModel:()=>dd,GPTBigCodeForCausalLM:()=>yd,GPTBigCodeModel:()=>_d,GPTBigCodePreTrainedModel:()=>ul,GPTJForCausalLM:()=>gd,GPTJModel:()=>md,GPTJPreTrainedModel:()=>pc,GPTNeoForCausalLM:()=>ll,GPTNeoModel:()=>pd,GPTNeoPreTrainedModel:()=>hc,GPTNeoXForCausalLM:()=>fc,GPTNeoXModel:()=>cl,GPTNeoXPreTrainedModel:()=>os,Gemma2ForCausalLM:()=>wM,Gemma2Model:()=>vM,Gemma2PreTrainedModel:()=>j_,Gemma3ForCausalLM:()=>bM,Gemma3Model:()=>xM,Gemma3PreTrainedModel:()=>N_,GemmaForCausalLM:()=>yM,GemmaModel:()=>_M,GemmaPreTrainedModel:()=>R_,GlmForCausalLM:()=>P,GlmModel:()=>b,GlmPreTrainedModel:()=>yc,GraniteForCausalLM:()=>pM,GraniteModel:()=>Ff,GranitePreTrainedModel:()=>Qi,GroundingDinoForObjectDetection:()=>gC,GroundingDinoPreTrainedModel:()=>mC,GroupViTModel:()=>eT,GroupViTPreTrainedModel:()=>ZM,HeliumForCausalLM:()=>bd,HeliumModel:()=>xd,HeliumPreTrainedModel:()=>_c,HieraForImageClassification:()=>IT,HieraModel:()=>DT,HieraPreTrainedModel:()=>h0,HubertForCTC:()=>HC,HubertForSequenceClassification:()=>KC,HubertModel:()=>GC,HubertPreTrainedModel:()=>$V,IJepaForImageClassification:()=>UM,IJepaModel:()=>WM,IJepaPreTrainedModel:()=>q_,Idefics3ForConditionalGeneration:()=>al,Idefics3PreTrainedModel:()=>cc,ImageMattingOutput:()=>cP,JAISLMHeadModel:()=>If,JAISModel:()=>xt,JAISPreTrainedModel:()=>ra,JinaCLIPModel:()=>od,JinaCLIPPreTrainedModel:()=>ta,JinaCLIPTextModel:()=>ad,JinaCLIPVisionModel:()=>ld,LiteWhisperForConditionalGeneration:()=>Zu,LlamaForCausalLM:()=>wd,LlamaModel:()=>vd,LlamaPreTrainedModel:()=>hl,LlavaForConditionalGeneration:()=>ol,LlavaOnevisionForConditionalGeneration:()=>Jo,LlavaPreTrainedModel:()=>td,LongT5ForConditionalGeneration:()=>Je,LongT5Model:()=>rt,LongT5PreTrainedModel:()=>He,M2M100ForConditionalGeneration:()=>SC,M2M100Model:()=>CC,M2M100PreTrainedModel:()=>T0,MBartForCausalLM:()=>hi,MBartForConditionalGeneration:()=>mn,MBartForSequenceClassification:()=>Tr,MBartModel:()=>pn,MBartPreTrainedModel:()=>on,MPNetForMaskedLM:()=>Ja,MPNetForQuestionAnswering:()=>tl,MPNetForSequenceClassification:()=>Za,MPNetForTokenClassification:()=>el,MPNetModel:()=>Qa,MPNetPreTrainedModel:()=>di,MT5ForConditionalGeneration:()=>Jt,MT5Model:()=>Et,MT5PreTrainedModel:()=>ot,MarianMTModel:()=>TC,MarianModel:()=>MC,MarianPreTrainedModel:()=>M0,MaskFormerForInstanceSegmentation:()=>rC,MaskFormerModel:()=>tC,MaskFormerPreTrainedModel:()=>g0,MaskedLMOutput:()=>Cn,Metric3DForDepthEstimation:()=>JT,Metric3DPreTrainedModel:()=>QT,Metric3Dv2ForDepthEstimation:()=>eC,Metric3Dv2PreTrainedModel:()=>ZT,MgpstrForSceneTextRecognition:()=>zS,MgpstrModelOutput:()=>jS,MgpstrPreTrainedModel:()=>NS,MimiDecoderModel:()=>QS,MimiDecoderOutput:()=>XS,MimiEncoderModel:()=>YS,MimiEncoderOutput:()=>KS,MimiModel:()=>qS,MimiPreTrainedModel:()=>Xf,MistralForCausalLM:()=>aS,MistralModel:()=>oS,MistralPreTrainedModel:()=>S0,MobileBertForMaskedLM:()=>Hr,MobileBertForQuestionAnswering:()=>Gs,MobileBertForSequenceClassification:()=>Qr,MobileBertModel:()=>Us,MobileBertPreTrainedModel:()=>Gr,MobileLLMForCausalLM:()=>Ge,MobileLLMModel:()=>Oe,MobileLLMPreTrainedModel:()=>me,MobileNetV1ForImageClassification:()=>MS,MobileNetV1ForSemanticSegmentation:()=>TS,MobileNetV1Model:()=>bS,MobileNetV1PreTrainedModel:()=>Uf,MobileNetV2ForImageClassification:()=>SS,MobileNetV2ForSemanticSegmentation:()=>ES,MobileNetV2Model:()=>CS,MobileNetV2PreTrainedModel:()=>Gf,MobileNetV3ForImageClassification:()=>kS,MobileNetV3ForSemanticSegmentation:()=>AS,MobileNetV3Model:()=>PS,MobileNetV3PreTrainedModel:()=>Hf,MobileNetV4ForImageClassification:()=>OS,MobileNetV4ForSemanticSegmentation:()=>DS,MobileNetV4Model:()=>$S,MobileNetV4PreTrainedModel:()=>Kf,MobileViTForImageClassification:()=>oT,MobileViTModel:()=>iT,MobileViTPreTrainedModel:()=>Z_,MobileViTV2ForImageClassification:()=>lT,MobileViTV2Model:()=>aT,MobileViTV2PreTrainedModel:()=>e0,ModelOutput:()=>Me,ModernBertForMaskedLM:()=>qe,ModernBertForSequenceClassification:()=>at,ModernBertForTokenClassification:()=>ct,ModernBertModel:()=>Re,ModernBertPreTrainedModel:()=>et,Moondream1ForConditionalGeneration:()=>Tf,MoonshineForConditionalGeneration:()=>Mf,MoonshineModel:()=>bf,MoonshinePreTrainedModel:()=>lc,MptForCausalLM:()=>jM,MptModel:()=>RM,MptPreTrainedModel:()=>H_,MultiModalityCausalLM:()=>RS,MultiModalityPreTrainedModel:()=>LS,MusicgenForCausalLM:()=>FV,MusicgenForConditionalGeneration:()=>D0,MusicgenModel:()=>IV,MusicgenPreTrainedModel:()=>O0,NomicBertModel:()=>Qe,NomicBertPreTrainedModel:()=>lt,OPTForCausalLM:()=>zM,OPTModel:()=>NM,OPTPreTrainedModel:()=>K_,Olmo2ForCausalLM:()=>ln,Olmo2Model:()=>lr,Olmo2PreTrainedModel:()=>Ut,OlmoForCausalLM:()=>At,OlmoModel:()=>ut,OlmoPreTrainedModel:()=>tt,OpenELMForCausalLM:()=>TM,OpenELMModel:()=>MM,OpenELMPreTrainedModel:()=>z_,OwlViTForObjectDetection:()=>uT,OwlViTModel:()=>cT,OwlViTPreTrainedModel:()=>t0,Owlv2ForObjectDetection:()=>hT,Owlv2Model:()=>dT,Owlv2PreTrainedModel:()=>r0,PaliGemmaForConditionalGeneration:()=>Ef,PaliGemmaPreTrainedModel:()=>Sf,PatchTSMixerForPrediction:()=>US,PatchTSMixerModel:()=>WS,PatchTSMixerPreTrainedModel:()=>F0,PatchTSTForPrediction:()=>VS,PatchTSTModel:()=>BS,PatchTSTPreTrainedModel:()=>I0,Phi3ForCausalLM:()=>IM,Phi3Model:()=>DM,Phi3PreTrainedModel:()=>U_,Phi3VForCausalLM:()=>sd,Phi3VPreTrainedModel:()=>Pf,PhiForCausalLM:()=>OM,PhiModel:()=>$M,PhiPreTrainedModel:()=>W_,PreTrainedModel:()=>Q,PretrainedMixin:()=>Zt,PvtForImageClassification:()=>XM,PvtModel:()=>KM,PvtPreTrainedModel:()=>Y_,PyAnnoteForAudioFrameClassification:()=>OC,PyAnnoteModel:()=>$C,PyAnnotePreTrainedModel:()=>C0,QuestionAnsweringModelOutput:()=>jn,Qwen2ForCausalLM:()=>SM,Qwen2Model:()=>CM,Qwen2PreTrainedModel:()=>B_,Qwen2VLForConditionalGeneration:()=>AM,Qwen2VLPreTrainedModel:()=>kM,Qwen3ForCausalLM:()=>PM,Qwen3Model:()=>EM,Qwen3PreTrainedModel:()=>V_,RFDetrForObjectDetection:()=>TT,RFDetrModel:()=>MT,RFDetrObjectDetectionOutput:()=>CT,RFDetrPreTrainedModel:()=>l0,RTDetrForObjectDetection:()=>vT,RTDetrModel:()=>yT,RTDetrObjectDetectionOutput:()=>Md,RTDetrPreTrainedModel:()=>o0,RTDetrV2ForObjectDetection:()=>xT,RTDetrV2Model:()=>wT,RTDetrV2ObjectDetectionOutput:()=>bT,RTDetrV2PreTrainedModel:()=>a0,ResNetForImageClassification:()=>LT,ResNetModel:()=>FT,ResNetPreTrainedModel:()=>f0,RoFormerForMaskedLM:()=>Rt,RoFormerForQuestionAnswering:()=>Ur,RoFormerForSequenceClassification:()=>Yt,RoFormerForTokenClassification:()=>Xt,RoFormerModel:()=>yt,RoFormerPreTrainedModel:()=>je,RobertaForMaskedLM:()=>Cr,RobertaForQuestionAnswering:()=>Tn,RobertaForSequenceClassification:()=>Kr,RobertaForTokenClassification:()=>Xr,RobertaModel:()=>an,RobertaPreTrainedModel:()=>$n,SamImageSegmentationOutput:()=>bC,SamModel:()=>xC,SamPreTrainedModel:()=>wC,SapiensForDepthEstimation:()=>KT,SapiensForNormalEstimation:()=>XT,SapiensForSemanticSegmentation:()=>HT,SapiensPreTrainedModel:()=>jf,SegformerForImageClassification:()=>gS,SegformerForSemanticSegmentation:()=>_S,SegformerModel:()=>DV,SegformerPreTrainedModel:()=>Wf,Seq2SeqLMOutput:()=>UV,SequenceClassifierOutput:()=>Dt,SiglipModel:()=>ea,SiglipPreTrainedModel:()=>Zo,SiglipTextModel:()=>id,SiglipVisionModel:()=>Of,SmolVLMForConditionalGeneration:()=>nd,SnacDecoderModel:()=>iE,SnacEncoderModel:()=>sE,SnacModel:()=>nE,SnacPreTrainedModel:()=>Yf,SpeechT5ForSpeechToText:()=>tS,SpeechT5ForTextToSpeech:()=>rS,SpeechT5HifiGan:()=>nS,SpeechT5Model:()=>OV,SpeechT5PreTrainedModel:()=>Bf,SqueezeBertForMaskedLM:()=>rl,SqueezeBertForQuestionAnswering:()=>sl,SqueezeBertForSequenceClassification:()=>nl,SqueezeBertModel:()=>Yo,SqueezeBertPreTrainedModel:()=>qi,StableLmForCausalLM:()=>vS,StableLmModel:()=>yS,StableLmPreTrainedModel:()=>A0,Starcoder2ForCausalLM:()=>cS,Starcoder2Model:()=>lS,Starcoder2PreTrainedModel:()=>E0,StyleTextToSpeech2Model:()=>eS,StyleTextToSpeech2PreTrainedModel:()=>ZC,Swin2SRForImageSuperResolution:()=>BT,Swin2SRModel:()=>zT,Swin2SRPreTrainedModel:()=>p0,SwinForImageClassification:()=>jT,SwinForSemanticSegmentation:()=>NT,SwinModel:()=>RT,SwinPreTrainedModel:()=>Rf,T5ForConditionalGeneration:()=>Ae,T5Model:()=>ye,T5PreTrainedModel:()=>he,TableTransformerForObjectDetection:()=>kT,TableTransformerModel:()=>PT,TableTransformerObjectDetectionOutput:()=>AT,TableTransformerPreTrainedModel:()=>u0,TokenClassifierOutput:()=>gn,TrOCRForCausalLM:()=>iS,TrOCRPreTrainedModel:()=>sS,UltravoxModel:()=>HS,UltravoxPreTrainedModel:()=>GS,UniSpeechForCTC:()=>LC,UniSpeechForSequenceClassification:()=>RC,UniSpeechModel:()=>FC,UniSpeechPreTrainedModel:()=>Nf,UniSpeechSatForAudioFrameClassification:()=>BC,UniSpeechSatForCTC:()=>NC,UniSpeechSatForSequenceClassification:()=>zC,UniSpeechSatModel:()=>jC,UniSpeechSatPreTrainedModel:()=>Td,ViTForImageClassification:()=>VM,ViTMAEModel:()=>YM,ViTMAEPreTrainedModel:()=>qM,ViTMSNForImageClassification:()=>JM,ViTMSNModel:()=>QM,ViTMSNPreTrainedModel:()=>Q_,ViTModel:()=>BM,ViTPreTrainedModel:()=>X_,VisionEncoderDecoderModel:()=>ed,VitMatteForImageMatting:()=>sT,VitMattePreTrainedModel:()=>nT,VitPoseForPoseEstimation:()=>HM,VitPosePreTrainedModel:()=>GM,VitsModel:()=>k0,VitsModelOutput:()=>uP,VitsPreTrainedModel:()=>mS,Wav2Vec2BertForCTC:()=>WC,Wav2Vec2BertForSequenceClassification:()=>UC,Wav2Vec2BertModel:()=>VC,Wav2Vec2BertPreTrainedModel:()=>zf,Wav2Vec2ForAudioFrameClassification:()=>AC,Wav2Vec2ForCTC:()=>PC,Wav2Vec2ForSequenceClassification:()=>kC,Wav2Vec2Model:()=>EC,Wav2Vec2PreTrainedModel:()=>na,WavLMForAudioFrameClassification:()=>JC,WavLMForCTC:()=>qC,WavLMForSequenceClassification:()=>YC,WavLMForXVector:()=>QC,WavLMModel:()=>XC,WavLMPreTrainedModel:()=>vc,WeSpeakerResNetModel:()=>IC,WeSpeakerResNetPreTrainedModel:()=>DC,WhisperForConditionalGeneration:()=>Ju,WhisperModel:()=>xf,WhisperPreTrainedModel:()=>Qu,XLMForQuestionAnswering:()=>qu,XLMForSequenceClassification:()=>hf,XLMForTokenClassification:()=>ff,XLMModel:()=>il,XLMPreTrainedModel:()=>Hs,XLMRobertaForMaskedLM:()=>mf,XLMRobertaForQuestionAnswering:()=>yf,XLMRobertaForSequenceClassification:()=>gf,XLMRobertaForTokenClassification:()=>_f,XLMRobertaModel:()=>pf,XLMRobertaPreTrainedModel:()=>Qo,XLMWithLMHeadModel:()=>df,XVectorOutput:()=>lP,YolosForObjectDetection:()=>yC,YolosModel:()=>_C,YolosObjectDetectionOutput:()=>vC,YolosPreTrainedModel:()=>b0});var n=r("./src/configs.js"),s=r("./src/backends/onnx.js"),i=r("./src/utils/dtypes.js"),o=r("./src/utils/generic.js"),a=r("./src/utils/core.js"),l=r("./src/utils/hub.js"),c=r("./src/utils/constants.js"),u=r("./src/generation/logits_process.js"),d=r("./src/generation/configuration_utils.js"),h=r("./src/utils/tensor.js"),f=r("./src/utils/image.js"),p=r("./src/utils/maths.js"),m=r("./src/generation/stopping_criteria.js"),y=r("./src/generation/logits_sampler.js"),g=r("./src/env.js"),_=r("./src/models/whisper/generation_whisper.js"),v=r("./src/models/whisper/common_whisper.js");const w={EncoderOnly:0,EncoderDecoder:1,Seq2Seq:2,Vision2Seq:3,DecoderOnly:4,MaskGeneration:5,ImageTextToText:6,Musicgen:7,MultiModality:8,Phi3V:9,AudioTextToText:10,AutoEncoder:11},x=new Map,M=new Map,T=new Map;async function S(E,A,B){var _n;let ue=((_n=B.config)==null?void 0:_n["transformers.js_config"])??{},be=B.device??ue.device;be&&typeof be!="string"&&(be.hasOwnProperty(A)?be=be[A]:(console.warn(`device not specified for "${A}". Using the default device.`),be=null));const xe=be??(g.apis.IS_NODE_ENV?"cpu":"wasm"),De=(0,s.deviceToExecutionProviders)(xe),Ue=ue.device_config??{};Ue.hasOwnProperty(xe)&&(ue={...ue,...Ue[xe]});let Xe=B.dtype??ue.dtype;if(typeof Xe!="string"&&(Xe&&Xe.hasOwnProperty(A)?Xe=Xe[A]:(Xe=i.DEFAULT_DEVICE_DTYPE_MAPPING[xe]??i.DATA_TYPES.fp32,console.warn(`dtype not specified for "${A}". Using the default dtype (${Xe}) for this device (${xe}).`))),Xe===i.DATA_TYPES.auto){let Nt=ue.dtype;typeof Nt!="string"&&(Nt=Nt==null?void 0:Nt[A]),Nt&&Nt!==i.DATA_TYPES.auto&&i.DATA_TYPES.hasOwnProperty(Nt)?Xe=Nt:Xe=i.DEFAULT_DEVICE_DTYPE_MAPPING[xe]??i.DATA_TYPES.fp32}const nt=Xe;if(i.DEFAULT_DTYPE_SUFFIX_MAPPING.hasOwnProperty(nt)){if(nt===i.DATA_TYPES.fp16&&xe==="webgpu"&&!await(0,i.isWebGpuFp16Supported)())throw new Error(`The device (${xe}) does not support fp16.`)}else throw new Error(`Invalid dtype: ${nt}. Should be one of: ${Object.keys(i.DATA_TYPES).join(", ")}`);const Tt=ue.kv_cache_dtype,kt=Tt?typeof Tt=="string"?Tt:Tt[nt]??"float32":void 0;if(kt&&!["float32","float16"].includes(kt))throw new Error(`Invalid kv_cache_dtype: ${kt}. Should be one of: float32, float16`);const bt={dtype:nt,kv_cache_dtype:kt,device:xe},jt=i.DEFAULT_DTYPE_SUFFIX_MAPPING[nt],Pt=`${A}${jt}.onnx`,Lt=`${B.subfolder??""}/${Pt}`,mt={...B.session_options};mt.executionProviders??(mt.executionProviders=De);const Vt=ue.free_dimension_overrides;Vt?mt.freeDimensionOverrides??(mt.freeDimensionOverrides=Vt):xe.startsWith("webnn")&&!mt.freeDimensionOverrides&&console.warn(`WebNN does not currently support dynamic shapes and requires 'free_dimension_overrides' to be set in config.json, preferably as a field within config["transformers.js_config"]["device_config"]["${xe}"]. When 'free_dimension_overrides' is not set, you may experience significant performance degradation.`);const gr=g.apis.IS_NODE_ENV&&g.env.useFSCache,Sr=(0,l.getModelFile)(E,Lt,!0,B,gr),jr=B.use_external_data_format??ue.use_external_data_format;let Or=[];if(jr){let Nt;typeof jr=="object"?jr.hasOwnProperty(Pt)?Nt=jr[Pt]:jr.hasOwnProperty(A)?Nt=jr[A]:Nt=!1:Nt=jr;const cn=+Nt;if(cn>l.MAX_EXTERNAL_DATA_CHUNKS)throw new Error(`The number of external data chunks (${cn}) exceeds the maximum allowed value (${l.MAX_EXTERNAL_DATA_CHUNKS}).`);for(let Ts=0;Ts<cn;++Ts){const pl=`${Pt}_data${Ts===0?"":"_"+Ts}`,qn=`${B.subfolder??""}/${pl}`;Or.push(new Promise(async(Ks,Qf)=>{const ml=await(0,l.getModelFile)(E,qn,!0,B,gr);Ks(ml instanceof Uint8Array?{path:pl,data:ml}:pl)}))}}else mt.externalData!==void 0&&(Or=mt.externalData.map(async Nt=>{if(typeof Nt.data=="string"){const cn=await(0,l.getModelFile)(E,Nt.data,!0,B);return{...Nt,data:cn}}return Nt}));if(Or.length>0){const Nt=await Promise.all(Or);g.apis.IS_NODE_ENV||(mt.externalData=Nt)}if(xe==="webgpu"){const Nt=(0,n.getKeyValueShapes)(B.config,{prefix:"present"});if(Object.keys(Nt).length>0&&!(0,s.isONNXProxy)()){const cn={};for(const Ts in Nt)cn[Ts]="gpu-buffer";mt.preferredOutputLocation=cn}}return{buffer_or_path:await Sr,session_options:mt,session_config:bt}}async function k(E,A,B){return Object.fromEntries(await Promise.all(Object.keys(A).map(async ue=>{const{buffer_or_path:be,session_options:xe,session_config:De}=await S(E,A[ue],B),Ue=await(0,s.createInferenceSession)(be,xe,De);return[ue,Ue]})))}async function $(E,A,B){return Object.fromEntries(await Promise.all(Object.keys(A).map(async ue=>{const be=await(0,l.getModelJSON)(E,A[ue],!1,B);return[ue,be]})))}function j(E,A){const B=Object.create(null),ue=[];for(const De of E.inputNames){const Ue=A[De];if(!(Ue instanceof h.Tensor)){ue.push(De);continue}B[De]=(0,s.isONNXProxy)()?Ue.clone():Ue}if(ue.length>0)throw new Error(`An error occurred during model execution: "Missing the following inputs: ${ue.join(", ")}.`);const be=Object.keys(A).length,xe=E.inputNames.length;if(be>xe){let De=Object.keys(A).filter(Ue=>!E.inputNames.includes(Ue));console.warn(`WARNING: Too many inputs were provided (${be} > ${xe}). The following inputs will be ignored: "${De.join(", ")}".`)}return B}let V=Promise.resolve();async function L(E,A){const B=j(E,A);try{const ue=Object.fromEntries(Object.entries(B).map(([De,Ue])=>[De,Ue.ort_tensor])),be=()=>E.run(ue),xe=await(g.apis.IS_BROWSER_ENV||g.apis.IS_WEBWORKER_ENV?V=V.then(be):be());return X(xe)}catch(ue){const be=Object.fromEntries(Object.entries(B).map(([xe,De])=>{const Ue={type:De.type,dims:De.dims,location:De.location};return Ue.location!=="gpu-buffer"&&(Ue.data=De.data),[xe,Ue]}));throw console.error(`An error occurred during model execution: "${ue}".`),console.error("Inputs given to model:",be),ue}}function X(E){for(let A in E)(0,s.isONNXTensor)(E[A])?E[A]=new h.Tensor(E[A]):typeof E[A]=="object"&&X(E[A]);return E}function K(E){if(E instanceof h.Tensor)return E;if(E.length===0)throw Error("items must be non-empty");if(Array.isArray(E[0])){if(E.some(A=>A.length!==E[0].length))throw Error("Unable to create tensor, you should probably activate truncation and/or padding with 'padding=True' and/or 'truncation=True' to have batched tensors with the same length.");return new h.Tensor("int64",BigInt64Array.from(E.flat().map(A=>BigInt(A))),[E.length,E[0].length])}else return new h.Tensor("int64",BigInt64Array.from(E.map(A=>BigInt(A))),[1,E.length])}function Y(E){return new h.Tensor("bool",[E],[1])}async function J(E,A){let{encoder_outputs:B,input_ids:ue,decoder_input_ids:be,...xe}=A;if(!B){const Ue=(0,a.pick)(A,E.sessions.model.inputNames);B=(await N(E,Ue)).last_hidden_state}return xe.input_ids=be,xe.encoder_hidden_states=B,E.sessions.decoder_model_merged.inputNames.includes("encoder_attention_mask")&&(xe.encoder_attention_mask=A.attention_mask),await te(E,xe,!0)}async function N(E,A){const B=E.sessions.model,ue=(0,a.pick)(A,B.inputNames);if(B.inputNames.includes("inputs_embeds")&&!ue.inputs_embeds){if(!A.input_ids)throw new Error("Both `input_ids` and `inputs_embeds` are missing in the model inputs.");ue.inputs_embeds=await E.encode_text({input_ids:A.input_ids})}if(B.inputNames.includes("token_type_ids")&&!ue.token_type_ids){if(!ue.input_ids)throw new Error("Both `input_ids` and `token_type_ids` are missing in the model inputs.");ue.token_type_ids=(0,h.zeros_like)(ue.input_ids)}if(B.inputNames.includes("pixel_mask")&&!ue.pixel_mask){if(!ue.pixel_values)throw new Error("Both `pixel_values` and `pixel_mask` are missing in the model inputs.");const be=ue.pixel_values.dims;ue.pixel_mask=(0,h.ones)([be[0],be[2],be[3]])}return await L(B,ue)}async function ne(E,A){const B=await E.encode(A);return await E.decode(B)}async function te(E,A,B=!1){const ue=E.sessions[B?"decoder_model_merged":"model"],{past_key_values:be,...xe}=A;if(ue.inputNames.includes("use_cache_branch")&&(xe.use_cache_branch=Y(!!be)),ue.inputNames.includes("position_ids")&&xe.attention_mask&&!xe.position_ids){const Ue=["paligemma","gemma3_text","gemma3"].includes(E.config.model_type)?1:0;xe.position_ids=$e(xe,be,Ue)}E.addPastKeyValues(xe,be);const De=(0,a.pick)(xe,ue.inputNames);return await L(ue,De)}function z({modality_token_id:E,inputs_embeds:A,modality_features:B,input_ids:ue,attention_mask:be}){const xe=ue.tolist().map(nt=>nt.reduce((Tt,kt,bt)=>(kt==E&&Tt.push(bt),Tt),[])),De=xe.reduce((nt,Tt)=>nt+Tt.length,0),Ue=B.dims[0];if(De!==Ue)throw new Error(`Number of tokens and features do not match: tokens: ${De}, features ${Ue}`);let Xe=0;for(let nt=0;nt<xe.length;++nt){const Tt=xe[nt],kt=A[nt];for(let bt=0;bt<Tt.length;++bt)kt[Tt[bt]].data.set(B[Xe++].data)}return{inputs_embeds:A,attention_mask:be}}function O({image_token_id:E,inputs_embeds:A,image_features:B,input_ids:ue,attention_mask:be}){return z({modality_token_id:E,inputs_embeds:A,modality_features:B,input_ids:ue,attention_mask:be})}function H({audio_token_id:E,inputs_embeds:A,audio_features:B,input_ids:ue,attention_mask:be}){return z({modality_token_id:E,inputs_embeds:A,modality_features:B,input_ids:ue,attention_mask:be})}async function re(E,{encode_function:A,merge_function:B,modality_input_name:ue,modality_output_name:be,input_ids:xe=null,attention_mask:De=null,position_ids:Ue=null,inputs_embeds:Xe=null,past_key_values:nt=null,generation_config:Tt=null,logits_processor:kt=null,...bt}){const jt=bt[ue];if(!Xe){if(Xe=await E.encode_text({input_ids:xe,...bt}),jt&&xe.dims[1]!==1){const Lt=await A({[ue]:jt,...bt});({inputs_embeds:Xe,attention_mask:De}=B({[be]:Lt,inputs_embeds:Xe,input_ids:xe,attention_mask:De}))}else if(nt&&jt&&xe.dims[1]===1){const Lt=xe.dims[1],mt=Object.values(nt)[0].dims.at(-2);De=(0,h.cat)([(0,h.ones)([xe.dims[0],mt]),De.slice(null,[De.dims[1]-Lt,De.dims[1]])],1)}}if(!Ue&&E.config.model_type==="qwen2_vl"){const{image_grid_thw:Lt,video_grid_thw:mt}=bt;[Ue]=E.get_rope_index(xe,Lt,mt,De)}return await te(E,{inputs_embeds:Xe,past_key_values:nt,attention_mask:De,position_ids:Ue,generation_config:Tt,logits_processor:kt},!0)}async function _e(E,A){return await re(E,{...A,modality_input_name:"audio_values",modality_output_name:"audio_features",encode_function:E.encode_audio.bind(E),merge_function:E._merge_input_ids_with_audio_features.bind(E)})}async function oe(E,A){return await re(E,{...A,modality_input_name:"pixel_values",modality_output_name:"image_features",encode_function:E.encode_image.bind(E),merge_function:E._merge_input_ids_with_image_features.bind(E)})}function pe(E,A=0){const[B,ue]=E.dims,be=E.data,xe=new BigInt64Array(be.length);for(let De=0;De<B;++De){const Ue=De*ue;let Xe=BigInt(A);for(let nt=0;nt<ue;++nt){const Tt=Ue+nt;be[Tt]===0n?xe[Tt]=BigInt(1):(xe[Tt]=Xe,Xe+=be[Tt])}}return{data:xe,dims:E.dims}}function $e(E,A=null,B=0){const{input_ids:ue,inputs_embeds:be,attention_mask:xe}=E,{data:De,dims:Ue}=pe(xe,B);let Xe=new h.Tensor("int64",De,Ue);if(A){const nt=-(ue??be).dims.at(1);Xe=Xe.slice(null,[nt,null])}return Xe}function Ne(E,A,B,ue){if(B.past_key_values){const be=Object.values(B.past_key_values)[0].dims.at(-2),{input_ids:xe,attention_mask:De}=B;if(!(De&&De.dims[1]>xe.dims[1])){if(be<xe.dims[1])B.input_ids=xe.slice(null,[be,null]);else if(E.config.image_token_index!=null&&xe.data.some(Ue=>Ue==E.config.image_token_index)){const Ue=E.config.num_image_tokens;if(!Ue)throw new Error("`num_image_tokens` is missing in the model configuration.");const Xe=xe.dims[1]-(be-Ue);B.input_ids=xe.slice(null,[-Xe,null]),B.attention_mask=(0,h.ones)([1,be+Xe])}}}return B}function de(E,A,B,ue){return B.past_key_values&&(A=A.map(be=>[be.at(-1)])),{...B,decoder_input_ids:K(A)}}function q(E,...A){return E.config.is_encoder_decoder?de(E,...A):Ne(E,...A)}function se(E,A,B,ue){const be=!!B.past_key_values;return ue.guidance_scale!==null&&ue.guidance_scale>1&&(be?B.input_ids=(0,h.cat)([B.input_ids,B.input_ids],0):(B.input_ids=(0,h.cat)([B.input_ids,(0,h.full_like)(B.input_ids,BigInt(ue.pad_token_id))],0),B.attention_mask=(0,h.cat)([B.attention_mask,(0,h.full_like)(B.attention_mask,0n)],0))),(be||!B.pixel_values)&&(B.pixel_values=(0,h.full)([0,0,3,384,384],1)),be&&(B.images_seq_mask=new h.Tensor("bool",new Array(1).fill(!0).fill(!1,0,1),[1,1]),B.images_emb_mask=new h.Tensor("bool",new Array(0).fill(!1),[1,1,0])),B}class Q extends o.Callable{constructor(B,ue,be){super();ce(this,"main_input_name","input_ids");ce(this,"forward_params",["input_ids","attention_mask"]);this.config=B,this.sessions=ue,this.configs=be;const xe=T.get(this.constructor),De=x.get(xe);switch(this.can_generate=!1,this._forward=null,this._prepare_inputs_for_generation=null,De){case w.DecoderOnly:this.can_generate=!0,this._forward=te,this._prepare_inputs_for_generation=Ne;break;case w.Seq2Seq:case w.Vision2Seq:case w.Musicgen:this.can_generate=!0,this._forward=J,this._prepare_inputs_for_generation=de;break;case w.EncoderDecoder:this._forward=J;break;case w.ImageTextToText:this.can_generate=!0,this._forward=oe,this._prepare_inputs_for_generation=q;break;case w.AudioTextToText:this.can_generate=!0,this._forward=_e,this._prepare_inputs_for_generation=q;break;case w.Phi3V:this.can_generate=!0,this._prepare_inputs_for_generation=q;break;case w.MultiModality:this.can_generate=!0,this._prepare_inputs_for_generation=se;break;case w.AutoEncoder:this._forward=ne;break;default:this._forward=N;break}this.can_generate&&this.forward_params.push("past_key_values"),this.custom_config=this.config["transformers.js_config"]??{}}async dispose(){var ue;const B=[];for(const be of Object.values(this.sessions))(ue=be==null?void 0:be.handler)!=null&&ue.dispose&&B.push(be.handler.dispose());return await Promise.all(B)}static async from_pretrained(B,{progress_callback:ue=null,config:be=null,cache_dir:xe=null,local_files_only:De=!1,revision:Ue="main",model_file_name:Xe=null,subfolder:nt="onnx",device:Tt=null,dtype:kt=null,use_external_data_format:bt=null,session_options:jt={}}={}){let Pt={progress_callback:ue,config:be,cache_dir:xe,local_files_only:De,revision:Ue,model_file_name:Xe,subfolder:nt,device:Tt,dtype:kt,use_external_data_format:bt,session_options:jt};const Lt=T.get(this),mt=x.get(Lt);be=Pt.config=await n.AutoConfig.from_pretrained(B,Pt);let Vt;if(mt===w.DecoderOnly)Vt=await Promise.all([k(B,{model:Pt.model_file_name??"model"},Pt),$(B,{generation_config:"generation_config.json"},Pt)]);else if(mt===w.Seq2Seq||mt===w.Vision2Seq)Vt=await Promise.all([k(B,{model:"encoder_model",decoder_model_merged:"decoder_model_merged"},Pt),$(B,{generation_config:"generation_config.json"},Pt)]);else if(mt===w.MaskGeneration)Vt=await Promise.all([k(B,{model:"vision_encoder",prompt_encoder_mask_decoder:"prompt_encoder_mask_decoder"},Pt)]);else if(mt===w.EncoderDecoder)Vt=await Promise.all([k(B,{model:"encoder_model",decoder_model_merged:"decoder_model_merged"},Pt)]);else if(mt===w.ImageTextToText){const gr={embed_tokens:"embed_tokens",vision_encoder:"vision_encoder",decoder_model_merged:"decoder_model_merged"};be.is_encoder_decoder&&(gr.model="encoder_model"),Vt=await Promise.all([k(B,gr,Pt),$(B,{generation_config:"generation_config.json"},Pt)])}else if(mt===w.AudioTextToText){const gr={embed_tokens:"embed_tokens",audio_encoder:"audio_encoder",decoder_model_merged:"decoder_model_merged"};Vt=await Promise.all([k(B,gr,Pt),$(B,{generation_config:"generation_config.json"},Pt)])}else if(mt===w.Musicgen)Vt=await Promise.all([k(B,{model:"text_encoder",decoder_model_merged:"decoder_model_merged",encodec_decode:"encodec_decode"},Pt),$(B,{generation_config:"generation_config.json"},Pt)]);else if(mt===w.MultiModality)Vt=await Promise.all([k(B,{prepare_inputs_embeds:"prepare_inputs_embeds",model:"language_model",lm_head:"lm_head",gen_head:"gen_head",gen_img_embeds:"gen_img_embeds",image_decode:"image_decode"},Pt),$(B,{generation_config:"generation_config.json"},Pt)]);else if(mt===w.Phi3V)Vt=await Promise.all([k(B,{prepare_inputs_embeds:"prepare_inputs_embeds",model:"model",vision_encoder:"vision_encoder"},Pt),$(B,{generation_config:"generation_config.json"},Pt)]);else if(mt===w.AutoEncoder)Vt=await Promise.all([k(B,{encoder_model:"encoder_model",decoder_model:"decoder_model"},Pt)]);else{if(mt!==w.EncoderOnly){const gr=Lt??(be==null?void 0:be.model_type);gr!=="custom"&&console.warn(`Model type for '${gr}' not found, assuming encoder-only architecture. Please report this at ${c.GITHUB_ISSUE_URL}.`)}Vt=await Promise.all([k(B,{model:Pt.model_file_name??"model"},Pt)])}return new this(be,...Vt)}async _call(B){return await this.forward(B)}async forward(B){return await this._forward(this,B)}get generation_config(){var B;return((B=this.configs)==null?void 0:B.generation_config)??null}_get_logits_warper(B){const ue=new u.LogitsProcessorList;return B.temperature!==null&&B.temperature!==1&&ue.push(new u.TemperatureLogitsWarper(B.temperature)),B.top_k!==null&&B.top_k!==0&&ue.push(new u.TopKLogitsWarper(B.top_k)),B.top_p!==null&&B.top_p<1&&ue.push(new u.TopPLogitsWarper(B.top_p)),ue}_get_logits_processor(B,ue,be=null){const xe=new u.LogitsProcessorList;if(B.repetition_penalty!==null&&B.repetition_penalty!==1&&xe.push(new u.RepetitionPenaltyLogitsProcessor(B.repetition_penalty)),B.no_repeat_ngram_size!==null&&B.no_repeat_ngram_size>0&&xe.push(new u.NoRepeatNGramLogitsProcessor(B.no_repeat_ngram_size)),B.bad_words_ids!==null&&xe.push(new u.NoBadWordsLogitsProcessor(B.bad_words_ids,B.eos_token_id)),B.min_length!==null&&B.eos_token_id!==null&&B.min_length>0&&xe.push(new u.MinLengthLogitsProcessor(B.min_length,B.eos_token_id)),B.min_new_tokens!==null&&B.eos_token_id!==null&&B.min_new_tokens>0&&xe.push(new u.MinNewTokensLengthLogitsProcessor(ue,B.min_new_tokens,B.eos_token_id)),B.forced_bos_token_id!==null&&xe.push(new u.ForcedBOSTokenLogitsProcessor(B.forced_bos_token_id)),B.forced_eos_token_id!==null&&xe.push(new u.ForcedEOSTokenLogitsProcessor(B.max_length,B.forced_eos_token_id)),B.begin_suppress_tokens!==null){const De=ue>1||B.forced_bos_token_id===null?ue:ue+1;xe.push(new u.SuppressTokensAtBeginLogitsProcessor(B.begin_suppress_tokens,De))}return B.guidance_scale!==null&&B.guidance_scale>1&&xe.push(new u.ClassifierFreeGuidanceLogitsProcessor(B.guidance_scale)),be!==null&&xe.extend(be),xe}_prepare_generation_config(B,ue,be=d.GenerationConfig){const xe={...this.config};for(const Ue of["decoder","generator","text_config"])Ue in xe&&Object.assign(xe,xe[Ue]);const De=new be(xe);return Object.assign(De,this.generation_config??{}),B&&Object.assign(De,B),ue&&Object.assign(De,(0,a.pick)(ue,Object.getOwnPropertyNames(De))),De}_get_stopping_criteria(B,ue=null){const be=new m.StoppingCriteriaList;return B.max_length!==null&&be.push(new m.MaxLengthCriteria(B.max_length,this.config.max_position_embeddings??null)),B.eos_token_id!==null&&be.push(new m.EosTokenCriteria(B.eos_token_id)),ue&&be.extend(ue),be}_validate_model_class(){if(!this.can_generate){const B=[j0,N0,R0,L0],ue=T.get(this.constructor),be=new Set,xe=this.config.model_type;for(const Ue of B){const Xe=Ue.get(xe);Xe&&be.add(Xe[0])}let De=`The current model class (${ue}) is not compatible with \`.generate()\`, as it doesn't have a language model head.`;throw be.size>0&&(De+=` Please use the following class instead: ${[...be].join(", ")}`),Error(De)}}prepare_inputs_for_generation(...B){return this._prepare_inputs_for_generation(this,...B)}_update_model_kwargs_for_generation({generated_input_ids:B,outputs:ue,model_inputs:be,is_encoder_decoder:xe}){return be.past_key_values=this.getPastKeyValues(ue,be.past_key_values),be.input_ids=new h.Tensor("int64",B.flat(),[B.length,1]),xe||(be.attention_mask=(0,h.cat)([be.attention_mask,(0,h.ones)([be.attention_mask.dims[0],1])],1)),be.position_ids=null,be}_prepare_model_inputs({inputs:B,bos_token_id:ue,model_kwargs:be}){const xe=(0,a.pick)(be,this.forward_params),De=this.main_input_name;if(De in xe){if(B)throw new Error("`inputs`: {inputs}` were passed alongside {input_name} which is not allowed. Make sure to either pass {inputs} or {input_name}=...")}else xe[De]=B;return{inputs_tensor:xe[De],model_inputs:xe,model_input_name:De}}async _prepare_encoder_decoder_kwargs_for_generation({inputs_tensor:B,model_inputs:ue,model_input_name:be,generation_config:xe}){if(this.sessions.model.inputNames.includes("inputs_embeds")&&!ue.inputs_embeds&&"_prepare_inputs_embeds"in this){const{input_ids:Ue,pixel_values:Xe,attention_mask:nt,...Tt}=ue,kt=await this._prepare_inputs_embeds(ue);ue={...Tt,...(0,a.pick)(kt,["inputs_embeds","attention_mask"])}}let{last_hidden_state:De}=await N(this,ue);if(xe.guidance_scale!==null&&xe.guidance_scale>1)De=(0,h.cat)([De,(0,h.full_like)(De,0)],0),"attention_mask"in ue&&(ue.attention_mask=(0,h.cat)([ue.attention_mask,(0,h.zeros_like)(ue.attention_mask)],0));else if(ue.decoder_input_ids){const Ue=K(ue.decoder_input_ids).dims[0];if(Ue!==De.dims[0]){if(De.dims[0]!==1)throw new Error(`The encoder outputs have a different batch size (${De.dims[0]}) than the decoder inputs (${Ue}).`);De=(0,h.cat)(Array.from({length:Ue},()=>De),0)}}return ue.encoder_outputs=De,ue}_prepare_decoder_input_ids_for_generation({batch_size:B,model_input_name:ue,model_kwargs:be,decoder_start_token_id:xe,bos_token_id:De,generation_config:Ue}){let{decoder_input_ids:Xe,...nt}=be;if(!(Xe instanceof h.Tensor)){if(Xe)Array.isArray(Xe[0])||(Xe=Array.from({length:B},()=>Xe));else if(xe??(xe=De),this.config.model_type==="musicgen")Xe=Array.from({length:B*this.config.decoder.num_codebooks},()=>[xe]);else if(Array.isArray(xe)){if(xe.length!==B)throw new Error(`\`decoder_start_token_id\` expcted to have length ${B} but got ${xe.length}`);Xe=xe}else Xe=Array.from({length:B},()=>[xe]);Xe=K(Xe)}return be.decoder_attention_mask=(0,h.ones_like)(Xe),{input_ids:Xe,model_inputs:nt}}async generate({inputs:B=null,generation_config:ue=null,logits_processor:be=null,stopping_criteria:xe=null,streamer:De=null,...Ue}){this._validate_model_class(),ue=this._prepare_generation_config(ue,Ue);let{inputs_tensor:Xe,model_inputs:nt,model_input_name:Tt}=this._prepare_model_inputs({inputs:B,model_kwargs:Ue});const kt=this.config.is_encoder_decoder;kt&&("encoder_outputs"in nt||(nt=await this._prepare_encoder_decoder_kwargs_for_generation({inputs_tensor:Xe,model_inputs:nt,model_input_name:Tt,generation_config:ue})));let bt;kt?{input_ids:bt,model_inputs:nt}=this._prepare_decoder_input_ids_for_generation({batch_size:nt[Tt].dims.at(0),model_input_name:Tt,model_kwargs:nt,decoder_start_token_id:ue.decoder_start_token_id,bos_token_id:ue.bos_token_id,generation_config:ue}):bt=nt[Tt];let jt=bt.dims.at(-1);ue.max_new_tokens!==null&&(ue.max_length=jt+ue.max_new_tokens);const Pt=this._get_logits_processor(ue,jt,be),Lt=this._get_stopping_criteria(ue,xe),mt=nt[Tt].dims.at(0),Vt=y.LogitsSampler.getSampler(ue),gr=new Array(mt).fill(0),Sr=bt.tolist();De&&De.put(Sr);let jr,Or={};for(;;){if(nt=this.prepare_inputs_for_generation(Sr,nt,ue),jr=await this.forward(nt),ue.output_attentions&&ue.return_dict_in_generate){const qn=this.getAttentions(jr);for(const Ks in qn)Ks in Or||(Or[Ks]=[]),Or[Ks].push(qn[Ks])}const Nt=jr.logits.slice(null,-1,null),cn=Pt(Sr,Nt),Ts=[];for(let qn=0;qn<cn.dims.at(0);++qn){const Ks=cn[qn],Qf=await Vt(Ks);for(const[ml,Jf]of Qf){const Zf=BigInt(ml);gr[qn]+=Jf,Sr[qn].push(Zf),Ts.push([Zf]);break}}if(De&&De.put(Ts),Lt(Sr).every(qn=>qn))break;nt=this._update_model_kwargs_for_generation({generated_input_ids:Ts,outputs:jr,model_inputs:nt,is_encoder_decoder:kt})}De&&De.end();const en=this.getPastKeyValues(jr,nt.past_key_values,!0),_n=new h.Tensor("int64",Sr.flat(),[Sr.length,Sr[0].length]);if(ue.return_dict_in_generate)return{sequences:_n,past_key_values:en,...Or};for(const Nt of Object.values(jr))Nt.location==="gpu-buffer"&&Nt.dispose();return _n}getPastKeyValues(B,ue,be=!1){const xe=Object.create(null);for(const De in B)if(De.startsWith("present")){const Ue=De.replace("present","past_key_values"),Xe=De.includes("encoder");if(Xe&&ue?xe[Ue]=ue[Ue]:xe[Ue]=B[De],ue&&(!Xe||be)){const nt=ue[Ue];nt.location==="gpu-buffer"&&nt.dispose()}}return xe}getAttentions(B){const ue={};for(const be of["cross_attentions","encoder_attentions","decoder_attentions"])for(const xe in B)xe.startsWith(be)&&(be in ue||(ue[be]=[]),ue[be].push(B[xe]));return ue}addPastKeyValues(B,ue){var be,xe,De;if(ue)Object.assign(B,ue);else{const Ue=this.sessions.decoder_model_merged??this.sessions.model,Xe=((be=Ue==null?void 0:Ue.config)==null?void 0:be.kv_cache_dtype)??"float32",nt=Xe==="float16"?new h.DataTypeMap.float16:[],Tt=((De=(xe=B[this.main_input_name]??B.attention_mask)==null?void 0:xe.dims)==null?void 0:De[0])??1,kt=(0,n.getKeyValueShapes)(this.config,{batch_size:Tt});for(const bt in kt)B[bt]=new h.Tensor(Xe,nt,kt[bt])}}async encode_image({pixel_values:B}){const ue=(await L(this.sessions.vision_encoder,{pixel_values:B})).image_features;return this.config.num_image_tokens||(console.warn(`The number of image tokens was not set in the model configuration. Setting it to the number of features detected by the vision encoder (${ue.dims[1]}).`),this.config.num_image_tokens=ue.dims[1]),ue}async encode_text({input_ids:B}){return(await L(this.sessions.embed_tokens,{input_ids:B})).inputs_embeds}async encode_audio({audio_values:B}){return(await L(this.sessions.audio_encoder,{audio_values:B})).audio_features}}class Me{}class Te extends Me{constructor({last_hidden_state:A,hidden_states:B=null,attentions:ue=null}){super(),this.last_hidden_state=A,this.hidden_states=B,this.attentions=ue}}class ke extends Q{}class Pe extends ke{}class Fe extends ke{async _call(A){return new Cn(await super._call(A))}}class Le extends ke{async _call(A){return new Dt(await super._call(A))}}class We extends ke{async _call(A){return new gn(await super._call(A))}}class Ze extends ke{async _call(A){return new jn(await super._call(A))}}class et extends Q{}class Re extends et{}class qe extends et{async _call(A){return new Cn(await super._call(A))}}class at extends et{async _call(A){return new Dt(await super._call(A))}}class ct extends et{async _call(A){return new gn(await super._call(A))}}class lt extends Q{}class Qe extends lt{}class je extends Q{}class yt extends je{}class Rt extends je{async _call(A){return new Cn(await super._call(A))}}class Yt extends je{async _call(A){return new Dt(await super._call(A))}}class Xt extends je{async _call(A){return new gn(await super._call(A))}}class Ur extends je{async _call(A){return new jn(await super._call(A))}}class wr extends Q{}class Ct extends wr{}class is extends wr{async _call(A){return new Cn(await super._call(A))}}class R extends wr{async _call(A){return new Dt(await super._call(A))}}class le extends wr{async _call(A){return new gn(await super._call(A))}}class W extends wr{async _call(A){return new jn(await super._call(A))}}class ae extends Q{}class we extends ae{}class ze extends ae{async _call(A){return new Cn(await super._call(A))}}class Ee extends ae{async _call(A){return new Dt(await super._call(A))}}class Ot extends ae{async _call(A){return new gn(await super._call(A))}}class Qt extends ae{async _call(A){return new jn(await super._call(A))}}class Mt extends Q{}class vt extends Mt{}class ft extends Mt{async _call(A){return new Cn(await super._call(A))}}class rr extends Mt{async _call(A){return new Dt(await super._call(A))}}class mr extends Mt{async _call(A){return new gn(await super._call(A))}}class sn extends Mt{async _call(A){return new jn(await super._call(A))}}class xr extends Q{}class kn extends xr{}class zs extends xr{async _call(A){return new Cn(await super._call(A))}}class li extends xr{async _call(A){return new Dt(await super._call(A))}}class Bs extends xr{async _call(A){return new gn(await super._call(A))}}class Ui extends xr{async _call(A){return new jn(await super._call(A))}}class Xn extends Q{}class Gi extends Xn{}class xs extends Xn{async _call(A){return new Cn(await super._call(A))}}class ci extends Xn{async _call(A){return new Dt(await super._call(A))}}class Hi extends Xn{async _call(A){return new gn(await super._call(A))}}class Ki extends Xn{async _call(A){return new jn(await super._call(A))}}class Rr extends Q{}class Xi extends Rr{}class fn extends Rr{async _call(A){return new Dt(await super._call(A))}}class ui extends Rr{async _call(A){return new gn(await super._call(A))}}class Rn extends Rr{async _call(A){return new jn(await super._call(A))}}class Be extends Rr{async _call(A){return new Cn(await super._call(A))}}class it extends Q{}class _t extends it{}class nr extends it{async _call(A){return new Cn(await super._call(A))}}class Vs extends it{async _call(A){return new Dt(await super._call(A))}}class Ws extends it{async _call(A){return new gn(await super._call(A))}}class Gr extends Q{}class Us extends Gr{}class Hr extends Gr{async _call(A){return new Cn(await super._call(A))}}class Qr extends Gr{async _call(A){return new Dt(await super._call(A))}}class Gs extends Gr{async _call(A){return new jn(await super._call(A))}}class di extends Q{}class Qa extends di{}class Ja extends di{async _call(A){return new Cn(await super._call(A))}}class Za extends di{async _call(A){return new Dt(await super._call(A))}}class el extends di{async _call(A){return new gn(await super._call(A))}}class tl extends di{async _call(A){return new jn(await super._call(A))}}class qi extends Q{}class Yo extends qi{}class rl extends qi{async _call(A){return new Cn(await super._call(A))}}class nl extends qi{async _call(A){return new Dt(await super._call(A))}}class sl extends qi{async _call(A){return new jn(await super._call(A))}}class Yi extends Q{}class ve extends Yi{}class I extends Yi{async _call(A){return new Dt(await super._call(A))}}class Z extends Yi{async _call(A){return new jn(await super._call(A))}}class ie extends Yi{async _call(A){return new Cn(await super._call(A))}}class he extends Q{constructor(){super(...arguments);ce(this,"forward_params",["input_ids","attention_mask","encoder_outputs","decoder_input_ids","decoder_attention_mask","past_key_values"])}}class ye extends he{}class Ae extends he{}class He extends Q{}class rt extends He{}class Je extends He{}class ot extends Q{}class Et extends ot{}class Jt extends ot{}class qt extends Q{}class br extends qt{}class ar extends qt{}class Jr extends qt{async _call(A){return new Dt(await super._call(A))}}class on extends Q{}class pn extends on{}class mn extends on{}class Tr extends on{async _call(A){return new Dt(await super._call(A))}}class hi extends on{}class hr extends Q{}class Zr extends hr{}class An extends hr{}class bs extends Q{}class Ms extends bs{}class Mn extends bs{}class $n extends Q{}class an extends $n{}class Cr extends $n{async _call(A){return new Cn(await super._call(A))}}class Kr extends $n{async _call(A){return new Dt(await super._call(A))}}class Xr extends $n{async _call(A){return new gn(await super._call(A))}}class Tn extends $n{async _call(A){return new jn(await super._call(A))}}class Hs extends Q{}class il extends Hs{}class df extends Hs{async _call(A){return new Cn(await super._call(A))}}class hf extends Hs{async _call(A){return new Dt(await super._call(A))}}class ff extends Hs{async _call(A){return new gn(await super._call(A))}}class qu extends Hs{async _call(A){return new jn(await super._call(A))}}class Qo extends Q{}class pf extends Qo{}class mf extends Qo{async _call(A){return new Cn(await super._call(A))}}class gf extends Qo{async _call(A){return new Dt(await super._call(A))}}class _f extends Qo{async _call(A){return new gn(await super._call(A))}}class yf extends Qo{async _call(A){return new jn(await super._call(A))}}class Yu extends Q{}class vf extends Yu{}class wf extends Yu{}class Qu extends Q{constructor(){super(...arguments);ce(this,"requires_attention_mask",!1);ce(this,"main_input_name","input_features");ce(this,"forward_params",["input_features","attention_mask","decoder_input_ids","decoder_attention_mask","past_key_values"])}}class xf extends Qu{}class Ju extends Qu{_prepare_generation_config(A,B){return super._prepare_generation_config(A,B,_.WhisperGenerationConfig)}_retrieve_init_tokens(A){const B=[A.decoder_start_token_id];let ue=A.language;const be=A.task;if(A.is_multilingual){ue||(console.warn("No language specified - defaulting to English (en)."),ue="en");const De=`<|${(0,v.whisper_language_to_code)(ue)}|>`;B.push(A.lang_to_id[De]),B.push(A.task_to_id[be??"transcribe"])}else if(ue||be)throw new Error("Cannot specify `task` or `language` for an English-only model. If the model is intended to be multilingual, pass `is_multilingual=true` to generate, or update the generation config.");return!A.return_timestamps&&A.no_timestamps_token_id&&B.at(-1)!==A.no_timestamps_token_id?B.push(A.no_timestamps_token_id):A.return_timestamps&&B.at(-1)===A.no_timestamps_token_id&&(console.warn("<|notimestamps|> prompt token is removed from generation_config since `return_timestamps` is set to `true`."),B.pop()),B.filter(xe=>xe!=null)}async generate({inputs:A=null,generation_config:B=null,logits_processor:ue=null,stopping_criteria:be=null,...xe}){B=this._prepare_generation_config(B,xe);const De=xe.decoder_input_ids??this._retrieve_init_tokens(B);if(B.return_timestamps&&(ue??(ue=new u.LogitsProcessorList),ue.push(new u.WhisperTimeStampLogitsProcessor(B,De))),B.begin_suppress_tokens&&(ue??(ue=new u.LogitsProcessorList),ue.push(new u.SuppressTokensAtBeginLogitsProcessor(B.begin_suppress_tokens,De.length))),B.return_token_timestamps){if(!B.alignment_heads)throw new Error("Model generation config has no `alignment_heads`, token-level timestamps not available. See https://gist.github.com/hollance/42e32852f24243b748ae6bc1f985b13a on how to add this property to the generation config.");B.task==="translate"&&console.warn("Token-level timestamps may not be reliable for task 'translate'."),B.output_attentions=!0,B.return_dict_in_generate=!0}const Ue=await super.generate({inputs:A,generation_config:B,logits_processor:ue,decoder_input_ids:De,...xe});return B.return_token_timestamps&&(Ue.token_timestamps=this._extract_token_timestamps(Ue,B.alignment_heads,B.num_frames)),Ue}_extract_token_timestamps(A,B,ue=null,be=.02){if(!A.cross_attentions)throw new Error("Model outputs must contain cross attentions to extract timestamps. This is most likely because the model was not exported with `output_attentions=True`.");ue==null&&console.warn("`num_frames` has not been set, meaning the entire audio will be analyzed. This may lead to inaccurate token-level timestamps for short audios (< 30 seconds).");let xe=this.config.median_filter_width;xe===void 0&&(console.warn("Model config has no `median_filter_width`, using default value of 7."),xe=7);const De=A.cross_attentions,Ue=Array.from({length:this.config.decoder_layers},(Lt,mt)=>(0,h.cat)(De.map(Vt=>Vt[mt]),2)),Xe=(0,h.stack)(B.map(([Lt,mt])=>{if(Lt>=Ue.length)throw new Error(`Layer index ${Lt} is out of bounds for cross attentions (length ${Ue.length}).`);return ue?Ue[Lt].slice(null,mt,null,[0,ue]):Ue[Lt].slice(null,mt)})).transpose(1,0,2,3),[nt,Tt]=(0,h.std_mean)(Xe,-2,0,!0),kt=Xe.clone();for(let Lt=0;Lt<kt.dims[0];++Lt){const mt=kt[Lt];for(let Vt=0;Vt<mt.dims[0];++Vt){const gr=mt[Vt],Sr=nt[Lt][Vt][0].data,jr=Tt[Lt][Vt][0].data;for(let Or=0;Or<gr.dims[0];++Or){let en=gr[Or].data;for(let _n=0;_n<en.length;++_n)en[_n]=(en[_n]-jr[_n])/Sr[_n];en.set((0,p.medianFilter)(en,xe))}}}const bt=[(0,h.mean)(kt,1)],jt=A.sequences.dims,Pt=new h.Tensor("float32",new Float32Array(jt[0]*jt[1]),jt);for(let Lt=0;Lt<jt[0];++Lt){const mt=bt[Lt].neg().squeeze_(0),[Vt,gr]=(0,p.dynamic_time_warping)(mt.tolist()),Sr=Array.from({length:Vt.length-1},(en,_n)=>Vt[_n+1]-Vt[_n]),jr=(0,a.mergeArrays)([1],Sr).map(en=>!!en),Or=[];for(let en=0;en<jr.length;++en)jr[en]&&Or.push(gr[en]*be);Pt[Lt].data.set(Or,1)}return Pt}}class Zu extends Ju{}class lc extends Q{constructor(){super(...arguments);ce(this,"requires_attention_mask",!1);ce(this,"main_input_name","input_values");ce(this,"forward_params",["input_values","decoder_input_ids","past_key_values"])}}class bf extends lc{}class Mf extends lc{}class ed extends Q{constructor(){super(...arguments);ce(this,"main_input_name","pixel_values");ce(this,"forward_params",["pixel_values","decoder_input_ids","encoder_hidden_states","past_key_values"])}}class td extends Q{constructor(){super(...arguments);ce(this,"forward_params",["input_ids","attention_mask","pixel_values","position_ids","past_key_values"])}}class ol extends td{_merge_input_ids_with_image_features({inputs_embeds:A,image_features:B,input_ids:ue,attention_mask:be}){const xe=this.config.image_token_index,Ue=ue.tolist().map(bt=>bt.findIndex(jt=>jt==xe)),Xe=Ue.every(bt=>bt===-1),nt=Ue.every(bt=>bt!==-1);if(!Xe&&!nt)throw new Error("Every input should contain either 0 or 1 image token.");if(Xe)return{inputs_embeds:A,attention_mask:be};const Tt=[],kt=[];for(let bt=0;bt<Ue.length;++bt){const jt=Ue[bt],Pt=A[bt],Lt=B[bt],mt=be[bt];Tt.push((0,h.cat)([Pt.slice([0,jt]),Lt,Pt.slice([jt+1,Pt.dims[0]])],0)),kt.push((0,h.cat)([mt.slice([0,jt]),(0,h.ones)([Lt.dims[0]]),mt.slice([jt+1,mt.dims[0]])],0))}return{inputs_embeds:(0,h.stack)(Tt,0),attention_mask:(0,h.stack)(kt,0)}}}class Jo extends ol{}class Tf extends ol{}class rd extends Q{constructor(){super(...arguments);ce(this,"forward_params",["input_ids","inputs_embeds","attention_mask","pixel_values","encoder_outputs","decoder_input_ids","decoder_inputs_embeds","decoder_attention_mask","past_key_values"]);ce(this,"main_input_name","inputs_embeds")}}class Cf extends rd{_merge_input_ids_with_image_features({inputs_embeds:A,image_features:B,input_ids:ue,attention_mask:be}){return{inputs_embeds:(0,h.cat)([B,A],1),attention_mask:(0,h.cat)([(0,h.ones)(B.dims.slice(0,2)),be],1)}}async _prepare_inputs_embeds({input_ids:A,pixel_values:B,inputs_embeds:ue,attention_mask:be}){if(!A&&!B)throw new Error("Either `input_ids` or `pixel_values` should be provided.");let xe,De;return A&&(xe=await this.encode_text({input_ids:A})),B&&(De=await this.encode_image({pixel_values:B})),xe&&De?{inputs_embeds:ue,attention_mask:be}=this._merge_input_ids_with_image_features({inputs_embeds:xe,image_features:De,input_ids:A,attention_mask:be}):ue=xe||De,{inputs_embeds:ue,attention_mask:be}}async forward({input_ids:A,pixel_values:B,attention_mask:ue,decoder_input_ids:be,decoder_attention_mask:xe,encoder_outputs:De,past_key_values:Ue,inputs_embeds:Xe,decoder_inputs_embeds:nt}){if(Xe||({inputs_embeds:Xe,attention_mask:ue}=await this._prepare_inputs_embeds({input_ids:A,pixel_values:B,inputs_embeds:Xe,attention_mask:ue})),!De){let{last_hidden_state:bt}=await N(this,{inputs_embeds:Xe,attention_mask:ue});De=bt}if(!nt){if(!be)throw new Error("Either `decoder_input_ids` or `decoder_inputs_embeds` should be provided.");nt=await this.encode_text({input_ids:be})}return await te(this,{inputs_embeds:nt,attention_mask:xe,encoder_attention_mask:ue,encoder_hidden_states:De,past_key_values:Ue},!0)}}class Sf extends Q{constructor(){super(...arguments);ce(this,"forward_params",["input_ids","attention_mask","pixel_values","position_ids","past_key_values"])}}class Ef extends Sf{_merge_input_ids_with_image_features(A){const B=A.image_features.dims.at(-1),ue=A.image_features.view(-1,B);return O({image_token_id:this.config.image_token_index,...A,image_features:ue})}}class cc extends Q{constructor(){super(...arguments);ce(this,"forward_params",["input_ids","attention_mask","pixel_values","pixel_attention_mask","position_ids","past_key_values"])}}class al extends cc{async encode_image({pixel_values:A,pixel_attention_mask:B}){return(await L(this.sessions.vision_encoder,{pixel_values:A,pixel_attention_mask:B})).image_features}_merge_input_ids_with_image_features(A){const B=A.image_features.dims.at(-1),ue=A.image_features.view(-1,B);return O({image_token_id:this.config.image_token_id,...A,image_features:ue})}}class nd extends al{}class Pf extends Q{constructor(){super(...arguments);ce(this,"forward_params",["input_ids","inputs_embeds","attention_mask","position_ids","pixel_values","image_sizes","past_key_values"])}}class sd extends Pf{async forward({input_ids:A=null,attention_mask:B=null,pixel_values:ue=null,image_sizes:be=null,position_ids:xe=null,inputs_embeds:De=null,past_key_values:Ue=null,generation_config:Xe=null,logits_processor:nt=null,...Tt}){if(!De){let bt;if(ue&&A.dims[1]!==1){if(!be)throw new Error("`image_sizes` must be provided when `pixel_values` is provided.");({image_features:bt}=await L(this.sessions.vision_encoder,{pixel_values:ue,image_sizes:be}))}else{const jt=this.config.normalized_config.hidden_size;bt=new h.Tensor("float32",[],[0,jt])}({inputs_embeds:De}=await L(this.sessions.prepare_inputs_embeds,{input_ids:A,image_features:bt}))}return await te(this,{inputs_embeds:De,past_key_values:Ue,attention_mask:B,position_ids:xe,generation_config:Xe,logits_processor:nt},!1)}}class _o extends Q{}class kf extends _o{}class I_ extends _o{static async from_pretrained(A,B={}){return super.from_pretrained(A,{...B,model_file_name:B.model_file_name??"text_model"})}}class Af extends _o{static async from_pretrained(A,B={}){return super.from_pretrained(A,{...B,model_file_name:B.model_file_name??"text_model"})}}class F_ extends _o{static async from_pretrained(A,B={}){return super.from_pretrained(A,{...B,model_file_name:B.model_file_name??"vision_model"})}}class $f extends _o{static async from_pretrained(A,B={}){return super.from_pretrained(A,{...B,model_file_name:B.model_file_name??"vision_model"})}}class Zo extends Q{}class ea extends Zo{}class id extends Zo{static async from_pretrained(A,B={}){return super.from_pretrained(A,{...B,model_file_name:B.model_file_name??"text_model"})}}class Of extends _o{static async from_pretrained(A,B={}){return super.from_pretrained(A,{...B,model_file_name:B.model_file_name??"vision_model"})}}class Df extends Q{}class uc extends Df{}class ta extends Q{}class od extends ta{async forward(A){const B=!A.input_ids,ue=!A.pixel_values;if(B&&ue)throw new Error("Either `input_ids` or `pixel_values` should be provided.");if(B&&(A.input_ids=(0,h.ones)([A.pixel_values.dims[0],1])),ue){const{image_size:nt}=this.config.vision_config;A.pixel_values=(0,h.full)([0,3,nt,nt],0)}const{text_embeddings:be,image_embeddings:xe,l2norm_text_embeddings:De,l2norm_image_embeddings:Ue}=await super.forward(A),Xe={};return B||(Xe.text_embeddings=be,Xe.l2norm_text_embeddings=De),ue||(Xe.image_embeddings=xe,Xe.l2norm_image_embeddings=Ue),Xe}}class ad extends ta{static async from_pretrained(A,B={}){return super.from_pretrained(A,{...B,model_file_name:B.model_file_name??"text_model"})}}class ld extends ta{static async from_pretrained(A,B={}){return super.from_pretrained(A,{...B,model_file_name:B.model_file_name??"vision_model"})}}class dc extends Q{}class cd extends dc{}class ud extends dc{}class dd extends Q{}class hd extends dd{}class fd extends dd{}class ra extends Q{}class xt extends ra{}class If extends ra{}class hc extends Q{}class pd extends hc{}class ll extends hc{}class os extends Q{}class cl extends os{}class fc extends os{}class pc extends Q{}class md extends pc{}class gd extends pc{}class ul extends Q{}class _d extends ul{}class yd extends ul{}class mc extends Q{}class dl extends mc{}class gc extends mc{}class hl extends Q{}class vd extends hl{}class wd extends hl{}class _c extends Q{}class xd extends _c{}class bd extends _c{}class yc extends Q{}class b extends yc{}class P extends yc{}class F extends Q{}class U extends F{}class ee extends F{}class me extends Q{}class Oe extends me{}class Ge extends me{}class tt extends Q{}class ut extends tt{}class At extends tt{}class Ut extends Q{}class lr extends Ut{}class ln extends Ut{}class Qi extends Q{}class Ff extends Qi{}class pM extends Qi{}class L_ extends Q{}class mM extends L_{}class gM extends L_{}class R_ extends Q{}class _M extends R_{}class yM extends R_{}class j_ extends Q{}class vM extends j_{}class wM extends j_{}class N_ extends Q{}class xM extends N_{}class bM extends N_{}class z_ extends Q{}class MM extends z_{}class TM extends z_{}class B_ extends Q{}class CM extends B_{}class SM extends B_{}class V_ extends Q{}class EM extends V_{}class PM extends V_{}class kM extends Q{constructor(){super(...arguments);ce(this,"forward_params",["input_ids","attention_mask","position_ids","past_key_values","pixel_values","image_grid_thw"])}}class AM extends kM{get_rope_index(A,B,ue,be){const{vision_config:xe,image_token_id:De,video_token_id:Ue,vision_start_token_id:Xe}=this.config,nt=xe.spatial_merge_size??2,Tt=[];if(B||ue){let kt=A.tolist();be||(be=(0,h.ones_like)(A));const bt=be.tolist(),jt=Array.from({length:3},gr=>Array.from({length:A.dims[0]},Sr=>Array.from({length:A.dims[1]},jr=>1))),Pt=B?B.tolist():[],Lt=ue?ue.tolist():[];let mt=0,Vt=0;for(let gr=0;gr<kt.length;++gr){const Sr=kt[gr].filter((Er,un)=>bt[gr][un]==1),Or=Sr.reduce((Er,un,sa)=>(un==Xe&&Er.push(sa),Er),[]).map(Er=>Sr[Er+1]),en=Or.filter(Er=>Er==De).length,_n=Or.filter(Er=>Er==Ue).length;let Nt=[],cn=0,Ts=en,pl=_n;for(let Er=0;Er<Or.length;++Er){const un=Sr.findIndex((_l,fi)=>fi>cn&&_l==De),sa=Sr.findIndex((_l,fi)=>fi>cn&&_l==Ue),gl=Ts>0&&un!==-1?un:Sr.length+1,xc=pl>0&&sa!==-1?sa:Sr.length+1;let ep,B0,V0,W0;gl<xc?([B0,V0,W0]=Pt[mt],++mt,--Ts,ep=gl):([B0,V0,W0]=Lt[Vt],++Vt,--pl,ep=xc);const[HV,U0,tp]=[Number(B0),Math.floor(Number(V0)/nt),Math.floor(Number(W0)/nt)],G0=ep-cn,dP=Nt.length>0?(0,p.max)(Nt.at(-1))[0]+1:0;Nt.push(Array.from({length:3*G0},(_l,fi)=>dP+fi%G0));const H0=G0+dP,rp=HV*U0*tp,KV=Array.from({length:rp},(_l,fi)=>H0+Math.floor(fi/(U0*tp))),XV=Array.from({length:rp},(_l,fi)=>H0+Math.floor(fi/tp)%U0),qV=Array.from({length:rp},(_l,fi)=>H0+fi%tp);Nt.push([KV,XV,qV].flat()),cn=ep+rp}if(cn<Sr.length){const Er=Nt.length>0?(0,p.max)(Nt.at(-1))[0]+1:0,un=Sr.length-cn;Nt.push(Array.from({length:3*un},(sa,gl)=>Er+gl%un))}const qn=Nt.reduce((Er,un)=>Er+un.length,0),Ks=new Array(qn);let Qf=0;for(let Er=0;Er<3;++Er)for(let un=0;un<Nt.length;++un){const sa=Nt[un],gl=sa.length/3;for(let xc=Er*gl;xc<(Er+1)*gl;++xc)Ks[Qf++]=sa[xc]}let ml=0;const Jf=bt[gr];for(let Er=0;Er<Jf.length;++Er)if(Jf[Er]==1){for(let un=0;un<3;++un)jt[un][gr][Er]=Ks[un*qn/3+ml];++ml}const Zf=(0,p.max)(Ks)[0];Tt.push(Zf+1-kt[gr].length)}return[new h.Tensor("int64",jt.flat(1/0),[3,A.dims[0],A.dims[1]]),new h.Tensor("int64",Tt,[Tt.length,1])]}else if(be){const{data:kt,dims:bt}=pe(be),jt=BigInt64Array.from({length:3*kt.length},(Lt,mt)=>kt[mt%kt.length]),Pt=Array.from({length:bt[0]},(Lt,mt)=>(0,p.max)(kt.subarray(bt[1]*mt,bt[1]*(mt+1)))[0]+1n+BigInt(bt[1]));return[new h.Tensor("int64",jt,[3,...bt]),new h.Tensor("int64",Pt,[Pt.length,1])]}else{const[kt,bt]=A.dims,jt=BigInt64Array.from({length:3*kt*bt},(Pt,Lt)=>BigInt(Math.floor(Lt%bt/kt)));return[new h.Tensor("int64",jt,[3,...A.dims]),(0,h.zeros)([kt,1])]}}async encode_image({pixel_values:A,image_grid_thw:B}){return(await L(this.sessions.vision_encoder,{pixel_values:A,grid_thw:B})).image_features}_merge_input_ids_with_image_features(A){return O({image_token_id:this.config.image_token_id,...A})}prepare_inputs_for_generation(A,B,ue){if(B.attention_mask&&!B.position_ids)if(!B.past_key_values)[B.position_ids,B.rope_deltas]=this.get_rope_index(B.input_ids,B.image_grid_thw,B.video_grid_thw,B.attention_mask);else{B.pixel_values=null;const be=BigInt(Object.values(B.past_key_values)[0].dims.at(-2)),xe=B.rope_deltas.map(De=>be+De);B.position_ids=(0,h.stack)([xe,xe,xe],0)}return B}}class W_ extends Q{}class $M extends W_{}class OM extends W_{}class U_ extends Q{}class DM extends U_{}class IM extends U_{}class G_ extends Q{}class FM extends G_{}class LM extends G_{}class H_ extends Q{}class RM extends H_{}class jM extends H_{}class K_ extends Q{}class NM extends K_{}class zM extends K_{}class X_ extends Q{}class BM extends X_{}class VM extends X_{async _call(A){return new Dt(await super._call(A))}}class q_ extends Q{}class WM extends q_{}class UM extends q_{async _call(A){return new Dt(await super._call(A))}}class GM extends Q{}class HM extends GM{}class Y_ extends Q{}class KM extends Y_{}class XM extends Y_{async _call(A){return new Dt(await super._call(A))}}class qM extends Q{}class YM extends qM{}class Q_ extends Q{}class QM extends Q_{}class JM extends Q_{async _call(A){return new Dt(await super._call(A))}}class ZM extends Q{}class eT extends ZM{}class J_ extends Q{}class tT extends J_{}class rT extends J_{async _call(A){return new Dt(await super._call(A))}}class nT extends Q{}class sT extends nT{async _call(A){return new cP(await super._call(A))}}class Z_ extends Q{}class iT extends Z_{}class oT extends Z_{async _call(A){return new Dt(await super._call(A))}}class e0 extends Q{}class aT extends e0{}class lT extends e0{async _call(A){return new Dt(await super._call(A))}}class t0 extends Q{}class cT extends t0{}class uT extends t0{}class r0 extends Q{}class dT extends r0{}class hT extends r0{}class n0 extends Q{}class fT extends n0{}class pT extends n0{async _call(A){return new Dt(await super._call(A))}}class Lf extends Q{}class mT extends Lf{}class gT extends Lf{async _call(A){return new i0(await super._call(A))}}class s0 extends Lf{async _call(A){return new _T(await super._call(A))}}class i0 extends Me{constructor({logits:A,pred_boxes:B}){super(),this.logits=A,this.pred_boxes=B}}class _T extends Me{constructor({logits:A,pred_boxes:B,pred_masks:ue}){super(),this.logits=A,this.pred_boxes=B,this.pred_masks=ue}}class o0 extends Q{}class yT extends o0{}class vT extends o0{async _call(A){return new Md(await super._call(A))}}class Md extends Me{constructor({logits:A,pred_boxes:B}){super(),this.logits=A,this.pred_boxes=B}}class a0 extends Q{}class wT extends a0{}class xT extends a0{async _call(A){return new bT(await super._call(A))}}class bT extends Md{}class l0 extends Q{}class MT extends l0{}class TT extends l0{async _call(A){return new CT(await super._call(A))}}class CT extends Md{}class c0 extends Q{}class ST extends c0{}class ET extends c0{async _call(A){return new Md(await super._call(A))}}class u0 extends Q{}class PT extends u0{}class kT extends u0{async _call(A){return new AT(await super._call(A))}}class AT extends i0{}class d0 extends Q{}class $T extends d0{}class OT extends d0{async _call(A){return new Dt(await super._call(A))}}class h0 extends Q{}class DT extends h0{}class IT extends h0{async _call(A){return new Dt(await super._call(A))}}class f0 extends Q{}class FT extends f0{}class LT extends f0{async _call(A){return new Dt(await super._call(A))}}class Rf extends Q{}class RT extends Rf{}class jT extends Rf{async _call(A){return new Dt(await super._call(A))}}class NT extends Rf{}class p0 extends Q{}class zT extends p0{}class BT extends p0{}class m0 extends Q{}class VT extends m0{}class WT extends m0{}class UT extends Q{}class GT extends UT{}class jf extends Q{}class HT extends jf{}class KT extends jf{}class XT extends jf{}class qT extends Q{}class YT extends qT{}class QT extends Q{}class JT extends QT{}class ZT extends Q{}class eC extends ZT{}class g0 extends Q{}class tC extends g0{}class rC extends g0{}class _0 extends Q{}class nC extends _0{}class sC extends _0{}class iC extends Q{}class oC extends iC{}class y0 extends Q{}class aC extends y0{}class lC extends y0{async _call(A){return new Dt(await super._call(A))}}class v0 extends Q{}class cC extends v0{}class uC extends v0{async _call(A){return new Dt(await super._call(A))}}class w0 extends Q{}class dC extends w0{}class hC extends w0{async _call(A){return new Dt(await super._call(A))}}class x0 extends Q{}class fC extends x0{}class pC extends x0{async _call(A){return new Dt(await super._call(A))}}class mC extends Q{}class gC extends mC{}class b0 extends Q{}class _C extends b0{}class yC extends b0{async _call(A){return new vC(await super._call(A))}}class vC extends Me{constructor({logits:A,pred_boxes:B}){super(),this.logits=A,this.pred_boxes=B}}class wC extends Q{}class xC extends wC{async get_image_embeddings({pixel_values:A}){return await N(this,{pixel_values:A})}async forward(A){if((!A.image_embeddings||!A.image_positional_embeddings)&&(A={...A,...await this.get_image_embeddings(A)}),!A.input_labels&&A.input_points){const ue=A.input_points.dims.slice(0,-1),be=ue.reduce((xe,De)=>xe*De,1);A.input_labels=new h.Tensor("int64",new BigInt64Array(be).fill(1n),ue)}const B={image_embeddings:A.image_embeddings,image_positional_embeddings:A.image_positional_embeddings};return A.input_points&&(B.input_points=A.input_points),A.input_labels&&(B.input_labels=A.input_labels),A.input_boxes&&(B.input_boxes=A.input_boxes),await L(this.sessions.prompt_encoder_mask_decoder,B)}async _call(A){return new bC(await super._call(A))}}class bC extends Me{constructor({iou_scores:A,pred_masks:B}){super(),this.iou_scores=A,this.pred_masks=B}}class M0 extends Q{}class MC extends M0{}class TC extends M0{}class T0 extends Q{}class CC extends T0{}class SC extends T0{}class na extends Q{}class EC extends na{}class PC extends na{async _call(A){return new fl(await super._call(A))}}class kC extends na{async _call(A){return new Dt(await super._call(A))}}class AC extends na{async _call(A){return new gn(await super._call(A))}}class C0 extends Q{}class $C extends C0{}class OC extends C0{async _call(A){return new gn(await super._call(A))}}class DC extends Q{}class IC extends DC{}class Nf extends Q{}class FC extends Nf{}class LC extends Nf{async _call(A){return new fl(await super._call(A))}}class RC extends Nf{async _call(A){return new Dt(await super._call(A))}}class Td extends Q{}class jC extends Td{}class NC extends Td{async _call(A){return new fl(await super._call(A))}}class zC extends Td{async _call(A){return new Dt(await super._call(A))}}class BC extends Td{async _call(A){return new gn(await super._call(A))}}class zf extends Q{}class VC extends zf{}class WC extends zf{async _call(A){return new fl(await super._call(A))}}class UC extends zf{async _call(A){return new Dt(await super._call(A))}}class $V extends Q{}class GC extends na{}class HC extends na{async _call(A){return new fl(await super._call(A))}}class KC extends na{async _call(A){return new Dt(await super._call(A))}}class vc extends Q{}class XC extends vc{}class qC extends vc{async _call(A){return new fl(await super._call(A))}}class YC extends vc{async _call(A){return new Dt(await super._call(A))}}class QC extends vc{async _call(A){return new lP(await super._call(A))}}class JC extends vc{async _call(A){return new gn(await super._call(A))}}class ZC extends Q{}class eS extends ZC{}class Bf extends Q{}class OV extends Bf{}class tS extends Bf{}class rS extends Bf{async generate_speech(A,B,{threshold:ue=.5,minlenratio:be=0,maxlenratio:xe=20,vocoder:De=null}={}){const Ue={input_ids:A},{encoder_outputs:Xe,encoder_attention_mask:nt}=await N(this,Ue),Tt=Xe.dims[1]/this.config.reduction_factor,kt=Math.floor(Tt*xe),bt=Math.floor(Tt*be),jt=this.config.num_mel_bins;let Pt=[],Lt=null,mt=null,Vt=0;for(;;){++Vt;const jr=Y(!!mt);let Or;mt?Or=mt.output_sequence_out:Or=new h.Tensor("float32",new Float32Array(jt),[1,1,jt]);let en={use_cache_branch:jr,output_sequence:Or,encoder_attention_mask:nt,speaker_embeddings:B,encoder_hidden_states:Xe};this.addPastKeyValues(en,Lt),mt=await L(this.sessions.decoder_model_merged,en),Lt=this.getPastKeyValues(mt,Lt);const{prob:_n,spectrum:Nt}=mt;if(Pt.push(Nt),Vt>=bt&&(Array.from(_n.data).filter(cn=>cn>=ue).length>0||Vt>=kt))break}const gr=(0,h.cat)(Pt),{waveform:Sr}=await L(De.sessions.model,{spectrogram:gr});return{spectrogram:gr,waveform:Sr}}}class nS extends Q{constructor(){super(...arguments);ce(this,"main_input_name","spectrogram")}}class sS extends Q{}class iS extends sS{}class S0 extends Q{}class oS extends S0{}class aS extends S0{}class E0 extends Q{}class lS extends E0{}class cS extends E0{}class P0 extends Q{}class uS extends P0{}class dS extends P0{}class Vf extends Q{}class hS extends Vf{}class fS extends Vf{static async from_pretrained(A,B={}){return super.from_pretrained(A,{...B,model_file_name:B.model_file_name??"text_model"})}}class pS extends Vf{static async from_pretrained(A,B={}){return super.from_pretrained(A,{...B,model_file_name:B.model_file_name??"audio_model"})}}class mS extends Q{}class k0 extends mS{async _call(A){return new uP(await super._call(A))}}class Wf extends Q{}class DV extends Wf{}class gS extends Wf{}class _S extends Wf{}class A0 extends Q{}class yS extends A0{}class vS extends A0{}class $0 extends Q{}class wS extends $0{}class xS extends $0{async _call(A){return new Dt(await super._call(A))}}class O0 extends Q{}class IV extends O0{}class FV extends O0{}class D0 extends Q{constructor(){super(...arguments);ce(this,"forward_params",["input_ids","attention_mask","encoder_outputs","decoder_input_ids","decoder_attention_mask","past_key_values"])}_apply_and_filter_by_delay_pattern_mask(B){const[ue,be]=B.dims,xe=this.config.decoder.num_codebooks,De=be-xe;let Ue=0;for(let Tt=0;Tt<B.size;++Tt){if(B.data[Tt]===this.config.decoder.pad_token_id)continue;const kt=Tt%be,bt=Math.floor(Tt/be)%xe,jt=kt-bt;jt>0&&jt<=De&&(B.data[Ue++]=B.data[Tt])}const Xe=Math.floor(ue/xe),nt=Ue/(Xe*xe);return new h.Tensor(B.type,B.data.slice(0,Ue),[Xe,xe,nt])}prepare_inputs_for_generation(B,ue,be){let xe=structuredClone(B);for(let Ue=0;Ue<xe.length;++Ue)for(let Xe=0;Xe<xe[Ue].length;++Xe)Ue%this.config.decoder.num_codebooks>=Xe&&(xe[Ue][Xe]=BigInt(this.config.decoder.pad_token_id));return be.guidance_scale!==null&&be.guidance_scale>1&&(xe=xe.concat(xe)),super.prepare_inputs_for_generation(xe,ue,be)}async generate(B){const ue=await super.generate(B),be=this._apply_and_filter_by_delay_pattern_mask(ue).unsqueeze_(0),{audio_values:xe}=await L(this.sessions.encodec_decode,{audio_codes:be});return xe}}class Uf extends Q{}class bS extends Uf{}class MS extends Uf{async _call(A){return new Dt(await super._call(A))}}class TS extends Uf{}class Gf extends Q{}class CS extends Gf{}class SS extends Gf{async _call(A){return new Dt(await super._call(A))}}class ES extends Gf{}class Hf extends Q{}class PS extends Hf{}class kS extends Hf{async _call(A){return new Dt(await super._call(A))}}class AS extends Hf{}class Kf extends Q{}class $S extends Kf{}class OS extends Kf{async _call(A){return new Dt(await super._call(A))}}class DS extends Kf{}class IS extends Q{}class FS extends IS{}class LS extends Q{}class RS extends LS{constructor(...B){super(...B);ce(this,"forward_params",["input_ids","pixel_values","images_seq_mask","images_emb_mask","attention_mask","position_ids","past_key_values"]);this._generation_mode="text"}async forward(B){const ue=this._generation_mode??"text";let be;if(ue==="text"||!B.past_key_values){const nt=this.sessions.prepare_inputs_embeds,Tt=(0,a.pick)(B,nt.inputNames);be=await L(nt,Tt)}else{const nt=this.sessions.gen_img_embeds,Tt=(0,a.pick)({image_ids:B.input_ids},nt.inputNames);be=await L(nt,Tt)}const xe={...B,...be},De=await te(this,xe),Ue=this.sessions[ue==="text"?"lm_head":"gen_head"];if(!Ue)throw new Error(`Unable to find "${Ue}" generation head`);const Xe=await L(Ue,(0,a.pick)(De,Ue.inputNames));return{...be,...De,...Xe}}async generate(B){return this._generation_mode="text",super.generate(B)}async generate_images(B){this._generation_mode="image";const ue=(B.inputs??B[this.main_input_name]).dims[1],xe=(await super.generate(B)).slice(null,[ue,null]),De=this.sessions.image_decode,{decoded_image:Ue}=await L(De,{generated_tokens:xe}),Xe=Ue.add_(1).mul_(255/2).clamp_(0,255).to("uint8"),nt=[];for(const Tt of Xe){const kt=f.RawImage.fromTensor(Tt);nt.push(kt)}return nt}}class jS extends Me{constructor({char_logits:A,bpe_logits:B,wp_logits:ue}){super(),this.char_logits=A,this.bpe_logits=B,this.wp_logits=ue}get logits(){return[this.char_logits,this.bpe_logits,this.wp_logits]}}class NS extends Q{}class zS extends NS{async _call(A){return new jS(await super._call(A))}}class I0 extends Q{}class BS extends I0{}class VS extends I0{}class F0 extends Q{}class WS extends F0{}class US extends F0{}class GS extends Q{constructor(){super(...arguments);ce(this,"forward_params",["input_ids","attention_mask","position_ids","audio_values","past_key_values"])}}class HS extends GS{_merge_input_ids_with_audio_features(A){const B=A.audio_features.dims.at(-1),ue=A.audio_features.view(-1,B);return H({audio_token_id:this.config.ignore_index,...A,audio_features:ue})}}class Xf extends Q{constructor(){super(...arguments);ce(this,"main_input_name","input_values");ce(this,"forward_params",["input_values"])}}class KS extends Me{constructor({audio_codes:A}){super(),this.audio_codes=A}}class XS extends Me{constructor({audio_values:A}){super(),this.audio_values=A}}class qS extends Xf{async encode(A){return new KS(await L(this.sessions.encoder_model,A))}async decode(A){return new XS(await L(this.sessions.decoder_model,A))}}class YS extends Xf{static async from_pretrained(A,B={}){return super.from_pretrained(A,{...B,model_file_name:B.model_file_name??"encoder_model"})}}class QS extends Xf{static async from_pretrained(A,B={}){return super.from_pretrained(A,{...B,model_file_name:B.model_file_name??"decoder_model"})}}class qf extends Q{constructor(){super(...arguments);ce(this,"main_input_name","input_values");ce(this,"forward_params",["input_values"])}}class JS extends Me{constructor({audio_codes:A}){super(),this.audio_codes=A}}class ZS extends Me{constructor({audio_values:A}){super(),this.audio_values=A}}class eE extends qf{async encode(A){return new JS(await L(this.sessions.encoder_model,A))}async decode(A){return new ZS(await L(this.sessions.decoder_model,A))}}class tE extends qf{static async from_pretrained(A,B={}){return super.from_pretrained(A,{...B,model_file_name:B.model_file_name??"encoder_model"})}}class rE extends qf{static async from_pretrained(A,B={}){return super.from_pretrained(A,{...B,model_file_name:B.model_file_name??"decoder_model"})}}class Yf extends Q{constructor(){super(...arguments);ce(this,"main_input_name","input_values");ce(this,"forward_params",["input_values"])}}class nE extends Yf{async encode(A){return await L(this.sessions.encoder_model,A)}async decode(A){return await L(this.sessions.decoder_model,A)}}class sE extends Yf{static async from_pretrained(A,B={}){return super.from_pretrained(A,{...B,model_file_name:B.model_file_name??"encoder_model"})}}class iE extends Yf{static async from_pretrained(A,B={}){return super.from_pretrained(A,{...B,model_file_name:B.model_file_name??"decoder_model"})}}class Zt{static async from_pretrained(A,{progress_callback:B=null,config:ue=null,cache_dir:be=null,local_files_only:xe=!1,revision:De="main",model_file_name:Ue=null,subfolder:Xe="onnx",device:nt=null,dtype:Tt=null,use_external_data_format:kt=null,session_options:bt={}}={}){const jt={progress_callback:B,config:ue,cache_dir:be,local_files_only:xe,revision:De,model_file_name:Ue,subfolder:Xe,device:nt,dtype:Tt,use_external_data_format:kt,session_options:bt};if(jt.config=await n.AutoConfig.from_pretrained(A,jt),!this.MODEL_CLASS_MAPPINGS)throw new Error("`MODEL_CLASS_MAPPINGS` not implemented for this type of `AutoClass`: "+this.name);const Pt=jt.config.model_type;for(const Lt of this.MODEL_CLASS_MAPPINGS){let mt=Lt.get(Pt);if(!mt){for(const Vt of Lt.values())if(Vt[0]===Pt){mt=Vt;break}if(!mt)continue}return await mt[1].from_pretrained(A,jt)}if(this.BASE_IF_FAIL)return $E.has(Pt)||console.warn(`Unknown model class "${Pt}", attempting to construct from base class.`),await Q.from_pretrained(A,jt);throw Error(`Unsupported model type: ${Pt}`)}}ce(Zt,"MODEL_CLASS_MAPPINGS",null),ce(Zt,"BASE_IF_FAIL",!1);const LV=new Map([["bert",["BertModel",Pe]],["modernbert",["ModernBertModel",Re]],["nomic_bert",["NomicBertModel",Qe]],["roformer",["RoFormerModel",yt]],["electra",["ElectraModel",we]],["esm",["EsmModel",_t]],["convbert",["ConvBertModel",Ct]],["camembert",["CamembertModel",vt]],["deberta",["DebertaModel",kn]],["deberta-v2",["DebertaV2Model",Gi]],["mpnet",["MPNetModel",Qa]],["albert",["AlbertModel",ve]],["distilbert",["DistilBertModel",Xi]],["roberta",["RobertaModel",an]],["xlm",["XLMModel",il]],["xlm-roberta",["XLMRobertaModel",pf]],["clap",["ClapModel",hS]],["clip",["CLIPModel",kf]],["clipseg",["CLIPSegModel",cd]],["chinese_clip",["ChineseCLIPModel",uc]],["siglip",["SiglipModel",ea]],["jina_clip",["JinaCLIPModel",od]],["mobilebert",["MobileBertModel",Us]],["squeezebert",["SqueezeBertModel",Yo]],["wav2vec2",["Wav2Vec2Model",EC]],["wav2vec2-bert",["Wav2Vec2BertModel",VC]],["unispeech",["UniSpeechModel",FC]],["unispeech-sat",["UniSpeechSatModel",jC]],["hubert",["HubertModel",GC]],["wavlm",["WavLMModel",XC]],["audio-spectrogram-transformer",["ASTModel",vf]],["vits",["VitsModel",k0]],["pyannote",["PyAnnoteModel",$C]],["wespeaker-resnet",["WeSpeakerResNetModel",IC]],["detr",["DetrModel",mT]],["rt_detr",["RTDetrModel",yT]],["rt_detr_v2",["RTDetrV2Model",wT]],["rf_detr",["RFDetrModel",MT]],["d_fine",["DFineModel",ST]],["table-transformer",["TableTransformerModel",PT]],["vit",["ViTModel",BM]],["ijepa",["IJepaModel",WM]],["pvt",["PvtModel",KM]],["vit_msn",["ViTMSNModel",QM]],["vit_mae",["ViTMAEModel",YM]],["groupvit",["GroupViTModel",eT]],["fastvit",["FastViTModel",tT]],["mobilevit",["MobileViTModel",iT]],["mobilevitv2",["MobileViTV2Model",aT]],["owlvit",["OwlViTModel",cT]],["owlv2",["Owlv2Model",dT]],["beit",["BeitModel",fT]],["deit",["DeiTModel",$T]],["hiera",["HieraModel",DT]],["convnext",["ConvNextModel",aC]],["convnextv2",["ConvNextV2Model",cC]],["dinov2",["Dinov2Model",dC]],["dinov2_with_registers",["Dinov2WithRegistersModel",fC]],["resnet",["ResNetModel",FT]],["swin",["SwinModel",RT]],["swin2sr",["Swin2SRModel",zT]],["donut-swin",["DonutSwinModel",oC]],["yolos",["YolosModel",_C]],["dpt",["DPTModel",VT]],["glpn",["GLPNModel",nC]],["hifigan",["SpeechT5HifiGan",nS]],["efficientnet",["EfficientNetModel",wS]],["decision_transformer",["DecisionTransformerModel",FS]],["patchtst",["PatchTSTForPrediction",BS]],["patchtsmixer",["PatchTSMixerForPrediction",WS]],["mobilenet_v1",["MobileNetV1Model",bS]],["mobilenet_v2",["MobileNetV2Model",CS]],["mobilenet_v3",["MobileNetV3Model",PS]],["mobilenet_v4",["MobileNetV4Model",$S]],["maskformer",["MaskFormerModel",tC]],["mgp-str",["MgpstrForSceneTextRecognition",zS]],["style_text_to_speech_2",["StyleTextToSpeech2Model",eS]]]),RV=new Map([["t5",["T5Model",ye]],["longt5",["LongT5Model",rt]],["mt5",["MT5Model",Et]],["bart",["BartModel",br]],["mbart",["MBartModel",pn]],["marian",["MarianModel",MC]],["whisper",["WhisperModel",xf]],["m2m_100",["M2M100Model",CC]],["blenderbot",["BlenderbotModel",Zr]],["blenderbot-small",["BlenderbotSmallModel",Ms]]]),jV=new Map([["mimi",["MimiModel",qS]],["dac",["DacModel",eE]],["snac",["SnacModel",nE]]]),NV=new Map([["bloom",["BloomModel",FM]],["jais",["JAISModel",xt]],["gpt2",["GPT2Model",hd]],["gptj",["GPTJModel",md]],["gpt_bigcode",["GPTBigCodeModel",_d]],["gpt_neo",["GPTNeoModel",pd]],["gpt_neox",["GPTNeoXModel",cl]],["codegen",["CodeGenModel",dl]],["llama",["LlamaModel",vd]],["exaone",["ExaoneModel",U]],["olmo",["OlmoModel",ut]],["olmo2",["Olmo2Model",lr]],["mobilellm",["MobileLLMModel",Oe]],["granite",["GraniteModel",Ff]],["cohere",["CohereModel",mM]],["gemma",["GemmaModel",_M]],["gemma2",["Gemma2Model",vM]],["gemma3_text",["Gemma3Model",xM]],["helium",["HeliumModel",xd]],["glm",["GlmModel",b]],["openelm",["OpenELMModel",MM]],["qwen2",["Qwen2Model",CM]],["qwen3",["Qwen3Model",EM]],["phi",["PhiModel",$M]],["phi3",["Phi3Model",DM]],["mpt",["MptModel",RM]],["opt",["OPTModel",NM]],["mistral",["MistralModel",oS]],["starcoder2",["Starcoder2Model",lS]],["falcon",["FalconModel",uS]],["stablelm",["StableLmModel",yS]]]),L0=new Map([["speecht5",["SpeechT5ForSpeechToText",tS]],["whisper",["WhisperForConditionalGeneration",Ju]],["lite-whisper",["LiteWhisperForConditionalGeneration",Zu]],["moonshine",["MoonshineForConditionalGeneration",Mf]]]),oE=new Map([["speecht5",["SpeechT5ForTextToSpeech",rS]]]),aE=new Map([["vits",["VitsModel",k0]],["musicgen",["MusicgenForConditionalGeneration",D0]]]),lE=new Map([["bert",["BertForSequenceClassification",Le]],["modernbert",["ModernBertForSequenceClassification",at]],["roformer",["RoFormerForSequenceClassification",Yt]],["electra",["ElectraForSequenceClassification",Ee]],["esm",["EsmForSequenceClassification",Vs]],["convbert",["ConvBertForSequenceClassification",R]],["camembert",["CamembertForSequenceClassification",rr]],["deberta",["DebertaForSequenceClassification",li]],["deberta-v2",["DebertaV2ForSequenceClassification",ci]],["mpnet",["MPNetForSequenceClassification",Za]],["albert",["AlbertForSequenceClassification",I]],["distilbert",["DistilBertForSequenceClassification",fn]],["roberta",["RobertaForSequenceClassification",Kr]],["xlm",["XLMForSequenceClassification",hf]],["xlm-roberta",["XLMRobertaForSequenceClassification",gf]],["bart",["BartForSequenceClassification",Jr]],["mbart",["MBartForSequenceClassification",Tr]],["mobilebert",["MobileBertForSequenceClassification",Qr]],["squeezebert",["SqueezeBertForSequenceClassification",nl]]]),cE=new Map([["bert",["BertForTokenClassification",We]],["modernbert",["ModernBertForTokenClassification",ct]],["roformer",["RoFormerForTokenClassification",Xt]],["electra",["ElectraForTokenClassification",Ot]],["esm",["EsmForTokenClassification",Ws]],["convbert",["ConvBertForTokenClassification",le]],["camembert",["CamembertForTokenClassification",mr]],["deberta",["DebertaForTokenClassification",Bs]],["deberta-v2",["DebertaV2ForTokenClassification",Hi]],["mpnet",["MPNetForTokenClassification",el]],["distilbert",["DistilBertForTokenClassification",ui]],["roberta",["RobertaForTokenClassification",Xr]],["xlm",["XLMForTokenClassification",ff]],["xlm-roberta",["XLMRobertaForTokenClassification",_f]]]),R0=new Map([["t5",["T5ForConditionalGeneration",Ae]],["longt5",["LongT5ForConditionalGeneration",Je]],["mt5",["MT5ForConditionalGeneration",Jt]],["bart",["BartForConditionalGeneration",ar]],["mbart",["MBartForConditionalGeneration",mn]],["marian",["MarianMTModel",TC]],["m2m_100",["M2M100ForConditionalGeneration",SC]],["blenderbot",["BlenderbotForConditionalGeneration",An]],["blenderbot-small",["BlenderbotSmallForConditionalGeneration",Mn]]]),j0=new Map([["bloom",["BloomForCausalLM",LM]],["gpt2",["GPT2LMHeadModel",fd]],["jais",["JAISLMHeadModel",If]],["gptj",["GPTJForCausalLM",gd]],["gpt_bigcode",["GPTBigCodeForCausalLM",yd]],["gpt_neo",["GPTNeoForCausalLM",ll]],["gpt_neox",["GPTNeoXForCausalLM",fc]],["codegen",["CodeGenForCausalLM",gc]],["llama",["LlamaForCausalLM",wd]],["exaone",["ExaoneForCausalLM",ee]],["olmo",["OlmoForCausalLM",At]],["olmo2",["Olmo2ForCausalLM",ln]],["mobilellm",["MobileLLMForCausalLM",Ge]],["granite",["GraniteForCausalLM",pM]],["cohere",["CohereForCausalLM",gM]],["gemma",["GemmaForCausalLM",yM]],["gemma2",["Gemma2ForCausalLM",wM]],["gemma3_text",["Gemma3ForCausalLM",bM]],["helium",["HeliumForCausalLM",bd]],["glm",["GlmForCausalLM",P]],["openelm",["OpenELMForCausalLM",TM]],["qwen2",["Qwen2ForCausalLM",SM]],["qwen3",["Qwen3ForCausalLM",PM]],["phi",["PhiForCausalLM",OM]],["phi3",["Phi3ForCausalLM",IM]],["mpt",["MptForCausalLM",jM]],["opt",["OPTForCausalLM",zM]],["mbart",["MBartForCausalLM",hi]],["mistral",["MistralForCausalLM",aS]],["starcoder2",["Starcoder2ForCausalLM",cS]],["falcon",["FalconForCausalLM",dS]],["trocr",["TrOCRForCausalLM",iS]],["stablelm",["StableLmForCausalLM",vS]],["phi3_v",["Phi3VForCausalLM",sd]]]),zV=new Map([["multi_modality",["MultiModalityCausalLM",RS]]]),uE=new Map([["bert",["BertForMaskedLM",Fe]],["modernbert",["ModernBertForMaskedLM",qe]],["roformer",["RoFormerForMaskedLM",Rt]],["electra",["ElectraForMaskedLM",ze]],["esm",["EsmForMaskedLM",nr]],["convbert",["ConvBertForMaskedLM",is]],["camembert",["CamembertForMaskedLM",ft]],["deberta",["DebertaForMaskedLM",zs]],["deberta-v2",["DebertaV2ForMaskedLM",xs]],["mpnet",["MPNetForMaskedLM",Ja]],["albert",["AlbertForMaskedLM",ie]],["distilbert",["DistilBertForMaskedLM",Be]],["roberta",["RobertaForMaskedLM",Cr]],["xlm",["XLMWithLMHeadModel",df]],["xlm-roberta",["XLMRobertaForMaskedLM",mf]],["mobilebert",["MobileBertForMaskedLM",Hr]],["squeezebert",["SqueezeBertForMaskedLM",rl]]]),dE=new Map([["bert",["BertForQuestionAnswering",Ze]],["roformer",["RoFormerForQuestionAnswering",Ur]],["electra",["ElectraForQuestionAnswering",Qt]],["convbert",["ConvBertForQuestionAnswering",W]],["camembert",["CamembertForQuestionAnswering",sn]],["deberta",["DebertaForQuestionAnswering",Ui]],["deberta-v2",["DebertaV2ForQuestionAnswering",Ki]],["mpnet",["MPNetForQuestionAnswering",tl]],["albert",["AlbertForQuestionAnswering",Z]],["distilbert",["DistilBertForQuestionAnswering",Rn]],["roberta",["RobertaForQuestionAnswering",Tn]],["xlm",["XLMForQuestionAnswering",qu]],["xlm-roberta",["XLMRobertaForQuestionAnswering",yf]],["mobilebert",["MobileBertForQuestionAnswering",Gs]],["squeezebert",["SqueezeBertForQuestionAnswering",sl]]]),N0=new Map([["vision-encoder-decoder",["VisionEncoderDecoderModel",ed]],["idefics3",["Idefics3ForConditionalGeneration",al]],["smolvlm",["SmolVLMForConditionalGeneration",nd]]]),hE=new Map([["llava",["LlavaForConditionalGeneration",ol]],["llava_onevision",["LlavaOnevisionForConditionalGeneration",Jo]],["moondream1",["Moondream1ForConditionalGeneration",Tf]],["florence2",["Florence2ForConditionalGeneration",Cf]],["qwen2-vl",["Qwen2VLForConditionalGeneration",AM]],["idefics3",["Idefics3ForConditionalGeneration",al]],["smolvlm",["SmolVLMForConditionalGeneration",nd]],["paligemma",["PaliGemmaForConditionalGeneration",Ef]]]),fE=new Map([["ultravox",["UltravoxModel",HS]]]),BV=new Map([["vision-encoder-decoder",["VisionEncoderDecoderModel",ed]]]),pE=new Map([["vit",["ViTForImageClassification",VM]],["ijepa",["IJepaForImageClassification",UM]],["pvt",["PvtForImageClassification",XM]],["vit_msn",["ViTMSNForImageClassification",JM]],["fastvit",["FastViTForImageClassification",rT]],["mobilevit",["MobileViTForImageClassification",oT]],["mobilevitv2",["MobileViTV2ForImageClassification",lT]],["beit",["BeitForImageClassification",pT]],["deit",["DeiTForImageClassification",OT]],["hiera",["HieraForImageClassification",IT]],["convnext",["ConvNextForImageClassification",lC]],["convnextv2",["ConvNextV2ForImageClassification",uC]],["dinov2",["Dinov2ForImageClassification",hC]],["dinov2_with_registers",["Dinov2WithRegistersForImageClassification",pC]],["resnet",["ResNetForImageClassification",LT]],["swin",["SwinForImageClassification",jT]],["segformer",["SegformerForImageClassification",gS]],["efficientnet",["EfficientNetForImageClassification",xS]],["mobilenet_v1",["MobileNetV1ForImageClassification",MS]],["mobilenet_v2",["MobileNetV2ForImageClassification",SS]],["mobilenet_v3",["MobileNetV3ForImageClassification",kS]],["mobilenet_v4",["MobileNetV4ForImageClassification",OS]]]),mE=new Map([["detr",["DetrForObjectDetection",gT]],["rt_detr",["RTDetrForObjectDetection",vT]],["rt_detr_v2",["RTDetrV2ForObjectDetection",xT]],["rf_detr",["RFDetrForObjectDetection",TT]],["d_fine",["DFineForObjectDetection",ET]],["table-transformer",["TableTransformerForObjectDetection",kT]],["yolos",["YolosForObjectDetection",yC]]]),gE=new Map([["owlvit",["OwlViTForObjectDetection",uT]],["owlv2",["Owlv2ForObjectDetection",hT]],["grounding-dino",["GroundingDinoForObjectDetection",gC]]]),wc=new Map([["detr",["DetrForSegmentation",s0]],["clipseg",["CLIPSegForImageSegmentation",ud]]]),_E=new Map([["segformer",["SegformerForSemanticSegmentation",_S]],["sapiens",["SapiensForSemanticSegmentation",HT]],["swin",["SwinForSemanticSegmentation",NT]],["mobilenet_v1",["MobileNetV1ForSemanticSegmentation",TS]],["mobilenet_v2",["MobileNetV2ForSemanticSegmentation",ES]],["mobilenet_v3",["MobileNetV3ForSemanticSegmentation",AS]],["mobilenet_v4",["MobileNetV4ForSemanticSegmentation",DS]]]),yE=new Map([["detr",["DetrForSegmentation",s0]],["maskformer",["MaskFormerForInstanceSegmentation",rC]]]),vE=new Map([["sam",["SamModel",xC]]]),wE=new Map([["wav2vec2",["Wav2Vec2ForCTC",PC]],["wav2vec2-bert",["Wav2Vec2BertForCTC",WC]],["unispeech",["UniSpeechForCTC",LC]],["unispeech-sat",["UniSpeechSatForCTC",NC]],["wavlm",["WavLMForCTC",qC]],["hubert",["HubertForCTC",HC]]]),xE=new Map([["wav2vec2",["Wav2Vec2ForSequenceClassification",kC]],["wav2vec2-bert",["Wav2Vec2BertForSequenceClassification",UC]],["unispeech",["UniSpeechForSequenceClassification",RC]],["unispeech-sat",["UniSpeechSatForSequenceClassification",zC]],["wavlm",["WavLMForSequenceClassification",YC]],["hubert",["HubertForSequenceClassification",KC]],["audio-spectrogram-transformer",["ASTForAudioClassification",wf]]]),bE=new Map([["wavlm",["WavLMForXVector",QC]]]),ME=new Map([["unispeech-sat",["UniSpeechSatForAudioFrameClassification",BC]],["wavlm",["WavLMForAudioFrameClassification",JC]],["wav2vec2",["Wav2Vec2ForAudioFrameClassification",AC]],["pyannote",["PyAnnoteForAudioFrameClassification",OC]]]),TE=new Map([["vitmatte",["VitMatteForImageMatting",sT]]]),VV=new Map([["patchtst",["PatchTSTForPrediction",VS]],["patchtsmixer",["PatchTSMixerForPrediction",US]]]),CE=new Map([["swin2sr",["Swin2SRForImageSuperResolution",BT]]]),SE=new Map([["dpt",["DPTForDepthEstimation",WT]],["depth_anything",["DepthAnythingForDepthEstimation",GT]],["glpn",["GLPNForDepthEstimation",sC]],["sapiens",["SapiensForDepthEstimation",KT]],["depth_pro",["DepthProForDepthEstimation",YT]],["metric3d",["Metric3DForDepthEstimation",JT]],["metric3dv2",["Metric3Dv2ForDepthEstimation",eC]]]),EE=new Map([["sapiens",["SapiensForNormalEstimation",XT]]]),PE=new Map([["vitpose",["VitPoseForPoseEstimation",HM]]]),kE=new Map([["clip",["CLIPVisionModelWithProjection",$f]],["siglip",["SiglipVisionModel",Of]],["jina_clip",["JinaCLIPVisionModel",ld]]]),AE=[[LV,w.EncoderOnly],[RV,w.EncoderDecoder],[NV,w.DecoderOnly],[jV,w.AutoEncoder],[lE,w.EncoderOnly],[cE,w.EncoderOnly],[R0,w.Seq2Seq],[L0,w.Seq2Seq],[j0,w.DecoderOnly],[zV,w.MultiModality],[uE,w.EncoderOnly],[dE,w.EncoderOnly],[N0,w.Vision2Seq],[hE,w.ImageTextToText],[fE,w.AudioTextToText],[pE,w.EncoderOnly],[wc,w.EncoderOnly],[yE,w.EncoderOnly],[_E,w.EncoderOnly],[TE,w.EncoderOnly],[VV,w.EncoderOnly],[CE,w.EncoderOnly],[SE,w.EncoderOnly],[EE,w.EncoderOnly],[PE,w.EncoderOnly],[mE,w.EncoderOnly],[gE,w.EncoderOnly],[vE,w.MaskGeneration],[wE,w.EncoderOnly],[xE,w.EncoderOnly],[oE,w.Seq2Seq],[aE,w.EncoderOnly],[bE,w.EncoderOnly],[ME,w.EncoderOnly],[kE,w.EncoderOnly]];for(const[E,A]of AE)for(const[B,ue]of E.values())x.set(B,A),T.set(ue,B),M.set(B,ue);const WV=[["MusicgenForConditionalGeneration",D0,w.Musicgen],["Phi3VForCausalLM",sd,w.Phi3V],["CLIPTextModelWithProjection",Af,w.EncoderOnly],["SiglipTextModel",id,w.EncoderOnly],["JinaCLIPTextModel",ad,w.EncoderOnly],["ClapTextModelWithProjection",fS,w.EncoderOnly],["ClapAudioModelWithProjection",pS,w.EncoderOnly],["DacEncoderModel",tE,w.EncoderOnly],["DacDecoderModel",rE,w.EncoderOnly],["MimiEncoderModel",YS,w.EncoderOnly],["MimiDecoderModel",QS,w.EncoderOnly],["SnacEncoderModel",sE,w.EncoderOnly],["SnacDecoderModel",iE,w.EncoderOnly]];for(const[E,A,B]of WV)x.set(E,B),T.set(A,E),M.set(E,A);const $E=new Map([["modnet",wc],["birefnet",wc],["isnet",wc],["ben",wc]]);for(const[E,A]of $E.entries())A.set(E,["PreTrainedModel",Q]),x.set(E,w.EncoderOnly),T.set(Q,E),M.set(E,Q);class z0 extends Zt{}ce(z0,"MODEL_CLASS_MAPPINGS",AE.map(A=>A[0])),ce(z0,"BASE_IF_FAIL",!0);class OE extends Zt{}ce(OE,"MODEL_CLASS_MAPPINGS",[lE]);class DE extends Zt{}ce(DE,"MODEL_CLASS_MAPPINGS",[cE]);class IE extends Zt{}ce(IE,"MODEL_CLASS_MAPPINGS",[R0]);class FE extends Zt{}ce(FE,"MODEL_CLASS_MAPPINGS",[L0]);class LE extends Zt{}ce(LE,"MODEL_CLASS_MAPPINGS",[oE]);class RE extends Zt{}ce(RE,"MODEL_CLASS_MAPPINGS",[aE]);class jE extends Zt{}ce(jE,"MODEL_CLASS_MAPPINGS",[j0]);class NE extends Zt{}ce(NE,"MODEL_CLASS_MAPPINGS",[uE]);class zE extends Zt{}ce(zE,"MODEL_CLASS_MAPPINGS",[dE]);class BE extends Zt{}ce(BE,"MODEL_CLASS_MAPPINGS",[N0]);class VE extends Zt{}ce(VE,"MODEL_CLASS_MAPPINGS",[pE]);class WE extends Zt{}ce(WE,"MODEL_CLASS_MAPPINGS",[wc]);class UE extends Zt{}ce(UE,"MODEL_CLASS_MAPPINGS",[_E]);class GE extends Zt{}ce(GE,"MODEL_CLASS_MAPPINGS",[yE]);class HE extends Zt{}ce(HE,"MODEL_CLASS_MAPPINGS",[mE]);class KE extends Zt{}ce(KE,"MODEL_CLASS_MAPPINGS",[gE]);class XE extends Zt{}ce(XE,"MODEL_CLASS_MAPPINGS",[vE]);class qE extends Zt{}ce(qE,"MODEL_CLASS_MAPPINGS",[wE]);class YE extends Zt{}ce(YE,"MODEL_CLASS_MAPPINGS",[xE]);class QE extends Zt{}ce(QE,"MODEL_CLASS_MAPPINGS",[bE]);class JE extends Zt{}ce(JE,"MODEL_CLASS_MAPPINGS",[ME]);class ZE extends Zt{}ce(ZE,"MODEL_CLASS_MAPPINGS",[BV]);class eP extends Zt{}ce(eP,"MODEL_CLASS_MAPPINGS",[TE]);class tP extends Zt{}ce(tP,"MODEL_CLASS_MAPPINGS",[CE]);class rP extends Zt{}ce(rP,"MODEL_CLASS_MAPPINGS",[SE]);class nP extends Zt{}ce(nP,"MODEL_CLASS_MAPPINGS",[EE]);class sP extends Zt{}ce(sP,"MODEL_CLASS_MAPPINGS",[PE]);class iP extends Zt{}ce(iP,"MODEL_CLASS_MAPPINGS",[kE]);class oP extends Zt{}ce(oP,"MODEL_CLASS_MAPPINGS",[hE]);class aP extends Zt{}ce(aP,"MODEL_CLASS_MAPPINGS",[fE]);class UV extends Me{constructor({logits:A,past_key_values:B,encoder_outputs:ue,decoder_attentions:be=null,cross_attentions:xe=null}){super(),this.logits=A,this.past_key_values=B,this.encoder_outputs=ue,this.decoder_attentions=be,this.cross_attentions=xe}}class Dt extends Me{constructor({logits:A,...B}){super(),this.logits=A;const ue=Object.values(B);ue.length>0&&(this.attentions=ue)}}class lP extends Me{constructor({logits:A,embeddings:B}){super(),this.logits=A,this.embeddings=B}}class gn extends Me{constructor({logits:A}){super(),this.logits=A}}class Cn extends Me{constructor({logits:A}){super(),this.logits=A}}class jn extends Me{constructor({start_logits:A,end_logits:B}){super(),this.start_logits=A,this.end_logits=B}}class fl extends Me{constructor({logits:A}){super(),this.logits=A}}class GV extends Me{constructor({logits:A,past_key_values:B}){super(),this.logits=A,this.past_key_values=B}}class cP extends Me{constructor({alphas:A}){super(),this.alphas=A}}class uP extends Me{constructor({waveform:A,spectrogram:B}){super(),this.waveform=A,this.spectrogram=B}}},"./src/models/audio_spectrogram_transformer/feature_extraction_audio_spectrogram_transformer.js":(t,e,r)=>{r.r(e),r.d(e,{ASTFeatureExtractor:()=>i});var n=r("./src/base/feature_extraction_utils.js");r("./src/utils/tensor.js");var s=r("./src/utils/audio.js");class i extends n.FeatureExtractor{constructor(a){super(a);const l=this.config.sampling_rate,c=(0,s.mel_filter_bank)(257,this.config.num_mel_bins,20,Math.floor(l/2),l,null,"kaldi",!0);this.mel_filters=c,this.window=(0,s.window_function)(400,"hann",{periodic:!1}),this.mean=this.config.mean,this.std=this.config.std}async _extract_fbank_features(a,l){return(0,s.spectrogram)(a,this.window,400,160,{fft_length:512,power:2,center:!1,preemphasis:.97,mel_filters:this.mel_filters,log_mel:"log",mel_floor:1192092955078125e-22,remove_dc_offset:!0,max_num_frames:l,transpose:!0})}async _call(a){(0,n.validate_audio_inputs)(a,"ASTFeatureExtractor");const l=await this._extract_fbank_features(a,this.config.max_length);if(this.config.do_normalize){const c=this.std*2,u=l.data;for(let d=0;d<u.length;++d)u[d]=(u[d]-this.mean)/c}return{input_values:l.unsqueeze_(0)}}}},"./src/models/auto/feature_extraction_auto.js":(t,e,r)=>{r.r(e),r.d(e,{AutoFeatureExtractor:()=>o});var n=r("./src/utils/constants.js"),s=r("./src/utils/hub.js");r("./src/base/feature_extraction_utils.js");var i=r("./src/models/feature_extractors.js");class o{static async from_pretrained(l,c={}){const u=await(0,s.getModelJSON)(l,n.FEATURE_EXTRACTOR_NAME,!0,c),d=u.feature_extractor_type,h=i[d];if(!h)throw new Error(`Unknown feature_extractor_type: '${d}'. Please report this at ${n.GITHUB_ISSUE_URL}.`);return new h(u)}}},"./src/models/auto/image_processing_auto.js":(t,e,r)=>{r.r(e),r.d(e,{AutoImageProcessor:()=>a});var n=r("./src/utils/constants.js"),s=r("./src/utils/hub.js"),i=r("./src/base/image_processors_utils.js"),o=r("./src/models/image_processors.js");class a{static async from_pretrained(c,u={}){const d=await(0,s.getModelJSON)(c,n.IMAGE_PROCESSOR_NAME,!0,u),h=d.image_processor_type??d.feature_extractor_type;let f=o[h];return f||(h!==void 0&&console.warn(`Image processor type '${h}' not found, assuming base ImageProcessor. Please report this at ${n.GITHUB_ISSUE_URL}.`),f=i.ImageProcessor),new f(d)}}},"./src/models/auto/processing_auto.js":(t,e,r)=>{r.r(e),r.d(e,{AutoProcessor:()=>c});var n=r("./src/utils/constants.js"),s=r("./src/utils/hub.js"),i=r("./src/base/processing_utils.js"),o=r("./src/models/processors.js"),a=r("./src/models/image_processors.js"),l=r("./src/models/feature_extractors.js");class c{static async from_pretrained(d,h={}){const f=await(0,s.getModelJSON)(d,n.IMAGE_PROCESSOR_NAME,!0,h),{image_processor_type:p,feature_extractor_type:m,processor_class:y}=f;if(y&&o[y])return o[y].from_pretrained(d,h);if(!p&&!m)throw new Error("No `image_processor_type` or `feature_extractor_type` found in the config.");const g={};if(p){const v=a[p];if(!v)throw new Error(`Unknown image_processor_type: '${p}'.`);g.image_processor=new v(f)}if(m){const v=a[m];if(v)g.image_processor=new v(f);else{const w=l[m];if(!w)throw new Error(`Unknown feature_extractor_type: '${m}'.`);g.feature_extractor=new w(f)}}const _={};return new i.Processor(_,g)}}},"./src/models/beit/image_processing_beit.js":(t,e,r)=>{r.r(e),r.d(e,{BeitFeatureExtractor:()=>s});var n=r("./src/base/image_processors_utils.js");class s extends n.ImageProcessor{}},"./src/models/bit/image_processing_bit.js":(t,e,r)=>{r.r(e),r.d(e,{BitImageProcessor:()=>s});var n=r("./src/base/image_processors_utils.js");class s extends n.ImageProcessor{}},"./src/models/chinese_clip/image_processing_chinese_clip.js":(t,e,r)=>{r.r(e),r.d(e,{ChineseCLIPFeatureExtractor:()=>s});var n=r("./src/base/image_processors_utils.js");class s extends n.ImageProcessor{}},"./src/models/clap/feature_extraction_clap.js":(t,e,r)=>{r.r(e),r.d(e,{ClapFeatureExtractor:()=>i});var n=r("./src/base/feature_extraction_utils.js");r("./src/utils/tensor.js");var s=r("./src/utils/audio.js");class i extends n.FeatureExtractor{constructor(a){super(a),this.mel_filters=(0,s.mel_filter_bank)(this.config.nb_frequency_bins,this.config.feature_size,this.config.frequency_min,this.config.frequency_max,this.config.sampling_rate,null,"htk"),this.mel_filters_slaney=(0,s.mel_filter_bank)(this.config.nb_frequency_bins,this.config.feature_size,this.config.frequency_min,this.config.frequency_max,this.config.sampling_rate,"slaney","slaney"),this.window=(0,s.window_function)(this.config.fft_window_size,"hann")}async _get_input_mel(a,l,c,u){let d;const h=a.length-l;if(h>0)if(c==="rand_trunc"){const f=Math.floor(Math.random()*(h+1));a=a.subarray(f,f+l),d=await this._extract_fbank_features(a,this.mel_filters_slaney,this.config.nb_max_samples)}else throw new Error(`Truncation strategy "${c}" not implemented`);else{if(h<0){let f=new Float64Array(l);if(f.set(a),u==="repeat")for(let p=a.length;p<l;p+=a.length)f.set(a.subarray(0,Math.min(a.length,l-p)),p);else if(u==="repeatpad")for(let p=a.length;p<-h;p+=a.length)f.set(a,p);a=f}if(c==="fusion")throw new Error(`Truncation strategy "${c}" not implemented`);d=await this._extract_fbank_features(a,this.mel_filters_slaney,this.config.nb_max_samples)}return d.unsqueeze_(0)}async _extract_fbank_features(a,l,c=null){return(0,s.spectrogram)(a,this.window,this.config.fft_window_size,this.config.hop_length,{power:2,mel_filters:l,log_mel:"dB",max_num_frames:c,do_pad:!1,transpose:!0})}async _call(a,{max_length:l=null}={}){return(0,n.validate_audio_inputs)(a,"ClapFeatureExtractor"),{input_features:(await this._get_input_mel(a,l??this.config.nb_max_samples,this.config.truncation,this.config.padding)).unsqueeze_(0)}}}},"./src/models/clip/image_processing_clip.js":(t,e,r)=>{r.r(e),r.d(e,{CLIPFeatureExtractor:()=>i,CLIPImageProcessor:()=>s});var n=r("./src/base/image_processors_utils.js");class s extends n.ImageProcessor{}class i extends s{}},"./src/models/convnext/image_processing_convnext.js":(t,e,r)=>{r.r(e),r.d(e,{ConvNextFeatureExtractor:()=>i,ConvNextImageProcessor:()=>s});var n=r("./src/base/image_processors_utils.js");class s extends n.ImageProcessor{constructor(a){super(a),this.crop_pct=this.config.crop_pct??224/256}async resize(a){var c;const l=(c=this.size)==null?void 0:c.shortest_edge;if(l===void 0)throw new Error("Size dictionary must contain 'shortest_edge' key.");if(l<384){const u=Math.floor(l/this.crop_pct),[d,h]=this.get_resize_output_image_size(a,{shortest_edge:u});a=await a.resize(d,h,{resample:this.resample}),a=await a.center_crop(l,l)}else a=await a.resize(l,l,{resample:this.resample});return a}}class i extends s{}},"./src/models/dac/feature_extraction_dac.js":(t,e,r)=>{r.r(e),r.d(e,{DacFeatureExtractor:()=>s});var n=r("./src/models/encodec/feature_extraction_encodec.js");class s extends n.EncodecFeatureExtractor{}},"./src/models/deit/image_processing_deit.js":(t,e,r)=>{r.r(e),r.d(e,{DeiTFeatureExtractor:()=>i,DeiTImageProcessor:()=>s});var n=r("./src/base/image_processors_utils.js");class s extends n.ImageProcessor{}class i extends s{}},"./src/models/detr/image_processing_detr.js":(t,e,r)=>{r.r(e),r.d(e,{DetrFeatureExtractor:()=>o,DetrImageProcessor:()=>i});var n=r("./src/base/image_processors_utils.js"),s=r("./src/utils/tensor.js");class i extends n.ImageProcessor{async _call(l){const c=await super._call(l),u=[c.pixel_values.dims[0],64,64],d=(0,s.full)(u,1n);return{...c,pixel_mask:d}}post_process_object_detection(...l){return(0,n.post_process_object_detection)(...l)}post_process_panoptic_segmentation(...l){return(0,n.post_process_panoptic_segmentation)(...l)}post_process_instance_segmentation(...l){return(0,n.post_process_instance_segmentation)(...l)}}class o extends i{}},"./src/models/donut/image_processing_donut.js":(t,e,r)=>{r.r(e),r.d(e,{DonutFeatureExtractor:()=>i,DonutImageProcessor:()=>s});var n=r("./src/base/image_processors_utils.js");class s extends n.ImageProcessor{pad_image(a,l,c,u={}){const[d,h,f]=l;let p=this.image_mean;Array.isArray(this.image_mean)||(p=new Array(f).fill(p));let m=this.image_std;Array.isArray(m)||(m=new Array(f).fill(p));const y=p.map((g,_)=>-g/m[_]);return super.pad_image(a,l,c,{center:!0,constant_values:y,...u})}}class i extends s{}},"./src/models/dpt/image_processing_dpt.js":(t,e,r)=>{r.r(e),r.d(e,{DPTFeatureExtractor:()=>i,DPTImageProcessor:()=>s});var n=r("./src/base/image_processors_utils.js");class s extends n.ImageProcessor{}class i extends s{}},"./src/models/efficientnet/image_processing_efficientnet.js":(t,e,r)=>{r.r(e),r.d(e,{EfficientNetImageProcessor:()=>s});var n=r("./src/base/image_processors_utils.js");class s extends n.ImageProcessor{constructor(o){super(o),this.include_top=this.config.include_top??!0,this.include_top&&(this.image_std=this.image_std.map(a=>a*a))}}},"./src/models/encodec/feature_extraction_encodec.js":(t,e,r)=>{r.r(e),r.d(e,{EncodecFeatureExtractor:()=>i});var n=r("./src/base/feature_extraction_utils.js"),s=r("./src/utils/tensor.js");class i extends n.FeatureExtractor{async _call(a){(0,n.validate_audio_inputs)(a,"EncodecFeatureExtractor"),a instanceof Float64Array&&(a=new Float32Array(a));const l=this.config.feature_size;if(a.length%l!==0)throw new Error(`The length of the audio data must be a multiple of the number of channels (${l}).`);const c=[1,l,a.length/l];return{input_values:new s.Tensor("float32",a,c)}}}},"./src/models/feature_extractors.js":(t,e,r)=>{r.r(e),r.d(e,{ASTFeatureExtractor:()=>n.ASTFeatureExtractor,ClapFeatureExtractor:()=>i.ClapFeatureExtractor,DacFeatureExtractor:()=>o.DacFeatureExtractor,EncodecFeatureExtractor:()=>s.EncodecFeatureExtractor,ImageFeatureExtractor:()=>m.ImageProcessor,MoonshineFeatureExtractor:()=>a.MoonshineFeatureExtractor,PyAnnoteFeatureExtractor:()=>l.PyAnnoteFeatureExtractor,SeamlessM4TFeatureExtractor:()=>c.SeamlessM4TFeatureExtractor,SnacFeatureExtractor:()=>u.SnacFeatureExtractor,SpeechT5FeatureExtractor:()=>d.SpeechT5FeatureExtractor,Wav2Vec2FeatureExtractor:()=>h.Wav2Vec2FeatureExtractor,WeSpeakerFeatureExtractor:()=>f.WeSpeakerFeatureExtractor,WhisperFeatureExtractor:()=>p.WhisperFeatureExtractor});var n=r("./src/models/audio_spectrogram_transformer/feature_extraction_audio_spectrogram_transformer.js"),s=r("./src/models/encodec/feature_extraction_encodec.js"),i=r("./src/models/clap/feature_extraction_clap.js"),o=r("./src/models/dac/feature_extraction_dac.js"),a=r("./src/models/moonshine/feature_extraction_moonshine.js"),l=r("./src/models/pyannote/feature_extraction_pyannote.js"),c=r("./src/models/seamless_m4t/feature_extraction_seamless_m4t.js"),u=r("./src/models/snac/feature_extraction_snac.js"),d=r("./src/models/speecht5/feature_extraction_speecht5.js"),h=r("./src/models/wav2vec2/feature_extraction_wav2vec2.js"),f=r("./src/models/wespeaker/feature_extraction_wespeaker.js"),p=r("./src/models/whisper/feature_extraction_whisper.js"),m=r("./src/base/image_processors_utils.js")},"./src/models/florence2/processing_florence2.js":(t,e,r)=>{r.r(e),r.d(e,{Florence2Processor:()=>o});var n=r("./src/base/processing_utils.js"),s=r("./src/models/auto/image_processing_auto.js"),i=r("./src/tokenizers.js");class o extends n.Processor{constructor(l,c){super(l,c);const{tasks_answer_post_processing_type:u,task_prompts_without_inputs:d,task_prompts_with_input:h}=this.image_processor.config;this.tasks_answer_post_processing_type=new Map(Object.entries(u??{})),this.task_prompts_without_inputs=new Map(Object.entries(d??{})),this.task_prompts_with_input=new Map(Object.entries(h??{})),this.regexes={quad_boxes:/(.+?)<loc_(\d+)><loc_(\d+)><loc_(\d+)><loc_(\d+)><loc_(\d+)><loc_(\d+)><loc_(\d+)><loc_(\d+)>/gm,bboxes:/([^<]+)?<loc_(\d+)><loc_(\d+)><loc_(\d+)><loc_(\d+)>/gm},this.size_per_bin=1e3}construct_prompts(l){typeof l=="string"&&(l=[l]);const c=[];for(const u of l)if(this.task_prompts_without_inputs.has(u))c.push(this.task_prompts_without_inputs.get(u));else{for(const[d,h]of this.task_prompts_with_input)if(u.includes(d)){c.push(h.replaceAll("{input}",u).replaceAll(d,""));break}c.length!==l.length&&c.push(u)}return c}post_process_generation(l,c,u){const d=this.tasks_answer_post_processing_type.get(c)??"pure_text";l=l.replaceAll("<s>","").replaceAll("</s>","");let h;switch(d){case"pure_text":h=l;break;case"description_with_bboxes":case"bboxes":case"phrase_grounding":case"ocr":const f=d==="ocr"?"quad_boxes":"bboxes",p=l.matchAll(this.regexes[f]),m=[],y=[];for(const[g,_,...v]of p)m.push(_?_.trim():m.at(-1)??""),y.push(v.map((w,x)=>(Number(w)+.5)/this.size_per_bin*u[x%2]));h={labels:m,[f]:y};break;default:throw new Error(`Task "${c}" (of type "${d}") not yet implemented.`)}return{[c]:h}}async _call(l,c=null,u={}){if(!l&&!c)throw new Error("Either text or images must be provided");const d=await this.image_processor(l,u),h=c?this.tokenizer(c,u):{};return{...d,...h}}}ce(o,"tokenizer_class",i.AutoTokenizer),ce(o,"image_processor_class",s.AutoImageProcessor)},"./src/models/glpn/image_processing_glpn.js":(t,e,r)=>{r.r(e),r.d(e,{GLPNFeatureExtractor:()=>s});var n=r("./src/base/image_processors_utils.js");class s extends n.ImageProcessor{}},"./src/models/grounding_dino/image_processing_grounding_dino.js":(t,e,r)=>{r.r(e),r.d(e,{GroundingDinoImageProcessor:()=>i});var n=r("./src/base/image_processors_utils.js"),s=r("./src/utils/tensor.js");class i extends n.ImageProcessor{async _call(a){const l=await super._call(a),c=l.pixel_values.dims,u=(0,s.ones)([c[0],c[2],c[3]]);return{...l,pixel_mask:u}}}},"./src/models/grounding_dino/processing_grounding_dino.js":(t,e,r)=>{r.r(e),r.d(e,{GroundingDinoProcessor:()=>l});var n=r("./src/base/processing_utils.js"),s=r("./src/models/auto/image_processing_auto.js"),i=r("./src/tokenizers.js"),o=r("./src/base/image_processors_utils.js");function a(c,u){const h=c.dims.at(-1)-1,f=c.tolist();f.fill(!1,0,1),f.fill(!1,h);const p=u.tolist();return f.map((m,y)=>m?y:null).filter(m=>m!==null).map(m=>p[m])}class l extends n.Processor{async _call(u,d,h={}){const f=u?await this.image_processor(u,h):{};return{...d?this.tokenizer(d,h):{},...f}}post_process_grounded_object_detection(u,d,{box_threshold:h=.25,text_threshold:f=.25,target_sizes:p=null}={}){const{logits:m,pred_boxes:y}=u,g=m.dims[0];if(p!==null&&p.length!==g)throw Error("Make sure that you pass in as many target sizes as the batch dimension of the logits");const _=m.dims.at(1),v=m.sigmoid(),w=v.max(-1).tolist(),x=y.tolist().map(T=>T.map(S=>(0,o.center_to_corners_format)(S))),M=[];for(let T=0;T<g;++T){const S=p!==null?p[T]:null;S!==null&&(x[T]=x[T].map(L=>L.map((X,K)=>X*S[(K+1)%2])));const k=w[T],$=[],j=[],V=[];for(let L=0;L<_;++L){const X=k[L];if(X<=h)continue;const K=x[T][L],Y=v[T][L];$.push(X),V.push(K);const J=a(Y.gt(f),d[T]);j.push(J)}M.push({scores:$,boxes:V,labels:this.batch_decode(j)})}return M}}ce(l,"tokenizer_class",i.AutoTokenizer),ce(l,"image_processor_class",s.AutoImageProcessor)},"./src/models/idefics3/image_processing_idefics3.js":(t,e,r)=>{r.r(e),r.d(e,{Idefics3ImageProcessor:()=>i});var n=r("./src/base/image_processors_utils.js"),s=r("./src/utils/tensor.js");class i extends n.ImageProcessor{constructor(a){super(a),this.do_image_splitting=a.do_image_splitting??!0,this.max_image_size=a.max_image_size}get_resize_for_vision_encoder(a,l){let[c,u]=a.dims.slice(-2);const d=u/c;return u>=c?(u=Math.ceil(u/l)*l,c=Math.floor(u/d),c=Math.ceil(c/l)*l):(c=Math.ceil(c/l)*l,u=Math.floor(c*d),u=Math.ceil(u/l)*l),{height:c,width:u}}async _call(a,{do_image_splitting:l=null,return_row_col_info:c=!1}={}){let u;if(!Array.isArray(a))u=[[a]];else{if(a.length===0||!a[0])throw new Error("No images provided.");Array.isArray(a[0])?u=a:u=[a]}let d=[],h=[],f=[];const p=[],m=[];for(const T of u){let S=await Promise.all(T.map(j=>this.preprocess(j)));p.push(...S.map(j=>j.original_size)),m.push(...S.map(j=>j.reshaped_input_size)),S.forEach(j=>j.pixel_values.unsqueeze_(0));const{longest_edge:k}=this.max_image_size;let $;if(l??this.do_image_splitting){let j=new Array(S.length),V=new Array(S.length);$=await Promise.all(S.map(async(L,X)=>{const K=this.get_resize_for_vision_encoder(L.pixel_values,k),Y=await(0,s.interpolate_4d)(L.pixel_values,{size:[K.height,K.width]}),{frames:J,num_splits_h:N,num_splits_w:ne}=await this.split_image(Y,this.max_image_size);return j[X]=N,V[X]=ne,(0,s.cat)(J,0)})),h.push(j),f.push(V)}else{const j=[k,k];$=await Promise.all(S.map(V=>(0,s.interpolate_4d)(V.pixel_values,{size:j}))),h.push(new Array(S.length).fill(0)),f.push(new Array(S.length).fill(0))}d.push((0,s.cat)($,0))}const y=d.length,[g,_,v,w]=d[0].dims;let x,M;if(y===1)x=d[0].unsqueeze_(0),M=(0,s.full)([y,g,v,w],!0);else{const T=Math.max(...d.map($=>$.dims.at(0)));M=(0,s.full)([y,T,v,w],!0);const S=M.data,k=T*v*w;for(let $=0;$<y;++$){const j=d[$].dims[0];if(j<T){d[$]=(0,s.cat)([d[$],(0,s.full)([T-j,_,v,w],0)],0);const V=$*k+j*v*w,L=($+1)*k;S.fill(!1,V,L)}}x=(0,s.stack)(d,0)}return{pixel_values:x,pixel_attention_mask:M,original_sizes:p,reshaped_input_sizes:m,...c?{rows:h,cols:f}:{}}}async split_image(a,{longest_edge:l}){const c=l,u=l,d=[],[h,f]=a.dims.slice(-2);let p=0,m=0;if(h>c||f>u){p=Math.ceil(h/c),m=Math.ceil(f/u);const y=Math.ceil(h/p),g=Math.ceil(f/m);for(let w=0;w<p;++w)for(let x=0;x<m;++x){let M,T,S,k;w===p-1?(T=h-y,k=h):(T=w*y,k=(w+1)*y),x===m-1?(M=f-g,S=f):(M=x*g,S=(x+1)*g);const $=[T,M],j=[k,S],V=await(0,s.slice)(a,$,j,[2,3]);d.push(V)}const _=c,v=u;(h!==_||f!==v)&&(a=await(0,s.interpolate_4d)(a,{size:[_,v]}))}return d.push(a),{frames:d,num_splits_h:p,num_splits_w:m}}}},"./src/models/idefics3/processing_idefics3.js":(t,e,r)=>{r.r(e),r.d(e,{Idefics3Processor:()=>u});var n=r("./src/base/processing_utils.js"),s=r("./src/models/auto/image_processing_auto.js"),i=r("./src/tokenizers.js");r("./src/utils/image.js");var o=r("./src/utils/core.js");function a(d,h,f,p,m,y){let g="";for(let _=0;_<h;++_){for(let v=0;v<f;++v)g+=p+`<row_${_+1}_col_${v+1}>`+m.repeat(d);g+=`
`}return g+=`
${p}${y}`+m.repeat(d)+`${p}`,g}function l(d,h,f,p){return`${h}${p}`+f.repeat(d)+`${h}`}function c(d,h,f,p,m,y){return d===0&&h===0?l(f,p,m,y):a(f,d,h,p,m,y)}class u extends n.Processor{constructor(){super(...arguments);ce(this,"fake_image_token","<fake_token_around_image>");ce(this,"image_token","<image>");ce(this,"global_img_token","<global-img>")}async _call(f,p=null,m={}){m.return_row_col_info??(m.return_row_col_info=!0);let y;p&&(y=await this.image_processor(p,m)),Array.isArray(f)||(f=[f]);const g=y.rows??[new Array(f.length).fill(0)],_=y.cols??[new Array(f.length).fill(0)],v=this.config.image_seq_len,w=[],x=[];for(let T=0;T<f.length;++T){const S=f[T],k=g[T],$=_[T];w.push((0,o.count)(S,this.image_token));const j=k.map((X,K)=>c(X,$[K],v,this.fake_image_token,this.image_token,this.global_img_token)),V=S.split(this.image_token);if(V.length===0)throw new Error("The image token should be present in the text.");let L=V[0];for(let X=0;X<j.length;++X)L+=j[X]+V[X+1];x.push(L)}return{...this.tokenizer(x),...y}}}ce(u,"image_processor_class",s.AutoImageProcessor),ce(u,"tokenizer_class",i.AutoTokenizer),ce(u,"uses_processor_config",!0)},"./src/models/image_processors.js":(t,e,r)=>{r.r(e),r.d(e,{BeitFeatureExtractor:()=>n.BeitFeatureExtractor,BitImageProcessor:()=>s.BitImageProcessor,CLIPFeatureExtractor:()=>o.CLIPFeatureExtractor,CLIPImageProcessor:()=>o.CLIPImageProcessor,ChineseCLIPFeatureExtractor:()=>i.ChineseCLIPFeatureExtractor,ConvNextFeatureExtractor:()=>a.ConvNextFeatureExtractor,ConvNextImageProcessor:()=>a.ConvNextImageProcessor,DPTFeatureExtractor:()=>d.DPTFeatureExtractor,DPTImageProcessor:()=>d.DPTImageProcessor,DeiTFeatureExtractor:()=>l.DeiTFeatureExtractor,DeiTImageProcessor:()=>l.DeiTImageProcessor,DetrFeatureExtractor:()=>c.DetrFeatureExtractor,DetrImageProcessor:()=>c.DetrImageProcessor,DonutFeatureExtractor:()=>u.DonutFeatureExtractor,DonutImageProcessor:()=>u.DonutImageProcessor,EfficientNetImageProcessor:()=>h.EfficientNetImageProcessor,GLPNFeatureExtractor:()=>f.GLPNFeatureExtractor,GroundingDinoImageProcessor:()=>p.GroundingDinoImageProcessor,Idefics3ImageProcessor:()=>m.Idefics3ImageProcessor,JinaCLIPImageProcessor:()=>g.JinaCLIPImageProcessor,LlavaOnevisionImageProcessor:()=>_.LlavaOnevisionImageProcessor,Mask2FormerImageProcessor:()=>v.Mask2FormerImageProcessor,MaskFormerFeatureExtractor:()=>w.MaskFormerFeatureExtractor,MaskFormerImageProcessor:()=>w.MaskFormerImageProcessor,MobileNetV1FeatureExtractor:()=>x.MobileNetV1FeatureExtractor,MobileNetV1ImageProcessor:()=>x.MobileNetV1ImageProcessor,MobileNetV2FeatureExtractor:()=>M.MobileNetV2FeatureExtractor,MobileNetV2ImageProcessor:()=>M.MobileNetV2ImageProcessor,MobileNetV3FeatureExtractor:()=>T.MobileNetV3FeatureExtractor,MobileNetV3ImageProcessor:()=>T.MobileNetV3ImageProcessor,MobileNetV4FeatureExtractor:()=>S.MobileNetV4FeatureExtractor,MobileNetV4ImageProcessor:()=>S.MobileNetV4ImageProcessor,MobileViTFeatureExtractor:()=>k.MobileViTFeatureExtractor,MobileViTImageProcessor:()=>k.MobileViTImageProcessor,NougatImageProcessor:()=>$.NougatImageProcessor,OwlViTFeatureExtractor:()=>V.OwlViTFeatureExtractor,OwlViTImageProcessor:()=>V.OwlViTImageProcessor,Owlv2ImageProcessor:()=>j.Owlv2ImageProcessor,Phi3VImageProcessor:()=>L.Phi3VImageProcessor,PvtImageProcessor:()=>X.PvtImageProcessor,Qwen2VLImageProcessor:()=>K.Qwen2VLImageProcessor,RTDetrImageProcessor:()=>Y.RTDetrImageProcessor,SamImageProcessor:()=>J.SamImageProcessor,SegformerFeatureExtractor:()=>N.SegformerFeatureExtractor,SegformerImageProcessor:()=>N.SegformerImageProcessor,SiglipImageProcessor:()=>ne.SiglipImageProcessor,SmolVLMImageProcessor:()=>te.SmolVLMImageProcessor,Swin2SRImageProcessor:()=>z.Swin2SRImageProcessor,VLMImageProcessor:()=>y.VLMImageProcessor,ViTFeatureExtractor:()=>O.ViTFeatureExtractor,ViTImageProcessor:()=>O.ViTImageProcessor,VitMatteImageProcessor:()=>H.VitMatteImageProcessor,VitPoseImageProcessor:()=>re.VitPoseImageProcessor,YolosFeatureExtractor:()=>_e.YolosFeatureExtractor,YolosImageProcessor:()=>_e.YolosImageProcessor});var n=r("./src/models/beit/image_processing_beit.js"),s=r("./src/models/bit/image_processing_bit.js"),i=r("./src/models/chinese_clip/image_processing_chinese_clip.js"),o=r("./src/models/clip/image_processing_clip.js"),a=r("./src/models/convnext/image_processing_convnext.js"),l=r("./src/models/deit/image_processing_deit.js"),c=r("./src/models/detr/image_processing_detr.js"),u=r("./src/models/donut/image_processing_donut.js"),d=r("./src/models/dpt/image_processing_dpt.js"),h=r("./src/models/efficientnet/image_processing_efficientnet.js"),f=r("./src/models/glpn/image_processing_glpn.js"),p=r("./src/models/grounding_dino/image_processing_grounding_dino.js"),m=r("./src/models/idefics3/image_processing_idefics3.js"),y=r("./src/models/janus/image_processing_janus.js"),g=r("./src/models/jina_clip/image_processing_jina_clip.js"),_=r("./src/models/llava_onevision/image_processing_llava_onevision.js"),v=r("./src/models/mask2former/image_processing_mask2former.js"),w=r("./src/models/maskformer/image_processing_maskformer.js"),x=r("./src/models/mobilenet_v1/image_processing_mobilenet_v1.js"),M=r("./src/models/mobilenet_v2/image_processing_mobilenet_v2.js"),T=r("./src/models/mobilenet_v3/image_processing_mobilenet_v3.js"),S=r("./src/models/mobilenet_v4/image_processing_mobilenet_v4.js"),k=r("./src/models/mobilevit/image_processing_mobilevit.js"),$=r("./src/models/nougat/image_processing_nougat.js"),j=r("./src/models/owlv2/image_processing_owlv2.js"),V=r("./src/models/owlvit/image_processing_owlvit.js"),L=r("./src/models/phi3_v/image_processing_phi3_v.js"),X=r("./src/models/pvt/image_processing_pvt.js"),K=r("./src/models/qwen2_vl/image_processing_qwen2_vl.js"),Y=r("./src/models/rt_detr/image_processing_rt_detr.js"),J=r("./src/models/sam/image_processing_sam.js"),N=r("./src/models/segformer/image_processing_segformer.js"),ne=r("./src/models/siglip/image_processing_siglip.js"),te=r("./src/models/smolvlm/image_processing_smolvlm.js"),z=r("./src/models/swin2sr/image_processing_swin2sr.js"),O=r("./src/models/vit/image_processing_vit.js"),H=r("./src/models/vitmatte/image_processing_vitmatte.js"),re=r("./src/models/vitpose/image_processing_vitpose.js"),_e=r("./src/models/yolos/image_processing_yolos.js")},"./src/models/janus/image_processing_janus.js":(t,e,r)=>{r.r(e),r.d(e,{VLMImageProcessor:()=>s});var n=r("./src/base/image_processors_utils.js");class s extends n.ImageProcessor{constructor(o){super({do_pad:!0,pad_size:{width:o.image_size,height:o.image_size},...o}),this.constant_values=this.config.background_color.map(a=>a*this.rescale_factor)}pad_image(o,a,l,c){return super.pad_image(o,a,l,{constant_values:this.constant_values,center:!0,...c})}}},"./src/models/janus/processing_janus.js":(t,e,r)=>{r.r(e),r.d(e,{VLChatProcessor:()=>c});var n=r("./src/base/processing_utils.js"),s=r("./src/models/auto/image_processing_auto.js"),i=r("./src/tokenizers.js"),o=r("./src/utils/core.js"),a=r("./src/utils/tensor.js"),l=r("./src/utils/image.js");class c extends n.Processor{constructor(d,h){super(d,h),this.image_tag=this.config.image_tag,this.image_start_tag=this.config.image_start_tag,this.image_end_tag=this.config.image_end_tag,this.num_image_tokens=this.config.num_image_tokens}async _call(d,{images:h=null,chat_template:f="default"}={}){h?Array.isArray(h)||(h=[h]):h=await Promise.all(d.filter($=>$.images).flatMap($=>$.images).map($=>l.RawImage.read($)));const p=this.tokenizer,m=p.apply_chat_template(d,{tokenize:!1,add_generation_prompt:!0,chat_template:f}),y=$=>p.encode($,{add_special_tokens:!1}),g=m.split(this.image_tag),_=g.length-1;if(h.length!==_)throw new Error(`Number of images provided (${h.length}) does not match number of "${this.image_tag}" image tags (${_})`);const[v,w,x]=p.model.convert_tokens_to_ids([this.image_tag,this.image_start_tag,this.image_end_tag]);let M=y(g[0]),T=new Array(M.length).fill(!1);for(let $=1;$<g.length;++$){const j=new Array(this.num_image_tokens).fill(v),V=y(g[$]);M=(0,o.mergeArrays)(M,[w],j,[x],V);const L=new Array(this.num_image_tokens).fill(!0);T=(0,o.mergeArrays)(T,[!1],L,[!1],new Array(V.length).fill(!1))}const S=[1,M.length],k={input_ids:new a.Tensor("int64",M,S),attention_mask:new a.Tensor("int64",new Array(M.length).fill(1),S),images_seq_mask:new a.Tensor("bool",T,S),images_emb_mask:new a.Tensor("bool",new Array(_*this.num_image_tokens).fill(!0),[1,_,this.num_image_tokens])};if(h&&h.length>0){const $=await this.image_processor(h);return $.pixel_values.unsqueeze_(0),{...k,...$}}return k}}ce(c,"image_processor_class",s.AutoImageProcessor),ce(c,"tokenizer_class",i.AutoTokenizer),ce(c,"uses_processor_config",!0)},"./src/models/jina_clip/image_processing_jina_clip.js":(t,e,r)=>{r.r(e),r.d(e,{JinaCLIPImageProcessor:()=>s});var n=r("./src/base/image_processors_utils.js");class s extends n.ImageProcessor{constructor(o){const{resize_mode:a,fill_color:l,interpolation:c,size:u,...d}=o,h=a==="squash"?{width:u,height:u}:a==="shortest"?{shortest_edge:u}:{longest_edge:u},f=c==="bicubic"?3:2;super({...d,size:h,resample:f,do_center_crop:!0,crop_size:u,do_normalize:!0})}}},"./src/models/jina_clip/processing_jina_clip.js":(t,e,r)=>{r.r(e),r.d(e,{JinaCLIPProcessor:()=>o});var n=r("./src/base/processing_utils.js"),s=r("./src/models/auto/image_processing_auto.js"),i=r("./src/tokenizers.js");class o extends n.Processor{async _call(l=null,c=null,u={}){if(!l&&!c)throw new Error("Either text or images must be provided");const d=l?this.tokenizer(l,u):{},h=c?await this.image_processor(c,u):{};return{...d,...h}}}ce(o,"tokenizer_class",i.AutoTokenizer),ce(o,"image_processor_class",s.AutoImageProcessor)},"./src/models/llava_onevision/image_processing_llava_onevision.js":(t,e,r)=>{r.r(e),r.d(e,{LlavaOnevisionImageProcessor:()=>s});var n=r("./src/base/image_processors_utils.js");class s extends n.ImageProcessor{}},"./src/models/mask2former/image_processing_mask2former.js":(t,e,r)=>{r.r(e),r.d(e,{Mask2FormerImageProcessor:()=>s});var n=r("./src/models/maskformer/image_processing_maskformer.js");class s extends n.MaskFormerImageProcessor{}},"./src/models/maskformer/image_processing_maskformer.js":(t,e,r)=>{r.r(e),r.d(e,{MaskFormerFeatureExtractor:()=>i,MaskFormerImageProcessor:()=>s});var n=r("./src/base/image_processors_utils.js");class s extends n.ImageProcessor{post_process_panoptic_segmentation(...a){return(0,n.post_process_panoptic_segmentation)(...a)}post_process_instance_segmentation(...a){return(0,n.post_process_instance_segmentation)(...a)}}class i extends s{}},"./src/models/mgp_str/processing_mgp_str.js":(t,e,r)=>{r.r(e),r.d(e,{MgpstrProcessor:()=>l});var n=r("./src/base/processing_utils.js"),s=r("./src/models/auto/image_processing_auto.js"),i=r("./src/tokenizers.js"),o=r("./src/utils/maths.js");const a={char:["char_decode",1],bpe:["bpe_decode",2],wp:["wp_decode",102]};class l extends n.Processor{get char_tokenizer(){return this.components.char_tokenizer}get bpe_tokenizer(){return this.components.bpe_tokenizer}get wp_tokenizer(){return this.components.wp_tokenizer}_decode_helper(u,d){if(!a.hasOwnProperty(d))throw new Error(`Format ${d} is not supported.`);const[h,f]=a[d],p=this[h].bind(this),[m,y]=u.dims,g=[],_=[],v=u.tolist();for(let x=0;x<m;++x){const M=v[x],T=[],S=[];for(let $=1;$<y;++$){const[j,V]=(0,o.max)((0,o.softmax)(M[$]));if(S.push(j),V==f)break;T.push(V)}const k=S.length>0?S.reduce(($,j)=>$*j,1):0;_.push(T),g.push(k)}return[p(_),g]}char_decode(u){return this.char_tokenizer.batch_decode(u).map(d=>d.replaceAll(" ",""))}bpe_decode(u){return this.bpe_tokenizer.batch_decode(u)}wp_decode(u){return this.wp_tokenizer.batch_decode(u).map(d=>d.replaceAll(" ",""))}batch_decode([u,d,h]){const[f,p]=this._decode_helper(u,"char"),[m,y]=this._decode_helper(d,"bpe"),[g,_]=this._decode_helper(h,"wp"),v=[],w=[];for(let x=0;x<f.length;++x){const[M,T]=(0,o.max)([p[x],y[x],_[x]]);v.push([f[x],m[x],g[x]][T]),w.push(M)}return{generated_text:v,scores:w,char_preds:f,bpe_preds:m,wp_preds:g}}static async from_pretrained(...u){const d=await super.from_pretrained(...u),h=await i.AutoTokenizer.from_pretrained("Xenova/gpt2"),f=await i.AutoTokenizer.from_pretrained("Xenova/bert-base-uncased");return d.components={image_processor:d.image_processor,char_tokenizer:d.tokenizer,bpe_tokenizer:h,wp_tokenizer:f},d}async _call(u,d=null){const h=await this.image_processor(u);return d&&(h.labels=this.tokenizer(d).input_ids),h}}ce(l,"tokenizer_class",i.AutoTokenizer),ce(l,"image_processor_class",s.AutoImageProcessor)},"./src/models/mobilenet_v1/image_processing_mobilenet_v1.js":(t,e,r)=>{r.r(e),r.d(e,{MobileNetV1FeatureExtractor:()=>i,MobileNetV1ImageProcessor:()=>s});var n=r("./src/base/image_processors_utils.js");class s extends n.ImageProcessor{}class i extends s{}},"./src/models/mobilenet_v2/image_processing_mobilenet_v2.js":(t,e,r)=>{r.r(e),r.d(e,{MobileNetV2FeatureExtractor:()=>i,MobileNetV2ImageProcessor:()=>s});var n=r("./src/base/image_processors_utils.js");class s extends n.ImageProcessor{}class i extends s{}},"./src/models/mobilenet_v3/image_processing_mobilenet_v3.js":(t,e,r)=>{r.r(e),r.d(e,{MobileNetV3FeatureExtractor:()=>i,MobileNetV3ImageProcessor:()=>s});var n=r("./src/base/image_processors_utils.js");class s extends n.ImageProcessor{}class i extends s{}},"./src/models/mobilenet_v4/image_processing_mobilenet_v4.js":(t,e,r)=>{r.r(e),r.d(e,{MobileNetV4FeatureExtractor:()=>i,MobileNetV4ImageProcessor:()=>s});var n=r("./src/base/image_processors_utils.js");class s extends n.ImageProcessor{}class i extends s{}},"./src/models/mobilevit/image_processing_mobilevit.js":(t,e,r)=>{r.r(e),r.d(e,{MobileViTFeatureExtractor:()=>i,MobileViTImageProcessor:()=>s});var n=r("./src/base/image_processors_utils.js");class s extends n.ImageProcessor{}class i extends s{}},"./src/models/moonshine/feature_extraction_moonshine.js":(t,e,r)=>{r.r(e),r.d(e,{MoonshineFeatureExtractor:()=>i});var n=r("./src/base/feature_extraction_utils.js"),s=r("./src/utils/tensor.js");class i extends n.FeatureExtractor{async _call(a){(0,n.validate_audio_inputs)(a,"MoonshineFeatureExtractor"),a instanceof Float64Array&&(a=new Float32Array(a));const l=[1,a.length];return{input_values:new s.Tensor("float32",a,l)}}}},"./src/models/moonshine/processing_moonshine.js":(t,e,r)=>{r.r(e),r.d(e,{MoonshineProcessor:()=>o});var n=r("./src/models/auto/feature_extraction_auto.js"),s=r("./src/tokenizers.js"),i=r("./src/base/processing_utils.js");class o extends i.Processor{async _call(l){return await this.feature_extractor(l)}}ce(o,"tokenizer_class",s.AutoTokenizer),ce(o,"feature_extractor_class",n.AutoFeatureExtractor)},"./src/models/nougat/image_processing_nougat.js":(t,e,r)=>{r.r(e),r.d(e,{NougatImageProcessor:()=>s});var n=r("./src/models/donut/image_processing_donut.js");class s extends n.DonutImageProcessor{}},"./src/models/owlv2/image_processing_owlv2.js":(t,e,r)=>{r.r(e),r.d(e,{Owlv2ImageProcessor:()=>s});var n=r("./src/models/owlvit/image_processing_owlvit.js");class s extends n.OwlViTImageProcessor{}},"./src/models/owlvit/image_processing_owlvit.js":(t,e,r)=>{r.r(e),r.d(e,{OwlViTFeatureExtractor:()=>i,OwlViTImageProcessor:()=>s});var n=r("./src/base/image_processors_utils.js");class s extends n.ImageProcessor{post_process_object_detection(...a){return(0,n.post_process_object_detection)(...a)}}class i extends s{}},"./src/models/owlvit/processing_owlvit.js":(t,e,r)=>{r.r(e),r.d(e,{OwlViTProcessor:()=>o});var n=r("./src/base/processing_utils.js"),s=r("./src/models/auto/image_processing_auto.js"),i=r("./src/tokenizers.js");class o extends n.Processor{}ce(o,"tokenizer_class",i.AutoTokenizer),ce(o,"image_processor_class",s.AutoImageProcessor)},"./src/models/paligemma/processing_paligemma.js":(t,e,r)=>{r.r(e),r.d(e,{PaliGemmaProcessor:()=>l});var n=r("./src/base/processing_utils.js"),s=r("./src/models/auto/image_processing_auto.js"),i=r("./src/tokenizers.js");const o="<image>";function a(c,u,d,h,f){return`${h.repeat(d*f)}${u}${c}
`}class l extends n.Processor{async _call(u,d=null,h={}){d||(console.warn("You are using PaliGemma without a text prefix. It will perform as a picture-captioning model."),d=""),Array.isArray(u)||(u=[u]),Array.isArray(d)||(d=[d]);const f=this.tokenizer.bos_token,p=this.image_processor.config.image_seq_length;let m;d.some(_=>_.includes(o))?m=d.map(_=>{const v=_.replaceAll(o,o.repeat(p)),w=v.lastIndexOf(o),x=w===-1?0:w+o.length;return v.slice(0,x)+f+v.slice(x)+`
`}):(console.warn("You are passing both `text` and `images` to `PaliGemmaProcessor`. The processor expects special image tokens in the text, as many tokens as there are images per each text. It is recommended to add `<image>` tokens in the very beginning of your text. For this call, we will infer how many images each text has and add special tokens."),m=d.map(_=>a(_,f,p,o,u.length)));const y=this.tokenizer(m,h);return{...await this.image_processor(u,h),...y}}}ce(l,"tokenizer_class",i.AutoTokenizer),ce(l,"image_processor_class",s.AutoImageProcessor),ce(l,"uses_processor_config",!1)},"./src/models/phi3_v/image_processing_phi3_v.js":(t,e,r)=>{r.r(e),r.d(e,{Phi3VImageProcessor:()=>u});var n=r("./src/base/image_processors_utils.js"),s=r("./src/utils/tensor.js");const i=336,o=[2,3],{ceil:a,floor:l,sqrt:c}=Math;class u extends n.ImageProcessor{constructor(h){super({...h,do_normalize:!0,do_pad:!0,pad_size:"custom",do_convert_rgb:!0,do_resize:!0}),this._num_crops=h.num_crops}calc_num_image_tokens_from_image_size(h,f){const{num_img_tokens:p}=this.config;return l((l(f/i)*l(h/i)+1)*p+1+(l(f/i)+1)*c(p))}get_resize_output_image_size(h,f){const p=this._num_crops,[m,y]=h.size;let g=m/y,_=1;for(;_*Math.ceil(_/g)<=p;)_+=1;_-=1;const v=Math.floor(_*336),w=Math.floor(v/g);return[v,w]}pad_image(h,f,p,m={}){const[y,g]=f,_=i*a(y/i),v=i*a(g/i),w=[1,1,1].map((x,M)=>(x-this.image_mean[M])/this.image_std[M]);return super.pad_image(h,f,{width:v,height:_},{center:!0,constant_values:w,...m})}async _call(h,{num_crops:f=null}={}){if(this._num_crops=f??(f=this.config.num_crops),f<4||c(f)%1!==0)throw new Error("num_crops must be a square number >= 4");Array.isArray(h)||(h=[h]);const p=h.length,m=await Promise.all(h.map(T=>this.preprocess(T))),y=m.map(T=>T.original_size),g=m.map(T=>T.reshaped_input_size),_=[];for(const{pixel_values:T}of m){T.unsqueeze_(0);const[S,k]=T.dims.slice(-2),$=await(0,s.interpolate_4d)(T,{size:[i,i],mode:"bicubic"});if(f>0){const j=[],V=c(f),L=l(k/V),X=l(S/V);for(let Y=0;Y<V;++Y)for(let J=0;J<V;++J){let N,ne,te,z;Y===V-1?(ne=S-X,z=S):(ne=Y*X,z=(Y+1)*X),J===V-1?(N=k-L,te=k):(N=J*L,te=(J+1)*L);const O=[ne,N],H=[z,te],re=await(0,s.slice)(T,O,H,o);j.push(re)}const K=await(0,s.interpolate_4d)((0,s.cat)(j,0),{size:[i,i],mode:"bicubic"});_.push((0,s.cat)([$,K],0))}else _.push($)}const v=(0,s.stack)(_,0),w=g.map(T=>T.map(S=>i*a(S/i))),x=new s.Tensor("int64",w.flat(),[p,2]),M=w.map(([T,S])=>this.calc_num_image_tokens_from_image_size(S,T));return{pixel_values:v,original_sizes:y,reshaped_input_sizes:g,image_sizes:x,num_img_tokens:M}}}},"./src/models/phi3_v/processing_phi3_v.js":(t,e,r)=>{r.r(e),r.d(e,{Phi3VProcessor:()=>l});var n=r("./src/base/processing_utils.js"),s=r("./src/models/auto/image_processing_auto.js"),i=r("./src/tokenizers.js");r("./src/utils/image.js");const o="<|image|>",a=/<\|image_\d+\|>/g;class l extends n.Processor{async _call(u,d=null,{padding:h=!0,truncation:f=!0,num_crops:p=null}={}){Array.isArray(u)||(u=[u]);let m,y;if(d){y=await this.image_processor(d,{num_crops:p});const{num_img_tokens:g}=y,_=u.map((w,x)=>w.split(a).join(o.repeat(g[x])));m=this.tokenizer(_,{padding:h,truncation:f});const v=this.tokenizer.model.convert_tokens_to_ids([o])[0];m.input_ids.map_(w=>w==v?-w:w)}else m=this.tokenizer(u);return{...m,...y}}}ce(l,"image_processor_class",s.AutoImageProcessor),ce(l,"tokenizer_class",i.AutoTokenizer)},"./src/models/processors.js":(t,e,r)=>{r.r(e),r.d(e,{Florence2Processor:()=>n.Florence2Processor,GroundingDinoProcessor:()=>s.GroundingDinoProcessor,Idefics3Processor:()=>i.Idefics3Processor,JinaCLIPProcessor:()=>a.JinaCLIPProcessor,MgpstrProcessor:()=>l.MgpstrProcessor,MoonshineProcessor:()=>c.MoonshineProcessor,OwlViTProcessor:()=>u.OwlViTProcessor,PaliGemmaProcessor:()=>h.PaliGemmaProcessor,Phi3VProcessor:()=>d.Phi3VProcessor,PyAnnoteProcessor:()=>f.PyAnnoteProcessor,Qwen2VLProcessor:()=>p.Qwen2VLProcessor,SamProcessor:()=>m.SamProcessor,SmolVLMProcessor:()=>y.SmolVLMProcessor,SpeechT5Processor:()=>g.SpeechT5Processor,UltravoxProcessor:()=>_.UltravoxProcessor,VLChatProcessor:()=>o.VLChatProcessor,Wav2Vec2Processor:()=>v.Wav2Vec2Processor,Wav2Vec2ProcessorWithLM:()=>w.Wav2Vec2ProcessorWithLM,WhisperProcessor:()=>x.WhisperProcessor});var n=r("./src/models/florence2/processing_florence2.js"),s=r("./src/models/grounding_dino/processing_grounding_dino.js"),i=r("./src/models/idefics3/processing_idefics3.js"),o=r("./src/models/janus/processing_janus.js"),a=r("./src/models/jina_clip/processing_jina_clip.js"),l=r("./src/models/mgp_str/processing_mgp_str.js"),c=r("./src/models/moonshine/processing_moonshine.js"),u=r("./src/models/owlvit/processing_owlvit.js"),d=r("./src/models/phi3_v/processing_phi3_v.js"),h=r("./src/models/paligemma/processing_paligemma.js"),f=r("./src/models/pyannote/processing_pyannote.js"),p=r("./src/models/qwen2_vl/processing_qwen2_vl.js"),m=r("./src/models/sam/processing_sam.js"),y=r("./src/models/smolvlm/processing_smolvlm.js"),g=r("./src/models/speecht5/processing_speecht5.js"),_=r("./src/models/ultravox/processing_ultravox.js"),v=r("./src/models/wav2vec2/processing_wav2vec2.js"),w=r("./src/models/wav2vec2_with_lm/processing_wav2vec2_with_lm.js"),x=r("./src/models/whisper/processing_whisper.js")},"./src/models/pvt/image_processing_pvt.js":(t,e,r)=>{r.r(e),r.d(e,{PvtImageProcessor:()=>s});var n=r("./src/base/image_processors_utils.js");class s extends n.ImageProcessor{}},"./src/models/pyannote/feature_extraction_pyannote.js":(t,e,r)=>{r.r(e),r.d(e,{PyAnnoteFeatureExtractor:()=>o});var n=r("./src/base/feature_extraction_utils.js"),s=r("./src/utils/tensor.js"),i=r("./src/utils/maths.js");class o extends n.FeatureExtractor{async _call(l){(0,n.validate_audio_inputs)(l,"PyAnnoteFeatureExtractor"),l instanceof Float64Array&&(l=new Float32Array(l));const c=[1,1,l.length];return{input_values:new s.Tensor("float32",l,c)}}samples_to_frames(l){return(l-this.config.offset)/this.config.step}post_process_speaker_diarization(l,c){const u=c/this.samples_to_frames(c)/this.config.sampling_rate,d=[];for(const h of l.tolist()){const f=[];let p=-1;for(let m=0;m<h.length;++m){const y=(0,i.softmax)(h[m]),[g,_]=(0,i.max)(y),[v,w]=[m,m+1];_!==p?(p=_,f.push({id:_,start:v,end:w,score:g})):(f.at(-1).end=w,f.at(-1).score+=g)}d.push(f.map(({id:m,start:y,end:g,score:_})=>({id:m,start:y*u,end:g*u,confidence:_/(g-y)})))}return d}}},"./src/models/pyannote/processing_pyannote.js":(t,e,r)=>{r.r(e),r.d(e,{PyAnnoteProcessor:()=>i});var n=r("./src/base/processing_utils.js"),s=r("./src/models/pyannote/feature_extraction_pyannote.js");class i extends n.Processor{async _call(a){return await this.feature_extractor(a)}post_process_speaker_diarization(...a){return this.feature_extractor.post_process_speaker_diarization(...a)}get sampling_rate(){return this.feature_extractor.config.sampling_rate}}ce(i,"feature_extractor_class",s.PyAnnoteFeatureExtractor)},"./src/models/qwen2_vl/image_processing_qwen2_vl.js":(t,e,r)=>{r.r(e),r.d(e,{Qwen2VLImageProcessor:()=>i});var n=r("./src/base/image_processors_utils.js"),s=r("./src/utils/tensor.js");class i extends n.ImageProcessor{async _call(a,...l){const{pixel_values:c,original_sizes:u,reshaped_input_sizes:d}=await super._call(a,...l);let h=c;const{temporal_patch_size:f,merge_size:p,patch_size:m}=this.config;h.dims[0]===1&&(h=(0,s.cat)(Array.from({length:f},()=>h),0));const y=h.dims[0]/f,g=h.dims[1],_=Math.floor(h.dims[2]/m),v=Math.floor(h.dims[3]/m),w=h.view(y,f,g,Math.floor(_/p),p,m,Math.floor(v/p),p,m).permute(0,3,6,4,7,2,1,5,8).view(y*_*v,g*f*m*m),x=new s.Tensor("int64",[y,_,v],[1,3]);return{pixel_values:w,image_grid_thw:x,original_sizes:u,reshaped_input_sizes:d}}}},"./src/models/qwen2_vl/processing_qwen2_vl.js":(t,e,r)=>{r.r(e),r.d(e,{Qwen2VLProcessor:()=>o});var n=r("./src/base/processing_utils.js"),s=r("./src/models/auto/image_processing_auto.js"),i=r("./src/tokenizers.js");r("./src/utils/image.js");class o extends n.Processor{async _call(l,c=null,...u){Array.isArray(l)||(l=[l]);let d,h;if(c&&(d=await this.image_processor(c),h=d.image_grid_thw),h){let p=this.image_processor.config.merge_size**2,m=0;const y=h.tolist();l=l.map(g=>{for(;g.includes("<|image_pad|>");){const _=Number(y[m++].reduce((v,w)=>v*w,1n));g=g.replace("<|image_pad|>","<|placeholder|>".repeat(Math.floor(_/p)))}return g.replaceAll("<|placeholder|>","<|image_pad|>")})}return{...this.tokenizer(l),...d}}}ce(o,"image_processor_class",s.AutoImageProcessor),ce(o,"tokenizer_class",i.AutoTokenizer)},"./src/models/rt_detr/image_processing_rt_detr.js":(t,e,r)=>{r.r(e),r.d(e,{RTDetrImageProcessor:()=>s});var n=r("./src/base/image_processors_utils.js");class s extends n.ImageProcessor{post_process_object_detection(...o){return(0,n.post_process_object_detection)(...o)}}},"./src/models/sam/image_processing_sam.js":(t,e,r)=>{r.r(e),r.d(e,{SamImageProcessor:()=>o});var n=r("./src/base/image_processors_utils.js"),s=r("./src/utils/core.js"),i=r("./src/utils/tensor.js");class o extends n.ImageProcessor{reshape_input_points(l,c,u,d=!1){l=structuredClone(l);let h=(0,s.calculateDimensions)(l);if(h.length===3)d||(h=[1,...h]),l=[l];else if(h.length!==4)throw Error("The input_points must be a 4D tensor of shape `batch_size`, `point_batch_size`, `nb_points_per_image`, `2`.");for(let f=0;f<l.length;++f){let p=c[f],m=u[f],y=[m[0]/p[0],m[1]/p[1]];for(let g=0;g<l[f].length;++g)for(let _=0;_<l[f][g].length;++_)for(let v=0;v<l[f][g][_].length;++v)l[f][g][_][v]*=y[v%2]}return new i.Tensor("float32",Float32Array.from(l.flat(1/0)),h)}add_input_labels(l,c){let u=(0,s.calculateDimensions)(l);if(u.length===2)u=[1,...u],l=[l];else if(u.length!==3)throw Error("The input_points must be a 4D tensor of shape `batch_size`, `point_batch_size`, `nb_points_per_image`, `2`.");if(u.some((d,h)=>d!==c.dims[h]))throw Error(`The first ${u.length} dimensions of 'input_points' and 'input_labels' must be the same.`);return new i.Tensor("int64",l.flat(1/0).map(BigInt),u)}async _call(l,{input_points:c=null,input_labels:u=null,input_boxes:d=null}={}){const h=await super._call(l);if(c&&(h.input_points=this.reshape_input_points(c,h.original_sizes,h.reshaped_input_sizes)),u){if(!h.input_points)throw Error("`input_points` must be provided if `input_labels` are provided.");h.input_labels=this.add_input_labels(u,h.input_points)}return d&&(h.input_boxes=this.reshape_input_points(d,h.original_sizes,h.reshaped_input_sizes,!0)),h}async post_process_masks(l,c,u,{mask_threshold:d=0,binarize:h=!0,pad_size:f=null}={}){const p=[];f=f??this.pad_size;const m=[f.height,f.width];for(let y=0;y<c.length;++y){const g=c[y],_=u[y];let v=await(0,i.interpolate_4d)(l[y],{mode:"bilinear",size:m});if(v=v.slice(null,null,[0,_[0]],[0,_[1]]),v=await(0,i.interpolate_4d)(v,{mode:"bilinear",size:g}),h){const w=v.data,x=new Uint8Array(w.length);for(let M=0;M<w.length;++M)w[M]>d&&(x[M]=1);v=new i.Tensor("bool",x,v.dims)}p.push(v)}return p}generate_crop_boxes(l,c,{crop_n_layers:u=0,overlap_ratio:d=512/1500,points_per_crop:h=32,crop_n_points_downscale_factor:f=1}={}){}}},"./src/models/sam/processing_sam.js":(t,e,r)=>{r.r(e),r.d(e,{SamProcessor:()=>i});var n=r("./src/base/processing_utils.js"),s=r("./src/models/auto/image_processing_auto.js");class i extends n.Processor{async _call(...a){return await this.image_processor(...a)}post_process_masks(...a){return this.image_processor.post_process_masks(...a)}reshape_input_points(...a){return this.image_processor.reshape_input_points(...a)}}ce(i,"image_processor_class",s.AutoImageProcessor)},"./src/models/seamless_m4t/feature_extraction_seamless_m4t.js":(t,e,r)=>{r.r(e),r.d(e,{SeamlessM4TFeatureExtractor:()=>o});var n=r("./src/base/feature_extraction_utils.js"),s=r("./src/utils/tensor.js"),i=r("./src/utils/audio.js");class o extends n.FeatureExtractor{constructor(l){super(l);const c=this.config.sampling_rate,u=(0,i.mel_filter_bank)(257,this.config.num_mel_bins,20,Math.floor(c/2),c,null,"kaldi",!0);this.mel_filters=u,this.window=(0,i.window_function)(400,"povey",{periodic:!1})}async _extract_fbank_features(l,c){return l=l.map(u=>u*32768),(0,i.spectrogram)(l,this.window,400,160,{fft_length:512,power:2,center:!1,preemphasis:.97,mel_filters:this.mel_filters,log_mel:"log",mel_floor:1192092955078125e-22,remove_dc_offset:!0,max_num_frames:c,transpose:!0})}async _call(l,{padding:c=!0,pad_to_multiple_of:u=2,do_normalize_per_mel_bins:d=!0,return_attention_mask:h=!0}={}){(0,n.validate_audio_inputs)(l,"SeamlessM4TFeatureExtractor");let f=await this._extract_fbank_features(l,this.config.max_length);if(d){const[x,M]=f.dims,T=f.data;for(let S=0;S<M;++S){let k=0;for(let L=0;L<x;++L)k+=T[L*M+S];const $=k/x;let j=0;for(let L=0;L<x;++L)j+=(T[L*M+S]-$)**2;j/=x-1;const V=Math.sqrt(j+1e-7);for(let L=0;L<x;++L){const X=L*M+S;T[X]=(T[X]-$)/V}}}let p;if(c){const[x,M]=f.dims,T=f.data,S=x%u;if(S>0){const k=new Float32Array(M*(x+S));k.set(T),k.fill(this.config.padding_value,T.length);const $=x+S;f=new s.Tensor(f.type,k,[$,M]),h&&(p=new s.Tensor("int64",new BigInt64Array($),[1,$]),p.data.fill(1n,0,x))}}const[m,y]=f.dims,g=this.config.stride;if(m%g!==0)throw new Error(`The number of frames (${m}) must be a multiple of the stride (${g}).`);const v=f.view(1,Math.floor(m/g),y*g),w={input_features:v};if(h){const x=v.dims[1],M=new BigInt64Array(x);if(p){const T=p.data;for(let S=1,k=0;S<m;S+=g,++k)M[k]=T[S]}else M.fill(1n);w.attention_mask=new s.Tensor("int64",M,[1,x])}return w}}},"./src/models/segformer/image_processing_segformer.js":(t,e,r)=>{r.r(e),r.d(e,{SegformerFeatureExtractor:()=>i,SegformerImageProcessor:()=>s});var n=r("./src/base/image_processors_utils.js");class s extends n.ImageProcessor{post_process_semantic_segmentation(...a){return(0,n.post_process_semantic_segmentation)(...a)}}class i extends s{}},"./src/models/siglip/image_processing_siglip.js":(t,e,r)=>{r.r(e),r.d(e,{SiglipImageProcessor:()=>s});var n=r("./src/base/image_processors_utils.js");class s extends n.ImageProcessor{}},"./src/models/smolvlm/image_processing_smolvlm.js":(t,e,r)=>{r.r(e),r.d(e,{SmolVLMImageProcessor:()=>n.Idefics3ImageProcessor});var n=r("./src/models/idefics3/image_processing_idefics3.js")},"./src/models/smolvlm/processing_smolvlm.js":(t,e,r)=>{r.r(e),r.d(e,{SmolVLMProcessor:()=>n.Idefics3Processor});var n=r("./src/models/idefics3/processing_idefics3.js")},"./src/models/snac/feature_extraction_snac.js":(t,e,r)=>{r.r(e),r.d(e,{SnacFeatureExtractor:()=>s});var n=r("./src/models/dac/feature_extraction_dac.js");class s extends n.DacFeatureExtractor{}},"./src/models/speecht5/feature_extraction_speecht5.js":(t,e,r)=>{r.r(e),r.d(e,{SpeechT5FeatureExtractor:()=>s});var n=r("./src/base/feature_extraction_utils.js");class s extends n.FeatureExtractor{}},"./src/models/speecht5/processing_speecht5.js":(t,e,r)=>{r.r(e),r.d(e,{SpeechT5Processor:()=>o});var n=r("./src/base/processing_utils.js"),s=r("./src/tokenizers.js"),i=r("./src/models/auto/feature_extraction_auto.js");class o extends n.Processor{async _call(l){return await this.feature_extractor(l)}}ce(o,"tokenizer_class",s.AutoTokenizer),ce(o,"feature_extractor_class",i.AutoFeatureExtractor)},"./src/models/swin2sr/image_processing_swin2sr.js":(t,e,r)=>{r.r(e),r.d(e,{Swin2SRImageProcessor:()=>s});var n=r("./src/base/image_processors_utils.js");class s extends n.ImageProcessor{pad_image(o,a,l,c={}){const[u,d,h]=a;return super.pad_image(o,a,{width:d+(l-d%l)%l,height:u+(l-u%l)%l},{mode:"symmetric",center:!1,constant_values:-1,...c})}}},"./src/models/ultravox/processing_ultravox.js":(t,e,r)=>{r.r(e),r.d(e,{UltravoxProcessor:()=>o});var n=r("./src/models/auto/feature_extraction_auto.js"),s=r("./src/tokenizers.js"),i=r("./src/base/processing_utils.js");class o extends i.Processor{async _call(l,c=null,u={}){if(Array.isArray(l))throw new Error("Batched inputs are not supported yet.");let d={};if(c){const f=c.length,{input_features:p}=await this.feature_extractor(c,{...u,max_length:f}),m=Math.round(f/this.config.encoder_ds_factor+1e-4),y=1+Math.ceil(m/this.config.stack_factor);d.audio_token_len=[y],d.audio_values=p;const g=this.config.audio_placeholder;if(!l.includes(g))throw new Error(`The input text does not contain the image token ${g}.`);l=l.replaceAll(g,g.repeat(y))}return{...this.tokenizer(l,{add_special_tokens:!1,...u}),...d}}}ce(o,"tokenizer_class",s.AutoTokenizer),ce(o,"feature_extractor_class",n.AutoFeatureExtractor),ce(o,"uses_processor_config",!0)},"./src/models/vit/image_processing_vit.js":(t,e,r)=>{r.r(e),r.d(e,{ViTFeatureExtractor:()=>i,ViTImageProcessor:()=>s});var n=r("./src/base/image_processors_utils.js");class s extends n.ImageProcessor{}class i extends s{}},"./src/models/vitmatte/image_processing_vitmatte.js":(t,e,r)=>{r.r(e),r.d(e,{VitMatteImageProcessor:()=>i});var n=r("./src/base/image_processors_utils.js"),s=r("./src/utils/tensor.js");class i extends n.ImageProcessor{async _call(a,l){Array.isArray(a)||(a=[a]),Array.isArray(l)||(l=[l]);const c=await Promise.all(a.map(h=>this.preprocess(h))),u=await Promise.all(l.map(h=>this.preprocess(h,{do_normalize:!1,do_convert_rgb:!1,do_convert_grayscale:!0})));return{pixel_values:(0,s.stack)(c.map((h,f)=>(0,s.cat)([h.pixel_values,u[f].pixel_values],0)),0),original_sizes:c.map(h=>h.original_size),reshaped_input_sizes:c.map(h=>h.reshaped_input_size)}}}},"./src/models/vitpose/image_processing_vitpose.js":(t,e,r)=>{r.r(e),r.d(e,{VitPoseImageProcessor:()=>s});var n=r("./src/base/image_processors_utils.js");class s extends n.ImageProcessor{post_process_pose_estimation(o,a,{threshold:l=null}={}){const c=o.tolist(),[u,d,h,f]=o.dims,p=[];for(let m=0;m<u;++m){const y=c[m],g=a[m],_=[];for(let v=0;v<g.length;++v){const w=g[v],x=[],M=[],T=[],S=w.at(-2)/f,k=w.at(-1)/h;for(let $=0;$<y.length;++$){let[j,V]=[0,0],L=0,X=-1/0;const K=y[$];for(let J=0;J<K.length;++J){const N=K[J];for(let ne=0;ne<N.length;++ne){const te=N[ne];L+=te,X=Math.max(X,te),j+=(ne+.5)*te,V+=J*te}}if(l!=null&&X<l)continue;const Y=[S*j/L,k*V/L];x.push(Y),T.push($),M.push(X)}_.push({bbox:w,scores:M,labels:T,keypoints:x})}p.push(_)}return p}}},"./src/models/wav2vec2/feature_extraction_wav2vec2.js":(t,e,r)=>{r.r(e),r.d(e,{Wav2Vec2FeatureExtractor:()=>i});var n=r("./src/base/feature_extraction_utils.js"),s=r("./src/utils/tensor.js");class i extends n.FeatureExtractor{_zero_mean_unit_var_norm(a){const c=a.reduce((d,h)=>d+h,0)/a.length,u=a.reduce((d,h)=>d+(h-c)**2,0)/a.length;return a.map(d=>(d-c)/Math.sqrt(u+1e-7))}async _call(a){(0,n.validate_audio_inputs)(a,"Wav2Vec2FeatureExtractor"),a instanceof Float64Array&&(a=new Float32Array(a));let l=a;this.config.do_normalize&&(l=this._zero_mean_unit_var_norm(l));const c=[1,l.length];return{input_values:new s.Tensor("float32",l,c),attention_mask:new s.Tensor("int64",new BigInt64Array(l.length).fill(1n),c)}}}},"./src/models/wav2vec2/processing_wav2vec2.js":(t,e,r)=>{r.r(e),r.d(e,{Wav2Vec2Processor:()=>o});var n=r("./src/tokenizers.js"),s=r("./src/models/auto/feature_extraction_auto.js"),i=r("./src/base/processing_utils.js");class o extends i.Processor{async _call(l){return await this.feature_extractor(l)}}ce(o,"tokenizer_class",n.AutoTokenizer),ce(o,"feature_extractor_class",s.AutoFeatureExtractor)},"./src/models/wav2vec2_with_lm/processing_wav2vec2_with_lm.js":(t,e,r)=>{r.r(e),r.d(e,{Wav2Vec2ProcessorWithLM:()=>o});var n=r("./src/tokenizers.js"),s=r("./src/models/auto/feature_extraction_auto.js"),i=r("./src/base/processing_utils.js");class o extends i.Processor{async _call(l){return await this.feature_extractor(l)}}ce(o,"tokenizer_class",n.AutoTokenizer),ce(o,"feature_extractor_class",s.AutoFeatureExtractor)},"./src/models/wespeaker/feature_extraction_wespeaker.js":(t,e,r)=>{r.r(e),r.d(e,{WeSpeakerFeatureExtractor:()=>i});var n=r("./src/base/feature_extraction_utils.js");r("./src/utils/tensor.js");var s=r("./src/utils/audio.js");class i extends n.FeatureExtractor{constructor(a){super(a);const l=this.config.sampling_rate,c=(0,s.mel_filter_bank)(257,this.config.num_mel_bins,20,Math.floor(l/2),l,null,"kaldi",!0);this.mel_filters=c,this.window=(0,s.window_function)(400,"hamming",{periodic:!1}),this.min_num_frames=this.config.min_num_frames}async _extract_fbank_features(a){return a=a.map(l=>l*32768),(0,s.spectrogram)(a,this.window,400,160,{fft_length:512,power:2,center:!1,preemphasis:.97,mel_filters:this.mel_filters,log_mel:"log",mel_floor:1192092955078125e-22,remove_dc_offset:!0,transpose:!0,min_num_frames:this.min_num_frames})}async _call(a){(0,n.validate_audio_inputs)(a,"WeSpeakerFeatureExtractor");const l=(await this._extract_fbank_features(a)).unsqueeze_(0);if(this.config.fbank_centering_span===null){const c=l.mean(1).data,u=l.data,[d,h,f]=l.dims;for(let p=0;p<d;++p){const m=p*h*f,y=p*f;for(let g=0;g<h;++g){const _=m+g*f;for(let v=0;v<f;++v)u[_+v]-=c[y+v]}}}return{input_features:l}}}},"./src/models/whisper/common_whisper.js":(t,e,r)=>{r.r(e),r.d(e,{WHISPER_LANGUAGE_MAPPING:()=>s,WHISPER_TO_LANGUAGE_CODE_MAPPING:()=>i,whisper_language_to_code:()=>o});const n=[["en","english"],["zh","chinese"],["de","german"],["es","spanish"],["ru","russian"],["ko","korean"],["fr","french"],["ja","japanese"],["pt","portuguese"],["tr","turkish"],["pl","polish"],["ca","catalan"],["nl","dutch"],["ar","arabic"],["sv","swedish"],["it","italian"],["id","indonesian"],["hi","hindi"],["fi","finnish"],["vi","vietnamese"],["he","hebrew"],["uk","ukrainian"],["el","greek"],["ms","malay"],["cs","czech"],["ro","romanian"],["da","danish"],["hu","hungarian"],["ta","tamil"],["no","norwegian"],["th","thai"],["ur","urdu"],["hr","croatian"],["bg","bulgarian"],["lt","lithuanian"],["la","latin"],["mi","maori"],["ml","malayalam"],["cy","welsh"],["sk","slovak"],["te","telugu"],["fa","persian"],["lv","latvian"],["bn","bengali"],["sr","serbian"],["az","azerbaijani"],["sl","slovenian"],["kn","kannada"],["et","estonian"],["mk","macedonian"],["br","breton"],["eu","basque"],["is","icelandic"],["hy","armenian"],["ne","nepali"],["mn","mongolian"],["bs","bosnian"],["kk","kazakh"],["sq","albanian"],["sw","swahili"],["gl","galician"],["mr","marathi"],["pa","punjabi"],["si","sinhala"],["km","khmer"],["sn","shona"],["yo","yoruba"],["so","somali"],["af","afrikaans"],["oc","occitan"],["ka","georgian"],["be","belarusian"],["tg","tajik"],["sd","sindhi"],["gu","gujarati"],["am","amharic"],["yi","yiddish"],["lo","lao"],["uz","uzbek"],["fo","faroese"],["ht","haitian creole"],["ps","pashto"],["tk","turkmen"],["nn","nynorsk"],["mt","maltese"],["sa","sanskrit"],["lb","luxembourgish"],["my","myanmar"],["bo","tibetan"],["tl","tagalog"],["mg","malagasy"],["as","assamese"],["tt","tatar"],["haw","hawaiian"],["ln","lingala"],["ha","hausa"],["ba","bashkir"],["jw","javanese"],["su","sundanese"]],s=new Map(n),i=new Map([...n.map(([a,l])=>[l,a]),["burmese","my"],["valencian","ca"],["flemish","nl"],["haitian","ht"],["letzeburgesch","lb"],["pushto","ps"],["panjabi","pa"],["moldavian","ro"],["moldovan","ro"],["sinhalese","si"],["castilian","es"]]);function o(a){a=a.toLowerCase();let l=i.get(a);if(l===void 0){const c=a.match(/^<\|([a-z]{2})\|>$/);if(c&&(a=c[1]),s.has(a))l=a;else{const d=a.length===2?s.keys():s.values();throw new Error(`Language "${a}" is not supported. Must be one of: ${JSON.stringify(Array.from(d))}`)}}return l}},"./src/models/whisper/feature_extraction_whisper.js":(t,e,r)=>{r.r(e),r.d(e,{WhisperFeatureExtractor:()=>o});var n=r("./src/base/feature_extraction_utils.js");r("./src/utils/tensor.js");var s=r("./src/utils/audio.js"),i=r("./src/utils/maths.js");class o extends n.FeatureExtractor{constructor(l){var c;super(l),(c=this.config).mel_filters??(c.mel_filters=(0,s.mel_filter_bank)(Math.floor(1+this.config.n_fft/2),this.config.feature_size,0,8e3,this.config.sampling_rate,"slaney","slaney")),this.window=(0,s.window_function)(this.config.n_fft,"hann")}async _extract_fbank_features(l){const c=await(0,s.spectrogram)(l,this.window,this.config.n_fft,this.config.hop_length,{power:2,mel_filters:this.config.mel_filters,log_mel:"log10",max_num_frames:Math.min(Math.floor(l.length/this.config.hop_length),this.config.nb_max_frames)}),u=c.data,d=(0,i.max)(u)[0];for(let h=0;h<u.length;++h)u[h]=(Math.max(u[h],d-8)+4)/4;return c}async _call(l,{max_length:c=null}={}){(0,n.validate_audio_inputs)(l,"WhisperFeatureExtractor");let u;const d=c??this.config.n_samples;return l.length>d?(l.length>this.config.n_samples&&console.warn("Attempting to extract features for audio longer than 30 seconds. If using a pipeline to extract transcript from a long audio clip, remember to specify `chunk_length_s` and/or `stride_length_s`."),u=l.slice(0,d)):(u=new Float32Array(d),u.set(l)),{input_features:(await this._extract_fbank_features(u)).unsqueeze_(0)}}}},"./src/models/whisper/generation_whisper.js":(t,e,r)=>{r.r(e),r.d(e,{WhisperGenerationConfig:()=>s});var n=r("./src/generation/configuration_utils.js");class s extends n.GenerationConfig{constructor(){super(...arguments);ce(this,"return_timestamps",null);ce(this,"return_token_timestamps",null);ce(this,"num_frames",null);ce(this,"alignment_heads",null);ce(this,"task",null);ce(this,"language",null);ce(this,"no_timestamps_token_id",null);ce(this,"prompt_ids",null);ce(this,"is_multilingual",null);ce(this,"lang_to_id",null);ce(this,"task_to_id",null);ce(this,"max_initial_timestamp_index",1)}}},"./src/models/whisper/processing_whisper.js":(t,e,r)=>{r.r(e),r.d(e,{WhisperProcessor:()=>o});var n=r("./src/models/auto/feature_extraction_auto.js"),s=r("./src/tokenizers.js"),i=r("./src/base/processing_utils.js");class o extends i.Processor{async _call(l){return await this.feature_extractor(l)}}ce(o,"tokenizer_class",s.AutoTokenizer),ce(o,"feature_extractor_class",n.AutoFeatureExtractor)},"./src/models/yolos/image_processing_yolos.js":(t,e,r)=>{r.r(e),r.d(e,{YolosFeatureExtractor:()=>i,YolosImageProcessor:()=>s});var n=r("./src/base/image_processors_utils.js");class s extends n.ImageProcessor{post_process_object_detection(...a){return(0,n.post_process_object_detection)(...a)}}class i extends s{}},"./src/ops/registry.js":(t,e,r)=>{r.r(e),r.d(e,{TensorOpRegistry:()=>l});var n=r("./src/backends/onnx.js"),s=r("./src/utils/tensor.js"),i=r("./src/env.js");const o=i.apis.IS_BROWSER_ENV||i.apis.IS_WEBWORKER_ENV,a=async(c,u,d)=>{const h=await(0,n.createInferenceSession)(new Uint8Array(c),u);let f=Promise.resolve();return async p=>{const m=(0,n.isONNXProxy)(),y=Object.fromEntries(Object.entries(p).map(([_,v])=>[_,(m?v.clone():v).ort_tensor])),g=await(f=o?f.then(()=>h.run(y)):h.run(y));return Array.isArray(d)?d.map(_=>new s.Tensor(g[_])):new s.Tensor(g[d])}};class l{static get nearest_interpolate_4d(){return this._nearest_interpolate_4d||(this._nearest_interpolate_4d=a([8,10,18,0,58,129,1,10,41,10,1,120,10,0,10,0,10,1,115,18,1,121,34,6,82,101,115,105,122,101,42,18,10,4,109,111,100,101,34,7,110,101,97,114,101,115,116,160,1,3,18,1,114,90,31,10,1,120,18,26,10,24,8,1,18,20,10,3,18,1,98,10,3,18,1,99,10,3,18,1,104,10,3,18,1,119,90,15,10,1,115,18,10,10,8,8,7,18,4,10,2,8,4,98,31,10,1,121,18,26,10,24,8,1,18,20,10,3,18,1,98,10,3,18,1,99,10,3,18,1,104,10,3,18,1,119,66,2,16,21],this.session_options,"y")),this._nearest_interpolate_4d}static get bilinear_interpolate_4d(){return this._bilinear_interpolate_4d||(this._bilinear_interpolate_4d=a([8,9,18,0,58,128,1,10,40,10,1,120,10,0,10,0,10,1,115,18,1,121,34,6,82,101,115,105,122,101,42,17,10,4,109,111,100,101,34,6,108,105,110,101,97,114,160,1,3,18,1,114,90,31,10,1,120,18,26,10,24,8,1,18,20,10,3,18,1,98,10,3,18,1,99,10,3,18,1,104,10,3,18,1,119,90,15,10,1,115,18,10,10,8,8,7,18,4,10,2,8,4,98,31,10,1,121,18,26,10,24,8,1,18,20,10,3,18,1,98,10,3,18,1,99,10,3,18,1,104,10,3,18,1,119,66,2,16,20],this.session_options,"y")),this._bilinear_interpolate_4d}static get bicubic_interpolate_4d(){return this._bicubic_interpolate_4d||(this._bicubic_interpolate_4d=a([8,9,18,0,58,127,10,39,10,1,120,10,0,10,0,10,1,115,18,1,121,34,6,82,101,115,105,122,101,42,16,10,4,109,111,100,101,34,5,99,117,98,105,99,160,1,3,18,1,114,90,31,10,1,120,18,26,10,24,8,1,18,20,10,3,18,1,98,10,3,18,1,99,10,3,18,1,104,10,3,18,1,119,90,15,10,1,115,18,10,10,8,8,7,18,4,10,2,8,4,98,31,10,1,121,18,26,10,24,8,1,18,20,10,3,18,1,98,10,3,18,1,99,10,3,18,1,104,10,3,18,1,119,66,2,16,20],this.session_options,"y")),this._bicubic_interpolate_4d}static get matmul(){return this._matmul||(this._matmul=a([8,9,18,0,58,55,10,17,10,1,97,10,1,98,18,1,99,34,6,77,97,116,77,117,108,18,1,114,90,9,10,1,97,18,4,10,2,8,1,90,9,10,1,98,18,4,10,2,8,1,98,9,10,1,99,18,4,10,2,8,1,66,2,16,20],this.session_options,"c")),this._matmul}static get stft(){return this._stft||(this._stft=a([8,7,18,0,58,148,1,10,38,10,1,115,10,1,106,10,1,119,10,1,108,18,1,111,34,4,83,84,70,84,42,15,10,8,111,110,101,115,105,100,101,100,24,1,160,1,2,18,1,115,90,26,10,1,115,18,21,10,19,8,1,18,15,10,3,18,1,98,10,3,18,1,115,10,3,18,1,99,90,11,10,1,106,18,6,10,4,8,7,18,0,90,16,10,1,119,18,11,10,9,8,1,18,5,10,3,18,1,119,90,11,10,1,108,18,6,10,4,8,7,18,0,98,31,10,1,111,18,26,10,24,8,1,18,20,10,3,18,1,98,10,3,18,1,102,10,3,18,1,100,10,3,18,1,99,66,2,16,17],this.session_options,"o")),this._stft}static get rfft(){return this._rfft||(this._rfft=a([8,9,18,0,58,97,10,33,10,1,120,10,0,10,1,97,18,1,121,34,3,68,70,84,42,15,10,8,111,110,101,115,105,100,101,100,24,1,160,1,2,18,1,100,90,21,10,1,120,18,16,10,14,8,1,18,10,10,3,18,1,115,10,3,18,1,99,90,11,10,1,97,18,6,10,4,8,7,18,0,98,21,10,1,121,18,16,10,14,8,1,18,10,10,3,18,1,115,10,3,18,1,99,66,2,16,20],this.session_options,"y")),this._rfft}static get top_k(){return this._top_k||(this._top_k=a([8,10,18,0,58,73,10,18,10,1,120,10,1,107,18,1,118,18,1,105,34,4,84,111,112,75,18,1,116,90,9,10,1,120,18,4,10,2,8,1,90,15,10,1,107,18,10,10,8,8,7,18,4,10,2,8,1,98,9,10,1,118,18,4,10,2,8,1,98,9,10,1,105,18,4,10,2,8,7,66,2,16,21],this.session_options,["v","i"])),this._top_k}static get slice(){return this._slice||(this._slice=a([8,7,18,0,58,96,10,25,10,1,120,10,1,115,10,1,101,10,1,97,10,1,116,18,1,121,34,5,83,108,105,99,101,18,1,114,90,9,10,1,120,18,4,10,2,8,1,90,9,10,1,115,18,4,10,2,8,7,90,9,10,1,101,18,4,10,2,8,7,90,9,10,1,97,18,4,10,2,8,7,90,9,10,1,116,18,4,10,2,8,7,98,9,10,1,121,18,4,10,2,8,1,66,2,16,13],this.session_options,"y")),this._slice}}ce(l,"session_options",{})},"./src/pipelines.js":(t,e,r)=>{r.r(e),r.d(e,{AudioClassificationPipeline:()=>V,AutomaticSpeechRecognitionPipeline:()=>X,BackgroundRemovalPipeline:()=>N,DepthEstimationPipeline:()=>_e,DocumentQuestionAnsweringPipeline:()=>O,FeatureExtractionPipeline:()=>$,FillMaskPipeline:()=>v,ImageClassificationPipeline:()=>Y,ImageFeatureExtractionPipeline:()=>j,ImageSegmentationPipeline:()=>J,ImageToImagePipeline:()=>re,ImageToTextPipeline:()=>K,ObjectDetectionPipeline:()=>te,Pipeline:()=>m,QuestionAnsweringPipeline:()=>_,SummarizationPipeline:()=>x,Text2TextGenerationPipeline:()=>w,TextClassificationPipeline:()=>y,TextGenerationPipeline:()=>S,TextToAudioPipeline:()=>H,TokenClassificationPipeline:()=>g,TranslationPipeline:()=>M,ZeroShotAudioClassificationPipeline:()=>L,ZeroShotClassificationPipeline:()=>k,ZeroShotImageClassificationPipeline:()=>ne,ZeroShotObjectDetectionPipeline:()=>z,pipeline:()=>$e});var n=r("./src/tokenizers.js"),s=r("./src/models.js"),i=r("./src/models/auto/processing_auto.js");r("./src/base/processing_utils.js");var o=r("./src/utils/generic.js"),a=r("./src/utils/core.js"),l=r("./src/utils/maths.js"),c=r("./src/utils/audio.js"),u=r("./src/utils/tensor.js"),d=r("./src/utils/image.js");async function h(de){return Array.isArray(de)||(de=[de]),await Promise.all(de.map(q=>d.RawImage.read(q)))}async function f(de,q){return Array.isArray(de)||(de=[de]),await Promise.all(de.map(se=>typeof se=="string"||se instanceof URL?(0,c.read_audio)(se,q):se instanceof Float64Array?new Float32Array(se):se))}function p(de,q){q&&(de=de.map(ke=>ke|0));const[se,Q,Me,Te]=de;return{xmin:se,ymin:Q,xmax:Me,ymax:Te}}class m extends o.Callable{constructor({task:q,model:se,tokenizer:Q=null,processor:Me=null}){super(),this.task=q,this.model=se,this.tokenizer=Q,this.processor=Me}async dispose(){await this.model.dispose()}}class y extends m{constructor(q){super(q)}async _call(q,{top_k:se=1}={}){const Q=this.tokenizer(q,{padding:!0,truncation:!0}),Me=await this.model(Q),Te=this.model.config.problem_type==="multi_label_classification"?Fe=>Fe.sigmoid():Fe=>new u.Tensor("float32",(0,l.softmax)(Fe.data),Fe.dims),ke=this.model.config.id2label,Pe=[];for(const Fe of Me.logits){const Le=Te(Fe),We=await(0,u.topk)(Le,se),Ze=We[0].tolist(),Re=We[1].tolist().map((qe,at)=>({label:ke?ke[qe]:`LABEL_${qe}`,score:Ze[at]}));se===1?Pe.push(...Re):Pe.push(Re)}return Array.isArray(q)||se===1?Pe:Pe[0]}}class g extends m{constructor(q){super(q)}async _call(q,{ignore_labels:se=["O"]}={}){const Q=Array.isArray(q),Me=this.tokenizer(Q?q:[q],{padding:!0,truncation:!0}),ke=(await this.model(Me)).logits,Pe=this.model.config.id2label,Fe=[];for(let Le=0;Le<ke.dims[0];++Le){const We=Me.input_ids[Le],Ze=ke[Le],et=[];for(let Re=0;Re<Ze.dims[0];++Re){const qe=Ze[Re],at=(0,l.max)(qe.data)[1],ct=Pe?Pe[at]:`LABEL_${at}`;if(se.includes(ct))continue;const lt=this.tokenizer.decode([We[Re].item()],{skip_special_tokens:!0});if(lt==="")continue;const Qe=(0,l.softmax)(qe.data);et.push({entity:ct,score:Qe[at],index:Re,word:lt})}Fe.push(et)}return Q?Fe:Fe[0]}}class _ extends m{constructor(q){super(q)}async _call(q,se,{top_k:Q=1}={}){const Me=this.tokenizer(q,{text_pair:se,padding:!0,truncation:!0}),{start_logits:Te,end_logits:ke}=await this.model(Me),Pe=Me.input_ids.tolist(),Fe=Me.attention_mask.tolist(),Le=this.tokenizer.all_special_ids,We=[];for(let Ze=0;Ze<Te.dims[0];++Ze){const et=Pe[Ze],Re=et.findIndex(je=>je==this.tokenizer.sep_token_id);Fe[Ze].map((je,yt)=>je==1&&(yt===0||yt>Re&&Le.findIndex(Rt=>Rt==et[yt])===-1));const qe=Te[Ze].tolist(),at=ke[Ze].tolist();for(let je=1;je<qe.length;++je)(Fe[Ze]==0||je<=Re||Le.findIndex(yt=>yt==et[je])!==-1)&&(qe[je]=-1/0,at[je]=-1/0);const ct=(0,l.softmax)(qe).map((je,yt)=>[je,yt]),lt=(0,l.softmax)(at).map((je,yt)=>[je,yt]);ct[0][0]=0,lt[0][0]=0;const Qe=(0,a.product)(ct,lt).filter(je=>je[0][1]<=je[1][1]).map(je=>[je[0][1],je[1][1],je[0][0]*je[1][0]]).sort((je,yt)=>yt[2]-je[2]);for(let je=0;je<Math.min(Qe.length,Q);++je){const[yt,Rt,Yt]=Qe[je],Xt=et.slice(yt,Rt+1),Ur=this.tokenizer.decode(Xt,{skip_special_tokens:!0});We.push({answer:Ur,score:Yt})}}return Q===1?We[0]:We}}class v extends m{constructor(q){super(q)}async _call(q,{top_k:se=5}={}){const Q=this.tokenizer(q,{padding:!0,truncation:!0}),{logits:Me}=await this.model(Q),Te=[],ke=Q.input_ids.tolist();for(let Pe=0;Pe<ke.length;++Pe){const Fe=ke[Pe],Le=Fe.findIndex(qe=>qe==this.tokenizer.mask_token_id);if(Le===-1)throw Error(`Mask token (${this.tokenizer.mask_token}) not found in text.`);const We=Me[Pe][Le],Ze=await(0,u.topk)(new u.Tensor("float32",(0,l.softmax)(We.data),We.dims),se),et=Ze[0].tolist(),Re=Ze[1].tolist();Te.push(Re.map((qe,at)=>{const ct=Fe.slice();return ct[Le]=qe,{score:et[at],token:Number(qe),token_str:this.tokenizer.decode([qe]),sequence:this.tokenizer.decode(ct,{skip_special_tokens:!0})}}))}return Array.isArray(q)?Te:Te[0]}}class w extends m{constructor(se){super(se);ce(this,"_key","generated_text")}async _call(se,Q={}){Array.isArray(se)||(se=[se]),this.model.config.prefix&&(se=se.map(Le=>this.model.config.prefix+Le));const Me=this.model.config.task_specific_params;Me&&Me[this.task]&&Me[this.task].prefix&&(se=se.map(Le=>Me[this.task].prefix+Le));const Te=this.tokenizer,ke={padding:!0,truncation:!0};let Pe;this instanceof M&&"_build_translation_inputs"in Te?Pe=Te._build_translation_inputs(se,ke,Q):Pe=Te(se,ke);const Fe=await this.model.generate({...Pe,...Q});return Te.batch_decode(Fe,{skip_special_tokens:!0}).map(Le=>({[this._key]:Le}))}}class x extends w{constructor(se){super(se);ce(this,"_key","summary_text")}}class M extends w{constructor(se){super(se);ce(this,"_key","translation_text")}}function T(de){return Array.isArray(de)&&de.every(q=>"role"in q&&"content"in q)}class S extends m{constructor(q){super(q)}async _call(q,se={}){let Q=!1,Me=!1,Te;if(typeof q=="string")Te=q=[q];else if(Array.isArray(q)&&q.every(Re=>typeof Re=="string"))Q=!0,Te=q;else{if(T(q))q=[q];else if(Array.isArray(q)&&q.every(T))Q=!0;else throw new Error("Input must be a string, an array of strings, a Chat, or an array of Chats");Me=!0,Te=q.map(Re=>this.tokenizer.apply_chat_template(Re,{tokenize:!1,add_generation_prompt:!0}))}const ke=se.add_special_tokens??!1,Pe=Me?!1:se.return_full_text??!0;this.tokenizer.padding_side="left";const Fe=this.tokenizer(Te,{add_special_tokens:ke,padding:!0,truncation:!0}),Le=await this.model.generate({...Fe,...se}),We=this.tokenizer.batch_decode(Le,{skip_special_tokens:!0});let Ze;!Pe&&Fe.input_ids.dims.at(-1)>0&&(Ze=this.tokenizer.batch_decode(Fe.input_ids,{skip_special_tokens:!0}).map(Re=>Re.length));const et=Array.from({length:q.length},Re=>[]);for(let Re=0;Re<We.length;++Re){const qe=Math.floor(Re/Le.dims[0]*q.length);Ze&&(We[Re]=We[Re].slice(Ze[qe])),et[qe].push({generated_text:Me?[...q[qe],{role:"assistant",content:We[Re]}]:We[Re]})}return!Q&&et.length===1?et[0]:et}}class k extends m{constructor(q){super(q),this.label2id=Object.fromEntries(Object.entries(this.model.config.label2id).map(([se,Q])=>[se.toLowerCase(),Q])),this.entailment_id=this.label2id.entailment,this.entailment_id===void 0&&(console.warn("Could not find 'entailment' in label2id mapping. Using 2 as entailment_id."),this.entailment_id=2),this.contradiction_id=this.label2id.contradiction??this.label2id.not_entailment,this.contradiction_id===void 0&&(console.warn("Could not find 'contradiction' in label2id mapping. Using 0 as contradiction_id."),this.contradiction_id=0)}async _call(q,se,{hypothesis_template:Q="This example is {}.",multi_label:Me=!1}={}){const Te=Array.isArray(q);Te||(q=[q]),Array.isArray(se)||(se=[se]);const ke=se.map(Le=>Q.replace("{}",Le)),Pe=Me||se.length===1,Fe=[];for(const Le of q){const We=[];for(const Re of ke){const qe=this.tokenizer(Le,{text_pair:Re,padding:!0,truncation:!0}),at=await this.model(qe);Pe?We.push([at.logits.data[this.contradiction_id],at.logits.data[this.entailment_id]]):We.push(at.logits.data[this.entailment_id])}const et=(Pe?We.map(Re=>(0,l.softmax)(Re)[1]):(0,l.softmax)(We)).map((Re,qe)=>[Re,qe]).sort((Re,qe)=>qe[0]-Re[0]);Fe.push({sequence:Le,labels:et.map(Re=>se[Re[1]]),scores:et.map(Re=>Re[0])})}return Te?Fe:Fe[0]}}class $ extends m{constructor(q){super(q)}async _call(q,{pooling:se="none",normalize:Q=!1,quantize:Me=!1,precision:Te="binary"}={}){const ke=this.tokenizer(q,{padding:!0,truncation:!0}),Pe=await this.model(ke);let Fe=Pe.last_hidden_state??Pe.logits??Pe.token_embeddings;if(se!=="none")if(se==="mean")Fe=(0,u.mean_pooling)(Fe,ke.attention_mask);else if(se==="cls")Fe=Fe.slice(null,0);else throw Error(`Pooling method '${se}' not supported.`);return Q&&(Fe=Fe.normalize(2,-1)),Me&&(Fe=(0,u.quantize_embeddings)(Fe,Te)),Fe}}class j extends m{constructor(q){super(q)}async _call(q,{pool:se=null}={}){const Q=await h(q),{pixel_values:Me}=await this.processor(Q),Te=await this.model({pixel_values:Me});let ke;if(se){if(!("pooler_output"in Te))throw Error("No pooled output was returned. Make sure the model has a 'pooler' layer when using the 'pool' option.");ke=Te.pooler_output}else ke=Te.last_hidden_state??Te.logits??Te.image_embeds;return ke}}class V extends m{constructor(q){super(q)}async _call(q,{top_k:se=5}={}){const Q=this.processor.feature_extractor.config.sampling_rate,Me=await f(q,Q),Te=this.model.config.id2label,ke=[];for(const Pe of Me){const Fe=await this.processor(Pe),We=(await this.model(Fe)).logits[0],Ze=await(0,u.topk)(new u.Tensor("float32",(0,l.softmax)(We.data),We.dims),se),et=Ze[0].tolist(),qe=Ze[1].tolist().map((at,ct)=>({label:Te?Te[at]:`LABEL_${at}`,score:et[ct]}));ke.push(qe)}return Array.isArray(q)?ke:ke[0]}}class L extends m{constructor(q){super(q)}async _call(q,se,{hypothesis_template:Q="This is a sound of {}."}={}){const Me=!Array.isArray(q);Me&&(q=[q]);const Te=se.map(We=>Q.replace("{}",We)),ke=this.tokenizer(Te,{padding:!0,truncation:!0}),Pe=this.processor.feature_extractor.config.sampling_rate,Fe=await f(q,Pe),Le=[];for(const We of Fe){const Ze=await this.processor(We),et=await this.model({...ke,...Ze}),Re=(0,l.softmax)(et.logits_per_audio.data);Le.push([...Re].map((qe,at)=>({score:qe,label:se[at]})))}return Me?Le[0]:Le}}class X extends m{constructor(q){super(q)}async _call(q,se={}){switch(this.model.config.model_type){case"whisper":case"lite-whisper":return this._call_whisper(q,se);case"wav2vec2":case"wav2vec2-bert":case"unispeech":case"unispeech-sat":case"hubert":return this._call_wav2vec2(q,se);case"moonshine":return this._call_moonshine(q,se);default:throw new Error(`AutomaticSpeechRecognitionPipeline does not support model type '${this.model.config.model_type}'.`)}}async _call_wav2vec2(q,se){se.language&&console.warn('`language` parameter is not yet supported for `wav2vec2` models, defaulting to "English".'),se.task&&console.warn('`task` parameter is not yet supported for `wav2vec2` models, defaulting to "transcribe".');const Q=!Array.isArray(q);Q&&(q=[q]);const Me=this.processor.feature_extractor.config.sampling_rate,Te=await f(q,Me),ke=[];for(const Pe of Te){const Fe=await this.processor(Pe),We=(await this.model(Fe)).logits[0],Ze=[];for(const Re of We)Ze.push((0,l.max)(Re.data)[1]);const et=this.tokenizer.decode(Ze);ke.push({text:et})}return Q?ke[0]:ke}async _call_whisper(q,se){const Q=se.return_timestamps??!1,Me=se.chunk_length_s??0,Te=se.force_full_sequences??!1;let ke=se.stride_length_s??null;const Pe={...se};Q==="word"&&(Pe.return_token_timestamps=!0,Pe.return_timestamps=!1);const Fe=!Array.isArray(q);Fe&&(q=[q]);const Le=this.processor.feature_extractor.config.chunk_length/this.model.config.max_source_positions,We=this.processor.feature_extractor.config.hop_length,Ze=this.processor.feature_extractor.config.sampling_rate,et=await f(q,Ze),Re=[];for(const qe of et){let at=[];if(Me>0){if(ke===null)ke=Me/6;else if(Me<=ke)throw Error("`chunk_length_s` must be larger than `stride_length_s`.");const Qe=Ze*Me,je=Ze*ke,yt=Qe-2*je;let Rt=0;for(;;){const Yt=Rt+Qe,Xt=qe.subarray(Rt,Yt),Ur=await this.processor(Xt),wr=Rt===0,Ct=Yt>=qe.length;if(at.push({stride:[Xt.length,wr?0:je,Ct?0:je],input_features:Ur.input_features,is_last:Ct}),Ct)break;Rt+=yt}}else at=[{stride:[qe.length,0,0],input_features:(await this.processor(qe)).input_features,is_last:!0}];for(const Qe of at){Pe.num_frames=Math.floor(Qe.stride[0]/We);const je=await this.model.generate({inputs:Qe.input_features,...Pe});Q==="word"?(Qe.tokens=je.sequences.tolist()[0],Qe.token_timestamps=je.token_timestamps.tolist()[0].map(yt=>(0,l.round)(yt,2))):Qe.tokens=je[0].tolist(),Qe.stride=Qe.stride.map(yt=>yt/Ze)}const[ct,lt]=this.tokenizer._decode_asr(at,{time_precision:Le,return_timestamps:Q,force_full_sequences:Te});Re.push({text:ct,...lt})}return Fe?Re[0]:Re}async _call_moonshine(q,se){const Q=!Array.isArray(q);Q&&(q=[q]);const Me=this.processor.feature_extractor.config.sampling_rate,Te=await f(q,Me),ke=[];for(const Pe of Te){const Fe=await this.processor(Pe),Le=Math.floor(Pe.length/Me)*6,We=await this.model.generate({max_new_tokens:Le,...se,...Fe}),Ze=this.processor.batch_decode(We,{skip_special_tokens:!0})[0];ke.push({text:Ze})}return Q?ke[0]:ke}}class K extends m{constructor(q){super(q)}async _call(q,se={}){const Q=Array.isArray(q),Me=await h(q),{pixel_values:Te}=await this.processor(Me),ke=[];for(const Pe of Te){Pe.dims=[1,...Pe.dims];const Fe=await this.model.generate({inputs:Pe,...se}),Le=this.tokenizer.batch_decode(Fe,{skip_special_tokens:!0}).map(We=>({generated_text:We.trim()}));ke.push(Le)}return Q?ke:ke[0]}}class Y extends m{constructor(q){super(q)}async _call(q,{top_k:se=5}={}){const Q=await h(q),{pixel_values:Me}=await this.processor(Q),Te=await this.model({pixel_values:Me}),ke=this.model.config.id2label,Pe=[];for(const Fe of Te.logits){const Le=await(0,u.topk)(new u.Tensor("float32",(0,l.softmax)(Fe.data),Fe.dims),se),We=Le[0].tolist(),et=Le[1].tolist().map((Re,qe)=>({label:ke?ke[Re]:`LABEL_${Re}`,score:We[qe]}));Pe.push(et)}return Array.isArray(q)?Pe:Pe[0]}}class J extends m{constructor(q){super(q),this.subtasks_mapping={panoptic:"post_process_panoptic_segmentation",instance:"post_process_instance_segmentation",semantic:"post_process_semantic_segmentation"}}async _call(q,{threshold:se=.5,mask_threshold:Q=.5,overlap_mask_area_threshold:Me=.8,label_ids_to_fuse:Te=null,target_sizes:ke=null,subtask:Pe=null}={}){if(Array.isArray(q)&&q.length!==1)throw Error("Image segmentation pipeline currently only supports a batch size of 1.");const Le=await h(q),We=Le.map(Qe=>[Qe.height,Qe.width]),Ze=await this.processor(Le),{inputNames:et,outputNames:Re}=this.model.sessions.model;if(!et.includes("pixel_values")){if(et.length!==1)throw Error(`Expected a single input name, but got ${et.length} inputs: ${et}.`);const Qe=et[0];if(Qe in Ze)throw Error(`Input name ${Qe} already exists in the inputs.`);Ze[Qe]=Ze.pixel_values}const qe=await this.model(Ze);let at=null;if(Pe!==null)at=this.subtasks_mapping[Pe];else if(this.processor.image_processor){for(const[Qe,je]of Object.entries(this.subtasks_mapping))if(je in this.processor.image_processor){at=this.processor.image_processor[je].bind(this.processor.image_processor),Pe=Qe;break}}const ct=this.model.config.id2label,lt=[];if(Pe)if(Pe==="panoptic"||Pe==="instance"){const Qe=at(qe,se,Q,Me,Te,ke??We)[0],je=Qe.segmentation;for(const yt of Qe.segments_info){const Rt=new Uint8ClampedArray(je.data.length);for(let Xt=0;Xt<je.data.length;++Xt)je.data[Xt]===yt.id&&(Rt[Xt]=255);const Yt=new d.RawImage(Rt,je.dims[1],je.dims[0],1);lt.push({score:yt.score,label:ct[yt.label_id],mask:Yt})}}else if(Pe==="semantic"){const{segmentation:Qe,labels:je}=at(qe,ke??We)[0];for(const yt of je){const Rt=new Uint8ClampedArray(Qe.data.length);for(let Xt=0;Xt<Qe.data.length;++Xt)Qe.data[Xt]===yt&&(Rt[Xt]=255);const Yt=new d.RawImage(Rt,Qe.dims[1],Qe.dims[0],1);lt.push({score:null,label:ct[yt],mask:Yt})}}else throw Error(`Subtask ${Pe} not supported.`);else{const je=qe[Re[0]];for(let yt=0;yt<We.length;++yt){const Rt=We[yt],Yt=je[yt];Yt.data.some(Ur=>Ur<-1e-5||Ur>1+1e-5)&&Yt.sigmoid_();const Xt=await d.RawImage.fromTensor(Yt.mul_(255).to("uint8")).resize(Rt[1],Rt[0]);lt.push({label:null,score:null,mask:Xt})}}return lt}}class N extends J{constructor(q){super(q)}async _call(q,se={}){if(Array.isArray(q)&&q.length!==1)throw Error("Background removal pipeline currently only supports a batch size of 1.");const Me=await h(q),Te=await super._call(q,se);return Me.map((Pe,Fe)=>{const Le=Pe.clone();return Le.putAlpha(Te[Fe].mask),Le})}}class ne extends m{constructor(q){super(q)}async _call(q,se,{hypothesis_template:Q="This is a photo of {}"}={}){const Me=Array.isArray(q),Te=await h(q),ke=se.map(et=>Q.replace("{}",et)),Pe=this.tokenizer(ke,{padding:this.model.config.model_type==="siglip"?"max_length":!0,truncation:!0}),{pixel_values:Fe}=await this.processor(Te),Le=await this.model({...Pe,pixel_values:Fe}),We=this.model.config.model_type==="siglip"?et=>et.sigmoid().data:et=>(0,l.softmax)(et.data),Ze=[];for(const et of Le.logits_per_image){const qe=[...We(et)].map((at,ct)=>({score:at,label:se[ct]}));qe.sort((at,ct)=>ct.score-at.score),Ze.push(qe)}return Me?Ze:Ze[0]}}class te extends m{constructor(q){super(q)}async _call(q,{threshold:se=.9,percentage:Q=!1}={}){const Me=Array.isArray(q);if(Me&&q.length!==1)throw Error("Object detection pipeline currently only supports a batch size of 1.");const Te=await h(q),ke=Q?null:Te.map(Re=>[Re.height,Re.width]),{pixel_values:Pe,pixel_mask:Fe}=await this.processor(Te),Le=await this.model({pixel_values:Pe,pixel_mask:Fe}),We=this.processor.image_processor.post_process_object_detection(Le,se,ke),Ze=this.model.config.id2label,et=We.map(Re=>Re.boxes.map((qe,at)=>({score:Re.scores[at],label:Ze[Re.classes[at]],box:p(qe,!Q)})));return Me?et:et[0]}}class z extends m{constructor(q){super(q)}async _call(q,se,{threshold:Q=.1,top_k:Me=null,percentage:Te=!1}={}){const ke=Array.isArray(q),Pe=await h(q),Fe=this.tokenizer(se,{padding:!0,truncation:!0}),Le=await this.processor(Pe),We=[];for(let Ze=0;Ze<Pe.length;++Ze){const et=Pe[Ze],Re=Te?null:[[et.height,et.width]],qe=Le.pixel_values[Ze].unsqueeze_(0),at=await this.model({...Fe,pixel_values:qe});let ct;if("post_process_grounded_object_detection"in this.processor){const lt=this.processor.post_process_grounded_object_detection(at,Fe.input_ids,{box_threshold:Q,text_threshold:Q,target_sizes:Re})[0];ct=lt.boxes.map((Qe,je)=>({score:lt.scores[je],label:lt.labels[je],box:p(Qe,!Te)}))}else{const lt=this.processor.image_processor.post_process_object_detection(at,Q,Re,!0)[0];ct=lt.boxes.map((Qe,je)=>({score:lt.scores[je],label:se[lt.classes[je]],box:p(Qe,!Te)}))}ct.sort((lt,Qe)=>Qe.score-lt.score),Me!==null&&(ct=ct.slice(0,Me)),We.push(ct)}return ke?We:We[0]}}class O extends m{constructor(q){super(q)}async _call(q,se,Q={}){const Me=(await h(q))[0],{pixel_values:Te}=await this.processor(Me),ke=`<s_docvqa><s_question>${se}</s_question><s_answer>`,Pe=this.tokenizer(ke,{add_special_tokens:!1,padding:!0,truncation:!0}).input_ids,Fe=await this.model.generate({inputs:Te,max_length:this.model.config.decoder.max_position_embeddings,decoder_input_ids:Pe,...Q}),We=this.tokenizer.batch_decode(Fe)[0].match(/<s_answer>(.*?)<\/s_answer>/);let Ze=null;return We&&We.length>=2&&(Ze=We[1].trim()),[{answer:Ze}]}}class H extends m{constructor(se){super(se);ce(this,"DEFAULT_VOCODER_ID","Xenova/speecht5_hifigan");this.vocoder=se.vocoder??null}async _call(se,{speaker_embeddings:Q=null}={}){return this.processor?this._call_text_to_spectrogram(se,{speaker_embeddings:Q}):this._call_text_to_waveform(se)}async _call_text_to_waveform(se){const Q=this.tokenizer(se,{padding:!0,truncation:!0}),{waveform:Me}=await this.model(Q),Te=this.model.config.sampling_rate;return new c.RawAudio(Me.data,Te)}async _call_text_to_spectrogram(se,{speaker_embeddings:Q}){if(this.vocoder||(console.log("No vocoder specified, using default HifiGan vocoder."),this.vocoder=await s.AutoModel.from_pretrained(this.DEFAULT_VOCODER_ID,{dtype:"fp32"})),(typeof Q=="string"||Q instanceof URL)&&(Q=new Float32Array(await(await fetch(Q)).arrayBuffer())),Q instanceof Float32Array)Q=new u.Tensor("float32",Q,[1,Q.length]);else if(!(Q instanceof u.Tensor))throw new Error("Speaker embeddings must be a `Tensor`, `Float32Array`, `string`, or `URL`.");const{input_ids:Me}=this.tokenizer(se,{padding:!0,truncation:!0}),{waveform:Te}=await this.model.generate_speech(Me,Q,{vocoder:this.vocoder}),ke=this.processor.feature_extractor.config.sampling_rate;return new c.RawAudio(Te.data,ke)}}class re extends m{constructor(q){super(q)}async _call(q){const se=await h(q),Q=await this.processor(se),Me=await this.model(Q),Te=[];for(const ke of Me.reconstruction){const Pe=ke.squeeze().clamp_(0,1).mul_(255).round_().to("uint8");Te.push(d.RawImage.fromTensor(Pe))}return Te.length>1?Te:Te[0]}}class _e extends m{constructor(q){super(q)}async _call(q){const se=await h(q),Q=await this.processor(se),{predicted_depth:Me}=await this.model(Q),Te=[];for(let ke=0;ke<se.length;++ke){const Pe=Me[ke],[Fe,Le]=Pe.dims.slice(-2),[We,Ze]=se[ke].size,et=(await(0,u.interpolate_4d)(Pe.view(1,1,Fe,Le),{size:[Ze,We],mode:"bilinear"})).view(Ze,We),Re=et.min().item(),qe=et.max().item(),at=et.sub(Re).div_(qe-Re).mul_(255).to("uint8").unsqueeze(0),ct=d.RawImage.fromTensor(at);Te.push({predicted_depth:et,depth:ct})}return Te.length>1?Te:Te[0]}}const oe=Object.freeze({"text-classification":{tokenizer:n.AutoTokenizer,pipeline:y,model:s.AutoModelForSequenceClassification,default:{model:"Xenova/distilbert-base-uncased-finetuned-sst-2-english"},type:"text"},"token-classification":{tokenizer:n.AutoTokenizer,pipeline:g,model:s.AutoModelForTokenClassification,default:{model:"Xenova/bert-base-multilingual-cased-ner-hrl"},type:"text"},"question-answering":{tokenizer:n.AutoTokenizer,pipeline:_,model:s.AutoModelForQuestionAnswering,default:{model:"Xenova/distilbert-base-cased-distilled-squad"},type:"text"},"fill-mask":{tokenizer:n.AutoTokenizer,pipeline:v,model:s.AutoModelForMaskedLM,default:{model:"Xenova/bert-base-uncased"},type:"text"},summarization:{tokenizer:n.AutoTokenizer,pipeline:x,model:s.AutoModelForSeq2SeqLM,default:{model:"Xenova/distilbart-cnn-6-6"},type:"text"},translation:{tokenizer:n.AutoTokenizer,pipeline:M,model:s.AutoModelForSeq2SeqLM,default:{model:"Xenova/t5-small"},type:"text"},"text2text-generation":{tokenizer:n.AutoTokenizer,pipeline:w,model:s.AutoModelForSeq2SeqLM,default:{model:"Xenova/flan-t5-small"},type:"text"},"text-generation":{tokenizer:n.AutoTokenizer,pipeline:S,model:s.AutoModelForCausalLM,default:{model:"Xenova/gpt2"},type:"text"},"zero-shot-classification":{tokenizer:n.AutoTokenizer,pipeline:k,model:s.AutoModelForSequenceClassification,default:{model:"Xenova/distilbert-base-uncased-mnli"},type:"text"},"audio-classification":{pipeline:V,model:s.AutoModelForAudioClassification,processor:i.AutoProcessor,default:{model:"Xenova/wav2vec2-base-superb-ks"},type:"audio"},"zero-shot-audio-classification":{tokenizer:n.AutoTokenizer,pipeline:L,model:s.AutoModel,processor:i.AutoProcessor,default:{model:"Xenova/clap-htsat-unfused"},type:"multimodal"},"automatic-speech-recognition":{tokenizer:n.AutoTokenizer,pipeline:X,model:[s.AutoModelForSpeechSeq2Seq,s.AutoModelForCTC],processor:i.AutoProcessor,default:{model:"Xenova/whisper-tiny.en"},type:"multimodal"},"text-to-audio":{tokenizer:n.AutoTokenizer,pipeline:H,model:[s.AutoModelForTextToWaveform,s.AutoModelForTextToSpectrogram],processor:[i.AutoProcessor,null],default:{model:"Xenova/speecht5_tts"},type:"text"},"image-to-text":{tokenizer:n.AutoTokenizer,pipeline:K,model:s.AutoModelForVision2Seq,processor:i.AutoProcessor,default:{model:"Xenova/vit-gpt2-image-captioning"},type:"multimodal"},"image-classification":{pipeline:Y,model:s.AutoModelForImageClassification,processor:i.AutoProcessor,default:{model:"Xenova/vit-base-patch16-224"},type:"multimodal"},"image-segmentation":{pipeline:J,model:[s.AutoModelForImageSegmentation,s.AutoModelForSemanticSegmentation,s.AutoModelForUniversalSegmentation],processor:i.AutoProcessor,default:{model:"Xenova/detr-resnet-50-panoptic"},type:"multimodal"},"background-removal":{pipeline:N,model:[s.AutoModelForImageSegmentation,s.AutoModelForSemanticSegmentation,s.AutoModelForUniversalSegmentation],processor:i.AutoProcessor,default:{model:"Xenova/modnet"},type:"image"},"zero-shot-image-classification":{tokenizer:n.AutoTokenizer,pipeline:ne,model:s.AutoModel,processor:i.AutoProcessor,default:{model:"Xenova/clip-vit-base-patch32"},type:"multimodal"},"object-detection":{pipeline:te,model:s.AutoModelForObjectDetection,processor:i.AutoProcessor,default:{model:"Xenova/detr-resnet-50"},type:"multimodal"},"zero-shot-object-detection":{tokenizer:n.AutoTokenizer,pipeline:z,model:s.AutoModelForZeroShotObjectDetection,processor:i.AutoProcessor,default:{model:"Xenova/owlvit-base-patch32"},type:"multimodal"},"document-question-answering":{tokenizer:n.AutoTokenizer,pipeline:O,model:s.AutoModelForDocumentQuestionAnswering,processor:i.AutoProcessor,default:{model:"Xenova/donut-base-finetuned-docvqa"},type:"multimodal"},"image-to-image":{pipeline:re,model:s.AutoModelForImageToImage,processor:i.AutoProcessor,default:{model:"Xenova/swin2SR-classical-sr-x2-64"},type:"image"},"depth-estimation":{pipeline:_e,model:s.AutoModelForDepthEstimation,processor:i.AutoProcessor,default:{model:"Xenova/dpt-large"},type:"image"},"feature-extraction":{tokenizer:n.AutoTokenizer,pipeline:$,model:s.AutoModel,default:{model:"Xenova/all-MiniLM-L6-v2"},type:"text"},"image-feature-extraction":{processor:i.AutoProcessor,pipeline:j,model:[s.AutoModelForImageFeatureExtraction,s.AutoModel],default:{model:"Xenova/vit-base-patch16-224-in21k"},type:"image"}}),pe=Object.freeze({"sentiment-analysis":"text-classification",ner:"token-classification",asr:"automatic-speech-recognition","text-to-speech":"text-to-audio",embeddings:"feature-extraction"});async function $e(de,q=null,{progress_callback:se=null,config:Q=null,cache_dir:Me=null,local_files_only:Te=!1,revision:ke="main",device:Pe=null,dtype:Fe=null,subfolder:Le="onnx",use_external_data_format:We=null,model_file_name:Ze=null,session_options:et={}}={}){de=pe[de]??de;const Re=oe[de.split("_",1)[0]];if(!Re)throw Error(`Unsupported pipeline: ${de}. Must be one of [${Object.keys(oe)}]`);q||(q=Re.default.model,console.log(`No model specified. Using default model: "${q}".`));const qe={progress_callback:se,config:Q,cache_dir:Me,local_files_only:Te,revision:ke,device:Pe,dtype:Fe,subfolder:Le,use_external_data_format:We,model_file_name:Ze,session_options:et},at=new Map([["tokenizer",Re.tokenizer],["model",Re.model],["processor",Re.processor]]),ct=await Ne(at,q,qe);ct.task=de,(0,a.dispatchCallback)(se,{status:"ready",task:de,model:q});const lt=Re.pipeline;return new lt(ct)}async function Ne(de,q,se){const Q=Object.create(null),Me=[];for(const[Te,ke]of de.entries()){if(!ke)continue;let Pe;Array.isArray(ke)?Pe=new Promise(async(Fe,Le)=>{var Ze,et;let We;for(const Re of ke){if(Re===null){Fe(null);return}try{Fe(await Re.from_pretrained(q,se));return}catch(qe){if((Ze=qe.message)!=null&&Ze.includes("Unsupported model type"))We=qe;else if((et=qe.message)!=null&&et.includes("Could not locate file"))We=qe;else{Le(qe);return}}}Le(We)}):Pe=ke.from_pretrained(q,se),Q[Te]=Pe,Me.push(Pe)}await Promise.all(Me);for(const[Te,ke]of Object.entries(Q))Q[Te]=await ke;return Q}},"./src/tokenizers.js":(t,e,r)=>{r.r(e),r.d(e,{AlbertTokenizer:()=>Qt,AutoTokenizer:()=>Yi,BartTokenizer:()=>Gi,BertTokenizer:()=>Ot,BlenderbotSmallTokenizer:()=>tl,BlenderbotTokenizer:()=>el,BloomTokenizer:()=>Ki,CLIPTokenizer:()=>di,CamembertTokenizer:()=>zs,CodeGenTokenizer:()=>Gs,CodeLlamaTokenizer:()=>fn,CohereTokenizer:()=>nl,ConvBertTokenizer:()=>sn,DebertaTokenizer:()=>ft,DebertaV2Tokenizer:()=>rr,DistilBertTokenizer:()=>kn,ElectraTokenizer:()=>Bs,EsmTokenizer:()=>_t,FalconTokenizer:()=>Be,GPT2Tokenizer:()=>Xn,GPTNeoXTokenizer:()=>it,GemmaTokenizer:()=>Vs,Grok1Tokenizer:()=>Ws,HerbertTokenizer:()=>mr,LlamaTokenizer:()=>Xi,M2M100Tokenizer:()=>Hr,MBart50Tokenizer:()=>ci,MBartTokenizer:()=>xs,MPNetTokenizer:()=>Rn,MarianTokenizer:()=>Ja,MgpstrTokenizer:()=>sl,MobileBertTokenizer:()=>Mt,NllbTokenizer:()=>Us,NougatTokenizer:()=>Yo,PreTrainedTokenizer:()=>Ee,Qwen2Tokenizer:()=>nr,RoFormerTokenizer:()=>xr,RobertaTokenizer:()=>Hi,SiglipTokenizer:()=>Qa,SpeechT5Tokenizer:()=>qi,SqueezeBertTokenizer:()=>vt,T5Tokenizer:()=>Ui,TokenizerModel:()=>j,VitsTokenizer:()=>rl,Wav2Vec2CTCTokenizer:()=>Za,WhisperTokenizer:()=>Qr,XLMRobertaTokenizer:()=>ui,XLMTokenizer:()=>li,is_chinese_char:()=>v});var n=r("./src/utils/generic.js"),s=r("./src/utils/core.js"),i=r("./src/utils/hub.js"),o=r("./src/utils/maths.js"),a=r("./src/utils/tensor.js"),l=r("./src/utils/data-structures.js"),c=r("./node_modules/@huggingface/jinja/dist/index.js"),u=r("./src/models/whisper/common_whisper.js");async function d(ve,I){const Z=await Promise.all([(0,i.getModelJSON)(ve,"tokenizer.json",!0,I),(0,i.getModelJSON)(ve,"tokenizer_config.json",!0,I)]);return I.legacy!==null&&(Z[1].legacy=I.legacy),Z}function h(ve,I){const Z=[];let ie=0;for(const he of ve.matchAll(I)){const ye=he[0];ie<he.index&&Z.push(ve.slice(ie,he.index)),ye.length>0&&Z.push(ye),ie=he.index+ye.length}return ie<ve.length&&Z.push(ve.slice(ie)),Z}function f(ve,I=!0){if(ve.Regex!==void 0){let Z=ve.Regex.replace(/\\([#&~])/g,"$1");for(const[ie,he]of k)Z=Z.replaceAll(ie,he);return new RegExp(Z,"gu")}else if(ve.String!==void 0){const Z=(0,s.escapeRegExp)(ve.String);return new RegExp(I?Z:`(${Z})`,"gu")}else return console.warn("Unknown pattern type:",ve),null}function p(ve){return new Map(Object.entries(ve))}function m(ve){const I=ve.dims;switch(I.length){case 1:return ve.tolist();case 2:if(I[0]!==1)throw new Error("Unable to decode tensor with `batch size !== 1`. Use `tokenizer.batch_decode(...)` for batched inputs.");return ve.tolist()[0];default:throw new Error(`Expected tensor to have 1-2 dimensions, got ${I.length}.`)}}function y(ve){return ve.replace(/ \./g,".").replace(/ \?/g,"?").replace(/ \!/g,"!").replace(/ ,/g,",").replace(/ \' /g,"'").replace(/ n\'t/g,"n't").replace(/ \'m/g,"'m").replace(/ \'s/g,"'s").replace(/ \'ve/g,"'ve").replace(/ \'re/g,"'re")}function g(ve){return ve.replace(new RegExp("\\p{M}","gu"),"")}function _(ve){return g(ve.toLowerCase())}function v(ve){return ve>=19968&&ve<=40959||ve>=13312&&ve<=19903||ve>=131072&&ve<=173791||ve>=173824&&ve<=177983||ve>=177984&&ve<=178207||ve>=178208&&ve<=183983||ve>=63744&&ve<=64255||ve>=194560&&ve<=195103}function w(ve,I,Z){const ie=[];let he=0;for(;he<ve.length;){if(ie.push(ve[he]),(I.get(ve[he])??Z)!==Z){++he;continue}for(;++he<ve.length&&(I.get(ve[he])??Z)===Z;)I.get(ie.at(-1))!==Z&&(ie[ie.length-1]+=ve[he])}return ie}function x(ve){return ve.match(/\S+/g)||[]}const M="\\p{P}\\u0021-\\u002F\\u003A-\\u0040\\u005B-\\u0060\\u007B-\\u007E",T=new RegExp(`^[${M}]+$`,"gu"),S=".,!?",k=new Map([["(?i:'s|'t|'re|'ve|'m|'ll|'d)","(?:'([sS]|[tT]|[rR][eE]|[vV][eE]|[mM]|[lL][lL]|[dD]))"],[` ?[^(\\s|[${S}])]+`,` ?[^\\s${S}]+`]]);class ${constructor(I){this.content=I.content,this.id=I.id,this.single_word=I.single_word??!1,this.lstrip=I.lstrip??!1,this.rstrip=I.rstrip??!1,this.special=I.special??!1,this.normalized=I.normalized??null}}class j extends n.Callable{constructor(I){super(),this.config=I,this.vocab=[],this.tokens_to_ids=new Map,this.unk_token_id=void 0,this.unk_token=void 0,this.end_of_word_suffix=void 0,this.fuse_unk=this.config.fuse_unk??!1}static fromConfig(I,...Z){switch(I.type){case"WordPiece":return new V(I);case"Unigram":return new L(I,...Z);case"BPE":return new Y(I);default:if(I.vocab)return Array.isArray(I.vocab)?new L(I,...Z):Object.hasOwn(I,"continuing_subword_prefix")&&Object.hasOwn(I,"unk_token")?Object.hasOwn(I,"merges")?new Y(I):new V(I):new J(I,...Z);throw new Error(`Unknown TokenizerModel type: ${I.type}`)}}_call(I){return I=this.encode(I),this.fuse_unk&&(I=w(I,this.tokens_to_ids,this.unk_token_id)),I}encode(I){throw Error("encode should be implemented in subclass.")}convert_tokens_to_ids(I){return I.map(Z=>this.tokens_to_ids.get(Z)??this.unk_token_id)}convert_ids_to_tokens(I){return I.map(Z=>this.vocab[Z]??this.unk_token)}}class V extends j{constructor(I){super(I),this.tokens_to_ids=p(I.vocab),this.unk_token_id=this.tokens_to_ids.get(I.unk_token),this.unk_token=I.unk_token,this.max_input_chars_per_word=I.max_input_chars_per_word??100,this.vocab=new Array(this.tokens_to_ids.size);for(const[Z,ie]of this.tokens_to_ids)this.vocab[ie]=Z}encode(I){const Z=[];for(const ie of I){const he=[...ie];if(he.length>this.max_input_chars_per_word){Z.push(this.unk_token);continue}let ye=!1,Ae=0;const He=[];for(;Ae<he.length;){let rt=he.length,Je=null;for(;Ae<rt;){let ot=he.slice(Ae,rt).join("");if(Ae>0&&(ot=this.config.continuing_subword_prefix+ot),this.tokens_to_ids.has(ot)){Je=ot;break}--rt}if(Je===null){ye=!0;break}He.push(Je),Ae=rt}ye?Z.push(this.unk_token):Z.push(...He)}return Z}}class L extends j{constructor(I,Z){super(I);const ie=I.vocab.length;this.vocab=new Array(ie),this.scores=new Array(ie);for(let he=0;he<ie;++he)[this.vocab[he],this.scores[he]]=I.vocab[he];this.unk_token_id=I.unk_id,this.unk_token=this.vocab[I.unk_id],this.tokens_to_ids=new Map(this.vocab.map((he,ye)=>[he,ye])),this.bos_token=" ",this.bos_token_id=this.tokens_to_ids.get(this.bos_token),this.eos_token=Z.eos_token,this.eos_token_id=this.tokens_to_ids.get(this.eos_token),this.unk_token=this.vocab[this.unk_token_id],this.minScore=(0,o.min)(this.scores)[0],this.unk_score=this.minScore-10,this.scores[this.unk_token_id]=this.unk_score,this.trie=new l.CharTrie,this.trie.extend(this.vocab),this.fuse_unk=!0}populateNodes(I){const Z=I.chars,ie=1;let he=0;for(;he<Z.length;){let ye=!1;const Ae=Z.slice(he).join(""),He=this.trie.commonPrefixSearch(Ae);for(const rt of He){const Je=this.tokens_to_ids.get(rt),ot=this.scores[Je],Et=(0,s.len)(rt);I.insert(he,Et,ot,Je),!ye&&Et===ie&&(ye=!0)}ye||I.insert(he,ie,this.unk_score,this.unk_token_id),he+=ie}}tokenize(I){const Z=new l.TokenLattice(I,this.bos_token_id,this.eos_token_id);return this.populateNodes(Z),Z.tokens()}encode(I){const Z=[];for(const ie of I){const he=this.tokenize(ie);Z.push(...he)}return Z}}const X=(()=>{const ve=[...Array.from({length:94},(he,ye)=>ye+33),...Array.from({length:12},(he,ye)=>ye+161),...Array.from({length:82},(he,ye)=>ye+174)],I=ve.slice();let Z=0;for(let he=0;he<256;++he)ve.includes(he)||(ve.push(he),I.push(256+Z),Z+=1);const ie=I.map(he=>String.fromCharCode(he));return Object.fromEntries(ve.map((he,ye)=>[he,ie[ye]]))})(),K=(0,s.reverseDictionary)(X);class Y extends j{constructor(I){super(I),this.tokens_to_ids=p(I.vocab),this.unk_token_id=this.tokens_to_ids.get(I.unk_token),this.unk_token=I.unk_token,this.vocab=new Array(this.tokens_to_ids.size);for(const[ie,he]of this.tokens_to_ids)this.vocab[he]=ie;const Z=Array.isArray(I.merges[0]);this.merges=Z?I.merges:I.merges.map(ie=>ie.split(" ",2)),this.bpe_ranks=new Map(this.merges.map((ie,he)=>[JSON.stringify(ie),he])),this.end_of_word_suffix=I.end_of_word_suffix,this.continuing_subword_suffix=I.continuing_subword_suffix??null,this.byte_fallback=this.config.byte_fallback??!1,this.byte_fallback&&(this.text_encoder=new TextEncoder),this.ignore_merges=this.config.ignore_merges??!1,this.max_length_to_cache=256,this.cache_capacity=1e4,this.cache=new l.LRUCache(this.cache_capacity)}clear_cache(){this.cache.clear()}bpe(I){if(I.length===0)return[];const Z=this.cache.get(I);if(Z!==void 0)return Z;const ie=Array.from(I);this.end_of_word_suffix&&(ie[ie.length-1]+=this.end_of_word_suffix);let he=[];if(ie.length>1){const ye=new l.PriorityQueue((rt,Je)=>rt.score<Je.score);let Ae={token:ie[0],bias:0,prev:null,next:null},He=Ae;for(let rt=1;rt<ie.length;++rt){const Je={bias:rt/ie.length,token:ie[rt],prev:He,next:null};He.next=Je,this._add_node(ye,He),He=Je}for(;!ye.isEmpty();){const rt=ye.pop();if(rt.deleted||!rt.next||rt.next.deleted)continue;if(rt.deleted=!0,rt.next.deleted=!0,rt.prev){const ot={...rt.prev};rt.prev.deleted=!0,rt.prev=ot,ot.prev?ot.prev.next=ot:Ae=ot}const Je={token:rt.token+rt.next.token,bias:rt.bias,prev:rt.prev,next:rt.next.next};Je.prev?(Je.prev.next=Je,this._add_node(ye,Je.prev)):Ae=Je,Je.next&&(Je.next.prev=Je,this._add_node(ye,Je))}for(let rt=Ae;rt!==null;rt=rt.next)he.push(rt.token)}else he=ie;if(this.continuing_subword_suffix)for(let ye=0;ye<he.length-1;++ye)he[ye]+=this.continuing_subword_suffix;return I.length<this.max_length_to_cache&&this.cache.put(I,he),he}_add_node(I,Z){const ie=this.bpe_ranks.get(JSON.stringify([Z.token,Z.next.token]));ie!==void 0&&(Z.score=ie+Z.bias,I.push(Z))}encode(I){const Z=[];for(const ie of I){if(this.ignore_merges&&this.tokens_to_ids.has(ie)){Z.push(ie);continue}const he=this.bpe(ie);for(const ye of he)if(this.tokens_to_ids.has(ye))Z.push(ye);else if(this.byte_fallback){const Ae=Array.from(this.text_encoder.encode(ye)).map(He=>`<0x${He.toString(16).toUpperCase().padStart(2,"0")}>`);Ae.every(He=>this.tokens_to_ids.has(He))?Z.push(...Ae):Z.push(this.unk_token)}else Z.push(this.unk_token)}return Z}}class J extends j{constructor(I,Z){super(I),this.tokens_to_ids=p(Z.target_lang?I.vocab[Z.target_lang]:I.vocab),this.bos_token=Z.bos_token,this.bos_token_id=this.tokens_to_ids.get(this.bos_token),this.eos_token=Z.eos_token,this.eos_token_id=this.tokens_to_ids.get(this.eos_token),this.pad_token=Z.pad_token,this.pad_token_id=this.tokens_to_ids.get(this.pad_token),this.unk_token=Z.unk_token,this.unk_token_id=this.tokens_to_ids.get(this.unk_token),this.vocab=new Array(this.tokens_to_ids.size);for(const[ie,he]of this.tokens_to_ids)this.vocab[he]=ie}encode(I){return I}}class N extends n.Callable{constructor(I){super(),this.config=I}static fromConfig(I){if(I===null)return null;switch(I.type){case"BertNormalizer":return new de(I);case"Precompiled":return new Ct(I);case"Sequence":return new Ne(I);case"Replace":return new ne(I);case"NFC":return new z(I);case"NFD":return new O(I);case"NFKC":return new H(I);case"NFKD":return new re(I);case"Strip":return new _e(I);case"StripAccents":return new oe(I);case"Lowercase":return new pe(I);case"Prepend":return new $e(I);default:throw new Error(`Unknown Normalizer type: ${I.type}`)}}normalize(I){throw Error("normalize should be implemented in subclass.")}_call(I){return this.normalize(I)}}class ne extends N{normalize(I){const Z=f(this.config.pattern);return Z===null?I:I.replaceAll(Z,this.config.content)}}class te extends N{constructor(){super(...arguments);ce(this,"form")}normalize(Z){return Z=Z.normalize(this.form),Z}}class z extends te{constructor(){super(...arguments);ce(this,"form","NFC")}}class O extends te{constructor(){super(...arguments);ce(this,"form","NFD")}}class H extends te{constructor(){super(...arguments);ce(this,"form","NFKC")}}class re extends te{constructor(){super(...arguments);ce(this,"form","NFKD")}}class _e extends N{normalize(I){return this.config.strip_left&&this.config.strip_right?I=I.trim():(this.config.strip_left&&(I=I.trimStart()),this.config.strip_right&&(I=I.trimEnd())),I}}class oe extends N{normalize(I){return I=g(I),I}}class pe extends N{normalize(I){return I=I.toLowerCase(),I}}class $e extends N{normalize(I){return I=this.config.prepend+I,I}}class Ne extends N{constructor(I){super(I),this.normalizers=I.normalizers.map(Z=>N.fromConfig(Z))}normalize(I){return this.normalizers.reduce((Z,ie)=>ie.normalize(Z),I)}}class de extends N{_tokenize_chinese_chars(I){const Z=[];for(let ie=0;ie<I.length;++ie){const he=I[ie],ye=he.charCodeAt(0);v(ye)?(Z.push(" "),Z.push(he),Z.push(" ")):Z.push(he)}return Z.join("")}stripAccents(I){return I.normalize("NFD").replace(new RegExp("\\p{Mn}","gu"),"")}_is_control(I){switch(I){case"	":case`
`:case"\r":return!1;default:return new RegExp("^\\p{Cc}|\\p{Cf}|\\p{Co}|\\p{Cs}$","u").test(I)}}_clean_text(I){const Z=[];for(const ie of I){const he=ie.charCodeAt(0);he===0||he===65533||this._is_control(ie)||(/^\s$/.test(ie)?Z.push(" "):Z.push(ie))}return Z.join("")}normalize(I){return this.config.clean_text&&(I=this._clean_text(I)),this.config.handle_chinese_chars&&(I=this._tokenize_chinese_chars(I)),this.config.lowercase?(I=I.toLowerCase(),this.config.strip_accents!==!1&&(I=this.stripAccents(I))):this.config.strip_accents&&(I=this.stripAccents(I)),I}}class q extends n.Callable{static fromConfig(I){if(I===null)return null;switch(I.type){case"BertPreTokenizer":return new se(I);case"Sequence":return new is(I);case"Whitespace":return new R(I);case"WhitespaceSplit":return new le(I);case"Metaspace":return new Ur(I);case"ByteLevel":return new Q(I);case"Split":return new Me(I);case"Punctuation":return new Te(I);case"Digits":return new ke(I);case"Replace":return new W(I);default:throw new Error(`Unknown PreTokenizer type: ${I.type}`)}}pre_tokenize_text(I,Z){throw Error("pre_tokenize_text should be implemented in subclass.")}pre_tokenize(I,Z){return(Array.isArray(I)?I.map(ie=>this.pre_tokenize_text(ie,Z)):this.pre_tokenize_text(I,Z)).flat()}_call(I,Z){return this.pre_tokenize(I,Z)}}class se extends q{constructor(I){super(),this.pattern=new RegExp(`[^\\s${M}]+|[${M}]`,"gu")}pre_tokenize_text(I,Z){return I.trim().match(this.pattern)||[]}}class Q extends q{constructor(I){super(),this.config=I,this.add_prefix_space=this.config.add_prefix_space,this.trim_offsets=this.config.trim_offsets,this.use_regex=this.config.use_regex??!0,this.pattern=new RegExp("'s|'t|'re|'ve|'m|'ll|'d| ?\\p{L}+| ?\\p{N}+| ?[^\\s\\p{L}\\p{N}]+|\\s+(?!\\S)|\\s+","gu"),this.byte_encoder=X,this.text_encoder=new TextEncoder}pre_tokenize_text(I,Z){return this.add_prefix_space&&!I.startsWith(" ")&&(I=" "+I),(this.use_regex?I.match(this.pattern)||[]:[I]).map(he=>Array.from(this.text_encoder.encode(he),ye=>this.byte_encoder[ye]).join(""))}}class Me extends q{constructor(I){super(),this.config=I,this.pattern=f(this.config.pattern,this.config.invert)}pre_tokenize_text(I,Z){var ie;return this.pattern===null?[]:this.config.invert?I.match(this.pattern)||[]:((ie=this.config.behavior)==null?void 0:ie.toLowerCase())==="removed"?I.split(this.pattern).filter(he=>he):h(I,this.pattern)}}class Te extends q{constructor(I){super(),this.config=I,this.pattern=new RegExp(`[^${M}]+|[${M}]+`,"gu")}pre_tokenize_text(I,Z){return I.match(this.pattern)||[]}}class ke extends q{constructor(I){super(),this.config=I;const Z=`[^\\d]+|\\d${this.config.individual_digits?"":"+"}`;this.pattern=new RegExp(Z,"gu")}pre_tokenize_text(I,Z){return I.match(this.pattern)||[]}}class Pe extends n.Callable{constructor(I){super(),this.config=I}static fromConfig(I){if(I===null)return null;switch(I.type){case"TemplateProcessing":return new We(I);case"ByteLevel":return new Ze(I);case"RobertaProcessing":return new Le(I);case"BertProcessing":return new Fe(I);case"Sequence":return new et(I);default:throw new Error(`Unknown PostProcessor type: ${I.type}`)}}post_process(I,...Z){throw Error("post_process should be implemented in subclass.")}_call(I,...Z){return this.post_process(I,...Z)}}class Fe extends Pe{constructor(I){super(I),this.cls=I.cls[0],this.sep=I.sep[0]}post_process(I,Z=null,{add_special_tokens:ie=!0}={}){ie&&(I=(0,s.mergeArrays)([this.cls],I,[this.sep]));let he=new Array(I.length).fill(0);if(Z!==null){const ye=ie&&this instanceof Le?[this.sep]:[],Ae=ie?[this.sep]:[];I=(0,s.mergeArrays)(I,ye,Z,Ae),he=(0,s.mergeArrays)(he,new Array(Z.length+ye.length+Ae.length).fill(1))}return{tokens:I,token_type_ids:he}}}class Le extends Fe{}class We extends Pe{constructor(I){super(I),this.single=I.single,this.pair=I.pair}post_process(I,Z=null,{add_special_tokens:ie=!0}={}){const he=Z===null?this.single:this.pair;let ye=[],Ae=[];for(const He of he)"SpecialToken"in He?ie&&(ye.push(He.SpecialToken.id),Ae.push(He.SpecialToken.type_id)):"Sequence"in He&&(He.Sequence.id==="A"?(ye=(0,s.mergeArrays)(ye,I),Ae=(0,s.mergeArrays)(Ae,new Array(I.length).fill(He.Sequence.type_id))):He.Sequence.id==="B"&&(ye=(0,s.mergeArrays)(ye,Z),Ae=(0,s.mergeArrays)(Ae,new Array(Z.length).fill(He.Sequence.type_id))));return{tokens:ye,token_type_ids:Ae}}}class Ze extends Pe{post_process(I,Z=null){return Z&&(I=(0,s.mergeArrays)(I,Z)),{tokens:I}}}class et extends Pe{constructor(I){super(I),this.processors=I.processors.map(Z=>Pe.fromConfig(Z))}post_process(I,Z=null,ie={}){let he;for(const ye of this.processors)if(ye instanceof Ze)I=ye.post_process(I).tokens,Z&&(Z=ye.post_process(Z).tokens);else{const Ae=ye.post_process(I,Z,ie);I=Ae.tokens,he=Ae.token_type_ids}return{tokens:I,token_type_ids:he}}}class Re extends n.Callable{constructor(I){super(),this.config=I,this.added_tokens=[],this.end_of_word_suffix=null,this.trim_offsets=I.trim_offsets}static fromConfig(I){if(I===null)return null;switch(I.type){case"WordPiece":return new Qe(I);case"Metaspace":return new wr(I);case"ByteLevel":return new je(I);case"Replace":return new qe(I);case"ByteFallback":return new at(I);case"Fuse":return new ct(I);case"Strip":return new lt(I);case"Sequence":return new Rt(I);case"CTC":return new yt(I);case"BPEDecoder":return new Yt(I);default:throw new Error(`Unknown Decoder type: ${I.type}`)}}_call(I){return this.decode(I)}decode(I){return this.decode_chain(I).join("")}decode_chain(I){throw Error("`decode_chain` should be implemented in subclass.")}}class qe extends Re{decode_chain(I){const Z=f(this.config.pattern);return Z===null?I:I.map(ie=>ie.replaceAll(Z,this.config.content))}}class at extends Re{constructor(I){super(I),this.text_decoder=new TextDecoder}decode_chain(I){const Z=[];let ie=[];for(const he of I){let ye=null;if(he.length===6&&he.startsWith("<0x")&&he.endsWith(">")){const Ae=parseInt(he.slice(3,5),16);isNaN(Ae)||(ye=Ae)}if(ye!==null)ie.push(ye);else{if(ie.length>0){const Ae=this.text_decoder.decode(Uint8Array.from(ie));Z.push(Ae),ie=[]}Z.push(he)}}if(ie.length>0){const he=this.text_decoder.decode(Uint8Array.from(ie));Z.push(he),ie=[]}return Z}}class ct extends Re{decode_chain(I){return[I.join("")]}}class lt extends Re{constructor(I){super(I),this.content=this.config.content,this.start=this.config.start,this.stop=this.config.stop}decode_chain(I){return I.map(Z=>{let ie=0;for(let ye=0;ye<this.start&&Z[ye]===this.content;++ye){ie=ye+1;continue}let he=Z.length;for(let ye=0;ye<this.stop;++ye){const Ae=Z.length-ye-1;if(Z[Ae]===this.content){he=Ae;continue}else break}return Z.slice(ie,he)})}}class Qe extends Re{constructor(I){super(I),this.cleanup=I.cleanup}decode_chain(I){return I.map((Z,ie)=>(ie!==0&&(Z.startsWith(this.config.prefix)?Z=Z.replace(this.config.prefix,""):Z=" "+Z),this.cleanup&&(Z=y(Z)),Z))}}class je extends Re{constructor(I){super(I),this.byte_decoder=K,this.text_decoder=new TextDecoder("utf-8",{fatal:!1,ignoreBOM:!0}),this.end_of_word_suffix=null}convert_tokens_to_string(I){const Z=I.join(""),ie=new Uint8Array([...Z].map(ye=>this.byte_decoder[ye]));return this.text_decoder.decode(ie)}decode_chain(I){const Z=[];let ie=[];for(const he of I)this.added_tokens.find(ye=>ye.content===he)!==void 0?(ie.length>0&&(Z.push(this.convert_tokens_to_string(ie)),ie=[]),Z.push(he)):ie.push(he);return ie.length>0&&Z.push(this.convert_tokens_to_string(ie)),Z}}class yt extends Re{constructor(I){super(I),this.pad_token=this.config.pad_token,this.word_delimiter_token=this.config.word_delimiter_token,this.cleanup=this.config.cleanup}convert_tokens_to_string(I){if(I.length===0)return"";const Z=[I[0]];for(let ye=1;ye<I.length;++ye)I[ye]!==Z.at(-1)&&Z.push(I[ye]);let he=Z.filter(ye=>ye!==this.pad_token).join("");return this.cleanup&&(he=y(he).replaceAll(this.word_delimiter_token," ").trim()),he}decode_chain(I){return[this.convert_tokens_to_string(I)]}}class Rt extends Re{constructor(I){super(I),this.decoders=I.decoders.map(Z=>Re.fromConfig(Z))}decode_chain(I){return this.decoders.reduce((Z,ie)=>ie.decode_chain(Z),I)}}class Yt extends Re{constructor(I){super(I),this.suffix=this.config.suffix}decode_chain(I){return I.map((Z,ie)=>Z.replaceAll(this.suffix,ie===I.length-1?"":" "))}}class Xt extends Re{decode_chain(I){let Z="";for(let ie=1;ie<I.length;ie+=2)Z+=I[ie];return[Z]}}class Ur extends q{constructor(I){super(),this.addPrefixSpace=I.add_prefix_space,this.replacement=I.replacement,this.strRep=I.str_rep||this.replacement,this.prepend_scheme=I.prepend_scheme??"always"}pre_tokenize_text(I,{section_index:Z=void 0}={}){let ie=I.replaceAll(" ",this.strRep);return this.addPrefixSpace&&!ie.startsWith(this.replacement)&&(this.prepend_scheme==="always"||this.prepend_scheme==="first"&&Z===0)&&(ie=this.strRep+ie),[ie]}}class wr extends Re{constructor(I){super(I),this.addPrefixSpace=I.add_prefix_space,this.replacement=I.replacement}decode_chain(I){const Z=[];for(let ie=0;ie<I.length;++ie){let he=I[ie].replaceAll(this.replacement," ");this.addPrefixSpace&&ie==0&&he.startsWith(" ")&&(he=he.substring(1)),Z.push(he)}return Z}}class Ct extends N{constructor(I){super(I),this.charsmap=I.precompiled_charsmap}normalize(I){return I=I.replace(/[\u0001-\u0008\u000B\u000E-\u001F\u007F\u008F\u009F]/gm,""),I=I.replace(/[\u0009\u000A\u000C\u000D\u00A0\u1680\u2000-\u200F\u2028\u2029\u202F\u205F\u2581\u3000\uFEFF\uFFFD]/gm," "),I.includes("")?I=I.split("").map(ie=>ie.normalize("NFKC")).join(""):I=I.normalize("NFKC"),I}}class is extends q{constructor(I){super(),this.tokenizers=I.pretokenizers.map(Z=>q.fromConfig(Z))}pre_tokenize_text(I,Z){return this.tokenizers.reduce((ie,he)=>he.pre_tokenize(ie,Z),[I])}}class R extends q{constructor(I){super()}pre_tokenize_text(I,Z){return I.match(/\w+|[^\w\s]+/g)||[]}}class le extends q{constructor(I){super()}pre_tokenize_text(I,Z){return x(I)}}class W extends q{constructor(I){super(),this.config=I,this.pattern=f(this.config.pattern),this.content=this.config.content}pre_tokenize_text(I,Z){return this.pattern===null?[I]:[I.replaceAll(this.pattern,this.config.content)]}}const ae=["bos_token","eos_token","unk_token","sep_token","pad_token","cls_token","mask_token"];function we(ve,I,Z,ie){for(const he of Object.keys(ve)){const ye=I-ve[he].length,Ae=Z(he),He=new Array(ye).fill(Ae);ve[he]=ie==="right"?(0,s.mergeArrays)(ve[he],He):(0,s.mergeArrays)(He,ve[he])}}function ze(ve,I){for(const Z of Object.keys(ve))ve[Z].length=I}class Ee extends n.Callable{constructor(Z,ie){super();ce(this,"return_token_type_ids",!1);ce(this,"padding_side","right");this._tokenizer_config=ie,this.normalizer=N.fromConfig(Z.normalizer),this.pre_tokenizer=q.fromConfig(Z.pre_tokenizer),this.model=j.fromConfig(Z.model,ie),this.post_processor=Pe.fromConfig(Z.post_processor),this.decoder=Re.fromConfig(Z.decoder),this.special_tokens=[],this.all_special_ids=[],this.added_tokens=[];for(const he of Z.added_tokens){const ye=new $(he);this.added_tokens.push(ye),this.model.tokens_to_ids.set(ye.content,ye.id),this.model.vocab[ye.id]=ye.content,ye.special&&(this.special_tokens.push(ye.content),this.all_special_ids.push(ye.id))}if(this.additional_special_tokens=ie.additional_special_tokens??[],this.special_tokens.push(...this.additional_special_tokens),this.special_tokens=[...new Set(this.special_tokens)],this.decoder&&(this.decoder.added_tokens=this.added_tokens,this.decoder.end_of_word_suffix=this.model.end_of_word_suffix),this.added_tokens_splitter=new l.DictionarySplitter(this.added_tokens.map(he=>he.content)),this.added_tokens_map=new Map(this.added_tokens.map(he=>[he.content,he])),this.mask_token=this.getToken("mask_token"),this.mask_token_id=this.model.tokens_to_ids.get(this.mask_token),this.pad_token=this.getToken("pad_token","eos_token"),this.pad_token_id=this.model.tokens_to_ids.get(this.pad_token),this.sep_token=this.getToken("sep_token"),this.sep_token_id=this.model.tokens_to_ids.get(this.sep_token),this.unk_token=this.getToken("unk_token"),this.unk_token_id=this.model.tokens_to_ids.get(this.unk_token),this.bos_token=this.getToken("bos_token"),this.bos_token_id=this.model.tokens_to_ids.get(this.bos_token),this.eos_token=this.getToken("eos_token"),this.eos_token_id=this.model.tokens_to_ids.get(this.eos_token),this.model_max_length=ie.model_max_length,this.remove_space=ie.remove_space,this.clean_up_tokenization_spaces=ie.clean_up_tokenization_spaces??!0,this.do_lowercase_and_remove_accent=ie.do_lowercase_and_remove_accent??!1,ie.padding_side&&(this.padding_side=ie.padding_side),this.legacy=!1,this.chat_template=ie.chat_template??null,Array.isArray(this.chat_template)){const he=Object.create(null);for(const{name:ye,template:Ae}of this.chat_template){if(typeof ye!="string"||typeof Ae!="string")throw new Error('Chat template must be a list of objects with "name" and "template" properties');he[ye]=Ae}this.chat_template=he}this._compiled_template_cache=new Map}getToken(...Z){for(const ie of Z){const he=this._tokenizer_config[ie];if(he)if(typeof he=="object"){if(he.__type==="AddedToken")return he.content;throw Error(`Unknown token: ${he}`)}else return he}return null}static async from_pretrained(Z,{progress_callback:ie=null,config:he=null,cache_dir:ye=null,local_files_only:Ae=!1,revision:He="main",legacy:rt=null}={}){const Je=await d(Z,{progress_callback:ie,config:he,cache_dir:ye,local_files_only:Ae,revision:He,legacy:rt});return new this(...Je)}_call(Z,{text_pair:ie=null,add_special_tokens:he=!0,padding:ye=!1,truncation:Ae=null,max_length:He=null,return_tensor:rt=!0,return_token_type_ids:Je=null}={}){const ot=Array.isArray(Z);let Et;if(ot){if(Z.length===0)throw Error("text array must be non-empty");if(ie!==null){if(Array.isArray(ie)){if(Z.length!==ie.length)throw Error("text and text_pair must have the same length")}else throw Error("text_pair must also be an array");Et=Z.map((qt,br)=>this._encode_plus(qt,{text_pair:ie[br],add_special_tokens:he,return_token_type_ids:Je}))}else Et=Z.map(qt=>this._encode_plus(qt,{add_special_tokens:he,return_token_type_ids:Je}))}else{if(Z==null)throw Error("text may not be null or undefined");if(Array.isArray(ie))throw Error("When specifying `text_pair`, since `text` is a string, `text_pair` must also be a string (i.e., not an array).");Et=[this._encode_plus(Z,{text_pair:ie,add_special_tokens:he,return_token_type_ids:Je})]}if(He===null?He=this.model_max_length:Ae===null&&(ye===!0?(console.warn("`max_length` is ignored when `padding: true` and there is no truncation strategy. To pad to max length, use `padding: 'max_length'`."),He=this.model_max_length):ye===!1&&(console.warn("Truncation was not explicitly activated but `max_length` is provided a specific value, please use `truncation: true` to explicitly truncate examples to max length."),Ae=!0)),ye===!0&&(He=Math.min((0,o.max)(Et.map(qt=>qt.input_ids.length))[0],He??1/0)),He=Math.min(He,this.model_max_length??1/0),ye||Ae)for(let qt=0;qt<Et.length;++qt)Et[qt].input_ids.length!==He&&(Et[qt].input_ids.length>He?Ae&&ze(Et[qt],He):ye&&we(Et[qt],He,br=>br==="input_ids"?this.pad_token_id:0,this.padding_side));const Jt={};if(rt){if(!(ye&&Ae)&&Et.some(br=>{var ar;for(const Jr of Object.keys(br))if(br[Jr].length!==((ar=Et[0][Jr])==null?void 0:ar.length))return!0;return!1}))throw Error("Unable to create tensor, you should probably activate truncation and/or padding with 'padding=true' and 'truncation=true' to have batched tensors with the same length.");const qt=[Et.length,Et[0].input_ids.length];for(const br of Object.keys(Et[0]))Jt[br]=new a.Tensor("int64",BigInt64Array.from(Et.flatMap(ar=>ar[br]).map(BigInt)),qt)}else{for(const qt of Object.keys(Et[0]))Jt[qt]=Et.map(br=>br[qt]);if(!ot)for(const qt of Object.keys(Jt))Jt[qt]=Jt[qt][0]}return Jt}_encode_text(Z){if(Z===null)return null;const ie=this.added_tokens_splitter.split(Z);for(let ye=0;ye<ie.length;++ye){const Ae=this.added_tokens_map.get(ie[ye]);Ae&&(Ae.lstrip&&ye>0&&(ie[ye-1]=ie[ye-1].trimEnd()),Ae.rstrip&&ye<ie.length-1&&(ie[ye+1]=ie[ye+1].trimStart()))}return ie.flatMap((ye,Ae)=>{if(ye.length===0)return[];if(this.added_tokens_map.has(ye))return[ye];if(this.remove_space===!0&&(ye=ye.trim().split(/\s+/).join(" ")),this.do_lowercase_and_remove_accent&&(ye=_(ye)),this.normalizer!==null&&(ye=this.normalizer(ye)),ye.length===0)return[];const He=this.pre_tokenizer!==null?this.pre_tokenizer(ye,{section_index:Ae}):[ye];return this.model(He)})}_encode_plus(Z,{text_pair:ie=null,add_special_tokens:he=!0,return_token_type_ids:ye=null}={}){const{tokens:Ae,token_type_ids:He}=this._tokenize_helper(Z,{pair:ie,add_special_tokens:he}),rt=this.model.convert_tokens_to_ids(Ae),Je={input_ids:rt,attention_mask:new Array(rt.length).fill(1)};return(ye??this.return_token_type_ids)&&He&&(Je.token_type_ids=He),Je}_tokenize_helper(Z,{pair:ie=null,add_special_tokens:he=!1}={}){const ye=this._encode_text(Z),Ae=this._encode_text(ie);return this.post_processor?this.post_processor(ye,Ae,{add_special_tokens:he}):{tokens:(0,s.mergeArrays)(ye??[],Ae??[])}}tokenize(Z,{pair:ie=null,add_special_tokens:he=!1}={}){return this._tokenize_helper(Z,{pair:ie,add_special_tokens:he}).tokens}encode(Z,{text_pair:ie=null,add_special_tokens:he=!0,return_token_type_ids:ye=null}={}){return this._encode_plus(Z,{text_pair:ie,add_special_tokens:he,return_token_type_ids:ye}).input_ids}batch_decode(Z,ie={}){return Z instanceof a.Tensor&&(Z=Z.tolist()),Z.map(he=>this.decode(he,ie))}decode(Z,ie={}){if(Z instanceof a.Tensor&&(Z=m(Z)),!Array.isArray(Z)||Z.length===0||!(0,s.isIntegralNumber)(Z[0]))throw Error("token_ids must be a non-empty array of integers.");return this.decode_single(Z,ie)}decode_single(Z,{skip_special_tokens:ie=!1,clean_up_tokenization_spaces:he=null}){let ye=this.model.convert_ids_to_tokens(Z);ie&&(ye=ye.filter(He=>!this.special_tokens.includes(He)));let Ae=this.decoder?this.decoder(ye):ye.join(" ");return this.decoder&&this.decoder.end_of_word_suffix&&(Ae=Ae.replaceAll(this.decoder.end_of_word_suffix," "),ie&&(Ae=Ae.trim())),(he??this.clean_up_tokenization_spaces)&&(Ae=y(Ae)),Ae}get_chat_template({chat_template:Z=null,tools:ie=null}={}){if(this.chat_template&&typeof this.chat_template=="object"){const he=this.chat_template;if(Z!==null&&Object.hasOwn(he,Z))Z=he[Z];else if(Z===null)if(ie!==null&&"tool_use"in he)Z=he.tool_use;else if("default"in he)Z=he.default;else throw Error(`This model has multiple chat templates with no default specified! Please either pass a chat template or the name of the template you wish to use to the 'chat_template' argument. Available template names are ${Object.keys(he).sort()}.`)}else if(Z===null)if(this.chat_template)Z=this.chat_template;else throw Error("Cannot use apply_chat_template() because tokenizer.chat_template is not set and no template argument was passed! For information about writing templates and setting the tokenizer.chat_template attribute, please see the documentation at https://huggingface.co/docs/transformers/main/en/chat_templating");return Z}apply_chat_template(Z,{tools:ie=null,documents:he=null,chat_template:ye=null,add_generation_prompt:Ae=!1,tokenize:He=!0,padding:rt=!1,truncation:Je=!1,max_length:ot=null,return_tensor:Et=!0,return_dict:Jt=!1,tokenizer_kwargs:qt={},...br}={}){if(ye=this.get_chat_template({chat_template:ye,tools:ie}),typeof ye!="string")throw Error(`chat_template must be a string, but got ${typeof ye}`);let ar=this._compiled_template_cache.get(ye);ar===void 0&&(ar=new c.Template(ye),this._compiled_template_cache.set(ye,ar));const Jr=Object.create(null);for(const pn of ae){const mn=this.getToken(pn);mn&&(Jr[pn]=mn)}const on=ar.render({messages:Z,add_generation_prompt:Ae,tools:ie,documents:he,...Jr,...br});if(He){const pn=this._call(on,{add_special_tokens:!1,padding:rt,truncation:Je,max_length:ot,return_tensor:Et,...qt});return Jt?pn:pn.input_ids}return on}}class Ot extends Ee{constructor(){super(...arguments);ce(this,"return_token_type_ids",!0)}}class Qt extends Ee{constructor(){super(...arguments);ce(this,"return_token_type_ids",!0)}}class Mt extends Ee{constructor(){super(...arguments);ce(this,"return_token_type_ids",!0)}}class vt extends Ee{constructor(){super(...arguments);ce(this,"return_token_type_ids",!0)}}class ft extends Ee{constructor(){super(...arguments);ce(this,"return_token_type_ids",!0)}}class rr extends Ee{constructor(){super(...arguments);ce(this,"return_token_type_ids",!0)}}class mr extends Ee{constructor(){super(...arguments);ce(this,"return_token_type_ids",!0)}}class sn extends Ee{constructor(){super(...arguments);ce(this,"return_token_type_ids",!0)}}class xr extends Ee{constructor(){super(...arguments);ce(this,"return_token_type_ids",!0)}}class kn extends Ee{}class zs extends Ee{}class li extends Ee{constructor(Z,ie){super(Z,ie);ce(this,"return_token_type_ids",!0);console.warn('WARNING: `XLMTokenizer` is not yet supported by Hugging Face\'s "fast" tokenizers library. Therefore, you may experience slightly inaccurate results.')}}class Bs extends Ee{constructor(){super(...arguments);ce(this,"return_token_type_ids",!0)}}class Ui extends Ee{}class Xn extends Ee{}class Gi extends Ee{}class xs extends Ee{constructor(I,Z){super(I,Z),this.languageRegex=/^[a-z]{2}_[A-Z]{2}$/,this.language_codes=this.special_tokens.filter(ie=>this.languageRegex.test(ie)),this.lang_to_token=ie=>ie}_build_translation_inputs(I,Z,ie){return Gr(this,I,Z,ie)}}class ci extends xs{}class Hi extends Ee{}class Ki extends Ee{}const Rr="";class Xi extends Ee{constructor(Z,ie){super(Z,ie);ce(this,"padding_side","left");this.legacy=ie.legacy??!0,this.legacy||(this.normalizer=null,this.pre_tokenizer=new Ur({replacement:Rr,add_prefix_space:!0,prepend_scheme:"first"}))}_encode_text(Z){if(Z===null)return null;if(this.legacy||Z.length===0)return super._encode_text(Z);let ie=super._encode_text(Rr+Z.replaceAll(Rr," "));return ie.length>1&&ie[0]===Rr&&this.special_tokens.includes(ie[1])&&(ie=ie.slice(1)),ie}}class fn extends Ee{}class ui extends Ee{}class Rn extends Ee{}class Be extends Ee{}class it extends Ee{}class _t extends Ee{}class nr extends Ee{}class Vs extends Ee{}class Ws extends Ee{}function Gr(ve,I,Z,ie){if(!("language_codes"in ve)||!Array.isArray(ve.language_codes))throw new Error("Tokenizer must have `language_codes` attribute set and it should be an array of language ids.");if(!("languageRegex"in ve)||!(ve.languageRegex instanceof RegExp))throw new Error("Tokenizer must have `languageRegex` attribute set and it should be a regular expression.");if(!("lang_to_token"in ve)||typeof ve.lang_to_token!="function")throw new Error("Tokenizer must have `lang_to_token` attribute set and it should be a function.");const he=ie.src_lang,ye=ie.tgt_lang;if(!ve.language_codes.includes(ye))throw new Error(`Target language code "${ye}" is not valid. Must be one of: {${ve.language_codes.join(", ")}}`);if(he!==void 0){if(!ve.language_codes.includes(he))throw new Error(`Source language code "${he}" is not valid. Must be one of: {${ve.language_codes.join(", ")}}`);for(const Ae of ve.post_processor.config.single)if("SpecialToken"in Ae&&ve.languageRegex.test(Ae.SpecialToken.id)){Ae.SpecialToken.id=ve.lang_to_token(he);break}}return ie.forced_bos_token_id=ve.model.convert_tokens_to_ids([ve.lang_to_token(ye)])[0],ve._call(I,Z)}class Us extends Ee{constructor(I,Z){super(I,Z),this.languageRegex=/^[a-z]{3}_[A-Z][a-z]{3}$/,this.language_codes=this.special_tokens.filter(ie=>this.languageRegex.test(ie)),this.lang_to_token=ie=>ie}_build_translation_inputs(I,Z,ie){return Gr(this,I,Z,ie)}}class Hr extends Ee{constructor(I,Z){super(I,Z),this.languageRegex=/^__[a-z]{2,3}__$/,this.language_codes=this.special_tokens.filter(ie=>this.languageRegex.test(ie)).map(ie=>ie.slice(2,-2)),this.lang_to_token=ie=>`__${ie}__`}_build_translation_inputs(I,Z,ie){return Gr(this,I,Z,ie)}}class Qr extends Ee{get timestamp_begin(){return this.model.convert_tokens_to_ids(["<|notimestamps|>"])[0]+1}_decode_asr(I,{return_timestamps:Z=!1,return_language:ie=!1,time_precision:he=null,force_full_sequences:ye=!0}={}){if(he===null)throw Error("Must specify time_precision");let Ae=null;const He=Z==="word";function rt(){return{language:Ae,timestamp:[null,null],text:""}}const Je=[];let ot=rt(),Et=0;const Jt=this.timestamp_begin,br=Jt+1500;let ar=[],Jr=[],on=!1,pn=null;const mn=new Set(this.all_special_ids);for(const hr of I){const Zr=hr.tokens,An=He?hr.token_timestamps:null;let bs=null,Ms=Jt;if("stride"in hr){const[an,Cr,Kr]=hr.stride;if(Et-=Cr,pn=an-Kr,Cr&&(Ms=Cr/he+Jt),Kr)for(let Xr=Zr.length-1;Xr>=0;--Xr){const Tn=Number(Zr[Xr]);if(Tn>=Jt){if(bs!==null&&(Tn-Jt)*he<pn)break;bs=Tn}}}let Mn=[],$n=[];for(let an=0;an<Zr.length;++an){const Cr=Number(Zr[an]);if(mn.has(Cr)){const Kr=this.decode([Cr]),Xr=u.WHISPER_LANGUAGE_MAPPING.get(Kr.slice(2,-2));if(Xr!==void 0){if(Ae!==null&&Xr!==Ae&&!Z){ar.push(Mn);const Tn=this.findLongestCommonSequence(ar)[0],Hs=this.decode(Tn);ot.text=Hs,Je.push(ot),ar=[],Mn=[],ot=rt()}Ae=ot.language=Xr}}else if(Cr>=Jt&&Cr<=br){const Kr=(Cr-Jt)*he+Et,Xr=(0,o.round)(Kr,2);if(bs!==null&&Cr>=bs)on=!0;else if(on||ar.length>0&&Cr<Ms)on=!1;else if(ot.timestamp[0]===null)ot.timestamp[0]=Xr;else if(Xr!==ot.timestamp[0]){ot.timestamp[1]=Xr,ar.push(Mn),He&&Jr.push($n);const[Tn,Hs]=this.findLongestCommonSequence(ar,Jr),il=this.decode(Tn);ot.text=il,He&&(ot.words=this.collateWordTimestamps(Tn,Hs,Ae)),Je.push(ot),ar=[],Mn=[],Jr=[],$n=[],ot=rt()}}else if(Mn.push(Cr),He){let Kr=(0,o.round)(An[an]+Et,2),Xr;if(an+1<An.length){Xr=(0,o.round)(An[an+1]+Et,2);const Tn=this.decode([Cr]);T.test(Tn)&&(Xr=(0,o.round)(Math.min(Kr+he,Xr),2))}else Xr=null;$n.push([Kr,Xr])}}if("stride"in hr){const[an,Cr,Kr]=hr.stride;Et+=an-Kr}Mn.length>0?(ar.push(Mn),He&&Jr.push($n)):ar.every(an=>an.length===0)&&(ot=rt(),ar=[],Mn=[],Jr=[],$n=[])}if(ar.length>0){if(ye&&Z)throw new Error("Whisper did not predict an ending timestamp, which can happen if audio is cut off in the middle of a word. Also make sure WhisperTimeStampLogitsProcessor was used during generation.");const[hr,Zr]=this.findLongestCommonSequence(ar,Jr),An=this.decode(hr);ot.text=An,He&&(ot.words=this.collateWordTimestamps(hr,Zr,Ae)),Je.push(ot)}let Tr=Object.create(null);const hi=Je.map(hr=>hr.text).join("");if(Z||ie){for(let hr=0;hr<Je.length;++hr){const Zr=Je[hr];Z||delete Zr.timestamp,ie||delete Zr.language}if(He){const hr=[];for(const Zr of Je)for(const An of Zr.words)hr.push(An);Tr={chunks:hr}}else Tr={chunks:Je}}return[hi,Tr]}findLongestCommonSequence(I,Z=null){let ie=I[0],he=ie.length,ye=[];const Ae=Array.isArray(Z)&&Z.length>0;let He=Ae?[]:null,rt=Ae?Z[0]:null;for(let Je=1;Je<I.length;++Je){const ot=I[Je];let Et=0,Jt=[he,he,0,0];const qt=ot.length;for(let Tr=1;Tr<he+qt;++Tr){const hi=Math.max(0,he-Tr),hr=Math.min(he,he+qt-Tr),Zr=ie.slice(hi,hr),An=Math.max(0,Tr-he),bs=Math.min(qt,Tr),Ms=ot.slice(An,bs);if(Zr.length!==Ms.length)throw new Error("There is a bug within whisper `decode_asr` function, please report it. Dropping to prevent bad inference.");let Mn;Ae?Mn=Zr.filter((Cr,Kr)=>Cr===Ms[Kr]&&rt[hi+Kr]<=Z[Je][An+Kr]).length:Mn=Zr.filter((Cr,Kr)=>Cr===Ms[Kr]).length;const $n=Tr/1e4,an=Mn/Tr+$n;Mn>1&&an>Et&&(Et=an,Jt=[hi,hr,An,bs])}const[br,ar,Jr,on]=Jt,pn=Math.floor((ar+br)/2),mn=Math.floor((on+Jr)/2);ye.push(...ie.slice(0,pn)),ie=ot.slice(mn),he=ie.length,Ae&&(He.push(...rt.slice(0,pn)),rt=Z[Je].slice(mn))}return ye.push(...ie),Ae?(He.push(...rt),[ye,He]):[ye,[]]}collateWordTimestamps(I,Z,ie){const[he,ye,Ae]=this.combineTokensIntoWords(I,ie),He=[];for(let rt=0;rt<he.length;++rt){const Je=Ae[rt];He.push({text:he[rt],timestamp:[Z[Je.at(0)][0],Z[Je.at(-1)][1]]})}return He}combineTokensIntoWords(I,Z,ie=`"'([{-`,he=`"'.,!?:)]}`){Z=Z??"english";let ye,Ae,He;return["chinese","japanese","thai","lao","myanmar"].includes(Z)?[ye,Ae,He]=this.splitTokensOnUnicode(I):[ye,Ae,He]=this.splitTokensOnSpaces(I),this.mergePunctuations(ye,Ae,He,ie,he)}decode(I,Z){let ie;return Z!=null&&Z.decode_with_timestamps?(I instanceof a.Tensor&&(I=m(I)),ie=this.decodeWithTimestamps(I,Z)):ie=super.decode(I,Z),ie}decodeWithTimestamps(I,Z){const ie=(Z==null?void 0:Z.time_precision)??.02,he=Array.from(this.all_special_ids).at(-1)+1;let ye=[[]];for(let Ae of I)if(Ae=Number(Ae),Ae>=he){const He=((Ae-he)*ie).toFixed(2);ye.push(`<|${He}|>`),ye.push([])}else ye[ye.length-1].push(Ae);return ye=ye.map(Ae=>typeof Ae=="string"?Ae:super.decode(Ae,Z)),ye.join("")}splitTokensOnUnicode(I){const Z=this.decode(I,{decode_with_timestamps:!0}),ie="",he=[],ye=[],Ae=[];let He=[],rt=[],Je=0;for(let ot=0;ot<I.length;++ot){const Et=I[ot];He.push(Et),rt.push(ot);const Jt=this.decode(He,{decode_with_timestamps:!0});(!Jt.includes(ie)||Z[Je+Jt.indexOf(ie)]===ie)&&(he.push(Jt),ye.push(He),Ae.push(rt),He=[],rt=[],Je+=Jt.length)}return[he,ye,Ae]}splitTokensOnSpaces(I){const[Z,ie,he]=this.splitTokensOnUnicode(I),ye=[],Ae=[],He=[],rt=new RegExp(`^[${M}]$`,"gu");for(let Je=0;Je<Z.length;++Je){const ot=Z[Je],Et=ie[Je],Jt=he[Je],qt=Et[0]>=this.model.tokens_to_ids.get("<|endoftext|>"),br=ot.startsWith(" "),ar=ot.trim(),Jr=rt.test(ar);if(qt||br||Jr||ye.length===0)ye.push(ot),Ae.push(Et),He.push(Jt);else{const on=ye.length-1;ye[on]+=ot,Ae[on].push(...Et),He[on].push(...Jt)}}return[ye,Ae,He]}mergePunctuations(I,Z,ie,he,ye){const Ae=structuredClone(I),He=structuredClone(Z),rt=structuredClone(ie);let Je=Ae.length-2,ot=Ae.length-1;for(;Je>=0;)Ae[Je].startsWith(" ")&&he.includes(Ae[Je].trim())?(Ae[ot]=Ae[Je]+Ae[ot],He[ot]=(0,s.mergeArrays)(He[Je],He[ot]),rt[ot]=(0,s.mergeArrays)(rt[Je],rt[ot]),Ae[Je]="",He[Je]=[],rt[Je]=[]):ot=Je,--Je;for(Je=0,ot=1;ot<Ae.length;)!Ae[Je].endsWith(" ")&&ye.includes(Ae[ot])?(Ae[Je]+=Ae[ot],He[Je]=(0,s.mergeArrays)(He[Je],He[ot]),rt[Je]=(0,s.mergeArrays)(rt[Je],rt[ot]),Ae[ot]="",He[ot]=[],rt[ot]=[]):Je=ot,++ot;return[Ae.filter(Et=>Et),He.filter(Et=>Et.length>0),rt.filter(Et=>Et.length>0)]}}class Gs extends Ee{}class di extends Ee{}class Qa extends Ee{}class Ja extends Ee{constructor(I,Z){super(I,Z),this.languageRegex=/^(>>\w+<<)\s*/g,this.supported_language_codes=this.model.vocab.filter(ie=>this.languageRegex.test(ie)),console.warn('WARNING: `MarianTokenizer` is not yet supported by Hugging Face\'s "fast" tokenizers library. Therefore, you may experience slightly inaccurate results.')}_encode_text(I){if(I===null)return null;const[Z,...ie]=I.trim().split(this.languageRegex);if(ie.length===0)return super._encode_text(Z);if(ie.length===2){const[he,ye]=ie;return this.supported_language_codes.includes(he)||console.warn(`Unsupported language code "${he}" detected, which may lead to unexpected behavior. Should be one of: ${JSON.stringify(this.supported_language_codes)}`),(0,s.mergeArrays)([he],super._encode_text(ye))}}}class Za extends Ee{}class el extends Ee{}class tl extends Ee{}class qi extends Ee{}class Yo extends Ee{}class rl extends Ee{constructor(I,Z){super(I,Z),this.decoder=new Xt({})}}class nl extends Ee{}class sl extends Ee{}class Yi{static async from_pretrained(I,{progress_callback:Z=null,config:ie=null,cache_dir:he=null,local_files_only:ye=!1,revision:Ae="main",legacy:He=null}={}){var Jt;const[rt,Je]=await d(I,{progress_callback:Z,config:ie,cache_dir:he,local_files_only:ye,revision:Ae,legacy:He}),ot=((Jt=Je.tokenizer_class)==null?void 0:Jt.replace(/Fast$/,""))??"PreTrainedTokenizer";let Et=this.TOKENIZER_CLASS_MAPPING[ot];return Et||(console.warn(`Unknown tokenizer class "${ot}", attempting to construct from base class.`),Et=Ee),new Et(rt,Je)}}ce(Yi,"TOKENIZER_CLASS_MAPPING",{T5Tokenizer:Ui,DistilBertTokenizer:kn,CamembertTokenizer:zs,DebertaTokenizer:ft,DebertaV2Tokenizer:rr,BertTokenizer:Ot,HerbertTokenizer:mr,ConvBertTokenizer:sn,RoFormerTokenizer:xr,XLMTokenizer:li,ElectraTokenizer:Bs,MobileBertTokenizer:Mt,SqueezeBertTokenizer:vt,AlbertTokenizer:Qt,GPT2Tokenizer:Xn,BartTokenizer:Gi,MBartTokenizer:xs,MBart50Tokenizer:ci,RobertaTokenizer:Hi,WhisperTokenizer:Qr,CodeGenTokenizer:Gs,CLIPTokenizer:di,SiglipTokenizer:Qa,MarianTokenizer:Ja,BloomTokenizer:Ki,NllbTokenizer:Us,M2M100Tokenizer:Hr,LlamaTokenizer:Xi,CodeLlamaTokenizer:fn,XLMRobertaTokenizer:ui,MPNetTokenizer:Rn,FalconTokenizer:Be,GPTNeoXTokenizer:it,EsmTokenizer:_t,Wav2Vec2CTCTokenizer:Za,BlenderbotTokenizer:el,BlenderbotSmallTokenizer:tl,SpeechT5Tokenizer:qi,NougatTokenizer:Yo,VitsTokenizer:rl,Qwen2Tokenizer:nr,GemmaTokenizer:Vs,Grok1Tokenizer:Ws,CohereTokenizer:nl,MgpstrTokenizer:sl,PreTrainedTokenizer:Ee})},"./src/utils/audio.js":(t,e,r)=>{r.r(e),r.d(e,{RawAudio:()=>V,hamming:()=>h,hanning:()=>d,mel_filter_bank:()=>v,read_audio:()=>c,spectrogram:()=>S,window_function:()=>k});var n=r("./src/utils/hub.js"),s=r("./src/utils/maths.js"),i=r("./src/utils/core.js"),o=r("./src/env.js"),a=r("?7a2c"),l=r("./src/utils/tensor.js");async function c(L,X){if(typeof AudioContext>"u")throw Error("Unable to load audio from path/URL since `AudioContext` is not available in your environment. Instead, audio data should be passed directly to the pipeline/processor. For more information and some example code, see https://huggingface.co/docs/transformers.js/guides/node-audio-processing.");const K=await(await(0,n.getFile)(L)).arrayBuffer(),Y=new AudioContext({sampleRate:X});typeof X>"u"&&console.warn(`No sampling rate provided, using default of ${Y.sampleRate}Hz.`);const J=await Y.decodeAudioData(K);let N;if(J.numberOfChannels===2){const ne=Math.sqrt(2),te=J.getChannelData(0),z=J.getChannelData(1);N=new Float32Array(te.length);for(let O=0;O<J.length;++O)N[O]=ne*(te[O]+z[O])/2}else N=J.getChannelData(0);return N}function u(L,X){if(L<1)return new Float64Array;if(L===1)return new Float64Array([1]);const K=1-X,Y=2*Math.PI/(L-1),J=new Float64Array(L);for(let N=0;N<L;++N)J[N]=X-K*Math.cos(N*Y);return J}function d(L){return u(L,.5)}function h(L){return u(L,.54)}const f={htk:L=>2595*Math.log10(1+L/700),kaldi:L=>1127*Math.log(1+L/700),slaney:(L,X=1e3,K=15,Y=27/Math.log(6.4))=>L>=X?K+Math.log(L/X)*Y:3*L/200};function p(L,X="htk"){const K=f[X];if(!K)throw new Error('mel_scale should be one of "htk", "slaney" or "kaldi".');return typeof L=="number"?K(L):L.map(Y=>K(Y))}const m={htk:L=>700*(10**(L/2595)-1),kaldi:L=>700*(Math.exp(L/1127)-1),slaney:(L,X=1e3,K=15,Y=Math.log(6.4)/27)=>L>=K?X*Math.exp(Y*(L-K)):200*L/3};function y(L,X="htk"){const K=m[X];if(!K)throw new Error('mel_scale should be one of "htk", "slaney" or "kaldi".');return typeof L=="number"?K(L):L.map(Y=>K(Y))}function g(L,X){const K=Float64Array.from({length:X.length-1},(ne,te)=>X[te+1]-X[te]),Y=Array.from({length:L.length},()=>new Array(X.length));for(let ne=0;ne<L.length;++ne){const te=Y[ne];for(let z=0;z<X.length;++z)te[z]=X[z]-L[ne]}const J=X.length-2,N=Array.from({length:J},()=>new Array(L.length));for(let ne=0;ne<L.length;++ne){const te=Y[ne];for(let z=0;z<J;++z){const O=-te[z]/K[z],H=te[z+2]/K[z+1];N[z][ne]=Math.max(0,Math.min(O,H))}}return N}function _(L,X,K){const Y=(X-L)/(K-1);return Float64Array.from({length:K},(J,N)=>L+Y*N)}function v(L,X,K,Y,J,N=null,ne="htk",te=!1){if(N!==null&&N!=="slaney")throw new Error('norm must be one of null or "slaney"');if(L<2)throw new Error(`Require num_frequency_bins: ${L} >= 2`);if(K>Y)throw new Error(`Require min_frequency: ${K} <= max_frequency: ${Y}`);const z=p(K,ne),O=p(Y,ne),H=_(z,O,X+2);let re=y(H,ne),_e;if(te){const pe=J/((L-1)*2);_e=p(Float64Array.from({length:L},($e,Ne)=>Ne*pe),ne),re=H}else _e=_(0,Math.floor(J/2),L);const oe=g(_e,re);if(N!==null&&N==="slaney")for(let pe=0;pe<X;++pe){const $e=oe[pe],Ne=2/(re[pe+2]-re[pe]);for(let de=0;de<L;++de)$e[de]*=Ne}return oe}function w(L,X,K){const Y=new L.constructor(L.length+X+K),J=L.length-1;for(let N=0;N<L.length;++N)Y[X+N]=L[N];for(let N=1;N<=X;++N)Y[X-N]=L[(0,i.calculateReflectOffset)(N,J)];for(let N=1;N<=K;++N)Y[J+X+N]=L[(0,i.calculateReflectOffset)(J-N,J)];return Y}function x(L,X,K,Y,J){if(K<=0)throw new Error("reference must be greater than zero");if(Y<=0)throw new Error("min_value must be greater than zero");K=Math.max(Y,K);const N=Math.log10(K);for(let ne=0;ne<L.length;++ne)L[ne]=X*Math.log10(Math.max(Y,L[ne])-N);if(J!==null){if(J<=0)throw new Error("db_range must be greater than zero");const ne=(0,s.max)(L)[0]-J;for(let te=0;te<L.length;++te)L[te]=Math.max(L[te],ne)}return L}function M(L,X=1,K=1e-5,Y=null){return x(L,20,X,K,Y)}function T(L,X=1,K=1e-10,Y=null){return x(L,10,X,K,Y)}async function S(L,X,K,Y,{fft_length:J=null,power:N=1,center:ne=!0,pad_mode:te="reflect",onesided:z=!0,preemphasis:O=null,mel_filters:H=null,mel_floor:re=1e-10,log_mel:_e=null,reference:oe=1,min_value:pe=1e-10,db_range:$e=null,remove_dc_offset:Ne=null,min_num_frames:de=null,max_num_frames:q=null,do_pad:se=!0,transpose:Q=!1}={}){const Me=X.length;if(J===null&&(J=K),K>J)throw Error(`frame_length (${K}) may not be larger than fft_length (${J})`);if(Me!==K)throw new Error(`Length of the window (${Me}) must equal frame_length (${K})`);if(Y<=0)throw new Error("hop_length must be greater than zero");if(N===null&&H!==null)throw new Error("You have provided `mel_filters` but `power` is `None`. Mel spectrogram computation is not yet supported for complex-valued spectrogram. Specify `power` to fix this issue.");if(ne){if(te!=="reflect")throw new Error(`pad_mode="${te}" not implemented yet.`);const ct=Math.floor((J-1)/2)+1;L=w(L,ct,ct)}let Te=Math.floor(1+Math.floor((L.length-K)/Y));de!==null&&Te<de&&(Te=de);const ke=z?Math.floor(J/2)+1:J;let Pe=Te,Fe=Te;q!==null&&(q>Te?se&&(Fe=q):Fe=Pe=q);const Le=new s.FFT(J),We=new Float64Array(J),Ze=new Float64Array(Le.outputBufferSize),et=new Float32Array(ke*Fe);for(let ct=0;ct<Pe;++ct){const lt=ct*Y,Qe=Math.min(L.length-lt,K);Qe!==K&&We.fill(0,0,K);for(let je=0;je<Qe;++je)We[je]=L[lt+je];if(Ne){let je=0;for(let Rt=0;Rt<Qe;++Rt)je+=We[Rt];const yt=je/Qe;for(let Rt=0;Rt<Qe;++Rt)We[Rt]-=yt}if(O!==null){for(let je=Qe-1;je>=1;--je)We[je]-=O*We[je-1];We[0]*=1-O}for(let je=0;je<X.length;++je)We[je]*=X[je];Le.realTransform(Ze,We);for(let je=0;je<ke;++je){const yt=je<<1;et[je*Fe+ct]=Ze[yt]**2+Ze[yt+1]**2}}if(N!==null&&N!==2){const ct=2/N;for(let lt=0;lt<et.length;++lt)et[lt]**=ct}const Re=H.length;let qe=await(0,l.matmul)(new l.Tensor("float32",H.flat(),[Re,ke]),new l.Tensor("float32",et,[ke,Fe]));Q&&(qe=qe.transpose(1,0));const at=qe.data;for(let ct=0;ct<at.length;++ct)at[ct]=Math.max(re,at[ct]);if(N!==null&&_e!==null){const ct=Math.min(at.length,Pe*Re);switch(_e){case"log":for(let lt=0;lt<ct;++lt)at[lt]=Math.log(at[lt]);break;case"log10":for(let lt=0;lt<ct;++lt)at[lt]=Math.log10(at[lt]);break;case"dB":if(N===1)M(at,oe,pe,$e);else if(N===2)T(at,oe,pe,$e);else throw new Error(`Cannot use log_mel option '${_e}' with power ${N}`);break;default:throw new Error(`log_mel must be one of null, 'log', 'log10' or 'dB'. Got '${_e}'`)}}return qe}function k(L,X,{periodic:K=!0,frame_length:Y=null,center:J=!0}={}){const N=K?L+1:L;let ne;switch(X){case"boxcar":ne=new Float64Array(N).fill(1);break;case"hann":case"hann_window":ne=d(N);break;case"hamming":ne=h(N);break;case"povey":ne=d(N).map(te=>Math.pow(te,.85));break;default:throw new Error(`Unknown window type ${X}.`)}if(K&&(ne=ne.subarray(0,L)),Y===null)return ne;if(L>Y)throw new Error(`Length of the window (${L}) may not be larger than frame_length (${Y})`);return ne}function $(L,X){let K=44;const Y=new ArrayBuffer(K+L.length*4),J=new DataView(Y);j(J,0,"RIFF"),J.setUint32(4,36+L.length*4,!0),j(J,8,"WAVE"),j(J,12,"fmt "),J.setUint32(16,16,!0),J.setUint16(20,3,!0),J.setUint16(22,1,!0),J.setUint32(24,X,!0),J.setUint32(28,X*4,!0),J.setUint16(32,4,!0),J.setUint16(34,32,!0),j(J,36,"data"),J.setUint32(40,L.length*4,!0);for(let N=0;N<L.length;++N,K+=4)J.setFloat32(K,L[N],!0);return Y}function j(L,X,K){for(let Y=0;Y<K.length;++Y)L.setUint8(X+Y,K.charCodeAt(Y))}class V{constructor(X,K){this.audio=X,this.sampling_rate=K}toWav(){return $(this.audio,this.sampling_rate)}toBlob(){const X=this.toWav();return new Blob([X],{type:"audio/wav"})}async save(X){let K;if(o.apis.IS_BROWSER_ENV){if(o.apis.IS_WEBWORKER_ENV)throw new Error("Unable to save a file from a Web Worker.");K=i.saveBlob}else if(o.apis.IS_FS_AVAILABLE)K=async(Y,J)=>{let N=await J.arrayBuffer();a.writeFileSync(Y,Buffer.from(N))};else throw new Error("Unable to save because filesystem is disabled in this environment.");await K(X,this.toBlob())}}},"./src/utils/constants.js":(t,e,r)=>{r.r(e),r.d(e,{CHAT_TEMPLATE_NAME:()=>l,CONFIG_NAME:()=>s,FEATURE_EXTRACTOR_NAME:()=>i,GENERATION_CONFIG_NAME:()=>c,GITHUB_ISSUE_URL:()=>n,IMAGE_PROCESSOR_NAME:()=>o,PROCESSOR_NAME:()=>a});const n="https://github.com/huggingface/transformers.js/issues/new/choose",s="config.json",i="preprocessor_config.json",o=i,a="processor_config.json",l="chat_template.json",c="generation_config.json"},"./src/utils/core.js":(t,e,r)=>{r.r(e),r.d(e,{calculateDimensions:()=>c,calculateReflectOffset:()=>f,count:()=>g,dispatchCallback:()=>n,escapeRegExp:()=>i,isIntegralNumber:()=>a,isNullishDimension:()=>l,isTypedArray:()=>o,len:()=>y,mergeArrays:()=>d,pick:()=>m,pop:()=>u,product:()=>h,reverseDictionary:()=>s,saveBlob:()=>p});function n(_,v){_&&_(v)}function s(_){return Object.fromEntries(Object.entries(_).map(([v,w])=>[w,v]))}function i(_){return _.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function o(_){var v,w,x;return((x=(w=(v=_==null?void 0:_.prototype)==null?void 0:v.__proto__)==null?void 0:w.constructor)==null?void 0:x.name)==="TypedArray"}function a(_){return Number.isInteger(_)||typeof _=="bigint"}function l(_){return _==null||_===-1}function c(_){const v=[];let w=_;for(;Array.isArray(w);)v.push(w.length),w=w[0];return v}function u(_,v,w=void 0){const x=_[v];if(x!==void 0)return delete _[v],x;if(w===void 0)throw Error(`Key ${v} does not exist in object.`);return w}function d(..._){return Array.prototype.concat.apply([],_)}function h(..._){return _.reduce((v,w)=>v.flatMap(x=>w.map(M=>[x,M])))}function f(_,v){return Math.abs((_+v)%(2*v)-v)}function p(_,v){const w=URL.createObjectURL(v),x=document.createElement("a");x.href=w,x.download=_,x.click(),x.remove(),URL.revokeObjectURL(w)}function m(_,v){return Object.assign({},...v.map(w=>{if(_[w]!==void 0)return{[w]:_[w]}}))}function y(_){let v=0;for(const w of _)++v;return v}function g(_,v){let w=0;for(const x of _)x===v&&++w;return w}},"./src/utils/data-structures.js":(t,e,r)=>{r.r(e),r.d(e,{CharTrie:()=>s,DictionarySplitter:()=>l,LRUCache:()=>c,PriorityQueue:()=>n,TokenLattice:()=>o});class n{constructor(d=(f,p)=>f>p,h=1/0){this._heap=[],this._comparator=d,this._maxSize=h}get size(){return this._heap.length}isEmpty(){return this.size===0}peek(){return this._heap[0]}push(...d){return this.extend(d)}extend(d){for(const h of d)if(this.size<this._maxSize)this._heap.push(h),this._siftUp();else{const f=this._smallest();this._comparator(h,this._heap[f])&&(this._heap[f]=h,this._siftUpFrom(f))}return this.size}pop(){const d=this.peek(),h=this.size-1;return h>0&&this._swap(0,h),this._heap.pop(),this._siftDown(),d}replace(d){const h=this.peek();return this._heap[0]=d,this._siftDown(),h}_parent(d){return(d+1>>>1)-1}_left(d){return(d<<1)+1}_right(d){return d+1<<1}_greater(d,h){return this._comparator(this._heap[d],this._heap[h])}_swap(d,h){const f=this._heap[d];this._heap[d]=this._heap[h],this._heap[h]=f}_siftUp(){this._siftUpFrom(this.size-1)}_siftUpFrom(d){for(;d>0&&this._greater(d,this._parent(d));)this._swap(d,this._parent(d)),d=this._parent(d)}_siftDown(){let d=0;for(;this._left(d)<this.size&&this._greater(this._left(d),d)||this._right(d)<this.size&&this._greater(this._right(d),d);){const h=this._right(d)<this.size&&this._greater(this._right(d),this._left(d))?this._right(d):this._left(d);this._swap(d,h),d=h}}_smallest(){return 2**Math.floor(Math.log2(this.size))-1}}class s{constructor(){this.root=i.default()}extend(d){for(const h of d)this.push(h)}push(d){let h=this.root;for(const f of d){let p=h.children.get(f);p===void 0&&(p=i.default(),h.children.set(f,p)),h=p}h.isLeaf=!0}*commonPrefixSearch(d){let h=this.root;if(h===void 0)return;let f="";for(const p of d){if(f+=p,h=h.children.get(p),h===void 0)return;h.isLeaf&&(yield f)}}}class i{constructor(d,h){this.isLeaf=d,this.children=h}static default(){return new i(!1,new Map)}}class o{constructor(d,h,f){this.chars=Array.from(d),this.len=this.chars.length,this.bosTokenId=h,this.eosTokenId=f,this.nodes=[],this.beginNodes=Array.from({length:this.len+1},()=>[]),this.endNodes=Array.from({length:this.len+1},()=>[]);const p=new a(this.bosTokenId,0,0,0,0),m=new a(this.eosTokenId,1,this.len,0,0);this.nodes.push(p.clone()),this.nodes.push(m.clone()),this.beginNodes[this.len].push(m),this.endNodes[0].push(p)}insert(d,h,f,p){const m=this.nodes.length,y=new a(p,m,d,h,f);this.beginNodes[d].push(y),this.endNodes[d+h].push(y),this.nodes.push(y)}viterbi(){const d=this.len;let h=0;for(;h<=d;){if(this.beginNodes[h].length==0)return[];for(let g of this.beginNodes[h]){g.prev=null;let _=0,v=null;for(let w of this.endNodes[h]){const x=w.backtraceScore+g.score;(v===null||x>_)&&(v=w.clone(),_=x)}if(v!==null)g.prev=v,g.backtraceScore=_;else return[]}++h}const f=[],m=this.beginNodes[d][0].prev;if(m===null)return[];let y=m.clone();for(;y.prev!==null;)f.push(y.clone()),y=y.clone().prev.clone();return f.reverse(),f}piece(d){return this.chars.slice(d.pos,d.pos+d.length).join("")}tokens(){return this.viterbi().map(h=>this.piece(h))}tokenIds(){return this.viterbi().map(h=>h.tokenId)}}class a{constructor(d,h,f,p,m){this.tokenId=d,this.nodeId=h,this.pos=f,this.length=p,this.score=m,this.prev=null,this.backtraceScore=0}clone(){const d=new a(this.tokenId,this.nodeId,this.pos,this.length,this.score);return d.prev=this.prev,d.backtraceScore=this.backtraceScore,d}}class l{constructor(d){this.trie=this._buildTrie(d)}_buildTrie(d){var f;const h=Object.create(null);for(const p of d){let m=h;for(let y=0;y<p.length;++y)m=m[f=p[y]]??(m[f]=Object.create(null));m.end=p}return h}split(d){const h=[],f=d.length;let p=0,m=0;for(;m<f;){let y=this.trie,g=null,_=m;for(;_<f&&(y=y[d[_]]);)y.end&&(g=y.end),++_;g?(m>p&&h.push(d.slice(p,m)),h.push(g),m+=g.length,p=m):++m}return p<f&&h.push(d.slice(p)),h}}class c{constructor(d){this.capacity=d,this.cache=new Map}get(d){if(!this.cache.has(d))return;const h=this.cache.get(d);return this.cache.delete(d),this.cache.set(d,h),h}put(d,h){this.cache.has(d)&&this.cache.delete(d),this.cache.set(d,h),this.cache.size>this.capacity&&this.cache.delete(this.cache.keys().next().value)}clear(){this.cache.clear()}}},"./src/utils/devices.js":(t,e,r)=>{r.r(e),r.d(e,{DEVICE_TYPES:()=>n});const n=Object.freeze({auto:"auto",gpu:"gpu",cpu:"cpu",wasm:"wasm",webgpu:"webgpu",cuda:"cuda",dml:"dml",webnn:"webnn","webnn-npu":"webnn-npu","webnn-gpu":"webnn-gpu","webnn-cpu":"webnn-cpu"})},"./src/utils/dtypes.js":(t,e,r)=>{r.r(e),r.d(e,{DATA_TYPES:()=>o,DEFAULT_DEVICE_DTYPE_MAPPING:()=>a,DEFAULT_DTYPE_SUFFIX_MAPPING:()=>l,isWebGpuFp16Supported:()=>i});var n=r("./src/env.js"),s=r("./src/utils/devices.js");const i=function(){let c;return async function(){if(c===void 0)if(!n.apis.IS_WEBGPU_AVAILABLE)c=!1;else try{c=(await navigator.gpu.requestAdapter()).features.has("shader-f16")}catch{c=!1}return c}}(),o=Object.freeze({auto:"auto",fp32:"fp32",fp16:"fp16",q8:"q8",int8:"int8",uint8:"uint8",q4:"q4",bnb4:"bnb4",q4f16:"q4f16"}),a=Object.freeze({[s.DEVICE_TYPES.wasm]:o.q8}),l=Object.freeze({[o.fp32]:"",[o.fp16]:"_fp16",[o.int8]:"_int8",[o.uint8]:"_uint8",[o.q8]:"_quantized",[o.q4]:"_q4",[o.q4f16]:"_q4f16",[o.bnb4]:"_bnb4"})},"./src/utils/generic.js":(t,e,r)=>{r.r(e),r.d(e,{Callable:()=>n});const n=class{constructor(){let s=function(...i){return s._call(...i)};return Object.setPrototypeOf(s,new.target.prototype)}_call(...s){throw Error("Must implement _call method in subclass")}}},"./src/utils/hub.js":(t,e,r)=>{r.r(e),r.d(e,{MAX_EXTERNAL_DATA_CHUNKS:()=>a,getFile:()=>f,getModelFile:()=>_,getModelJSON:()=>v});var n=r("?7a2c"),s=r("?a42a"),i=r("./src/env.js"),o=r("./src/utils/core.js");const a=100,l={txt:"text/plain",html:"text/html",css:"text/css",js:"text/javascript",json:"application/json",png:"image/png",jpg:"image/jpeg",jpeg:"image/jpeg",gif:"image/gif"};class c{constructor(T){if(this.filePath=T,this.headers=new Headers,this.exists=n.existsSync(T),this.exists){this.status=200,this.statusText="OK";let S=n.statSync(T);this.headers.set("content-length",S.size.toString()),this.updateContentType();const k=n.createReadStream(T);this.body=new ReadableStream({start($){k.on("data",j=>$.enqueue(j)),k.on("end",()=>$.close()),k.on("error",j=>$.error(j))},cancel(){k.destroy()}})}else this.status=404,this.statusText="Not Found",this.body=null}updateContentType(){const T=this.filePath.toString().split(".").pop().toLowerCase();this.headers.set("content-type",l[T]??"application/octet-stream")}clone(){let T=new c(this.filePath);return T.exists=this.exists,T.status=this.status,T.statusText=this.statusText,T.headers=new Headers(this.headers),T}async arrayBuffer(){return(await n.promises.readFile(this.filePath)).buffer}async blob(){const T=await n.promises.readFile(this.filePath);return new Blob([T],{type:this.headers.get("content-type")})}async text(){return await n.promises.readFile(this.filePath,"utf8")}async json(){return JSON.parse(await this.text())}}function u(M,T=null,S=null){let k;try{k=new URL(M)}catch{return!1}return!(T&&!T.includes(k.protocol)||S&&!S.includes(k.hostname))}const d=/^(\b[\w\-.]+\b\/)?\b[\w\-.]{1,96}\b$/;function h(M){return!(!d.test(M)||M.includes("..")||M.includes("--")||M.endsWith(".git")||M.endsWith(".ipynb"))}async function f(M){var T;if(i.env.useFS&&!u(M,["http:","https:","blob:"]))return new c(M instanceof URL?M.protocol==="file:"?M.pathname:M.toString():M);if(typeof process<"u"&&((T=process==null?void 0:process.release)==null?void 0:T.name)==="node"){const S=!!(wo!=null&&wo.TESTING_REMOTELY),k=i.env.version,$=new Headers;if($.set("User-Agent",`transformers.js/${k}; is_ci/${S};`),u(M,["http:","https:"],["huggingface.co","hf.co"])){const V=(wo==null?void 0:wo.HF_TOKEN)??(wo==null?void 0:wo.HF_ACCESS_TOKEN);V&&$.set("Authorization",`Bearer ${V}`)}return fetch(M,{headers:$})}else return fetch(M)}const p={400:"Bad request error occurred while trying to load file",401:"Unauthorized access to file",403:"Forbidden access to file",404:"Could not locate file",408:"Request timeout error occurred while trying to load file",500:"Internal server error error occurred while trying to load file",502:"Bad gateway error occurred while trying to load file",503:"Service unavailable error occurred while trying to load file",504:"Gateway timeout error occurred while trying to load file"};function m(M,T,S){if(!S)return null;const k=p[M]??`Error (${M}) occurred while trying to load file`;throw Error(`${k}: "${T}".`)}class y{constructor(T){this.path=T}async match(T){let S=s.join(this.path,T),k=new c(S);if(k.exists)return k}async put(T,S,k=void 0){let $=s.join(this.path,T);try{const j=S.headers.get("Content-Length"),V=parseInt(j??"0");let L=0;await n.promises.mkdir(s.dirname($),{recursive:!0});const X=n.createWriteStream($),K=S.body.getReader();for(;;){const{done:Y,value:J}=await K.read();if(Y)break;await new Promise((ne,te)=>{X.write(J,z=>{if(z){te(z);return}ne()})}),L+=J.length;const N=V?L/V*100:0;k==null||k({progress:N,loaded:L,total:V})}X.close()}catch(j){try{await n.promises.unlink($)}catch{}throw j}}}async function g(M,...T){for(let S of T)try{let k=await M.match(S);if(k)return k}catch{continue}}async function _(M,T,S=!0,k={},$=!1){if(!i.env.allowLocalModels){if(k.local_files_only)throw Error("Invalid configuration detected: local models are disabled (`env.allowLocalModels=false`) but you have requested to only use local models (`local_files_only=true`).");if(!i.env.allowRemoteModels)throw Error("Invalid configuration detected: both local and remote models are disabled. Fix by setting `env.allowLocalModels` or `env.allowRemoteModels` to `true`.")}(0,o.dispatchCallback)(k.progress_callback,{status:"initiate",name:M,file:T});let j;if(!j&&i.env.useCustomCache){if(!i.env.customCache)throw Error("`env.useCustomCache=true`, but `env.customCache` is not defined.");if(!i.env.customCache.match||!i.env.customCache.put)throw new Error("`env.customCache` must be an object which implements the `match` and `put` functions of the Web Cache API. For more information, see https://developer.mozilla.org/en-US/docs/Web/API/Cache");j=i.env.customCache}if(!j&&i.env.useBrowserCache){if(typeof caches>"u")throw Error("Browser cache is not available in this environment.");try{j=await caches.open("transformers-cache")}catch(re){console.warn("An error occurred while opening the browser cache:",re)}}if(!j&&i.env.useFSCache){if(!i.apis.IS_FS_AVAILABLE)throw Error("File System Cache is not available in this environment.");j=new y(k.cache_dir??i.env.cacheDir)}const V=k.revision??"main",L=x(M,T),X=h(M),K=X?x(i.env.localModelPath,L):L,Y=x(i.env.remoteHost,i.env.remotePathTemplate.replaceAll("{model}",M).replaceAll("{revision}",encodeURIComponent(V)),T);let J;const N=j instanceof y?V==="main"?L:x(M,V,T):Y;let ne=!1,te;j&&(te=await g(j,K,N));const z=te!==void 0;if(te===void 0){if(i.env.allowLocalModels)if(u(L,["http:","https:"])){if(k.local_files_only)throw new Error(`\`local_files_only=true\`, but attempted to load a remote file from: ${L}.`);if(!i.env.allowRemoteModels)throw new Error(`\`env.allowRemoteModels=false\`, but attempted to load a remote file from: ${L}.`)}else try{te=await f(K),J=K}catch(_e){console.warn(`Unable to load from local path "${K}": "${_e}"`)}if(te===void 0||te.status===404){if(k.local_files_only||!i.env.allowRemoteModels){if(S)throw Error(`\`local_files_only=true\` or \`env.allowRemoteModels=false\` and file was not found locally at "${K}".`);return null}if(!X)throw Error(`Local file missing at "${K}" and download aborted due to invalid model ID "${M}".`);if(te=await f(Y),te.status!==200)return m(te.status,Y,S);J=N}ne=j&&typeof Response<"u"&&te instanceof Response&&te.status===200}(0,o.dispatchCallback)(k.progress_callback,{status:"download",name:M,file:T});let O;if(!(i.apis.IS_NODE_ENV&&$)){let re;k.progress_callback?z&&typeof navigator<"u"&&/firefox/i.test(navigator.userAgent)?(re=new Uint8Array(await te.arrayBuffer()),(0,o.dispatchCallback)(k.progress_callback,{status:"progress",name:M,file:T,progress:100,loaded:re.length,total:re.length})):re=await w(te,_e=>{(0,o.dispatchCallback)(k.progress_callback,{status:"progress",name:M,file:T,..._e})}):re=new Uint8Array(await te.arrayBuffer()),O=re}if(ne&&J&&await j.match(J)===void 0&&(O?await j.put(J,new Response(O,{headers:te.headers})).catch(re=>{console.warn(`Unable to add response to browser cache: ${re}.`)}):await j.put(J,te,k.progress_callback)),(0,o.dispatchCallback)(k.progress_callback,{status:"done",name:M,file:T}),O){if(!i.apis.IS_NODE_ENV&&$)throw new Error("Cannot return path in a browser environment.");return O}if(te instanceof c)return te.filePath;const H=await(j==null?void 0:j.match(J));if(H instanceof c)return H.filePath;if(H instanceof Response)return new Uint8Array(await H.arrayBuffer());if(typeof H=="string")return H;throw new Error("Unable to get model file path or buffer.")}async function v(M,T,S=!0,k={}){const $=await _(M,T,S,k,!1);if($===null)return{};const V=new TextDecoder("utf-8").decode($);return JSON.parse(V)}async function w(M,T){const S=M.headers.get("Content-Length");S===null&&console.warn("Unable to determine content-length from response headers. Will expand buffer when needed.");let k=parseInt(S??"0"),$=new Uint8Array(k),j=0;const V=M.body.getReader();async function L(){const{done:X,value:K}=await V.read();if(X)return;const Y=j+K.length;if(Y>k){k=Y;const N=new Uint8Array(k);N.set($),$=N}$.set(K,j),j=Y;const J=j/k*100;return T({progress:J,loaded:j,total:k}),L()}return await L(),$}function x(...M){return M=M.map((T,S)=>(S&&(T=T.replace(new RegExp("^/"),"")),S!==M.length-1&&(T=T.replace(new RegExp("/$"),"")),T)),M.join("/")}},"./src/utils/image.js":(t,e,r)=>{r.r(e),r.d(e,{RawImage:()=>p,load_image:()=>m});var n=r("./src/utils/core.js"),s=r("./src/utils/hub.js"),i=r("./src/env.js"),o=r("./src/utils/tensor.js"),a=r("?2b25");let l,c,u;const d=i.apis.IS_BROWSER_ENV||i.apis.IS_WEBWORKER_ENV;if(d)l=(y,g)=>{if(!self.OffscreenCanvas)throw new Error("OffscreenCanvas not supported by this browser.");return new self.OffscreenCanvas(y,g)},u=self.createImageBitmap,c=self.ImageData;else if(a)u=async y=>{const _=(await y.metadata()).channels,{data:v,info:w}=await y.rotate().raw().toBuffer({resolveWithObject:!0}),x=new p(new Uint8ClampedArray(v),w.width,w.height,w.channels);return _!==void 0&&_!==w.channels&&x.convert(_),x};else throw new Error("Unable to load image processing library.");const h={0:"nearest",1:"lanczos",2:"bilinear",3:"bicubic",4:"box",5:"hamming"},f=new Map([["png","image/png"],["jpg","image/jpeg"],["jpeg","image/jpeg"],["gif","image/gif"]]);class p{constructor(g,_,v,w){this.data=g,this.width=_,this.height=v,this.channels=w}get size(){return[this.width,this.height]}static async read(g){if(g instanceof p)return g;if(typeof g=="string"||g instanceof URL)return await this.fromURL(g);if(g instanceof Blob)return await this.fromBlob(g);if(typeof HTMLCanvasElement<"u"&&g instanceof HTMLCanvasElement||typeof OffscreenCanvas<"u"&&g instanceof OffscreenCanvas)return this.fromCanvas(g);throw new Error(`Unsupported input type: ${typeof g}`)}static fromCanvas(g){if(!d)throw new Error("fromCanvas() is only supported in browser environments.");const v=g.getContext("2d").getImageData(0,0,g.width,g.height).data;return new p(v,g.width,g.height,4)}static async fromURL(g){const _=await(0,s.getFile)(g);if(_.status!==200)throw new Error(`Unable to read image from "${g}" (${_.status} ${_.statusText})`);const v=await _.blob();return this.fromBlob(v)}static async fromBlob(g){if(d){const _=await u(g),v=l(_.width,_.height).getContext("2d");return v.drawImage(_,0,0),new this(v.getImageData(0,0,_.width,_.height).data,_.width,_.height,4)}else{const _=a(await g.arrayBuffer());return await u(_)}}static fromTensor(g,_="CHW"){if(g.dims.length!==3)throw new Error(`Tensor should have 3 dimensions, but has ${g.dims.length} dimensions.`);if(_==="CHW")g=g.transpose(1,2,0);else if(_!=="HWC")throw new Error(`Unsupported channel format: ${_}`);if(!(g.data instanceof Uint8ClampedArray||g.data instanceof Uint8Array))throw new Error(`Unsupported tensor type: ${g.type}`);switch(g.dims[2]){case 1:case 2:case 3:case 4:return new p(g.data,g.dims[1],g.dims[0],g.dims[2]);default:throw new Error(`Unsupported number of channels: ${g.dims[2]}`)}}grayscale(){if(this.channels===1)return this;const g=new Uint8ClampedArray(this.width*this.height*1);switch(this.channels){case 3:case 4:for(let _=0,v=0;_<this.data.length;_+=this.channels){const w=this.data[_],x=this.data[_+1],M=this.data[_+2];g[v++]=Math.round(.2989*w+.587*x+.114*M)}break;default:throw new Error(`Conversion failed due to unsupported number of channels: ${this.channels}`)}return this._update(g,this.width,this.height,1)}rgb(){if(this.channels===3)return this;const g=new Uint8ClampedArray(this.width*this.height*3);switch(this.channels){case 1:for(let _=0,v=0;_<this.data.length;++_)g[v++]=this.data[_],g[v++]=this.data[_],g[v++]=this.data[_];break;case 4:for(let _=0,v=0;_<this.data.length;_+=4)g[v++]=this.data[_],g[v++]=this.data[_+1],g[v++]=this.data[_+2];break;default:throw new Error(`Conversion failed due to unsupported number of channels: ${this.channels}`)}return this._update(g,this.width,this.height,3)}rgba(){if(this.channels===4)return this;const g=new Uint8ClampedArray(this.width*this.height*4);switch(this.channels){case 1:for(let _=0,v=0;_<this.data.length;++_)g[v++]=this.data[_],g[v++]=this.data[_],g[v++]=this.data[_],g[v++]=255;break;case 3:for(let _=0,v=0;_<this.data.length;_+=3)g[v++]=this.data[_],g[v++]=this.data[_+1],g[v++]=this.data[_+2],g[v++]=255;break;default:throw new Error(`Conversion failed due to unsupported number of channels: ${this.channels}`)}return this._update(g,this.width,this.height,4)}putAlpha(g){if(g.width!==this.width||g.height!==this.height)throw new Error(`Expected mask size to be ${this.width}x${this.height}, but got ${g.width}x${g.height}`);if(g.channels!==1)throw new Error(`Expected mask to have 1 channel, but got ${g.channels}`);const _=this.data,v=g.data,w=this.width*this.height;if(this.channels===3){const x=new Uint8ClampedArray(w*4);for(let M=0,T=0,S=0;M<w;++M)x[S++]=_[T++],x[S++]=_[T++],x[S++]=_[T++],x[S++]=v[M];return this._update(x,this.width,this.height,4)}else if(this.channels===4){for(let x=0;x<w;++x)_[4*x+3]=v[x];return this}throw new Error(`Expected image to have 3 or 4 channels, but got ${this.channels}`)}async resize(g,_,{resample:v=2}={}){if(this.width===g&&this.height===_)return this;let w=h[v]??v;const x=(0,n.isNullishDimension)(g),M=(0,n.isNullishDimension)(_);if(x&&M)return this;if(x?g=_/this.height*this.width:M&&(_=g/this.width*this.height),d){const T=this.channels,S=this.toCanvas(),k=l(g,_).getContext("2d");return k.drawImage(S,0,0,g,_),new p(k.getImageData(0,0,g,_).data,g,_,4).convert(T)}else{let T=this.toSharp();switch(w){case"box":case"hamming":(w==="box"||w==="hamming")&&(console.warn(`Resampling method ${w} is not yet supported. Using bilinear instead.`),w="bilinear");case"nearest":case"bilinear":case"bicubic":T=T.affine([g/this.width,0,0,_/this.height],{interpolator:w});break;case"lanczos":T=T.resize({width:g,height:_,fit:"fill",kernel:"lanczos3"});break;default:throw new Error(`Resampling method ${w} is not supported.`)}return await u(T)}}async pad([g,_,v,w]){if(g=Math.max(g,0),_=Math.max(_,0),v=Math.max(v,0),w=Math.max(w,0),g===0&&_===0&&v===0&&w===0)return this;if(d){const x=this.channels,M=this.toCanvas(),T=this.width+g+_,S=this.height+v+w,k=l(T,S).getContext("2d");return k.drawImage(M,0,0,this.width,this.height,g,v,this.width,this.height),new p(k.getImageData(0,0,T,S).data,T,S,4).convert(x)}else{const x=this.toSharp().extend({left:g,right:_,top:v,bottom:w});return await u(x)}}async crop([g,_,v,w]){if(g=Math.max(g,0),_=Math.max(_,0),v=Math.min(v,this.width-1),w=Math.min(w,this.height-1),g===0&&_===0&&v===this.width-1&&w===this.height-1)return this;const x=v-g+1,M=w-_+1;if(d){const T=this.channels,S=this.toCanvas(),k=l(x,M).getContext("2d");return k.drawImage(S,g,_,x,M,0,0,x,M),new p(k.getImageData(0,0,x,M).data,x,M,4).convert(T)}else{const T=this.toSharp().extract({left:g,top:_,width:x,height:M});return await u(T)}}async center_crop(g,_){if(this.width===g&&this.height===_)return this;const v=(this.width-g)/2,w=(this.height-_)/2;if(d){const x=this.channels,M=this.toCanvas(),T=l(g,_).getContext("2d");let S=0,k=0,$=0,j=0;return v>=0?S=v:$=-v,w>=0?k=w:j=-w,T.drawImage(M,S,k,g,_,$,j,g,_),new p(T.getImageData(0,0,g,_).data,g,_,4).convert(x)}else{let x=this.toSharp();if(v>=0&&w>=0)x=x.extract({left:Math.floor(v),top:Math.floor(w),width:g,height:_});else if(v<=0&&w<=0){const M=Math.floor(-w),T=Math.floor(-v);x=x.extend({top:M,left:T,right:g-this.width-T,bottom:_-this.height-M})}else{let M=[0,0],T=0;w<0?(M[0]=Math.floor(-w),M[1]=_-this.height-M[0]):T=Math.floor(w);let S=[0,0],k=0;v<0?(S[0]=Math.floor(-v),S[1]=g-this.width-S[0]):k=Math.floor(v),x=x.extend({top:M[0],bottom:M[1],left:S[0],right:S[1]}).extract({left:k,top:T,width:g,height:_})}return await u(x)}}async toBlob(g="image/png",_=1){if(!d)throw new Error("toBlob() is only supported in browser environments.");return await this.toCanvas().convertToBlob({type:g,quality:_})}toTensor(g="CHW"){let _=new o.Tensor("uint8",new Uint8Array(this.data),[this.height,this.width,this.channels]);if(g!=="HWC")if(g==="CHW")_=_.permute(2,0,1);else throw new Error(`Unsupported channel format: ${g}`);return _}toCanvas(){if(!d)throw new Error("toCanvas() is only supported in browser environments.");const g=this.clone().rgba(),_=l(g.width,g.height),v=new c(g.data,g.width,g.height);return _.getContext("2d").putImageData(v,0,0),_}split(){const{data:g,width:_,height:v,channels:w}=this,x=g.constructor,M=g.length/w,T=Array.from({length:w},()=>new x(M));for(let S=0;S<M;++S){const k=w*S;for(let $=0;$<w;++$)T[$][S]=g[k+$]}return T.map(S=>new p(S,_,v,1))}_update(g,_,v,w=null){return this.data=g,this.width=_,this.height=v,w!==null&&(this.channels=w),this}clone(){return new p(this.data.slice(),this.width,this.height,this.channels)}convert(g){if(this.channels===g)return this;switch(g){case 1:this.grayscale();break;case 3:this.rgb();break;case 4:this.rgba();break;default:throw new Error(`Conversion failed due to unsupported number of channels: ${this.channels}`)}return this}async save(g){if(d){if(i.apis.IS_WEBWORKER_ENV)throw new Error("Unable to save an image from a Web Worker.");const _=g.split(".").pop().toLowerCase(),v=f.get(_)??"image/png",w=await this.toBlob(v);(0,n.saveBlob)(g,w)}else{if(i.apis.IS_FS_AVAILABLE)return await this.toSharp().toFile(g);throw new Error("Unable to save the image because filesystem is disabled in this environment.")}}toSharp(){if(d)throw new Error("toSharp() is only supported in server-side environments.");return a(this.data,{raw:{width:this.width,height:this.height,channels:this.channels}})}}const m=p.read.bind(p)},"./src/utils/maths.js":(t,e,r)=>{r.r(e),r.d(e,{FFT:()=>m,bankers_round:()=>_,cos_sim:()=>l,dot:()=>a,dynamic_time_warping:()=>v,interpolate_data:()=>n,log_softmax:()=>o,magnitude:()=>c,max:()=>d,medianFilter:()=>y,min:()=>u,permute_data:()=>s,round:()=>g,softmax:()=>i});function n(w,[x,M,T],[S,k],$="bilinear",j=!1){const V=k/T,L=S/M,X=new w.constructor(S*k*x),K=M*T,Y=S*k;for(let J=0;J<S;++J)for(let N=0;N<k;++N){const ne=J*k+N,te=(N+.5)/V-.5,z=(J+.5)/L-.5;let O=Math.floor(te),H=Math.floor(z);const re=Math.min(O+1,T-1),_e=Math.min(H+1,M-1);O=Math.max(O,0),H=Math.max(H,0);const oe=te-O,pe=z-H,$e=(1-oe)*(1-pe),Ne=oe*(1-pe),de=(1-oe)*pe,q=oe*pe,se=H*T,Q=_e*T,Me=se+O,Te=se+re,ke=Q+O,Pe=Q+re;for(let Fe=0;Fe<x;++Fe){const Le=Fe*K;X[Fe*Y+ne]=$e*w[Le+Me]+Ne*w[Le+Te]+de*w[Le+ke]+q*w[Le+Pe]}}return X}function s(w,x,M){const T=new Array(M.length),S=new Array(M.length);for(let j=M.length-1,V=1;j>=0;--j)S[j]=V,T[j]=x[M[j]],V*=T[j];const k=M.map((j,V)=>S[M.indexOf(V)]),$=new w.constructor(w.length);for(let j=0;j<w.length;++j){let V=0;for(let L=x.length-1,X=j;L>=0;--L)V+=X%x[L]*k[L],X=Math.floor(X/x[L]);$[V]=w[j]}return[$,T]}function i(w){const x=d(w)[0],M=w.map(k=>Math.exp(k-x)),T=M.reduce((k,$)=>k+$,0);return M.map(k=>k/T)}function o(w){const x=d(w)[0];let M=0;for(let k=0;k<w.length;++k)M+=Math.exp(w[k]-x);const T=Math.log(M);return w.map(k=>k-x-T)}function a(w,x){let M=0;for(let T=0;T<w.length;++T)M+=w[T]*x[T];return M}function l(w,x){const M=a(w,x),T=c(w),S=c(x);return M/(T*S)}function c(w){return Math.sqrt(w.reduce((x,M)=>x+M*M,0))}function u(w){if(w.length===0)throw Error("Array must not be empty");let x=w[0],M=0;for(let T=1;T<w.length;++T)w[T]<x&&(x=w[T],M=T);return[x,M]}function d(w){if(w.length===0)throw Error("Array must not be empty");let x=w[0],M=0;for(let T=1;T<w.length;++T)w[T]>x&&(x=w[T],M=T);return[x,M]}function h(w){return w>0&&(w&w-1)===0}class f{constructor(x){if(this.size=x|0,this.size<=1||!h(this.size))throw new Error("FFT size must be a power of two larger than 1");this._csize=x<<1,this.table=new Float64Array(this.size*2);for(let T=0;T<this.table.length;T+=2){const S=Math.PI*T/this.size;this.table[T]=Math.cos(S),this.table[T+1]=-Math.sin(S)}let M=0;for(let T=1;this.size>T;T<<=1)++M;this._width=M%2===0?M-1:M,this._bitrev=new Int32Array(1<<this._width);for(let T=0;T<this._bitrev.length;++T){this._bitrev[T]=0;for(let S=0;S<this._width;S+=2){const k=this._width-S-2;this._bitrev[T]|=(T>>>S&3)<<k}}}createComplexArray(){return new Float64Array(this._csize)}fromComplexArray(x,M){const T=M||new Array(x.length>>>1);for(let S=0;S<x.length;S+=2)T[S>>>1]=x[S];return T}toComplexArray(x,M){const T=M||this.createComplexArray();for(let S=0;S<T.length;S+=2)T[S]=x[S>>>1],T[S+1]=0;return T}transform(x,M){if(x===M)throw new Error("Input and output buffers must be different");this._transform4(x,M,1)}realTransform(x,M){if(x===M)throw new Error("Input and output buffers must be different");this._realTransform4(x,M,1)}inverseTransform(x,M){if(x===M)throw new Error("Input and output buffers must be different");this._transform4(x,M,-1);for(let T=0;T<x.length;++T)x[T]/=this.size}_transform4(x,M,T){const S=this._csize;let $=1<<this._width,j=S/$<<1,V,L;const X=this._bitrev;if(j===4)for(V=0,L=0;V<S;V+=j,++L){const Y=X[L];this._singleTransform2(M,x,V,Y,$)}else for(V=0,L=0;V<S;V+=j,++L){const Y=X[L];this._singleTransform4(M,x,V,Y,$,T)}const K=this.table;for($>>=2;$>=2;$>>=2){j=S/$<<1;const Y=j>>>2;for(V=0;V<S;V+=j){const J=V+Y-1;for(let N=V,ne=0;N<J;N+=2,ne+=$){const te=N,z=te+Y,O=z+Y,H=O+Y,re=x[te],_e=x[te+1],oe=x[z],pe=x[z+1],$e=x[O],Ne=x[O+1],de=x[H],q=x[H+1],se=K[ne],Q=T*K[ne+1],Me=oe*se-pe*Q,Te=oe*Q+pe*se,ke=K[2*ne],Pe=T*K[2*ne+1],Fe=$e*ke-Ne*Pe,Le=$e*Pe+Ne*ke,We=K[3*ne],Ze=T*K[3*ne+1],et=de*We-q*Ze,Re=de*Ze+q*We,qe=re+Fe,at=_e+Le,ct=re-Fe,lt=_e-Le,Qe=Me+et,je=Te+Re,yt=T*(Me-et),Rt=T*(Te-Re);x[te]=qe+Qe,x[te+1]=at+je,x[z]=ct+Rt,x[z+1]=lt-yt,x[O]=qe-Qe,x[O+1]=at-je,x[H]=ct-Rt,x[H+1]=lt+yt}}}}_singleTransform2(x,M,T,S,k){const $=x[S],j=x[S+1],V=x[S+k],L=x[S+k+1];M[T]=$+V,M[T+1]=j+L,M[T+2]=$-V,M[T+3]=j-L}_singleTransform4(x,M,T,S,k,$){const j=k*2,V=k*3,L=x[S],X=x[S+1],K=x[S+k],Y=x[S+k+1],J=x[S+j],N=x[S+j+1],ne=x[S+V],te=x[S+V+1],z=L+J,O=X+N,H=L-J,re=X-N,_e=K+ne,oe=Y+te,pe=$*(K-ne),$e=$*(Y-te);M[T]=z+_e,M[T+1]=O+oe,M[T+2]=H+$e,M[T+3]=re-pe,M[T+4]=z-_e,M[T+5]=O-oe,M[T+6]=H-$e,M[T+7]=re+pe}_realTransform4(x,M,T){const S=this._csize;let $=1<<this._width,j=S/$<<1,V,L;const X=this._bitrev;if(j===4)for(V=0,L=0;V<S;V+=j,++L){const J=X[L];this._singleRealTransform2(M,x,V,J>>>1,$>>>1)}else for(V=0,L=0;V<S;V+=j,++L){const J=X[L];this._singleRealTransform4(M,x,V,J>>>1,$>>>1,T)}const K=this.table;for($>>=2;$>=2;$>>=2){j=S/$<<1;const J=j>>>1,N=J>>>1,ne=N>>>1;for(V=0;V<S;V+=j)for(let te=0,z=0;te<=ne;te+=2,z+=$){const O=V+te,H=O+N,re=H+N,_e=re+N,oe=x[O],pe=x[O+1],$e=x[H],Ne=x[H+1],de=x[re],q=x[re+1],se=x[_e],Q=x[_e+1],Me=oe,Te=pe,ke=K[z],Pe=T*K[z+1],Fe=$e*ke-Ne*Pe,Le=$e*Pe+Ne*ke,We=K[2*z],Ze=T*K[2*z+1],et=de*We-q*Ze,Re=de*Ze+q*We,qe=K[3*z],at=T*K[3*z+1],ct=se*qe-Q*at,lt=se*at+Q*qe,Qe=Me+et,je=Te+Re,yt=Me-et,Rt=Te-Re,Yt=Fe+ct,Xt=Le+lt,Ur=T*(Fe-ct),wr=T*(Le-lt);if(x[O]=Qe+Yt,x[O+1]=je+Xt,x[H]=yt+wr,x[H+1]=Rt-Ur,te===0){x[re]=Qe-Yt,x[re+1]=je-Xt;continue}if(te===ne)continue;const Ct=V+N-te,is=V+J-te;x[Ct]=yt-T*wr,x[Ct+1]=-Rt-T*Ur,x[is]=Qe-T*Yt,x[is+1]=-je+T*Xt}}const Y=S>>>1;for(let J=2;J<Y;J+=2)x[S-J]=x[J],x[S-J+1]=-x[J+1]}_singleRealTransform2(x,M,T,S,k){const $=x[S],j=x[S+k];M[T]=$+j,M[T+1]=0,M[T+2]=$-j,M[T+3]=0}_singleRealTransform4(x,M,T,S,k,$){const j=k*2,V=k*3,L=x[S],X=x[S+k],K=x[S+j],Y=x[S+V],J=L+K,N=L-K,ne=X+Y,te=$*(X-Y);M[T]=J+ne,M[T+1]=0,M[T+2]=N,M[T+3]=-te,M[T+4]=J-ne,M[T+5]=0,M[T+6]=N,M[T+7]=te}}class p{constructor(x){const M=2*(x-1),T=2*(2*x-1),S=2**Math.ceil(Math.log2(T));this.bufferSize=S,this._a=M;const k=new Float64Array(T),$=new Float64Array(S);this._chirpBuffer=new Float64Array(S),this._buffer1=new Float64Array(S),this._buffer2=new Float64Array(S),this._outBuffer1=new Float64Array(S),this._outBuffer2=new Float64Array(S);const j=-2*Math.PI/x,V=Math.cos(j),L=Math.sin(j);for(let X=0;X<T>>1;++X){const K=(X+1-x)**2/2,Y=Math.sqrt(V**2+L**2)**K,J=K*Math.atan2(L,V),N=2*X;k[N]=Y*Math.cos(J),k[N+1]=Y*Math.sin(J),$[N]=k[N],$[N+1]=-k[N+1]}this._slicedChirpBuffer=k.subarray(M,T),this._f=new f(S>>1),this._f.transform(this._chirpBuffer,$)}_transform(x,M,T){const S=this._buffer1,k=this._buffer2,$=this._outBuffer1,j=this._outBuffer2,V=this._chirpBuffer,L=this._slicedChirpBuffer,X=this._a;if(T)for(let K=0;K<L.length;K+=2){const Y=K+1,J=K>>1,N=M[J];S[K]=N*L[K],S[Y]=N*L[Y]}else for(let K=0;K<L.length;K+=2){const Y=K+1;S[K]=M[K]*L[K]-M[Y]*L[Y],S[Y]=M[K]*L[Y]+M[Y]*L[K]}this._f.transform($,S);for(let K=0;K<V.length;K+=2){const Y=K+1;k[K]=$[K]*V[K]-$[Y]*V[Y],k[Y]=$[K]*V[Y]+$[Y]*V[K]}this._f.inverseTransform(j,k);for(let K=0;K<j.length;K+=2){const Y=j[K+X],J=j[K+X+1],N=L[K],ne=L[K+1];x[K]=Y*N-J*ne,x[K+1]=Y*ne+J*N}}transform(x,M){this._transform(x,M,!1)}realTransform(x,M){this._transform(x,M,!0)}}class m{constructor(x){this.fft_length=x,this.isPowerOfTwo=h(x),this.isPowerOfTwo?(this.fft=new f(x),this.outputBufferSize=2*x):(this.fft=new p(x),this.outputBufferSize=this.fft.bufferSize)}realTransform(x,M){this.fft.realTransform(x,M)}transform(x,M){this.fft.transform(x,M)}}function y(w,x){if(x%2===0||x<=0)throw new Error("Window size must be a positive odd number");const M=new w.constructor(w.length),T=new w.constructor(x),S=Math.floor(x/2);for(let k=0;k<w.length;++k){let $=0;for(let j=-S;j<=S;++j){let V=k+j;V<0?V=Math.abs(V):V>=w.length&&(V=2*(w.length-1)-V),T[$++]=w[V]}T.sort(),M[k]=T[S]}return M}function g(w,x){const M=Math.pow(10,x);return Math.round(w*M)/M}function _(w){const x=Math.round(w);return Math.abs(w)%1===.5?x%2===0?x:x-1:x}function v(w){const x=w.length,M=w[0].length,T=[x+1,M+1],S=Array.from({length:T[0]},()=>Array(T[1]).fill(1/0));S[0][0]=0;const k=Array.from({length:T[0]},()=>Array(T[1]).fill(-1));for(let X=1;X<T[1];++X)for(let K=1;K<T[0];++K){const Y=S[K-1][X-1],J=S[K-1][X],N=S[K][X-1];let ne,te;Y<J&&Y<N?(ne=Y,te=0):J<Y&&J<N?(ne=J,te=1):(ne=N,te=2),S[K][X]=w[K-1][X-1]+ne,k[K][X]=te}for(let X=0;X<T[1];++X)k[0][X]=2;for(let X=0;X<T[0];++X)k[X][0]=1;let $=x,j=M,V=[],L=[];for(;$>0||j>0;)switch(V.push($-1),L.push(j-1),k[$][j]){case 0:--$,--j;break;case 1:--$;break;case 2:--j;break;default:throw new Error(`Internal error in dynamic time warping. Unexpected trace[${$}, ${j}]. Please file a bug report.`)}return V.reverse(),L.reverse(),[V,L]}},"./src/utils/tensor.js":(t,e,r)=>{r.r(e),r.d(e,{DataTypeMap:()=>o,Tensor:()=>a,cat:()=>M,full:()=>L,full_like:()=>X,interpolate:()=>u,interpolate_4d:()=>d,layer_norm:()=>_,matmul:()=>h,mean:()=>$,mean_pooling:()=>g,ones:()=>K,ones_like:()=>Y,permute:()=>c,quantize_embeddings:()=>te,rand:()=>ne,rfft:()=>f,slice:()=>y,stack:()=>T,std_mean:()=>k,topk:()=>p,zeros:()=>J,zeros_like:()=>N});var n=r("./src/utils/maths.js"),s=r("./src/backends/onnx.js"),i=r("./src/ops/registry.js");const o=Object.freeze({float32:Float32Array,float16:typeof Float16Array<"u"?Float16Array:Uint16Array,float64:Float64Array,string:Array,int8:Int8Array,uint8:Uint8Array,int16:Int16Array,uint16:Uint16Array,int32:Int32Array,uint32:Uint32Array,int64:BigInt64Array,uint64:BigUint64Array,bool:Uint8Array,uint4:Uint8Array,int4:Int8Array});class a{constructor(...O){ce(this,"ort_tensor");return(0,s.isONNXTensor)(O[0])?this.ort_tensor=O[0]:this.ort_tensor=new s.Tensor(O[0],O[1],O[2]),new Proxy(this,{get:(H,re)=>{if(typeof re=="string"){let _e=Number(re);if(Number.isInteger(_e))return H._getitem(_e)}return H[re]},set:(H,re,_e)=>H[re]=_e})}get dims(){return this.ort_tensor.dims}set dims(O){this.ort_tensor.dims=O}get type(){return this.ort_tensor.type}get data(){return this.ort_tensor.data}get size(){return this.ort_tensor.size}get location(){return this.ort_tensor.location}dispose(){this.ort_tensor.dispose()}*[Symbol.iterator](){const[O,...H]=this.dims;if(H.length>0){const re=H.reduce((_e,oe)=>_e*oe);for(let _e=0;_e<O;++_e)yield this._subarray(_e,re,H)}else yield*this.data}_getitem(O){const[H,...re]=this.dims;if(O=x(O,H),re.length>0){const _e=re.reduce((oe,pe)=>oe*pe);return this._subarray(O,_e,re)}else return new a(this.type,[this.data[O]],re)}indexOf(O){const H=this.data;for(let re=0;re<H.length;++re)if(H[re]==O)return re;return-1}_subarray(O,H,re){const _e=O*H,oe=(O+1)*H,pe="subarray"in this.data?this.data.subarray(_e,oe):this.data.slice(_e,oe);return new a(this.type,pe,re)}item(){const O=this.data;if(O.length!==1)throw new Error(`a Tensor with ${O.length} elements cannot be converted to Scalar`);return O[0]}tolist(){return l(this.data,this.dims)}sigmoid(){return this.clone().sigmoid_()}sigmoid_(){const O=this.data;for(let H=0;H<O.length;++H)O[H]=1/(1+Math.exp(-O[H]));return this}map(O){return this.clone().map_(O)}map_(O){const H=this.data;for(let re=0;re<H.length;++re)H[re]=O(H[re],re,H);return this}mul(O){return this.clone().mul_(O)}mul_(O){const H=this.data;for(let re=0;re<H.length;++re)H[re]*=O;return this}div(O){return this.clone().div_(O)}div_(O){const H=this.data;for(let re=0;re<H.length;++re)H[re]/=O;return this}add(O){return this.clone().add_(O)}add_(O){const H=this.data;for(let re=0;re<H.length;++re)H[re]+=O;return this}sub(O){return this.clone().sub_(O)}sub_(O){const H=this.data;for(let re=0;re<H.length;++re)H[re]-=O;return this}clone(){return new a(this.type,this.data.slice(),this.dims.slice())}slice(...O){const H=[],re=[];for(let de=0;de<this.dims.length;++de){let q=O[de];if(q==null)re.push([0,this.dims[de]]),H.push(this.dims[de]);else if(typeof q=="number")q=x(q,this.dims[de],de),re.push([q,q+1]);else if(Array.isArray(q)&&q.length===2){let[se,Q]=q;if(se=se===null?0:x(se,this.dims[de],de,!1),Q=Q===null?this.dims[de]:x(Q,this.dims[de],de,!1),se>Q)throw new Error(`Invalid slice: ${q}`);const Me=[Math.max(se,0),Math.min(Q,this.dims[de])];re.push(Me),H.push(Me[1]-Me[0])}else throw new Error(`Invalid slice: ${q}`)}const _e=re.map(([de,q])=>q-de),oe=_e.reduce((de,q)=>de*q),pe=this.data,$e=new pe.constructor(oe),Ne=this.stride();for(let de=0;de<oe;++de){let q=0;for(let se=_e.length-1,Q=de;se>=0;--se){const Me=_e[se];q+=(Q%Me+re[se][0])*Ne[se],Q=Math.floor(Q/Me)}$e[de]=pe[q]}return new a(this.type,$e,H)}permute(...O){return c(this,O)}transpose(...O){return this.permute(...O)}sum(O=null,H=!1){return this.norm(1,O,H)}norm(O="fro",H=null,re=!1){if(O==="fro")O=2;else if(typeof O=="string")throw Error(`Unsupported norm: ${O}`);const _e=this.data,oe=(de,q)=>de+q**O;if(H===null){const de=_e.reduce(oe,0)**(1/O);return new a(this.type,[de],[])}const[pe,$e,Ne]=S(oe,this,H,re);if(O!==1)for(let de=0;de<$e.length;++de)$e[de]=$e[de]**(1/O);return new a(pe,$e,Ne)}normalize_(O=2,H=1){H=x(H,this.dims.length);const re=this.norm(O,H,!0),_e=this.data,oe=re.data;for(let pe=0;pe<_e.length;++pe){let $e=0;for(let Ne=this.dims.length-1,de=pe,q=1;Ne>=0;--Ne){const se=this.dims[Ne];if(Ne!==H){const Q=de%se;$e+=Q*q,q*=this.dims[Ne]}de=Math.floor(de/se)}_e[pe]/=oe[$e]}return this}normalize(O=2,H=1){return this.clone().normalize_(O,H)}stride(){return j(this.dims)}squeeze(O=null){return new a(this.type,this.data,v(this.dims,O))}squeeze_(O=null){return this.dims=v(this.dims,O),this}unsqueeze(O=null){return new a(this.type,this.data,w(this.dims,O))}unsqueeze_(O=null){return this.dims=w(this.dims,O),this}flatten_(O=0,H=-1){H=(H+this.dims.length)%this.dims.length;let re=this.dims.slice(0,O),_e=this.dims.slice(O,H+1),oe=this.dims.slice(H+1);return this.dims=[...re,_e.reduce((pe,$e)=>pe*$e,1),...oe],this}flatten(O=0,H=-1){return this.clone().flatten_(O,H)}view(...O){let H=-1;for(let _e=0;_e<O.length;++_e)if(O[_e]===-1){if(H!==-1)throw new Error("Only one dimension can be inferred");H=_e}const re=this.data;if(H!==-1){const _e=O.reduce((oe,pe,$e)=>$e!==H?oe*pe:oe,1);O[H]=re.length/_e}return new a(this.type,re,O)}neg_(){const O=this.data;for(let H=0;H<O.length;++H)O[H]=-O[H];return this}neg(){return this.clone().neg_()}gt(O){const H=new Uint8Array(this.data.length),re=this.data;for(let _e=0;_e<re.length;++_e)H[_e]=re[_e]>O?1:0;return new a("bool",H,this.dims)}lt(O){const H=new Uint8Array(this.data.length),re=this.data;for(let _e=0;_e<re.length;++_e)H[_e]=re[_e]<O?1:0;return new a("bool",H,this.dims)}clamp_(O,H){const re=this.data;for(let _e=0;_e<re.length;++_e)re[_e]=Math.min(Math.max(re[_e],O),H);return this}clamp(O,H){return this.clone().clamp_(O,H)}round_(){const O=this.data;for(let H=0;H<O.length;++H)O[H]=Math.round(O[H]);return this}round(){return this.clone().round_()}mean(O=null,H=!1){return $(this,O,H)}min(O=null,H=!1){if(O===null){const pe=(0,n.min)(this.data)[0];return new a(this.type,[pe],[])}const[re,_e,oe]=S((pe,$e)=>Math.min(pe,$e),this,O,H,1/0);return new a(re,_e,oe)}max(O=null,H=!1){if(O===null){const pe=(0,n.max)(this.data)[0];return new a(this.type,[pe],[])}const[re,_e,oe]=S((pe,$e)=>Math.max(pe,$e),this,O,H,-1/0);return new a(re,_e,oe)}argmin(O=null,H=!1){if(O!==null)throw new Error("`dim !== null` not yet implemented.");const re=(0,n.min)(this.data)[1];return new a("int64",[BigInt(re)],[])}argmax(O=null,H=!1){if(O!==null)throw new Error("`dim !== null` not yet implemented.");const re=(0,n.max)(this.data)[1];return new a("int64",[BigInt(re)],[])}to(O){if(this.type===O)return this;if(!o.hasOwnProperty(O))throw new Error(`Unsupported type: ${O}`);let H;const re=["int64","uint64"].includes(this.type),_e=["int64","uint64"].includes(O);return re&&!_e?H=Number:!re&&_e&&(H=BigInt),new a(O,o[O].from(this.data,H),this.dims)}}function l(z,O){const H=z.length,re=O.reduce((oe,pe)=>oe*pe);if(H!==re)throw Error(`cannot reshape array of size ${H} into shape (${O})`);let _e=z;for(let oe=O.length-1;oe>=0;oe--)_e=_e.reduce((pe,$e)=>{let Ne=pe[pe.length-1];return Ne.length<O[oe]?Ne.push($e):pe.push([$e]),pe},[[]]);return _e[0]}function c(z,O){const[H,re]=(0,n.permute_data)(z.data,z.dims,O);return new a(z.type,H,re)}function u(z,[O,H],re="bilinear",_e=!1){const oe=z.dims.at(-3)??1,pe=z.dims.at(-2),$e=z.dims.at(-1);let Ne=(0,n.interpolate_data)(z.data,[oe,pe,$e],[O,H],re,_e);return new a(z.type,Ne,[oe,O,H])}async function d(z,{size:O=null,mode:H="bilinear"}={}){if(z.dims.length!==4)throw new Error("`interpolate_4d` currently only supports 4D input.");if(!O)throw new Error("`interpolate_4d` requires a `size` argument.");let re;if(O.length===2)re=[...z.dims.slice(0,2),...O];else if(O.length===3)re=[z.dims[0],...O];else if(O.length===4)re=O;else throw new Error("`size` must be of length 2, 3, or 4.");let _e;if(H==="nearest")_e=await i.TensorOpRegistry.nearest_interpolate_4d;else if(H==="bilinear")_e=await i.TensorOpRegistry.bilinear_interpolate_4d;else if(H==="bicubic")_e=await i.TensorOpRegistry.bicubic_interpolate_4d;else throw new Error(`Unsupported mode: ${H}`);const oe=new a("int64",new BigInt64Array(re.map(BigInt)),[re.length]);return await _e({x:z,s:oe})}async function h(z,O){return await(await i.TensorOpRegistry.matmul)({a:z,b:O})}async function f(z,O){return await(await i.TensorOpRegistry.rfft)({x:z,a:O})}async function p(z,O){const H=await i.TensorOpRegistry.top_k;return O==null?O=z.dims.at(-1):O=Math.min(O,z.dims.at(-1)),await H({x:z,k:new a("int64",[BigInt(O)],[1])})}const m=z=>new a("int64",z,[z.length]);async function y(z,O,H,re,_e){return await(await i.TensorOpRegistry.slice)({x:z,s:m(O),e:m(H),a:m(re),t:m(_e??new Array(re.length).fill(1))})}function g(z,O){const H=z.data,re=O.data,_e=[z.dims[0],z.dims[2]],oe=new H.constructor(_e[0]*_e[1]),[pe,$e,Ne]=z.dims;let de=0;for(let q=0;q<pe;++q){const se=q*Ne*$e;for(let Q=0;Q<Ne;++Q){let Me=0,Te=0;const ke=q*$e,Pe=se+Q;for(let Le=0;Le<$e;++Le){const We=Number(re[ke+Le]);Te+=We,Me+=H[Pe+Le*Ne]*We}const Fe=Me/Te;oe[de++]=Fe}}return new a(z.type,oe,_e)}function _(z,O,{eps:H=1e-5}={}){if(z.dims.length!==2)throw new Error("`layer_norm` currently only supports 2D input.");const[re,_e]=z.dims;if(O.length!==1&&O[0]!==_e)throw new Error("`normalized_shape` must be a 1D array with shape `[input.dims[1]]`.");const[oe,pe]=k(z,1,0,!0),$e=oe.data,Ne=pe.data,de=z.data,q=new de.constructor(de.length);for(let se=0;se<re;++se){const Q=se*_e;for(let Me=0;Me<_e;++Me){const Te=Q+Me;q[Te]=(de[Te]-Ne[se])/($e[se]+H)}}return new a(z.type,q,z.dims)}function v(z,O){return z=z.slice(),O===null?z=z.filter(H=>H!==1):typeof O=="number"?z[O]===1&&z.splice(O,1):Array.isArray(O)&&(z=z.filter((H,re)=>H!==1||!O.includes(re))),z}function w(z,O){return O=x(O,z.length+1),z=z.slice(),z.splice(O,0,1),z}function x(z,O,H=null,re=!0){if(z<-O||z>=O){if(re)throw new Error(`IndexError: index ${z} is out of bounds for dimension${H===null?"":" "+H} with size ${O}`);return z<-O?0:O}return z<0&&(z=(z%O+O)%O),z}function M(z,O=0){O=x(O,z[0].dims.length);const H=z[0].dims.slice();H[O]=z.reduce((pe,$e)=>pe+$e.dims[O],0);const re=H.reduce((pe,$e)=>pe*$e,1),_e=new z[0].data.constructor(re),oe=z[0].type;if(O===0){let pe=0;for(const $e of z){const Ne=$e.data;_e.set(Ne,pe),pe+=Ne.length}}else{let pe=0;for(let $e=0;$e<z.length;++$e){const{data:Ne,dims:de}=z[$e];for(let q=0;q<Ne.length;++q){let se=0;for(let Q=de.length-1,Me=q,Te=1;Q>=0;--Q){const ke=de[Q];let Pe=Me%ke;Q===O&&(Pe+=pe),se+=Pe*Te,Te*=H[Q],Me=Math.floor(Me/ke)}_e[se]=Ne[q]}pe+=de[O]}}return new a(oe,_e,H)}function T(z,O=0){return M(z.map(H=>H.unsqueeze(O)),O)}function S(z,O,H=null,re=!1,_e=null){const oe=O.data,pe=O.dims;H=x(H,pe.length);const $e=pe.slice();$e[H]=1;const Ne=new oe.constructor(oe.length/pe[H]);_e!==null&&Ne.fill(_e);for(let de=0;de<oe.length;++de){let q=0;for(let se=pe.length-1,Q=de,Me=1;se>=0;--se){const Te=pe[se];if(se!==H){const ke=Q%Te;q+=ke*Me,Me*=$e[se]}Q=Math.floor(Q/Te)}Ne[q]=z(Ne[q],oe[de],de,q)}return re||$e.splice(H,1),[O.type,Ne,$e]}function k(z,O=null,H=1,re=!1){const _e=z.data,oe=z.dims;if(O===null){const Me=_e.reduce((Fe,Le)=>Fe+Le,0)/_e.length,Te=Math.sqrt(_e.reduce((Fe,Le)=>Fe+(Le-Me)**2,0)/(_e.length-H)),ke=new a(z.type,[Me],[]);return[new a(z.type,[Te],[]),ke]}O=x(O,oe.length);const pe=$(z,O,re),$e=pe.data,[Ne,de,q]=S((Q,Me,Te,ke)=>Q+(Me-$e[ke])**2,z,O,re);for(let Q=0;Q<de.length;++Q)de[Q]=Math.sqrt(de[Q]/(oe[O]-H));return[new a(Ne,de,q),pe]}function $(z,O=null,H=!1){const re=z.dims,_e=z.data;if(O===null){const Ne=_e.reduce((de,q)=>de+q,0);return new a(z.type,[Ne/_e.length],[])}O=x(O,re.length);const[oe,pe,$e]=S((Ne,de)=>Ne+de,z,O,H);if(re[O]!==1)for(let Ne=0;Ne<pe.length;++Ne)pe[Ne]/=re[O];return new a(oe,pe,$e)}function j(z){const O=new Array(z.length);for(let H=z.length-1,re=1;H>=0;--H)O[H]=re,re*=z[H];return O}function V(z,O,H,re){const _e=z.reduce((oe,pe)=>oe*pe,1);return new a(H,new re(_e).fill(O),z)}function L(z,O){let H,re;if(typeof O=="number")H="float32",re=Float32Array;else if(typeof O=="bigint")H="int64",re=BigInt64Array;else if(typeof O=="boolean")H="bool",re=Uint8Array;else throw new Error(`Unsupported data type: ${typeof O}`);return V(z,O,H,re)}function X(z,O){return L(z.dims,O)}function K(z){return V(z,1n,"int64",BigInt64Array)}function Y(z){return K(z.dims)}function J(z){return V(z,0n,"int64",BigInt64Array)}function N(z){return J(z.dims)}function ne(z){const O=z.reduce((H,re)=>H*re,1);return new a("float32",Float32Array.from({length:O},()=>Math.random()),z)}function te(z,O){if(z.dims.length!==2)throw new Error("The tensor must have 2 dimensions");if(z.dims.at(-1)%8!==0)throw new Error("The last dimension of the tensor must be a multiple of 8");if(!["binary","ubinary"].includes(O))throw new Error("The precision must be either 'binary' or 'ubinary'");const H=O==="binary",re=H?"int8":"uint8",_e=H?Int8Array:Uint8Array,oe=z.data,pe=new _e(oe.length/8);for(let $e=0;$e<oe.length;++$e){const Ne=oe[$e]>0?1:0,de=Math.floor($e/8),q=$e%8;pe[de]|=Ne<<7-q,H&&q===0&&(pe[de]-=128)}return new a(re,pe,[z.dims[0],z.dims[1]/8])}},"./src/utils/video.js":(t,e,r)=>{r.r(e),r.d(e,{RawVideo:()=>o,RawVideoFrame:()=>i,load_video:()=>a});var n=r("./src/utils/image.js"),s=r("./src/env.js");class i{constructor(c,u){this.image=c,this.timestamp=u}}class o{constructor(c,u){c.length>0&&c[0]instanceof n.RawImage&&(c=c.map((d,h)=>new i(d,(h+1)/(c.length+1)*u))),this.frames=c,this.duration=u}get width(){return this.frames[0].image.width}get height(){return this.frames[0].image.height}get fps(){return this.frames.length/this.duration}}async function a(l,{num_frames:c=null,fps:u=null}={}){if(!s.apis.IS_BROWSER_ENV)throw new Error("`load_video` is currently only supported in browser environments.");if(c==null&&u==null)throw new Error("Either num_frames or fps must be provided.");const d=[],h=document.createElement("video");if(h.crossOrigin="anonymous",h.muted=!0,typeof l=="string")h.src=l;else if(l instanceof Blob)h.src=URL.createObjectURL(l);else if(l instanceof HTMLVideoElement)h.src=l.src;else throw new Error("Invalid URL or video element provided.");if(await new Promise(v=>h.onloadedmetadata=v),h.seekable.start(0)===h.seekable.end(0)){const w=await(await fetch(h.src)).blob();h.src=URL.createObjectURL(w),await new Promise(x=>h.onloadedmetadata=x)}const f=h.duration;let p,m;c!=null?(p=c,m=c===1?0:f/(c-1)):(m=1/u,p=Math.floor(f/m));let y=[];for(let v=0;v<p;++v)y.push(c===1?f/2:v*m);const g=document.createElement("canvas");g.width=h.videoWidth,g.height=h.videoHeight;const _=g.getContext("2d",{willReadFrequently:!0});for(const v of y){h.currentTime=v,await new Promise(T=>{h.onseeked=T}),_.drawImage(h,0,0,g.width,g.height);const w=_.getImageData(0,0,g.width,g.height),x=new n.RawImage(w.data,g.width,g.height,4),M=new i(x,v);d.push(M)}return h.remove(),new o(d,f)}}},zO={};function sr(t){var e=zO[t];if(e!==void 0)return e.exports;var r=zO[t]={exports:{}};return gX[t](r,r.exports,sr),r.exports}(()=>{var t=Object.getPrototypeOf?r=>Object.getPrototypeOf(r):r=>r.__proto__,e;sr.t=function(r,n){if(n&1&&(r=this(r)),n&8||typeof r=="object"&&r&&(n&4&&r.__esModule||n&16&&typeof r.then=="function"))return r;var s=Object.create(null);sr.r(s);var i={};e=e||[null,t({}),t([]),t(t)];for(var o=n&2&&r;typeof o=="object"&&!~e.indexOf(o);o=t(o))Object.getOwnPropertyNames(o).forEach(a=>i[a]=()=>r[a]);return i.default=()=>r,sr.d(s,i),s}})();sr.d=(t,e)=>{for(var r in e)sr.o(e,r)&&!sr.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:e[r]})};sr.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e);sr.r=t=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})};var C={};(()=>{/*!*****************************!*\
  !*** ./src/transformers.js ***!
  \*****************************/sr.r(C),sr.d(C,{ASTFeatureExtractor:()=>d.ASTFeatureExtractor,ASTForAudioClassification:()=>r.ASTForAudioClassification,ASTModel:()=>r.ASTModel,ASTPreTrainedModel:()=>r.ASTPreTrainedModel,AlbertForMaskedLM:()=>r.AlbertForMaskedLM,AlbertForQuestionAnswering:()=>r.AlbertForQuestionAnswering,AlbertForSequenceClassification:()=>r.AlbertForSequenceClassification,AlbertModel:()=>r.AlbertModel,AlbertPreTrainedModel:()=>r.AlbertPreTrainedModel,AlbertTokenizer:()=>n.AlbertTokenizer,AudioClassificationPipeline:()=>e.AudioClassificationPipeline,AutoConfig:()=>s.AutoConfig,AutoFeatureExtractor:()=>h.AutoFeatureExtractor,AutoImageProcessor:()=>m.AutoImageProcessor,AutoModel:()=>r.AutoModel,AutoModelForAudioClassification:()=>r.AutoModelForAudioClassification,AutoModelForAudioFrameClassification:()=>r.AutoModelForAudioFrameClassification,AutoModelForAudioTextToText:()=>r.AutoModelForAudioTextToText,AutoModelForCTC:()=>r.AutoModelForCTC,AutoModelForCausalLM:()=>r.AutoModelForCausalLM,AutoModelForDepthEstimation:()=>r.AutoModelForDepthEstimation,AutoModelForDocumentQuestionAnswering:()=>r.AutoModelForDocumentQuestionAnswering,AutoModelForImageClassification:()=>r.AutoModelForImageClassification,AutoModelForImageFeatureExtraction:()=>r.AutoModelForImageFeatureExtraction,AutoModelForImageMatting:()=>r.AutoModelForImageMatting,AutoModelForImageSegmentation:()=>r.AutoModelForImageSegmentation,AutoModelForImageTextToText:()=>r.AutoModelForImageTextToText,AutoModelForImageToImage:()=>r.AutoModelForImageToImage,AutoModelForMaskGeneration:()=>r.AutoModelForMaskGeneration,AutoModelForMaskedLM:()=>r.AutoModelForMaskedLM,AutoModelForNormalEstimation:()=>r.AutoModelForNormalEstimation,AutoModelForObjectDetection:()=>r.AutoModelForObjectDetection,AutoModelForPoseEstimation:()=>r.AutoModelForPoseEstimation,AutoModelForQuestionAnswering:()=>r.AutoModelForQuestionAnswering,AutoModelForSemanticSegmentation:()=>r.AutoModelForSemanticSegmentation,AutoModelForSeq2SeqLM:()=>r.AutoModelForSeq2SeqLM,AutoModelForSequenceClassification:()=>r.AutoModelForSequenceClassification,AutoModelForSpeechSeq2Seq:()=>r.AutoModelForSpeechSeq2Seq,AutoModelForTextToSpectrogram:()=>r.AutoModelForTextToSpectrogram,AutoModelForTextToWaveform:()=>r.AutoModelForTextToWaveform,AutoModelForTokenClassification:()=>r.AutoModelForTokenClassification,AutoModelForUniversalSegmentation:()=>r.AutoModelForUniversalSegmentation,AutoModelForVision2Seq:()=>r.AutoModelForVision2Seq,AutoModelForXVector:()=>r.AutoModelForXVector,AutoModelForZeroShotObjectDetection:()=>r.AutoModelForZeroShotObjectDetection,AutoProcessor:()=>_.AutoProcessor,AutoTokenizer:()=>n.AutoTokenizer,AutomaticSpeechRecognitionPipeline:()=>e.AutomaticSpeechRecognitionPipeline,BackgroundRemovalPipeline:()=>e.BackgroundRemovalPipeline,BartForConditionalGeneration:()=>r.BartForConditionalGeneration,BartForSequenceClassification:()=>r.BartForSequenceClassification,BartModel:()=>r.BartModel,BartPretrainedModel:()=>r.BartPretrainedModel,BartTokenizer:()=>n.BartTokenizer,BaseModelOutput:()=>r.BaseModelOutput,BaseStreamer:()=>v.BaseStreamer,BeitFeatureExtractor:()=>p.BeitFeatureExtractor,BeitForImageClassification:()=>r.BeitForImageClassification,BeitModel:()=>r.BeitModel,BeitPreTrainedModel:()=>r.BeitPreTrainedModel,BertForMaskedLM:()=>r.BertForMaskedLM,BertForQuestionAnswering:()=>r.BertForQuestionAnswering,BertForSequenceClassification:()=>r.BertForSequenceClassification,BertForTokenClassification:()=>r.BertForTokenClassification,BertModel:()=>r.BertModel,BertPreTrainedModel:()=>r.BertPreTrainedModel,BertTokenizer:()=>n.BertTokenizer,BitImageProcessor:()=>p.BitImageProcessor,BlenderbotForConditionalGeneration:()=>r.BlenderbotForConditionalGeneration,BlenderbotModel:()=>r.BlenderbotModel,BlenderbotPreTrainedModel:()=>r.BlenderbotPreTrainedModel,BlenderbotSmallForConditionalGeneration:()=>r.BlenderbotSmallForConditionalGeneration,BlenderbotSmallModel:()=>r.BlenderbotSmallModel,BlenderbotSmallPreTrainedModel:()=>r.BlenderbotSmallPreTrainedModel,BlenderbotSmallTokenizer:()=>n.BlenderbotSmallTokenizer,BlenderbotTokenizer:()=>n.BlenderbotTokenizer,BloomForCausalLM:()=>r.BloomForCausalLM,BloomModel:()=>r.BloomModel,BloomPreTrainedModel:()=>r.BloomPreTrainedModel,BloomTokenizer:()=>n.BloomTokenizer,CLIPFeatureExtractor:()=>p.CLIPFeatureExtractor,CLIPImageProcessor:()=>p.CLIPImageProcessor,CLIPModel:()=>r.CLIPModel,CLIPPreTrainedModel:()=>r.CLIPPreTrainedModel,CLIPSegForImageSegmentation:()=>r.CLIPSegForImageSegmentation,CLIPSegModel:()=>r.CLIPSegModel,CLIPSegPreTrainedModel:()=>r.CLIPSegPreTrainedModel,CLIPTextModel:()=>r.CLIPTextModel,CLIPTextModelWithProjection:()=>r.CLIPTextModelWithProjection,CLIPTokenizer:()=>n.CLIPTokenizer,CLIPVisionModel:()=>r.CLIPVisionModel,CLIPVisionModelWithProjection:()=>r.CLIPVisionModelWithProjection,CamembertForMaskedLM:()=>r.CamembertForMaskedLM,CamembertForQuestionAnswering:()=>r.CamembertForQuestionAnswering,CamembertForSequenceClassification:()=>r.CamembertForSequenceClassification,CamembertForTokenClassification:()=>r.CamembertForTokenClassification,CamembertModel:()=>r.CamembertModel,CamembertPreTrainedModel:()=>r.CamembertPreTrainedModel,CamembertTokenizer:()=>n.CamembertTokenizer,CausalLMOutput:()=>r.CausalLMOutput,CausalLMOutputWithPast:()=>r.CausalLMOutputWithPast,ChineseCLIPFeatureExtractor:()=>p.ChineseCLIPFeatureExtractor,ChineseCLIPModel:()=>r.ChineseCLIPModel,ChineseCLIPPreTrainedModel:()=>r.ChineseCLIPPreTrainedModel,ClapAudioModelWithProjection:()=>r.ClapAudioModelWithProjection,ClapFeatureExtractor:()=>d.ClapFeatureExtractor,ClapModel:()=>r.ClapModel,ClapPreTrainedModel:()=>r.ClapPreTrainedModel,ClapTextModelWithProjection:()=>r.ClapTextModelWithProjection,ClassifierFreeGuidanceLogitsProcessor:()=>x.ClassifierFreeGuidanceLogitsProcessor,CodeGenForCausalLM:()=>r.CodeGenForCausalLM,CodeGenModel:()=>r.CodeGenModel,CodeGenPreTrainedModel:()=>r.CodeGenPreTrainedModel,CodeGenTokenizer:()=>n.CodeGenTokenizer,CodeLlamaTokenizer:()=>n.CodeLlamaTokenizer,CohereForCausalLM:()=>r.CohereForCausalLM,CohereModel:()=>r.CohereModel,CoherePreTrainedModel:()=>r.CoherePreTrainedModel,CohereTokenizer:()=>n.CohereTokenizer,ConvBertForMaskedLM:()=>r.ConvBertForMaskedLM,ConvBertForQuestionAnswering:()=>r.ConvBertForQuestionAnswering,ConvBertForSequenceClassification:()=>r.ConvBertForSequenceClassification,ConvBertForTokenClassification:()=>r.ConvBertForTokenClassification,ConvBertModel:()=>r.ConvBertModel,ConvBertPreTrainedModel:()=>r.ConvBertPreTrainedModel,ConvBertTokenizer:()=>n.ConvBertTokenizer,ConvNextFeatureExtractor:()=>p.ConvNextFeatureExtractor,ConvNextForImageClassification:()=>r.ConvNextForImageClassification,ConvNextImageProcessor:()=>p.ConvNextImageProcessor,ConvNextModel:()=>r.ConvNextModel,ConvNextPreTrainedModel:()=>r.ConvNextPreTrainedModel,ConvNextV2ForImageClassification:()=>r.ConvNextV2ForImageClassification,ConvNextV2Model:()=>r.ConvNextV2Model,ConvNextV2PreTrainedModel:()=>r.ConvNextV2PreTrainedModel,DFineForObjectDetection:()=>r.DFineForObjectDetection,DFineModel:()=>r.DFineModel,DFinePreTrainedModel:()=>r.DFinePreTrainedModel,DPTFeatureExtractor:()=>p.DPTFeatureExtractor,DPTForDepthEstimation:()=>r.DPTForDepthEstimation,DPTImageProcessor:()=>p.DPTImageProcessor,DPTModel:()=>r.DPTModel,DPTPreTrainedModel:()=>r.DPTPreTrainedModel,DacDecoderModel:()=>r.DacDecoderModel,DacDecoderOutput:()=>r.DacDecoderOutput,DacEncoderModel:()=>r.DacEncoderModel,DacEncoderOutput:()=>r.DacEncoderOutput,DacFeatureExtractor:()=>d.DacFeatureExtractor,DacModel:()=>r.DacModel,DacPreTrainedModel:()=>r.DacPreTrainedModel,DataTypeMap:()=>l.DataTypeMap,DebertaForMaskedLM:()=>r.DebertaForMaskedLM,DebertaForQuestionAnswering:()=>r.DebertaForQuestionAnswering,DebertaForSequenceClassification:()=>r.DebertaForSequenceClassification,DebertaForTokenClassification:()=>r.DebertaForTokenClassification,DebertaModel:()=>r.DebertaModel,DebertaPreTrainedModel:()=>r.DebertaPreTrainedModel,DebertaTokenizer:()=>n.DebertaTokenizer,DebertaV2ForMaskedLM:()=>r.DebertaV2ForMaskedLM,DebertaV2ForQuestionAnswering:()=>r.DebertaV2ForQuestionAnswering,DebertaV2ForSequenceClassification:()=>r.DebertaV2ForSequenceClassification,DebertaV2ForTokenClassification:()=>r.DebertaV2ForTokenClassification,DebertaV2Model:()=>r.DebertaV2Model,DebertaV2PreTrainedModel:()=>r.DebertaV2PreTrainedModel,DebertaV2Tokenizer:()=>n.DebertaV2Tokenizer,DecisionTransformerModel:()=>r.DecisionTransformerModel,DecisionTransformerPreTrainedModel:()=>r.DecisionTransformerPreTrainedModel,DeiTFeatureExtractor:()=>p.DeiTFeatureExtractor,DeiTForImageClassification:()=>r.DeiTForImageClassification,DeiTImageProcessor:()=>p.DeiTImageProcessor,DeiTModel:()=>r.DeiTModel,DeiTPreTrainedModel:()=>r.DeiTPreTrainedModel,DepthAnythingForDepthEstimation:()=>r.DepthAnythingForDepthEstimation,DepthAnythingPreTrainedModel:()=>r.DepthAnythingPreTrainedModel,DepthEstimationPipeline:()=>e.DepthEstimationPipeline,DepthProForDepthEstimation:()=>r.DepthProForDepthEstimation,DepthProPreTrainedModel:()=>r.DepthProPreTrainedModel,DetrFeatureExtractor:()=>p.DetrFeatureExtractor,DetrForObjectDetection:()=>r.DetrForObjectDetection,DetrForSegmentation:()=>r.DetrForSegmentation,DetrImageProcessor:()=>p.DetrImageProcessor,DetrModel:()=>r.DetrModel,DetrObjectDetectionOutput:()=>r.DetrObjectDetectionOutput,DetrPreTrainedModel:()=>r.DetrPreTrainedModel,DetrSegmentationOutput:()=>r.DetrSegmentationOutput,Dinov2ForImageClassification:()=>r.Dinov2ForImageClassification,Dinov2Model:()=>r.Dinov2Model,Dinov2PreTrainedModel:()=>r.Dinov2PreTrainedModel,Dinov2WithRegistersForImageClassification:()=>r.Dinov2WithRegistersForImageClassification,Dinov2WithRegistersModel:()=>r.Dinov2WithRegistersModel,Dinov2WithRegistersPreTrainedModel:()=>r.Dinov2WithRegistersPreTrainedModel,DistilBertForMaskedLM:()=>r.DistilBertForMaskedLM,DistilBertForQuestionAnswering:()=>r.DistilBertForQuestionAnswering,DistilBertForSequenceClassification:()=>r.DistilBertForSequenceClassification,DistilBertForTokenClassification:()=>r.DistilBertForTokenClassification,DistilBertModel:()=>r.DistilBertModel,DistilBertPreTrainedModel:()=>r.DistilBertPreTrainedModel,DistilBertTokenizer:()=>n.DistilBertTokenizer,DocumentQuestionAnsweringPipeline:()=>e.DocumentQuestionAnsweringPipeline,DonutFeatureExtractor:()=>p.DonutFeatureExtractor,DonutImageProcessor:()=>p.DonutImageProcessor,DonutSwinModel:()=>r.DonutSwinModel,DonutSwinPreTrainedModel:()=>r.DonutSwinPreTrainedModel,EfficientNetForImageClassification:()=>r.EfficientNetForImageClassification,EfficientNetImageProcessor:()=>p.EfficientNetImageProcessor,EfficientNetModel:()=>r.EfficientNetModel,EfficientNetPreTrainedModel:()=>r.EfficientNetPreTrainedModel,ElectraForMaskedLM:()=>r.ElectraForMaskedLM,ElectraForQuestionAnswering:()=>r.ElectraForQuestionAnswering,ElectraForSequenceClassification:()=>r.ElectraForSequenceClassification,ElectraForTokenClassification:()=>r.ElectraForTokenClassification,ElectraModel:()=>r.ElectraModel,ElectraPreTrainedModel:()=>r.ElectraPreTrainedModel,ElectraTokenizer:()=>n.ElectraTokenizer,EncodecFeatureExtractor:()=>d.EncodecFeatureExtractor,EosTokenCriteria:()=>w.EosTokenCriteria,EsmForMaskedLM:()=>r.EsmForMaskedLM,EsmForSequenceClassification:()=>r.EsmForSequenceClassification,EsmForTokenClassification:()=>r.EsmForTokenClassification,EsmModel:()=>r.EsmModel,EsmPreTrainedModel:()=>r.EsmPreTrainedModel,EsmTokenizer:()=>n.EsmTokenizer,ExaoneForCausalLM:()=>r.ExaoneForCausalLM,ExaoneModel:()=>r.ExaoneModel,ExaonePreTrainedModel:()=>r.ExaonePreTrainedModel,FFT:()=>c.FFT,FalconForCausalLM:()=>r.FalconForCausalLM,FalconModel:()=>r.FalconModel,FalconPreTrainedModel:()=>r.FalconPreTrainedModel,FalconTokenizer:()=>n.FalconTokenizer,FastViTForImageClassification:()=>r.FastViTForImageClassification,FastViTModel:()=>r.FastViTModel,FastViTPreTrainedModel:()=>r.FastViTPreTrainedModel,FeatureExtractionPipeline:()=>e.FeatureExtractionPipeline,FeatureExtractor:()=>u.FeatureExtractor,FillMaskPipeline:()=>e.FillMaskPipeline,Florence2ForConditionalGeneration:()=>r.Florence2ForConditionalGeneration,Florence2PreTrainedModel:()=>r.Florence2PreTrainedModel,Florence2Processor:()=>g.Florence2Processor,ForcedBOSTokenLogitsProcessor:()=>x.ForcedBOSTokenLogitsProcessor,ForcedEOSTokenLogitsProcessor:()=>x.ForcedEOSTokenLogitsProcessor,GLPNFeatureExtractor:()=>p.GLPNFeatureExtractor,GLPNForDepthEstimation:()=>r.GLPNForDepthEstimation,GLPNModel:()=>r.GLPNModel,GLPNPreTrainedModel:()=>r.GLPNPreTrainedModel,GPT2LMHeadModel:()=>r.GPT2LMHeadModel,GPT2Model:()=>r.GPT2Model,GPT2PreTrainedModel:()=>r.GPT2PreTrainedModel,GPT2Tokenizer:()=>n.GPT2Tokenizer,GPTBigCodeForCausalLM:()=>r.GPTBigCodeForCausalLM,GPTBigCodeModel:()=>r.GPTBigCodeModel,GPTBigCodePreTrainedModel:()=>r.GPTBigCodePreTrainedModel,GPTJForCausalLM:()=>r.GPTJForCausalLM,GPTJModel:()=>r.GPTJModel,GPTJPreTrainedModel:()=>r.GPTJPreTrainedModel,GPTNeoForCausalLM:()=>r.GPTNeoForCausalLM,GPTNeoModel:()=>r.GPTNeoModel,GPTNeoPreTrainedModel:()=>r.GPTNeoPreTrainedModel,GPTNeoXForCausalLM:()=>r.GPTNeoXForCausalLM,GPTNeoXModel:()=>r.GPTNeoXModel,GPTNeoXPreTrainedModel:()=>r.GPTNeoXPreTrainedModel,GPTNeoXTokenizer:()=>n.GPTNeoXTokenizer,Gemma2ForCausalLM:()=>r.Gemma2ForCausalLM,Gemma2Model:()=>r.Gemma2Model,Gemma2PreTrainedModel:()=>r.Gemma2PreTrainedModel,Gemma3ForCausalLM:()=>r.Gemma3ForCausalLM,Gemma3Model:()=>r.Gemma3Model,Gemma3PreTrainedModel:()=>r.Gemma3PreTrainedModel,GemmaForCausalLM:()=>r.GemmaForCausalLM,GemmaModel:()=>r.GemmaModel,GemmaPreTrainedModel:()=>r.GemmaPreTrainedModel,GemmaTokenizer:()=>n.GemmaTokenizer,GlmForCausalLM:()=>r.GlmForCausalLM,GlmModel:()=>r.GlmModel,GlmPreTrainedModel:()=>r.GlmPreTrainedModel,GraniteForCausalLM:()=>r.GraniteForCausalLM,GraniteModel:()=>r.GraniteModel,GranitePreTrainedModel:()=>r.GranitePreTrainedModel,Grok1Tokenizer:()=>n.Grok1Tokenizer,GroundingDinoForObjectDetection:()=>r.GroundingDinoForObjectDetection,GroundingDinoImageProcessor:()=>p.GroundingDinoImageProcessor,GroundingDinoPreTrainedModel:()=>r.GroundingDinoPreTrainedModel,GroundingDinoProcessor:()=>g.GroundingDinoProcessor,GroupViTModel:()=>r.GroupViTModel,GroupViTPreTrainedModel:()=>r.GroupViTPreTrainedModel,HeliumForCausalLM:()=>r.HeliumForCausalLM,HeliumModel:()=>r.HeliumModel,HeliumPreTrainedModel:()=>r.HeliumPreTrainedModel,HerbertTokenizer:()=>n.HerbertTokenizer,HieraForImageClassification:()=>r.HieraForImageClassification,HieraModel:()=>r.HieraModel,HieraPreTrainedModel:()=>r.HieraPreTrainedModel,HubertForCTC:()=>r.HubertForCTC,HubertForSequenceClassification:()=>r.HubertForSequenceClassification,HubertModel:()=>r.HubertModel,HubertPreTrainedModel:()=>r.HubertPreTrainedModel,IJepaForImageClassification:()=>r.IJepaForImageClassification,IJepaModel:()=>r.IJepaModel,IJepaPreTrainedModel:()=>r.IJepaPreTrainedModel,Idefics3ForConditionalGeneration:()=>r.Idefics3ForConditionalGeneration,Idefics3ImageProcessor:()=>p.Idefics3ImageProcessor,Idefics3PreTrainedModel:()=>r.Idefics3PreTrainedModel,Idefics3Processor:()=>g.Idefics3Processor,ImageClassificationPipeline:()=>e.ImageClassificationPipeline,ImageFeatureExtractionPipeline:()=>e.ImageFeatureExtractionPipeline,ImageFeatureExtractor:()=>d.ImageFeatureExtractor,ImageMattingOutput:()=>r.ImageMattingOutput,ImageProcessor:()=>f.ImageProcessor,ImageSegmentationPipeline:()=>e.ImageSegmentationPipeline,ImageToImagePipeline:()=>e.ImageToImagePipeline,ImageToTextPipeline:()=>e.ImageToTextPipeline,InterruptableStoppingCriteria:()=>w.InterruptableStoppingCriteria,JAISLMHeadModel:()=>r.JAISLMHeadModel,JAISModel:()=>r.JAISModel,JAISPreTrainedModel:()=>r.JAISPreTrainedModel,JinaCLIPImageProcessor:()=>p.JinaCLIPImageProcessor,JinaCLIPModel:()=>r.JinaCLIPModel,JinaCLIPPreTrainedModel:()=>r.JinaCLIPPreTrainedModel,JinaCLIPProcessor:()=>g.JinaCLIPProcessor,JinaCLIPTextModel:()=>r.JinaCLIPTextModel,JinaCLIPVisionModel:()=>r.JinaCLIPVisionModel,LiteWhisperForConditionalGeneration:()=>r.LiteWhisperForConditionalGeneration,LlamaForCausalLM:()=>r.LlamaForCausalLM,LlamaModel:()=>r.LlamaModel,LlamaPreTrainedModel:()=>r.LlamaPreTrainedModel,LlamaTokenizer:()=>n.LlamaTokenizer,LlavaForConditionalGeneration:()=>r.LlavaForConditionalGeneration,LlavaOnevisionForConditionalGeneration:()=>r.LlavaOnevisionForConditionalGeneration,LlavaOnevisionImageProcessor:()=>p.LlavaOnevisionImageProcessor,LlavaPreTrainedModel:()=>r.LlavaPreTrainedModel,LogitsProcessor:()=>x.LogitsProcessor,LogitsProcessorList:()=>x.LogitsProcessorList,LogitsWarper:()=>x.LogitsWarper,LongT5ForConditionalGeneration:()=>r.LongT5ForConditionalGeneration,LongT5Model:()=>r.LongT5Model,LongT5PreTrainedModel:()=>r.LongT5PreTrainedModel,M2M100ForConditionalGeneration:()=>r.M2M100ForConditionalGeneration,M2M100Model:()=>r.M2M100Model,M2M100PreTrainedModel:()=>r.M2M100PreTrainedModel,M2M100Tokenizer:()=>n.M2M100Tokenizer,MBart50Tokenizer:()=>n.MBart50Tokenizer,MBartForCausalLM:()=>r.MBartForCausalLM,MBartForConditionalGeneration:()=>r.MBartForConditionalGeneration,MBartForSequenceClassification:()=>r.MBartForSequenceClassification,MBartModel:()=>r.MBartModel,MBartPreTrainedModel:()=>r.MBartPreTrainedModel,MBartTokenizer:()=>n.MBartTokenizer,MPNetForMaskedLM:()=>r.MPNetForMaskedLM,MPNetForQuestionAnswering:()=>r.MPNetForQuestionAnswering,MPNetForSequenceClassification:()=>r.MPNetForSequenceClassification,MPNetForTokenClassification:()=>r.MPNetForTokenClassification,MPNetModel:()=>r.MPNetModel,MPNetPreTrainedModel:()=>r.MPNetPreTrainedModel,MPNetTokenizer:()=>n.MPNetTokenizer,MT5ForConditionalGeneration:()=>r.MT5ForConditionalGeneration,MT5Model:()=>r.MT5Model,MT5PreTrainedModel:()=>r.MT5PreTrainedModel,MarianMTModel:()=>r.MarianMTModel,MarianModel:()=>r.MarianModel,MarianPreTrainedModel:()=>r.MarianPreTrainedModel,MarianTokenizer:()=>n.MarianTokenizer,Mask2FormerImageProcessor:()=>p.Mask2FormerImageProcessor,MaskFormerFeatureExtractor:()=>p.MaskFormerFeatureExtractor,MaskFormerForInstanceSegmentation:()=>r.MaskFormerForInstanceSegmentation,MaskFormerImageProcessor:()=>p.MaskFormerImageProcessor,MaskFormerModel:()=>r.MaskFormerModel,MaskFormerPreTrainedModel:()=>r.MaskFormerPreTrainedModel,MaskedLMOutput:()=>r.MaskedLMOutput,MaxLengthCriteria:()=>w.MaxLengthCriteria,Metric3DForDepthEstimation:()=>r.Metric3DForDepthEstimation,Metric3DPreTrainedModel:()=>r.Metric3DPreTrainedModel,Metric3Dv2ForDepthEstimation:()=>r.Metric3Dv2ForDepthEstimation,Metric3Dv2PreTrainedModel:()=>r.Metric3Dv2PreTrainedModel,MgpstrForSceneTextRecognition:()=>r.MgpstrForSceneTextRecognition,MgpstrModelOutput:()=>r.MgpstrModelOutput,MgpstrPreTrainedModel:()=>r.MgpstrPreTrainedModel,MgpstrProcessor:()=>g.MgpstrProcessor,MgpstrTokenizer:()=>n.MgpstrTokenizer,MimiDecoderModel:()=>r.MimiDecoderModel,MimiDecoderOutput:()=>r.MimiDecoderOutput,MimiEncoderModel:()=>r.MimiEncoderModel,MimiEncoderOutput:()=>r.MimiEncoderOutput,MimiModel:()=>r.MimiModel,MimiPreTrainedModel:()=>r.MimiPreTrainedModel,MinLengthLogitsProcessor:()=>x.MinLengthLogitsProcessor,MinNewTokensLengthLogitsProcessor:()=>x.MinNewTokensLengthLogitsProcessor,MistralForCausalLM:()=>r.MistralForCausalLM,MistralModel:()=>r.MistralModel,MistralPreTrainedModel:()=>r.MistralPreTrainedModel,MobileBertForMaskedLM:()=>r.MobileBertForMaskedLM,MobileBertForQuestionAnswering:()=>r.MobileBertForQuestionAnswering,MobileBertForSequenceClassification:()=>r.MobileBertForSequenceClassification,MobileBertModel:()=>r.MobileBertModel,MobileBertPreTrainedModel:()=>r.MobileBertPreTrainedModel,MobileBertTokenizer:()=>n.MobileBertTokenizer,MobileLLMForCausalLM:()=>r.MobileLLMForCausalLM,MobileLLMModel:()=>r.MobileLLMModel,MobileLLMPreTrainedModel:()=>r.MobileLLMPreTrainedModel,MobileNetV1FeatureExtractor:()=>p.MobileNetV1FeatureExtractor,MobileNetV1ForImageClassification:()=>r.MobileNetV1ForImageClassification,MobileNetV1ForSemanticSegmentation:()=>r.MobileNetV1ForSemanticSegmentation,MobileNetV1ImageProcessor:()=>p.MobileNetV1ImageProcessor,MobileNetV1Model:()=>r.MobileNetV1Model,MobileNetV1PreTrainedModel:()=>r.MobileNetV1PreTrainedModel,MobileNetV2FeatureExtractor:()=>p.MobileNetV2FeatureExtractor,MobileNetV2ForImageClassification:()=>r.MobileNetV2ForImageClassification,MobileNetV2ForSemanticSegmentation:()=>r.MobileNetV2ForSemanticSegmentation,MobileNetV2ImageProcessor:()=>p.MobileNetV2ImageProcessor,MobileNetV2Model:()=>r.MobileNetV2Model,MobileNetV2PreTrainedModel:()=>r.MobileNetV2PreTrainedModel,MobileNetV3FeatureExtractor:()=>p.MobileNetV3FeatureExtractor,MobileNetV3ForImageClassification:()=>r.MobileNetV3ForImageClassification,MobileNetV3ForSemanticSegmentation:()=>r.MobileNetV3ForSemanticSegmentation,MobileNetV3ImageProcessor:()=>p.MobileNetV3ImageProcessor,MobileNetV3Model:()=>r.MobileNetV3Model,MobileNetV3PreTrainedModel:()=>r.MobileNetV3PreTrainedModel,MobileNetV4FeatureExtractor:()=>p.MobileNetV4FeatureExtractor,MobileNetV4ForImageClassification:()=>r.MobileNetV4ForImageClassification,MobileNetV4ForSemanticSegmentation:()=>r.MobileNetV4ForSemanticSegmentation,MobileNetV4ImageProcessor:()=>p.MobileNetV4ImageProcessor,MobileNetV4Model:()=>r.MobileNetV4Model,MobileNetV4PreTrainedModel:()=>r.MobileNetV4PreTrainedModel,MobileViTFeatureExtractor:()=>p.MobileViTFeatureExtractor,MobileViTForImageClassification:()=>r.MobileViTForImageClassification,MobileViTImageProcessor:()=>p.MobileViTImageProcessor,MobileViTModel:()=>r.MobileViTModel,MobileViTPreTrainedModel:()=>r.MobileViTPreTrainedModel,MobileViTV2ForImageClassification:()=>r.MobileViTV2ForImageClassification,MobileViTV2Model:()=>r.MobileViTV2Model,MobileViTV2PreTrainedModel:()=>r.MobileViTV2PreTrainedModel,ModelOutput:()=>r.ModelOutput,ModernBertForMaskedLM:()=>r.ModernBertForMaskedLM,ModernBertForSequenceClassification:()=>r.ModernBertForSequenceClassification,ModernBertForTokenClassification:()=>r.ModernBertForTokenClassification,ModernBertModel:()=>r.ModernBertModel,ModernBertPreTrainedModel:()=>r.ModernBertPreTrainedModel,Moondream1ForConditionalGeneration:()=>r.Moondream1ForConditionalGeneration,MoonshineFeatureExtractor:()=>d.MoonshineFeatureExtractor,MoonshineForConditionalGeneration:()=>r.MoonshineForConditionalGeneration,MoonshineModel:()=>r.MoonshineModel,MoonshinePreTrainedModel:()=>r.MoonshinePreTrainedModel,MoonshineProcessor:()=>g.MoonshineProcessor,MptForCausalLM:()=>r.MptForCausalLM,MptModel:()=>r.MptModel,MptPreTrainedModel:()=>r.MptPreTrainedModel,MultiModalityCausalLM:()=>r.MultiModalityCausalLM,MultiModalityPreTrainedModel:()=>r.MultiModalityPreTrainedModel,MusicgenForCausalLM:()=>r.MusicgenForCausalLM,MusicgenForConditionalGeneration:()=>r.MusicgenForConditionalGeneration,MusicgenModel:()=>r.MusicgenModel,MusicgenPreTrainedModel:()=>r.MusicgenPreTrainedModel,NllbTokenizer:()=>n.NllbTokenizer,NoBadWordsLogitsProcessor:()=>x.NoBadWordsLogitsProcessor,NoRepeatNGramLogitsProcessor:()=>x.NoRepeatNGramLogitsProcessor,NomicBertModel:()=>r.NomicBertModel,NomicBertPreTrainedModel:()=>r.NomicBertPreTrainedModel,NougatImageProcessor:()=>p.NougatImageProcessor,NougatTokenizer:()=>n.NougatTokenizer,OPTForCausalLM:()=>r.OPTForCausalLM,OPTModel:()=>r.OPTModel,OPTPreTrainedModel:()=>r.OPTPreTrainedModel,ObjectDetectionPipeline:()=>e.ObjectDetectionPipeline,Olmo2ForCausalLM:()=>r.Olmo2ForCausalLM,Olmo2Model:()=>r.Olmo2Model,Olmo2PreTrainedModel:()=>r.Olmo2PreTrainedModel,OlmoForCausalLM:()=>r.OlmoForCausalLM,OlmoModel:()=>r.OlmoModel,OlmoPreTrainedModel:()=>r.OlmoPreTrainedModel,OpenELMForCausalLM:()=>r.OpenELMForCausalLM,OpenELMModel:()=>r.OpenELMModel,OpenELMPreTrainedModel:()=>r.OpenELMPreTrainedModel,OwlViTFeatureExtractor:()=>p.OwlViTFeatureExtractor,OwlViTForObjectDetection:()=>r.OwlViTForObjectDetection,OwlViTImageProcessor:()=>p.OwlViTImageProcessor,OwlViTModel:()=>r.OwlViTModel,OwlViTPreTrainedModel:()=>r.OwlViTPreTrainedModel,OwlViTProcessor:()=>g.OwlViTProcessor,Owlv2ForObjectDetection:()=>r.Owlv2ForObjectDetection,Owlv2ImageProcessor:()=>p.Owlv2ImageProcessor,Owlv2Model:()=>r.Owlv2Model,Owlv2PreTrainedModel:()=>r.Owlv2PreTrainedModel,PaliGemmaForConditionalGeneration:()=>r.PaliGemmaForConditionalGeneration,PaliGemmaPreTrainedModel:()=>r.PaliGemmaPreTrainedModel,PaliGemmaProcessor:()=>g.PaliGemmaProcessor,PatchTSMixerForPrediction:()=>r.PatchTSMixerForPrediction,PatchTSMixerModel:()=>r.PatchTSMixerModel,PatchTSMixerPreTrainedModel:()=>r.PatchTSMixerPreTrainedModel,PatchTSTForPrediction:()=>r.PatchTSTForPrediction,PatchTSTModel:()=>r.PatchTSTModel,PatchTSTPreTrainedModel:()=>r.PatchTSTPreTrainedModel,Phi3ForCausalLM:()=>r.Phi3ForCausalLM,Phi3Model:()=>r.Phi3Model,Phi3PreTrainedModel:()=>r.Phi3PreTrainedModel,Phi3VForCausalLM:()=>r.Phi3VForCausalLM,Phi3VImageProcessor:()=>p.Phi3VImageProcessor,Phi3VPreTrainedModel:()=>r.Phi3VPreTrainedModel,Phi3VProcessor:()=>g.Phi3VProcessor,PhiForCausalLM:()=>r.PhiForCausalLM,PhiModel:()=>r.PhiModel,PhiPreTrainedModel:()=>r.PhiPreTrainedModel,Pipeline:()=>e.Pipeline,PreTrainedModel:()=>r.PreTrainedModel,PreTrainedTokenizer:()=>n.PreTrainedTokenizer,PretrainedConfig:()=>s.PretrainedConfig,PretrainedMixin:()=>r.PretrainedMixin,Processor:()=>y.Processor,PvtForImageClassification:()=>r.PvtForImageClassification,PvtImageProcessor:()=>p.PvtImageProcessor,PvtModel:()=>r.PvtModel,PvtPreTrainedModel:()=>r.PvtPreTrainedModel,PyAnnoteFeatureExtractor:()=>d.PyAnnoteFeatureExtractor,PyAnnoteForAudioFrameClassification:()=>r.PyAnnoteForAudioFrameClassification,PyAnnoteModel:()=>r.PyAnnoteModel,PyAnnotePreTrainedModel:()=>r.PyAnnotePreTrainedModel,PyAnnoteProcessor:()=>g.PyAnnoteProcessor,QuestionAnsweringModelOutput:()=>r.QuestionAnsweringModelOutput,QuestionAnsweringPipeline:()=>e.QuestionAnsweringPipeline,Qwen2ForCausalLM:()=>r.Qwen2ForCausalLM,Qwen2Model:()=>r.Qwen2Model,Qwen2PreTrainedModel:()=>r.Qwen2PreTrainedModel,Qwen2Tokenizer:()=>n.Qwen2Tokenizer,Qwen2VLForConditionalGeneration:()=>r.Qwen2VLForConditionalGeneration,Qwen2VLImageProcessor:()=>p.Qwen2VLImageProcessor,Qwen2VLPreTrainedModel:()=>r.Qwen2VLPreTrainedModel,Qwen2VLProcessor:()=>g.Qwen2VLProcessor,Qwen3ForCausalLM:()=>r.Qwen3ForCausalLM,Qwen3Model:()=>r.Qwen3Model,Qwen3PreTrainedModel:()=>r.Qwen3PreTrainedModel,RFDetrForObjectDetection:()=>r.RFDetrForObjectDetection,RFDetrModel:()=>r.RFDetrModel,RFDetrObjectDetectionOutput:()=>r.RFDetrObjectDetectionOutput,RFDetrPreTrainedModel:()=>r.RFDetrPreTrainedModel,RTDetrForObjectDetection:()=>r.RTDetrForObjectDetection,RTDetrImageProcessor:()=>p.RTDetrImageProcessor,RTDetrModel:()=>r.RTDetrModel,RTDetrObjectDetectionOutput:()=>r.RTDetrObjectDetectionOutput,RTDetrPreTrainedModel:()=>r.RTDetrPreTrainedModel,RTDetrV2ForObjectDetection:()=>r.RTDetrV2ForObjectDetection,RTDetrV2Model:()=>r.RTDetrV2Model,RTDetrV2ObjectDetectionOutput:()=>r.RTDetrV2ObjectDetectionOutput,RTDetrV2PreTrainedModel:()=>r.RTDetrV2PreTrainedModel,RawAudio:()=>i.RawAudio,RawImage:()=>o.RawImage,RawVideo:()=>a.RawVideo,RawVideoFrame:()=>a.RawVideoFrame,RepetitionPenaltyLogitsProcessor:()=>x.RepetitionPenaltyLogitsProcessor,ResNetForImageClassification:()=>r.ResNetForImageClassification,ResNetModel:()=>r.ResNetModel,ResNetPreTrainedModel:()=>r.ResNetPreTrainedModel,RoFormerForMaskedLM:()=>r.RoFormerForMaskedLM,RoFormerForQuestionAnswering:()=>r.RoFormerForQuestionAnswering,RoFormerForSequenceClassification:()=>r.RoFormerForSequenceClassification,RoFormerForTokenClassification:()=>r.RoFormerForTokenClassification,RoFormerModel:()=>r.RoFormerModel,RoFormerPreTrainedModel:()=>r.RoFormerPreTrainedModel,RoFormerTokenizer:()=>n.RoFormerTokenizer,RobertaForMaskedLM:()=>r.RobertaForMaskedLM,RobertaForQuestionAnswering:()=>r.RobertaForQuestionAnswering,RobertaForSequenceClassification:()=>r.RobertaForSequenceClassification,RobertaForTokenClassification:()=>r.RobertaForTokenClassification,RobertaModel:()=>r.RobertaModel,RobertaPreTrainedModel:()=>r.RobertaPreTrainedModel,RobertaTokenizer:()=>n.RobertaTokenizer,SamImageProcessor:()=>p.SamImageProcessor,SamImageSegmentationOutput:()=>r.SamImageSegmentationOutput,SamModel:()=>r.SamModel,SamPreTrainedModel:()=>r.SamPreTrainedModel,SamProcessor:()=>g.SamProcessor,SapiensForDepthEstimation:()=>r.SapiensForDepthEstimation,SapiensForNormalEstimation:()=>r.SapiensForNormalEstimation,SapiensForSemanticSegmentation:()=>r.SapiensForSemanticSegmentation,SapiensPreTrainedModel:()=>r.SapiensPreTrainedModel,SeamlessM4TFeatureExtractor:()=>d.SeamlessM4TFeatureExtractor,SegformerFeatureExtractor:()=>p.SegformerFeatureExtractor,SegformerForImageClassification:()=>r.SegformerForImageClassification,SegformerForSemanticSegmentation:()=>r.SegformerForSemanticSegmentation,SegformerImageProcessor:()=>p.SegformerImageProcessor,SegformerModel:()=>r.SegformerModel,SegformerPreTrainedModel:()=>r.SegformerPreTrainedModel,Seq2SeqLMOutput:()=>r.Seq2SeqLMOutput,SequenceClassifierOutput:()=>r.SequenceClassifierOutput,SiglipImageProcessor:()=>p.SiglipImageProcessor,SiglipModel:()=>r.SiglipModel,SiglipPreTrainedModel:()=>r.SiglipPreTrainedModel,SiglipTextModel:()=>r.SiglipTextModel,SiglipTokenizer:()=>n.SiglipTokenizer,SiglipVisionModel:()=>r.SiglipVisionModel,SmolVLMForConditionalGeneration:()=>r.SmolVLMForConditionalGeneration,SmolVLMImageProcessor:()=>p.SmolVLMImageProcessor,SmolVLMProcessor:()=>g.SmolVLMProcessor,SnacDecoderModel:()=>r.SnacDecoderModel,SnacEncoderModel:()=>r.SnacEncoderModel,SnacFeatureExtractor:()=>d.SnacFeatureExtractor,SnacModel:()=>r.SnacModel,SnacPreTrainedModel:()=>r.SnacPreTrainedModel,SpeechT5FeatureExtractor:()=>d.SpeechT5FeatureExtractor,SpeechT5ForSpeechToText:()=>r.SpeechT5ForSpeechToText,SpeechT5ForTextToSpeech:()=>r.SpeechT5ForTextToSpeech,SpeechT5HifiGan:()=>r.SpeechT5HifiGan,SpeechT5Model:()=>r.SpeechT5Model,SpeechT5PreTrainedModel:()=>r.SpeechT5PreTrainedModel,SpeechT5Processor:()=>g.SpeechT5Processor,SpeechT5Tokenizer:()=>n.SpeechT5Tokenizer,SqueezeBertForMaskedLM:()=>r.SqueezeBertForMaskedLM,SqueezeBertForQuestionAnswering:()=>r.SqueezeBertForQuestionAnswering,SqueezeBertForSequenceClassification:()=>r.SqueezeBertForSequenceClassification,SqueezeBertModel:()=>r.SqueezeBertModel,SqueezeBertPreTrainedModel:()=>r.SqueezeBertPreTrainedModel,SqueezeBertTokenizer:()=>n.SqueezeBertTokenizer,StableLmForCausalLM:()=>r.StableLmForCausalLM,StableLmModel:()=>r.StableLmModel,StableLmPreTrainedModel:()=>r.StableLmPreTrainedModel,Starcoder2ForCausalLM:()=>r.Starcoder2ForCausalLM,Starcoder2Model:()=>r.Starcoder2Model,Starcoder2PreTrainedModel:()=>r.Starcoder2PreTrainedModel,StoppingCriteria:()=>w.StoppingCriteria,StoppingCriteriaList:()=>w.StoppingCriteriaList,StyleTextToSpeech2Model:()=>r.StyleTextToSpeech2Model,StyleTextToSpeech2PreTrainedModel:()=>r.StyleTextToSpeech2PreTrainedModel,SummarizationPipeline:()=>e.SummarizationPipeline,SuppressTokensAtBeginLogitsProcessor:()=>x.SuppressTokensAtBeginLogitsProcessor,Swin2SRForImageSuperResolution:()=>r.Swin2SRForImageSuperResolution,Swin2SRImageProcessor:()=>p.Swin2SRImageProcessor,Swin2SRModel:()=>r.Swin2SRModel,Swin2SRPreTrainedModel:()=>r.Swin2SRPreTrainedModel,SwinForImageClassification:()=>r.SwinForImageClassification,SwinForSemanticSegmentation:()=>r.SwinForSemanticSegmentation,SwinModel:()=>r.SwinModel,SwinPreTrainedModel:()=>r.SwinPreTrainedModel,T5ForConditionalGeneration:()=>r.T5ForConditionalGeneration,T5Model:()=>r.T5Model,T5PreTrainedModel:()=>r.T5PreTrainedModel,T5Tokenizer:()=>n.T5Tokenizer,TableTransformerForObjectDetection:()=>r.TableTransformerForObjectDetection,TableTransformerModel:()=>r.TableTransformerModel,TableTransformerObjectDetectionOutput:()=>r.TableTransformerObjectDetectionOutput,TableTransformerPreTrainedModel:()=>r.TableTransformerPreTrainedModel,TemperatureLogitsWarper:()=>x.TemperatureLogitsWarper,Tensor:()=>l.Tensor,Text2TextGenerationPipeline:()=>e.Text2TextGenerationPipeline,TextClassificationPipeline:()=>e.TextClassificationPipeline,TextGenerationPipeline:()=>e.TextGenerationPipeline,TextStreamer:()=>v.TextStreamer,TextToAudioPipeline:()=>e.TextToAudioPipeline,TokenClassificationPipeline:()=>e.TokenClassificationPipeline,TokenClassifierOutput:()=>r.TokenClassifierOutput,TokenizerModel:()=>n.TokenizerModel,TopKLogitsWarper:()=>x.TopKLogitsWarper,TopPLogitsWarper:()=>x.TopPLogitsWarper,TrOCRForCausalLM:()=>r.TrOCRForCausalLM,TrOCRPreTrainedModel:()=>r.TrOCRPreTrainedModel,TranslationPipeline:()=>e.TranslationPipeline,UltravoxModel:()=>r.UltravoxModel,UltravoxPreTrainedModel:()=>r.UltravoxPreTrainedModel,UltravoxProcessor:()=>g.UltravoxProcessor,UniSpeechForCTC:()=>r.UniSpeechForCTC,UniSpeechForSequenceClassification:()=>r.UniSpeechForSequenceClassification,UniSpeechModel:()=>r.UniSpeechModel,UniSpeechPreTrainedModel:()=>r.UniSpeechPreTrainedModel,UniSpeechSatForAudioFrameClassification:()=>r.UniSpeechSatForAudioFrameClassification,UniSpeechSatForCTC:()=>r.UniSpeechSatForCTC,UniSpeechSatForSequenceClassification:()=>r.UniSpeechSatForSequenceClassification,UniSpeechSatModel:()=>r.UniSpeechSatModel,UniSpeechSatPreTrainedModel:()=>r.UniSpeechSatPreTrainedModel,VLChatProcessor:()=>g.VLChatProcessor,VLMImageProcessor:()=>p.VLMImageProcessor,ViTFeatureExtractor:()=>p.ViTFeatureExtractor,ViTForImageClassification:()=>r.ViTForImageClassification,ViTImageProcessor:()=>p.ViTImageProcessor,ViTMAEModel:()=>r.ViTMAEModel,ViTMAEPreTrainedModel:()=>r.ViTMAEPreTrainedModel,ViTMSNForImageClassification:()=>r.ViTMSNForImageClassification,ViTMSNModel:()=>r.ViTMSNModel,ViTMSNPreTrainedModel:()=>r.ViTMSNPreTrainedModel,ViTModel:()=>r.ViTModel,ViTPreTrainedModel:()=>r.ViTPreTrainedModel,VisionEncoderDecoderModel:()=>r.VisionEncoderDecoderModel,VitMatteForImageMatting:()=>r.VitMatteForImageMatting,VitMatteImageProcessor:()=>p.VitMatteImageProcessor,VitMattePreTrainedModel:()=>r.VitMattePreTrainedModel,VitPoseForPoseEstimation:()=>r.VitPoseForPoseEstimation,VitPoseImageProcessor:()=>p.VitPoseImageProcessor,VitPosePreTrainedModel:()=>r.VitPosePreTrainedModel,VitsModel:()=>r.VitsModel,VitsModelOutput:()=>r.VitsModelOutput,VitsPreTrainedModel:()=>r.VitsPreTrainedModel,VitsTokenizer:()=>n.VitsTokenizer,Wav2Vec2BertForCTC:()=>r.Wav2Vec2BertForCTC,Wav2Vec2BertForSequenceClassification:()=>r.Wav2Vec2BertForSequenceClassification,Wav2Vec2BertModel:()=>r.Wav2Vec2BertModel,Wav2Vec2BertPreTrainedModel:()=>r.Wav2Vec2BertPreTrainedModel,Wav2Vec2CTCTokenizer:()=>n.Wav2Vec2CTCTokenizer,Wav2Vec2FeatureExtractor:()=>d.Wav2Vec2FeatureExtractor,Wav2Vec2ForAudioFrameClassification:()=>r.Wav2Vec2ForAudioFrameClassification,Wav2Vec2ForCTC:()=>r.Wav2Vec2ForCTC,Wav2Vec2ForSequenceClassification:()=>r.Wav2Vec2ForSequenceClassification,Wav2Vec2Model:()=>r.Wav2Vec2Model,Wav2Vec2PreTrainedModel:()=>r.Wav2Vec2PreTrainedModel,Wav2Vec2Processor:()=>g.Wav2Vec2Processor,Wav2Vec2ProcessorWithLM:()=>g.Wav2Vec2ProcessorWithLM,WavLMForAudioFrameClassification:()=>r.WavLMForAudioFrameClassification,WavLMForCTC:()=>r.WavLMForCTC,WavLMForSequenceClassification:()=>r.WavLMForSequenceClassification,WavLMForXVector:()=>r.WavLMForXVector,WavLMModel:()=>r.WavLMModel,WavLMPreTrainedModel:()=>r.WavLMPreTrainedModel,WeSpeakerFeatureExtractor:()=>d.WeSpeakerFeatureExtractor,WeSpeakerResNetModel:()=>r.WeSpeakerResNetModel,WeSpeakerResNetPreTrainedModel:()=>r.WeSpeakerResNetPreTrainedModel,WhisperFeatureExtractor:()=>d.WhisperFeatureExtractor,WhisperForConditionalGeneration:()=>r.WhisperForConditionalGeneration,WhisperModel:()=>r.WhisperModel,WhisperPreTrainedModel:()=>r.WhisperPreTrainedModel,WhisperProcessor:()=>g.WhisperProcessor,WhisperTextStreamer:()=>v.WhisperTextStreamer,WhisperTimeStampLogitsProcessor:()=>x.WhisperTimeStampLogitsProcessor,WhisperTokenizer:()=>n.WhisperTokenizer,XLMForQuestionAnswering:()=>r.XLMForQuestionAnswering,XLMForSequenceClassification:()=>r.XLMForSequenceClassification,XLMForTokenClassification:()=>r.XLMForTokenClassification,XLMModel:()=>r.XLMModel,XLMPreTrainedModel:()=>r.XLMPreTrainedModel,XLMRobertaForMaskedLM:()=>r.XLMRobertaForMaskedLM,XLMRobertaForQuestionAnswering:()=>r.XLMRobertaForQuestionAnswering,XLMRobertaForSequenceClassification:()=>r.XLMRobertaForSequenceClassification,XLMRobertaForTokenClassification:()=>r.XLMRobertaForTokenClassification,XLMRobertaModel:()=>r.XLMRobertaModel,XLMRobertaPreTrainedModel:()=>r.XLMRobertaPreTrainedModel,XLMRobertaTokenizer:()=>n.XLMRobertaTokenizer,XLMTokenizer:()=>n.XLMTokenizer,XLMWithLMHeadModel:()=>r.XLMWithLMHeadModel,XVectorOutput:()=>r.XVectorOutput,YolosFeatureExtractor:()=>p.YolosFeatureExtractor,YolosForObjectDetection:()=>r.YolosForObjectDetection,YolosImageProcessor:()=>p.YolosImageProcessor,YolosModel:()=>r.YolosModel,YolosObjectDetectionOutput:()=>r.YolosObjectDetectionOutput,YolosPreTrainedModel:()=>r.YolosPreTrainedModel,ZeroShotAudioClassificationPipeline:()=>e.ZeroShotAudioClassificationPipeline,ZeroShotClassificationPipeline:()=>e.ZeroShotClassificationPipeline,ZeroShotImageClassificationPipeline:()=>e.ZeroShotImageClassificationPipeline,ZeroShotObjectDetectionPipeline:()=>e.ZeroShotObjectDetectionPipeline,bankers_round:()=>c.bankers_round,cat:()=>l.cat,cos_sim:()=>c.cos_sim,dot:()=>c.dot,dynamic_time_warping:()=>c.dynamic_time_warping,env:()=>t.env,full:()=>l.full,full_like:()=>l.full_like,getKeyValueShapes:()=>s.getKeyValueShapes,hamming:()=>i.hamming,hanning:()=>i.hanning,interpolate:()=>l.interpolate,interpolate_4d:()=>l.interpolate_4d,interpolate_data:()=>c.interpolate_data,is_chinese_char:()=>n.is_chinese_char,layer_norm:()=>l.layer_norm,load_image:()=>o.load_image,load_video:()=>a.load_video,log_softmax:()=>c.log_softmax,magnitude:()=>c.magnitude,matmul:()=>l.matmul,max:()=>c.max,mean:()=>l.mean,mean_pooling:()=>l.mean_pooling,medianFilter:()=>c.medianFilter,mel_filter_bank:()=>i.mel_filter_bank,min:()=>c.min,ones:()=>l.ones,ones_like:()=>l.ones_like,permute:()=>l.permute,permute_data:()=>c.permute_data,pipeline:()=>e.pipeline,quantize_embeddings:()=>l.quantize_embeddings,rand:()=>l.rand,read_audio:()=>i.read_audio,rfft:()=>l.rfft,round:()=>c.round,slice:()=>l.slice,softmax:()=>c.softmax,spectrogram:()=>i.spectrogram,stack:()=>l.stack,std_mean:()=>l.std_mean,topk:()=>l.topk,window_function:()=>i.window_function,zeros:()=>l.zeros,zeros_like:()=>l.zeros_like});var t=sr("./src/env.js"),e=sr("./src/pipelines.js"),r=sr("./src/models.js"),n=sr("./src/tokenizers.js"),s=sr("./src/configs.js"),i=sr("./src/utils/audio.js"),o=sr("./src/utils/image.js"),a=sr("./src/utils/video.js"),l=sr("./src/utils/tensor.js"),c=sr("./src/utils/maths.js"),u=sr("./src/base/feature_extraction_utils.js"),d=sr("./src/models/feature_extractors.js"),h=sr("./src/models/auto/feature_extraction_auto.js"),f=sr("./src/base/image_processors_utils.js"),p=sr("./src/models/image_processors.js"),m=sr("./src/models/auto/image_processing_auto.js"),y=sr("./src/base/processing_utils.js"),g=sr("./src/models/processors.js"),_=sr("./src/models/auto/processing_auto.js"),v=sr("./src/generation/streamers.js"),w=sr("./src/generation/stopping_criteria.js"),x=sr("./src/generation/logits_process.js")})();C.ASTFeatureExtractor;C.ASTForAudioClassification;C.ASTModel;C.ASTPreTrainedModel;C.AlbertForMaskedLM;C.AlbertForQuestionAnswering;C.AlbertForSequenceClassification;C.AlbertModel;C.AlbertPreTrainedModel;C.AlbertTokenizer;C.AudioClassificationPipeline;C.AutoConfig;C.AutoFeatureExtractor;C.AutoImageProcessor;C.AutoModel;C.AutoModelForAudioClassification;C.AutoModelForAudioFrameClassification;C.AutoModelForAudioTextToText;C.AutoModelForCTC;C.AutoModelForCausalLM;C.AutoModelForDepthEstimation;C.AutoModelForDocumentQuestionAnswering;C.AutoModelForImageClassification;C.AutoModelForImageFeatureExtraction;C.AutoModelForImageMatting;C.AutoModelForImageSegmentation;C.AutoModelForImageTextToText;C.AutoModelForImageToImage;C.AutoModelForMaskGeneration;C.AutoModelForMaskedLM;C.AutoModelForNormalEstimation;C.AutoModelForObjectDetection;C.AutoModelForPoseEstimation;C.AutoModelForQuestionAnswering;C.AutoModelForSemanticSegmentation;C.AutoModelForSeq2SeqLM;C.AutoModelForSequenceClassification;C.AutoModelForSpeechSeq2Seq;C.AutoModelForTextToSpectrogram;C.AutoModelForTextToWaveform;C.AutoModelForTokenClassification;C.AutoModelForUniversalSegmentation;C.AutoModelForVision2Seq;C.AutoModelForXVector;C.AutoModelForZeroShotObjectDetection;C.AutoProcessor;C.AutoTokenizer;C.AutomaticSpeechRecognitionPipeline;C.BackgroundRemovalPipeline;C.BartForConditionalGeneration;C.BartForSequenceClassification;C.BartModel;C.BartPretrainedModel;C.BartTokenizer;C.BaseModelOutput;C.BaseStreamer;C.BeitFeatureExtractor;C.BeitForImageClassification;C.BeitModel;C.BeitPreTrainedModel;C.BertForMaskedLM;C.BertForQuestionAnswering;C.BertForSequenceClassification;C.BertForTokenClassification;C.BertModel;C.BertPreTrainedModel;C.BertTokenizer;C.BitImageProcessor;C.BlenderbotForConditionalGeneration;C.BlenderbotModel;C.BlenderbotPreTrainedModel;C.BlenderbotSmallForConditionalGeneration;C.BlenderbotSmallModel;C.BlenderbotSmallPreTrainedModel;C.BlenderbotSmallTokenizer;C.BlenderbotTokenizer;C.BloomForCausalLM;C.BloomModel;C.BloomPreTrainedModel;C.BloomTokenizer;C.CLIPFeatureExtractor;C.CLIPImageProcessor;C.CLIPModel;C.CLIPPreTrainedModel;C.CLIPSegForImageSegmentation;C.CLIPSegModel;C.CLIPSegPreTrainedModel;C.CLIPTextModel;C.CLIPTextModelWithProjection;C.CLIPTokenizer;C.CLIPVisionModel;C.CLIPVisionModelWithProjection;C.CamembertForMaskedLM;C.CamembertForQuestionAnswering;C.CamembertForSequenceClassification;C.CamembertForTokenClassification;C.CamembertModel;C.CamembertPreTrainedModel;C.CamembertTokenizer;C.CausalLMOutput;C.CausalLMOutputWithPast;C.ChineseCLIPFeatureExtractor;C.ChineseCLIPModel;C.ChineseCLIPPreTrainedModel;C.ClapAudioModelWithProjection;C.ClapFeatureExtractor;C.ClapModel;C.ClapPreTrainedModel;C.ClapTextModelWithProjection;C.ClassifierFreeGuidanceLogitsProcessor;C.CodeGenForCausalLM;C.CodeGenModel;C.CodeGenPreTrainedModel;C.CodeGenTokenizer;C.CodeLlamaTokenizer;C.CohereForCausalLM;C.CohereModel;C.CoherePreTrainedModel;C.CohereTokenizer;C.ConvBertForMaskedLM;C.ConvBertForQuestionAnswering;C.ConvBertForSequenceClassification;C.ConvBertForTokenClassification;C.ConvBertModel;C.ConvBertPreTrainedModel;C.ConvBertTokenizer;C.ConvNextFeatureExtractor;C.ConvNextForImageClassification;C.ConvNextImageProcessor;C.ConvNextModel;C.ConvNextPreTrainedModel;C.ConvNextV2ForImageClassification;C.ConvNextV2Model;C.ConvNextV2PreTrainedModel;C.DFineForObjectDetection;C.DFineModel;C.DFinePreTrainedModel;C.DPTFeatureExtractor;C.DPTForDepthEstimation;C.DPTImageProcessor;C.DPTModel;C.DPTPreTrainedModel;C.DacDecoderModel;C.DacDecoderOutput;C.DacEncoderModel;C.DacEncoderOutput;C.DacFeatureExtractor;C.DacModel;C.DacPreTrainedModel;C.DataTypeMap;C.DebertaForMaskedLM;C.DebertaForQuestionAnswering;C.DebertaForSequenceClassification;C.DebertaForTokenClassification;C.DebertaModel;C.DebertaPreTrainedModel;C.DebertaTokenizer;C.DebertaV2ForMaskedLM;C.DebertaV2ForQuestionAnswering;C.DebertaV2ForSequenceClassification;C.DebertaV2ForTokenClassification;C.DebertaV2Model;C.DebertaV2PreTrainedModel;C.DebertaV2Tokenizer;C.DecisionTransformerModel;C.DecisionTransformerPreTrainedModel;C.DeiTFeatureExtractor;C.DeiTForImageClassification;C.DeiTImageProcessor;C.DeiTModel;C.DeiTPreTrainedModel;C.DepthAnythingForDepthEstimation;C.DepthAnythingPreTrainedModel;C.DepthEstimationPipeline;C.DepthProForDepthEstimation;C.DepthProPreTrainedModel;C.DetrFeatureExtractor;C.DetrForObjectDetection;C.DetrForSegmentation;C.DetrImageProcessor;C.DetrModel;C.DetrObjectDetectionOutput;C.DetrPreTrainedModel;C.DetrSegmentationOutput;C.Dinov2ForImageClassification;C.Dinov2Model;C.Dinov2PreTrainedModel;C.Dinov2WithRegistersForImageClassification;C.Dinov2WithRegistersModel;C.Dinov2WithRegistersPreTrainedModel;C.DistilBertForMaskedLM;C.DistilBertForQuestionAnswering;C.DistilBertForSequenceClassification;C.DistilBertForTokenClassification;C.DistilBertModel;C.DistilBertPreTrainedModel;C.DistilBertTokenizer;C.DocumentQuestionAnsweringPipeline;C.DonutFeatureExtractor;C.DonutImageProcessor;C.DonutSwinModel;C.DonutSwinPreTrainedModel;C.EfficientNetForImageClassification;C.EfficientNetImageProcessor;C.EfficientNetModel;C.EfficientNetPreTrainedModel;C.ElectraForMaskedLM;C.ElectraForQuestionAnswering;C.ElectraForSequenceClassification;C.ElectraForTokenClassification;C.ElectraModel;C.ElectraPreTrainedModel;C.ElectraTokenizer;C.EncodecFeatureExtractor;C.EosTokenCriteria;C.EsmForMaskedLM;C.EsmForSequenceClassification;C.EsmForTokenClassification;C.EsmModel;C.EsmPreTrainedModel;C.EsmTokenizer;C.ExaoneForCausalLM;C.ExaoneModel;C.ExaonePreTrainedModel;C.FFT;C.FalconForCausalLM;C.FalconModel;C.FalconPreTrainedModel;C.FalconTokenizer;C.FastViTForImageClassification;C.FastViTModel;C.FastViTPreTrainedModel;C.FeatureExtractionPipeline;C.FeatureExtractor;C.FillMaskPipeline;C.Florence2ForConditionalGeneration;C.Florence2PreTrainedModel;C.Florence2Processor;C.ForcedBOSTokenLogitsProcessor;C.ForcedEOSTokenLogitsProcessor;C.GLPNFeatureExtractor;C.GLPNForDepthEstimation;C.GLPNModel;C.GLPNPreTrainedModel;C.GPT2LMHeadModel;C.GPT2Model;C.GPT2PreTrainedModel;C.GPT2Tokenizer;C.GPTBigCodeForCausalLM;C.GPTBigCodeModel;C.GPTBigCodePreTrainedModel;C.GPTJForCausalLM;C.GPTJModel;C.GPTJPreTrainedModel;C.GPTNeoForCausalLM;C.GPTNeoModel;C.GPTNeoPreTrainedModel;C.GPTNeoXForCausalLM;C.GPTNeoXModel;C.GPTNeoXPreTrainedModel;C.GPTNeoXTokenizer;C.Gemma2ForCausalLM;C.Gemma2Model;C.Gemma2PreTrainedModel;C.Gemma3ForCausalLM;C.Gemma3Model;C.Gemma3PreTrainedModel;C.GemmaForCausalLM;C.GemmaModel;C.GemmaPreTrainedModel;C.GemmaTokenizer;C.GlmForCausalLM;C.GlmModel;C.GlmPreTrainedModel;C.GraniteForCausalLM;C.GraniteModel;C.GranitePreTrainedModel;C.Grok1Tokenizer;C.GroundingDinoForObjectDetection;C.GroundingDinoImageProcessor;C.GroundingDinoPreTrainedModel;C.GroundingDinoProcessor;C.GroupViTModel;C.GroupViTPreTrainedModel;C.HeliumForCausalLM;C.HeliumModel;C.HeliumPreTrainedModel;C.HerbertTokenizer;C.HieraForImageClassification;C.HieraModel;C.HieraPreTrainedModel;C.HubertForCTC;C.HubertForSequenceClassification;C.HubertModel;C.HubertPreTrainedModel;C.IJepaForImageClassification;C.IJepaModel;C.IJepaPreTrainedModel;C.Idefics3ForConditionalGeneration;C.Idefics3ImageProcessor;C.Idefics3PreTrainedModel;C.Idefics3Processor;C.ImageClassificationPipeline;C.ImageFeatureExtractionPipeline;C.ImageFeatureExtractor;C.ImageMattingOutput;C.ImageProcessor;C.ImageSegmentationPipeline;C.ImageToImagePipeline;C.ImageToTextPipeline;C.InterruptableStoppingCriteria;C.JAISLMHeadModel;C.JAISModel;C.JAISPreTrainedModel;C.JinaCLIPImageProcessor;C.JinaCLIPModel;C.JinaCLIPPreTrainedModel;C.JinaCLIPProcessor;C.JinaCLIPTextModel;C.JinaCLIPVisionModel;C.LiteWhisperForConditionalGeneration;C.LlamaForCausalLM;C.LlamaModel;C.LlamaPreTrainedModel;C.LlamaTokenizer;C.LlavaForConditionalGeneration;C.LlavaOnevisionForConditionalGeneration;C.LlavaOnevisionImageProcessor;C.LlavaPreTrainedModel;C.LogitsProcessor;C.LogitsProcessorList;C.LogitsWarper;C.LongT5ForConditionalGeneration;C.LongT5Model;C.LongT5PreTrainedModel;C.M2M100ForConditionalGeneration;C.M2M100Model;C.M2M100PreTrainedModel;C.M2M100Tokenizer;C.MBart50Tokenizer;C.MBartForCausalLM;C.MBartForConditionalGeneration;C.MBartForSequenceClassification;C.MBartModel;C.MBartPreTrainedModel;C.MBartTokenizer;C.MPNetForMaskedLM;C.MPNetForQuestionAnswering;C.MPNetForSequenceClassification;C.MPNetForTokenClassification;C.MPNetModel;C.MPNetPreTrainedModel;C.MPNetTokenizer;C.MT5ForConditionalGeneration;C.MT5Model;C.MT5PreTrainedModel;C.MarianMTModel;C.MarianModel;C.MarianPreTrainedModel;C.MarianTokenizer;C.Mask2FormerImageProcessor;C.MaskFormerFeatureExtractor;C.MaskFormerForInstanceSegmentation;C.MaskFormerImageProcessor;C.MaskFormerModel;C.MaskFormerPreTrainedModel;C.MaskedLMOutput;C.MaxLengthCriteria;C.Metric3DForDepthEstimation;C.Metric3DPreTrainedModel;C.Metric3Dv2ForDepthEstimation;C.Metric3Dv2PreTrainedModel;C.MgpstrForSceneTextRecognition;C.MgpstrModelOutput;C.MgpstrPreTrainedModel;C.MgpstrProcessor;C.MgpstrTokenizer;C.MimiDecoderModel;C.MimiDecoderOutput;C.MimiEncoderModel;C.MimiEncoderOutput;C.MimiModel;C.MimiPreTrainedModel;C.MinLengthLogitsProcessor;C.MinNewTokensLengthLogitsProcessor;C.MistralForCausalLM;C.MistralModel;C.MistralPreTrainedModel;C.MobileBertForMaskedLM;C.MobileBertForQuestionAnswering;C.MobileBertForSequenceClassification;C.MobileBertModel;C.MobileBertPreTrainedModel;C.MobileBertTokenizer;C.MobileLLMForCausalLM;C.MobileLLMModel;C.MobileLLMPreTrainedModel;C.MobileNetV1FeatureExtractor;C.MobileNetV1ForImageClassification;C.MobileNetV1ForSemanticSegmentation;C.MobileNetV1ImageProcessor;C.MobileNetV1Model;C.MobileNetV1PreTrainedModel;C.MobileNetV2FeatureExtractor;C.MobileNetV2ForImageClassification;C.MobileNetV2ForSemanticSegmentation;C.MobileNetV2ImageProcessor;C.MobileNetV2Model;C.MobileNetV2PreTrainedModel;C.MobileNetV3FeatureExtractor;C.MobileNetV3ForImageClassification;C.MobileNetV3ForSemanticSegmentation;C.MobileNetV3ImageProcessor;C.MobileNetV3Model;C.MobileNetV3PreTrainedModel;C.MobileNetV4FeatureExtractor;C.MobileNetV4ForImageClassification;C.MobileNetV4ForSemanticSegmentation;C.MobileNetV4ImageProcessor;C.MobileNetV4Model;C.MobileNetV4PreTrainedModel;C.MobileViTFeatureExtractor;C.MobileViTForImageClassification;C.MobileViTImageProcessor;C.MobileViTModel;C.MobileViTPreTrainedModel;C.MobileViTV2ForImageClassification;C.MobileViTV2Model;C.MobileViTV2PreTrainedModel;C.ModelOutput;C.ModernBertForMaskedLM;C.ModernBertForSequenceClassification;C.ModernBertForTokenClassification;C.ModernBertModel;C.ModernBertPreTrainedModel;C.Moondream1ForConditionalGeneration;C.MoonshineFeatureExtractor;C.MoonshineForConditionalGeneration;C.MoonshineModel;C.MoonshinePreTrainedModel;C.MoonshineProcessor;C.MptForCausalLM;C.MptModel;C.MptPreTrainedModel;C.MultiModalityCausalLM;C.MultiModalityPreTrainedModel;C.MusicgenForCausalLM;C.MusicgenForConditionalGeneration;C.MusicgenModel;C.MusicgenPreTrainedModel;C.NllbTokenizer;C.NoBadWordsLogitsProcessor;C.NoRepeatNGramLogitsProcessor;C.NomicBertModel;C.NomicBertPreTrainedModel;C.NougatImageProcessor;C.NougatTokenizer;C.OPTForCausalLM;C.OPTModel;C.OPTPreTrainedModel;C.ObjectDetectionPipeline;C.Olmo2ForCausalLM;C.Olmo2Model;C.Olmo2PreTrainedModel;C.OlmoForCausalLM;C.OlmoModel;C.OlmoPreTrainedModel;C.OpenELMForCausalLM;C.OpenELMModel;C.OpenELMPreTrainedModel;C.OwlViTFeatureExtractor;C.OwlViTForObjectDetection;C.OwlViTImageProcessor;C.OwlViTModel;C.OwlViTPreTrainedModel;C.OwlViTProcessor;C.Owlv2ForObjectDetection;C.Owlv2ImageProcessor;C.Owlv2Model;C.Owlv2PreTrainedModel;C.PaliGemmaForConditionalGeneration;C.PaliGemmaPreTrainedModel;C.PaliGemmaProcessor;C.PatchTSMixerForPrediction;C.PatchTSMixerModel;C.PatchTSMixerPreTrainedModel;C.PatchTSTForPrediction;C.PatchTSTModel;C.PatchTSTPreTrainedModel;C.Phi3ForCausalLM;C.Phi3Model;C.Phi3PreTrainedModel;C.Phi3VForCausalLM;C.Phi3VImageProcessor;C.Phi3VPreTrainedModel;C.Phi3VProcessor;C.PhiForCausalLM;C.PhiModel;C.PhiPreTrainedModel;C.Pipeline;C.PreTrainedModel;C.PreTrainedTokenizer;C.PretrainedConfig;C.PretrainedMixin;C.Processor;C.PvtForImageClassification;C.PvtImageProcessor;C.PvtModel;C.PvtPreTrainedModel;C.PyAnnoteFeatureExtractor;C.PyAnnoteForAudioFrameClassification;C.PyAnnoteModel;C.PyAnnotePreTrainedModel;C.PyAnnoteProcessor;C.QuestionAnsweringModelOutput;C.QuestionAnsweringPipeline;C.Qwen2ForCausalLM;C.Qwen2Model;C.Qwen2PreTrainedModel;C.Qwen2Tokenizer;C.Qwen2VLForConditionalGeneration;C.Qwen2VLImageProcessor;C.Qwen2VLPreTrainedModel;C.Qwen2VLProcessor;C.Qwen3ForCausalLM;C.Qwen3Model;C.Qwen3PreTrainedModel;C.RFDetrForObjectDetection;C.RFDetrModel;C.RFDetrObjectDetectionOutput;C.RFDetrPreTrainedModel;C.RTDetrForObjectDetection;C.RTDetrImageProcessor;C.RTDetrModel;C.RTDetrObjectDetectionOutput;C.RTDetrPreTrainedModel;C.RTDetrV2ForObjectDetection;C.RTDetrV2Model;C.RTDetrV2ObjectDetectionOutput;C.RTDetrV2PreTrainedModel;C.RawAudio;C.RawImage;C.RawVideo;C.RawVideoFrame;C.RepetitionPenaltyLogitsProcessor;C.ResNetForImageClassification;C.ResNetModel;C.ResNetPreTrainedModel;C.RoFormerForMaskedLM;C.RoFormerForQuestionAnswering;C.RoFormerForSequenceClassification;C.RoFormerForTokenClassification;C.RoFormerModel;C.RoFormerPreTrainedModel;C.RoFormerTokenizer;C.RobertaForMaskedLM;C.RobertaForQuestionAnswering;C.RobertaForSequenceClassification;C.RobertaForTokenClassification;C.RobertaModel;C.RobertaPreTrainedModel;C.RobertaTokenizer;C.SamImageProcessor;C.SamImageSegmentationOutput;C.SamModel;C.SamPreTrainedModel;C.SamProcessor;C.SapiensForDepthEstimation;C.SapiensForNormalEstimation;C.SapiensForSemanticSegmentation;C.SapiensPreTrainedModel;C.SeamlessM4TFeatureExtractor;C.SegformerFeatureExtractor;C.SegformerForImageClassification;C.SegformerForSemanticSegmentation;C.SegformerImageProcessor;C.SegformerModel;C.SegformerPreTrainedModel;C.Seq2SeqLMOutput;C.SequenceClassifierOutput;C.SiglipImageProcessor;C.SiglipModel;C.SiglipPreTrainedModel;C.SiglipTextModel;C.SiglipTokenizer;C.SiglipVisionModel;C.SmolVLMForConditionalGeneration;C.SmolVLMImageProcessor;C.SmolVLMProcessor;C.SnacDecoderModel;C.SnacEncoderModel;C.SnacFeatureExtractor;C.SnacModel;C.SnacPreTrainedModel;C.SpeechT5FeatureExtractor;C.SpeechT5ForSpeechToText;C.SpeechT5ForTextToSpeech;C.SpeechT5HifiGan;C.SpeechT5Model;C.SpeechT5PreTrainedModel;C.SpeechT5Processor;C.SpeechT5Tokenizer;C.SqueezeBertForMaskedLM;C.SqueezeBertForQuestionAnswering;C.SqueezeBertForSequenceClassification;C.SqueezeBertModel;C.SqueezeBertPreTrainedModel;C.SqueezeBertTokenizer;C.StableLmForCausalLM;C.StableLmModel;C.StableLmPreTrainedModel;C.Starcoder2ForCausalLM;C.Starcoder2Model;C.Starcoder2PreTrainedModel;C.StoppingCriteria;C.StoppingCriteriaList;C.StyleTextToSpeech2Model;C.StyleTextToSpeech2PreTrainedModel;C.SummarizationPipeline;C.SuppressTokensAtBeginLogitsProcessor;C.Swin2SRForImageSuperResolution;C.Swin2SRImageProcessor;C.Swin2SRModel;C.Swin2SRPreTrainedModel;C.SwinForImageClassification;C.SwinForSemanticSegmentation;C.SwinModel;C.SwinPreTrainedModel;C.T5ForConditionalGeneration;C.T5Model;C.T5PreTrainedModel;C.T5Tokenizer;C.TableTransformerForObjectDetection;C.TableTransformerModel;C.TableTransformerObjectDetectionOutput;C.TableTransformerPreTrainedModel;C.TemperatureLogitsWarper;C.Tensor;C.Text2TextGenerationPipeline;C.TextClassificationPipeline;C.TextGenerationPipeline;C.TextStreamer;C.TextToAudioPipeline;C.TokenClassificationPipeline;C.TokenClassifierOutput;C.TokenizerModel;C.TopKLogitsWarper;C.TopPLogitsWarper;C.TrOCRForCausalLM;C.TrOCRPreTrainedModel;C.TranslationPipeline;C.UltravoxModel;C.UltravoxPreTrainedModel;C.UltravoxProcessor;C.UniSpeechForCTC;C.UniSpeechForSequenceClassification;C.UniSpeechModel;C.UniSpeechPreTrainedModel;C.UniSpeechSatForAudioFrameClassification;C.UniSpeechSatForCTC;C.UniSpeechSatForSequenceClassification;C.UniSpeechSatModel;C.UniSpeechSatPreTrainedModel;C.VLChatProcessor;C.VLMImageProcessor;C.ViTFeatureExtractor;C.ViTForImageClassification;C.ViTImageProcessor;C.ViTMAEModel;C.ViTMAEPreTrainedModel;C.ViTMSNForImageClassification;C.ViTMSNModel;C.ViTMSNPreTrainedModel;C.ViTModel;C.ViTPreTrainedModel;C.VisionEncoderDecoderModel;C.VitMatteForImageMatting;C.VitMatteImageProcessor;C.VitMattePreTrainedModel;C.VitPoseForPoseEstimation;C.VitPoseImageProcessor;C.VitPosePreTrainedModel;C.VitsModel;C.VitsModelOutput;C.VitsPreTrainedModel;C.VitsTokenizer;C.Wav2Vec2BertForCTC;C.Wav2Vec2BertForSequenceClassification;C.Wav2Vec2BertModel;C.Wav2Vec2BertPreTrainedModel;C.Wav2Vec2CTCTokenizer;C.Wav2Vec2FeatureExtractor;C.Wav2Vec2ForAudioFrameClassification;C.Wav2Vec2ForCTC;C.Wav2Vec2ForSequenceClassification;C.Wav2Vec2Model;C.Wav2Vec2PreTrainedModel;C.Wav2Vec2Processor;C.Wav2Vec2ProcessorWithLM;C.WavLMForAudioFrameClassification;C.WavLMForCTC;C.WavLMForSequenceClassification;C.WavLMForXVector;C.WavLMModel;C.WavLMPreTrainedModel;C.WeSpeakerFeatureExtractor;C.WeSpeakerResNetModel;C.WeSpeakerResNetPreTrainedModel;C.WhisperFeatureExtractor;C.WhisperForConditionalGeneration;C.WhisperModel;C.WhisperPreTrainedModel;C.WhisperProcessor;C.WhisperTextStreamer;C.WhisperTimeStampLogitsProcessor;C.WhisperTokenizer;C.XLMForQuestionAnswering;C.XLMForSequenceClassification;C.XLMForTokenClassification;C.XLMModel;C.XLMPreTrainedModel;C.XLMRobertaForMaskedLM;C.XLMRobertaForQuestionAnswering;C.XLMRobertaForSequenceClassification;C.XLMRobertaForTokenClassification;C.XLMRobertaModel;C.XLMRobertaPreTrainedModel;C.XLMRobertaTokenizer;C.XLMTokenizer;C.XLMWithLMHeadModel;C.XVectorOutput;C.YolosFeatureExtractor;C.YolosForObjectDetection;C.YolosImageProcessor;C.YolosModel;C.YolosObjectDetectionOutput;C.YolosPreTrainedModel;C.ZeroShotAudioClassificationPipeline;C.ZeroShotClassificationPipeline;C.ZeroShotImageClassificationPipeline;C.ZeroShotObjectDetectionPipeline;C.bankers_round;C.cat;C.cos_sim;C.dot;C.dynamic_time_warping;var Az=C.env;C.full;C.full_like;C.getKeyValueShapes;C.hamming;C.hanning;C.interpolate;C.interpolate_4d;C.interpolate_data;C.is_chinese_char;C.layer_norm;C.load_image;C.load_video;C.log_softmax;C.magnitude;C.matmul;C.max;C.mean;C.mean_pooling;C.medianFilter;C.mel_filter_bank;C.min;C.ones;C.ones_like;C.permute;C.permute_data;var BO=C.pipeline;C.quantize_embeddings;C.rand;C.read_audio;C.rfft;C.round;C.slice;C.softmax;C.spectrogram;C.stack;C.std_mean;C.topk;C.window_function;C.zeros;C.zeros_like;Az.allowLocalModels=!1;Az.useBrowserCache=!0;const _X=({image:t,onCaptionGenerated:e,isGenerating:r,setIsGenerating:n})=>{const[s,i]=D.useState(""),[o,a]=D.useState(""),[l,c]=D.useState(!1),u=async()=>{if(t){n(!0);try{console.log("Loading image captioning model...");const p=await BO("image-to-text","Xenova/vit-gpt2-image-captioning",{device:"webgpu"});console.log("Model loaded, generating caption...");const m=URL.createObjectURL(t),y=await p(m);console.log("Caption generated:",y);let g="";if(Array.isArray(y)&&y.length>0){const w=y[0];if(typeof w=="object"&&w!==null){const x=w;g=x.generated_text||x.text||""}}else if(y&&typeof y=="object"){const w=y;g=w.generated_text||w.text||""}const _=g.replace(/^(a |an |the )/i,"").split(".")[0].trim(),v=_.charAt(0).toUpperCase()+_.slice(1);i(v),e(v),URL.revokeObjectURL(m)}catch(p){console.error("Error generating caption:",p);const m="A beautiful moment captured in time";i(m),e(m)}finally{n(!1)}}},d=async()=>{if(t){n(!0);try{console.log("LLM caption generation with prompt:",o);const p=await BO("image-to-text","Xenova/vit-gpt2-image-captioning",{device:"webgpu"}),m=URL.createObjectURL(t),y=await p(m);let g="";if(Array.isArray(y)&&y.length>0){const w=y[0];if(typeof w=="object"&&w!==null){const x=w;g=x.generated_text||x.text||""}}else if(y&&typeof y=="object"){const w=y;g=w.generated_text||w.text||""}o.trim()&&(g=`${o}: ${g}`);const _=g.replace(/^(a |an |the )/i,"").split(".")[0].trim(),v=_.charAt(0).toUpperCase()+_.slice(1);i(v),e(v),URL.revokeObjectURL(m)}catch(p){console.error("Error generating LLM caption:",p);const m=o.trim()?`${o}: A beautiful moment captured in time`:"A beautiful moment captured in time";i(m),e(m)}finally{n(!1)}}},h=p=>{const m=p.target.value;i(m),e(m)},f=()=>{l&&o.trim()?d():u()};return G.jsx(__,{className:"p-6",children:G.jsxs("div",{className:"space-y-4",children:[G.jsxs("div",{className:"flex items-center justify-between",children:[G.jsxs("h2",{className:"text-xl font-semibold flex items-center gap-2",children:[G.jsx(k2,{className:"w-5 h-5 text-purple-500"}),"AI Caption"]}),G.jsxs(oo,{onClick:f,disabled:!t||r,size:"sm",variant:"outline",className:"gap-2",children:[r?G.jsx(P2,{className:"w-4 h-4 animate-spin"}):G.jsx(k2,{className:"w-4 h-4"}),r?"Generating...":"Generate Caption"]})]}),G.jsxs("div",{className:"space-y-3",children:[G.jsxs("div",{className:"flex items-center gap-2",children:[G.jsx("input",{type:"checkbox",id:"use-custom-prompt",checked:l,onChange:p=>c(p.target.checked),className:"rounded border-gray-300"}),G.jsxs(nx,{htmlFor:"use-custom-prompt",className:"text-sm font-medium flex items-center gap-2",children:[G.jsx(CG,{className:"w-4 h-4"}),"Use custom prompt (LLM mode)"]})]}),l&&G.jsxs("div",{className:"space-y-2",children:[G.jsx(nx,{htmlFor:"custom-prompt",className:"text-sm font-medium",children:"Custom Prompt:"}),G.jsx(BR,{id:"custom-prompt",value:o,onChange:p=>a(p.target.value),placeholder:"e.g., 'Write a funny caption for this photo' or 'Describe this image in a poetic way'",className:"text-sm",disabled:r}),G.jsx("p",{className:"text-xs text-gray-500",children:"This will be used to guide the LLM in generating a more specific caption."})]})]}),G.jsx(zR,{value:s,onChange:h,placeholder:"Click 'Generate Caption' to create an AI caption, or write your own...",className:"min-h-24 resize-none",disabled:r}),r&&G.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600",children:[G.jsx(P2,{className:"w-4 h-4 animate-spin"}),G.jsx("span",{children:l&&o.trim()?"LLM is analyzing your photo with your custom prompt...":"AI is analyzing your photo and generating a caption..."})]}),G.jsx("p",{className:"text-sm text-gray-500",children:l?"Use a custom prompt to guide the LLM in generating more specific captions.":"You can edit the generated caption or write your own before placing it on the photo."})]})})};function fe(t,e,r){return(e=function(n){var s=function(i,o){if(typeof i!="object"||!i)return i;var a=i[Symbol.toPrimitive];if(a!==void 0){var l=a.call(i,o||"default");if(typeof l!="object")return l;throw new TypeError("@@toPrimitive must return a primitive value.")}return(o==="string"?String:Number)(i)}(n,"string");return typeof s=="symbol"?s:s+""}(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function VO(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(s){return Object.getOwnPropertyDescriptor(t,s).enumerable})),r.push.apply(r,n)}return r}function ge(t){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?VO(Object(r),!0).forEach(function(n){fe(t,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):VO(Object(r)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(r,n))})}return t}function Lr(t,e){if(t==null)return{};var r,n,s=function(o,a){if(o==null)return{};var l={};for(var c in o)if({}.hasOwnProperty.call(o,c)){if(a.indexOf(c)>=0)continue;l[c]=o[c]}return l}(t,e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);for(n=0;n<i.length;n++)r=i[n],e.indexOf(r)>=0||{}.propertyIsEnumerable.call(t,r)&&(s[r]=t[r])}return s}function go(t,e){return e||(e=t.slice(0)),Object.freeze(Object.defineProperties(t,{raw:{value:Object.freeze(e)}}))}class WO{constructor(){fe(this,"browserShadowBlurConstant",1),fe(this,"DPI",96),fe(this,"devicePixelRatio",typeof window<"u"?window.devicePixelRatio:1),fe(this,"perfLimitSizeTotal",2097152),fe(this,"maxCacheSideLimit",4096),fe(this,"minCacheSideLimit",256),fe(this,"disableStyleCopyPaste",!1),fe(this,"enableGLFiltering",!0),fe(this,"textureSize",4096),fe(this,"forceGLPutImageData",!1),fe(this,"cachesBoundsOfCurve",!1),fe(this,"fontPaths",{}),fe(this,"NUM_FRACTION_DIGITS",4)}}const dr=new class extends WO{constructor(t){super(),this.configure(t)}configure(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};Object.assign(this,t)}addFonts(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this.fontPaths=ge(ge({},this.fontPaths),t)}removeFonts(){(arguments.length>0&&arguments[0]!==void 0?arguments[0]:[]).forEach(t=>{delete this.fontPaths[t]})}clearFonts(){this.fontPaths={}}restoreDefaults(t){const e=new WO,r=(t==null?void 0:t.reduce((n,s)=>(n[s]=e[s],n),{}))||e;this.configure(r)}},Va=function(t){for(var e=arguments.length,r=new Array(e>1?e-1:0),n=1;n<e;n++)r[n-1]=arguments[n];return console[t]("fabric",...r)};class co extends Error{constructor(e,r){super("fabric: ".concat(e),r)}}class yX extends co{constructor(e){super("".concat(e," 'options.signal' is in 'aborted' state"))}}class vX{}class wX extends vX{testPrecision(e,r){const n="precision ".concat(r,` float;
void main(){}`),s=e.createShader(e.FRAGMENT_SHADER);return!!s&&(e.shaderSource(s,n),e.compileShader(s),!!e.getShaderParameter(s,e.COMPILE_STATUS))}queryWebGL(e){const r=e.getContext("webgl");r&&(this.maxTextureSize=r.getParameter(r.MAX_TEXTURE_SIZE),this.GLPrecision=["highp","mediump","lowp"].find(n=>this.testPrecision(r,n)),r.getExtension("WEBGL_lose_context").loseContext(),Va("log","WebGL: max texture size ".concat(this.maxTextureSize)))}isSupported(e){return!!this.maxTextureSize&&this.maxTextureSize>=e}}const xX={};let UO;const po=()=>UO||(UO={document,window,isTouchSupported:"ontouchstart"in window||"ontouchstart"in document||window&&window.navigator&&window.navigator.maxTouchPoints>0,WebGLProbe:new wX,dispose(){},copyPasteData:xX}),zu=()=>po().document,y_=()=>po().window,$z=()=>{var t;return Math.max((t=dr.devicePixelRatio)!==null&&t!==void 0?t:y_().devicePixelRatio,1)},ph=new class{constructor(){fe(this,"charWidthsCache",{}),fe(this,"boundsOfCurveCache",{})}getFontCache(t){let{fontFamily:e,fontStyle:r,fontWeight:n}=t;e=e.toLowerCase(),this.charWidthsCache[e]||(this.charWidthsCache[e]={});const s=this.charWidthsCache[e],i="".concat(r.toLowerCase(),"_").concat((n+"").toLowerCase());return s[i]||(s[i]={}),s[i]}clearFontCache(t){(t=(t||"").toLowerCase())?this.charWidthsCache[t]&&delete this.charWidthsCache[t]:this.charWidthsCache={}}limitDimsByArea(t){const{perfLimitSizeTotal:e}=dr,r=Math.sqrt(e*t);return[Math.floor(r),Math.floor(e/r)]}},bx="6.6.7";function Lm(){}const af=Math.PI/2,Eg=2*Math.PI,Bb=Math.PI/180,rs=Object.freeze([1,0,0,1,0,0]),Vb=16,da=.4477152502,Wt="center",pr="left",ms="top",Mx="bottom",tn="right",gs="none",Wb=/\r?\n/,Oz="moving",v_="scaling",Dz="rotating",Ub="rotate",Iz="skewing",Wh="resizing",bX="modifyPoly",MX="modifyPath",Pg="changed",w_="scale",vs="scaleX",oi="scaleY",Bu="skewX",Vu="skewY",xn="fill",_s="stroke",kg="modified",Tc="json",Pv="svg",ht=new class{constructor(){this[Tc]=new Map,this[Pv]=new Map}has(t){return this[Tc].has(t)}getClass(t){const e=this[Tc].get(t);if(!e)throw new co("No class registered for ".concat(t));return e}setClass(t,e){e?this[Tc].set(e,t):(this[Tc].set(t.type,t),this[Tc].set(t.type.toLowerCase(),t))}getSVGClass(t){return this[Pv].get(t)}setSVGClass(t,e){this[Pv].set(e??t.type.toLowerCase(),t)}},Ag=new class extends Array{remove(t){const e=this.indexOf(t);e>-1&&this.splice(e,1)}cancelAll(){const t=this.splice(0);return t.forEach(e=>e.abort()),t}cancelByCanvas(t){if(!t)return[];const e=this.filter(r=>{var n;return r.target===t||typeof r.target=="object"&&((n=r.target)===null||n===void 0?void 0:n.canvas)===t});return e.forEach(r=>r.abort()),e}cancelByTarget(t){if(!t)return[];const e=this.filter(r=>r.target===t);return e.forEach(r=>r.abort()),e}};class TX{constructor(){fe(this,"__eventListeners",{})}on(e,r){if(this.__eventListeners||(this.__eventListeners={}),typeof e=="object")return Object.entries(e).forEach(n=>{let[s,i]=n;this.on(s,i)}),()=>this.off(e);if(r){const n=e;return this.__eventListeners[n]||(this.__eventListeners[n]=[]),this.__eventListeners[n].push(r),()=>this.off(n,r)}return()=>!1}once(e,r){if(typeof e=="object"){const n=[];return Object.entries(e).forEach(s=>{let[i,o]=s;n.push(this.once(i,o))}),()=>n.forEach(s=>s())}if(r){const n=this.on(e,function(){for(var s=arguments.length,i=new Array(s),o=0;o<s;o++)i[o]=arguments[o];r.call(this,...i),n()});return n}return()=>!1}_removeEventListener(e,r){if(this.__eventListeners[e])if(r){const n=this.__eventListeners[e],s=n.indexOf(r);s>-1&&n.splice(s,1)}else this.__eventListeners[e]=[]}off(e,r){if(this.__eventListeners)if(e===void 0)for(const n in this.__eventListeners)this._removeEventListener(n);else typeof e=="object"?Object.entries(e).forEach(n=>{let[s,i]=n;this._removeEventListener(s,i)}):this._removeEventListener(e,r)}fire(e,r){var n;if(!this.__eventListeners)return;const s=(n=this.__eventListeners[e])===null||n===void 0?void 0:n.concat();if(s)for(let i=0;i<s.length;i++)s[i].call(this,r||{})}}const $c=(t,e)=>{const r=t.indexOf(e);return r!==-1&&t.splice(r,1),t},Bo=t=>{if(t===0)return 1;switch(Math.abs(t)/af){case 1:case 3:return 0;case 2:return-1}return Math.cos(t)},Vo=t=>{if(t===0)return 0;const e=t/af,r=Math.sign(t);switch(e){case 1:return r;case 2:return 0;case 3:return-r}return Math.sin(t)};class Ce{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;typeof e=="object"?(this.x=e.x,this.y=e.y):(this.x=e,this.y=r)}add(e){return new Ce(this.x+e.x,this.y+e.y)}addEquals(e){return this.x+=e.x,this.y+=e.y,this}scalarAdd(e){return new Ce(this.x+e,this.y+e)}scalarAddEquals(e){return this.x+=e,this.y+=e,this}subtract(e){return new Ce(this.x-e.x,this.y-e.y)}subtractEquals(e){return this.x-=e.x,this.y-=e.y,this}scalarSubtract(e){return new Ce(this.x-e,this.y-e)}scalarSubtractEquals(e){return this.x-=e,this.y-=e,this}multiply(e){return new Ce(this.x*e.x,this.y*e.y)}scalarMultiply(e){return new Ce(this.x*e,this.y*e)}scalarMultiplyEquals(e){return this.x*=e,this.y*=e,this}divide(e){return new Ce(this.x/e.x,this.y/e.y)}scalarDivide(e){return new Ce(this.x/e,this.y/e)}scalarDivideEquals(e){return this.x/=e,this.y/=e,this}eq(e){return this.x===e.x&&this.y===e.y}lt(e){return this.x<e.x&&this.y<e.y}lte(e){return this.x<=e.x&&this.y<=e.y}gt(e){return this.x>e.x&&this.y>e.y}gte(e){return this.x>=e.x&&this.y>=e.y}lerp(e){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:.5;return r=Math.max(Math.min(1,r),0),new Ce(this.x+(e.x-this.x)*r,this.y+(e.y-this.y)*r)}distanceFrom(e){const r=this.x-e.x,n=this.y-e.y;return Math.sqrt(r*r+n*n)}midPointFrom(e){return this.lerp(e)}min(e){return new Ce(Math.min(this.x,e.x),Math.min(this.y,e.y))}max(e){return new Ce(Math.max(this.x,e.x),Math.max(this.y,e.y))}toString(){return"".concat(this.x,",").concat(this.y)}setXY(e,r){return this.x=e,this.y=r,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setFromPoint(e){return this.x=e.x,this.y=e.y,this}swap(e){const r=this.x,n=this.y;this.x=e.x,this.y=e.y,e.x=r,e.y=n}clone(){return new Ce(this.x,this.y)}rotate(e){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Gb;const n=Vo(e),s=Bo(e),i=this.subtract(r);return new Ce(i.x*s-i.y*n,i.x*n+i.y*s).add(r)}transform(e){let r=arguments.length>1&&arguments[1]!==void 0&&arguments[1];return new Ce(e[0]*this.x+e[2]*this.y+(r?0:e[4]),e[1]*this.x+e[3]*this.y+(r?0:e[5]))}}const Gb=new Ce(0,0),Rm=t=>!!t&&Array.isArray(t._objects);function Fz(t){class e extends t{constructor(){super(...arguments),fe(this,"_objects",[])}_onObjectAdded(n){}_onObjectRemoved(n){}_onStackOrderChanged(n){}add(){for(var n=arguments.length,s=new Array(n),i=0;i<n;i++)s[i]=arguments[i];const o=this._objects.push(...s);return s.forEach(a=>this._onObjectAdded(a)),o}insertAt(n){for(var s=arguments.length,i=new Array(s>1?s-1:0),o=1;o<s;o++)i[o-1]=arguments[o];return this._objects.splice(n,0,...i),i.forEach(a=>this._onObjectAdded(a)),this._objects.length}remove(){const n=this._objects,s=[];for(var i=arguments.length,o=new Array(i),a=0;a<i;a++)o[a]=arguments[a];return o.forEach(l=>{const c=n.indexOf(l);c!==-1&&(n.splice(c,1),s.push(l),this._onObjectRemoved(l))}),s}forEachObject(n){this.getObjects().forEach((s,i,o)=>n(s,i,o))}getObjects(){for(var n=arguments.length,s=new Array(n),i=0;i<n;i++)s[i]=arguments[i];return s.length===0?[...this._objects]:this._objects.filter(o=>o.isType(...s))}item(n){return this._objects[n]}isEmpty(){return this._objects.length===0}size(){return this._objects.length}contains(n,s){return!!this._objects.includes(n)||!!s&&this._objects.some(i=>i instanceof e&&i.contains(n,!0))}complexity(){return this._objects.reduce((n,s)=>n+=s.complexity?s.complexity():0,0)}sendObjectToBack(n){return!(!n||n===this._objects[0])&&($c(this._objects,n),this._objects.unshift(n),this._onStackOrderChanged(n),!0)}bringObjectToFront(n){return!(!n||n===this._objects[this._objects.length-1])&&($c(this._objects,n),this._objects.push(n),this._onStackOrderChanged(n),!0)}sendObjectBackwards(n,s){if(!n)return!1;const i=this._objects.indexOf(n);if(i!==0){const o=this.findNewLowerIndex(n,i,s);return $c(this._objects,n),this._objects.splice(o,0,n),this._onStackOrderChanged(n),!0}return!1}bringObjectForward(n,s){if(!n)return!1;const i=this._objects.indexOf(n);if(i!==this._objects.length-1){const o=this.findNewUpperIndex(n,i,s);return $c(this._objects,n),this._objects.splice(o,0,n),this._onStackOrderChanged(n),!0}return!1}moveObjectTo(n,s){return n!==this._objects[s]&&($c(this._objects,n),this._objects.splice(s,0,n),this._onStackOrderChanged(n),!0)}findNewLowerIndex(n,s,i){let o;if(i){o=s;for(let a=s-1;a>=0;--a)if(n.isOverlapping(this._objects[a])){o=a;break}}else o=s-1;return o}findNewUpperIndex(n,s,i){let o;if(i){o=s;for(let a=s+1;a<this._objects.length;++a)if(n.isOverlapping(this._objects[a])){o=a;break}}else o=s+1;return o}collectObjects(n){let{left:s,top:i,width:o,height:a}=n,{includeIntersecting:l=!0}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const c=[],u=new Ce(s,i),d=u.add(new Ce(o,a));for(let h=this._objects.length-1;h>=0;h--){const f=this._objects[h];f.selectable&&f.visible&&(l&&f.intersectsWithRect(u,d)||f.isContainedWithinRect(u,d)||l&&f.containsPoint(u)||l&&f.containsPoint(d))&&c.push(f)}return c}}return e}class Lz extends TX{_setOptions(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};for(const r in e)this.set(r,e[r])}_setObject(e){for(const r in e)this._set(r,e[r])}set(e,r){return typeof e=="object"?this._setObject(e):this._set(e,r),this}_set(e,r){this[e]=r}toggle(e){const r=this.get(e);return typeof r=="boolean"&&this.set(e,!r),this}get(e){return this[e]}}function jm(t){return y_().requestAnimationFrame(t)}function CX(t){return y_().cancelAnimationFrame(t)}let SX=0;const Wa=()=>SX++,Wo=()=>{const t=zu().createElement("canvas");if(!t||t.getContext===void 0)throw new co("Failed to create `canvas` element");return t},EX=()=>zu().createElement("img"),ai=t=>{const e=Wo();return e.width=t.width,e.height=t.height,e},Rz=(t,e,r)=>t.toDataURL("image/".concat(e),r),jz=(t,e,r)=>new Promise((n,s)=>{t.toBlob(n,"image/".concat(e),r)}),nn=t=>t*Bb,Uo=t=>t/Bb,PX=t=>t.every((e,r)=>e===rs[r]),ls=(t,e,r)=>new Ce(t).transform(e,r),Oi=t=>{const e=1/(t[0]*t[3]-t[1]*t[2]),r=[e*t[3],-e*t[1],-e*t[2],e*t[0],0,0],{x:n,y:s}=new Ce(t[4],t[5]).transform(r,!0);return r[4]=-n,r[5]=-s,r},In=(t,e,r)=>[t[0]*e[0]+t[2]*e[1],t[1]*e[0]+t[3]*e[1],t[0]*e[2]+t[2]*e[3],t[1]*e[2]+t[3]*e[3],r?0:t[0]*e[4]+t[2]*e[5]+t[4],r?0:t[1]*e[4]+t[3]*e[5]+t[5]],Hb=(t,e)=>t.reduceRight((r,n)=>n&&r?In(n,r,e):n||r,void 0)||rs.concat(),Nz=t=>{let[e,r]=t;return Math.atan2(r,e)},$g=t=>{const e=Nz(t),r=Math.pow(t[0],2)+Math.pow(t[1],2),n=Math.sqrt(r),s=(t[0]*t[3]-t[2]*t[1])/n,i=Math.atan2(t[0]*t[2]+t[1]*t[3],r);return{angle:Uo(e),scaleX:n,scaleY:s,skewX:Uo(i),skewY:0,translateX:t[4]||0,translateY:t[5]||0}},lf=function(t){return[1,0,0,1,t,arguments.length>1&&arguments[1]!==void 0?arguments[1]:0]};function Wu(){let{angle:t=0}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},{x:e=0,y:r=0}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const n=nn(t),s=Bo(n),i=Vo(n);return[s,i,-i,s,e?e-(s*e-i*r):0,r?r-(i*e+s*r):0]}const Kb=function(t){return[t,0,0,arguments.length>1&&arguments[1]!==void 0?arguments[1]:t,0,0]},zz=t=>Math.tan(nn(t)),Bz=t=>[1,0,zz(t),1,0,0],Vz=t=>[1,zz(t),0,1,0,0],x_=t=>{let{scaleX:e=1,scaleY:r=1,flipX:n=!1,flipY:s=!1,skewX:i=0,skewY:o=0}=t,a=Kb(n?-e:e,s?-r:r);return i&&(a=In(a,Bz(i),!0)),o&&(a=In(a,Vz(o),!0)),a},kX=t=>{const{translateX:e=0,translateY:r=0,angle:n=0}=t;let s=lf(e,r);n&&(s=In(s,Wu({angle:n})));const i=x_(t);return PX(i)||(s=In(s,i)),s},Nm=function(t){let{signal:e,crossOrigin:r=null}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return new Promise(function(n,s){if(e&&e.aborted)return s(new yX("loadImage"));const i=EX();let o;e&&(o=function(l){i.src="",s(l)},e.addEventListener("abort",o,{once:!0}));const a=function(){i.onload=i.onerror=null,o&&(e==null||e.removeEventListener("abort",o)),n(i)};t?(i.onload=a,i.onerror=function(){o&&(e==null||e.removeEventListener("abort",o)),s(new co("Error loading ".concat(i.src)))},r&&(i.crossOrigin=r),i.src=t):a()})},Uh=function(t){let{signal:e,reviver:r=Lm}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return new Promise((n,s)=>{const i=[];e&&e.addEventListener("abort",s,{once:!0}),Promise.all(t.map(o=>ht.getClass(o.type).fromObject(o,{signal:e}).then(a=>(r(o,a),i.push(a),a)))).then(n).catch(o=>{i.forEach(a=>{a.dispose&&a.dispose()}),s(o)}).finally(()=>{e&&e.removeEventListener("abort",s)})})},b_=function(t){let{signal:e}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return new Promise((r,n)=>{const s=[];e&&e.addEventListener("abort",n,{once:!0});const i=Object.values(t).map(a=>a&&a.type&&ht.has(a.type)?Uh([a],{signal:e}).then(l=>{let[c]=l;return s.push(c),c}):a),o=Object.keys(t);Promise.all(i).then(a=>a.reduce((l,c,u)=>(l[o[u]]=c,l),{})).then(r).catch(a=>{s.forEach(l=>{l.dispose&&l.dispose()}),n(a)}).finally(()=>{e&&e.removeEventListener("abort",n)})})},Uu=function(t){return(arguments.length>1&&arguments[1]!==void 0?arguments[1]:[]).reduce((e,r)=>(r in t&&(e[r]=t[r]),e),{})},Xb=(t,e)=>Object.keys(t).reduce((r,n)=>(e(t[n],n,t)&&(r[n]=t[n]),r),{}),Fr=(t,e)=>parseFloat(Number(t).toFixed(e)),Gh=t=>"matrix("+t.map(e=>Fr(e,dr.NUM_FRACTION_DIGITS)).join(" ")+")",ei=t=>!!t&&t.toLive!==void 0,GO=t=>!!t&&typeof t.toObject=="function",HO=t=>!!t&&t.offsetX!==void 0&&"source"in t,El=t=>!!t&&"multiSelectionStacking"in t;function Wz(t){const e=t&&$i(t);let r=0,n=0;if(!t||!e)return{left:r,top:n};let s=t;const i=e.documentElement,o=e.body||{scrollLeft:0,scrollTop:0};for(;s&&(s.parentNode||s.host)&&(s=s.parentNode||s.host,s===e?(r=o.scrollLeft||i.scrollLeft||0,n=o.scrollTop||i.scrollTop||0):(r+=s.scrollLeft||0,n+=s.scrollTop||0),s.nodeType!==1||s.style.position!=="fixed"););return{left:r,top:n}}const $i=t=>t.ownerDocument||null,Uz=t=>{var e;return((e=t.ownerDocument)===null||e===void 0?void 0:e.defaultView)||null},Gz=function(t,e,r){let{width:n,height:s}=r,i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:1;t.width=n,t.height=s,i>1&&(t.setAttribute("width",(n*i).toString()),t.setAttribute("height",(s*i).toString()),e.scale(i,i))},Tx=(t,e)=>{let{width:r,height:n}=e;r&&(t.style.width=typeof r=="number"?"".concat(r,"px"):r),n&&(t.style.height=typeof n=="number"?"".concat(n,"px"):n)};function KO(t){return t.onselectstart!==void 0&&(t.onselectstart=()=>!1),t.style.userSelect=gs,t}class Hz{constructor(e){fe(this,"_originalCanvasStyle",void 0),fe(this,"lower",void 0);const r=this.createLowerCanvas(e);this.lower={el:r,ctx:r.getContext("2d")}}createLowerCanvas(e){const r=(n=e)&&n.getContext!==void 0?e:e&&zu().getElementById(e)||Wo();var n;if(r.hasAttribute("data-fabric"))throw new co("Trying to initialize a canvas that has already been initialized. Did you forget to dispose the canvas?");return this._originalCanvasStyle=r.style.cssText,r.setAttribute("data-fabric","main"),r.classList.add("lower-canvas"),r}cleanupDOM(e){let{width:r,height:n}=e;const{el:s}=this.lower;s.classList.remove("lower-canvas"),s.removeAttribute("data-fabric"),s.setAttribute("width","".concat(r)),s.setAttribute("height","".concat(n)),s.style.cssText=this._originalCanvasStyle||"",this._originalCanvasStyle=void 0}setDimensions(e,r){const{el:n,ctx:s}=this.lower;Gz(n,s,e,r)}setCSSDimensions(e){Tx(this.lower.el,e)}calcOffset(){return function(e){var r;const n=e&&$i(e),s={left:0,top:0};if(!n)return s;const i=((r=Uz(e))===null||r===void 0?void 0:r.getComputedStyle(e,null))||{};s.left+=parseInt(i.borderLeftWidth,10)||0,s.top+=parseInt(i.borderTopWidth,10)||0,s.left+=parseInt(i.paddingLeft,10)||0,s.top+=parseInt(i.paddingTop,10)||0;let o={left:0,top:0};const a=n.documentElement;e.getBoundingClientRect!==void 0&&(o=e.getBoundingClientRect());const l=Wz(e);return{left:o.left+l.left-(a.clientLeft||0)+s.left,top:o.top+l.top-(a.clientTop||0)+s.top}}(this.lower.el)}dispose(){po().dispose(this.lower.el),delete this.lower}}const AX={backgroundVpt:!0,backgroundColor:"",overlayVpt:!0,overlayColor:"",includeDefaultValues:!0,svgViewportTransformation:!0,renderOnAddRemove:!0,skipOffscreen:!0,enableRetinaScaling:!0,imageSmoothingEnabled:!0,controlsAboveOverlay:!1,allowTouchScrolling:!1,viewportTransform:[...rs]};class cf extends Fz(Lz){get lowerCanvasEl(){var e;return(e=this.elements.lower)===null||e===void 0?void 0:e.el}get contextContainer(){var e;return(e=this.elements.lower)===null||e===void 0?void 0:e.ctx}static getDefaults(){return cf.ownDefaults}constructor(e){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(),Object.assign(this,this.constructor.getDefaults()),this.set(r),this.initElements(e),this._setDimensionsImpl({width:this.width||this.elements.lower.el.width||0,height:this.height||this.elements.lower.el.height||0}),this.skipControlsDrawing=!1,this.viewportTransform=[...this.viewportTransform],this.calcViewportBoundaries()}initElements(e){this.elements=new Hz(e)}add(){const e=super.add(...arguments);return arguments.length>0&&this.renderOnAddRemove&&this.requestRenderAll(),e}insertAt(e){for(var r=arguments.length,n=new Array(r>1?r-1:0),s=1;s<r;s++)n[s-1]=arguments[s];const i=super.insertAt(e,...n);return n.length>0&&this.renderOnAddRemove&&this.requestRenderAll(),i}remove(){const e=super.remove(...arguments);return e.length>0&&this.renderOnAddRemove&&this.requestRenderAll(),e}_onObjectAdded(e){e.canvas&&e.canvas!==this&&(Va("warn",`Canvas is trying to add an object that belongs to a different canvas.
Resulting to default behavior: removing object from previous canvas and adding to new canvas`),e.canvas.remove(e)),e._set("canvas",this),e.setCoords(),this.fire("object:added",{target:e}),e.fire("added",{target:this})}_onObjectRemoved(e){e._set("canvas",void 0),this.fire("object:removed",{target:e}),e.fire("removed",{target:this})}_onStackOrderChanged(){this.renderOnAddRemove&&this.requestRenderAll()}getRetinaScaling(){return this.enableRetinaScaling?$z():1}calcOffset(){return this._offset=this.elements.calcOffset()}getWidth(){return this.width}getHeight(){return this.height}setWidth(e,r){return this.setDimensions({width:e},r)}setHeight(e,r){return this.setDimensions({height:e},r)}_setDimensionsImpl(e){let{cssOnly:r=!1,backstoreOnly:n=!1}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!r){const s=ge({width:this.width,height:this.height},e);this.elements.setDimensions(s,this.getRetinaScaling()),this.hasLostContext=!0,this.width=s.width,this.height=s.height}n||this.elements.setCSSDimensions(e),this.calcOffset()}setDimensions(e,r){this._setDimensionsImpl(e,r),r&&r.cssOnly||this.requestRenderAll()}getZoom(){return this.viewportTransform[0]}setViewportTransform(e){this.viewportTransform=e,this.calcViewportBoundaries(),this.renderOnAddRemove&&this.requestRenderAll()}zoomToPoint(e,r){const n=e,s=[...this.viewportTransform],i=ls(e,Oi(s));s[0]=r,s[3]=r;const o=ls(i,s);s[4]+=n.x-o.x,s[5]+=n.y-o.y,this.setViewportTransform(s)}setZoom(e){this.zoomToPoint(new Ce(0,0),e)}absolutePan(e){const r=[...this.viewportTransform];return r[4]=-e.x,r[5]=-e.y,this.setViewportTransform(r)}relativePan(e){return this.absolutePan(new Ce(-e.x-this.viewportTransform[4],-e.y-this.viewportTransform[5]))}getElement(){return this.elements.lower.el}clearContext(e){e.clearRect(0,0,this.width,this.height)}getContext(){return this.elements.lower.ctx}clear(){this.remove(...this.getObjects()),this.backgroundImage=void 0,this.overlayImage=void 0,this.backgroundColor="",this.overlayColor="",this.clearContext(this.getContext()),this.fire("canvas:cleared"),this.renderOnAddRemove&&this.requestRenderAll()}renderAll(){this.cancelRequestedRender(),this.destroyed||this.renderCanvas(this.getContext(),this._objects)}renderAndReset(){this.nextRenderHandle=0,this.renderAll()}requestRenderAll(){this.nextRenderHandle||this.disposed||this.destroyed||(this.nextRenderHandle=jm(()=>this.renderAndReset()))}calcViewportBoundaries(){const e=this.width,r=this.height,n=Oi(this.viewportTransform),s=ls({x:0,y:0},n),i=ls({x:e,y:r},n),o=s.min(i),a=s.max(i);return this.vptCoords={tl:o,tr:new Ce(a.x,o.y),bl:new Ce(o.x,a.y),br:a}}cancelRequestedRender(){this.nextRenderHandle&&(CX(this.nextRenderHandle),this.nextRenderHandle=0)}drawControls(e){}renderCanvas(e,r){if(this.destroyed)return;const n=this.viewportTransform,s=this.clipPath;this.calcViewportBoundaries(),this.clearContext(e),e.imageSmoothingEnabled=this.imageSmoothingEnabled,e.patternQuality="best",this.fire("before:render",{ctx:e}),this._renderBackground(e),e.save(),e.transform(n[0],n[1],n[2],n[3],n[4],n[5]),this._renderObjects(e,r),e.restore(),this.controlsAboveOverlay||this.skipControlsDrawing||this.drawControls(e),s&&(s._set("canvas",this),s.shouldCache(),s._transformDone=!0,s.renderCache({forClipping:!0}),this.drawClipPathOnCanvas(e,s)),this._renderOverlay(e),this.controlsAboveOverlay&&!this.skipControlsDrawing&&this.drawControls(e),this.fire("after:render",{ctx:e}),this.__cleanupTask&&(this.__cleanupTask(),this.__cleanupTask=void 0)}drawClipPathOnCanvas(e,r){const n=this.viewportTransform;e.save(),e.transform(...n),e.globalCompositeOperation="destination-in",r.transform(e),e.scale(1/r.zoomX,1/r.zoomY),e.drawImage(r._cacheCanvas,-r.cacheTranslationX,-r.cacheTranslationY),e.restore()}_renderObjects(e,r){for(let n=0,s=r.length;n<s;++n)r[n]&&r[n].render(e)}_renderBackgroundOrOverlay(e,r){const n=this["".concat(r,"Color")],s=this["".concat(r,"Image")],i=this.viewportTransform,o=this["".concat(r,"Vpt")];if(!n&&!s)return;const a=ei(n);if(n){if(e.save(),e.beginPath(),e.moveTo(0,0),e.lineTo(this.width,0),e.lineTo(this.width,this.height),e.lineTo(0,this.height),e.closePath(),e.fillStyle=a?n.toLive(e):n,o&&e.transform(...i),a){e.transform(1,0,0,1,n.offsetX||0,n.offsetY||0);const l=n.gradientTransform||n.patternTransform;l&&e.transform(...l)}e.fill(),e.restore()}if(s){e.save();const{skipOffscreen:l}=this;this.skipOffscreen=o,o&&e.transform(...i),s.render(e),this.skipOffscreen=l,e.restore()}}_renderBackground(e){this._renderBackgroundOrOverlay(e,"background")}_renderOverlay(e){this._renderBackgroundOrOverlay(e,"overlay")}getCenter(){return{top:this.height/2,left:this.width/2}}getCenterPoint(){return new Ce(this.width/2,this.height/2)}centerObjectH(e){return this._centerObject(e,new Ce(this.getCenterPoint().x,e.getCenterPoint().y))}centerObjectV(e){return this._centerObject(e,new Ce(e.getCenterPoint().x,this.getCenterPoint().y))}centerObject(e){return this._centerObject(e,this.getCenterPoint())}viewportCenterObject(e){return this._centerObject(e,this.getVpCenter())}viewportCenterObjectH(e){return this._centerObject(e,new Ce(this.getVpCenter().x,e.getCenterPoint().y))}viewportCenterObjectV(e){return this._centerObject(e,new Ce(e.getCenterPoint().x,this.getVpCenter().y))}getVpCenter(){return ls(this.getCenterPoint(),Oi(this.viewportTransform))}_centerObject(e,r){e.setXY(r,Wt,Wt),e.setCoords(),this.renderOnAddRemove&&this.requestRenderAll()}toDatalessJSON(e){return this.toDatalessObject(e)}toObject(e){return this._toObjectMethod("toObject",e)}toJSON(){return this.toObject()}toDatalessObject(e){return this._toObjectMethod("toDatalessObject",e)}_toObjectMethod(e,r){const n=this.clipPath,s=n&&!n.excludeFromExport?this._toObject(n,e,r):null;return ge(ge(ge({version:bx},Uu(this,r)),{},{objects:this._objects.filter(i=>!i.excludeFromExport).map(i=>this._toObject(i,e,r))},this.__serializeBgOverlay(e,r)),s?{clipPath:s}:null)}_toObject(e,r,n){let s;this.includeDefaultValues||(s=e.includeDefaultValues,e.includeDefaultValues=!1);const i=e[r](n);return this.includeDefaultValues||(e.includeDefaultValues=!!s),i}__serializeBgOverlay(e,r){const n={},s=this.backgroundImage,i=this.overlayImage,o=this.backgroundColor,a=this.overlayColor;return ei(o)?o.excludeFromExport||(n.background=o.toObject(r)):o&&(n.background=o),ei(a)?a.excludeFromExport||(n.overlay=a.toObject(r)):a&&(n.overlay=a),s&&!s.excludeFromExport&&(n.backgroundImage=this._toObject(s,e,r)),i&&!i.excludeFromExport&&(n.overlayImage=this._toObject(i,e,r)),n}toSVG(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},r=arguments.length>1?arguments[1]:void 0;e.reviver=r;const n=[];return this._setSVGPreamble(n,e),this._setSVGHeader(n,e),this.clipPath&&n.push('<g clip-path="url(#'.concat(this.clipPath.clipPathId,`)" >
`)),this._setSVGBgOverlayColor(n,"background"),this._setSVGBgOverlayImage(n,"backgroundImage",r),this._setSVGObjects(n,r),this.clipPath&&n.push(`</g>
`),this._setSVGBgOverlayColor(n,"overlay"),this._setSVGBgOverlayImage(n,"overlayImage",r),n.push("</svg>"),n.join("")}_setSVGPreamble(e,r){r.suppressPreamble||e.push('<?xml version="1.0" encoding="',r.encoding||"UTF-8",`" standalone="no" ?>
`,'<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" ',`"http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
`)}_setSVGHeader(e,r){const n=r.width||"".concat(this.width),s=r.height||"".concat(this.height),i=dr.NUM_FRACTION_DIGITS,o=r.viewBox;let a;if(o)a='viewBox="'.concat(o.x," ").concat(o.y," ").concat(o.width," ").concat(o.height,'" ');else if(this.svgViewportTransformation){const l=this.viewportTransform;a='viewBox="'.concat(Fr(-l[4]/l[0],i)," ").concat(Fr(-l[5]/l[3],i)," ").concat(Fr(this.width/l[0],i)," ").concat(Fr(this.height/l[3],i),'" ')}else a='viewBox="0 0 '.concat(this.width," ").concat(this.height,'" ');e.push("<svg ",'xmlns="http://www.w3.org/2000/svg" ','xmlns:xlink="http://www.w3.org/1999/xlink" ','version="1.1" ','width="',n,'" ','height="',s,'" ',a,`xml:space="preserve">
`,"<desc>Created with Fabric.js ",bx,`</desc>
`,`<defs>
`,this.createSVGFontFacesMarkup(),this.createSVGRefElementsMarkup(),this.createSVGClipPathMarkup(r),`</defs>
`)}createSVGClipPathMarkup(e){const r=this.clipPath;return r?(r.clipPathId="CLIPPATH_".concat(Wa()),'<clipPath id="'.concat(r.clipPathId,`" >
`).concat(r.toClipPathSVG(e.reviver),`</clipPath>
`)):""}createSVGRefElementsMarkup(){return["background","overlay"].map(e=>{const r=this["".concat(e,"Color")];if(ei(r)){const n=this["".concat(e,"Vpt")],s=this.viewportTransform,i={isType:()=>!1,width:this.width/(n?s[0]:1),height:this.height/(n?s[3]:1)};return r.toSVG(i,{additionalTransform:n?Gh(s):""})}}).join("")}createSVGFontFacesMarkup(){const e=[],r={},n=dr.fontPaths;this._objects.forEach(function i(o){e.push(o),Rm(o)&&o._objects.forEach(i)}),e.forEach(i=>{if(!(o=i)||typeof o._renderText!="function")return;var o;const{styles:a,fontFamily:l}=i;!r[l]&&n[l]&&(r[l]=!0,a&&Object.values(a).forEach(c=>{Object.values(c).forEach(u=>{let{fontFamily:d=""}=u;!r[d]&&n[d]&&(r[d]=!0)})}))});const s=Object.keys(r).map(i=>`		@font-face {
			font-family: '`.concat(i,`';
			src: url('`).concat(n[i],`');
		}
`)).join("");return s?`	<style type="text/css"><![CDATA[
`.concat(s,`]]></style>
`):""}_setSVGObjects(e,r){this.forEachObject(n=>{n.excludeFromExport||this._setSVGObject(e,n,r)})}_setSVGObject(e,r,n){e.push(r.toSVG(n))}_setSVGBgOverlayImage(e,r,n){const s=this[r];s&&!s.excludeFromExport&&s.toSVG&&e.push(s.toSVG(n))}_setSVGBgOverlayColor(e,r){const n=this["".concat(r,"Color")];if(n)if(ei(n)){const s=n.repeat||"",i=this.width,o=this.height,a=this["".concat(r,"Vpt")]?Gh(Oi(this.viewportTransform)):"";e.push('<rect transform="'.concat(a," translate(").concat(i/2,",").concat(o/2,')" x="').concat(n.offsetX-i/2,'" y="').concat(n.offsetY-o/2,'" width="').concat(s!=="repeat-y"&&s!=="no-repeat"||!HO(n)?i:n.source.width,'" height="').concat(s!=="repeat-x"&&s!=="no-repeat"||!HO(n)?o:n.source.height,'" fill="url(#SVGID_').concat(n.id,`)"></rect>
`))}else e.push('<rect x="0" y="0" width="100%" height="100%" ','fill="',n,'"',`></rect>
`)}loadFromJSON(e,r){let{signal:n}=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(!e)return Promise.reject(new co("`json` is undefined"));const s=typeof e=="string"?JSON.parse(e):e,{objects:i=[],backgroundImage:o,background:a,overlayImage:l,overlay:c,clipPath:u}=s,d=this.renderOnAddRemove;return this.renderOnAddRemove=!1,Promise.all([Uh(i,{reviver:r,signal:n}),b_({backgroundImage:o,backgroundColor:a,overlayImage:l,overlayColor:c,clipPath:u},{signal:n})]).then(h=>{let[f,p]=h;return this.clear(),this.add(...f),this.set(s),this.set(p),this.renderOnAddRemove=d,this})}clone(e){const r=this.toObject(e);return this.cloneWithoutData().loadFromJSON(r)}cloneWithoutData(){const e=ai(this);return new this.constructor(e)}toDataURL(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{format:r="png",quality:n=1,multiplier:s=1,enableRetinaScaling:i=!1}=e,o=s*(i?this.getRetinaScaling():1);return Rz(this.toCanvasElement(o,e),r,n)}toBlob(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{format:r="png",quality:n=1,multiplier:s=1,enableRetinaScaling:i=!1}=e,o=s*(i?this.getRetinaScaling():1);return jz(this.toCanvasElement(o,e),r,n)}toCanvasElement(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:1,{width:r,height:n,left:s,top:i,filter:o}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const a=(r||this.width)*e,l=(n||this.height)*e,c=this.getZoom(),u=this.width,d=this.height,h=this.skipControlsDrawing,f=c*e,p=this.viewportTransform,m=[f,0,0,f,(p[4]-(s||0))*e,(p[5]-(i||0))*e],y=this.enableRetinaScaling,g=ai({width:a,height:l}),_=o?this._objects.filter(v=>o(v)):this._objects;return this.enableRetinaScaling=!1,this.viewportTransform=m,this.width=a,this.height=l,this.skipControlsDrawing=!0,this.calcViewportBoundaries(),this.renderCanvas(g.getContext("2d"),_),this.viewportTransform=p,this.width=u,this.height=d,this.calcViewportBoundaries(),this.enableRetinaScaling=y,this.skipControlsDrawing=h,g}dispose(){return!this.disposed&&this.elements.cleanupDOM({width:this.width,height:this.height}),Ag.cancelByCanvas(this),this.disposed=!0,new Promise((e,r)=>{const n=()=>{this.destroy(),e(!0)};n.kill=r,this.__cleanupTask&&this.__cleanupTask.kill("aborted"),this.destroyed?e(!1):this.nextRenderHandle?this.__cleanupTask=n:n()})}destroy(){this.destroyed=!0,this.cancelRequestedRender(),this.forEachObject(e=>e.dispose()),this._objects=[],this.backgroundImage&&this.backgroundImage.dispose(),this.backgroundImage=void 0,this.overlayImage&&this.overlayImage.dispose(),this.overlayImage=void 0,this.elements.dispose()}toString(){return"#<Canvas (".concat(this.complexity(),"): { objects: ").concat(this._objects.length," }>")}}fe(cf,"ownDefaults",AX);const $X=["touchstart","touchmove","touchend"],OX=t=>{const e=Wz(t.target),r=function(n){const s=n.changedTouches;return s&&s[0]?s[0]:n}(t);return new Ce(r.clientX+e.left,r.clientY+e.top)},Cx=t=>$X.includes(t.type)||t.pointerType==="touch",XO=t=>{t.preventDefault(),t.stopPropagation()},Do=t=>{let e=0,r=0,n=0,s=0;for(let i=0,o=t.length;i<o;i++){const{x:a,y:l}=t[i];(a>n||!i)&&(n=a),(a<e||!i)&&(e=a),(l>s||!i)&&(s=l),(l<r||!i)&&(r=l)}return{left:e,top:r,width:n-e,height:s-r}},DX=["translateX","translateY","scaleX","scaleY"],IX=(t,e)=>Og(t,In(e,t.calcOwnMatrix())),Og=(t,e)=>{const r=$g(e),{translateX:n,translateY:s,scaleX:i,scaleY:o}=r,a=Lr(r,DX),l=new Ce(n,s);t.flipX=!1,t.flipY=!1,Object.assign(t,a),t.set({scaleX:i,scaleY:o}),t.setPositionByOrigin(l,Wt,Wt)},FX=t=>{t.scaleX=1,t.scaleY=1,t.skewX=0,t.skewY=0,t.flipX=!1,t.flipY=!1,t.rotate(0)},Kz=t=>({scaleX:t.scaleX,scaleY:t.scaleY,skewX:t.skewX,skewY:t.skewY,angle:t.angle,left:t.left,flipX:t.flipX,flipY:t.flipY,top:t.top}),qb=(t,e,r)=>{const n=t/2,s=e/2,i=[new Ce(-n,-s),new Ce(n,-s),new Ce(-n,s),new Ce(n,s)].map(a=>a.transform(r)),o=Do(i);return new Ce(o.width,o.height)},M_=function(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:rs;return In(Oi(arguments.length>1&&arguments[1]!==void 0?arguments[1]:rs),t)},iu=function(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:rs,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:rs;return t.transform(M_(e,r))},LX=function(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:rs,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:rs;return t.transform(M_(e,r),!0)},RX=(t,e,r)=>{const n=M_(e,r);return Og(t,In(n,t.calcOwnMatrix())),n},Xz=(t,e)=>{var r;const{transform:{target:n}}=e;(r=n.canvas)===null||r===void 0||r.fire("object:".concat(t),ge(ge({},e),{},{target:n})),n.fire(t,e)},jX={left:-.5,top:-.5,center:0,bottom:.5,right:.5},dn=t=>typeof t=="string"?jX[t]:t-.5,Dg="not-allowed";function qz(t){return dn(t.originX)===dn(Wt)&&dn(t.originY)===dn(Wt)}function qO(t){return .5-dn(t)}const Ri=(t,e)=>t[e],Yz=(t,e,r,n)=>({e:t,transform:e,pointer:new Ce(r,n)});function Qz(t,e){const r=t.getTotalAngle()+Uo(Math.atan2(e.y,e.x))+360;return Math.round(r%360/45)}function Yb(t,e,r,n,s){var i;let{target:o,corner:a}=t;const l=o.controls[a],c=((i=o.canvas)===null||i===void 0?void 0:i.getZoom())||1,u=o.padding/c,d=function(h,f,p,m){const y=h.getRelativeCenterPoint(),g=p!==void 0&&m!==void 0?h.translateToGivenOrigin(y,Wt,Wt,p,m):new Ce(h.left,h.top);return(h.angle?f.rotate(-nn(h.angle),y):f).subtract(g)}(o,new Ce(n,s),e,r);return d.x>=u&&(d.x-=u),d.x<=-u&&(d.x+=u),d.y>=u&&(d.y-=u),d.y<=u&&(d.y+=u),d.x-=l.offsetX,d.y-=l.offsetY,d}const NX=(t,e,r,n)=>{const{target:s,offsetX:i,offsetY:o}=e,a=r-i,l=n-o,c=!Ri(s,"lockMovementX")&&s.left!==a,u=!Ri(s,"lockMovementY")&&s.top!==l;return c&&s.set(pr,a),u&&s.set(ms,l),(c||u)&&Xz(Oz,Yz(t,e,r,n)),c||u},YO={aliceblue:"#F0F8FF",antiquewhite:"#FAEBD7",aqua:"#0FF",aquamarine:"#7FFFD4",azure:"#F0FFFF",beige:"#F5F5DC",bisque:"#FFE4C4",black:"#000",blanchedalmond:"#FFEBCD",blue:"#00F",blueviolet:"#8A2BE2",brown:"#A52A2A",burlywood:"#DEB887",cadetblue:"#5F9EA0",chartreuse:"#7FFF00",chocolate:"#D2691E",coral:"#FF7F50",cornflowerblue:"#6495ED",cornsilk:"#FFF8DC",crimson:"#DC143C",cyan:"#0FF",darkblue:"#00008B",darkcyan:"#008B8B",darkgoldenrod:"#B8860B",darkgray:"#A9A9A9",darkgrey:"#A9A9A9",darkgreen:"#006400",darkkhaki:"#BDB76B",darkmagenta:"#8B008B",darkolivegreen:"#556B2F",darkorange:"#FF8C00",darkorchid:"#9932CC",darkred:"#8B0000",darksalmon:"#E9967A",darkseagreen:"#8FBC8F",darkslateblue:"#483D8B",darkslategray:"#2F4F4F",darkslategrey:"#2F4F4F",darkturquoise:"#00CED1",darkviolet:"#9400D3",deeppink:"#FF1493",deepskyblue:"#00BFFF",dimgray:"#696969",dimgrey:"#696969",dodgerblue:"#1E90FF",firebrick:"#B22222",floralwhite:"#FFFAF0",forestgreen:"#228B22",fuchsia:"#F0F",gainsboro:"#DCDCDC",ghostwhite:"#F8F8FF",gold:"#FFD700",goldenrod:"#DAA520",gray:"#808080",grey:"#808080",green:"#008000",greenyellow:"#ADFF2F",honeydew:"#F0FFF0",hotpink:"#FF69B4",indianred:"#CD5C5C",indigo:"#4B0082",ivory:"#FFFFF0",khaki:"#F0E68C",lavender:"#E6E6FA",lavenderblush:"#FFF0F5",lawngreen:"#7CFC00",lemonchiffon:"#FFFACD",lightblue:"#ADD8E6",lightcoral:"#F08080",lightcyan:"#E0FFFF",lightgoldenrodyellow:"#FAFAD2",lightgray:"#D3D3D3",lightgrey:"#D3D3D3",lightgreen:"#90EE90",lightpink:"#FFB6C1",lightsalmon:"#FFA07A",lightseagreen:"#20B2AA",lightskyblue:"#87CEFA",lightslategray:"#789",lightslategrey:"#789",lightsteelblue:"#B0C4DE",lightyellow:"#FFFFE0",lime:"#0F0",limegreen:"#32CD32",linen:"#FAF0E6",magenta:"#F0F",maroon:"#800000",mediumaquamarine:"#66CDAA",mediumblue:"#0000CD",mediumorchid:"#BA55D3",mediumpurple:"#9370DB",mediumseagreen:"#3CB371",mediumslateblue:"#7B68EE",mediumspringgreen:"#00FA9A",mediumturquoise:"#48D1CC",mediumvioletred:"#C71585",midnightblue:"#191970",mintcream:"#F5FFFA",mistyrose:"#FFE4E1",moccasin:"#FFE4B5",navajowhite:"#FFDEAD",navy:"#000080",oldlace:"#FDF5E6",olive:"#808000",olivedrab:"#6B8E23",orange:"#FFA500",orangered:"#FF4500",orchid:"#DA70D6",palegoldenrod:"#EEE8AA",palegreen:"#98FB98",paleturquoise:"#AFEEEE",palevioletred:"#DB7093",papayawhip:"#FFEFD5",peachpuff:"#FFDAB9",peru:"#CD853F",pink:"#FFC0CB",plum:"#DDA0DD",powderblue:"#B0E0E6",purple:"#800080",rebeccapurple:"#639",red:"#F00",rosybrown:"#BC8F8F",royalblue:"#4169E1",saddlebrown:"#8B4513",salmon:"#FA8072",sandybrown:"#F4A460",seagreen:"#2E8B57",seashell:"#FFF5EE",sienna:"#A0522D",silver:"#C0C0C0",skyblue:"#87CEEB",slateblue:"#6A5ACD",slategray:"#708090",slategrey:"#708090",snow:"#FFFAFA",springgreen:"#00FF7F",steelblue:"#4682B4",tan:"#D2B48C",teal:"#008080",thistle:"#D8BFD8",tomato:"#FF6347",turquoise:"#40E0D0",violet:"#EE82EE",wheat:"#F5DEB3",white:"#FFF",whitesmoke:"#F5F5F5",yellow:"#FF0",yellowgreen:"#9ACD32"},kv=(t,e,r)=>(r<0&&(r+=1),r>1&&(r-=1),r<1/6?t+6*(e-t)*r:r<.5?e:r<2/3?t+(e-t)*(2/3-r)*6:t),QO=(t,e,r,n)=>{t/=255,e/=255,r/=255;const s=Math.max(t,e,r),i=Math.min(t,e,r);let o,a;const l=(s+i)/2;if(s===i)o=a=0;else{const c=s-i;switch(a=l>.5?c/(2-s-i):c/(s+i),s){case t:o=(e-r)/c+(e<r?6:0);break;case e:o=(r-t)/c+2;break;case r:o=(t-e)/c+4}o/=6}return[Math.round(360*o),Math.round(100*a),Math.round(100*l),n]},JO=function(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"1";return parseFloat(t)/(t.endsWith("%")?100:1)},zp=t=>Math.min(Math.round(t),255).toString(16).toUpperCase().padStart(2,"0"),ZO=t=>{let[e,r,n,s=1]=t;const i=Math.round(.3*e+.59*r+.11*n);return[i,i,i,s]};class _r{constructor(e){if(fe(this,"isUnrecognised",!1),e)if(e instanceof _r)this.setSource([...e._source]);else if(Array.isArray(e)){const[r,n,s,i=1]=e;this.setSource([r,n,s,i])}else this.setSource(this._tryParsingColor(e));else this.setSource([0,0,0,1])}_tryParsingColor(e){return(e=e.toLowerCase())in YO&&(e=YO[e]),e==="transparent"?[255,255,255,0]:_r.sourceFromHex(e)||_r.sourceFromRgb(e)||_r.sourceFromHsl(e)||(this.isUnrecognised=!0)&&[0,0,0,1]}getSource(){return this._source}setSource(e){this._source=e}toRgb(){const[e,r,n]=this.getSource();return"rgb(".concat(e,",").concat(r,",").concat(n,")")}toRgba(){return"rgba(".concat(this.getSource().join(","),")")}toHsl(){const[e,r,n]=QO(...this.getSource());return"hsl(".concat(e,",").concat(r,"%,").concat(n,"%)")}toHsla(){const[e,r,n,s]=QO(...this.getSource());return"hsla(".concat(e,",").concat(r,"%,").concat(n,"%,").concat(s,")")}toHex(){return this.toHexa().slice(0,6)}toHexa(){const[e,r,n,s]=this.getSource();return"".concat(zp(e)).concat(zp(r)).concat(zp(n)).concat(zp(Math.round(255*s)))}getAlpha(){return this.getSource()[3]}setAlpha(e){return this._source[3]=e,this}toGrayscale(){return this.setSource(ZO(this.getSource())),this}toBlackWhite(e){const[r,,,n]=ZO(this.getSource()),s=r<(e||127)?0:255;return this.setSource([s,s,s,n]),this}overlayWith(e){e instanceof _r||(e=new _r(e));const r=this.getSource(),n=e.getSource(),[s,i,o]=r.map((a,l)=>Math.round(.5*a+.5*n[l]));return this.setSource([s,i,o,r[3]]),this}static fromRgb(e){return _r.fromRgba(e)}static fromRgba(e){return new _r(_r.sourceFromRgb(e))}static sourceFromRgb(e){const r=e.match(/^rgba?\(\s*(\d{0,3}(?:\.\d+)?%?)\s*[\s|,]\s*(\d{0,3}(?:\.\d+)?%?)\s*[\s|,]\s*(\d{0,3}(?:\.\d+)?%?)\s*(?:\s*[,/]\s*(\d{0,3}(?:\.\d+)?%?)\s*)?\)$/i);if(r){const[n,s,i]=r.slice(1,4).map(o=>{const a=parseFloat(o);return o.endsWith("%")?Math.round(2.55*a):a});return[n,s,i,JO(r[4])]}}static fromHsl(e){return _r.fromHsla(e)}static fromHsla(e){return new _r(_r.sourceFromHsl(e))}static sourceFromHsl(e){const r=e.match(/^hsla?\(\s*([+-]?\d{0,3}(?:\.\d+)?(?:deg|turn|rad)?)\s*[\s|,]\s*(\d{0,3}(?:\.\d+)?%?)\s*[\s|,]\s*(\d{0,3}(?:\.\d+)?%?)\s*(?:\s*[,/]\s*(\d*(?:\.\d+)?%?)\s*)?\)$/i);if(!r)return;const n=(_r.parseAngletoDegrees(r[1])%360+360)%360/360,s=parseFloat(r[2])/100,i=parseFloat(r[3])/100;let o,a,l;if(s===0)o=a=l=i;else{const c=i<=.5?i*(s+1):i+s-i*s,u=2*i-c;o=kv(u,c,n+1/3),a=kv(u,c,n),l=kv(u,c,n-1/3)}return[Math.round(255*o),Math.round(255*a),Math.round(255*l),JO(r[4])]}static fromHex(e){return new _r(_r.sourceFromHex(e))}static sourceFromHex(e){if(e.match(/^#?(([0-9a-f]){3,4}|([0-9a-f]{2}){3,4})$/i)){const r=e.slice(e.indexOf("#")+1);let n;n=r.length<=4?r.split("").map(l=>l+l):r.match(/.{2}/g);const[s,i,o,a=255]=n.map(l=>parseInt(l,16));return[s,i,o,a/255]}}static parseAngletoDegrees(e){const r=e.toLowerCase(),n=parseFloat(r);return r.includes("rad")?Uo(n):r.includes("turn")?360*n:n}}const ou=function(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Vb;const r=/\D{0,2}$/.exec(t),n=parseFloat(t),s=dr.DPI;switch(r==null?void 0:r[0]){case"mm":return n*s/25.4;case"cm":return n*s/2.54;case"in":return n*s;case"pt":return n*s/72;case"pc":return n*s/72*12;case"em":return n*e;default:return n}},zX=t=>{const[e,r]=t.trim().split(" "),[n,s]=(i=e)&&i!==gs?[i.slice(1,4),i.slice(5,8)]:i===gs?[i,i]:["Mid","Mid"];var i;return{meetOrSlice:r||"meet",alignX:n,alignY:s}},Hh=function(t,e){let r,n,s=!(arguments.length>2&&arguments[2]!==void 0)||arguments[2];if(e)if(e.toLive)r="url(#SVGID_".concat(e.id,")");else{const i=new _r(e),o=i.getAlpha();r=i.toRgb(),o!==1&&(n=o.toString())}else r="none";return s?"".concat(t,": ").concat(r,"; ").concat(n?"".concat(t,"-opacity: ").concat(n,"; "):""):"".concat(t,'="').concat(r,'" ').concat(n?"".concat(t,'-opacity="').concat(n,'" '):"")};class Jz{getSvgStyles(e){const r=this.fillRule?this.fillRule:"nonzero",n=this.strokeWidth?this.strokeWidth:"0",s=this.strokeDashArray?this.strokeDashArray.join(" "):gs,i=this.strokeDashOffset?this.strokeDashOffset:"0",o=this.strokeLineCap?this.strokeLineCap:"butt",a=this.strokeLineJoin?this.strokeLineJoin:"miter",l=this.strokeMiterLimit?this.strokeMiterLimit:"4",c=this.opacity!==void 0?this.opacity:"1",u=this.visible?"":" visibility: hidden;",d=e?"":this.getSvgFilter(),h=Hh(xn,this.fill);return[Hh(_s,this.stroke),"stroke-width: ",n,"; ","stroke-dasharray: ",s,"; ","stroke-linecap: ",o,"; ","stroke-dashoffset: ",i,"; ","stroke-linejoin: ",a,"; ","stroke-miterlimit: ",l,"; ",h,"fill-rule: ",r,"; ","opacity: ",c,";",d,u].join("")}getSvgFilter(){return this.shadow?"filter: url(#SVGID_".concat(this.shadow.id,");"):""}getSvgCommons(){return[this.id?'id="'.concat(this.id,'" '):"",this.clipPath?'clip-path="url(#'.concat(this.clipPath.clipPathId,')" '):""].join("")}getSvgTransform(e){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"";const n=e?this.calcTransformMatrix():this.calcOwnMatrix(),s='transform="'.concat(Gh(n));return"".concat(s).concat(r,'" ')}_toSVG(e){return[""]}toSVG(e){return this._createBaseSVGMarkup(this._toSVG(e),{reviver:e})}toClipPathSVG(e){return"	"+this._createBaseClipPathSVGMarkup(this._toSVG(e),{reviver:e})}_createBaseClipPathSVGMarkup(e){let{reviver:r,additionalTransform:n=""}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const s=[this.getSvgTransform(!0,n),this.getSvgCommons()].join(""),i=e.indexOf("COMMON_PARTS");return e[i]=s,r?r(e.join("")):e.join("")}_createBaseSVGMarkup(e){let{noStyle:r,reviver:n,withShadow:s,additionalTransform:i}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const o=r?"":'style="'.concat(this.getSvgStyles(),'" '),a=s?'style="'.concat(this.getSvgFilter(),'" '):"",l=this.clipPath,c=this.strokeUniform?'vector-effect="non-scaling-stroke" ':"",u=l&&l.absolutePositioned,d=this.stroke,h=this.fill,f=this.shadow,p=[],m=e.indexOf("COMMON_PARTS");let y;l&&(l.clipPathId="CLIPPATH_".concat(Wa()),y='<clipPath id="'.concat(l.clipPathId,`" >
`).concat(l.toClipPathSVG(n),`</clipPath>
`)),u&&p.push("<g ",a,this.getSvgCommons(),` >
`),p.push("<g ",this.getSvgTransform(!1),u?"":a+this.getSvgCommons(),` >
`);const g=[o,c,r?"":this.addPaintOrder()," ",i?'transform="'.concat(i,'" '):""].join("");return e[m]=g,ei(h)&&p.push(h.toSVG(this)),ei(d)&&p.push(d.toSVG(this)),f&&p.push(f.toSVG(this)),l&&p.push(y),p.push(e.join("")),p.push(`</g>
`),u&&p.push(`</g>
`),n?n(p.join("")):p.join("")}addPaintOrder(){return this.paintFirst!==xn?' paint-order="'.concat(this.paintFirst,'" '):""}}function T_(t){return new RegExp("^("+t.join("|")+")\\b","i")}var eD,tD,rD;const Di=String.raw(eD||(eD=go(["[-+]?(?:d*.d+|d+.?)(?:[eE][-+]?d+)?"],["[-+]?(?:\\d*\\.\\d+|\\d+\\.?)(?:[eE][-+]?\\d+)?"]))),Av=String.raw(tD||(tD=go(["(?:s*,?s+|s*,s*)"],["(?:\\s*,?\\s+|\\s*,\\s*)"]))),BX=new RegExp("(normal|italic)?\\s*(normal|small-caps)?\\s*(normal|bold|bolder|lighter|100|200|300|400|500|600|700|800|900)?\\s*("+Di+"(?:px|cm|mm|em|pt|pc|in)*)(?:\\/(normal|"+Di+"))?\\s+(.*)"),VX={cx:pr,x:pr,r:"radius",cy:ms,y:ms,display:"visible",visibility:"visible",transform:"transformMatrix","fill-opacity":"fillOpacity","fill-rule":"fillRule","font-family":"fontFamily","font-size":"fontSize","font-style":"fontStyle","font-weight":"fontWeight","letter-spacing":"charSpacing","paint-order":"paintFirst","stroke-dasharray":"strokeDashArray","stroke-dashoffset":"strokeDashOffset","stroke-linecap":"strokeLineCap","stroke-linejoin":"strokeLineJoin","stroke-miterlimit":"strokeMiterLimit","stroke-opacity":"strokeOpacity","stroke-width":"strokeWidth","text-decoration":"textDecoration","text-anchor":"textAnchor",opacity:"opacity","clip-path":"clipPath","clip-rule":"clipRule","vector-effect":"strokeUniform","image-rendering":"imageSmoothing"},$v="font-size",Ov="clip-path";T_(["path","circle","polygon","polyline","ellipse","rect","line","image","text"]);T_(["symbol","image","marker","pattern","view","svg"]);const nD=T_(["symbol","g","a","svg","clipPath","defs"]);new RegExp(String.raw(rD||(rD=go(["^s*(",")","(",")","(",")","(",")s*$"],["^\\s*(",")","(",")","(",")","(",")\\s*$"])),Di,Av,Di,Av,Di,Av,Di));const WX=new Ce(1,0),Zz=new Ce,eB=(t,e)=>t.rotate(e),Sx=(t,e)=>new Ce(e).subtract(t),Ex=t=>t.distanceFrom(Zz),Px=(t,e)=>Math.atan2(mh(t,e),GX(t,e)),UX=t=>Px(WX,t),Qb=t=>t.eq(Zz)?t:t.scalarDivide(Ex(t)),tB=function(t){let e=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];return Qb(new Ce(-t.y,t.x).scalarMultiply(e?1:-1))},mh=(t,e)=>t.x*e.y-t.y*e.x,GX=(t,e)=>t.x*e.x+t.y*e.y,sD=(t,e,r)=>{if(t.eq(e)||t.eq(r))return!0;const n=mh(e,r),s=mh(e,t),i=mh(r,t);return n>=0?s>=0&&i<=0:!(s<=0&&i>=0)},iD="(-?\\d+(?:\\.\\d*)?(?:px)?(?:\\s?|$))?",oD=new RegExp("(?:\\s|^)"+iD+iD+"("+Di+"?(?:px)?)?(?:\\s?|$)(?:$|\\s)");class Io{constructor(e){const r=typeof e=="string"?Io.parseShadow(e):e;Object.assign(this,Io.ownDefaults,r),this.id=Wa()}static parseShadow(e){const r=e.trim(),[,n=0,s=0,i=0]=(oD.exec(r)||[]).map(o=>parseFloat(o)||0);return{color:(r.replace(oD,"")||"rgb(0,0,0)").trim(),offsetX:n,offsetY:s,blur:i}}toString(){return[this.offsetX,this.offsetY,this.blur,this.color].join("px ")}toSVG(e){const r=eB(new Ce(this.offsetX,this.offsetY),nn(-e.angle)),n=new _r(this.color);let s=40,i=40;return e.width&&e.height&&(s=100*Fr((Math.abs(r.x)+this.blur)/e.width,dr.NUM_FRACTION_DIGITS)+20,i=100*Fr((Math.abs(r.y)+this.blur)/e.height,dr.NUM_FRACTION_DIGITS)+20),e.flipX&&(r.x*=-1),e.flipY&&(r.y*=-1),'<filter id="SVGID_'.concat(this.id,'" y="-').concat(i,'%" height="').concat(100+2*i,'%" x="-').concat(s,'%" width="').concat(100+2*s,`%" >
	<feGaussianBlur in="SourceAlpha" stdDeviation="`).concat(Fr(this.blur?this.blur/2:0,dr.NUM_FRACTION_DIGITS),`"></feGaussianBlur>
	<feOffset dx="`).concat(Fr(r.x,dr.NUM_FRACTION_DIGITS),'" dy="').concat(Fr(r.y,dr.NUM_FRACTION_DIGITS),`" result="oBlur" ></feOffset>
	<feFlood flood-color="`).concat(n.toRgb(),'" flood-opacity="').concat(n.getAlpha(),`"/>
	<feComposite in2="oBlur" operator="in" />
	<feMerge>
		<feMergeNode></feMergeNode>
		<feMergeNode in="SourceGraphic"></feMergeNode>
	</feMerge>
</filter>
`)}toObject(){const e={color:this.color,blur:this.blur,offsetX:this.offsetX,offsetY:this.offsetY,affectStroke:this.affectStroke,nonScaling:this.nonScaling,type:this.constructor.type},r=Io.ownDefaults;return this.includeDefaultValues?e:Xb(e,(n,s)=>n!==r[s])}static async fromObject(e){return new this(e)}}fe(Io,"ownDefaults",{color:"rgb(0,0,0)",blur:0,offsetX:0,offsetY:0,affectStroke:!1,includeDefaultValues:!0,nonScaling:!1}),fe(Io,"type","shadow"),ht.setClass(Io,"shadow");const Au=(t,e,r)=>Math.max(t,Math.min(e,r)),HX=[ms,pr,vs,oi,"flipX","flipY","originX","originY","angle","opacity","globalCompositeOperation","shadow","visible",Bu,Vu],Ko=[xn,_s,"strokeWidth","strokeDashArray","width","height","paintFirst","strokeUniform","strokeLineCap","strokeDashOffset","strokeLineJoin","strokeMiterLimit","backgroundColor","clipPath"],KX={top:0,left:0,width:0,height:0,angle:0,flipX:!1,flipY:!1,scaleX:1,scaleY:1,minScaleLimit:0,skewX:0,skewY:0,originX:pr,originY:ms,strokeWidth:1,strokeUniform:!1,padding:0,opacity:1,paintFirst:xn,fill:"rgb(0,0,0)",fillRule:"nonzero",stroke:null,strokeDashArray:null,strokeDashOffset:0,strokeLineCap:"butt",strokeLineJoin:"miter",strokeMiterLimit:4,globalCompositeOperation:"source-over",backgroundColor:"",shadow:null,visible:!0,includeDefaultValues:!0,excludeFromExport:!1,objectCaching:!0,clipPath:void 0,inverted:!1,absolutePositioned:!1,centeredRotation:!0,centeredScaling:!1,dirty:!0},XX=(t,e,r,n)=>-r*Math.cos(t/n*af)+r+e,qX=()=>!1;class Jb{constructor(e){let{startValue:r,byValue:n,duration:s=500,delay:i=0,easing:o=XX,onStart:a=Lm,onChange:l=Lm,onComplete:c=Lm,abort:u=qX,target:d}=e;fe(this,"_state","pending"),fe(this,"durationProgress",0),fe(this,"valueProgress",0),this.tick=this.tick.bind(this),this.duration=s,this.delay=i,this.easing=o,this._onStart=a,this._onChange=l,this._onComplete=c,this._abort=u,this.target=d,this.startValue=r,this.byValue=n,this.value=this.startValue,this.endValue=Object.freeze(this.calculate(this.duration).value)}get state(){return this._state}isDone(){return this._state==="aborted"||this._state==="completed"}start(){const e=r=>{this._state==="pending"&&(this.startTime=r||+new Date,this._state="running",this._onStart(),this.tick(this.startTime))};this.register(),this.delay>0?setTimeout(()=>jm(e),this.delay):jm(e)}tick(e){const r=(e||+new Date)-this.startTime,n=Math.min(r,this.duration);this.durationProgress=n/this.duration;const{value:s,valueProgress:i}=this.calculate(n);this.value=Object.freeze(s),this.valueProgress=i,this._state!=="aborted"&&(this._abort(this.value,this.valueProgress,this.durationProgress)?(this._state="aborted",this.unregister()):r>=this.duration?(this.durationProgress=this.valueProgress=1,this._onChange(this.endValue,this.valueProgress,this.durationProgress),this._state="completed",this._onComplete(this.endValue,this.valueProgress,this.durationProgress),this.unregister()):(this._onChange(this.value,this.valueProgress,this.durationProgress),jm(this.tick)))}register(){Ag.push(this)}unregister(){Ag.remove(this)}abort(){this._state="aborted",this.unregister()}}const YX=["startValue","endValue"];class QX extends Jb{constructor(e){let{startValue:r=0,endValue:n=100}=e;super(ge(ge({},Lr(e,YX)),{},{startValue:r,byValue:n-r}))}calculate(e){const r=this.easing(e,this.startValue,this.byValue,this.duration);return{value:r,valueProgress:Math.abs((r-this.startValue)/this.byValue)}}}const JX=["startValue","endValue"];class ZX extends Jb{constructor(e){let{startValue:r=[0],endValue:n=[100]}=e;super(ge(ge({},Lr(e,JX)),{},{startValue:r,byValue:n.map((s,i)=>s-r[i])}))}calculate(e){const r=this.startValue.map((n,s)=>this.easing(e,n,this.byValue[s],this.duration,s));return{value:r,valueProgress:Math.abs((r[0]-this.startValue[0])/this.byValue[0])}}}const eq=["startValue","endValue","easing","onChange","onComplete","abort"],tq=(t,e,r,n)=>e+r*(1-Math.cos(t/n*af)),Dv=t=>t&&((e,r,n)=>t(new _r(e).toRgba(),r,n));class rq extends Jb{constructor(e){let{startValue:r,endValue:n,easing:s=tq,onChange:i,onComplete:o,abort:a}=e,l=Lr(e,eq);const c=new _r(r).getSource(),u=new _r(n).getSource();super(ge(ge({},l),{},{startValue:c,byValue:u.map((d,h)=>d-c[h]),easing:s,onChange:Dv(i),onComplete:Dv(o),abort:Dv(a)}))}calculate(e){const[r,n,s,i]=this.startValue.map((a,l)=>this.easing(e,a,this.byValue[l],this.duration,l)),o=[...[r,n,s].map(Math.round),Au(0,i,1)];return{value:o,valueProgress:o.map((a,l)=>this.byValue[l]!==0?Math.abs((a-this.startValue[l])/this.byValue[l]):0).find(a=>a!==0)||0}}}function rB(t){const e=(r=>Array.isArray(r.startValue)||Array.isArray(r.endValue))(t)?new ZX(t):new QX(t);return e.start(),e}function nq(t){const e=new rq(t);return e.start(),e}class Nr{constructor(e){this.status=e,this.points=[]}includes(e){return this.points.some(r=>r.eq(e))}append(){for(var e=arguments.length,r=new Array(e),n=0;n<e;n++)r[n]=arguments[n];return this.points=this.points.concat(r.filter(s=>!this.includes(s))),this}static isPointContained(e,r,n){let s=arguments.length>3&&arguments[3]!==void 0&&arguments[3];if(r.eq(n))return e.eq(r);if(r.x===n.x)return e.x===r.x&&(s||e.y>=Math.min(r.y,n.y)&&e.y<=Math.max(r.y,n.y));if(r.y===n.y)return e.y===r.y&&(s||e.x>=Math.min(r.x,n.x)&&e.x<=Math.max(r.x,n.x));{const i=Sx(r,n),o=Sx(r,e).divide(i);return s?Math.abs(o.x)===Math.abs(o.y):o.x===o.y&&o.x>=0&&o.x<=1}}static isPointInPolygon(e,r){const n=new Ce(e).setX(Math.min(e.x-1,...r.map(i=>i.x)));let s=0;for(let i=0;i<r.length;i++){const o=this.intersectSegmentSegment(r[i],r[(i+1)%r.length],e,n);if(o.includes(e))return!0;s+=+(o.status==="Intersection")}return s%2==1}static intersectLineLine(e,r,n,s){let i=!(arguments.length>4&&arguments[4]!==void 0)||arguments[4],o=!(arguments.length>5&&arguments[5]!==void 0)||arguments[5];const a=r.x-e.x,l=r.y-e.y,c=s.x-n.x,u=s.y-n.y,d=e.x-n.x,h=e.y-n.y,f=c*h-u*d,p=a*h-l*d,m=u*a-c*l;if(m!==0){const y=f/m,g=p/m;return(i||0<=y&&y<=1)&&(o||0<=g&&g<=1)?new Nr("Intersection").append(new Ce(e.x+y*a,e.y+y*l)):new Nr}if(f===0||p===0){const y=i||o||Nr.isPointContained(e,n,s)||Nr.isPointContained(r,n,s)||Nr.isPointContained(n,e,r)||Nr.isPointContained(s,e,r);return new Nr(y?"Coincident":void 0)}return new Nr("Parallel")}static intersectSegmentLine(e,r,n,s){return Nr.intersectLineLine(e,r,n,s,!1,!0)}static intersectSegmentSegment(e,r,n,s){return Nr.intersectLineLine(e,r,n,s,!1,!1)}static intersectLinePolygon(e,r,n){let s=!(arguments.length>3&&arguments[3]!==void 0)||arguments[3];const i=new Nr,o=n.length;for(let a,l,c,u=0;u<o;u++){if(a=n[u],l=n[(u+1)%o],c=Nr.intersectLineLine(e,r,a,l,s,!1),c.status==="Coincident")return c;i.append(...c.points)}return i.points.length>0&&(i.status="Intersection"),i}static intersectSegmentPolygon(e,r,n){return Nr.intersectLinePolygon(e,r,n,!1)}static intersectPolygonPolygon(e,r){const n=new Nr,s=e.length,i=[];for(let o=0;o<s;o++){const a=e[o],l=e[(o+1)%s],c=Nr.intersectSegmentPolygon(a,l,r);c.status==="Coincident"?(i.push(c),n.append(a,l)):n.append(...c.points)}return i.length>0&&i.length===e.length?new Nr("Coincident"):(n.points.length>0&&(n.status="Intersection"),n)}static intersectPolygonRectangle(e,r,n){const s=r.min(n),i=r.max(n),o=new Ce(i.x,s.y),a=new Ce(s.x,i.y);return Nr.intersectPolygonPolygon(e,[s,o,i,a])}}class sq extends Lz{getX(){return this.getXY().x}setX(e){this.setXY(this.getXY().setX(e))}getY(){return this.getXY().y}setY(e){this.setXY(this.getXY().setY(e))}getRelativeX(){return this.left}setRelativeX(e){this.left=e}getRelativeY(){return this.top}setRelativeY(e){this.top=e}getXY(){const e=this.getRelativeXY();return this.group?ls(e,this.group.calcTransformMatrix()):e}setXY(e,r,n){this.group&&(e=ls(e,Oi(this.group.calcTransformMatrix()))),this.setRelativeXY(e,r,n)}getRelativeXY(){return new Ce(this.left,this.top)}setRelativeXY(e){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.originX,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:this.originY;this.setPositionByOrigin(e,r,n)}isStrokeAccountedForInDimensions(){return!1}getCoords(){const{tl:e,tr:r,br:n,bl:s}=this.aCoords||(this.aCoords=this.calcACoords()),i=[e,r,n,s];if(this.group){const o=this.group.calcTransformMatrix();return i.map(a=>ls(a,o))}return i}intersectsWithRect(e,r){return Nr.intersectPolygonRectangle(this.getCoords(),e,r).status==="Intersection"}intersectsWithObject(e){const r=Nr.intersectPolygonPolygon(this.getCoords(),e.getCoords());return r.status==="Intersection"||r.status==="Coincident"||e.isContainedWithinObject(this)||this.isContainedWithinObject(e)}isContainedWithinObject(e){return this.getCoords().every(r=>e.containsPoint(r))}isContainedWithinRect(e,r){const{left:n,top:s,width:i,height:o}=this.getBoundingRect();return n>=e.x&&n+i<=r.x&&s>=e.y&&s+o<=r.y}isOverlapping(e){return this.intersectsWithObject(e)||this.isContainedWithinObject(e)||e.isContainedWithinObject(this)}containsPoint(e){return Nr.isPointInPolygon(e,this.getCoords())}isOnScreen(){if(!this.canvas)return!1;const{tl:e,br:r}=this.canvas.vptCoords;return!!this.getCoords().some(n=>n.x<=r.x&&n.x>=e.x&&n.y<=r.y&&n.y>=e.y)||!!this.intersectsWithRect(e,r)||this.containsPoint(e.midPointFrom(r))}isPartiallyOnScreen(){if(!this.canvas)return!1;const{tl:e,br:r}=this.canvas.vptCoords;return this.intersectsWithRect(e,r)?!0:this.getCoords().every(n=>(n.x>=r.x||n.x<=e.x)&&(n.y>=r.y||n.y<=e.y))&&this.containsPoint(e.midPointFrom(r))}getBoundingRect(){return Do(this.getCoords())}getScaledWidth(){return this._getTransformedDimensions().x}getScaledHeight(){return this._getTransformedDimensions().y}scale(e){this._set(vs,e),this._set(oi,e),this.setCoords()}scaleToWidth(e){const r=this.getBoundingRect().width/this.getScaledWidth();return this.scale(e/this.width/r)}scaleToHeight(e){const r=this.getBoundingRect().height/this.getScaledHeight();return this.scale(e/this.height/r)}getCanvasRetinaScaling(){var e;return((e=this.canvas)===null||e===void 0?void 0:e.getRetinaScaling())||1}getTotalAngle(){return this.group?Uo(Nz(this.calcTransformMatrix())):this.angle}getViewportTransform(){var e;return((e=this.canvas)===null||e===void 0?void 0:e.viewportTransform)||rs.concat()}calcACoords(){const e=Wu({angle:this.angle}),{x:r,y:n}=this.getRelativeCenterPoint(),s=lf(r,n),i=In(s,e),o=this._getTransformedDimensions(),a=o.x/2,l=o.y/2;return{tl:ls({x:-a,y:-l},i),tr:ls({x:a,y:-l},i),bl:ls({x:-a,y:l},i),br:ls({x:a,y:l},i)}}setCoords(){this.aCoords=this.calcACoords()}transformMatrixKey(){let e=arguments.length>0&&arguments[0]!==void 0&&arguments[0],r=[];return!e&&this.group&&(r=this.group.transformMatrixKey(e)),r.push(this.top,this.left,this.width,this.height,this.scaleX,this.scaleY,this.angle,this.strokeWidth,this.skewX,this.skewY,+this.flipX,+this.flipY,dn(this.originX),dn(this.originY)),r}calcTransformMatrix(){let e=arguments.length>0&&arguments[0]!==void 0&&arguments[0],r=this.calcOwnMatrix();if(e||!this.group)return r;const n=this.transformMatrixKey(e),s=this.matrixCache;return s&&s.key.every((i,o)=>i===n[o])?s.value:(this.group&&(r=In(this.group.calcTransformMatrix(!1),r)),this.matrixCache={key:n,value:r},r)}calcOwnMatrix(){const e=this.transformMatrixKey(!0),r=this.ownMatrixCache;if(r&&r.key===e)return r.value;const n=this.getRelativeCenterPoint(),s={angle:this.angle,translateX:n.x,translateY:n.y,scaleX:this.scaleX,scaleY:this.scaleY,skewX:this.skewX,skewY:this.skewY,flipX:this.flipX,flipY:this.flipY},i=kX(s);return this.ownMatrixCache={key:e,value:i},i}_getNonTransformedDimensions(){return new Ce(this.width,this.height).scalarAdd(this.strokeWidth)}_calculateCurrentDimensions(e){return this._getTransformedDimensions(e).transform(this.getViewportTransform(),!0).scalarAdd(2*this.padding)}_getTransformedDimensions(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const r=ge({scaleX:this.scaleX,scaleY:this.scaleY,skewX:this.skewX,skewY:this.skewY,width:this.width,height:this.height,strokeWidth:this.strokeWidth},e),n=r.strokeWidth;let s=n,i=0;this.strokeUniform&&(s=0,i=n);const o=r.width+s,a=r.height+s;let l;return l=r.skewX===0&&r.skewY===0?new Ce(o*r.scaleX,a*r.scaleY):qb(o,a,x_(r)),l.scalarAdd(i)}translateToGivenOrigin(e,r,n,s,i){let o=e.x,a=e.y;const l=dn(s)-dn(r),c=dn(i)-dn(n);if(l||c){const u=this._getTransformedDimensions();o+=l*u.x,a+=c*u.y}return new Ce(o,a)}translateToCenterPoint(e,r,n){if(r===Wt&&n===Wt)return e;const s=this.translateToGivenOrigin(e,r,n,Wt,Wt);return this.angle?s.rotate(nn(this.angle),e):s}translateToOriginPoint(e,r,n){const s=this.translateToGivenOrigin(e,Wt,Wt,r,n);return this.angle?s.rotate(nn(this.angle),e):s}getCenterPoint(){const e=this.getRelativeCenterPoint();return this.group?ls(e,this.group.calcTransformMatrix()):e}getRelativeCenterPoint(){return this.translateToCenterPoint(new Ce(this.left,this.top),this.originX,this.originY)}getPointByOrigin(e,r){return this.translateToOriginPoint(this.getRelativeCenterPoint(),e,r)}setPositionByOrigin(e,r,n){const s=this.translateToCenterPoint(e,r,n),i=this.translateToOriginPoint(s,this.originX,this.originY);this.set({left:i.x,top:i.y})}_getLeftTopCoords(){return this.translateToOriginPoint(this.getRelativeCenterPoint(),pr,ms)}}const iq=["type"],oq=["extraParam"];let bo=class zm extends sq{static getDefaults(){return zm.ownDefaults}get type(){const e=this.constructor.type;return e==="FabricObject"?"object":e.toLowerCase()}set type(e){Va("warn","Setting type has no effect",e)}constructor(e){super(),fe(this,"_cacheContext",null),Object.assign(this,zm.ownDefaults),this.setOptions(e)}_createCacheCanvas(){this._cacheCanvas=Wo(),this._cacheContext=this._cacheCanvas.getContext("2d"),this._updateCacheCanvas(),this.dirty=!0}_limitCacheSize(e){const r=e.width,n=e.height,s=dr.maxCacheSideLimit,i=dr.minCacheSideLimit;if(r<=s&&n<=s&&r*n<=dr.perfLimitSizeTotal)return r<i&&(e.width=i),n<i&&(e.height=i),e;const o=r/n,[a,l]=ph.limitDimsByArea(o),c=Au(i,a,s),u=Au(i,l,s);return r>c&&(e.zoomX/=r/c,e.width=c,e.capped=!0),n>u&&(e.zoomY/=n/u,e.height=u,e.capped=!0),e}_getCacheCanvasDimensions(){const e=this.getTotalObjectScaling(),r=this._getTransformedDimensions({skewX:0,skewY:0}),n=r.x*e.x/this.scaleX,s=r.y*e.y/this.scaleY;return{width:Math.ceil(n+2),height:Math.ceil(s+2),zoomX:e.x,zoomY:e.y,x:n,y:s}}_updateCacheCanvas(){const e=this._cacheCanvas,r=this._cacheContext,{width:n,height:s,zoomX:i,zoomY:o,x:a,y:l}=this._limitCacheSize(this._getCacheCanvasDimensions()),c=n!==e.width||s!==e.height,u=this.zoomX!==i||this.zoomY!==o;if(!e||!r)return!1;if(c||u){n!==e.width||s!==e.height?(e.width=n,e.height=s):(r.setTransform(1,0,0,1,0,0),r.clearRect(0,0,e.width,e.height));const d=a/2,h=l/2;return this.cacheTranslationX=Math.round(e.width/2-d)+d,this.cacheTranslationY=Math.round(e.height/2-h)+h,r.translate(this.cacheTranslationX,this.cacheTranslationY),r.scale(i,o),this.zoomX=i,this.zoomY=o,!0}return!1}setOptions(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this._setOptions(e)}transform(e){const r=this.group&&!this.group._transformDone||this.group&&this.canvas&&e===this.canvas.contextTop,n=this.calcTransformMatrix(!r);e.transform(n[0],n[1],n[2],n[3],n[4],n[5])}getObjectScaling(){if(!this.group)return new Ce(Math.abs(this.scaleX),Math.abs(this.scaleY));const e=$g(this.calcTransformMatrix());return new Ce(Math.abs(e.scaleX),Math.abs(e.scaleY))}getTotalObjectScaling(){const e=this.getObjectScaling();if(this.canvas){const r=this.canvas.getZoom(),n=this.getCanvasRetinaScaling();return e.scalarMultiply(r*n)}return e}getObjectOpacity(){let e=this.opacity;return this.group&&(e*=this.group.getObjectOpacity()),e}_constrainScale(e){return Math.abs(e)<this.minScaleLimit?e<0?-this.minScaleLimit:this.minScaleLimit:e===0?1e-4:e}_set(e,r){e!==vs&&e!==oi||(r=this._constrainScale(r)),e===vs&&r<0?(this.flipX=!this.flipX,r*=-1):e==="scaleY"&&r<0?(this.flipY=!this.flipY,r*=-1):e!=="shadow"||!r||r instanceof Io||(r=new Io(r));const n=this[e]!==r;return this[e]=r,n&&this.constructor.cacheProperties.includes(e)&&(this.dirty=!0),this.parent&&(this.dirty||n&&this.constructor.stateProperties.includes(e))&&this.parent._set("dirty",!0),this}isNotVisible(){return this.opacity===0||!this.width&&!this.height&&this.strokeWidth===0||!this.visible}render(e){this.isNotVisible()||this.canvas&&this.canvas.skipOffscreen&&!this.group&&!this.isOnScreen()||(e.save(),this._setupCompositeOperation(e),this.drawSelectionBackground(e),this.transform(e),this._setOpacity(e),this._setShadow(e),this.shouldCache()?(this.renderCache(),this.drawCacheOnCanvas(e)):(this._removeCacheCanvas(),this.drawObject(e,!1,{}),this.dirty=!1),e.restore())}drawSelectionBackground(e){}renderCache(e){if(e=e||{},this._cacheCanvas&&this._cacheContext||this._createCacheCanvas(),this.isCacheDirty()&&this._cacheContext){const{zoomX:r,zoomY:n,cacheTranslationX:s,cacheTranslationY:i}=this,{width:o,height:a}=this._cacheCanvas;this.drawObject(this._cacheContext,e.forClipping,{zoomX:r,zoomY:n,cacheTranslationX:s,cacheTranslationY:i,width:o,height:a,parentClipPaths:[]}),this.dirty=!1}}_removeCacheCanvas(){this._cacheCanvas=void 0,this._cacheContext=null}hasStroke(){return this.stroke&&this.stroke!=="transparent"&&this.strokeWidth!==0}hasFill(){return this.fill&&this.fill!=="transparent"}needsItsOwnCache(){return!!(this.paintFirst===_s&&this.hasFill()&&this.hasStroke()&&this.shadow)||!!this.clipPath}shouldCache(){return this.ownCaching=this.objectCaching&&(!this.parent||!this.parent.isOnACache())||this.needsItsOwnCache(),this.ownCaching}willDrawShadow(){return!!this.shadow&&(this.shadow.offsetX!==0||this.shadow.offsetY!==0)}drawClipPathOnCache(e,r,n){e.save(),r.inverted?e.globalCompositeOperation="destination-out":e.globalCompositeOperation="destination-in",e.setTransform(1,0,0,1,0,0),e.drawImage(n,0,0),e.restore()}drawObject(e,r,n){const s=this.fill,i=this.stroke;r?(this.fill="black",this.stroke="",this._setClippingProperties(e)):this._renderBackground(e),this._render(e),this._drawClipPath(e,this.clipPath,n),this.fill=s,this.stroke=i}createClipPathLayer(e,r){const n=ai(r),s=n.getContext("2d");if(s.translate(r.cacheTranslationX,r.cacheTranslationY),s.scale(r.zoomX,r.zoomY),e._cacheCanvas=n,r.parentClipPaths.forEach(i=>{i.transform(s)}),r.parentClipPaths.push(e),e.absolutePositioned){const i=Oi(this.calcTransformMatrix());s.transform(i[0],i[1],i[2],i[3],i[4],i[5])}return e.transform(s),e.drawObject(s,!0,r),n}_drawClipPath(e,r,n){if(!r)return;r._transformDone=!0;const s=this.createClipPathLayer(r,n);this.drawClipPathOnCache(e,r,s)}drawCacheOnCanvas(e){e.scale(1/this.zoomX,1/this.zoomY),e.drawImage(this._cacheCanvas,-this.cacheTranslationX,-this.cacheTranslationY)}isCacheDirty(){let e=arguments.length>0&&arguments[0]!==void 0&&arguments[0];if(this.isNotVisible())return!1;const r=this._cacheCanvas,n=this._cacheContext;return!(!r||!n||e||!this._updateCacheCanvas())||!!(this.dirty||this.clipPath&&this.clipPath.absolutePositioned)&&(r&&n&&!e&&(n.save(),n.setTransform(1,0,0,1,0,0),n.clearRect(0,0,r.width,r.height),n.restore()),!0)}_renderBackground(e){if(!this.backgroundColor)return;const r=this._getNonTransformedDimensions();e.fillStyle=this.backgroundColor,e.fillRect(-r.x/2,-r.y/2,r.x,r.y),this._removeShadow(e)}_setOpacity(e){this.group&&!this.group._transformDone?e.globalAlpha=this.getObjectOpacity():e.globalAlpha*=this.opacity}_setStrokeStyles(e,r){const n=r.stroke;n&&(e.lineWidth=r.strokeWidth,e.lineCap=r.strokeLineCap,e.lineDashOffset=r.strokeDashOffset,e.lineJoin=r.strokeLineJoin,e.miterLimit=r.strokeMiterLimit,ei(n)?n.gradientUnits==="percentage"||n.gradientTransform||n.patternTransform?this._applyPatternForTransformedGradient(e,n):(e.strokeStyle=n.toLive(e),this._applyPatternGradientTransform(e,n)):e.strokeStyle=r.stroke)}_setFillStyles(e,r){let{fill:n}=r;n&&(ei(n)?(e.fillStyle=n.toLive(e),this._applyPatternGradientTransform(e,n)):e.fillStyle=n)}_setClippingProperties(e){e.globalAlpha=1,e.strokeStyle="transparent",e.fillStyle="#000000"}_setLineDash(e,r){r&&r.length!==0&&e.setLineDash(r)}_setShadow(e){if(!this.shadow)return;const r=this.shadow,n=this.canvas,s=this.getCanvasRetinaScaling(),[i,,,o]=(n==null?void 0:n.viewportTransform)||rs,a=i*s,l=o*s,c=r.nonScaling?new Ce(1,1):this.getObjectScaling();e.shadowColor=r.color,e.shadowBlur=r.blur*dr.browserShadowBlurConstant*(a+l)*(c.x+c.y)/4,e.shadowOffsetX=r.offsetX*a*c.x,e.shadowOffsetY=r.offsetY*l*c.y}_removeShadow(e){this.shadow&&(e.shadowColor="",e.shadowBlur=e.shadowOffsetX=e.shadowOffsetY=0)}_applyPatternGradientTransform(e,r){if(!ei(r))return{offsetX:0,offsetY:0};const n=r.gradientTransform||r.patternTransform,s=-this.width/2+r.offsetX||0,i=-this.height/2+r.offsetY||0;return r.gradientUnits==="percentage"?e.transform(this.width,0,0,this.height,s,i):e.transform(1,0,0,1,s,i),n&&e.transform(n[0],n[1],n[2],n[3],n[4],n[5]),{offsetX:s,offsetY:i}}_renderPaintInOrder(e){this.paintFirst===_s?(this._renderStroke(e),this._renderFill(e)):(this._renderFill(e),this._renderStroke(e))}_render(e){}_renderFill(e){this.fill&&(e.save(),this._setFillStyles(e,this),this.fillRule==="evenodd"?e.fill("evenodd"):e.fill(),e.restore())}_renderStroke(e){if(this.stroke&&this.strokeWidth!==0){if(this.shadow&&!this.shadow.affectStroke&&this._removeShadow(e),e.save(),this.strokeUniform){const r=this.getObjectScaling();e.scale(1/r.x,1/r.y)}this._setLineDash(e,this.strokeDashArray),this._setStrokeStyles(e,this),e.stroke(),e.restore()}}_applyPatternForTransformedGradient(e,r){var n;const s=this._limitCacheSize(this._getCacheCanvasDimensions()),i=this.getCanvasRetinaScaling(),o=s.x/this.scaleX/i,a=s.y/this.scaleY/i,l=ai({width:Math.ceil(o),height:Math.ceil(a)}),c=l.getContext("2d");c&&(c.beginPath(),c.moveTo(0,0),c.lineTo(o,0),c.lineTo(o,a),c.lineTo(0,a),c.closePath(),c.translate(o/2,a/2),c.scale(s.zoomX/this.scaleX/i,s.zoomY/this.scaleY/i),this._applyPatternGradientTransform(c,r),c.fillStyle=r.toLive(e),c.fill(),e.translate(-this.width/2-this.strokeWidth/2,-this.height/2-this.strokeWidth/2),e.scale(i*this.scaleX/s.zoomX,i*this.scaleY/s.zoomY),e.strokeStyle=(n=c.createPattern(l,"no-repeat"))!==null&&n!==void 0?n:"")}_findCenterFromElement(){return new Ce(this.left+this.width/2,this.top+this.height/2)}clone(e){const r=this.toObject(e);return this.constructor.fromObject(r)}cloneAsImage(e){const r=this.toCanvasElement(e);return new(ht.getClass("image"))(r)}toCanvasElement(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const r=Kz(this),n=this.group,s=this.shadow,i=Math.abs,o=e.enableRetinaScaling?$z():1,a=(e.multiplier||1)*o,l=e.canvasProvider||(_=>new cf(_,{enableRetinaScaling:!1,renderOnAddRemove:!1,skipOffscreen:!1}));delete this.group,e.withoutTransform&&FX(this),e.withoutShadow&&(this.shadow=null),e.viewportTransform&&RX(this,this.getViewportTransform()),this.setCoords();const c=Wo(),u=this.getBoundingRect(),d=this.shadow,h=new Ce;if(d){const _=d.blur,v=d.nonScaling?new Ce(1,1):this.getObjectScaling();h.x=2*Math.round(i(d.offsetX)+_)*i(v.x),h.y=2*Math.round(i(d.offsetY)+_)*i(v.y)}const f=u.width+h.x,p=u.height+h.y;c.width=Math.ceil(f),c.height=Math.ceil(p);const m=l(c);e.format==="jpeg"&&(m.backgroundColor="#fff"),this.setPositionByOrigin(new Ce(m.width/2,m.height/2),Wt,Wt);const y=this.canvas;m._objects=[this],this.set("canvas",m),this.setCoords();const g=m.toCanvasElement(a||1,e);return this.set("canvas",y),this.shadow=s,n&&(this.group=n),this.set(r),this.setCoords(),m._objects=[],m.destroy(),g}toDataURL(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return Rz(this.toCanvasElement(e),e.format||"png",e.quality||1)}toBlob(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return jz(this.toCanvasElement(e),e.format||"png",e.quality||1)}isType(){for(var e=arguments.length,r=new Array(e),n=0;n<e;n++)r[n]=arguments[n];return r.includes(this.constructor.type)||r.includes(this.type)}complexity(){return 1}toJSON(){return this.toObject()}rotate(e){const{centeredRotation:r,originX:n,originY:s}=this;if(r){const{x:i,y:o}=this.getRelativeCenterPoint();this.originX=Wt,this.originY=Wt,this.left=i,this.top=o}if(this.set("angle",e),r){const{x:i,y:o}=this.translateToOriginPoint(this.getRelativeCenterPoint(),n,s);this.left=i,this.top=o,this.originX=n,this.originY=s}}setOnGroup(){}_setupCompositeOperation(e){this.globalCompositeOperation&&(e.globalCompositeOperation=this.globalCompositeOperation)}dispose(){Ag.cancelByTarget(this),this.off(),this._set("canvas",void 0),this._cacheCanvas&&po().dispose(this._cacheCanvas),this._cacheCanvas=void 0,this._cacheContext=null}animate(e,r){return Object.entries(e).reduce((n,s)=>{let[i,o]=s;return n[i]=this._animate(i,o,r),n},{})}_animate(e,r){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const s=e.split("."),i=this.constructor.colorProperties.includes(s[s.length-1]),{abort:o,startValue:a,onChange:l,onComplete:c}=n,u=ge(ge({},n),{},{target:this,startValue:a??s.reduce((d,h)=>d[h],this),endValue:r,abort:o==null?void 0:o.bind(this),onChange:(d,h,f)=>{s.reduce((p,m,y)=>(y===s.length-1&&(p[m]=d),p[m]),this),l&&l(d,h,f)},onComplete:(d,h,f)=>{this.setCoords(),c&&c(d,h,f)}});return i?nq(u):rB(u)}isDescendantOf(e){const{parent:r,group:n}=this;return r===e||n===e||!!r&&r.isDescendantOf(e)||!!n&&n!==r&&n.isDescendantOf(e)}getAncestors(){const e=[];let r=this;do r=r.parent,r&&e.push(r);while(r);return e}findCommonAncestors(e){if(this===e)return{fork:[],otherFork:[],common:[this,...this.getAncestors()]};const r=this.getAncestors(),n=e.getAncestors();if(r.length===0&&n.length>0&&this===n[n.length-1])return{fork:[],otherFork:[e,...n.slice(0,n.length-1)],common:[this]};for(let s,i=0;i<r.length;i++){if(s=r[i],s===e)return{fork:[this,...r.slice(0,i)],otherFork:[],common:r.slice(i)};for(let o=0;o<n.length;o++){if(this===n[o])return{fork:[],otherFork:[e,...n.slice(0,o)],common:[this,...r]};if(s===n[o])return{fork:[this,...r.slice(0,i)],otherFork:[e,...n.slice(0,o)],common:r.slice(i)}}}return{fork:[this,...r],otherFork:[e,...n],common:[]}}hasCommonAncestors(e){const r=this.findCommonAncestors(e);return r&&!!r.common.length}isInFrontOf(e){if(this===e)return;const r=this.findCommonAncestors(e);if(r.fork.includes(e))return!0;if(r.otherFork.includes(this))return!1;const n=r.common[0]||this.canvas;if(!n)return;const s=r.fork.pop(),i=r.otherFork.pop(),o=n._objects.indexOf(s),a=n._objects.indexOf(i);return o>-1&&o>a}toObject(){const e=(arguments.length>0&&arguments[0]!==void 0?arguments[0]:[]).concat(zm.customProperties,this.constructor.customProperties||[]);let r;const n=dr.NUM_FRACTION_DIGITS,{clipPath:s,fill:i,stroke:o,shadow:a,strokeDashArray:l,left:c,top:u,originX:d,originY:h,width:f,height:p,strokeWidth:m,strokeLineCap:y,strokeDashOffset:g,strokeLineJoin:_,strokeUniform:v,strokeMiterLimit:w,scaleX:x,scaleY:M,angle:T,flipX:S,flipY:k,opacity:$,visible:j,backgroundColor:V,fillRule:L,paintFirst:X,globalCompositeOperation:K,skewX:Y,skewY:J}=this;s&&!s.excludeFromExport&&(r=s.toObject(e.concat("inverted","absolutePositioned")));const N=te=>Fr(te,n),ne=ge(ge({},Uu(this,e)),{},{type:this.constructor.type,version:bx,originX:d,originY:h,left:N(c),top:N(u),width:N(f),height:N(p),fill:GO(i)?i.toObject():i,stroke:GO(o)?o.toObject():o,strokeWidth:N(m),strokeDashArray:l&&l.concat(),strokeLineCap:y,strokeDashOffset:g,strokeLineJoin:_,strokeUniform:v,strokeMiterLimit:N(w),scaleX:N(x),scaleY:N(M),angle:N(T),flipX:S,flipY:k,opacity:N($),shadow:a&&a.toObject(),visible:j,backgroundColor:V,fillRule:L,paintFirst:X,globalCompositeOperation:K,skewX:N(Y),skewY:N(J)},r?{clipPath:r}:null);return this.includeDefaultValues?ne:this._removeDefaultValues(ne)}toDatalessObject(e){return this.toObject(e)}_removeDefaultValues(e){const r=this.constructor.getDefaults(),n=Object.keys(r).length>0?r:Object.getPrototypeOf(this);return Xb(e,(s,i)=>{if(i===pr||i===ms||i==="type")return!0;const o=n[i];return s!==o&&!(Array.isArray(s)&&Array.isArray(o)&&s.length===0&&o.length===0)})}toString(){return"#<".concat(this.constructor.type,">")}static _fromObject(e){let r=Lr(e,iq),n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},{extraParam:s}=n,i=Lr(n,oq);return b_(r,i).then(o=>s?(delete o[s],new this(r[s],o)):new this(o))}static fromObject(e,r){return this._fromObject(e,r)}};fe(bo,"stateProperties",HX),fe(bo,"cacheProperties",Ko),fe(bo,"ownDefaults",KX),fe(bo,"type","FabricObject"),fe(bo,"colorProperties",[xn,_s,"backgroundColor"]),fe(bo,"customProperties",[]),ht.setClass(bo),ht.setClass(bo,"object");const Gu=(t,e,r)=>(n,s,i,o)=>{const a=e(n,s,i,o);return a&&Xz(t,ge(ge({},Yz(n,s,i,o)),r)),a};function Hu(t){return(e,r,n,s)=>{const{target:i,originX:o,originY:a}=r,l=i.getRelativeCenterPoint(),c=i.translateToOriginPoint(l,o,a),u=t(e,r,n,s);return i.setPositionByOrigin(c,r.originX,r.originY),u}}const aD=Gu(Wh,Hu((t,e,r,n)=>{const s=Yb(e,e.originX,e.originY,r,n);if(dn(e.originX)===dn(Wt)||dn(e.originX)===dn(tn)&&s.x<0||dn(e.originX)===dn(pr)&&s.x>0){const{target:i}=e,o=i.strokeWidth/(i.strokeUniform?i.scaleX:1),a=qz(e)?2:1,l=i.width,c=Math.abs(s.x*a/i.scaleX)-o;return i.set("width",Math.max(c,1)),l!==i.width}return!1}));function aq(t,e,r,n,s){n=n||{};const i=this.sizeX||n.cornerSize||s.cornerSize,o=this.sizeY||n.cornerSize||s.cornerSize,a=n.transparentCorners!==void 0?n.transparentCorners:s.transparentCorners,l=a?_s:xn,c=!a&&(n.cornerStrokeColor||s.cornerStrokeColor);let u,d=e,h=r;t.save(),t.fillStyle=n.cornerColor||s.cornerColor||"",t.strokeStyle=n.cornerStrokeColor||s.cornerStrokeColor||"",i>o?(u=i,t.scale(1,o/i),h=r*i/o):o>i?(u=o,t.scale(i/o,1),d=e*o/i):u=i,t.beginPath(),t.arc(d,h,u/2,0,Eg,!1),t[l](),c&&t.stroke(),t.restore()}function lq(t,e,r,n,s){n=n||{};const i=this.sizeX||n.cornerSize||s.cornerSize,o=this.sizeY||n.cornerSize||s.cornerSize,a=n.transparentCorners!==void 0?n.transparentCorners:s.transparentCorners,l=a?_s:xn,c=!a&&(n.cornerStrokeColor||s.cornerStrokeColor),u=i/2,d=o/2;t.save(),t.fillStyle=n.cornerColor||s.cornerColor||"",t.strokeStyle=n.cornerStrokeColor||s.cornerStrokeColor||"",t.translate(e,r);const h=s.getTotalAngle();t.rotate(nn(h)),t["".concat(l,"Rect")](-u,-d,i,o),c&&t.strokeRect(-u,-d,i,o),t.restore()}class xi{constructor(e){fe(this,"visible",!0),fe(this,"actionName",w_),fe(this,"angle",0),fe(this,"x",0),fe(this,"y",0),fe(this,"offsetX",0),fe(this,"offsetY",0),fe(this,"sizeX",0),fe(this,"sizeY",0),fe(this,"touchSizeX",0),fe(this,"touchSizeY",0),fe(this,"cursorStyle","crosshair"),fe(this,"withConnection",!1),Object.assign(this,e)}shouldActivate(e,r,n,s){var i;let{tl:o,tr:a,br:l,bl:c}=s;return((i=r.canvas)===null||i===void 0?void 0:i.getActiveObject())===r&&r.isControlVisible(e)&&Nr.isPointInPolygon(n,[o,a,l,c])}getActionHandler(e,r,n){return this.actionHandler}getMouseDownHandler(e,r,n){return this.mouseDownHandler}getMouseUpHandler(e,r,n){return this.mouseUpHandler}cursorStyleHandler(e,r,n){return r.cursorStyle}getActionName(e,r,n){return r.actionName}getVisibility(e,r){var n,s;return(n=(s=e._controlsVisibility)===null||s===void 0?void 0:s[r])!==null&&n!==void 0?n:this.visible}setVisibility(e,r,n){this.visible=e}positionHandler(e,r,n,s){return new Ce(this.x*e.x+this.offsetX,this.y*e.y+this.offsetY).transform(r)}calcCornerCoords(e,r,n,s,i,o){const a=Hb([lf(n,s),Wu({angle:e}),Kb((i?this.touchSizeX:this.sizeX)||r,(i?this.touchSizeY:this.sizeY)||r)]);return{tl:new Ce(-.5,-.5).transform(a),tr:new Ce(.5,-.5).transform(a),br:new Ce(.5,.5).transform(a),bl:new Ce(-.5,.5).transform(a)}}render(e,r,n,s,i){((s=s||{}).cornerStyle||i.cornerStyle)==="circle"?aq.call(this,e,r,n,s,i):lq.call(this,e,r,n,s,i)}}const cq=(t,e,r)=>r.lockRotation?Dg:e.cursorStyle,uq=Gu(Dz,Hu((t,e,r,n)=>{let{target:s,ex:i,ey:o,theta:a,originX:l,originY:c}=e;const u=s.translateToOriginPoint(s.getRelativeCenterPoint(),l,c);if(Ri(s,"lockRotation"))return!1;const d=Math.atan2(o-u.y,i-u.x),h=Math.atan2(n-u.y,r-u.x);let f=Uo(h-d+a);if(s.snapAngle&&s.snapAngle>0){const m=s.snapAngle,y=s.snapThreshold||m,g=Math.ceil(f/m)*m,_=Math.floor(f/m)*m;Math.abs(f-_)<y?f=_:Math.abs(f-g)<y&&(f=g)}f<0&&(f=360+f),f%=360;const p=s.angle!==f;return s.angle=f,p}));function nB(t,e){const r=e.canvas,n=t[r.uniScaleKey];return r.uniformScaling&&!n||!r.uniformScaling&&n}function sB(t,e,r){const n=Ri(t,"lockScalingX"),s=Ri(t,"lockScalingY");if(n&&s||!e&&(n||s)&&r||n&&e==="x"||s&&e==="y")return!0;const{width:i,height:o,strokeWidth:a}=t;return i===0&&a===0&&e!=="y"||o===0&&a===0&&e!=="x"}const dq=["e","se","s","sw","w","nw","n","ne","e"],th=(t,e,r)=>{const n=nB(t,r);if(sB(r,e.x!==0&&e.y===0?"x":e.x===0&&e.y!==0?"y":"",n))return Dg;const s=Qz(r,e);return"".concat(dq[s],"-resize")};function Zb(t,e,r,n){let s=arguments.length>4&&arguments[4]!==void 0?arguments[4]:{};const i=e.target,o=s.by,a=nB(t,i);let l,c,u,d,h,f;if(sB(i,o,a))return!1;if(e.gestureScale)c=e.scaleX*e.gestureScale,u=e.scaleY*e.gestureScale;else{if(l=Yb(e,e.originX,e.originY,r,n),h=o!=="y"?Math.sign(l.x||e.signX||1):1,f=o!=="x"?Math.sign(l.y||e.signY||1):1,e.signX||(e.signX=h),e.signY||(e.signY=f),Ri(i,"lockScalingFlip")&&(e.signX!==h||e.signY!==f))return!1;if(d=i._getTransformedDimensions(),a&&!o){const y=Math.abs(l.x)+Math.abs(l.y),{original:g}=e,_=y/(Math.abs(d.x*g.scaleX/i.scaleX)+Math.abs(d.y*g.scaleY/i.scaleY));c=g.scaleX*_,u=g.scaleY*_}else c=Math.abs(l.x*i.scaleX/d.x),u=Math.abs(l.y*i.scaleY/d.y);qz(e)&&(c*=2,u*=2),e.signX!==h&&o!=="y"&&(e.originX=qO(e.originX),c*=-1,e.signX=h),e.signY!==f&&o!=="x"&&(e.originY=qO(e.originY),u*=-1,e.signY=f)}const p=i.scaleX,m=i.scaleY;return o?(o==="x"&&i.set(vs,c),o==="y"&&i.set(oi,u)):(!Ri(i,"lockScalingX")&&i.set(vs,c),!Ri(i,"lockScalingY")&&i.set(oi,u)),p!==i.scaleX||m!==i.scaleY}const Bp=Gu(v_,Hu((t,e,r,n)=>Zb(t,e,r,n))),hq=Gu(v_,Hu((t,e,r,n)=>Zb(t,e,r,n,{by:"x"}))),fq=Gu(v_,Hu((t,e,r,n)=>Zb(t,e,r,n,{by:"y"}))),pq=["target","ex","ey","skewingSide"],Iv={x:{counterAxis:"y",scale:vs,skew:Bu,lockSkewing:"lockSkewingX",origin:"originX",flip:"flipX"},y:{counterAxis:"x",scale:oi,skew:Vu,lockSkewing:"lockSkewingY",origin:"originY",flip:"flipY"}},mq=["ns","nesw","ew","nwse"],gq=(t,e,r)=>{if(e.x!==0&&Ri(r,"lockSkewingY")||e.y!==0&&Ri(r,"lockSkewingX"))return Dg;const n=Qz(r,e)%4;return"".concat(mq[n],"-resize")};function iB(t,e,r,n,s){const{target:i}=r,{counterAxis:o,origin:a,lockSkewing:l,skew:c,flip:u}=Iv[t];if(Ri(i,l))return!1;const{origin:d,flip:h}=Iv[o],f=dn(r[d])*(i[h]?-1:1),p=-Math.sign(f)*(i[u]?-1:1),m=.5*-((i[c]===0&&Yb(r,Wt,Wt,n,s)[t]>0||i[c]>0?1:-1)*p)+.5;return Gu(Iz,Hu((g,_,v,w)=>function(x,M,T){let{target:S,ex:k,ey:$,skewingSide:j}=M,V=Lr(M,pq);const{skew:L}=Iv[x],X=T.subtract(new Ce(k,$)).divide(new Ce(S.scaleX,S.scaleY))[x],K=S[L],Y=V[L],J=Math.tan(nn(Y)),N=x==="y"?S._getTransformedDimensions({scaleX:1,scaleY:1,skewX:0}).x:S._getTransformedDimensions({scaleX:1,scaleY:1}).y,ne=2*X*j/Math.max(N,1)+J,te=Uo(Math.atan(ne));S.set(L,te);const z=K!==S[L];if(z&&x==="y"){const{skewX:O,scaleX:H}=S,re=S._getTransformedDimensions({skewY:K}),_e=S._getTransformedDimensions(),oe=O!==0?re.x/_e.x:1;oe!==1&&S.set(vs,oe*H)}return z}(t,_,new Ce(v,w))))(e,ge(ge({},r),{},{[a]:m,skewingSide:p}),n,s)}const _q=(t,e,r,n)=>iB("x",t,e,r,n),yq=(t,e,r,n)=>iB("y",t,e,r,n);function C_(t,e){return t[e.canvas.altActionKey]}const Vp=(t,e,r)=>{const n=C_(t,r);return e.x===0?n?Bu:oi:e.y===0?n?Vu:vs:""},Hc=(t,e,r)=>C_(t,r)?gq(0,e,r):th(t,e,r),lD=(t,e,r,n)=>C_(t,e.target)?yq(t,e,r,n):hq(t,e,r,n),cD=(t,e,r,n)=>C_(t,e.target)?_q(t,e,r,n):fq(t,e,r,n),oB=()=>({ml:new xi({x:-.5,y:0,cursorStyleHandler:Hc,actionHandler:lD,getActionName:Vp}),mr:new xi({x:.5,y:0,cursorStyleHandler:Hc,actionHandler:lD,getActionName:Vp}),mb:new xi({x:0,y:.5,cursorStyleHandler:Hc,actionHandler:cD,getActionName:Vp}),mt:new xi({x:0,y:-.5,cursorStyleHandler:Hc,actionHandler:cD,getActionName:Vp}),tl:new xi({x:-.5,y:-.5,cursorStyleHandler:th,actionHandler:Bp}),tr:new xi({x:.5,y:-.5,cursorStyleHandler:th,actionHandler:Bp}),bl:new xi({x:-.5,y:.5,cursorStyleHandler:th,actionHandler:Bp}),br:new xi({x:.5,y:.5,cursorStyleHandler:th,actionHandler:Bp}),mtr:new xi({x:0,y:-.5,actionHandler:uq,cursorStyleHandler:cq,offsetY:-40,withConnection:!0,actionName:Ub})}),vq=()=>({mr:new xi({x:.5,y:0,actionHandler:aD,cursorStyleHandler:Hc,actionName:Wh}),ml:new xi({x:-.5,y:0,actionHandler:aD,cursorStyleHandler:Hc,actionName:Wh})}),wq=()=>ge(ge({},oB()),vq());class Kh extends bo{static getDefaults(){return ge(ge({},super.getDefaults()),Kh.ownDefaults)}constructor(e){super(),Object.assign(this,this.constructor.createControls(),Kh.ownDefaults),this.setOptions(e)}static createControls(){return{controls:oB()}}_updateCacheCanvas(){const e=this.canvas;if(this.noScaleCache&&e&&e._currentTransform){const r=e._currentTransform,n=r.target,s=r.action;if(this===n&&s&&s.startsWith(w_))return!1}return super._updateCacheCanvas()}getActiveControl(){const e=this.__corner;return e?{key:e,control:this.controls[e],coord:this.oCoords[e]}:void 0}findControl(e){let r=arguments.length>1&&arguments[1]!==void 0&&arguments[1];if(!this.hasControls||!this.canvas)return;this.__corner=void 0;const n=Object.entries(this.oCoords);for(let s=n.length-1;s>=0;s--){const[i,o]=n[s],a=this.controls[i];if(a.shouldActivate(i,this,e,r?o.touchCorner:o.corner))return this.__corner=i,{key:i,control:a,coord:this.oCoords[i]}}}calcOCoords(){const e=this.getViewportTransform(),r=this.getCenterPoint(),n=lf(r.x,r.y),s=Wu({angle:this.getTotalAngle()-(this.group&&this.flipX?180:0)}),i=In(n,s),o=In(e,i),a=In(o,[1/e[0],0,0,1/e[3],0,0]),l=this.group?$g(this.calcTransformMatrix()):void 0;l&&(l.scaleX=Math.abs(l.scaleX),l.scaleY=Math.abs(l.scaleY));const c=this._calculateCurrentDimensions(l),u={};return this.forEachControl((d,h)=>{const f=d.positionHandler(c,a,this,d);u[h]=Object.assign(f,this._calcCornerCoords(d,f))}),u}_calcCornerCoords(e,r){const n=this.getTotalAngle();return{corner:e.calcCornerCoords(n,this.cornerSize,r.x,r.y,!1,this),touchCorner:e.calcCornerCoords(n,this.touchCornerSize,r.x,r.y,!0,this)}}setCoords(){super.setCoords(),this.canvas&&(this.oCoords=this.calcOCoords())}forEachControl(e){for(const r in this.controls)e(this.controls[r],r,this)}drawSelectionBackground(e){if(!this.selectionBackgroundColor||this.canvas&&this.canvas._activeObject!==this)return;e.save();const r=this.getRelativeCenterPoint(),n=this._calculateCurrentDimensions(),s=this.getViewportTransform();e.translate(r.x,r.y),e.scale(1/s[0],1/s[3]),e.rotate(nn(this.angle)),e.fillStyle=this.selectionBackgroundColor,e.fillRect(-n.x/2,-n.y/2,n.x,n.y),e.restore()}strokeBorders(e,r){e.strokeRect(-r.x/2,-r.y/2,r.x,r.y)}_drawBorders(e,r){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const s=ge({hasControls:this.hasControls,borderColor:this.borderColor,borderDashArray:this.borderDashArray},n);e.save(),e.strokeStyle=s.borderColor,this._setLineDash(e,s.borderDashArray),this.strokeBorders(e,r),s.hasControls&&this.drawControlsConnectingLines(e,r),e.restore()}_renderControls(e){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{hasBorders:n,hasControls:s}=this,i=ge({hasBorders:n,hasControls:s},r),o=this.getViewportTransform(),a=i.hasBorders,l=i.hasControls,c=In(o,this.calcTransformMatrix()),u=$g(c);e.save(),e.translate(u.translateX,u.translateY),e.lineWidth=this.borderScaleFactor,this.group===this.parent&&(e.globalAlpha=this.isMoving?this.borderOpacityWhenMoving:1),this.flipX&&(u.angle-=180),e.rotate(nn(this.group?u.angle:this.angle)),a&&this.drawBorders(e,u,r),l&&this.drawControls(e,r),e.restore()}drawBorders(e,r,n){let s;if(n&&n.forActiveSelection||this.group){const i=qb(this.width,this.height,x_(r)),o=this.isStrokeAccountedForInDimensions()?Gb:(this.strokeUniform?new Ce().scalarAdd(this.canvas?this.canvas.getZoom():1):new Ce(r.scaleX,r.scaleY)).scalarMultiply(this.strokeWidth);s=i.add(o).scalarAdd(this.borderScaleFactor).scalarAdd(2*this.padding)}else s=this._calculateCurrentDimensions().scalarAdd(this.borderScaleFactor);this._drawBorders(e,s,n)}drawControlsConnectingLines(e,r){let n=!1;e.beginPath(),this.forEachControl((s,i)=>{s.withConnection&&s.getVisibility(this,i)&&(n=!0,e.moveTo(s.x*r.x,s.y*r.y),e.lineTo(s.x*r.x+s.offsetX,s.y*r.y+s.offsetY))}),n&&e.stroke()}drawControls(e){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};e.save();const n=this.getCanvasRetinaScaling(),{cornerStrokeColor:s,cornerDashArray:i,cornerColor:o}=this,a=ge({cornerStrokeColor:s,cornerDashArray:i,cornerColor:o},r);e.setTransform(n,0,0,n,0,0),e.strokeStyle=e.fillStyle=a.cornerColor,this.transparentCorners||(e.strokeStyle=a.cornerStrokeColor),this._setLineDash(e,a.cornerDashArray),this.forEachControl((l,c)=>{if(l.getVisibility(this,c)){const u=this.oCoords[c];l.render(e,u.x,u.y,a,this)}}),e.restore()}isControlVisible(e){return this.controls[e]&&this.controls[e].getVisibility(this,e)}setControlVisible(e,r){this._controlsVisibility||(this._controlsVisibility={}),this._controlsVisibility[e]=r}setControlsVisibility(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};Object.entries(e).forEach(r=>{let[n,s]=r;return this.setControlVisible(n,s)})}clearContextTop(e){if(!this.canvas)return;const r=this.canvas.contextTop;if(!r)return;const n=this.canvas.viewportTransform;r.save(),r.transform(n[0],n[1],n[2],n[3],n[4],n[5]),this.transform(r);const s=this.width+4,i=this.height+4;return r.clearRect(-s/2,-i/2,s,i),e||r.restore(),r}onDeselect(e){return!1}onSelect(e){return!1}shouldStartDragging(e){return!1}onDragStart(e){return!1}canDrop(e){return!1}renderDragSourceEffect(e){}renderDropTargetEffect(e){}}function aB(t,e){return e.forEach(r=>{Object.getOwnPropertyNames(r.prototype).forEach(n=>{n!=="constructor"&&Object.defineProperty(t.prototype,n,Object.getOwnPropertyDescriptor(r.prototype,n)||Object.create(null))})}),t}fe(Kh,"ownDefaults",{noScaleCache:!0,lockMovementX:!1,lockMovementY:!1,lockRotation:!1,lockScalingX:!1,lockScalingY:!1,lockSkewingX:!1,lockSkewingY:!1,lockScalingFlip:!1,cornerSize:13,touchCornerSize:24,transparentCorners:!0,cornerColor:"rgb(178,204,255)",cornerStrokeColor:"",cornerStyle:"rect",cornerDashArray:null,hasControls:!0,borderColor:"rgb(178,204,255)",borderDashArray:null,borderOpacityWhenMoving:.4,borderScaleFactor:1,hasBorders:!0,selectionBackgroundColor:"",selectable:!0,evented:!0,perPixelTargetFind:!1,activeOn:"down",hoverCursor:null,moveCursor:null});class Gn extends Kh{}aB(Gn,[Jz]),ht.setClass(Gn),ht.setClass(Gn,"object");const xq=(t,e,r,n)=>{const s=2*(n=Math.round(n))+1,{data:i}=t.getImageData(e-n,r-n,s,s);for(let o=3;o<i.length;o+=4)if(i[o]>0)return!1;return!0};class lB{constructor(e){this.options=e,this.strokeProjectionMagnitude=this.options.strokeWidth/2,this.scale=new Ce(this.options.scaleX,this.options.scaleY),this.strokeUniformScalar=this.options.strokeUniform?new Ce(1/this.options.scaleX,1/this.options.scaleY):new Ce(1,1)}createSideVector(e,r){const n=Sx(e,r);return this.options.strokeUniform?n.multiply(this.scale):n}projectOrthogonally(e,r,n){return this.applySkew(e.add(this.calcOrthogonalProjection(e,r,n)))}isSkewed(){return this.options.skewX!==0||this.options.skewY!==0}applySkew(e){const r=new Ce(e);return r.y+=r.x*Math.tan(nn(this.options.skewY)),r.x+=r.y*Math.tan(nn(this.options.skewX)),r}scaleUnitVector(e,r){return e.multiply(this.strokeUniformScalar).scalarMultiply(r)}}const bq=new Ce;class au extends lB{static getOrthogonalRotationFactor(e,r){const n=r?Px(e,r):UX(e);return Math.abs(n)<af?-1:1}constructor(e,r,n,s){super(s),fe(this,"AB",void 0),fe(this,"AC",void 0),fe(this,"alpha",void 0),fe(this,"bisector",void 0),this.A=new Ce(e),this.B=new Ce(r),this.C=new Ce(n),this.AB=this.createSideVector(this.A,this.B),this.AC=this.createSideVector(this.A,this.C),this.alpha=Px(this.AB,this.AC),this.bisector=Qb(eB(this.AB.eq(bq)?this.AC:this.AB,this.alpha/2))}calcOrthogonalProjection(e,r){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:this.strokeProjectionMagnitude;const s=this.createSideVector(e,r),i=tB(s),o=au.getOrthogonalRotationFactor(i,this.bisector);return this.scaleUnitVector(i,n*o)}projectBevel(){const e=[];return(this.alpha%Eg==0?[this.B]:[this.B,this.C]).forEach(r=>{e.push(this.projectOrthogonally(this.A,r)),e.push(this.projectOrthogonally(this.A,r,-this.strokeProjectionMagnitude))}),e}projectMiter(){const e=[],r=Math.abs(this.alpha),n=1/Math.sin(r/2),s=this.scaleUnitVector(this.bisector,-this.strokeProjectionMagnitude*n),i=this.options.strokeUniform?Ex(this.scaleUnitVector(this.bisector,this.options.strokeMiterLimit)):this.options.strokeMiterLimit;return Ex(s)/this.strokeProjectionMagnitude<=i&&e.push(this.applySkew(this.A.add(s))),e.push(...this.projectBevel()),e}projectRoundNoSkew(e,r){const n=[],s=new Ce(au.getOrthogonalRotationFactor(this.bisector),au.getOrthogonalRotationFactor(new Ce(this.bisector.y,this.bisector.x)));return[new Ce(1,0).scalarMultiply(this.strokeProjectionMagnitude).multiply(this.strokeUniformScalar).multiply(s),new Ce(0,1).scalarMultiply(this.strokeProjectionMagnitude).multiply(this.strokeUniformScalar).multiply(s)].forEach(i=>{sD(i,e,r)&&n.push(this.A.add(i))}),n}projectRoundWithSkew(e,r){const n=[],{skewX:s,skewY:i,scaleX:o,scaleY:a,strokeUniform:l}=this.options,c=new Ce(Math.tan(nn(s)),Math.tan(nn(i))),u=this.strokeProjectionMagnitude,d=l?u/a/Math.sqrt(1/a**2+1/o**2*c.y**2):u/Math.sqrt(1+c.y**2),h=new Ce(Math.sqrt(Math.max(u**2-d**2,0)),d),f=l?u/Math.sqrt(1+c.x**2*(1/a)**2/(1/o+1/o*c.x*c.y)**2):u/Math.sqrt(1+c.x**2/(1+c.x*c.y)**2),p=new Ce(f,Math.sqrt(Math.max(u**2-f**2,0)));return[p,p.scalarMultiply(-1),h,h.scalarMultiply(-1)].map(m=>this.applySkew(l?m.multiply(this.strokeUniformScalar):m)).forEach(m=>{sD(m,e,r)&&n.push(this.applySkew(this.A).add(m))}),n}projectRound(){const e=[];e.push(...this.projectBevel());const r=this.alpha%Eg==0,n=this.applySkew(this.A),s=e[r?0:2].subtract(n),i=e[r?1:0].subtract(n),o=r?this.applySkew(this.AB.scalarMultiply(-1)):this.applySkew(this.bisector.multiply(this.strokeUniformScalar).scalarMultiply(-1)),a=mh(s,o)>0,l=a?s:i,c=a?i:s;return this.isSkewed()?e.push(...this.projectRoundWithSkew(l,c)):e.push(...this.projectRoundNoSkew(l,c)),e}projectPoints(){switch(this.options.strokeLineJoin){case"miter":return this.projectMiter();case"round":return this.projectRound();default:return this.projectBevel()}}project(){return this.projectPoints().map(e=>({originPoint:this.A,projectedPoint:e,angle:this.alpha,bisector:this.bisector}))}}class uD extends lB{constructor(e,r,n){super(n),this.A=new Ce(e),this.T=new Ce(r)}calcOrthogonalProjection(e,r){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:this.strokeProjectionMagnitude;const s=this.createSideVector(e,r);return this.scaleUnitVector(tB(s),n)}projectButt(){return[this.projectOrthogonally(this.A,this.T,this.strokeProjectionMagnitude),this.projectOrthogonally(this.A,this.T,-this.strokeProjectionMagnitude)]}projectRound(){const e=[];if(!this.isSkewed()&&this.A.eq(this.T)){const r=new Ce(1,1).scalarMultiply(this.strokeProjectionMagnitude).multiply(this.strokeUniformScalar);e.push(this.applySkew(this.A.add(r)),this.applySkew(this.A.subtract(r)))}else e.push(...new au(this.A,this.T,this.T,this.options).projectRound());return e}projectSquare(){const e=[];if(this.A.eq(this.T)){const r=new Ce(1,1).scalarMultiply(this.strokeProjectionMagnitude).multiply(this.strokeUniformScalar);e.push(this.A.add(r),this.A.subtract(r))}else{const r=this.calcOrthogonalProjection(this.A,this.T,this.strokeProjectionMagnitude),n=this.scaleUnitVector(Qb(this.createSideVector(this.A,this.T)),-this.strokeProjectionMagnitude),s=this.A.add(n);e.push(s.add(r),s.subtract(r))}return e.map(r=>this.applySkew(r))}projectPoints(){switch(this.options.strokeLineCap){case"round":return this.projectRound();case"square":return this.projectSquare();default:return this.projectButt()}}project(){return this.projectPoints().map(e=>({originPoint:this.A,projectedPoint:e}))}}const Mq=function(t,e){let r=arguments.length>2&&arguments[2]!==void 0&&arguments[2];const n=[];if(t.length===0)return n;const s=t.reduce((i,o)=>(i[i.length-1].eq(o)||i.push(new Ce(o)),i),[new Ce(t[0])]);if(s.length===1)r=!0;else if(!r){const i=s[0],o=((a,l)=>{for(let c=a.length-1;c>=0;c--)if(l(a[c],c,a))return c;return-1})(s,a=>!a.eq(i));s.splice(o+1)}return s.forEach((i,o,a)=>{let l,c;o===0?(c=a[1],l=r?i:a[a.length-1]):o===a.length-1?(l=a[o-1],c=r?i:a[0]):(l=a[o-1],c=a[o+1]),r&&a.length===1?n.push(...new uD(i,i,e).project()):!r||o!==0&&o!==a.length-1?n.push(...new au(i,l,c,e).project()):n.push(...new uD(i,o===0?c:l,e).project())}),n},eM=t=>{const e={};return Object.keys(t).forEach(r=>{e[r]={},Object.keys(t[r]).forEach(n=>{e[r][n]=ge({},t[r][n])})}),e},Tq=t=>t.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&apos;").replace(/</g,"&lt;").replace(/>/g,"&gt;");let Gd;const tM=t=>{if(Gd||Gd||(Gd="Intl"in y_()&&"Segmenter"in Intl&&new Intl.Segmenter(void 0,{granularity:"grapheme"})),Gd){const e=Gd.segment(t);return Array.from(e).map(r=>{let{segment:n}=r;return n})}return Cq(t)},Cq=t=>{const e=[];for(let r,n=0;n<t.length;n++)(r=Sq(t,n))!==!1&&e.push(r);return e},Sq=(t,e)=>{const r=t.charCodeAt(e);if(isNaN(r))return"";if(r<55296||r>57343)return t.charAt(e);if(55296<=r&&r<=56319){if(t.length<=e+1)throw"High surrogate without following low surrogate";const s=t.charCodeAt(e+1);if(56320>s||s>57343)throw"High surrogate without following low surrogate";return t.charAt(e)+t.charAt(e+1)}if(e===0)throw"Low surrogate without preceding high surrogate";const n=t.charCodeAt(e-1);if(55296>n||n>56319)throw"Low surrogate without preceding high surrogate";return!1},rM=function(t,e){let r=arguments.length>2&&arguments[2]!==void 0&&arguments[2];return t.fill!==e.fill||t.stroke!==e.stroke||t.strokeWidth!==e.strokeWidth||t.fontSize!==e.fontSize||t.fontFamily!==e.fontFamily||t.fontWeight!==e.fontWeight||t.fontStyle!==e.fontStyle||t.textBackgroundColor!==e.textBackgroundColor||t.deltaY!==e.deltaY||r&&(t.overline!==e.overline||t.underline!==e.underline||t.linethrough!==e.linethrough)},Eq=(t,e)=>{const r=e.split(`
`),n=[];let s=-1,i={};t=eM(t);for(let o=0;o<r.length;o++){const a=tM(r[o]);if(t[o])for(let l=0;l<a.length;l++){s++;const c=t[o][l];c&&Object.keys(c).length>0&&(rM(i,c,!0)?n.push({start:s,end:s+1,style:c}):n[n.length-1].end++),i=c||{}}else s+=a.length,i={}}return n},Pq=(t,e)=>{if(!Array.isArray(t))return eM(t);const r=e.split(Wb),n={};let s=-1,i=0;for(let o=0;o<r.length;o++){const a=tM(r[o]);for(let l=0;l<a.length;l++)s++,t[i]&&t[i].start<=s&&s<t[i].end&&(n[o]=n[o]||{},n[o][l]=ge({},t[i].style),s===t[i].end-1&&i++)}return n},Xa=["display","transform",xn,"fill-opacity","fill-rule","opacity",_s,"stroke-dasharray","stroke-linecap","stroke-dashoffset","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke-width","id","paint-order","vector-effect","instantiated_by_use","clip-path"];function dD(t,e){const r=t.nodeName,n=t.getAttribute("class"),s=t.getAttribute("id"),i="(?![a-zA-Z\\-]+)";let o;if(o=new RegExp("^"+r,"i"),e=e.replace(o,""),s&&e.length&&(o=new RegExp("#"+s+i,"i"),e=e.replace(o,"")),n&&e.length){const a=n.split(" ");for(let l=a.length;l--;)o=new RegExp("\\."+a[l]+i,"i"),e=e.replace(o,"")}return e.length===0}function kq(t,e){let r=!0;const n=dD(t,e.pop());return n&&e.length&&(r=function(s,i){let o,a=!0;for(;s.parentElement&&s.parentElement.nodeType===1&&i.length;)a&&(o=i.pop()),a=dD(s=s.parentElement,o);return i.length===0}(t,e)),n&&r&&e.length===0}const Aq=t=>{var e;return(e=VX[t])!==null&&e!==void 0?e:t},$q=new RegExp("(".concat(Di,")"),"gi"),Oq=t=>t.replace($q," $1 ").replace(/,/gi," ").replace(/\s+/gi," ");var hD,fD,pD,mD,gD,_D,yD;const es="(".concat(Di,")"),Dq=String.raw(hD||(hD=go(["(skewX)(",")"],["(skewX)\\(","\\)"])),es),Iq=String.raw(fD||(fD=go(["(skewY)(",")"],["(skewY)\\(","\\)"])),es),Fq=String.raw(pD||(pD=go(["(rotate)(","(?: "," ",")?)"],["(rotate)\\(","(?: "," ",")?\\)"])),es,es,es),Lq=String.raw(mD||(mD=go(["(scale)(","(?: ",")?)"],["(scale)\\(","(?: ",")?\\)"])),es,es),Rq=String.raw(gD||(gD=go(["(translate)(","(?: ",")?)"],["(translate)\\(","(?: ",")?\\)"])),es,es),jq=String.raw(_D||(_D=go(["(matrix)("," "," "," "," "," ",")"],["(matrix)\\("," "," "," "," "," ","\\)"])),es,es,es,es,es,es),nM="(?:".concat(jq,"|").concat(Rq,"|").concat(Fq,"|").concat(Lq,"|").concat(Dq,"|").concat(Iq,")"),Nq="(?:".concat(nM,"*)"),zq=String.raw(yD||(yD=go(["^s*(?:","?)s*$"],["^\\s*(?:","?)\\s*$"])),Nq),Bq=new RegExp(zq),Vq=new RegExp(nM),Wq=new RegExp(nM,"g");function kx(t){const e=[];if(!(t=Oq(t).replace(/\s*([()])\s*/gi,"$1"))||t&&!Bq.test(t))return[...rs];for(const r of t.matchAll(Wq)){const n=Vq.exec(r[0]);if(!n)continue;let s=rs;const i=n.filter(p=>!!p),[,o,...a]=i,[l,c,u,d,h,f]=a.map(p=>parseFloat(p));switch(o){case"translate":s=lf(l,c);break;case Ub:s=Wu({angle:l},{x:c,y:u});break;case w_:s=Kb(l,c);break;case Bu:s=Bz(l);break;case Vu:s=Vz(l);break;case"matrix":s=[l,c,u,d,h,f]}e.push(s)}return Hb(e)}function Uq(t,e,r,n){const s=Array.isArray(e);let i,o=e;if(t!==xn&&t!==_s||e!==gs){if(t==="strokeUniform")return e==="non-scaling-stroke";if(t==="strokeDashArray")o=e===gs?null:e.replace(/,/g," ").split(/\s+/).map(parseFloat);else if(t==="transformMatrix")o=r&&r.transformMatrix?In(r.transformMatrix,kx(e)):kx(e);else if(t==="visible")o=e!==gs&&e!=="hidden",r&&r.visible===!1&&(o=!1);else if(t==="opacity")o=parseFloat(e),r&&r.opacity!==void 0&&(o*=r.opacity);else if(t==="textAnchor")o=e==="start"?pr:e==="end"?tn:Wt;else if(t==="charSpacing")i=ou(e,n)/n*1e3;else if(t==="paintFirst"){const a=e.indexOf(xn),l=e.indexOf(_s);o=xn,(a>-1&&l>-1&&l<a||a===-1&&l>-1)&&(o=_s)}else{if(t==="href"||t==="xlink:href"||t==="font"||t==="id")return e;if(t==="imageSmoothing")return e==="optimizeQuality";i=s?e.map(ou):ou(e,n)}}else o="";return!s&&isNaN(i)?o:i}function Gq(t,e){const r=t.match(BX);if(!r)return;const n=r[1],s=r[3],i=r[4],o=r[5],a=r[6];n&&(e.fontStyle=n),s&&(e.fontWeight=isNaN(parseFloat(s))?s:parseFloat(s)),i&&(e.fontSize=ou(i)),a&&(e.fontFamily=a),o&&(e.lineHeight=o==="normal"?1:o)}function Hq(t,e){t.replace(/;\s*$/,"").split(";").forEach(r=>{if(!r)return;const[n,s]=r.split(":");e[n.trim().toLowerCase()]=s.trim()})}function Kq(t){const e={},r=t.getAttribute("style");return r&&(typeof r=="string"?Hq(r,e):function(n,s){Object.entries(n).forEach(i=>{let[o,a]=i;a!==void 0&&(s[o.toLowerCase()]=a)})}(r,e)),e}const Xq={stroke:"strokeOpacity",fill:"fillOpacity"};function Xo(t,e,r){if(!t)return{};let n,s={},i=Vb;t.parentNode&&nD.test(t.parentNode.nodeName)&&(s=Xo(t.parentElement,e,r),s.fontSize&&(n=i=ou(s.fontSize)));const o=ge(ge(ge({},e.reduce((c,u)=>{const d=t.getAttribute(u);return d&&(c[u]=d),c},{})),function(c){let u=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},d={};for(const h in u)kq(c,h.split(" "))&&(d=ge(ge({},d),u[h]));return d}(t,r)),Kq(t));o[Ov]&&t.setAttribute(Ov,o[Ov]),o[$v]&&(n=ou(o[$v],i),o[$v]="".concat(n));const a={};for(const c in o){const u=Aq(c),d=Uq(u,o[c],s,n);a[u]=d}a&&a.font&&Gq(a.font,a);const l=ge(ge({},s),a);return nD.test(t.nodeName)?l:function(c){const u=Gn.getDefaults();return Object.entries(Xq).forEach(d=>{let[h,f]=d;if(c[f]===void 0||c[h]==="")return;if(c[h]===void 0){if(!u[h])return;c[h]=u[h]}if(c[h].indexOf("url(")===0)return;const p=new _r(c[h]);c[h]=p.setAlpha(Fr(p.getAlpha()*c[f],2)).toRgba()}),c}(l)}const qq=["left","top","width","height","visible"],cB=["rx","ry"];class so extends Gn{static getDefaults(){return ge(ge({},super.getDefaults()),so.ownDefaults)}constructor(e){super(),Object.assign(this,so.ownDefaults),this.setOptions(e),this._initRxRy()}_initRxRy(){const{rx:e,ry:r}=this;e&&!r?this.ry=e:r&&!e&&(this.rx=r)}_render(e){const{width:r,height:n}=this,s=-r/2,i=-n/2,o=this.rx?Math.min(this.rx,r/2):0,a=this.ry?Math.min(this.ry,n/2):0,l=o!==0||a!==0;e.beginPath(),e.moveTo(s+o,i),e.lineTo(s+r-o,i),l&&e.bezierCurveTo(s+r-da*o,i,s+r,i+da*a,s+r,i+a),e.lineTo(s+r,i+n-a),l&&e.bezierCurveTo(s+r,i+n-da*a,s+r-da*o,i+n,s+r-o,i+n),e.lineTo(s+o,i+n),l&&e.bezierCurveTo(s+da*o,i+n,s,i+n-da*a,s,i+n-a),e.lineTo(s,i+a),l&&e.bezierCurveTo(s,i+da*a,s+da*o,i,s+o,i),e.closePath(),this._renderPaintInOrder(e)}toObject(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];return super.toObject([...cB,...e])}_toSVG(){const{width:e,height:r,rx:n,ry:s}=this;return["<rect ","COMMON_PARTS",'x="'.concat(-e/2,'" y="').concat(-r/2,'" rx="').concat(n,'" ry="').concat(s,'" width="').concat(e,'" height="').concat(r,`" />
`)]}static async fromElement(e,r,n){const s=Xo(e,this.ATTRIBUTE_NAMES,n),{left:i=0,top:o=0,width:a=0,height:l=0,visible:c=!0}=s,u=Lr(s,qq);return new this(ge(ge(ge({},r),u),{},{left:i,top:o,width:a,height:l,visible:!!(c&&a&&l)}))}}fe(so,"type","Rect"),fe(so,"cacheProperties",[...Ko,...cB]),fe(so,"ownDefaults",{rx:0,ry:0}),fe(so,"ATTRIBUTE_NAMES",[...Xa,"x","y","rx","ry","width","height"]),ht.setClass(so),ht.setSVGClass(so);const Ao="initialization",Ig="added",sM="removed",Fg="imperative",uB=(t,e)=>{const{strokeUniform:r,strokeWidth:n,width:s,height:i,group:o}=e,a=o&&o!==t?M_(o.calcTransformMatrix(),t.calcTransformMatrix()):null,l=a?e.getRelativeCenterPoint().transform(a):e.getRelativeCenterPoint(),c=!e.isStrokeAccountedForInDimensions(),u=r&&c?LX(new Ce(n,n),void 0,t.calcTransformMatrix()):Gb,d=!r&&c?n:0,h=qb(s+d,i+d,Hb([a,e.calcOwnMatrix()],!0)).add(u).scalarDivide(2);return[l.subtract(h),l.add(h)]};class S_{calcLayoutResult(e,r){if(this.shouldPerformLayout(e))return this.calcBoundingBox(r,e)}shouldPerformLayout(e){let{type:r,prevStrategy:n,strategy:s}=e;return r===Ao||r===Fg||!!n&&s!==n}shouldLayoutClipPath(e){let{type:r,target:{clipPath:n}}=e;return r!==Ao&&n&&!n.absolutePositioned}getInitialSize(e,r){return r.size}calcBoundingBox(e,r){const{type:n,target:s}=r;if(n===Fg&&r.overrides)return r.overrides;if(e.length===0)return;const{left:i,top:o,width:a,height:l}=Do(e.map(d=>uB(s,d)).reduce((d,h)=>d.concat(h),[])),c=new Ce(a,l),u=new Ce(i,o).add(c.scalarDivide(2));if(n===Ao){const d=this.getInitialSize(r,{size:c,center:u});return{center:u,relativeCorrection:new Ce(0,0),size:d}}return{center:u.transform(s.calcOwnMatrix()),size:c}}}fe(S_,"type","strategy");class Ax extends S_{shouldPerformLayout(e){return!0}}fe(Ax,"type","fit-content"),ht.setClass(Ax);const Yq=["strategy"],Qq=["target","strategy","bubbles","prevStrategy"],dB="layoutManager";class Xh{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:new Ax;fe(this,"strategy",void 0),this.strategy=e,this._subscriptions=new Map}performLayout(e){const r=ge(ge({bubbles:!0,strategy:this.strategy},e),{},{prevStrategy:this._prevLayoutStrategy,stopPropagation(){this.bubbles=!1}});this.onBeforeLayout(r);const n=this.getLayoutResult(r);n&&this.commitLayout(r,n),this.onAfterLayout(r,n),this._prevLayoutStrategy=r.strategy}attachHandlers(e,r){const{target:n}=r;return[kg,Oz,Wh,Dz,v_,Iz,Pg,bX,MX].map(s=>e.on(s,i=>this.performLayout(s===kg?{type:"object_modified",trigger:s,e:i,target:n}:{type:"object_modifying",trigger:s,e:i,target:n})))}subscribe(e,r){this.unsubscribe(e,r);const n=this.attachHandlers(e,r);this._subscriptions.set(e,n)}unsubscribe(e,r){(this._subscriptions.get(e)||[]).forEach(n=>n()),this._subscriptions.delete(e)}unsubscribeTargets(e){e.targets.forEach(r=>this.unsubscribe(r,e))}subscribeTargets(e){e.targets.forEach(r=>this.subscribe(r,e))}onBeforeLayout(e){const{target:r,type:n}=e,{canvas:s}=r;if(n===Ao||n===Ig?this.subscribeTargets(e):n===sM&&this.unsubscribeTargets(e),r.fire("layout:before",{context:e}),s&&s.fire("object:layout:before",{target:r,context:e}),n===Fg&&e.deep){const i=Lr(e,Yq);r.forEachObject(o=>o.layoutManager&&o.layoutManager.performLayout(ge(ge({},i),{},{bubbles:!1,target:o})))}}getLayoutResult(e){const{target:r,strategy:n,type:s}=e,i=n.calcLayoutResult(e,r.getObjects());if(!i)return;const o=s===Ao?new Ce:r.getRelativeCenterPoint(),{center:a,correction:l=new Ce,relativeCorrection:c=new Ce}=i,u=o.subtract(a).add(l).transform(s===Ao?rs:Oi(r.calcOwnMatrix()),!0).add(c);return{result:i,prevCenter:o,nextCenter:a,offset:u}}commitLayout(e,r){const{target:n}=e,{result:{size:s},nextCenter:i}=r;var o,a;n.set({width:s.x,height:s.y}),this.layoutObjects(e,r),e.type===Ao?n.set({left:(o=e.x)!==null&&o!==void 0?o:i.x+s.x*dn(n.originX),top:(a=e.y)!==null&&a!==void 0?a:i.y+s.y*dn(n.originY)}):(n.setPositionByOrigin(i,Wt,Wt),n.setCoords(),n.set("dirty",!0))}layoutObjects(e,r){const{target:n}=e;n.forEachObject(s=>{s.group===n&&this.layoutObject(e,r,s)}),e.strategy.shouldLayoutClipPath(e)&&this.layoutObject(e,r,n.clipPath)}layoutObject(e,r,n){let{offset:s}=r;n.set({left:n.left+s.x,top:n.top+s.y})}onAfterLayout(e,r){const{target:n,strategy:s,bubbles:i,prevStrategy:o}=e,a=Lr(e,Qq),{canvas:l}=n;n.fire("layout:after",{context:e,result:r}),l&&l.fire("object:layout:after",{context:e,result:r,target:n});const c=n.parent;i&&c!=null&&c.layoutManager&&((a.path||(a.path=[])).push(n),c.layoutManager.performLayout(ge(ge({},a),{},{target:c}))),n.set("dirty",!0)}dispose(){const{_subscriptions:e}=this;e.forEach(r=>r.forEach(n=>n())),e.clear()}toObject(){return{type:dB,strategy:this.strategy.constructor.type}}toJSON(){return this.toObject()}}ht.setClass(Xh,dB);const Jq=["type","objects","layoutManager"];class Zq extends Xh{performLayout(){}}class Wl extends Fz(Gn){static getDefaults(){return ge(ge({},super.getDefaults()),Wl.ownDefaults)}constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(),fe(this,"_activeObjects",[]),fe(this,"__objectSelectionTracker",void 0),fe(this,"__objectSelectionDisposer",void 0),Object.assign(this,Wl.ownDefaults),this.setOptions(r),this.groupInit(e,r)}groupInit(e,r){var n;this._objects=[...e],this.__objectSelectionTracker=this.__objectSelectionMonitor.bind(this,!0),this.__objectSelectionDisposer=this.__objectSelectionMonitor.bind(this,!1),this.forEachObject(s=>{this.enterGroup(s,!1)}),this.layoutManager=(n=r.layoutManager)!==null&&n!==void 0?n:new Xh,this.layoutManager.performLayout({type:Ao,target:this,targets:[...e],x:r.left,y:r.top})}canEnterGroup(e){return e===this||this.isDescendantOf(e)?(Va("error","Group: circular object trees are not supported, this call has no effect"),!1):this._objects.indexOf(e)===-1||(Va("error","Group: duplicate objects are not supported inside group, this call has no effect"),!1)}_filterObjectsBeforeEnteringGroup(e){return e.filter((r,n,s)=>this.canEnterGroup(r)&&s.indexOf(r)===n)}add(){for(var e=arguments.length,r=new Array(e),n=0;n<e;n++)r[n]=arguments[n];const s=this._filterObjectsBeforeEnteringGroup(r),i=super.add(...s);return this._onAfterObjectsChange(Ig,s),i}insertAt(e){for(var r=arguments.length,n=new Array(r>1?r-1:0),s=1;s<r;s++)n[s-1]=arguments[s];const i=this._filterObjectsBeforeEnteringGroup(n),o=super.insertAt(e,...i);return this._onAfterObjectsChange(Ig,i),o}remove(){const e=super.remove(...arguments);return this._onAfterObjectsChange(sM,e),e}_onObjectAdded(e){this.enterGroup(e,!0),this.fire("object:added",{target:e}),e.fire("added",{target:this})}_onObjectRemoved(e,r){this.exitGroup(e,r),this.fire("object:removed",{target:e}),e.fire("removed",{target:this})}_onAfterObjectsChange(e,r){this.layoutManager.performLayout({type:e,targets:r,target:this})}_onStackOrderChanged(){this._set("dirty",!0)}_set(e,r){const n=this[e];return super._set(e,r),e==="canvas"&&n!==r&&(this._objects||[]).forEach(s=>{s._set(e,r)}),this}_shouldSetNestedCoords(){return this.subTargetCheck}removeAll(){return this._activeObjects=[],this.remove(...this._objects)}__objectSelectionMonitor(e,r){let{target:n}=r;const s=this._activeObjects;if(e)s.push(n),this._set("dirty",!0);else if(s.length>0){const i=s.indexOf(n);i>-1&&(s.splice(i,1),this._set("dirty",!0))}}_watchObject(e,r){e&&this._watchObject(!1,r),e?(r.on("selected",this.__objectSelectionTracker),r.on("deselected",this.__objectSelectionDisposer)):(r.off("selected",this.__objectSelectionTracker),r.off("deselected",this.__objectSelectionDisposer))}enterGroup(e,r){e.group&&e.group.remove(e),e._set("parent",this),this._enterGroup(e,r)}_enterGroup(e,r){r&&Og(e,In(Oi(this.calcTransformMatrix()),e.calcTransformMatrix())),this._shouldSetNestedCoords()&&e.setCoords(),e._set("group",this),e._set("canvas",this.canvas),this._watchObject(!0,e);const n=this.canvas&&this.canvas.getActiveObject&&this.canvas.getActiveObject();n&&(n===e||e.isDescendantOf(n))&&this._activeObjects.push(e)}exitGroup(e,r){this._exitGroup(e,r),e._set("parent",void 0),e._set("canvas",void 0)}_exitGroup(e,r){e._set("group",void 0),r||(Og(e,In(this.calcTransformMatrix(),e.calcTransformMatrix())),e.setCoords()),this._watchObject(!1,e);const n=this._activeObjects.length>0?this._activeObjects.indexOf(e):-1;n>-1&&this._activeObjects.splice(n,1)}shouldCache(){const e=Gn.prototype.shouldCache.call(this);if(e){for(let r=0;r<this._objects.length;r++)if(this._objects[r].willDrawShadow())return this.ownCaching=!1,!1}return e}willDrawShadow(){if(super.willDrawShadow())return!0;for(let e=0;e<this._objects.length;e++)if(this._objects[e].willDrawShadow())return!0;return!1}isOnACache(){return this.ownCaching||!!this.parent&&this.parent.isOnACache()}drawObject(e,r,n){this._renderBackground(e);for(let i=0;i<this._objects.length;i++){var s;const o=this._objects[i];(s=this.canvas)!==null&&s!==void 0&&s.preserveObjectStacking&&o.group!==this?(e.save(),e.transform(...Oi(this.calcTransformMatrix())),o.render(e),e.restore()):o.group===this&&o.render(e)}this._drawClipPath(e,this.clipPath,n)}setCoords(){super.setCoords(),this._shouldSetNestedCoords()&&this.forEachObject(e=>e.setCoords())}triggerLayout(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this.layoutManager.performLayout(ge({target:this,type:Fg},e))}render(e){this._transformDone=!0,super.render(e),this._transformDone=!1}__serializeObjects(e,r){const n=this.includeDefaultValues;return this._objects.filter(function(s){return!s.excludeFromExport}).map(function(s){const i=s.includeDefaultValues;s.includeDefaultValues=n;const o=s[e||"toObject"](r);return s.includeDefaultValues=i,o})}toObject(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];const r=this.layoutManager.toObject();return ge(ge(ge({},super.toObject(["subTargetCheck","interactive",...e])),r.strategy!=="fit-content"||this.includeDefaultValues?{layoutManager:r}:{}),{},{objects:this.__serializeObjects("toObject",e)})}toString(){return"#<Group: (".concat(this.complexity(),")>")}dispose(){this.layoutManager.unsubscribeTargets({targets:this.getObjects(),target:this}),this._activeObjects=[],this.forEachObject(e=>{this._watchObject(!1,e),e.dispose()}),super.dispose()}_createSVGBgRect(e){if(!this.backgroundColor)return"";const r=so.prototype._toSVG.call(this),n=r.indexOf("COMMON_PARTS");r[n]='for="group" ';const s=r.join("");return e?e(s):s}_toSVG(e){const r=["<g ","COMMON_PARTS",` >
`],n=this._createSVGBgRect(e);n&&r.push("		",n);for(let s=0;s<this._objects.length;s++)r.push("		",this._objects[s].toSVG(e));return r.push(`</g>
`),r}getSvgStyles(){const e=this.opacity!==void 0&&this.opacity!==1?"opacity: ".concat(this.opacity,";"):"",r=this.visible?"":" visibility: hidden;";return[e,this.getSvgFilter(),r].join("")}toClipPathSVG(e){const r=[],n=this._createSVGBgRect(e);n&&r.push("	",n);for(let s=0;s<this._objects.length;s++)r.push("	",this._objects[s].toClipPathSVG(e));return this._createBaseClipPathSVGMarkup(r,{reviver:e})}static fromObject(e,r){let{type:n,objects:s=[],layoutManager:i}=e,o=Lr(e,Jq);return Promise.all([Uh(s,r),b_(o,r)]).then(a=>{let[l,c]=a;const u=new this(l,ge(ge(ge({},o),c),{},{layoutManager:new Zq}));if(i){const d=ht.getClass(i.type),h=ht.getClass(i.strategy);u.layoutManager=new d(new h)}else u.layoutManager=new Xh;return u.layoutManager.subscribeTargets({type:Ao,target:u,targets:u.getObjects()}),u.setCoords(),u})}}fe(Wl,"type","Group"),fe(Wl,"ownDefaults",{strokeWidth:0,subTargetCheck:!1,interactive:!1}),ht.setClass(Wl);const e7=(t,e)=>Math.min(e.width/t.width,e.height/t.height),t7=(t,e)=>Math.max(e.width/t.width,e.height/t.height),$x="\\s*,?\\s*",Hd="".concat($x,"(").concat(Di,")"),r7="".concat(Hd).concat(Hd).concat(Hd).concat($x,"([01])").concat($x,"([01])").concat(Hd).concat(Hd),n7={m:"l",M:"L"},s7=(t,e,r,n,s,i,o,a,l,c,u)=>{const d=Bo(t),h=Vo(t),f=Bo(e),p=Vo(e),m=r*s*f-n*i*p+o,y=n*s*f+r*i*p+a;return["C",c+l*(-r*s*h-n*i*d),u+l*(-n*s*h+r*i*d),m+l*(r*s*p+n*i*f),y+l*(n*s*p-r*i*f),m,y]},vD=(t,e,r,n)=>{const s=Math.atan2(e,t),i=Math.atan2(n,r);return i>=s?i-s:2*Math.PI-(s-i)};function wD(t,e,r,n,s,i,o,a){let l;if(dr.cachesBoundsOfCurve&&(l=[...arguments].join(),ph.boundsOfCurveCache[l]))return ph.boundsOfCurveCache[l];const c=Math.sqrt,u=Math.abs,d=[],h=[[0,0],[0,0]];let f=6*t-12*r+6*s,p=-3*t+9*r-9*s+3*o,m=3*r-3*t;for(let w=0;w<2;++w){if(w>0&&(f=6*e-12*n+6*i,p=-3*e+9*n-9*i+3*a,m=3*n-3*e),u(p)<1e-12){if(u(f)<1e-12)continue;const k=-m/f;0<k&&k<1&&d.push(k);continue}const x=f*f-4*m*p;if(x<0)continue;const M=c(x),T=(-f+M)/(2*p);0<T&&T<1&&d.push(T);const S=(-f-M)/(2*p);0<S&&S<1&&d.push(S)}let y=d.length;const g=y,_=hB(t,e,r,n,s,i,o,a);for(;y--;){const{x:w,y:x}=_(d[y]);h[0][y]=w,h[1][y]=x}h[0][g]=t,h[1][g]=e,h[0][g+1]=o,h[1][g+1]=a;const v=[new Ce(Math.min(...h[0]),Math.min(...h[1])),new Ce(Math.max(...h[0]),Math.max(...h[1]))];return dr.cachesBoundsOfCurve&&(ph.boundsOfCurveCache[l]=v),v}const i7=(t,e,r)=>{let[n,s,i,o,a,l,c,u]=r;const d=((h,f,p,m,y,g,_)=>{if(p===0||m===0)return[];let v=0,w=0,x=0;const M=Math.PI,T=_*Bb,S=Vo(T),k=Bo(T),$=.5*(-k*h-S*f),j=.5*(-k*f+S*h),V=p**2,L=m**2,X=j**2,K=$**2,Y=V*L-V*X-L*K;let J=Math.abs(p),N=Math.abs(m);if(Y<0){const de=Math.sqrt(1-Y/(V*L));J*=de,N*=de}else x=(y===g?-1:1)*Math.sqrt(Y/(V*X+L*K));const ne=x*J*j/N,te=-x*N*$/J,z=k*ne-S*te+.5*h,O=S*ne+k*te+.5*f;let H=vD(1,0,($-ne)/J,(j-te)/N),re=vD(($-ne)/J,(j-te)/N,(-$-ne)/J,(-j-te)/N);g===0&&re>0?re-=2*M:g===1&&re<0&&(re+=2*M);const _e=Math.ceil(Math.abs(re/M*2)),oe=[],pe=re/_e,$e=8/3*Math.sin(pe/4)*Math.sin(pe/4)/Math.sin(pe/2);let Ne=H+pe;for(let de=0;de<_e;de++)oe[de]=s7(H,Ne,k,S,J,N,z,O,$e,v,w),v=oe[de][5],w=oe[de][6],H=Ne,Ne+=pe;return oe})(c-t,u-e,s,i,a,l,o);for(let h=0,f=d.length;h<f;h++)d[h][1]+=t,d[h][2]+=e,d[h][3]+=t,d[h][4]+=e,d[h][5]+=t,d[h][6]+=e;return d},o7=t=>{let e=0,r=0,n=0,s=0;const i=[];let o,a=0,l=0;for(const c of t){const u=[...c];let d;switch(u[0]){case"l":u[1]+=e,u[2]+=r;case"L":e=u[1],r=u[2],d=["L",e,r];break;case"h":u[1]+=e;case"H":e=u[1],d=["L",e,r];break;case"v":u[1]+=r;case"V":r=u[1],d=["L",e,r];break;case"m":u[1]+=e,u[2]+=r;case"M":e=u[1],r=u[2],n=u[1],s=u[2],d=["M",e,r];break;case"c":u[1]+=e,u[2]+=r,u[3]+=e,u[4]+=r,u[5]+=e,u[6]+=r;case"C":a=u[3],l=u[4],e=u[5],r=u[6],d=["C",u[1],u[2],a,l,e,r];break;case"s":u[1]+=e,u[2]+=r,u[3]+=e,u[4]+=r;case"S":o==="C"?(a=2*e-a,l=2*r-l):(a=e,l=r),e=u[3],r=u[4],d=["C",a,l,u[1],u[2],e,r],a=d[3],l=d[4];break;case"q":u[1]+=e,u[2]+=r,u[3]+=e,u[4]+=r;case"Q":a=u[1],l=u[2],e=u[3],r=u[4],d=["Q",a,l,e,r];break;case"t":u[1]+=e,u[2]+=r;case"T":o==="Q"?(a=2*e-a,l=2*r-l):(a=e,l=r),e=u[1],r=u[2],d=["Q",a,l,e,r];break;case"a":u[6]+=e,u[7]+=r;case"A":i7(e,r,u).forEach(h=>i.push(h)),e=u[6],r=u[7];break;case"z":case"Z":e=n,r=s,d=["Z"]}d?(i.push(d),o=d[0]):o=""}return i},Lg=(t,e,r,n)=>Math.sqrt((r-t)**2+(n-e)**2),hB=(t,e,r,n,s,i,o,a)=>l=>{const c=l**3,u=(f=>3*f**2*(1-f))(l),d=(f=>3*f*(1-f)**2)(l),h=(f=>(1-f)**3)(l);return new Ce(o*c+s*u+r*d+t*h,a*c+i*u+n*d+e*h)},fB=t=>t**2,pB=t=>2*t*(1-t),mB=t=>(1-t)**2,a7=(t,e,r,n,s,i,o,a)=>l=>{const c=fB(l),u=pB(l),d=mB(l),h=3*(d*(r-t)+u*(s-r)+c*(o-s)),f=3*(d*(n-e)+u*(i-n)+c*(a-i));return Math.atan2(f,h)},l7=(t,e,r,n,s,i)=>o=>{const a=fB(o),l=pB(o),c=mB(o);return new Ce(s*a+r*l+t*c,i*a+n*l+e*c)},c7=(t,e,r,n,s,i)=>o=>{const a=1-o,l=2*(a*(r-t)+o*(s-r)),c=2*(a*(n-e)+o*(i-n));return Math.atan2(c,l)},xD=(t,e,r)=>{let n=new Ce(e,r),s=0;for(let i=1;i<=100;i+=1){const o=t(i/100);s+=Lg(n.x,n.y,o.x,o.y),n=o}return s},u7=(t,e)=>{let r,n=0,s=0,i={x:t.x,y:t.y},o=ge({},i),a=.01,l=0;const c=t.iterator,u=t.angleFinder;for(;s<e&&a>1e-4;)o=c(n),l=n,r=Lg(i.x,i.y,o.x,o.y),r+s>e?(n-=a,a/=2):(i=o,n+=a,s+=r);return ge(ge({},o),{},{angle:u(l)})},gB=t=>{let e,r,n=0,s=0,i=0,o=0,a=0;const l=[];for(const c of t){const u={x:s,y:i,command:c[0],length:0};switch(c[0]){case"M":r=u,r.x=o=s=c[1],r.y=a=i=c[2];break;case"L":r=u,r.length=Lg(s,i,c[1],c[2]),s=c[1],i=c[2];break;case"C":e=hB(s,i,c[1],c[2],c[3],c[4],c[5],c[6]),r=u,r.iterator=e,r.angleFinder=a7(s,i,c[1],c[2],c[3],c[4],c[5],c[6]),r.length=xD(e,s,i),s=c[5],i=c[6];break;case"Q":e=l7(s,i,c[1],c[2],c[3],c[4]),r=u,r.iterator=e,r.angleFinder=c7(s,i,c[1],c[2],c[3],c[4]),r.length=xD(e,s,i),s=c[3],i=c[4];break;case"Z":r=u,r.destX=o,r.destY=a,r.length=Lg(s,i,o,a),s=o,i=a}n+=r.length,l.push(r)}return l.push({length:n,x:s,y:i}),l},d7=function(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:gB(t),n=0;for(;e-r[n].length>0&&n<r.length-2;)e-=r[n].length,n++;const s=r[n],i=e/s.length,o=t[n];switch(s.command){case"M":return{x:s.x,y:s.y,angle:0};case"Z":return ge(ge({},new Ce(s.x,s.y).lerp(new Ce(s.destX,s.destY),i)),{},{angle:Math.atan2(s.destY-s.y,s.destX-s.x)});case"L":return ge(ge({},new Ce(s.x,s.y).lerp(new Ce(o[1],o[2]),i)),{},{angle:Math.atan2(o[2]-s.y,o[1]-s.x)});case"C":case"Q":return u7(s,e)}},h7=new RegExp("[mzlhvcsqta][^mzlhvcsqta]*","gi"),bD=new RegExp(r7,"g"),f7=new RegExp(Di,"gi"),p7={m:2,l:2,h:1,v:1,c:6,s:4,q:4,t:2,a:7},m7=t=>{var e;const r=[],n=(e=t.match(h7))!==null&&e!==void 0?e:[];for(const s of n){const i=s[0];if(i==="z"||i==="Z"){r.push([i]);continue}const o=p7[i.toLowerCase()];let a=[];if(i==="a"||i==="A"){bD.lastIndex=0;for(let l=null;l=bD.exec(s);)a.push(...l.slice(1))}else a=s.match(f7)||[];for(let l=0;l<a.length;l+=o){const c=new Array(o),u=n7[i];c[0]=l>0&&u?u:i;for(let d=0;d<o;d++)c[d+1]=parseFloat(a[l+d]);r.push(c)}}return r},g7=(t,e)=>t.map(r=>r.map((n,s)=>s===0||e===void 0?n:Fr(n,e)).join(" ")).join(" ");function Ox(t,e){const r=t.style;r&&e&&(typeof e=="string"?r.cssText+=";"+e:Object.entries(e).forEach(n=>{let[s,i]=n;return r.setProperty(s,i)}))}class _7 extends Hz{constructor(e){let{allowTouchScrolling:r=!1,containerClass:n=""}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(e),fe(this,"upper",void 0),fe(this,"container",void 0);const{el:s}=this.lower,i=this.createUpperCanvas();this.upper={el:i,ctx:i.getContext("2d")},this.applyCanvasStyle(s,{allowTouchScrolling:r}),this.applyCanvasStyle(i,{allowTouchScrolling:r,styles:{position:"absolute",left:"0",top:"0"}});const o=this.createContainerElement();o.classList.add(n),s.parentNode&&s.parentNode.replaceChild(o,s),o.append(s,i),this.container=o}createUpperCanvas(){const{el:e}=this.lower,r=Wo();return r.className=e.className,r.classList.remove("lower-canvas"),r.classList.add("upper-canvas"),r.setAttribute("data-fabric","top"),r.style.cssText=e.style.cssText,r.setAttribute("draggable","true"),r}createContainerElement(){const e=zu().createElement("div");return e.setAttribute("data-fabric","wrapper"),Ox(e,{position:"relative"}),KO(e),e}applyCanvasStyle(e,r){const{styles:n,allowTouchScrolling:s}=r;Ox(e,ge(ge({},n),{},{"touch-action":s?"manipulation":gs})),KO(e)}setDimensions(e,r){super.setDimensions(e,r);const{el:n,ctx:s}=this.upper;Gz(n,s,e,r)}setCSSDimensions(e){super.setCSSDimensions(e),Tx(this.upper.el,e),Tx(this.container,e)}cleanupDOM(e){const r=this.container,{el:n}=this.lower,{el:s}=this.upper;super.cleanupDOM(e),r.removeChild(s),r.removeChild(n),r.parentNode&&r.parentNode.replaceChild(n,r)}dispose(){super.dispose(),po().dispose(this.upper.el),delete this.upper,delete this.container}}class E_ extends cf{constructor(){super(...arguments),fe(this,"targets",[]),fe(this,"_hoveredTargets",[]),fe(this,"_objectsToRender",void 0),fe(this,"_currentTransform",null),fe(this,"_groupSelector",null),fe(this,"contextTopDirty",!1)}static getDefaults(){return ge(ge({},super.getDefaults()),E_.ownDefaults)}get upperCanvasEl(){var e;return(e=this.elements.upper)===null||e===void 0?void 0:e.el}get contextTop(){var e;return(e=this.elements.upper)===null||e===void 0?void 0:e.ctx}get wrapperEl(){return this.elements.container}initElements(e){this.elements=new _7(e,{allowTouchScrolling:this.allowTouchScrolling,containerClass:this.containerClass}),this._createCacheCanvas()}_onObjectAdded(e){this._objectsToRender=void 0,super._onObjectAdded(e)}_onObjectRemoved(e){this._objectsToRender=void 0,e===this._activeObject&&(this.fire("before:selection:cleared",{deselected:[e]}),this._discardActiveObject(),this.fire("selection:cleared",{deselected:[e]}),e.fire("deselected",{target:e})),e===this._hoveredTarget&&(this._hoveredTarget=void 0,this._hoveredTargets=[]),super._onObjectRemoved(e)}_onStackOrderChanged(){this._objectsToRender=void 0,super._onStackOrderChanged()}_chooseObjectsToRender(){const e=this._activeObject;return!this.preserveObjectStacking&&e?this._objects.filter(r=>!r.group&&r!==e).concat(e):this._objects}renderAll(){this.cancelRequestedRender(),this.destroyed||(!this.contextTopDirty||this._groupSelector||this.isDrawingMode||(this.clearContext(this.contextTop),this.contextTopDirty=!1),this.hasLostContext&&(this.renderTopLayer(this.contextTop),this.hasLostContext=!1),!this._objectsToRender&&(this._objectsToRender=this._chooseObjectsToRender()),this.renderCanvas(this.getContext(),this._objectsToRender))}renderTopLayer(e){e.save(),this.isDrawingMode&&this._isCurrentlyDrawing&&(this.freeDrawingBrush&&this.freeDrawingBrush._render(),this.contextTopDirty=!0),this.selection&&this._groupSelector&&(this._drawSelection(e),this.contextTopDirty=!0),e.restore()}renderTop(){const e=this.contextTop;this.clearContext(e),this.renderTopLayer(e),this.fire("after:render",{ctx:e})}setTargetFindTolerance(e){e=Math.round(e),this.targetFindTolerance=e;const r=this.getRetinaScaling(),n=Math.ceil((2*e+1)*r);this.pixelFindCanvasEl.width=this.pixelFindCanvasEl.height=n,this.pixelFindContext.scale(r,r)}isTargetTransparent(e,r,n){const s=this.targetFindTolerance,i=this.pixelFindContext;this.clearContext(i),i.save(),i.translate(-r+s,-n+s),i.transform(...this.viewportTransform);const o=e.selectionBackgroundColor;e.selectionBackgroundColor="",e.render(i),e.selectionBackgroundColor=o,i.restore();const a=Math.round(s*this.getRetinaScaling());return xq(i,a,a,a)}_isSelectionKeyPressed(e){const r=this.selectionKey;return!!r&&(Array.isArray(r)?!!r.find(n=>!!n&&e[n]===!0):e[r])}_shouldClearSelection(e,r){const n=this.getActiveObjects(),s=this._activeObject;return!!(!r||r&&s&&n.length>1&&n.indexOf(r)===-1&&s!==r&&!this._isSelectionKeyPressed(e)||r&&!r.evented||r&&!r.selectable&&s&&s!==r)}_shouldCenterTransform(e,r,n){if(!e)return;let s;return r===w_||r===vs||r===oi||r===Wh?s=this.centeredScaling||e.centeredScaling:r===Ub&&(s=this.centeredRotation||e.centeredRotation),s?!n:n}_getOriginFromCorner(e,r){const n={x:e.originX,y:e.originY};return r&&(["ml","tl","bl"].includes(r)?n.x=tn:["mr","tr","br"].includes(r)&&(n.x=pr),["tl","mt","tr"].includes(r)?n.y=Mx:["bl","mb","br"].includes(r)&&(n.y=ms)),n}_setupCurrentTransform(e,r,n){var s;const i=r.group?iu(this.getScenePoint(e),void 0,r.group.calcTransformMatrix()):this.getScenePoint(e),{key:o="",control:a}=r.getActiveControl()||{},l=n&&a?(s=a.getActionHandler(e,r,a))===null||s===void 0?void 0:s.bind(a):NX,c=((f,p,m,y)=>{if(!p||!f)return"drag";const g=y.controls[p];return g.getActionName(m,g,y)})(n,o,e,r),u=e[this.centeredKey],d=this._shouldCenterTransform(r,c,u)?{x:Wt,y:Wt}:this._getOriginFromCorner(r,o),h={target:r,action:c,actionHandler:l,actionPerformed:!1,corner:o,scaleX:r.scaleX,scaleY:r.scaleY,skewX:r.skewX,skewY:r.skewY,offsetX:i.x-r.left,offsetY:i.y-r.top,originX:d.x,originY:d.y,ex:i.x,ey:i.y,lastX:i.x,lastY:i.y,theta:nn(r.angle),width:r.width,height:r.height,shiftKey:e.shiftKey,altKey:u,original:ge(ge({},Kz(r)),{},{originX:d.x,originY:d.y})};this._currentTransform=h,this.fire("before:transform",{e,transform:h})}setCursor(e){this.upperCanvasEl.style.cursor=e}_drawSelection(e){const{x:r,y:n,deltaX:s,deltaY:i}=this._groupSelector,o=new Ce(r,n).transform(this.viewportTransform),a=new Ce(r+s,n+i).transform(this.viewportTransform),l=this.selectionLineWidth/2;let c=Math.min(o.x,a.x),u=Math.min(o.y,a.y),d=Math.max(o.x,a.x),h=Math.max(o.y,a.y);this.selectionColor&&(e.fillStyle=this.selectionColor,e.fillRect(c,u,d-c,h-u)),this.selectionLineWidth&&this.selectionBorderColor&&(e.lineWidth=this.selectionLineWidth,e.strokeStyle=this.selectionBorderColor,c+=l,u+=l,d-=l,h-=l,Gn.prototype._setLineDash.call(this,e,this.selectionDashArray),e.strokeRect(c,u,d-c,h-u))}findTarget(e){if(this.skipTargetFind)return;const r=this.getViewportPoint(e),n=this._activeObject,s=this.getActiveObjects();if(this.targets=[],n&&s.length>=1){if(n.findControl(r,Cx(e))||s.length>1&&this.searchPossibleTargets([n],r))return n;if(n===this.searchPossibleTargets([n],r)){if(this.preserveObjectStacking){const i=this.targets;this.targets=[];const o=this.searchPossibleTargets(this._objects,r);return e[this.altSelectionKey]&&o&&o!==n?(this.targets=i,n):o}return n}}return this.searchPossibleTargets(this._objects,r)}_pointIsInObjectSelectionArea(e,r){let n=e.getCoords();const s=this.getZoom(),i=e.padding/s;if(i){const[o,a,l,c]=n,u=Math.atan2(a.y-o.y,a.x-o.x),d=Bo(u)*i,h=Vo(u)*i,f=d+h,p=d-h;n=[new Ce(o.x-p,o.y-f),new Ce(a.x+f,a.y-p),new Ce(l.x+p,l.y+f),new Ce(c.x-f,c.y+p)]}return Nr.isPointInPolygon(r,n)}_checkTarget(e,r){return!!(e&&e.visible&&e.evented&&this._pointIsInObjectSelectionArea(e,iu(r,void 0,this.viewportTransform))&&(!this.perPixelTargetFind&&!e.perPixelTargetFind||e.isEditing||!this.isTargetTransparent(e,r.x,r.y)))}_searchPossibleTargets(e,r){let n=e.length;for(;n--;){const s=e[n];if(this._checkTarget(s,r)){if(Rm(s)&&s.subTargetCheck){const i=this._searchPossibleTargets(s._objects,r);i&&this.targets.push(i)}return s}}}searchPossibleTargets(e,r){const n=this._searchPossibleTargets(e,r);if(n&&Rm(n)&&n.interactive&&this.targets[0]){const s=this.targets;for(let i=s.length-1;i>0;i--){const o=s[i];if(!Rm(o)||!o.interactive)return o}return s[0]}return n}getViewportPoint(e){return this._pointer?this._pointer:this.getPointer(e,!0)}getScenePoint(e){return this._absolutePointer?this._absolutePointer:this.getPointer(e)}getPointer(e){let r=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const n=this.upperCanvasEl,s=n.getBoundingClientRect();let i=OX(e),o=s.width||0,a=s.height||0;o&&a||(ms in s&&Mx in s&&(a=Math.abs(s.top-s.bottom)),tn in s&&pr in s&&(o=Math.abs(s.right-s.left))),this.calcOffset(),i.x=i.x-this._offset.left,i.y=i.y-this._offset.top,r||(i=iu(i,void 0,this.viewportTransform));const l=this.getRetinaScaling();l!==1&&(i.x/=l,i.y/=l);const c=o===0||a===0?new Ce(1,1):new Ce(n.width/o,n.height/a);return i.multiply(c)}_setDimensionsImpl(e,r){this._resetTransformEventData(),super._setDimensionsImpl(e,r),this._isCurrentlyDrawing&&this.freeDrawingBrush&&this.freeDrawingBrush._setBrushStyles(this.contextTop)}_createCacheCanvas(){this.pixelFindCanvasEl=Wo(),this.pixelFindContext=this.pixelFindCanvasEl.getContext("2d",{willReadFrequently:!0}),this.setTargetFindTolerance(this.targetFindTolerance)}getTopContext(){return this.elements.upper.ctx}getSelectionContext(){return this.elements.upper.ctx}getSelectionElement(){return this.elements.upper.el}getActiveObject(){return this._activeObject}getActiveObjects(){const e=this._activeObject;return El(e)?e.getObjects():e?[e]:[]}_fireSelectionEvents(e,r){let n=!1,s=!1;const i=this.getActiveObjects(),o=[],a=[];e.forEach(l=>{i.includes(l)||(n=!0,l.fire("deselected",{e:r,target:l}),a.push(l))}),i.forEach(l=>{e.includes(l)||(n=!0,l.fire("selected",{e:r,target:l}),o.push(l))}),e.length>0&&i.length>0?(s=!0,n&&this.fire("selection:updated",{e:r,selected:o,deselected:a})):i.length>0?(s=!0,this.fire("selection:created",{e:r,selected:o})):e.length>0&&(s=!0,this.fire("selection:cleared",{e:r,deselected:a})),s&&(this._objectsToRender=void 0)}setActiveObject(e,r){const n=this.getActiveObjects(),s=this._setActiveObject(e,r);return this._fireSelectionEvents(n,r),s}_setActiveObject(e,r){const n=this._activeObject;return n!==e&&!(!this._discardActiveObject(r,e)&&this._activeObject)&&!e.onSelect({e:r})&&(this._activeObject=e,El(e)&&n!==e&&e.set("canvas",this),e.setCoords(),!0)}_discardActiveObject(e,r){const n=this._activeObject;return!!n&&!n.onDeselect({e,object:r})&&(this._currentTransform&&this._currentTransform.target===n&&this.endCurrentTransform(e),El(n)&&n===this._hoveredTarget&&(this._hoveredTarget=void 0),this._activeObject=void 0,!0)}discardActiveObject(e){const r=this.getActiveObjects(),n=this.getActiveObject();r.length&&this.fire("before:selection:cleared",{e,deselected:[n]});const s=this._discardActiveObject(e);return this._fireSelectionEvents(r,e),s}endCurrentTransform(e){const r=this._currentTransform;this._finalizeCurrentTransform(e),r&&r.target&&(r.target.isMoving=!1),this._currentTransform=null}_finalizeCurrentTransform(e){const r=this._currentTransform,n=r.target,s={e,target:n,transform:r,action:r.action};n._scaling&&(n._scaling=!1),n.setCoords(),r.actionPerformed&&(this.fire("object:modified",s),n.fire(kg,s))}setViewportTransform(e){super.setViewportTransform(e);const r=this._activeObject;r&&r.setCoords()}destroy(){const e=this._activeObject;El(e)&&(e.removeAll(),e.dispose()),delete this._activeObject,super.destroy(),this.pixelFindContext=null,this.pixelFindCanvasEl=void 0}clear(){this.discardActiveObject(),this._activeObject=void 0,this.clearContext(this.contextTop),super.clear()}drawControls(e){const r=this._activeObject;r&&r._renderControls(e)}_toObject(e,r,n){const s=this._realizeGroupTransformOnObject(e),i=super._toObject(e,r,n);return e.set(s),i}_realizeGroupTransformOnObject(e){const{group:r}=e;if(r&&El(r)&&this._activeObject===r){const n=Uu(e,["angle","flipX","flipY",pr,vs,oi,Bu,Vu,ms]);return IX(e,r.calcOwnMatrix()),n}return{}}_setSVGObject(e,r,n){const s=this._realizeGroupTransformOnObject(r);super._setSVGObject(e,r,n),r.set(s)}}fe(E_,"ownDefaults",{uniformScaling:!0,uniScaleKey:"shiftKey",centeredScaling:!1,centeredRotation:!1,centeredKey:"altKey",altActionKey:"shiftKey",selection:!0,selectionKey:"shiftKey",selectionColor:"rgba(100, 100, 255, 0.3)",selectionDashArray:[],selectionBorderColor:"rgba(255, 255, 255, 0.3)",selectionLineWidth:1,selectionFullyContained:!1,hoverCursor:"move",moveCursor:"move",defaultCursor:"default",freeDrawingCursor:"crosshair",notAllowedCursor:"not-allowed",perPixelTargetFind:!1,targetFindTolerance:0,skipTargetFind:!1,stopContextMenu:!1,fireRightClick:!1,fireMiddleClick:!1,enablePointerEvents:!1,containerClass:"canvas-container",preserveObjectStacking:!1});class y7{constructor(e){fe(this,"targets",[]),fe(this,"__disposer",void 0);const r=()=>{const{hiddenTextarea:s}=e.getActiveObject()||{};s&&s.focus()},n=e.upperCanvasEl;n.addEventListener("click",r),this.__disposer=()=>n.removeEventListener("click",r)}exitTextEditing(){this.target=void 0,this.targets.forEach(e=>{e.isEditing&&e.exitEditing()})}add(e){this.targets.push(e)}remove(e){this.unregister(e),$c(this.targets,e)}register(e){this.target=e}unregister(e){e===this.target&&(this.target=void 0)}onMouseMove(e){var r;!((r=this.target)===null||r===void 0)&&r.isEditing&&this.target.updateSelectionOnMouseMove(e)}clear(){this.targets=[],this.target=void 0}dispose(){this.clear(),this.__disposer(),delete this.__disposer}}const v7=["target","oldTarget","fireCanvas","e"],Cs={passive:!1},Cc=(t,e)=>{const r=t.getViewportPoint(e),n=t.getScenePoint(e);return{viewportPoint:r,scenePoint:n,pointer:r,absolutePointer:n}},ha=function(t){for(var e=arguments.length,r=new Array(e>1?e-1:0),n=1;n<e;n++)r[n-1]=arguments[n];return t.addEventListener(...r)},Xs=function(t){for(var e=arguments.length,r=new Array(e>1?e-1:0),n=1;n<e;n++)r[n-1]=arguments[n];return t.removeEventListener(...r)},w7={mouse:{in:"over",out:"out",targetIn:"mouseover",targetOut:"mouseout",canvasIn:"mouse:over",canvasOut:"mouse:out"},drag:{in:"enter",out:"leave",targetIn:"dragenter",targetOut:"dragleave",canvasIn:"drag:enter",canvasOut:"drag:leave"}};class Rg extends E_{constructor(e){super(e,arguments.length>1&&arguments[1]!==void 0?arguments[1]:{}),fe(this,"_isClick",void 0),fe(this,"textEditingManager",new y7(this)),["_onMouseDown","_onTouchStart","_onMouseMove","_onMouseUp","_onTouchEnd","_onResize","_onMouseWheel","_onMouseOut","_onMouseEnter","_onContextMenu","_onClick","_onDragStart","_onDragEnd","_onDragProgress","_onDragOver","_onDragEnter","_onDragLeave","_onDrop"].forEach(r=>{this[r]=this[r].bind(this)}),this.addOrRemove(ha,"add")}_getEventPrefix(){return this.enablePointerEvents?"pointer":"mouse"}addOrRemove(e,r){const n=this.upperCanvasEl,s=this._getEventPrefix();e(Uz(n),"resize",this._onResize),e(n,s+"down",this._onMouseDown),e(n,"".concat(s,"move"),this._onMouseMove,Cs),e(n,"".concat(s,"out"),this._onMouseOut),e(n,"".concat(s,"enter"),this._onMouseEnter),e(n,"wheel",this._onMouseWheel),e(n,"contextmenu",this._onContextMenu),e(n,"click",this._onClick),e(n,"dblclick",this._onClick),e(n,"dragstart",this._onDragStart),e(n,"dragend",this._onDragEnd),e(n,"dragover",this._onDragOver),e(n,"dragenter",this._onDragEnter),e(n,"dragleave",this._onDragLeave),e(n,"drop",this._onDrop),this.enablePointerEvents||e(n,"touchstart",this._onTouchStart,Cs)}removeListeners(){this.addOrRemove(Xs,"remove");const e=this._getEventPrefix(),r=$i(this.upperCanvasEl);Xs(r,"".concat(e,"up"),this._onMouseUp),Xs(r,"touchend",this._onTouchEnd,Cs),Xs(r,"".concat(e,"move"),this._onMouseMove,Cs),Xs(r,"touchmove",this._onMouseMove,Cs),clearTimeout(this._willAddMouseDown)}_onMouseWheel(e){this.__onMouseWheel(e)}_onMouseOut(e){const r=this._hoveredTarget,n=ge({e},Cc(this,e));this.fire("mouse:out",ge(ge({},n),{},{target:r})),this._hoveredTarget=void 0,r&&r.fire("mouseout",ge({},n)),this._hoveredTargets.forEach(s=>{this.fire("mouse:out",ge(ge({},n),{},{target:s})),s&&s.fire("mouseout",ge({},n))}),this._hoveredTargets=[]}_onMouseEnter(e){this._currentTransform||this.findTarget(e)||(this.fire("mouse:over",ge({e},Cc(this,e))),this._hoveredTarget=void 0,this._hoveredTargets=[])}_onDragStart(e){this._isClick=!1;const r=this.getActiveObject();if(r&&r.onDragStart(e)){this._dragSource=r;const n={e,target:r};return this.fire("dragstart",n),r.fire("dragstart",n),void ha(this.upperCanvasEl,"drag",this._onDragProgress)}XO(e)}_renderDragEffects(e,r,n){let s=!1;const i=this._dropTarget;i&&i!==r&&i!==n&&(i.clearContextTop(),s=!0),r==null||r.clearContextTop(),n!==r&&(n==null||n.clearContextTop());const o=this.contextTop;o.save(),o.transform(...this.viewportTransform),r&&(o.save(),r.transform(o),r.renderDragSourceEffect(e),o.restore(),s=!0),n&&(o.save(),n.transform(o),n.renderDropTargetEffect(e),o.restore(),s=!0),o.restore(),s&&(this.contextTopDirty=!0)}_onDragEnd(e){const r=!!e.dataTransfer&&e.dataTransfer.dropEffect!==gs,n=r?this._activeObject:void 0,s={e,target:this._dragSource,subTargets:this.targets,dragSource:this._dragSource,didDrop:r,dropTarget:n};Xs(this.upperCanvasEl,"drag",this._onDragProgress),this.fire("dragend",s),this._dragSource&&this._dragSource.fire("dragend",s),delete this._dragSource,this._onMouseUp(e)}_onDragProgress(e){const r={e,target:this._dragSource,dragSource:this._dragSource,dropTarget:this._draggedoverTarget};this.fire("drag",r),this._dragSource&&this._dragSource.fire("drag",r)}findDragTargets(e){return this.targets=[],{target:this._searchPossibleTargets(this._objects,this.getViewportPoint(e)),targets:[...this.targets]}}_onDragOver(e){const r="dragover",{target:n,targets:s}=this.findDragTargets(e),i=this._dragSource,o={e,target:n,subTargets:s,dragSource:i,canDrop:!1,dropTarget:void 0};let a;this.fire(r,o),this._fireEnterLeaveEvents(n,o),n&&(n.canDrop(e)&&(a=n),n.fire(r,o));for(let l=0;l<s.length;l++){const c=s[l];c.canDrop(e)&&(a=c),c.fire(r,o)}this._renderDragEffects(e,i,a),this._dropTarget=a}_onDragEnter(e){const{target:r,targets:n}=this.findDragTargets(e),s={e,target:r,subTargets:n,dragSource:this._dragSource};this.fire("dragenter",s),this._fireEnterLeaveEvents(r,s)}_onDragLeave(e){const r={e,target:this._draggedoverTarget,subTargets:this.targets,dragSource:this._dragSource};this.fire("dragleave",r),this._fireEnterLeaveEvents(void 0,r),this._renderDragEffects(e,this._dragSource),this._dropTarget=void 0,this.targets=[],this._hoveredTargets=[]}_onDrop(e){const{target:r,targets:n}=this.findDragTargets(e),s=this._basicEventHandler("drop:before",ge({e,target:r,subTargets:n,dragSource:this._dragSource},Cc(this,e)));s.didDrop=!1,s.dropTarget=void 0,this._basicEventHandler("drop",s),this.fire("drop:after",s)}_onContextMenu(e){const r=this.findTarget(e),n=this.targets||[],s=this._basicEventHandler("contextmenu:before",{e,target:r,subTargets:n});return this.stopContextMenu&&XO(e),this._basicEventHandler("contextmenu",s),!1}_onClick(e){const r=e.detail;r>3||r<2||(this._cacheTransformEventData(e),r==2&&e.type==="dblclick"&&this._handleEvent(e,"dblclick"),r==3&&this._handleEvent(e,"tripleclick"),this._resetTransformEventData())}getPointerId(e){const r=e.changedTouches;return r?r[0]&&r[0].identifier:this.enablePointerEvents?e.pointerId:-1}_isMainEvent(e){return e.isPrimary===!0||e.isPrimary!==!1&&(e.type==="touchend"&&e.touches.length===0||!e.changedTouches||e.changedTouches[0].identifier===this.mainTouchId)}_onTouchStart(e){let r=!this.allowTouchScrolling;const n=this._activeObject;this.mainTouchId===void 0&&(this.mainTouchId=this.getPointerId(e)),this.__onMouseDown(e),(this.isDrawingMode||n&&this._target===n)&&(r=!0),r&&e.preventDefault(),this._resetTransformEventData();const s=this.upperCanvasEl,i=this._getEventPrefix(),o=$i(s);ha(o,"touchend",this._onTouchEnd,Cs),r&&ha(o,"touchmove",this._onMouseMove,Cs),Xs(s,"".concat(i,"down"),this._onMouseDown)}_onMouseDown(e){this.__onMouseDown(e),this._resetTransformEventData();const r=this.upperCanvasEl,n=this._getEventPrefix();Xs(r,"".concat(n,"move"),this._onMouseMove,Cs);const s=$i(r);ha(s,"".concat(n,"up"),this._onMouseUp),ha(s,"".concat(n,"move"),this._onMouseMove,Cs)}_onTouchEnd(e){if(e.touches.length>0)return;this.__onMouseUp(e),this._resetTransformEventData(),delete this.mainTouchId;const r=this._getEventPrefix(),n=$i(this.upperCanvasEl);Xs(n,"touchend",this._onTouchEnd,Cs),Xs(n,"touchmove",this._onMouseMove,Cs),this._willAddMouseDown&&clearTimeout(this._willAddMouseDown),this._willAddMouseDown=setTimeout(()=>{ha(this.upperCanvasEl,"".concat(r,"down"),this._onMouseDown),this._willAddMouseDown=0},400)}_onMouseUp(e){this.__onMouseUp(e),this._resetTransformEventData();const r=this.upperCanvasEl,n=this._getEventPrefix();if(this._isMainEvent(e)){const s=$i(this.upperCanvasEl);Xs(s,"".concat(n,"up"),this._onMouseUp),Xs(s,"".concat(n,"move"),this._onMouseMove,Cs),ha(r,"".concat(n,"move"),this._onMouseMove,Cs)}}_onMouseMove(e){const r=this.getActiveObject();!this.allowTouchScrolling&&(!r||!r.shouldStartDragging(e))&&e.preventDefault&&e.preventDefault(),this.__onMouseMove(e)}_onResize(){this.calcOffset(),this._resetTransformEventData()}_shouldRender(e){const r=this.getActiveObject();return!!r!=!!e||r&&e&&r!==e}__onMouseUp(e){var r;this._cacheTransformEventData(e),this._handleEvent(e,"up:before");const n=this._currentTransform,s=this._isClick,i=this._target,{button:o}=e;if(o)return(this.fireMiddleClick&&o===1||this.fireRightClick&&o===2)&&this._handleEvent(e,"up"),void this._resetTransformEventData();if(this.isDrawingMode&&this._isCurrentlyDrawing)return void this._onMouseUpInDrawingMode(e);if(!this._isMainEvent(e))return;let a,l,c=!1;if(n&&(this._finalizeCurrentTransform(e),c=n.actionPerformed),!s){const u=i===this._activeObject;this.handleSelection(e),c||(c=this._shouldRender(i)||!u&&i===this._activeObject)}if(i){const u=i.findControl(this.getViewportPoint(e),Cx(e)),{key:d,control:h}=u||{};if(l=d,i.selectable&&i!==this._activeObject&&i.activeOn==="up")this.setActiveObject(i,e),c=!0;else if(h){const f=h.getMouseUpHandler(e,i,h);f&&(a=this.getScenePoint(e),f.call(h,e,n,a.x,a.y))}i.isMoving=!1}if(n&&(n.target!==i||n.corner!==l)){const u=n.target&&n.target.controls[n.corner],d=u&&u.getMouseUpHandler(e,n.target,u);a=a||this.getScenePoint(e),d&&d.call(u,e,n,a.x,a.y)}this._setCursorFromEvent(e,i),this._handleEvent(e,"up"),this._groupSelector=null,this._currentTransform=null,i&&(i.__corner=void 0),c?this.requestRenderAll():s||(r=this._activeObject)!==null&&r!==void 0&&r.isEditing||this.renderTop()}_basicEventHandler(e,r){const{target:n,subTargets:s=[]}=r;this.fire(e,r),n&&n.fire(e,r);for(let i=0;i<s.length;i++)s[i]!==n&&s[i].fire(e,r);return r}_handleEvent(e,r,n){const s=this._target,i=this.targets||[],o=ge(ge(ge({e,target:s,subTargets:i},Cc(this,e)),{},{transform:this._currentTransform},r==="up:before"||r==="up"?{isClick:this._isClick,currentTarget:this.findTarget(e),currentSubTargets:this.targets}:{}),r==="down:before"||r==="down"?n:{});this.fire("mouse:".concat(r),o),s&&s.fire("mouse".concat(r),o);for(let a=0;a<i.length;a++)i[a]!==s&&i[a].fire("mouse".concat(r),o)}_onMouseDownInDrawingMode(e){this._isCurrentlyDrawing=!0,this.getActiveObject()&&(this.discardActiveObject(e),this.requestRenderAll());const r=this.getScenePoint(e);this.freeDrawingBrush&&this.freeDrawingBrush.onMouseDown(r,{e,pointer:r}),this._handleEvent(e,"down",{alreadySelected:!1})}_onMouseMoveInDrawingMode(e){if(this._isCurrentlyDrawing){const r=this.getScenePoint(e);this.freeDrawingBrush&&this.freeDrawingBrush.onMouseMove(r,{e,pointer:r})}this.setCursor(this.freeDrawingCursor),this._handleEvent(e,"move")}_onMouseUpInDrawingMode(e){const r=this.getScenePoint(e);this.freeDrawingBrush?this._isCurrentlyDrawing=!!this.freeDrawingBrush.onMouseUp({e,pointer:r}):this._isCurrentlyDrawing=!1,this._handleEvent(e,"up")}__onMouseDown(e){this._isClick=!0,this._cacheTransformEventData(e),this._handleEvent(e,"down:before");let r=this._target,n=!!r&&r===this._activeObject;const{button:s}=e;if(s)return(this.fireMiddleClick&&s===1||this.fireRightClick&&s===2)&&this._handleEvent(e,"down",{alreadySelected:n}),void this._resetTransformEventData();if(this.isDrawingMode)return void this._onMouseDownInDrawingMode(e);if(!this._isMainEvent(e)||this._currentTransform)return;let i=this._shouldRender(r),o=!1;if(this.handleMultiSelection(e,r)?(r=this._activeObject,o=!0,i=!0):this._shouldClearSelection(e,r)&&this.discardActiveObject(e),this.selection&&(!r||!r.selectable&&!r.isEditing&&r!==this._activeObject)){const a=this.getScenePoint(e);this._groupSelector={x:a.x,y:a.y,deltaY:0,deltaX:0}}if(n=!!r&&r===this._activeObject,r){r.selectable&&r.activeOn==="down"&&this.setActiveObject(r,e);const a=r.findControl(this.getViewportPoint(e),Cx(e));if(r===this._activeObject&&(a||!o)){this._setupCurrentTransform(e,r,n);const l=a?a.control:void 0,c=this.getScenePoint(e),u=l&&l.getMouseDownHandler(e,r,l);u&&u.call(l,e,this._currentTransform,c.x,c.y)}}i&&(this._objectsToRender=void 0),this._handleEvent(e,"down",{alreadySelected:n}),i&&this.requestRenderAll()}_resetTransformEventData(){this._target=this._pointer=this._absolutePointer=void 0}_cacheTransformEventData(e){this._resetTransformEventData(),this._pointer=this.getViewportPoint(e),this._absolutePointer=iu(this._pointer,void 0,this.viewportTransform),this._target=this._currentTransform?this._currentTransform.target:this.findTarget(e)}__onMouseMove(e){if(this._isClick=!1,this._cacheTransformEventData(e),this._handleEvent(e,"move:before"),this.isDrawingMode)return void this._onMouseMoveInDrawingMode(e);if(!this._isMainEvent(e))return;const r=this._groupSelector;if(r){const n=this.getScenePoint(e);r.deltaX=n.x-r.x,r.deltaY=n.y-r.y,this.renderTop()}else if(this._currentTransform)this._transformObject(e);else{const n=this.findTarget(e);this._setCursorFromEvent(e,n),this._fireOverOutEvents(e,n)}this.textEditingManager.onMouseMove(e),this._handleEvent(e,"move"),this._resetTransformEventData()}_fireOverOutEvents(e,r){const n=this._hoveredTarget,s=this._hoveredTargets,i=this.targets,o=Math.max(s.length,i.length);this.fireSyntheticInOutEvents("mouse",{e,target:r,oldTarget:n,fireCanvas:!0});for(let a=0;a<o;a++)this.fireSyntheticInOutEvents("mouse",{e,target:i[a],oldTarget:s[a]});this._hoveredTarget=r,this._hoveredTargets=this.targets.concat()}_fireEnterLeaveEvents(e,r){const n=this._draggedoverTarget,s=this._hoveredTargets,i=this.targets,o=Math.max(s.length,i.length);this.fireSyntheticInOutEvents("drag",ge(ge({},r),{},{target:e,oldTarget:n,fireCanvas:!0}));for(let a=0;a<o;a++)this.fireSyntheticInOutEvents("drag",ge(ge({},r),{},{target:i[a],oldTarget:s[a]}));this._draggedoverTarget=e}fireSyntheticInOutEvents(e,r){let{target:n,oldTarget:s,fireCanvas:i,e:o}=r,a=Lr(r,v7);const{targetIn:l,targetOut:c,canvasIn:u,canvasOut:d}=w7[e],h=s!==n;if(s&&h){const f=ge(ge({},a),{},{e:o,target:s,nextTarget:n},Cc(this,o));i&&this.fire(d,f),s.fire(c,f)}if(n&&h){const f=ge(ge({},a),{},{e:o,target:n,previousTarget:s},Cc(this,o));i&&this.fire(u,f),n.fire(l,f)}}__onMouseWheel(e){this._cacheTransformEventData(e),this._handleEvent(e,"wheel"),this._resetTransformEventData()}_transformObject(e){const r=this.getScenePoint(e),n=this._currentTransform,s=n.target,i=s.group?iu(r,void 0,s.group.calcTransformMatrix()):r;n.shiftKey=e.shiftKey,n.altKey=!!this.centeredKey&&e[this.centeredKey],this._performTransformAction(e,n,i),n.actionPerformed&&this.requestRenderAll()}_performTransformAction(e,r,n){const{action:s,actionHandler:i,target:o}=r,a=!!i&&i(e,r,n.x,n.y);a&&o.setCoords(),s==="drag"&&a&&(r.target.isMoving=!0,this.setCursor(r.target.moveCursor||this.moveCursor)),r.actionPerformed=r.actionPerformed||a}_setCursorFromEvent(e,r){if(!r)return void this.setCursor(this.defaultCursor);let n=r.hoverCursor||this.hoverCursor;const s=El(this._activeObject)?this._activeObject:null,i=(!s||r.group!==s)&&r.findControl(this.getViewportPoint(e));if(i){const o=i.control;this.setCursor(o.cursorStyleHandler(e,o,r))}else r.subTargetCheck&&this.targets.concat().reverse().map(o=>{n=o.hoverCursor||n}),this.setCursor(n)}handleMultiSelection(e,r){const n=this._activeObject,s=El(n);if(n&&this._isSelectionKeyPressed(e)&&this.selection&&r&&r.selectable&&(n!==r||s)&&(s||!r.isDescendantOf(n)&&!n.isDescendantOf(r))&&!r.onSelect({e})&&!n.getActiveControl()){if(s){const i=n.getObjects();if(r===n){const o=this.getViewportPoint(e);if(!(r=this.searchPossibleTargets(i,o)||this.searchPossibleTargets(this._objects,o))||!r.selectable)return!1}r.group===n?(n.remove(r),this._hoveredTarget=r,this._hoveredTargets=[...this.targets],n.size()===1&&this._setActiveObject(n.item(0),e)):(n.multiSelectAdd(r),this._hoveredTarget=n,this._hoveredTargets=[...this.targets]),this._fireSelectionEvents(i,e)}else{n.isEditing&&n.exitEditing();const i=new(ht.getClass("ActiveSelection"))([],{canvas:this});i.multiSelectAdd(n,r),this._hoveredTarget=i,this._setActiveObject(i,e),this._fireSelectionEvents([n],e)}return!0}return!1}handleSelection(e){if(!this.selection||!this._groupSelector)return!1;const{x:r,y:n,deltaX:s,deltaY:i}=this._groupSelector,o=new Ce(r,n),a=o.add(new Ce(s,i)),l=o.min(a),c=o.max(a).subtract(l),u=this.collectObjects({left:l.x,top:l.y,width:c.x,height:c.y},{includeIntersecting:!this.selectionFullyContained}),d=o.eq(a)?u[0]?[u[0]]:[]:u.length>1?u.filter(h=>!h.onSelect({e})).reverse():u;if(d.length===1)this.setActiveObject(d[0],e);else if(d.length>1){const h=ht.getClass("ActiveSelection");this.setActiveObject(new h(d,{canvas:this}),e)}return this._groupSelector=null,!0}clear(){this.textEditingManager.clear(),super.clear()}destroy(){this.removeListeners(),this.textEditingManager.dispose(),super.destroy()}}const _B={x1:0,y1:0,x2:0,y2:0},x7=ge(ge({},_B),{},{r1:0,r2:0}),Kc=(t,e)=>isNaN(t)&&typeof e=="number"?e:t,b7=/^(\d+\.\d+)%|(\d+)%$/;function yB(t){return t&&b7.test(t)}function vB(t,e){const r=typeof t=="number"?t:typeof t=="string"?parseFloat(t)/(yB(t)?100:1):NaN;return Au(0,Kc(r,e),1)}const M7=/\s*;\s*/,T7=/\s*:\s*/;function C7(t,e){let r,n;const s=t.getAttribute("style");if(s){const o=s.split(M7);o[o.length-1]===""&&o.pop();for(let a=o.length;a--;){const[l,c]=o[a].split(T7).map(u=>u.trim());l==="stop-color"?r=c:l==="stop-opacity"&&(n=c)}}const i=new _r(r||t.getAttribute("stop-color")||"rgb(0,0,0)");return{offset:vB(t.getAttribute("offset"),0),color:i.toRgb(),opacity:Kc(parseFloat(n||t.getAttribute("stop-opacity")||""),1)*i.getAlpha()*e}}function S7(t,e){const r=[],n=t.getElementsByTagName("stop"),s=vB(e,1);for(let i=n.length;i--;)r.push(C7(n[i],s));return r}function wB(t){return t.nodeName==="linearGradient"||t.nodeName==="LINEARGRADIENT"?"linear":"radial"}function xB(t){return t.getAttribute("gradientUnits")==="userSpaceOnUse"?"pixels":"percentage"}function wi(t,e){return t.getAttribute(e)}function E7(t,e){return function(r,n){let s,{width:i,height:o,gradientUnits:a}=n;return Object.keys(r).reduce((l,c)=>{const u=r[c];return u==="Infinity"?s=1:u==="-Infinity"?s=0:(s=typeof u=="string"?parseFloat(u):u,typeof u=="string"&&yB(u)&&(s*=.01,a==="pixels"&&(c!=="x1"&&c!=="x2"&&c!=="r2"||(s*=i),c!=="y1"&&c!=="y2"||(s*=o)))),l[c]=s,l},{})}(wB(t)==="linear"?function(r){return{x1:wi(r,"x1")||0,y1:wi(r,"y1")||0,x2:wi(r,"x2")||"100%",y2:wi(r,"y2")||0}}(t):function(r){return{x1:wi(r,"fx")||wi(r,"cx")||"50%",y1:wi(r,"fy")||wi(r,"cy")||"50%",r1:0,x2:wi(r,"cx")||"50%",y2:wi(r,"cy")||"50%",r2:wi(r,"r")||"50%"}}(t),ge(ge({},e),{},{gradientUnits:xB(t)}))}class Wp{constructor(e){const{type:r="linear",gradientUnits:n="pixels",coords:s={},colorStops:i=[],offsetX:o=0,offsetY:a=0,gradientTransform:l,id:c}=e||{};Object.assign(this,{type:r,gradientUnits:n,coords:ge(ge({},r==="radial"?x7:_B),s),colorStops:i,offsetX:o,offsetY:a,gradientTransform:l,id:c?"".concat(c,"_").concat(Wa()):Wa()})}addColorStop(e){for(const r in e){const n=new _r(e[r]);this.colorStops.push({offset:parseFloat(r),color:n.toRgb(),opacity:n.getAlpha()})}return this}toObject(e){return ge(ge({},Uu(this,e)),{},{type:this.type,coords:ge({},this.coords),colorStops:this.colorStops.map(r=>ge({},r)),offsetX:this.offsetX,offsetY:this.offsetY,gradientUnits:this.gradientUnits,gradientTransform:this.gradientTransform?[...this.gradientTransform]:void 0})}toSVG(e){let{additionalTransform:r}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const n=[],s=this.gradientTransform?this.gradientTransform.concat():rs.concat(),i=this.gradientUnits==="pixels"?"userSpaceOnUse":"objectBoundingBox",o=this.colorStops.map(d=>ge({},d)).sort((d,h)=>d.offset-h.offset);let a=-this.offsetX,l=-this.offsetY;var c;i==="objectBoundingBox"?(a/=e.width,l/=e.height):(a+=e.width/2,l+=e.height/2),(c=e)&&typeof c._renderPathCommands=="function"&&this.gradientUnits!=="percentage"&&(a-=e.pathOffset.x,l-=e.pathOffset.y),s[4]-=a,s[5]-=l;const u=['id="SVGID_'.concat(this.id,'"'),'gradientUnits="'.concat(i,'"'),'gradientTransform="'.concat(r?r+" ":"").concat(Gh(s),'"'),""].join(" ");if(this.type==="linear"){const{x1:d,y1:h,x2:f,y2:p}=this.coords;n.push("<linearGradient ",u,' x1="',d,'" y1="',h,'" x2="',f,'" y2="',p,`">
`)}else if(this.type==="radial"){const{x1:d,y1:h,x2:f,y2:p,r1:m,r2:y}=this.coords,g=m>y;n.push("<radialGradient ",u,' cx="',g?d:f,'" cy="',g?h:p,'" r="',g?m:y,'" fx="',g?f:d,'" fy="',g?p:h,`">
`),g&&(o.reverse(),o.forEach(v=>{v.offset=1-v.offset}));const _=Math.min(m,y);if(_>0){const v=_/Math.max(m,y);o.forEach(w=>{w.offset+=v*(1-w.offset)})}}return o.forEach(d=>{let{color:h,offset:f,opacity:p}=d;n.push("<stop ",'offset="',100*f+"%",'" style="stop-color:',h,p!==void 0?";stop-opacity: "+p:";",`"/>
`)}),n.push(this.type==="linear"?"</linearGradient>":"</radialGradient>",`
`),n.join("")}toLive(e){const{x1:r,y1:n,x2:s,y2:i,r1:o,r2:a}=this.coords,l=this.type==="linear"?e.createLinearGradient(r,n,s,i):e.createRadialGradient(r,n,o,s,i,a);return this.colorStops.forEach(c=>{let{color:u,opacity:d,offset:h}=c;l.addColorStop(h,d!==void 0?new _r(u).setAlpha(d).toRgba():u)}),l}static async fromObject(e){const{colorStops:r,gradientTransform:n}=e;return new this(ge(ge({},e),{},{colorStops:r?r.map(s=>ge({},s)):void 0,gradientTransform:n?[...n]:void 0}))}static fromElement(e,r,n){const s=xB(e),i=r._findCenterFromElement();return new this(ge({id:e.getAttribute("id")||void 0,type:wB(e),coords:E7(e,{width:n.viewBoxWidth||n.width,height:n.viewBoxHeight||n.height}),colorStops:S7(e,n.opacity),gradientUnits:s,gradientTransform:kx(e.getAttribute("gradientTransform")||"")},s==="pixels"?{offsetX:r.width/2-i.x,offsetY:r.height/2-i.y}:{offsetX:0,offsetY:0}))}}fe(Wp,"type","Gradient"),ht.setClass(Wp,"gradient"),ht.setClass(Wp,"linear"),ht.setClass(Wp,"radial");const P7=["type","source","patternTransform"];class Fv{get type(){return"pattern"}set type(e){Va("warn","Setting type has no effect",e)}constructor(e){fe(this,"repeat","repeat"),fe(this,"offsetX",0),fe(this,"offsetY",0),fe(this,"crossOrigin",""),this.id=Wa(),Object.assign(this,e)}isImageSource(){return!!this.source&&typeof this.source.src=="string"}isCanvasSource(){return!!this.source&&!!this.source.toDataURL}sourceToString(){return this.isImageSource()?this.source.src:this.isCanvasSource()?this.source.toDataURL():""}toLive(e){return this.source&&(!this.isImageSource()||this.source.complete&&this.source.naturalWidth!==0&&this.source.naturalHeight!==0)?e.createPattern(this.source,this.repeat):null}toObject(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];const{repeat:r,crossOrigin:n}=this;return ge(ge({},Uu(this,e)),{},{type:"pattern",source:this.sourceToString(),repeat:r,crossOrigin:n,offsetX:Fr(this.offsetX,dr.NUM_FRACTION_DIGITS),offsetY:Fr(this.offsetY,dr.NUM_FRACTION_DIGITS),patternTransform:this.patternTransform?[...this.patternTransform]:null})}toSVG(e){let{width:r,height:n}=e;const{source:s,repeat:i,id:o}=this,a=Kc(this.offsetX/r,0),l=Kc(this.offsetY/n,0),c=i==="repeat-y"||i==="no-repeat"?1+Math.abs(a||0):Kc(s.width/r,0),u=i==="repeat-x"||i==="no-repeat"?1+Math.abs(l||0):Kc(s.height/n,0);return['<pattern id="SVGID_'.concat(o,'" x="').concat(a,'" y="').concat(l,'" width="').concat(c,'" height="').concat(u,'">'),'<image x="0" y="0" width="'.concat(s.width,'" height="').concat(s.height,'" xlink:href="').concat(this.sourceToString(),'"></image>'),"</pattern>",""].join(`
`)}static async fromObject(e,r){let{type:n,source:s,patternTransform:i}=e,o=Lr(e,P7);const a=await Nm(s,ge(ge({},r),{},{crossOrigin:o.crossOrigin}));return new this(ge(ge({},o),{},{patternTransform:i&&i.slice(0),source:a}))}}fe(Fv,"type","Pattern"),ht.setClass(Fv),ht.setClass(Fv,"pattern");const k7=["path","left","top"],A7=["d"];class Pl extends Gn{constructor(e){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},{path:n,left:s,top:i}=r,o=Lr(r,k7);super(),Object.assign(this,Pl.ownDefaults),this.setOptions(o),this._setPath(e||[],!0),typeof s=="number"&&this.set(pr,s),typeof i=="number"&&this.set(ms,i)}_setPath(e,r){this.path=o7(Array.isArray(e)?e:m7(e)),this.setBoundingBox(r)}_findCenterFromElement(){const e=this._calcBoundsFromPath();return new Ce(e.left+e.width/2,e.top+e.height/2)}_renderPathCommands(e){const r=-this.pathOffset.x,n=-this.pathOffset.y;e.beginPath();for(const s of this.path)switch(s[0]){case"L":e.lineTo(s[1]+r,s[2]+n);break;case"M":e.moveTo(s[1]+r,s[2]+n);break;case"C":e.bezierCurveTo(s[1]+r,s[2]+n,s[3]+r,s[4]+n,s[5]+r,s[6]+n);break;case"Q":e.quadraticCurveTo(s[1]+r,s[2]+n,s[3]+r,s[4]+n);break;case"Z":e.closePath()}}_render(e){this._renderPathCommands(e),this._renderPaintInOrder(e)}toString(){return"#<Path (".concat(this.complexity(),'): { "top": ').concat(this.top,', "left": ').concat(this.left," }>")}toObject(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];return ge(ge({},super.toObject(e)),{},{path:this.path.map(r=>r.slice())})}toDatalessObject(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];const r=this.toObject(e);return this.sourcePath&&(delete r.path,r.sourcePath=this.sourcePath),r}_toSVG(){const e=g7(this.path,dr.NUM_FRACTION_DIGITS);return["<path ","COMMON_PARTS",'d="'.concat(e,`" stroke-linecap="round" />
`)]}_getOffsetTransform(){const e=dr.NUM_FRACTION_DIGITS;return" translate(".concat(Fr(-this.pathOffset.x,e),", ").concat(Fr(-this.pathOffset.y,e),")")}toClipPathSVG(e){const r=this._getOffsetTransform();return"	"+this._createBaseClipPathSVGMarkup(this._toSVG(),{reviver:e,additionalTransform:r})}toSVG(e){const r=this._getOffsetTransform();return this._createBaseSVGMarkup(this._toSVG(),{reviver:e,additionalTransform:r})}complexity(){return this.path.length}setDimensions(){this.setBoundingBox()}setBoundingBox(e){const{width:r,height:n,pathOffset:s}=this._calcDimensions();this.set({width:r,height:n,pathOffset:s}),e&&this.setPositionByOrigin(s,Wt,Wt)}_calcBoundsFromPath(){const e=[];let r=0,n=0,s=0,i=0;for(const o of this.path)switch(o[0]){case"L":s=o[1],i=o[2],e.push({x:r,y:n},{x:s,y:i});break;case"M":s=o[1],i=o[2],r=s,n=i;break;case"C":e.push(...wD(s,i,o[1],o[2],o[3],o[4],o[5],o[6])),s=o[5],i=o[6];break;case"Q":e.push(...wD(s,i,o[1],o[2],o[1],o[2],o[3],o[4])),s=o[3],i=o[4];break;case"Z":s=r,i=n}return Do(e)}_calcDimensions(){const e=this._calcBoundsFromPath();return ge(ge({},e),{},{pathOffset:new Ce(e.left+e.width/2,e.top+e.height/2)})}static fromObject(e){return this._fromObject(e,{extraParam:"path"})}static async fromElement(e,r,n){const s=Xo(e,this.ATTRIBUTE_NAMES,n),{d:i}=s;return new this(i,ge(ge(ge({},Lr(s,A7)),r),{},{left:void 0,top:void 0}))}}fe(Pl,"type","Path"),fe(Pl,"cacheProperties",[...Ko,"path","fillRule"]),fe(Pl,"ATTRIBUTE_NAMES",[...Xa,"d"]),ht.setClass(Pl),ht.setSVGClass(Pl);const $7=["left","top","radius"],bB=["radius","startAngle","endAngle","counterClockwise"];class Co extends Gn{static getDefaults(){return ge(ge({},super.getDefaults()),Co.ownDefaults)}constructor(e){super(),Object.assign(this,Co.ownDefaults),this.setOptions(e)}_set(e,r){return super._set(e,r),e==="radius"&&this.setRadius(r),this}_render(e){e.beginPath(),e.arc(0,0,this.radius,nn(this.startAngle),nn(this.endAngle),this.counterClockwise),this._renderPaintInOrder(e)}getRadiusX(){return this.get("radius")*this.get(vs)}getRadiusY(){return this.get("radius")*this.get(oi)}setRadius(e){this.radius=e,this.set({width:2*e,height:2*e})}toObject(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];return super.toObject([...bB,...e])}_toSVG(){const e=(this.endAngle-this.startAngle)%360;if(e===0)return["<circle ","COMMON_PARTS",'cx="0" cy="0" ','r="',"".concat(this.radius),`" />
`];{const{radius:r}=this,n=nn(this.startAngle),s=nn(this.endAngle),i=Bo(n)*r,o=Vo(n)*r,a=Bo(s)*r,l=Vo(s)*r,c=e>180?1:0,u=this.counterClockwise?0:1;return['<path d="M '.concat(i," ").concat(o," A ").concat(r," ").concat(r," 0 ").concat(c," ").concat(u," ").concat(a," ").concat(l,'" '),"COMMON_PARTS",` />
`]}}static async fromElement(e,r,n){const s=Xo(e,this.ATTRIBUTE_NAMES,n),{left:i=0,top:o=0,radius:a=0}=s;return new this(ge(ge({},Lr(s,$7)),{},{radius:a,left:i-a,top:o-a}))}static fromObject(e){return super._fromObject(e)}}fe(Co,"type","Circle"),fe(Co,"cacheProperties",[...Ko,...bB]),fe(Co,"ownDefaults",{radius:0,startAngle:0,endAngle:360,counterClockwise:!1}),fe(Co,"ATTRIBUTE_NAMES",["cx","cy","r",...Xa]),ht.setClass(Co),ht.setSVGClass(Co);const O7=["x1","y1","x2","y2"],D7=["x1","y1","x2","y2"],Dx=["x1","x2","y1","y2"];class kl extends Gn{constructor(){let[e,r,n,s]=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[0,0,0,0],i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(),Object.assign(this,kl.ownDefaults),this.setOptions(i),this.x1=e,this.x2=n,this.y1=r,this.y2=s,this._setWidthHeight();const{left:o,top:a}=i;typeof o=="number"&&this.set(pr,o),typeof a=="number"&&this.set(ms,a)}_setWidthHeight(){const{x1:e,y1:r,x2:n,y2:s}=this;this.width=Math.abs(n-e),this.height=Math.abs(s-r);const{left:i,top:o,width:a,height:l}=Do([{x:e,y:r},{x:n,y:s}]),c=new Ce(i+a/2,o+l/2);this.setPositionByOrigin(c,Wt,Wt)}_set(e,r){return super._set(e,r),Dx.includes(e)&&this._setWidthHeight(),this}_render(e){e.beginPath();const r=this.calcLinePoints();e.moveTo(r.x1,r.y1),e.lineTo(r.x2,r.y2),e.lineWidth=this.strokeWidth;const n=e.strokeStyle;var s;ei(this.stroke)?e.strokeStyle=this.stroke.toLive(e):e.strokeStyle=(s=this.stroke)!==null&&s!==void 0?s:e.fillStyle,this.stroke&&this._renderStroke(e),e.strokeStyle=n}_findCenterFromElement(){return new Ce((this.x1+this.x2)/2,(this.y1+this.y2)/2)}toObject(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];return ge(ge({},super.toObject(e)),this.calcLinePoints())}_getNonTransformedDimensions(){const e=super._getNonTransformedDimensions();return this.strokeLineCap==="butt"&&(this.width===0&&(e.y-=this.strokeWidth),this.height===0&&(e.x-=this.strokeWidth)),e}calcLinePoints(){const{x1:e,x2:r,y1:n,y2:s,width:i,height:o}=this,a=e<=r?-1:1,l=n<=s?-1:1;return{x1:a*i/2,x2:a*-i/2,y1:l*o/2,y2:l*-o/2}}_toSVG(){const{x1:e,x2:r,y1:n,y2:s}=this.calcLinePoints();return["<line ","COMMON_PARTS",'x1="'.concat(e,'" y1="').concat(n,'" x2="').concat(r,'" y2="').concat(s,`" />
`)]}static async fromElement(e,r,n){const s=Xo(e,this.ATTRIBUTE_NAMES,n),{x1:i=0,y1:o=0,x2:a=0,y2:l=0}=s;return new this([i,o,a,l],Lr(s,O7))}static fromObject(e){let{x1:r,y1:n,x2:s,y2:i}=e,o=Lr(e,D7);return this._fromObject(ge(ge({},o),{},{points:[r,n,s,i]}),{extraParam:"points"})}}fe(kl,"type","Line"),fe(kl,"cacheProperties",[...Ko,...Dx]),fe(kl,"ATTRIBUTE_NAMES",Xa.concat(Dx)),ht.setClass(kl),ht.setSVGClass(kl);class Il extends Gn{static getDefaults(){return ge(ge({},super.getDefaults()),Il.ownDefaults)}constructor(e){super(),Object.assign(this,Il.ownDefaults),this.setOptions(e)}_render(e){const r=this.width/2,n=this.height/2;e.beginPath(),e.moveTo(-r,n),e.lineTo(0,-n),e.lineTo(r,n),e.closePath(),this._renderPaintInOrder(e)}_toSVG(){const e=this.width/2,r=this.height/2;return["<polygon ","COMMON_PARTS",'points="',"".concat(-e," ").concat(r,",0 ").concat(-r,",").concat(e," ").concat(r),'" />']}}fe(Il,"type","Triangle"),fe(Il,"ownDefaults",{width:100,height:100}),ht.setClass(Il),ht.setSVGClass(Il);const MB=["rx","ry"];class So extends Gn{static getDefaults(){return ge(ge({},super.getDefaults()),So.ownDefaults)}constructor(e){super(),Object.assign(this,So.ownDefaults),this.setOptions(e)}_set(e,r){switch(super._set(e,r),e){case"rx":this.rx=r,this.set("width",2*r);break;case"ry":this.ry=r,this.set("height",2*r)}return this}getRx(){return this.get("rx")*this.get(vs)}getRy(){return this.get("ry")*this.get(oi)}toObject(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];return super.toObject([...MB,...e])}_toSVG(){return["<ellipse ","COMMON_PARTS",'cx="0" cy="0" rx="'.concat(this.rx,'" ry="').concat(this.ry,`" />
`)]}_render(e){e.beginPath(),e.save(),e.transform(1,0,0,this.ry/this.rx,0,0),e.arc(0,0,this.rx,0,Eg,!1),e.restore(),this._renderPaintInOrder(e)}static async fromElement(e,r,n){const s=Xo(e,this.ATTRIBUTE_NAMES,n);return s.left=(s.left||0)-s.rx,s.top=(s.top||0)-s.ry,new this(s)}}function I7(t){if(!t)return[];const e=t.replace(/,/g," ").trim().split(/\s+/),r=[];for(let n=0;n<e.length;n+=2)r.push({x:parseFloat(e[n]),y:parseFloat(e[n+1])});return r}fe(So,"type","Ellipse"),fe(So,"cacheProperties",[...Ko,...MB]),fe(So,"ownDefaults",{rx:0,ry:0}),fe(So,"ATTRIBUTE_NAMES",[...Xa,"cx","cy","rx","ry"]),ht.setClass(So),ht.setSVGClass(So);const F7=["left","top"],TB={exactBoundingBox:!1};class Ei extends Gn{static getDefaults(){return ge(ge({},super.getDefaults()),Ei.ownDefaults)}constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(),fe(this,"strokeDiff",void 0),Object.assign(this,Ei.ownDefaults),this.setOptions(r),this.points=e;const{left:n,top:s}=r;this.initialized=!0,this.setBoundingBox(!0),typeof n=="number"&&this.set(pr,n),typeof s=="number"&&this.set(ms,s)}isOpen(){return!0}_projectStrokeOnPoints(e){return Mq(this.points,e,this.isOpen())}_calcDimensions(e){e=ge({scaleX:this.scaleX,scaleY:this.scaleY,skewX:this.skewX,skewY:this.skewY,strokeLineCap:this.strokeLineCap,strokeLineJoin:this.strokeLineJoin,strokeMiterLimit:this.strokeMiterLimit,strokeUniform:this.strokeUniform,strokeWidth:this.strokeWidth},e||{});const r=this.exactBoundingBox?this._projectStrokeOnPoints(e).map(c=>c.projectedPoint):this.points;if(r.length===0)return{left:0,top:0,width:0,height:0,pathOffset:new Ce,strokeOffset:new Ce,strokeDiff:new Ce};const n=Do(r),s=x_(ge(ge({},e),{},{scaleX:1,scaleY:1})),i=Do(this.points.map(c=>ls(c,s,!0))),o=new Ce(this.scaleX,this.scaleY);let a=n.left+n.width/2,l=n.top+n.height/2;return this.exactBoundingBox&&(a-=l*Math.tan(nn(this.skewX)),l-=a*Math.tan(nn(this.skewY))),ge(ge({},n),{},{pathOffset:new Ce(a,l),strokeOffset:new Ce(i.left,i.top).subtract(new Ce(n.left,n.top)).multiply(o),strokeDiff:new Ce(n.width,n.height).subtract(new Ce(i.width,i.height)).multiply(o)})}_findCenterFromElement(){const e=Do(this.points);return new Ce(e.left+e.width/2,e.top+e.height/2)}setDimensions(){this.setBoundingBox()}setBoundingBox(e){const{left:r,top:n,width:s,height:i,pathOffset:o,strokeOffset:a,strokeDiff:l}=this._calcDimensions();this.set({width:s,height:i,pathOffset:o,strokeOffset:a,strokeDiff:l}),e&&this.setPositionByOrigin(new Ce(r+s/2,n+i/2),Wt,Wt)}isStrokeAccountedForInDimensions(){return this.exactBoundingBox}_getNonTransformedDimensions(){return this.exactBoundingBox?new Ce(this.width,this.height):super._getNonTransformedDimensions()}_getTransformedDimensions(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(this.exactBoundingBox){let o;if(Object.keys(e).some(a=>this.strokeUniform||this.constructor.layoutProperties.includes(a))){var r,n;const{width:a,height:l}=this._calcDimensions(e);o=new Ce((r=e.width)!==null&&r!==void 0?r:a,(n=e.height)!==null&&n!==void 0?n:l)}else{var s,i;o=new Ce((s=e.width)!==null&&s!==void 0?s:this.width,(i=e.height)!==null&&i!==void 0?i:this.height)}return o.multiply(new Ce(e.scaleX||this.scaleX,e.scaleY||this.scaleY))}return super._getTransformedDimensions(e)}_set(e,r){const n=this.initialized&&this[e]!==r,s=super._set(e,r);return this.exactBoundingBox&&n&&((e===vs||e===oi)&&this.strokeUniform&&this.constructor.layoutProperties.includes("strokeUniform")||this.constructor.layoutProperties.includes(e))&&this.setDimensions(),s}toObject(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];return ge(ge({},super.toObject(e)),{},{points:this.points.map(r=>{let{x:n,y:s}=r;return{x:n,y:s}})})}_toSVG(){const e=[],r=this.pathOffset.x,n=this.pathOffset.y,s=dr.NUM_FRACTION_DIGITS;for(let i=0,o=this.points.length;i<o;i++)e.push(Fr(this.points[i].x-r,s),",",Fr(this.points[i].y-n,s)," ");return["<".concat(this.constructor.type.toLowerCase()," "),"COMMON_PARTS",'points="'.concat(e.join(""),`" />
`)]}_render(e){const r=this.points.length,n=this.pathOffset.x,s=this.pathOffset.y;if(r&&!isNaN(this.points[r-1].y)){e.beginPath(),e.moveTo(this.points[0].x-n,this.points[0].y-s);for(let i=0;i<r;i++){const o=this.points[i];e.lineTo(o.x-n,o.y-s)}!this.isOpen()&&e.closePath(),this._renderPaintInOrder(e)}}complexity(){return this.points.length}static async fromElement(e,r,n){return new this(I7(e.getAttribute("points")),ge(ge({},Lr(Xo(e,this.ATTRIBUTE_NAMES,n),F7)),r))}static fromObject(e){return this._fromObject(e,{extraParam:"points"})}}fe(Ei,"ownDefaults",TB),fe(Ei,"type","Polyline"),fe(Ei,"layoutProperties",[Bu,Vu,"strokeLineCap","strokeLineJoin","strokeMiterLimit","strokeWidth","strokeUniform","points"]),fe(Ei,"cacheProperties",[...Ko,"points"]),fe(Ei,"ATTRIBUTE_NAMES",[...Xa]),ht.setClass(Ei),ht.setSVGClass(Ei);class Up extends Ei{isOpen(){return!1}}fe(Up,"ownDefaults",TB),fe(Up,"type","Polygon"),ht.setClass(Up),ht.setSVGClass(Up);const CB=["fontSize","fontWeight","fontFamily","fontStyle"],SB=["underline","overline","linethrough"],EB=[...CB,"lineHeight","text","charSpacing","textAlign","styles","path","pathStartOffset","pathSide","pathAlign"],PB=[...EB,...SB,"textBackgroundColor","direction"],L7=[...CB,...SB,_s,"strokeWidth",xn,"deltaY","textBackgroundColor"],R7={_reNewline:Wb,_reSpacesAndTabs:/[ \t\r]/g,_reSpaceAndTab:/[ \t\r]/,_reWords:/\S+/g,fontSize:40,fontWeight:"normal",fontFamily:"Times New Roman",underline:!1,overline:!1,linethrough:!1,textAlign:pr,fontStyle:"normal",lineHeight:1.16,superscript:{size:.6,baseline:-.35},subscript:{size:.6,baseline:.11},textBackgroundColor:"",stroke:null,shadow:null,path:void 0,pathStartOffset:0,pathSide:pr,pathAlign:"baseline",_fontSizeFraction:.222,offsets:{underline:.1,linethrough:-.315,overline:-.88},_fontSizeMult:1.13,charSpacing:0,deltaY:0,direction:"ltr",CACHE_FONT_SIZE:400,MIN_TEXT_WIDTH:2},ao="justify",jg="justify-left",gh="justify-right",_h="justify-center";class kB extends Gn{isEmptyStyles(e){if(!this.styles||e!==void 0&&!this.styles[e])return!0;const r=e===void 0?this.styles:{line:this.styles[e]};for(const n in r)for(const s in r[n])for(const i in r[n][s])return!1;return!0}styleHas(e,r){if(!this.styles||r!==void 0&&!this.styles[r])return!1;const n=r===void 0?this.styles:{0:this.styles[r]};for(const s in n)for(const i in n[s])if(n[s][i][e]!==void 0)return!0;return!1}cleanStyle(e){if(!this.styles)return!1;const r=this.styles;let n,s,i=0,o=!0,a=0;for(const l in r){n=0;for(const c in r[l]){const u=r[l][c]||{};i++,u[e]!==void 0?(s?u[e]!==s&&(o=!1):s=u[e],u[e]===this[e]&&delete u[e]):o=!1,Object.keys(u).length!==0?n++:delete r[l][c]}n===0&&delete r[l]}for(let l=0;l<this._textLines.length;l++)a+=this._textLines[l].length;o&&i===a&&(this[e]=s,this.removeStyle(e))}removeStyle(e){if(!this.styles)return;const r=this.styles;let n,s,i;for(s in r){for(i in n=r[s],n)delete n[i][e],Object.keys(n[i]).length===0&&delete n[i];Object.keys(n).length===0&&delete r[s]}}_extendStyles(e,r){const{lineIndex:n,charIndex:s}=this.get2DCursorLocation(e);this._getLineStyle(n)||this._setLineStyle(n);const i=Xb(ge(ge({},this._getStyleDeclaration(n,s)),r),o=>o!==void 0);this._setStyleDeclaration(n,s,i)}getSelectionStyles(e,r,n){const s=[];for(let i=e;i<(r||e);i++)s.push(this.getStyleAtPosition(i,n));return s}getStyleAtPosition(e,r){const{lineIndex:n,charIndex:s}=this.get2DCursorLocation(e);return r?this.getCompleteStyleDeclaration(n,s):this._getStyleDeclaration(n,s)}setSelectionStyles(e,r,n){for(let s=r;s<(n||r);s++)this._extendStyles(s,e);this._forceClearCache=!0}_getStyleDeclaration(e,r){var n;const s=this.styles&&this.styles[e];return s&&(n=s[r])!==null&&n!==void 0?n:{}}getCompleteStyleDeclaration(e,r){return ge(ge({},Uu(this,this.constructor._styleProperties)),this._getStyleDeclaration(e,r))}_setStyleDeclaration(e,r,n){this.styles[e][r]=n}_deleteStyleDeclaration(e,r){delete this.styles[e][r]}_getLineStyle(e){return!!this.styles[e]}_setLineStyle(e){this.styles[e]={}}_deleteLineStyle(e){delete this.styles[e]}}fe(kB,"_styleProperties",L7);const j7=/  +/g,N7=/"/g;function Lv(t,e,r,n,s){return"		".concat(function(i,o){let{left:a,top:l,width:c,height:u}=o,d=arguments.length>2&&arguments[2]!==void 0?arguments[2]:dr.NUM_FRACTION_DIGITS;const h=Hh(xn,i,!1),[f,p,m,y]=[a,l,c,u].map(g=>Fr(g,d));return"<rect ".concat(h,' x="').concat(f,'" y="').concat(p,'" width="').concat(m,'" height="').concat(y,'"></rect>')}(t,{left:e,top:r,width:n,height:s}),`
`)}const z7=["textAnchor","textDecoration","dx","dy","top","left","fontSize","strokeWidth"];let Rv;class Dn extends kB{static getDefaults(){return ge(ge({},super.getDefaults()),Dn.ownDefaults)}constructor(e,r){super(),fe(this,"__charBounds",[]),Object.assign(this,Dn.ownDefaults),this.setOptions(r),this.styles||(this.styles={}),this.text=e,this.initialized=!0,this.path&&this.setPathInfo(),this.initDimensions(),this.setCoords()}setPathInfo(){const e=this.path;e&&(e.segmentsInfo=gB(e.path))}_splitText(){const e=this._splitTextIntoLines(this.text);return this.textLines=e.lines,this._textLines=e.graphemeLines,this._unwrappedTextLines=e._unwrappedLines,this._text=e.graphemeText,e}initDimensions(){this._splitText(),this._clearCache(),this.dirty=!0,this.path?(this.width=this.path.width,this.height=this.path.height):(this.width=this.calcTextWidth()||this.cursorWidth||this.MIN_TEXT_WIDTH,this.height=this.calcTextHeight()),this.textAlign.includes(ao)&&this.enlargeSpaces()}enlargeSpaces(){let e,r,n,s,i,o,a;for(let l=0,c=this._textLines.length;l<c;l++)if((this.textAlign===ao||l!==c-1&&!this.isEndOfWrapping(l))&&(s=0,i=this._textLines[l],r=this.getLineWidth(l),r<this.width&&(a=this.textLines[l].match(this._reSpacesAndTabs)))){n=a.length,e=(this.width-r)/n;for(let u=0;u<=i.length;u++)o=this.__charBounds[l][u],this._reSpaceAndTab.test(i[u])?(o.width+=e,o.kernedWidth+=e,o.left+=s,s+=e):o.left+=s}}isEndOfWrapping(e){return e===this._textLines.length-1}missingNewlineOffset(e){return 1}get2DCursorLocation(e,r){const n=r?this._unwrappedTextLines:this._textLines;let s;for(s=0;s<n.length;s++){if(e<=n[s].length)return{lineIndex:s,charIndex:e};e-=n[s].length+this.missingNewlineOffset(s,r)}return{lineIndex:s-1,charIndex:n[s-1].length<e?n[s-1].length:e}}toString(){return"#<Text (".concat(this.complexity(),'): { "text": "').concat(this.text,'", "fontFamily": "').concat(this.fontFamily,'" }>')}_getCacheCanvasDimensions(){const e=super._getCacheCanvasDimensions(),r=this.fontSize;return e.width+=r*e.zoomX,e.height+=r*e.zoomY,e}_render(e){const r=this.path;r&&!r.isNotVisible()&&r._render(e),this._setTextStyles(e),this._renderTextLinesBackground(e),this._renderTextDecoration(e,"underline"),this._renderText(e),this._renderTextDecoration(e,"overline"),this._renderTextDecoration(e,"linethrough")}_renderText(e){this.paintFirst===_s?(this._renderTextStroke(e),this._renderTextFill(e)):(this._renderTextFill(e),this._renderTextStroke(e))}_setTextStyles(e,r,n){if(e.textBaseline="alphabetic",this.path)switch(this.pathAlign){case Wt:e.textBaseline="middle";break;case"ascender":e.textBaseline=ms;break;case"descender":e.textBaseline=Mx}e.font=this._getFontDeclaration(r,n)}calcTextWidth(){let e=this.getLineWidth(0);for(let r=1,n=this._textLines.length;r<n;r++){const s=this.getLineWidth(r);s>e&&(e=s)}return e}_renderTextLine(e,r,n,s,i,o){this._renderChars(e,r,n,s,i,o)}_renderTextLinesBackground(e){if(!this.textBackgroundColor&&!this.styleHas("textBackgroundColor"))return;const r=e.fillStyle,n=this._getLeftOffset();let s=this._getTopOffset();for(let i=0,o=this._textLines.length;i<o;i++){const a=this.getHeightOfLine(i);if(!this.textBackgroundColor&&!this.styleHas("textBackgroundColor",i)){s+=a;continue}const l=this._textLines[i].length,c=this._getLineLeftOffset(i);let u,d,h=0,f=0,p=this.getValueOfPropertyAt(i,0,"textBackgroundColor");for(let m=0;m<l;m++){const y=this.__charBounds[i][m];d=this.getValueOfPropertyAt(i,m,"textBackgroundColor"),this.path?(e.save(),e.translate(y.renderLeft,y.renderTop),e.rotate(y.angle),e.fillStyle=d,d&&e.fillRect(-y.width/2,-a/this.lineHeight*(1-this._fontSizeFraction),y.width,a/this.lineHeight),e.restore()):d!==p?(u=n+c+f,this.direction==="rtl"&&(u=this.width-u-h),e.fillStyle=p,p&&e.fillRect(u,s,h,a/this.lineHeight),f=y.left,h=y.width,p=d):h+=y.kernedWidth}d&&!this.path&&(u=n+c+f,this.direction==="rtl"&&(u=this.width-u-h),e.fillStyle=d,e.fillRect(u,s,h,a/this.lineHeight)),s+=a}e.fillStyle=r,this._removeShadow(e)}_measureChar(e,r,n,s){const i=ph.getFontCache(r),o=this._getFontDeclaration(r),a=n+e,l=n&&o===this._getFontDeclaration(s),c=r.fontSize/this.CACHE_FONT_SIZE;let u,d,h,f;if(n&&i[n]!==void 0&&(h=i[n]),i[e]!==void 0&&(f=u=i[e]),l&&i[a]!==void 0&&(d=i[a],f=d-h),u===void 0||h===void 0||d===void 0){const p=function(){return Rv||(Rv=ai({width:0,height:0}).getContext("2d")),Rv}();this._setTextStyles(p,r,!0),u===void 0&&(f=u=p.measureText(e).width,i[e]=u),h===void 0&&l&&n&&(h=p.measureText(n).width,i[n]=h),l&&d===void 0&&(d=p.measureText(a).width,i[a]=d,f=d-h)}return{width:u*c,kernedWidth:f*c}}getHeightOfChar(e,r){return this.getValueOfPropertyAt(e,r,"fontSize")}measureLine(e){const r=this._measureLine(e);return this.charSpacing!==0&&(r.width-=this._getWidthOfCharSpacing()),r.width<0&&(r.width=0),r}_measureLine(e){let r,n,s=0;const i=this.pathSide===tn,o=this.path,a=this._textLines[e],l=a.length,c=new Array(l);this.__charBounds[e]=c;for(let u=0;u<l;u++){const d=a[u];n=this._getGraphemeBox(d,e,u,r),c[u]=n,s+=n.kernedWidth,r=d}if(c[l]={left:n?n.left+n.width:0,width:0,kernedWidth:0,height:this.fontSize,deltaY:0},o&&o.segmentsInfo){let u=0;const d=o.segmentsInfo[o.segmentsInfo.length-1].length;switch(this.textAlign){case pr:u=i?d-s:0;break;case Wt:u=(d-s)/2;break;case tn:u=i?0:d-s}u+=this.pathStartOffset*(i?-1:1);for(let h=i?l-1:0;i?h>=0:h<l;i?h--:h++)n=c[h],u>d?u%=d:u<0&&(u+=d),this._setGraphemeOnPath(u,n),u+=n.kernedWidth}return{width:s,numOfSpaces:0}}_setGraphemeOnPath(e,r){const n=e+r.kernedWidth/2,s=this.path,i=d7(s.path,n,s.segmentsInfo);r.renderLeft=i.x-s.pathOffset.x,r.renderTop=i.y-s.pathOffset.y,r.angle=i.angle+(this.pathSide===tn?Math.PI:0)}_getGraphemeBox(e,r,n,s,i){const o=this.getCompleteStyleDeclaration(r,n),a=s?this.getCompleteStyleDeclaration(r,n-1):{},l=this._measureChar(e,o,s,a);let c,u=l.kernedWidth,d=l.width;this.charSpacing!==0&&(c=this._getWidthOfCharSpacing(),d+=c,u+=c);const h={width:d,left:0,height:o.fontSize,kernedWidth:u,deltaY:o.deltaY};if(n>0&&!i){const f=this.__charBounds[r][n-1];h.left=f.left+f.width+l.kernedWidth-l.width}return h}getHeightOfLine(e){if(this.__lineHeights[e])return this.__lineHeights[e];let r=this.getHeightOfChar(e,0);for(let n=1,s=this._textLines[e].length;n<s;n++)r=Math.max(this.getHeightOfChar(e,n),r);return this.__lineHeights[e]=r*this.lineHeight*this._fontSizeMult}calcTextHeight(){let e,r=0;for(let n=0,s=this._textLines.length;n<s;n++)e=this.getHeightOfLine(n),r+=n===s-1?e/this.lineHeight:e;return r}_getLeftOffset(){return this.direction==="ltr"?-this.width/2:this.width/2}_getTopOffset(){return-this.height/2}_renderTextCommon(e,r){e.save();let n=0;const s=this._getLeftOffset(),i=this._getTopOffset();for(let o=0,a=this._textLines.length;o<a;o++){const l=this.getHeightOfLine(o),c=l/this.lineHeight,u=this._getLineLeftOffset(o);this._renderTextLine(r,e,this._textLines[o],s+u,i+n+c,o),n+=l}e.restore()}_renderTextFill(e){(this.fill||this.styleHas(xn))&&this._renderTextCommon(e,"fillText")}_renderTextStroke(e){(this.stroke&&this.strokeWidth!==0||!this.isEmptyStyles())&&(this.shadow&&!this.shadow.affectStroke&&this._removeShadow(e),e.save(),this._setLineDash(e,this.strokeDashArray),e.beginPath(),this._renderTextCommon(e,"strokeText"),e.closePath(),e.restore())}_renderChars(e,r,n,s,i,o){const a=this.getHeightOfLine(o),l=this.textAlign.includes(ao),c=this.path,u=!l&&this.charSpacing===0&&this.isEmptyStyles(o)&&!c,d=this.direction==="ltr",h=this.direction==="ltr"?1:-1,f=r.direction;let p,m,y,g,_,v="",w=0;if(r.save(),f!==this.direction&&(r.canvas.setAttribute("dir",d?"ltr":"rtl"),r.direction=d?"ltr":"rtl",r.textAlign=d?pr:tn),i-=a*this._fontSizeFraction/this.lineHeight,u)return this._renderChar(e,r,o,0,n.join(""),s,i),void r.restore();for(let x=0,M=n.length-1;x<=M;x++)g=x===M||this.charSpacing||c,v+=n[x],y=this.__charBounds[o][x],w===0?(s+=h*(y.kernedWidth-y.width),w+=y.width):w+=y.kernedWidth,l&&!g&&this._reSpaceAndTab.test(n[x])&&(g=!0),g||(p=p||this.getCompleteStyleDeclaration(o,x),m=this.getCompleteStyleDeclaration(o,x+1),g=rM(p,m,!1)),g&&(c?(r.save(),r.translate(y.renderLeft,y.renderTop),r.rotate(y.angle),this._renderChar(e,r,o,x,v,-w/2,0),r.restore()):(_=s,this._renderChar(e,r,o,x,v,_,i)),v="",p=m,s+=h*w,w=0);r.restore()}_applyPatternGradientTransformText(e){const r=this.width+this.strokeWidth,n=this.height+this.strokeWidth,s=ai({width:r,height:n}),i=s.getContext("2d");return s.width=r,s.height=n,i.beginPath(),i.moveTo(0,0),i.lineTo(r,0),i.lineTo(r,n),i.lineTo(0,n),i.closePath(),i.translate(r/2,n/2),i.fillStyle=e.toLive(i),this._applyPatternGradientTransform(i,e),i.fill(),i.createPattern(s,"no-repeat")}handleFiller(e,r,n){let s,i;return ei(n)?n.gradientUnits==="percentage"||n.gradientTransform||n.patternTransform?(s=-this.width/2,i=-this.height/2,e.translate(s,i),e[r]=this._applyPatternGradientTransformText(n),{offsetX:s,offsetY:i}):(e[r]=n.toLive(e),this._applyPatternGradientTransform(e,n)):(e[r]=n,{offsetX:0,offsetY:0})}_setStrokeStyles(e,r){let{stroke:n,strokeWidth:s}=r;return e.lineWidth=s,e.lineCap=this.strokeLineCap,e.lineDashOffset=this.strokeDashOffset,e.lineJoin=this.strokeLineJoin,e.miterLimit=this.strokeMiterLimit,this.handleFiller(e,"strokeStyle",n)}_setFillStyles(e,r){let{fill:n}=r;return this.handleFiller(e,"fillStyle",n)}_renderChar(e,r,n,s,i,o,a){const l=this._getStyleDeclaration(n,s),c=this.getCompleteStyleDeclaration(n,s),u=e==="fillText"&&c.fill,d=e==="strokeText"&&c.stroke&&c.strokeWidth;if(d||u){if(r.save(),r.font=this._getFontDeclaration(c),l.textBackgroundColor&&this._removeShadow(r),l.deltaY&&(a+=l.deltaY),u){const h=this._setFillStyles(r,c);r.fillText(i,o-h.offsetX,a-h.offsetY)}if(d){const h=this._setStrokeStyles(r,c);r.strokeText(i,o-h.offsetX,a-h.offsetY)}r.restore()}}setSuperscript(e,r){this._setScript(e,r,this.superscript)}setSubscript(e,r){this._setScript(e,r,this.subscript)}_setScript(e,r,n){const s=this.get2DCursorLocation(e,!0),i=this.getValueOfPropertyAt(s.lineIndex,s.charIndex,"fontSize"),o=this.getValueOfPropertyAt(s.lineIndex,s.charIndex,"deltaY"),a={fontSize:i*n.size,deltaY:o+i*n.baseline};this.setSelectionStyles(a,e,r)}_getLineLeftOffset(e){const r=this.getLineWidth(e),n=this.width-r,s=this.textAlign,i=this.direction,o=this.isEndOfWrapping(e);let a=0;return s===ao||s===_h&&!o||s===gh&&!o||s===jg&&!o?0:(s===Wt&&(a=n/2),s===tn&&(a=n),s===_h&&(a=n/2),s===gh&&(a=n),i==="rtl"&&(s===tn||s===ao||s===gh?a=0:s===pr||s===jg?a=-n:s!==Wt&&s!==_h||(a=-n/2)),a)}_clearCache(){this._forceClearCache=!1,this.__lineWidths=[],this.__lineHeights=[],this.__charBounds=[]}getLineWidth(e){if(this.__lineWidths[e]!==void 0)return this.__lineWidths[e];const{width:r}=this.measureLine(e);return this.__lineWidths[e]=r,r}_getWidthOfCharSpacing(){return this.charSpacing!==0?this.fontSize*this.charSpacing/1e3:0}getValueOfPropertyAt(e,r,n){var s;return(s=this._getStyleDeclaration(e,r)[n])!==null&&s!==void 0?s:this[n]}_renderTextDecoration(e,r){if(!this[r]&&!this.styleHas(r))return;let n=this._getTopOffset();const s=this._getLeftOffset(),i=this.path,o=this._getWidthOfCharSpacing(),a=this.offsets[r];for(let l=0,c=this._textLines.length;l<c;l++){const u=this.getHeightOfLine(l);if(!this[r]&&!this.styleHas(r,l)){n+=u;continue}const d=this._textLines[l],h=u/this.lineHeight,f=this._getLineLeftOffset(l);let p,m,y=0,g=0,_=this.getValueOfPropertyAt(l,0,r),v=this.getValueOfPropertyAt(l,0,xn);const w=n+h*(1-this._fontSizeFraction);let x=this.getHeightOfChar(l,0),M=this.getValueOfPropertyAt(l,0,"deltaY");for(let S=0,k=d.length;S<k;S++){const $=this.__charBounds[l][S];p=this.getValueOfPropertyAt(l,S,r),m=this.getValueOfPropertyAt(l,S,xn);const j=this.getHeightOfChar(l,S),V=this.getValueOfPropertyAt(l,S,"deltaY");if(i&&p&&m)e.save(),e.fillStyle=v,e.translate($.renderLeft,$.renderTop),e.rotate($.angle),e.fillRect(-$.kernedWidth/2,a*j+V,$.kernedWidth,this.fontSize/15),e.restore();else if((p!==_||m!==v||j!==x||V!==M)&&g>0){let L=s+f+y;this.direction==="rtl"&&(L=this.width-L-g),_&&v&&(e.fillStyle=v,e.fillRect(L,w+a*x+M,g,this.fontSize/15)),y=$.left,g=$.width,_=p,v=m,x=j,M=V}else g+=$.kernedWidth}let T=s+f+y;this.direction==="rtl"&&(T=this.width-T-g),e.fillStyle=m,p&&m&&e.fillRect(T,w+a*x+M,g-o,this.fontSize/15),n+=u}this._removeShadow(e)}_getFontDeclaration(){let{fontFamily:e=this.fontFamily,fontStyle:r=this.fontStyle,fontWeight:n=this.fontWeight,fontSize:s=this.fontSize}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},i=arguments.length>1?arguments[1]:void 0;const o=e.includes("'")||e.includes('"')||e.includes(",")||Dn.genericFonts.includes(e.toLowerCase())?e:'"'.concat(e,'"');return[r,n,"".concat(i?this.CACHE_FONT_SIZE:s,"px"),o].join(" ")}render(e){this.visible&&(this.canvas&&this.canvas.skipOffscreen&&!this.group&&!this.isOnScreen()||(this._forceClearCache&&this.initDimensions(),super.render(e)))}graphemeSplit(e){return tM(e)}_splitTextIntoLines(e){const r=e.split(this._reNewline),n=new Array(r.length),s=[`
`];let i=[];for(let o=0;o<r.length;o++)n[o]=this.graphemeSplit(r[o]),i=i.concat(n[o],s);return i.pop(),{_unwrappedLines:n,lines:r,graphemeText:i,graphemeLines:n}}toObject(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];return ge(ge({},super.toObject([...PB,...e])),{},{styles:Eq(this.styles,this.text)},this.path?{path:this.path.toObject()}:{})}set(e,r){const{textLayoutProperties:n}=this.constructor;super.set(e,r);let s=!1,i=!1;if(typeof e=="object")for(const o in e)o==="path"&&this.setPathInfo(),s=s||n.includes(o),i=i||o==="path";else s=n.includes(e),i=e==="path";return i&&this.setPathInfo(),s&&this.initialized&&(this.initDimensions(),this.setCoords()),this}complexity(){return 1}static async fromElement(e,r,n){const s=Xo(e,Dn.ATTRIBUTE_NAMES,n),i=ge(ge({},r),s),{textAnchor:o=pr,textDecoration:a="",dx:l=0,dy:c=0,top:u=0,left:d=0,fontSize:h=Vb,strokeWidth:f=1}=i,p=Lr(i,z7),m=new this((e.textContent||"").replace(/^\s+|\s+$|\n+/g,"").replace(/\s+/g," "),ge({left:d+l,top:u+c,underline:a.includes("underline"),overline:a.includes("overline"),linethrough:a.includes("line-through"),strokeWidth:0,fontSize:h},p)),y=m.getScaledHeight()/m.height,g=((m.height+m.strokeWidth)*m.lineHeight-m.height)*y,_=m.getScaledHeight()+g;let v=0;return o===Wt&&(v=m.getScaledWidth()/2),o===tn&&(v=m.getScaledWidth()),m.set({left:m.left-v,top:m.top-(_-m.fontSize*(.07+m._fontSizeFraction))/m.lineHeight,strokeWidth:f}),m}static fromObject(e){return this._fromObject(ge(ge({},e),{},{styles:Pq(e.styles||{},e.text)}),{extraParam:"text"})}}fe(Dn,"textLayoutProperties",EB),fe(Dn,"cacheProperties",[...Ko,...PB]),fe(Dn,"ownDefaults",R7),fe(Dn,"type","Text"),fe(Dn,"genericFonts",["serif","sans-serif","monospace","cursive","fantasy","system-ui","ui-serif","ui-sans-serif","ui-monospace","ui-rounded","math","emoji","fangsong"]),fe(Dn,"ATTRIBUTE_NAMES",Xa.concat("x","y","dx","dy","font-family","font-style","font-weight","font-size","letter-spacing","text-decoration","text-anchor")),aB(Dn,[class extends Jz{_toSVG(){const t=this._getSVGLeftTopOffsets(),e=this._getSVGTextAndBg(t.textTop,t.textLeft);return this._wrapSVGTextAndBg(e)}toSVG(t){const e=this._createBaseSVGMarkup(this._toSVG(),{reviver:t,noStyle:!0,withShadow:!0}),r=this.path;return r?e+r._createBaseSVGMarkup(r._toSVG(),{reviver:t,withShadow:!0,additionalTransform:Gh(this.calcOwnMatrix())}):e}_getSVGLeftTopOffsets(){return{textLeft:-this.width/2,textTop:-this.height/2,lineTop:this.getHeightOfLine(0)}}_wrapSVGTextAndBg(t){let{textBgRects:e,textSpans:r}=t;const n=this.getSvgTextDecoration(this);return[e.join(""),'		<text xml:space="preserve" ',this.fontFamily?'font-family="'.concat(this.fontFamily.replace(N7,"'"),'" '):"",this.fontSize?'font-size="'.concat(this.fontSize,'" '):"",this.fontStyle?'font-style="'.concat(this.fontStyle,'" '):"",this.fontWeight?'font-weight="'.concat(this.fontWeight,'" '):"",n?'text-decoration="'.concat(n,'" '):"",this.direction==="rtl"?'direction="'.concat(this.direction,'" '):"",'style="',this.getSvgStyles(!0),'"',this.addPaintOrder()," >",r.join(""),`</text>
`]}_getSVGTextAndBg(t,e){const r=[],n=[];let s,i=t;this.backgroundColor&&n.push(...Lv(this.backgroundColor,-this.width/2,-this.height/2,this.width,this.height));for(let o=0,a=this._textLines.length;o<a;o++)s=this._getLineLeftOffset(o),this.direction==="rtl"&&(s+=this.width),(this.textBackgroundColor||this.styleHas("textBackgroundColor",o))&&this._setSVGTextLineBg(n,o,e+s,i),this._setSVGTextLineText(r,o,e+s,i),i+=this.getHeightOfLine(o);return{textSpans:r,textBgRects:n}}_createTextCharSpan(t,e,r,n,s){const i=dr.NUM_FRACTION_DIGITS,o=this.getSvgSpanStyles(e,t!==t.trim()||!!t.match(j7)),a=o?'style="'.concat(o,'"'):"",l=e.deltaY,c=l?' dy="'.concat(Fr(l,i),'" '):"",{angle:u,renderLeft:d,renderTop:h,width:f}=s;let p="";if(d!==void 0){const m=f/2;u&&(p=' rotate="'.concat(Fr(Uo(u),i),'"'));const y=Wu({angle:Uo(u)});y[4]=d,y[5]=h;const g=new Ce(-m,0).transform(y);r=g.x,n=g.y}return'<tspan x="'.concat(Fr(r,i),'" y="').concat(Fr(n,i),'" ').concat(c).concat(p).concat(a,">").concat(Tq(t),"</tspan>")}_setSVGTextLineText(t,e,r,n){const s=this.getHeightOfLine(e),i=this.textAlign.includes(ao),o=this._textLines[e];let a,l,c,u,d,h="",f=0;n+=s*(1-this._fontSizeFraction)/this.lineHeight;for(let p=0,m=o.length-1;p<=m;p++)d=p===m||this.charSpacing||this.path,h+=o[p],c=this.__charBounds[e][p],f===0?(r+=c.kernedWidth-c.width,f+=c.width):f+=c.kernedWidth,i&&!d&&this._reSpaceAndTab.test(o[p])&&(d=!0),d||(a=a||this.getCompleteStyleDeclaration(e,p),l=this.getCompleteStyleDeclaration(e,p+1),d=rM(a,l,!0)),d&&(u=this._getStyleDeclaration(e,p),t.push(this._createTextCharSpan(h,u,r,n,c)),h="",a=l,this.direction==="rtl"?r-=f:r+=f,f=0)}_setSVGTextLineBg(t,e,r,n){const s=this._textLines[e],i=this.getHeightOfLine(e)/this.lineHeight;let o,a=0,l=0,c=this.getValueOfPropertyAt(e,0,"textBackgroundColor");for(let u=0;u<s.length;u++){const{left:d,width:h,kernedWidth:f}=this.__charBounds[e][u];o=this.getValueOfPropertyAt(e,u,"textBackgroundColor"),o!==c?(c&&t.push(...Lv(c,r+l,n,a,i)),l=d,a=h,c=o):a+=f}o&&t.push(...Lv(c,r+l,n,a,i))}_getSVGLineTopOffset(t){let e,r=0;for(e=0;e<t;e++)r+=this.getHeightOfLine(e);const n=this.getHeightOfLine(e);return{lineTop:r,offset:(this._fontSizeMult-this._fontSizeFraction)*n/(this.lineHeight*this._fontSizeMult)}}getSvgStyles(t){return"".concat(super.getSvgStyles(t)," white-space: pre;")}getSvgSpanStyles(t,e){const{fontFamily:r,strokeWidth:n,stroke:s,fill:i,fontSize:o,fontStyle:a,fontWeight:l,deltaY:c}=t,u=this.getSvgTextDecoration(t);return[s?Hh(_s,s):"",n?"stroke-width: ".concat(n,"; "):"",r?"font-family: ".concat(r.includes("'")||r.includes('"')?r:"'".concat(r,"'"),"; "):"",o?"font-size: ".concat(o,"px; "):"",a?"font-style: ".concat(a,"; "):"",l?"font-weight: ".concat(l,"; "):"",u&&"text-decoration: ".concat(u,"; "),i?Hh(xn,i):"",c?"baseline-shift: ".concat(-c,"; "):"",e?"white-space: pre; ":""].join("")}getSvgTextDecoration(t){return["overline","underline","line-through"].filter(e=>t[e.replace("-","")]).join(" ")}}]),ht.setClass(Dn),ht.setSVGClass(Dn);class B7{constructor(e){fe(this,"target",void 0),fe(this,"__mouseDownInPlace",!1),fe(this,"__dragStartFired",!1),fe(this,"__isDraggingOver",!1),fe(this,"__dragStartSelection",void 0),fe(this,"__dragImageDisposer",void 0),fe(this,"_dispose",void 0),this.target=e;const r=[this.target.on("dragenter",this.dragEnterHandler.bind(this)),this.target.on("dragover",this.dragOverHandler.bind(this)),this.target.on("dragleave",this.dragLeaveHandler.bind(this)),this.target.on("dragend",this.dragEndHandler.bind(this)),this.target.on("drop",this.dropHandler.bind(this))];this._dispose=()=>{r.forEach(n=>n()),this._dispose=void 0}}isPointerOverSelection(e){const r=this.target,n=r.getSelectionStartFromPointer(e);return r.isEditing&&n>=r.selectionStart&&n<=r.selectionEnd&&r.selectionStart<r.selectionEnd}start(e){return this.__mouseDownInPlace=this.isPointerOverSelection(e)}isActive(){return this.__mouseDownInPlace}end(e){const r=this.isActive();return r&&!this.__dragStartFired&&(this.target.setCursorByClick(e),this.target.initDelayedCursor(!0)),this.__mouseDownInPlace=!1,this.__dragStartFired=!1,this.__isDraggingOver=!1,r}getDragStartSelection(){return this.__dragStartSelection}setDragImage(e,r){var n;let{selectionStart:s,selectionEnd:i}=r;const o=this.target,a=o.canvas,l=new Ce(o.flipX?-1:1,o.flipY?-1:1),c=o._getCursorBoundaries(s),u=new Ce(c.left+c.leftOffset,c.top+c.topOffset).multiply(l).transform(o.calcTransformMatrix()),d=a.getScenePoint(e).subtract(u),h=o.getCanvasRetinaScaling(),f=o.getBoundingRect(),p=u.subtract(new Ce(f.left,f.top)),m=a.viewportTransform,y=p.add(d).transform(m,!0),g=o.backgroundColor,_=eM(o.styles);o.backgroundColor="";const v={stroke:"transparent",fill:"transparent",textBackgroundColor:"transparent"};o.setSelectionStyles(v,0,s),o.setSelectionStyles(v,i,o.text.length),o.dirty=!0;const w=o.toCanvasElement({enableRetinaScaling:a.enableRetinaScaling,viewportTransform:!0});o.backgroundColor=g,o.styles=_,o.dirty=!0,Ox(w,{position:"fixed",left:"".concat(-w.width,"px"),border:gs,width:"".concat(w.width/h,"px"),height:"".concat(w.height/h,"px")}),this.__dragImageDisposer&&this.__dragImageDisposer(),this.__dragImageDisposer=()=>{w.remove()},$i(e.target||this.target.hiddenTextarea).body.appendChild(w),(n=e.dataTransfer)===null||n===void 0||n.setDragImage(w,y.x,y.y)}onDragStart(e){this.__dragStartFired=!0;const r=this.target,n=this.isActive();if(n&&e.dataTransfer){const s=this.__dragStartSelection={selectionStart:r.selectionStart,selectionEnd:r.selectionEnd},i=r._text.slice(s.selectionStart,s.selectionEnd).join(""),o=ge({text:r.text,value:i},s);e.dataTransfer.setData("text/plain",i),e.dataTransfer.setData("application/fabric",JSON.stringify({value:i,styles:r.getSelectionStyles(s.selectionStart,s.selectionEnd,!0)})),e.dataTransfer.effectAllowed="copyMove",this.setDragImage(e,o)}return r.abortCursorAnimation(),n}canDrop(e){if(this.target.editable&&!this.target.getActiveControl()&&!e.defaultPrevented){if(this.isActive()&&this.__dragStartSelection){const r=this.target.getSelectionStartFromPointer(e),n=this.__dragStartSelection;return r<n.selectionStart||r>n.selectionEnd}return!0}return!1}targetCanDrop(e){return this.target.canDrop(e)}dragEnterHandler(e){let{e:r}=e;const n=this.targetCanDrop(r);!this.__isDraggingOver&&n&&(this.__isDraggingOver=!0)}dragOverHandler(e){const{e:r}=e,n=this.targetCanDrop(r);!this.__isDraggingOver&&n?this.__isDraggingOver=!0:this.__isDraggingOver&&!n&&(this.__isDraggingOver=!1),this.__isDraggingOver&&(r.preventDefault(),e.canDrop=!0,e.dropTarget=this.target)}dragLeaveHandler(){(this.__isDraggingOver||this.isActive())&&(this.__isDraggingOver=!1)}dropHandler(e){var r;const{e:n}=e,s=n.defaultPrevented;this.__isDraggingOver=!1,n.preventDefault();let i=(r=n.dataTransfer)===null||r===void 0?void 0:r.getData("text/plain");if(i&&!s){const o=this.target,a=o.canvas;let l=o.getSelectionStartFromPointer(n);const{styles:c}=n.dataTransfer.types.includes("application/fabric")?JSON.parse(n.dataTransfer.getData("application/fabric")):{},u=i[Math.max(0,i.length-1)],d=0;if(this.__dragStartSelection){const h=this.__dragStartSelection.selectionStart,f=this.__dragStartSelection.selectionEnd;l>h&&l<=f?l=h:l>f&&(l-=f-h),o.removeChars(h,f),delete this.__dragStartSelection}o._reNewline.test(u)&&(o._reNewline.test(o._text[l])||l===o._text.length)&&(i=i.trimEnd()),e.didDrop=!0,e.dropTarget=o,o.insertChars(i,c,l),a.setActiveObject(o),o.enterEditing(n),o.selectionStart=Math.min(l+d,o._text.length),o.selectionEnd=Math.min(o.selectionStart+i.length,o._text.length),o.hiddenTextarea.value=o.text,o._updateTextarea(),o.hiddenTextarea.focus(),o.fire(Pg,{index:l+d,action:"drop"}),a.fire("text:changed",{target:o}),a.contextTopDirty=!0,a.requestRenderAll()}}dragEndHandler(e){let{e:r}=e;if(this.isActive()&&this.__dragStartFired&&this.__dragStartSelection){var n;const s=this.target,i=this.target.canvas,{selectionStart:o,selectionEnd:a}=this.__dragStartSelection,l=((n=r.dataTransfer)===null||n===void 0?void 0:n.dropEffect)||gs;l===gs?(s.selectionStart=o,s.selectionEnd=a,s._updateTextarea(),s.hiddenTextarea.focus()):(s.clearContextTop(),l==="move"&&(s.removeChars(o,a),s.selectionStart=s.selectionEnd=o,s.hiddenTextarea&&(s.hiddenTextarea.value=s.text),s._updateTextarea(),s.fire(Pg,{index:o,action:"dragend"}),i.fire("text:changed",{target:s}),i.requestRenderAll()),s.exitEditing())}this.__dragImageDisposer&&this.__dragImageDisposer(),delete this.__dragImageDisposer,delete this.__dragStartSelection,this.__isDraggingOver=!1}dispose(){this._dispose&&this._dispose()}}const MD=/[ \n\.,;!\?\-]/;class V7 extends Dn{constructor(){super(...arguments),fe(this,"_currentCursorOpacity",1)}initBehavior(){this._tick=this._tick.bind(this),this._onTickComplete=this._onTickComplete.bind(this),this.updateSelectionOnMouseMove=this.updateSelectionOnMouseMove.bind(this)}onDeselect(e){return this.isEditing&&this.exitEditing(),this.selected=!1,super.onDeselect(e)}_animateCursor(e){let{toValue:r,duration:n,delay:s,onComplete:i}=e;return rB({startValue:this._currentCursorOpacity,endValue:r,duration:n,delay:s,onComplete:i,abort:()=>!this.canvas||this.selectionStart!==this.selectionEnd,onChange:o=>{this._currentCursorOpacity=o,this.renderCursorOrSelection()}})}_tick(e){this._currentTickState=this._animateCursor({toValue:0,duration:this.cursorDuration/2,delay:Math.max(e||0,100),onComplete:this._onTickComplete})}_onTickComplete(){var e;(e=this._currentTickCompleteState)===null||e===void 0||e.abort(),this._currentTickCompleteState=this._animateCursor({toValue:1,duration:this.cursorDuration,onComplete:this._tick})}initDelayedCursor(e){this.abortCursorAnimation(),this._tick(e?0:this.cursorDelay)}abortCursorAnimation(){let e=!1;[this._currentTickState,this._currentTickCompleteState].forEach(r=>{r&&!r.isDone()&&(e=!0,r.abort())}),this._currentCursorOpacity=1,e&&this.clearContextTop()}restartCursorIfNeeded(){[this._currentTickState,this._currentTickCompleteState].some(e=>!e||e.isDone())&&this.initDelayedCursor()}selectAll(){return this.selectionStart=0,this.selectionEnd=this._text.length,this._fireSelectionChanged(),this._updateTextarea(),this}cmdAll(){this.selectAll(),this.renderCursorOrSelection()}getSelectedText(){return this._text.slice(this.selectionStart,this.selectionEnd).join("")}findWordBoundaryLeft(e){let r=0,n=e-1;if(this._reSpace.test(this._text[n]))for(;this._reSpace.test(this._text[n]);)r++,n--;for(;/\S/.test(this._text[n])&&n>-1;)r++,n--;return e-r}findWordBoundaryRight(e){let r=0,n=e;if(this._reSpace.test(this._text[n]))for(;this._reSpace.test(this._text[n]);)r++,n++;for(;/\S/.test(this._text[n])&&n<this._text.length;)r++,n++;return e+r}findLineBoundaryLeft(e){let r=0,n=e-1;for(;!/\n/.test(this._text[n])&&n>-1;)r++,n--;return e-r}findLineBoundaryRight(e){let r=0,n=e;for(;!/\n/.test(this._text[n])&&n<this._text.length;)r++,n++;return e+r}searchWordBoundary(e,r){const n=this._text;let s=e>0&&this._reSpace.test(n[e])&&(r===-1||!Wb.test(n[e-1]))?e-1:e,i=n[s];for(;s>0&&s<n.length&&!MD.test(i);)s+=r,i=n[s];return r===-1&&MD.test(i)&&s++,s}selectWord(e){var r;e=(r=e)!==null&&r!==void 0?r:this.selectionStart;const n=this.searchWordBoundary(e,-1),s=Math.max(n,this.searchWordBoundary(e,1));this.selectionStart=n,this.selectionEnd=s,this._fireSelectionChanged(),this._updateTextarea(),this.renderCursorOrSelection()}selectLine(e){var r;e=(r=e)!==null&&r!==void 0?r:this.selectionStart;const n=this.findLineBoundaryLeft(e),s=this.findLineBoundaryRight(e);this.selectionStart=n,this.selectionEnd=s,this._fireSelectionChanged(),this._updateTextarea()}enterEditing(e){!this.isEditing&&this.editable&&(this.enterEditingImpl(),this.fire("editing:entered",e?{e}:void 0),this._fireSelectionChanged(),this.canvas&&(this.canvas.fire("text:editing:entered",{target:this,e}),this.canvas.requestRenderAll()))}enterEditingImpl(){this.canvas&&(this.canvas.calcOffset(),this.canvas.textEditingManager.exitTextEditing()),this.isEditing=!0,this.initHiddenTextarea(),this.hiddenTextarea.focus(),this.hiddenTextarea.value=this.text,this._updateTextarea(),this._saveEditingProps(),this._setEditingProps(),this._textBeforeEdit=this.text,this._tick()}updateSelectionOnMouseMove(e){if(this.getActiveControl())return;const r=this.hiddenTextarea;$i(r).activeElement!==r&&r.focus();const n=this.getSelectionStartFromPointer(e),s=this.selectionStart,i=this.selectionEnd;(n===this.__selectionStartOnMouseDown&&s!==i||s!==n&&i!==n)&&(n>this.__selectionStartOnMouseDown?(this.selectionStart=this.__selectionStartOnMouseDown,this.selectionEnd=n):(this.selectionStart=n,this.selectionEnd=this.__selectionStartOnMouseDown),this.selectionStart===s&&this.selectionEnd===i||(this._fireSelectionChanged(),this._updateTextarea(),this.renderCursorOrSelection()))}_setEditingProps(){this.hoverCursor="text",this.canvas&&(this.canvas.defaultCursor=this.canvas.moveCursor="text"),this.borderColor=this.editingBorderColor,this.hasControls=this.selectable=!1,this.lockMovementX=this.lockMovementY=!0}fromStringToGraphemeSelection(e,r,n){const s=n.slice(0,e),i=this.graphemeSplit(s).length;if(e===r)return{selectionStart:i,selectionEnd:i};const o=n.slice(e,r);return{selectionStart:i,selectionEnd:i+this.graphemeSplit(o).length}}fromGraphemeToStringSelection(e,r,n){const s=n.slice(0,e).join("").length;return e===r?{selectionStart:s,selectionEnd:s}:{selectionStart:s,selectionEnd:s+n.slice(e,r).join("").length}}_updateTextarea(){if(this.cursorOffsetCache={},this.hiddenTextarea){if(!this.inCompositionMode){const e=this.fromGraphemeToStringSelection(this.selectionStart,this.selectionEnd,this._text);this.hiddenTextarea.selectionStart=e.selectionStart,this.hiddenTextarea.selectionEnd=e.selectionEnd}this.updateTextareaPosition()}}updateFromTextArea(){if(!this.hiddenTextarea)return;this.cursorOffsetCache={};const e=this.hiddenTextarea;this.text=e.value,this.set("dirty",!0),this.initDimensions(),this.setCoords();const r=this.fromStringToGraphemeSelection(e.selectionStart,e.selectionEnd,e.value);this.selectionEnd=this.selectionStart=r.selectionEnd,this.inCompositionMode||(this.selectionStart=r.selectionStart),this.updateTextareaPosition()}updateTextareaPosition(){if(this.selectionStart===this.selectionEnd){const e=this._calcTextareaPosition();this.hiddenTextarea.style.left=e.left,this.hiddenTextarea.style.top=e.top}}_calcTextareaPosition(){if(!this.canvas)return{left:"1px",top:"1px"};const e=this.inCompositionMode?this.compositionStart:this.selectionStart,r=this._getCursorBoundaries(e),n=this.get2DCursorLocation(e),s=n.lineIndex,i=n.charIndex,o=this.getValueOfPropertyAt(s,i,"fontSize")*this.lineHeight,a=r.leftOffset,l=this.getCanvasRetinaScaling(),c=this.canvas.upperCanvasEl,u=c.width/l,d=c.height/l,h=u-o,f=d-o,p=new Ce(r.left+a,r.top+r.topOffset+o).transform(this.calcTransformMatrix()).transform(this.canvas.viewportTransform).multiply(new Ce(c.clientWidth/u,c.clientHeight/d));return p.x<0&&(p.x=0),p.x>h&&(p.x=h),p.y<0&&(p.y=0),p.y>f&&(p.y=f),p.x+=this.canvas._offset.left,p.y+=this.canvas._offset.top,{left:"".concat(p.x,"px"),top:"".concat(p.y,"px"),fontSize:"".concat(o,"px"),charHeight:o}}_saveEditingProps(){this._savedProps={hasControls:this.hasControls,borderColor:this.borderColor,lockMovementX:this.lockMovementX,lockMovementY:this.lockMovementY,hoverCursor:this.hoverCursor,selectable:this.selectable,defaultCursor:this.canvas&&this.canvas.defaultCursor,moveCursor:this.canvas&&this.canvas.moveCursor}}_restoreEditingProps(){this._savedProps&&(this.hoverCursor=this._savedProps.hoverCursor,this.hasControls=this._savedProps.hasControls,this.borderColor=this._savedProps.borderColor,this.selectable=this._savedProps.selectable,this.lockMovementX=this._savedProps.lockMovementX,this.lockMovementY=this._savedProps.lockMovementY,this.canvas&&(this.canvas.defaultCursor=this._savedProps.defaultCursor||this.canvas.defaultCursor,this.canvas.moveCursor=this._savedProps.moveCursor||this.canvas.moveCursor),delete this._savedProps)}_exitEditing(){const e=this.hiddenTextarea;this.selected=!1,this.isEditing=!1,e&&(e.blur&&e.blur(),e.parentNode&&e.parentNode.removeChild(e)),this.hiddenTextarea=null,this.abortCursorAnimation(),this.selectionStart!==this.selectionEnd&&this.clearContextTop()}exitEditingImpl(){this._exitEditing(),this.selectionEnd=this.selectionStart,this._restoreEditingProps(),this._forceClearCache&&(this.initDimensions(),this.setCoords())}exitEditing(){const e=this._textBeforeEdit!==this.text;return this.exitEditingImpl(),this.fire("editing:exited"),e&&this.fire(kg),this.canvas&&(this.canvas.fire("text:editing:exited",{target:this}),e&&this.canvas.fire("object:modified",{target:this})),this}_removeExtraneousStyles(){for(const e in this.styles)this._textLines[e]||delete this.styles[e]}removeStyleFromTo(e,r){const{lineIndex:n,charIndex:s}=this.get2DCursorLocation(e,!0),{lineIndex:i,charIndex:o}=this.get2DCursorLocation(r,!0);if(n!==i){if(this.styles[n])for(let a=s;a<this._unwrappedTextLines[n].length;a++)delete this.styles[n][a];if(this.styles[i])for(let a=o;a<this._unwrappedTextLines[i].length;a++){const l=this.styles[i][a];l&&(this.styles[n]||(this.styles[n]={}),this.styles[n][s+a-o]=l)}for(let a=n+1;a<=i;a++)delete this.styles[a];this.shiftLineStyles(i,n-i)}else if(this.styles[n]){const a=this.styles[n],l=o-s;for(let c=s;c<o;c++)delete a[c];for(const c in this.styles[n]){const u=parseInt(c,10);u>=o&&(a[u-l]=a[c],delete a[c])}}}shiftLineStyles(e,r){const n=Object.assign({},this.styles);for(const s in this.styles){const i=parseInt(s,10);i>e&&(this.styles[i+r]=n[i],n[i-r]||delete this.styles[i])}}insertNewlineStyleObject(e,r,n,s){const i={},o=this._unwrappedTextLines[e].length,a=o===r;let l=!1;n||(n=1),this.shiftLineStyles(e,n);const c=this.styles[e]?this.styles[e][r===0?r:r-1]:void 0;for(const d in this.styles[e]){const h=parseInt(d,10);h>=r&&(l=!0,i[h-r]=this.styles[e][d],a&&r===0||delete this.styles[e][d])}let u=!1;for(l&&!a&&(this.styles[e+n]=i,u=!0),(u||o>r)&&n--;n>0;)s&&s[n-1]?this.styles[e+n]={0:ge({},s[n-1])}:c?this.styles[e+n]={0:ge({},c)}:delete this.styles[e+n],n--;this._forceClearCache=!0}insertCharStyleObject(e,r,n,s){this.styles||(this.styles={});const i=this.styles[e],o=i?ge({},i):{};n||(n=1);for(const l in o){const c=parseInt(l,10);c>=r&&(i[c+n]=o[c],o[c-n]||delete i[c])}if(this._forceClearCache=!0,s){for(;n--;)Object.keys(s[n]).length&&(this.styles[e]||(this.styles[e]={}),this.styles[e][r+n]=ge({},s[n]));return}if(!i)return;const a=i[r?r-1:1];for(;a&&n--;)this.styles[e][r+n]=ge({},a)}insertNewStyleBlock(e,r,n){const s=this.get2DCursorLocation(r,!0),i=[0];let o,a=0;for(let l=0;l<e.length;l++)e[l]===`
`?(a++,i[a]=0):i[a]++;for(i[0]>0&&(this.insertCharStyleObject(s.lineIndex,s.charIndex,i[0],n),n=n&&n.slice(i[0]+1)),a&&this.insertNewlineStyleObject(s.lineIndex,s.charIndex+i[0],a),o=1;o<a;o++)i[o]>0?this.insertCharStyleObject(s.lineIndex+o,0,i[o],n):n&&this.styles[s.lineIndex+o]&&n[0]&&(this.styles[s.lineIndex+o][0]=n[0]),n=n&&n.slice(i[o]+1);i[o]>0&&this.insertCharStyleObject(s.lineIndex+o,0,i[o],n)}removeChars(e){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:e+1;this.removeStyleFromTo(e,r),this._text.splice(e,r-e),this.text=this._text.join(""),this.set("dirty",!0),this.initDimensions(),this.setCoords(),this._removeExtraneousStyles()}insertChars(e,r,n){let s=arguments.length>3&&arguments[3]!==void 0?arguments[3]:n;s>n&&this.removeStyleFromTo(n,s);const i=this.graphemeSplit(e);this.insertNewStyleBlock(i,n,r),this._text=[...this._text.slice(0,n),...i,...this._text.slice(s)],this.text=this._text.join(""),this.set("dirty",!0),this.initDimensions(),this.setCoords(),this._removeExtraneousStyles()}setSelectionStartEndWithShift(e,r,n){n<=e?(r===e?this._selectionDirection=pr:this._selectionDirection===tn&&(this._selectionDirection=pr,this.selectionEnd=e),this.selectionStart=n):n>e&&n<r?this._selectionDirection===tn?this.selectionEnd=n:this.selectionStart=n:(r===e?this._selectionDirection=tn:this._selectionDirection===pr&&(this._selectionDirection=tn,this.selectionStart=r),this.selectionEnd=n)}}class W7 extends V7{initHiddenTextarea(){const e=this.canvas&&$i(this.canvas.getElement())||zu(),r=e.createElement("textarea");Object.entries({autocapitalize:"off",autocorrect:"off",autocomplete:"off",spellcheck:"false","data-fabric":"textarea",wrap:"off"}).map(o=>{let[a,l]=o;return r.setAttribute(a,l)});const{top:n,left:s,fontSize:i}=this._calcTextareaPosition();r.style.cssText="position: absolute; top: ".concat(n,"; left: ").concat(s,"; z-index: -999; opacity: 0; width: 1px; height: 1px; font-size: 1px; padding-top: ").concat(i,";"),(this.hiddenTextareaContainer||e.body).appendChild(r),Object.entries({blur:"blur",keydown:"onKeyDown",keyup:"onKeyUp",input:"onInput",copy:"copy",cut:"copy",paste:"paste",compositionstart:"onCompositionStart",compositionupdate:"onCompositionUpdate",compositionend:"onCompositionEnd"}).map(o=>{let[a,l]=o;return r.addEventListener(a,this[l].bind(this))}),this.hiddenTextarea=r}blur(){this.abortCursorAnimation()}onKeyDown(e){if(!this.isEditing)return;const r=this.direction==="rtl"?this.keysMapRtl:this.keysMap;if(e.keyCode in r)this[r[e.keyCode]](e);else{if(!(e.keyCode in this.ctrlKeysMapDown)||!e.ctrlKey&&!e.metaKey)return;this[this.ctrlKeysMapDown[e.keyCode]](e)}e.stopImmediatePropagation(),e.preventDefault(),e.keyCode>=33&&e.keyCode<=40?(this.inCompositionMode=!1,this.clearContextTop(),this.renderCursorOrSelection()):this.canvas&&this.canvas.requestRenderAll()}onKeyUp(e){!this.isEditing||this._copyDone||this.inCompositionMode?this._copyDone=!1:e.keyCode in this.ctrlKeysMapUp&&(e.ctrlKey||e.metaKey)&&(this[this.ctrlKeysMapUp[e.keyCode]](e),e.stopImmediatePropagation(),e.preventDefault(),this.canvas&&this.canvas.requestRenderAll())}onInput(e){const r=this.fromPaste,{value:n,selectionStart:s,selectionEnd:i}=this.hiddenTextarea;if(this.fromPaste=!1,e&&e.stopPropagation(),!this.isEditing)return;const o=()=>{this.updateFromTextArea(),this.fire(Pg),this.canvas&&(this.canvas.fire("text:changed",{target:this}),this.canvas.requestRenderAll())};if(this.hiddenTextarea.value==="")return this.styles={},void o();const a=this._splitTextIntoLines(n).graphemeText,l=this._text.length,c=a.length,u=this.selectionStart,d=this.selectionEnd,h=u!==d;let f,p,m,y,g=c-l;const _=this.fromStringToGraphemeSelection(s,i,n),v=u>_.selectionStart;h?(p=this._text.slice(u,d),g+=d-u):c<l&&(p=v?this._text.slice(d+g,d):this._text.slice(u,u-g));const w=a.slice(_.selectionEnd-g,_.selectionEnd);if(p&&p.length&&(w.length&&(f=this.getSelectionStyles(u,u+1,!1),f=w.map(()=>f[0])),h?(m=u,y=d):v?(m=d-p.length,y=d):(m=d,y=d+p.length),this.removeStyleFromTo(m,y)),w.length){const{copyPasteData:x}=po();r&&w.join("")===x.copiedText&&!dr.disableStyleCopyPaste&&(f=x.copiedTextStyle),this.insertNewStyleBlock(w,u,f)}o()}onCompositionStart(){this.inCompositionMode=!0}onCompositionEnd(){this.inCompositionMode=!1}onCompositionUpdate(e){let{target:r}=e;const{selectionStart:n,selectionEnd:s}=r;this.compositionStart=n,this.compositionEnd=s,this.updateTextareaPosition()}copy(){if(this.selectionStart===this.selectionEnd)return;const{copyPasteData:e}=po();e.copiedText=this.getSelectedText(),dr.disableStyleCopyPaste?e.copiedTextStyle=void 0:e.copiedTextStyle=this.getSelectionStyles(this.selectionStart,this.selectionEnd,!0),this._copyDone=!0}paste(){this.fromPaste=!0}_getWidthBeforeCursor(e,r){let n,s=this._getLineLeftOffset(e);return r>0&&(n=this.__charBounds[e][r-1],s+=n.left+n.width),s}getDownCursorOffset(e,r){const n=this._getSelectionForOffset(e,r),s=this.get2DCursorLocation(n),i=s.lineIndex;if(i===this._textLines.length-1||e.metaKey||e.keyCode===34)return this._text.length-n;const o=s.charIndex,a=this._getWidthBeforeCursor(i,o),l=this._getIndexOnLine(i+1,a);return this._textLines[i].slice(o).length+l+1+this.missingNewlineOffset(i)}_getSelectionForOffset(e,r){return e.shiftKey&&this.selectionStart!==this.selectionEnd&&r?this.selectionEnd:this.selectionStart}getUpCursorOffset(e,r){const n=this._getSelectionForOffset(e,r),s=this.get2DCursorLocation(n),i=s.lineIndex;if(i===0||e.metaKey||e.keyCode===33)return-n;const o=s.charIndex,a=this._getWidthBeforeCursor(i,o),l=this._getIndexOnLine(i-1,a),c=this._textLines[i].slice(0,o),u=this.missingNewlineOffset(i-1);return-this._textLines[i-1].length+l-c.length+(1-u)}_getIndexOnLine(e,r){const n=this._textLines[e];let s,i,o=this._getLineLeftOffset(e),a=0;for(let l=0,c=n.length;l<c;l++)if(s=this.__charBounds[e][l].width,o+=s,o>r){i=!0;const u=o-s,d=o,h=Math.abs(u-r);a=Math.abs(d-r)<h?l:l-1;break}return i||(a=n.length-1),a}moveCursorDown(e){this.selectionStart>=this._text.length&&this.selectionEnd>=this._text.length||this._moveCursorUpOrDown("Down",e)}moveCursorUp(e){this.selectionStart===0&&this.selectionEnd===0||this._moveCursorUpOrDown("Up",e)}_moveCursorUpOrDown(e,r){const n=this["get".concat(e,"CursorOffset")](r,this._selectionDirection===tn);if(r.shiftKey?this.moveCursorWithShift(n):this.moveCursorWithoutShift(n),n!==0){const s=this.text.length;this.selectionStart=Au(0,this.selectionStart,s),this.selectionEnd=Au(0,this.selectionEnd,s),this.abortCursorAnimation(),this.initDelayedCursor(),this._fireSelectionChanged(),this._updateTextarea()}}moveCursorWithShift(e){const r=this._selectionDirection===pr?this.selectionStart+e:this.selectionEnd+e;return this.setSelectionStartEndWithShift(this.selectionStart,this.selectionEnd,r),e!==0}moveCursorWithoutShift(e){return e<0?(this.selectionStart+=e,this.selectionEnd=this.selectionStart):(this.selectionEnd+=e,this.selectionStart=this.selectionEnd),e!==0}moveCursorLeft(e){this.selectionStart===0&&this.selectionEnd===0||this._moveCursorLeftOrRight("Left",e)}_move(e,r,n){let s;if(e.altKey)s=this["findWordBoundary".concat(n)](this[r]);else{if(!e.metaKey&&e.keyCode!==35&&e.keyCode!==36)return this[r]+=n==="Left"?-1:1,!0;s=this["findLineBoundary".concat(n)](this[r])}return s!==void 0&&this[r]!==s&&(this[r]=s,!0)}_moveLeft(e,r){return this._move(e,r,"Left")}_moveRight(e,r){return this._move(e,r,"Right")}moveCursorLeftWithoutShift(e){let r=!0;return this._selectionDirection=pr,this.selectionEnd===this.selectionStart&&this.selectionStart!==0&&(r=this._moveLeft(e,"selectionStart")),this.selectionEnd=this.selectionStart,r}moveCursorLeftWithShift(e){return this._selectionDirection===tn&&this.selectionStart!==this.selectionEnd?this._moveLeft(e,"selectionEnd"):this.selectionStart!==0?(this._selectionDirection=pr,this._moveLeft(e,"selectionStart")):void 0}moveCursorRight(e){this.selectionStart>=this._text.length&&this.selectionEnd>=this._text.length||this._moveCursorLeftOrRight("Right",e)}_moveCursorLeftOrRight(e,r){const n="moveCursor".concat(e).concat(r.shiftKey?"WithShift":"WithoutShift");this._currentCursorOpacity=1,this[n](r)&&(this.abortCursorAnimation(),this.initDelayedCursor(),this._fireSelectionChanged(),this._updateTextarea())}moveCursorRightWithShift(e){return this._selectionDirection===pr&&this.selectionStart!==this.selectionEnd?this._moveRight(e,"selectionStart"):this.selectionEnd!==this._text.length?(this._selectionDirection=tn,this._moveRight(e,"selectionEnd")):void 0}moveCursorRightWithoutShift(e){let r=!0;return this._selectionDirection=tn,this.selectionStart===this.selectionEnd?(r=this._moveRight(e,"selectionStart"),this.selectionEnd=this.selectionStart):this.selectionStart=this.selectionEnd,r}}const TD=t=>!!t.button;class U7 extends W7{constructor(){super(...arguments),fe(this,"draggableTextDelegate",void 0)}initBehavior(){this.on("mousedown",this._mouseDownHandler),this.on("mouseup",this.mouseUpHandler),this.on("mousedblclick",this.doubleClickHandler),this.on("mousetripleclick",this.tripleClickHandler),this.draggableTextDelegate=new B7(this),super.initBehavior()}shouldStartDragging(){return this.draggableTextDelegate.isActive()}onDragStart(e){return this.draggableTextDelegate.onDragStart(e)}canDrop(e){return this.draggableTextDelegate.canDrop(e)}doubleClickHandler(e){this.isEditing&&(this.selectWord(this.getSelectionStartFromPointer(e.e)),this.renderCursorOrSelection())}tripleClickHandler(e){this.isEditing&&(this.selectLine(this.getSelectionStartFromPointer(e.e)),this.renderCursorOrSelection())}_mouseDownHandler(e){let{e:r,alreadySelected:n}=e;this.canvas&&this.editable&&!TD(r)&&!this.getActiveControl()&&(this.draggableTextDelegate.start(r)||(this.canvas.textEditingManager.register(this),n&&(this.inCompositionMode=!1,this.setCursorByClick(r)),this.isEditing&&(this.__selectionStartOnMouseDown=this.selectionStart,this.selectionStart===this.selectionEnd&&this.abortCursorAnimation(),this.renderCursorOrSelection()),this.selected||(this.selected=n||this.isEditing)))}mouseUpHandler(e){let{e:r,transform:n}=e;const s=this.draggableTextDelegate.end(r);if(this.canvas){this.canvas.textEditingManager.unregister(this);const i=this.canvas._activeObject;if(i&&i!==this)return}!this.editable||this.group&&!this.group.interactive||n&&n.actionPerformed||TD(r)||s||this.selected&&!this.getActiveControl()&&(this.enterEditing(r),this.selectionStart===this.selectionEnd?this.initDelayedCursor(!0):this.renderCursorOrSelection())}setCursorByClick(e){const r=this.getSelectionStartFromPointer(e),n=this.selectionStart,s=this.selectionEnd;e.shiftKey?this.setSelectionStartEndWithShift(n,s,r):(this.selectionStart=r,this.selectionEnd=r),this.isEditing&&(this._fireSelectionChanged(),this._updateTextarea())}getSelectionStartFromPointer(e){const r=this.canvas.getScenePoint(e).transform(Oi(this.calcTransformMatrix())).add(new Ce(-this._getLeftOffset(),-this._getTopOffset()));let n=0,s=0,i=0;for(let c=0;c<this._textLines.length&&n<=r.y;c++)n+=this.getHeightOfLine(c),i=c,c>0&&(s+=this._textLines[c-1].length+this.missingNewlineOffset(c-1));let o=Math.abs(this._getLineLeftOffset(i));const a=this._textLines[i].length,l=this.__charBounds[i];for(let c=0;c<a;c++){const u=o+l[c].kernedWidth;if(r.x<=u){Math.abs(r.x-u)<=Math.abs(r.x-o)&&s++;break}o=u,s++}return Math.min(this.flipX?a-s:s,this._text.length)}}const Gp="moveCursorUp",Hp="moveCursorDown",Kp="moveCursorLeft",Xp="moveCursorRight",qp="exitEditing",CD=(t,e)=>{const r=e.getRetinaScaling();t.setTransform(r,0,0,r,0,0);const n=e.viewportTransform;t.transform(n[0],n[1],n[2],n[3],n[4],n[5])},G7=ge({selectionStart:0,selectionEnd:0,selectionColor:"rgba(17,119,255,0.3)",isEditing:!1,editable:!0,editingBorderColor:"rgba(102,153,255,0.25)",cursorWidth:2,cursorColor:"",cursorDelay:1e3,cursorDuration:600,caching:!0,hiddenTextareaContainer:null,keysMap:{9:qp,27:qp,33:Gp,34:Hp,35:Xp,36:Kp,37:Kp,38:Gp,39:Xp,40:Hp},keysMapRtl:{9:qp,27:qp,33:Gp,34:Hp,35:Kp,36:Xp,37:Xp,38:Gp,39:Kp,40:Hp},ctrlKeysMapDown:{65:"cmdAll"},ctrlKeysMapUp:{67:"copy",88:"cut"}},{_selectionDirection:null,_reSpace:/\s|\r?\n/,inCompositionMode:!1});class $o extends U7{static getDefaults(){return ge(ge({},super.getDefaults()),$o.ownDefaults)}get type(){const e=super.type;return e==="itext"?"i-text":e}constructor(e,r){super(e,ge(ge({},$o.ownDefaults),r)),this.initBehavior()}_set(e,r){return this.isEditing&&this._savedProps&&e in this._savedProps?(this._savedProps[e]=r,this):(e==="canvas"&&(this.canvas instanceof Rg&&this.canvas.textEditingManager.remove(this),r instanceof Rg&&r.textEditingManager.add(this)),super._set(e,r))}setSelectionStart(e){e=Math.max(e,0),this._updateAndFire("selectionStart",e)}setSelectionEnd(e){e=Math.min(e,this.text.length),this._updateAndFire("selectionEnd",e)}_updateAndFire(e,r){this[e]!==r&&(this._fireSelectionChanged(),this[e]=r),this._updateTextarea()}_fireSelectionChanged(){this.fire("selection:changed"),this.canvas&&this.canvas.fire("text:selection:changed",{target:this})}initDimensions(){this.isEditing&&this.initDelayedCursor(),super.initDimensions()}getSelectionStyles(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.selectionStart||0,r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.selectionEnd,n=arguments.length>2?arguments[2]:void 0;return super.getSelectionStyles(e,r,n)}setSelectionStyles(e){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.selectionStart||0,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:this.selectionEnd;return super.setSelectionStyles(e,r,n)}get2DCursorLocation(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.selectionStart,r=arguments.length>1?arguments[1]:void 0;return super.get2DCursorLocation(e,r)}render(e){super.render(e),this.cursorOffsetCache={},this.renderCursorOrSelection()}toCanvasElement(e){const r=this.isEditing;this.isEditing=!1;const n=super.toCanvasElement(e);return this.isEditing=r,n}renderCursorOrSelection(){if(!this.isEditing||!this.canvas)return;const e=this.clearContextTop(!0);if(!e)return;const r=this._getCursorBoundaries(),n=this.findAncestorsWithClipPath(),s=n.length>0;let i,o=e;if(s){i=ai(e.canvas),o=i.getContext("2d"),CD(o,this.canvas);const a=this.calcTransformMatrix();o.transform(a[0],a[1],a[2],a[3],a[4],a[5])}if(this.selectionStart!==this.selectionEnd||this.inCompositionMode?this.renderSelection(o,r):this.renderCursor(o,r),s)for(const a of n){const l=a.clipPath,c=ai(e.canvas),u=c.getContext("2d");if(CD(u,this.canvas),!l.absolutePositioned){const d=a.calcTransformMatrix();u.transform(d[0],d[1],d[2],d[3],d[4],d[5])}l.transform(u),l.drawObject(u,!0,{}),this.drawClipPathOnCache(o,l,c)}s&&(e.setTransform(1,0,0,1,0,0),e.drawImage(i,0,0)),this.canvas.contextTopDirty=!0,e.restore()}findAncestorsWithClipPath(){const e=[];let r=this;for(;r;)r.clipPath&&e.push(r),r=r.parent;return e}_getCursorBoundaries(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.selectionStart,r=arguments.length>1?arguments[1]:void 0;const n=this._getLeftOffset(),s=this._getTopOffset(),i=this._getCursorBoundariesOffsets(e,r);return{left:n,top:s,leftOffset:i.left,topOffset:i.top}}_getCursorBoundariesOffsets(e,r){return r?this.__getCursorBoundariesOffsets(e):this.cursorOffsetCache&&"top"in this.cursorOffsetCache?this.cursorOffsetCache:this.cursorOffsetCache=this.__getCursorBoundariesOffsets(e)}__getCursorBoundariesOffsets(e){let r=0,n=0;const{charIndex:s,lineIndex:i}=this.get2DCursorLocation(e);for(let c=0;c<i;c++)r+=this.getHeightOfLine(c);const o=this._getLineLeftOffset(i),a=this.__charBounds[i][s];a&&(n=a.left),this.charSpacing!==0&&s===this._textLines[i].length&&(n-=this._getWidthOfCharSpacing());const l={top:r,left:o+(n>0?n:0)};return this.direction==="rtl"&&(this.textAlign===tn||this.textAlign===ao||this.textAlign===gh?l.left*=-1:this.textAlign===pr||this.textAlign===jg?l.left=o-(n>0?n:0):this.textAlign!==Wt&&this.textAlign!==_h||(l.left=o-(n>0?n:0))),l}renderCursorAt(e){this._renderCursor(this.canvas.contextTop,this._getCursorBoundaries(e,!0),e)}renderCursor(e,r){this._renderCursor(e,r,this.selectionStart)}getCursorRenderingData(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.selectionStart,r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this._getCursorBoundaries(e);const n=this.get2DCursorLocation(e),s=n.lineIndex,i=n.charIndex>0?n.charIndex-1:0,o=this.getValueOfPropertyAt(s,i,"fontSize"),a=this.getObjectScaling().x*this.canvas.getZoom(),l=this.cursorWidth/a,c=this.getValueOfPropertyAt(s,i,"deltaY"),u=r.topOffset+(1-this._fontSizeFraction)*this.getHeightOfLine(s)/this.lineHeight-o*(1-this._fontSizeFraction);return{color:this.cursorColor||this.getValueOfPropertyAt(s,i,"fill"),opacity:this._currentCursorOpacity,left:r.left+r.leftOffset-l/2,top:u+r.top+c,width:l,height:o}}_renderCursor(e,r,n){const{color:s,opacity:i,left:o,top:a,width:l,height:c}=this.getCursorRenderingData(n,r);e.fillStyle=s,e.globalAlpha=i,e.fillRect(o,a,l,c)}renderSelection(e,r){const n={selectionStart:this.inCompositionMode?this.hiddenTextarea.selectionStart:this.selectionStart,selectionEnd:this.inCompositionMode?this.hiddenTextarea.selectionEnd:this.selectionEnd};this._renderSelection(e,n,r)}renderDragSourceEffect(){const e=this.draggableTextDelegate.getDragStartSelection();this._renderSelection(this.canvas.contextTop,e,this._getCursorBoundaries(e.selectionStart,!0))}renderDropTargetEffect(e){const r=this.getSelectionStartFromPointer(e);this.renderCursorAt(r)}_renderSelection(e,r,n){const s=r.selectionStart,i=r.selectionEnd,o=this.textAlign.includes(ao),a=this.get2DCursorLocation(s),l=this.get2DCursorLocation(i),c=a.lineIndex,u=l.lineIndex,d=a.charIndex<0?0:a.charIndex,h=l.charIndex<0?0:l.charIndex;for(let f=c;f<=u;f++){const p=this._getLineLeftOffset(f)||0;let m=this.getHeightOfLine(f),y=0,g=0,_=0;if(f===c&&(g=this.__charBounds[c][d].left),f>=c&&f<u)_=o&&!this.isEndOfWrapping(f)?this.width:this.getLineWidth(f)||5;else if(f===u)if(h===0)_=this.__charBounds[u][h].left;else{const T=this._getWidthOfCharSpacing();_=this.__charBounds[u][h-1].left+this.__charBounds[u][h-1].width-T}y=m,(this.lineHeight<1||f===u&&this.lineHeight>1)&&(m/=this.lineHeight);let v=n.left+p+g,w=m,x=0;const M=_-g;this.inCompositionMode?(e.fillStyle=this.compositionColor||"black",w=1,x=m):e.fillStyle=this.selectionColor,this.direction==="rtl"&&(this.textAlign===tn||this.textAlign===ao||this.textAlign===gh?v=this.width-v-M:this.textAlign===pr||this.textAlign===jg?v=n.left+p-_:this.textAlign!==Wt&&this.textAlign!==_h||(v=n.left+p-_)),e.fillRect(v,n.top+n.topOffset+x,M,w),n.topOffset+=y}}getCurrentCharFontSize(){const e=this._getCurrentCharIndex();return this.getValueOfPropertyAt(e.l,e.c,"fontSize")}getCurrentCharColor(){const e=this._getCurrentCharIndex();return this.getValueOfPropertyAt(e.l,e.c,xn)}_getCurrentCharIndex(){const e=this.get2DCursorLocation(this.selectionStart,!0),r=e.charIndex>0?e.charIndex-1:0;return{l:e.lineIndex,c:r}}dispose(){this.exitEditingImpl(),this.draggableTextDelegate.dispose(),super.dispose()}}fe($o,"ownDefaults",G7),fe($o,"type","IText"),ht.setClass($o),ht.setClass($o,"i-text");class Fl extends $o{static getDefaults(){return ge(ge({},super.getDefaults()),Fl.ownDefaults)}constructor(e,r){super(e,ge(ge({},Fl.ownDefaults),r))}static createControls(){return{controls:wq()}}initDimensions(){this.initialized&&(this.isEditing&&this.initDelayedCursor(),this._clearCache(),this.dynamicMinWidth=0,this._styleMap=this._generateStyleMap(this._splitText()),this.dynamicMinWidth>this.width&&this._set("width",this.dynamicMinWidth),this.textAlign.includes(ao)&&this.enlargeSpaces(),this.height=this.calcTextHeight())}_generateStyleMap(e){let r=0,n=0,s=0;const i={};for(let o=0;o<e.graphemeLines.length;o++)e.graphemeText[s]===`
`&&o>0?(n=0,s++,r++):!this.splitByGrapheme&&this._reSpaceAndTab.test(e.graphemeText[s])&&o>0&&(n++,s++),i[o]={line:r,offset:n},s+=e.graphemeLines[o].length,n+=e.graphemeLines[o].length;return i}styleHas(e,r){if(this._styleMap&&!this.isWrapping){const n=this._styleMap[r];n&&(r=n.line)}return super.styleHas(e,r)}isEmptyStyles(e){if(!this.styles)return!0;let r,n=0,s=e+1,i=!1;const o=this._styleMap[e],a=this._styleMap[e+1];o&&(e=o.line,n=o.offset),a&&(s=a.line,i=s===e,r=a.offset);const l=e===void 0?this.styles:{line:this.styles[e]};for(const c in l)for(const u in l[c]){const d=parseInt(u,10);if(d>=n&&(!i||d<r))for(const h in l[c][u])return!1}return!0}_getStyleDeclaration(e,r){if(this._styleMap&&!this.isWrapping){const n=this._styleMap[e];if(!n)return{};e=n.line,r=n.offset+r}return super._getStyleDeclaration(e,r)}_setStyleDeclaration(e,r,n){const s=this._styleMap[e];super._setStyleDeclaration(s.line,s.offset+r,n)}_deleteStyleDeclaration(e,r){const n=this._styleMap[e];super._deleteStyleDeclaration(n.line,n.offset+r)}_getLineStyle(e){const r=this._styleMap[e];return!!this.styles[r.line]}_setLineStyle(e){const r=this._styleMap[e];super._setLineStyle(r.line)}_wrapText(e,r){this.isWrapping=!0;const n=this.getGraphemeDataForRender(e),s=[];for(let i=0;i<n.wordsData.length;i++)s.push(...this._wrapLine(i,r,n));return this.isWrapping=!1,s}getGraphemeDataForRender(e){const r=this.splitByGrapheme,n=r?"":" ";let s=0;return{wordsData:e.map((i,o)=>{let a=0;const l=r?this.graphemeSplit(i):this.wordSplit(i);return l.length===0?[{word:[],width:0}]:l.map(c=>{const u=r?[c]:this.graphemeSplit(c),d=this._measureWord(u,o,a);return s=Math.max(d,s),a+=u.length+n.length,{word:u,width:d}})}),largestWordWidth:s}}_measureWord(e,r){let n,s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,i=0;for(let o=0,a=e.length;o<a;o++)i+=this._getGraphemeBox(e[o],r,o+s,n,!0).kernedWidth,n=e[o];return i}wordSplit(e){return e.split(this._wordJoiners)}_wrapLine(e,r,n){let{largestWordWidth:s,wordsData:i}=n,o=arguments.length>3&&arguments[3]!==void 0?arguments[3]:0;const a=this._getWidthOfCharSpacing(),l=this.splitByGrapheme,c=[],u=l?"":" ";let d=0,h=[],f=0,p=0,m=!0;r-=o;const y=Math.max(r,s,this.dynamicMinWidth),g=i[e];let _;for(f=0,_=0;_<g.length;_++){const{word:v,width:w}=g[_];f+=v.length,d+=p+w-a,d>y&&!m?(c.push(h),h=[],d=w,m=!0):d+=a,m||l||h.push(u),h=h.concat(v),p=l?0:this._measureWord([u],e,f),f++,m=!1}return _&&c.push(h),s+o>this.dynamicMinWidth&&(this.dynamicMinWidth=s-a+o),c}isEndOfWrapping(e){return!this._styleMap[e+1]||this._styleMap[e+1].line!==this._styleMap[e].line}missingNewlineOffset(e,r){return this.splitByGrapheme&&!r?this.isEndOfWrapping(e)?1:0:1}_splitTextIntoLines(e){const r=super._splitTextIntoLines(e),n=this._wrapText(r.lines,this.width),s=new Array(n.length);for(let i=0;i<n.length;i++)s[i]=n[i].join("");return r.lines=s,r.graphemeLines=n,r}getMinWidth(){return Math.max(this.minWidth,this.dynamicMinWidth)}_removeExtraneousStyles(){const e=new Map;for(const r in this._styleMap){const n=parseInt(r,10);if(this._textLines[n]){const s=this._styleMap[r].line;e.set("".concat(s),!0)}}for(const r in this.styles)e.has(r)||delete this.styles[r]}toObject(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];return super.toObject(["minWidth","splitByGrapheme",...e])}}fe(Fl,"type","Textbox"),fe(Fl,"textLayoutProperties",[...$o.textLayoutProperties,"width"]),fe(Fl,"ownDefaults",{minWidth:20,dynamicMinWidth:2,lockScalingFlip:!0,noScaleCache:!1,_wordJoiners:/[ \t\r]/,splitByGrapheme:!1}),ht.setClass(Fl);class SD extends S_{shouldPerformLayout(e){return!!e.target.clipPath&&super.shouldPerformLayout(e)}shouldLayoutClipPath(){return!1}calcLayoutResult(e,r){const{target:n}=e,{clipPath:s,group:i}=n;if(!s||!this.shouldPerformLayout(e))return;const{width:o,height:a}=Do(uB(n,s)),l=new Ce(o,a);if(s.absolutePositioned)return{center:iu(s.getRelativeCenterPoint(),void 0,i?i.calcTransformMatrix():void 0),size:l};{const c=s.getRelativeCenterPoint().transform(n.calcOwnMatrix(),!0);if(this.shouldPerformLayout(e)){const{center:u=new Ce,correction:d=new Ce}=this.calcBoundingBox(r,e)||{};return{center:u.add(c),correction:d.subtract(c),size:l}}return{center:n.getRelativeCenterPoint().add(c),size:l}}}}fe(SD,"type","clip-path"),ht.setClass(SD);class ED extends S_{getInitialSize(e,r){let{target:n}=e,{size:s}=r;return new Ce(n.width||s.x,n.height||s.y)}}fe(ED,"type","fixed"),ht.setClass(ED);class H7 extends Xh{subscribeTargets(e){const r=e.target;e.targets.reduce((n,s)=>(s.parent&&n.add(s.parent),n),new Set).forEach(n=>{n.layoutManager.subscribeTargets({target:n,targets:[r]})})}unsubscribeTargets(e){const r=e.target,n=r.getObjects();e.targets.reduce((s,i)=>(i.parent&&s.add(i.parent),s),new Set).forEach(s=>{!n.some(i=>i.parent===s)&&s.layoutManager.unsubscribeTargets({target:s,targets:[r]})})}}class Ll extends Wl{static getDefaults(){return ge(ge({},super.getDefaults()),Ll.ownDefaults)}constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(),Object.assign(this,Ll.ownDefaults),this.setOptions(r);const{left:n,top:s,layoutManager:i}=r;this.groupInit(e,{left:n,top:s,layoutManager:i??new H7})}_shouldSetNestedCoords(){return!0}__objectSelectionMonitor(){}multiSelectAdd(){for(var e=arguments.length,r=new Array(e),n=0;n<e;n++)r[n]=arguments[n];this.multiSelectionStacking==="selection-order"?this.add(...r):r.forEach(s=>{const i=this._objects.findIndex(a=>a.isInFrontOf(s)),o=i===-1?this.size():i;this.insertAt(o,s)})}canEnterGroup(e){return this.getObjects().some(r=>r.isDescendantOf(e)||e.isDescendantOf(r))?(Va("error","ActiveSelection: circular object trees are not supported, this call has no effect"),!1):super.canEnterGroup(e)}enterGroup(e,r){e.parent&&e.parent===e.group?e.parent._exitGroup(e):e.group&&e.parent!==e.group&&e.group.remove(e),this._enterGroup(e,r)}exitGroup(e,r){this._exitGroup(e,r),e.parent&&e.parent._enterGroup(e,!0)}_onAfterObjectsChange(e,r){super._onAfterObjectsChange(e,r);const n=new Set;r.forEach(s=>{const{parent:i}=s;i&&n.add(i)}),e===sM?n.forEach(s=>{s._onAfterObjectsChange(Ig,r)}):n.forEach(s=>{s._set("dirty",!0)})}onDeselect(){return this.removeAll(),!1}toString(){return"#<ActiveSelection: (".concat(this.complexity(),")>")}shouldCache(){return!1}isOnACache(){return!1}_renderControls(e,r,n){e.save(),e.globalAlpha=this.isMoving?this.borderOpacityWhenMoving:1;const s=ge(ge({hasControls:!1},n),{},{forActiveSelection:!0});for(let i=0;i<this._objects.length;i++)this._objects[i]._renderControls(e,s);super._renderControls(e,r),e.restore()}}fe(Ll,"type","ActiveSelection"),fe(Ll,"ownDefaults",{multiSelectionStacking:"canvas-stacking"}),ht.setClass(Ll),ht.setClass(Ll,"activeSelection");class K7{constructor(){fe(this,"resources",{})}applyFilters(e,r,n,s,i){const o=i.getContext("2d");if(!o)return;o.drawImage(r,0,0,n,s);const a={sourceWidth:n,sourceHeight:s,imageData:o.getImageData(0,0,n,s),originalEl:r,originalImageData:o.getImageData(0,0,n,s),canvasEl:i,ctx:o,filterBackend:this};e.forEach(c=>{c.applyTo(a)});const{imageData:l}=a;return l.width===n&&l.height===s||(i.width=l.width,i.height=l.height),o.putImageData(l,0,0),a}}class AB{constructor(){let{tileSize:e=dr.textureSize}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};fe(this,"aPosition",new Float32Array([0,0,0,1,1,0,1,1])),fe(this,"resources",{}),this.tileSize=e,this.setupGLContext(e,e),this.captureGPUInfo()}setupGLContext(e,r){this.dispose(),this.createWebGLCanvas(e,r)}createWebGLCanvas(e,r){const n=ai({width:e,height:r}),s=n.getContext("webgl",{alpha:!0,premultipliedAlpha:!1,depth:!1,stencil:!1,antialias:!1});s&&(s.clearColor(0,0,0,0),this.canvas=n,this.gl=s)}applyFilters(e,r,n,s,i,o){const a=this.gl,l=i.getContext("2d");if(!a||!l)return;let c;o&&(c=this.getCachedTexture(o,r));const u={originalWidth:r.width||r.naturalWidth||0,originalHeight:r.height||r.naturalHeight||0,sourceWidth:n,sourceHeight:s,destinationWidth:n,destinationHeight:s,context:a,sourceTexture:this.createTexture(a,n,s,c?void 0:r),targetTexture:this.createTexture(a,n,s),originalTexture:c||this.createTexture(a,n,s,c?void 0:r),passes:e.length,webgl:!0,aPosition:this.aPosition,programCache:this.programCache,pass:0,filterBackend:this,targetCanvas:i},d=a.createFramebuffer();return a.bindFramebuffer(a.FRAMEBUFFER,d),e.forEach(h=>{h&&h.applyTo(u)}),function(h){const f=h.targetCanvas,p=f.width,m=f.height,y=h.destinationWidth,g=h.destinationHeight;p===y&&m===g||(f.width=y,f.height=g)}(u),this.copyGLTo2D(a,u),a.bindTexture(a.TEXTURE_2D,null),a.deleteTexture(u.sourceTexture),a.deleteTexture(u.targetTexture),a.deleteFramebuffer(d),l.setTransform(1,0,0,1,0,0),u}dispose(){this.canvas&&(this.canvas=null,this.gl=null),this.clearWebGLCaches()}clearWebGLCaches(){this.programCache={},this.textureCache={}}createTexture(e,r,n,s,i){const{NEAREST:o,TEXTURE_2D:a,RGBA:l,UNSIGNED_BYTE:c,CLAMP_TO_EDGE:u,TEXTURE_MAG_FILTER:d,TEXTURE_MIN_FILTER:h,TEXTURE_WRAP_S:f,TEXTURE_WRAP_T:p}=e,m=e.createTexture();return e.bindTexture(a,m),e.texParameteri(a,d,i||o),e.texParameteri(a,h,i||o),e.texParameteri(a,f,u),e.texParameteri(a,p,u),s?e.texImage2D(a,0,l,l,c,s):e.texImage2D(a,0,l,r,n,0,l,c,null),m}getCachedTexture(e,r,n){const{textureCache:s}=this;if(s[e])return s[e];{const i=this.createTexture(this.gl,r.width,r.height,r,n);return i&&(s[e]=i),i}}evictCachesForKey(e){this.textureCache[e]&&(this.gl.deleteTexture(this.textureCache[e]),delete this.textureCache[e])}copyGLTo2D(e,r){const n=e.canvas,s=r.targetCanvas,i=s.getContext("2d");if(!i)return;i.translate(0,s.height),i.scale(1,-1);const o=n.height-s.height;i.drawImage(n,0,o,s.width,s.height,0,0,s.width,s.height)}copyGLTo2DPutImageData(e,r){const n=r.targetCanvas.getContext("2d"),s=r.destinationWidth,i=r.destinationHeight,o=s*i*4;if(!n)return;const a=new Uint8Array(this.imageBuffer,0,o),l=new Uint8ClampedArray(this.imageBuffer,0,o);e.readPixels(0,0,s,i,e.RGBA,e.UNSIGNED_BYTE,a);const c=new ImageData(l,s,i);n.putImageData(c,0,0)}captureGPUInfo(){if(this.gpuInfo)return this.gpuInfo;const e=this.gl,r={renderer:"",vendor:""};if(!e)return r;const n=e.getExtension("WEBGL_debug_renderer_info");if(n){const s=e.getParameter(n.UNMASKED_RENDERER_WEBGL),i=e.getParameter(n.UNMASKED_VENDOR_WEBGL);s&&(r.renderer=s.toLowerCase()),i&&(r.vendor=i.toLowerCase())}return this.gpuInfo=r,r}}let jv;function X7(){const{WebGLProbe:t}=po();return t.queryWebGL(Wo()),dr.enableGLFiltering&&t.isSupported(dr.textureSize)?new AB({tileSize:dr.textureSize}):new K7}function Nv(){return!jv&&(!(arguments.length>0&&arguments[0]!==void 0)||arguments[0])&&(jv=X7()),jv}const q7=["filters","resizeFilter","src","crossOrigin","type"],$B=["cropX","cropY"];class cs extends Gn{static getDefaults(){return ge(ge({},super.getDefaults()),cs.ownDefaults)}constructor(e,r){super(),fe(this,"_lastScaleX",1),fe(this,"_lastScaleY",1),fe(this,"_filterScalingX",1),fe(this,"_filterScalingY",1),this.filters=[],Object.assign(this,cs.ownDefaults),this.setOptions(r),this.cacheKey="texture".concat(Wa()),this.setElement(typeof e=="string"?(this.canvas&&$i(this.canvas.getElement())||zu()).getElementById(e):e,r)}getElement(){return this._element}setElement(e){var r;let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.removeTexture(this.cacheKey),this.removeTexture("".concat(this.cacheKey,"_filtered")),this._element=e,this._originalElement=e,this._setWidthHeight(n),(r=e.classList)===null||r===void 0||r.add(cs.CSS_CANVAS),this.filters.length!==0&&this.applyFilters(),this.resizeFilter&&this.applyResizeFilters()}removeTexture(e){const r=Nv(!1);r instanceof AB&&r.evictCachesForKey(e)}dispose(){super.dispose(),this.removeTexture(this.cacheKey),this.removeTexture("".concat(this.cacheKey,"_filtered")),this._cacheContext=null,["_originalElement","_element","_filteredEl","_cacheCanvas"].forEach(e=>{const r=this[e];r&&po().dispose(r),this[e]=void 0})}getCrossOrigin(){return this._originalElement&&(this._originalElement.crossOrigin||null)}getOriginalSize(){const e=this.getElement();return e?{width:e.naturalWidth||e.width,height:e.naturalHeight||e.height}:{width:0,height:0}}_stroke(e){if(!this.stroke||this.strokeWidth===0)return;const r=this.width/2,n=this.height/2;e.beginPath(),e.moveTo(-r,-n),e.lineTo(r,-n),e.lineTo(r,n),e.lineTo(-r,n),e.lineTo(-r,-n),e.closePath()}toObject(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];const r=[];return this.filters.forEach(n=>{n&&r.push(n.toObject())}),ge(ge({},super.toObject([...$B,...e])),{},{src:this.getSrc(),crossOrigin:this.getCrossOrigin(),filters:r},this.resizeFilter?{resizeFilter:this.resizeFilter.toObject()}:{})}hasCrop(){return!!this.cropX||!!this.cropY||this.width<this._element.width||this.height<this._element.height}_toSVG(){const e=[],r=this._element,n=-this.width/2,s=-this.height/2;let i=[],o=[],a="",l="";if(!r)return[];if(this.hasCrop()){const c=Wa();i.push('<clipPath id="imageCrop_'+c+`">
`,'	<rect x="'+n+'" y="'+s+'" width="'+this.width+'" height="'+this.height+`" />
`,`</clipPath>
`),a=' clip-path="url(#imageCrop_'+c+')" '}if(this.imageSmoothing||(l=' image-rendering="optimizeSpeed"'),e.push("	<image ","COMMON_PARTS",'xlink:href="'.concat(this.getSvgSrc(!0),'" x="').concat(n-this.cropX,'" y="').concat(s-this.cropY,'" width="').concat(r.width||r.naturalWidth,'" height="').concat(r.height||r.naturalHeight,'"').concat(l).concat(a,`></image>
`)),this.stroke||this.strokeDashArray){const c=this.fill;this.fill=null,o=['	<rect x="'.concat(n,'" y="').concat(s,'" width="').concat(this.width,'" height="').concat(this.height,'" style="').concat(this.getSvgStyles(),`" />
`)],this.fill=c}return i=this.paintFirst!==xn?i.concat(o,e):i.concat(e,o),i}getSrc(e){const r=e?this._element:this._originalElement;return r?r.toDataURL?r.toDataURL():this.srcFromAttribute?r.getAttribute("src")||"":r.src:this.src||""}getSvgSrc(e){return this.getSrc(e)}setSrc(e){let{crossOrigin:r,signal:n}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return Nm(e,{crossOrigin:r,signal:n}).then(s=>{r!==void 0&&this.set({crossOrigin:r}),this.setElement(s)})}toString(){return'#<Image: { src: "'.concat(this.getSrc(),'" }>')}applyResizeFilters(){const e=this.resizeFilter,r=this.minimumScaleTrigger,n=this.getTotalObjectScaling(),s=n.x,i=n.y,o=this._filteredEl||this._originalElement;if(this.group&&this.set("dirty",!0),!e||s>r&&i>r)return this._element=o,this._filterScalingX=1,this._filterScalingY=1,this._lastScaleX=s,void(this._lastScaleY=i);const a=ai(o),{width:l,height:c}=o;this._element=a,this._lastScaleX=e.scaleX=s,this._lastScaleY=e.scaleY=i,Nv().applyFilters([e],o,l,c,this._element),this._filterScalingX=a.width/this._originalElement.width,this._filterScalingY=a.height/this._originalElement.height}applyFilters(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.filters||[];if(e=e.filter(i=>i&&!i.isNeutralState()),this.set("dirty",!0),this.removeTexture("".concat(this.cacheKey,"_filtered")),e.length===0)return this._element=this._originalElement,this._filteredEl=void 0,this._filterScalingX=1,void(this._filterScalingY=1);const r=this._originalElement,n=r.naturalWidth||r.width,s=r.naturalHeight||r.height;if(this._element===this._originalElement){const i=ai({width:n,height:s});this._element=i,this._filteredEl=i}else this._filteredEl&&(this._element=this._filteredEl,this._filteredEl.getContext("2d").clearRect(0,0,n,s),this._lastScaleX=1,this._lastScaleY=1);Nv().applyFilters(e,this._originalElement,n,s,this._element,this.cacheKey),this._originalElement.width===this._element.width&&this._originalElement.height===this._element.height||(this._filterScalingX=this._element.width/this._originalElement.width,this._filterScalingY=this._element.height/this._originalElement.height)}_render(e){e.imageSmoothingEnabled=this.imageSmoothing,this.isMoving!==!0&&this.resizeFilter&&this._needsResize()&&this.applyResizeFilters(),this._stroke(e),this._renderPaintInOrder(e)}drawCacheOnCanvas(e){e.imageSmoothingEnabled=this.imageSmoothing,super.drawCacheOnCanvas(e)}shouldCache(){return this.needsItsOwnCache()}_renderFill(e){const r=this._element;if(!r)return;const n=this._filterScalingX,s=this._filterScalingY,i=this.width,o=this.height,a=Math.max(this.cropX,0),l=Math.max(this.cropY,0),c=r.naturalWidth||r.width,u=r.naturalHeight||r.height,d=a*n,h=l*s,f=Math.min(i*n,c-d),p=Math.min(o*s,u-h),m=-i/2,y=-o/2,g=Math.min(i,c/n-a),_=Math.min(o,u/s-l);r&&e.drawImage(r,d,h,f,p,m,y,g,_)}_needsResize(){const e=this.getTotalObjectScaling();return e.x!==this._lastScaleX||e.y!==this._lastScaleY}_resetWidthHeight(){this.set(this.getOriginalSize())}_setWidthHeight(){let{width:e,height:r}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const n=this.getOriginalSize();this.width=e||n.width,this.height=r||n.height}parsePreserveAspectRatioAttribute(){const e=zX(this.preserveAspectRatio||""),r=this.width,n=this.height,s={width:r,height:n};let i,o=this._element.width,a=this._element.height,l=1,c=1,u=0,d=0,h=0,f=0;return!e||e.alignX===gs&&e.alignY===gs?(l=r/o,c=n/a):(e.meetOrSlice==="meet"&&(l=c=e7(this._element,s),i=(r-o*l)/2,e.alignX==="Min"&&(u=-i),e.alignX==="Max"&&(u=i),i=(n-a*c)/2,e.alignY==="Min"&&(d=-i),e.alignY==="Max"&&(d=i)),e.meetOrSlice==="slice"&&(l=c=t7(this._element,s),i=o-r/l,e.alignX==="Mid"&&(h=i/2),e.alignX==="Max"&&(h=i),i=a-n/c,e.alignY==="Mid"&&(f=i/2),e.alignY==="Max"&&(f=i),o=r/l,a=n/c)),{width:o,height:a,scaleX:l,scaleY:c,offsetLeft:u,offsetTop:d,cropX:h,cropY:f}}static fromObject(e,r){let{filters:n,resizeFilter:s,src:i,crossOrigin:o,type:a}=e,l=Lr(e,q7);return Promise.all([Nm(i,ge(ge({},r),{},{crossOrigin:o})),n&&Uh(n,r),s&&Uh([s],r),b_(l,r)]).then(c=>{let[u,d=[],[h]=[],f={}]=c;return new this(u,ge(ge({},l),{},{src:i,filters:d,resizeFilter:h},f))})}static fromURL(e){let{crossOrigin:r=null,signal:n}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},s=arguments.length>2?arguments[2]:void 0;return Nm(e,{crossOrigin:r,signal:n}).then(i=>new this(i,s))}static async fromElement(e){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},n=arguments.length>2?arguments[2]:void 0;const s=Xo(e,this.ATTRIBUTE_NAMES,n);return this.fromURL(s["xlink:href"]||s.href,r,s).catch(i=>(Va("log","Unable to parse Image",i),null))}}fe(cs,"type","Image"),fe(cs,"cacheProperties",[...Ko,...$B]),fe(cs,"ownDefaults",{strokeWidth:0,srcFromAttribute:!1,minimumScaleTrigger:.5,cropX:0,cropY:0,imageSmoothing:!0}),fe(cs,"CSS_CANVAS","canvas-img"),fe(cs,"ATTRIBUTE_NAMES",[...Xa,"x","y","width","height","preserveAspectRatio","xlink:href","href","crossOrigin","image-rendering"]),ht.setClass(cs),ht.setSVGClass(cs);T_(["pattern","defs","symbol","metadata","clipPath","mask","desc"]);const P_=t=>t.webgl!==void 0,iM="precision highp float",Y7=`
    `.concat(iM,`;
    varying vec2 vTexCoord;
    uniform sampler2D uTexture;
    void main() {
      gl_FragColor = texture2D(uTexture, vTexCoord);
    }`),Q7=["type"],J7=["type"],Z7=new RegExp(iM,"g");class bn{get type(){return this.constructor.type}constructor(){let e=Lr(arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},Q7);Object.assign(this,this.constructor.defaults,e)}getFragmentSource(){return Y7}getVertexSource(){return`
    attribute vec2 aPosition;
    varying vec2 vTexCoord;
    void main() {
      vTexCoord = aPosition;
      gl_Position = vec4(aPosition * 2.0 - 1.0, 0.0, 1.0);
    }`}createProgram(e){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.getFragmentSource(),n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:this.getVertexSource();const{WebGLProbe:{GLPrecision:s="highp"}}=po();s!=="highp"&&(r=r.replace(Z7,iM.replace("highp",s)));const i=e.createShader(e.VERTEX_SHADER),o=e.createShader(e.FRAGMENT_SHADER),a=e.createProgram();if(!i||!o||!a)throw new co("Vertex, fragment shader or program creation error");if(e.shaderSource(i,n),e.compileShader(i),!e.getShaderParameter(i,e.COMPILE_STATUS))throw new co("Vertex shader compile error for ".concat(this.type,": ").concat(e.getShaderInfoLog(i)));if(e.shaderSource(o,r),e.compileShader(o),!e.getShaderParameter(o,e.COMPILE_STATUS))throw new co("Fragment shader compile error for ".concat(this.type,": ").concat(e.getShaderInfoLog(o)));if(e.attachShader(a,i),e.attachShader(a,o),e.linkProgram(a),!e.getProgramParameter(a,e.LINK_STATUS))throw new co('Shader link error for "'.concat(this.type,'" ').concat(e.getProgramInfoLog(a)));const l=this.getUniformLocations(e,a)||{};return l.uStepW=e.getUniformLocation(a,"uStepW"),l.uStepH=e.getUniformLocation(a,"uStepH"),{program:a,attributeLocations:this.getAttributeLocations(e,a),uniformLocations:l}}getAttributeLocations(e,r){return{aPosition:e.getAttribLocation(r,"aPosition")}}getUniformLocations(e,r){const n=this.constructor.uniformLocations,s={};for(let i=0;i<n.length;i++)s[n[i]]=e.getUniformLocation(r,n[i]);return s}sendAttributeData(e,r,n){const s=r.aPosition,i=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,i),e.enableVertexAttribArray(s),e.vertexAttribPointer(s,2,e.FLOAT,!1,0,0),e.bufferData(e.ARRAY_BUFFER,n,e.STATIC_DRAW)}_setupFrameBuffer(e){const r=e.context;if(e.passes>1){const n=e.destinationWidth,s=e.destinationHeight;e.sourceWidth===n&&e.sourceHeight===s||(r.deleteTexture(e.targetTexture),e.targetTexture=e.filterBackend.createTexture(r,n,s)),r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,e.targetTexture,0)}else r.bindFramebuffer(r.FRAMEBUFFER,null),r.finish()}_swapTextures(e){e.passes--,e.pass++;const r=e.targetTexture;e.targetTexture=e.sourceTexture,e.sourceTexture=r}isNeutralState(e){return!1}applyTo(e){P_(e)?(this._setupFrameBuffer(e),this.applyToWebGL(e),this._swapTextures(e)):this.applyTo2d(e)}applyTo2d(e){}getCacheKey(){return this.type}retrieveShader(e){const r=this.getCacheKey();return e.programCache[r]||(e.programCache[r]=this.createProgram(e.context)),e.programCache[r]}applyToWebGL(e){const r=e.context,n=this.retrieveShader(e);e.pass===0&&e.originalTexture?r.bindTexture(r.TEXTURE_2D,e.originalTexture):r.bindTexture(r.TEXTURE_2D,e.sourceTexture),r.useProgram(n.program),this.sendAttributeData(r,n.attributeLocations,e.aPosition),r.uniform1f(n.uniformLocations.uStepW,1/e.sourceWidth),r.uniform1f(n.uniformLocations.uStepH,1/e.sourceHeight),this.sendUniformData(r,n.uniformLocations),r.viewport(0,0,e.destinationWidth,e.destinationHeight),r.drawArrays(r.TRIANGLE_STRIP,0,4)}bindAdditionalTexture(e,r,n){e.activeTexture(n),e.bindTexture(e.TEXTURE_2D,r),e.activeTexture(e.TEXTURE0)}unbindAdditionalTexture(e,r){e.activeTexture(r),e.bindTexture(e.TEXTURE_2D,null),e.activeTexture(e.TEXTURE0)}sendUniformData(e,r){}createHelpLayer(e){if(!e.helpLayer){const{sourceWidth:r,sourceHeight:n}=e,s=ai({width:r,height:n});e.helpLayer=s}}toObject(){const e=Object.keys(this.constructor.defaults||{});return ge({type:this.type},e.reduce((r,n)=>(r[n]=this[n],r),{}))}toJSON(){return this.toObject()}static async fromObject(e,r){return new this(Lr(e,J7))}}fe(bn,"type","BaseFilter"),fe(bn,"uniformLocations",[]);const eY={multiply:`gl_FragColor.rgb *= uColor.rgb;
`,screen:`gl_FragColor.rgb = 1.0 - (1.0 - gl_FragColor.rgb) * (1.0 - uColor.rgb);
`,add:`gl_FragColor.rgb += uColor.rgb;
`,difference:`gl_FragColor.rgb = abs(gl_FragColor.rgb - uColor.rgb);
`,subtract:`gl_FragColor.rgb -= uColor.rgb;
`,lighten:`gl_FragColor.rgb = max(gl_FragColor.rgb, uColor.rgb);
`,darken:`gl_FragColor.rgb = min(gl_FragColor.rgb, uColor.rgb);
`,exclusion:`gl_FragColor.rgb += uColor.rgb - 2.0 * (uColor.rgb * gl_FragColor.rgb);
`,overlay:`
    if (uColor.r < 0.5) {
      gl_FragColor.r *= 2.0 * uColor.r;
    } else {
      gl_FragColor.r = 1.0 - 2.0 * (1.0 - gl_FragColor.r) * (1.0 - uColor.r);
    }
    if (uColor.g < 0.5) {
      gl_FragColor.g *= 2.0 * uColor.g;
    } else {
      gl_FragColor.g = 1.0 - 2.0 * (1.0 - gl_FragColor.g) * (1.0 - uColor.g);
    }
    if (uColor.b < 0.5) {
      gl_FragColor.b *= 2.0 * uColor.b;
    } else {
      gl_FragColor.b = 1.0 - 2.0 * (1.0 - gl_FragColor.b) * (1.0 - uColor.b);
    }
    `,tint:`
    gl_FragColor.rgb *= (1.0 - uColor.a);
    gl_FragColor.rgb += uColor.rgb;
    `};class Yp extends bn{getCacheKey(){return"".concat(this.type,"_").concat(this.mode)}getFragmentSource(){return`
      precision highp float;
      uniform sampler2D uTexture;
      uniform vec4 uColor;
      varying vec2 vTexCoord;
      void main() {
        vec4 color = texture2D(uTexture, vTexCoord);
        gl_FragColor = color;
        if (color.a > 0.0) {
          `.concat(eY[this.mode],`
        }
      }
      `)}applyTo2d(e){let{imageData:{data:r}}=e;const n=new _r(this.color).getSource(),s=this.alpha,i=n[0]*s,o=n[1]*s,a=n[2]*s,l=1-s;for(let c=0;c<r.length;c+=4){const u=r[c],d=r[c+1],h=r[c+2];let f,p,m;switch(this.mode){case"multiply":f=u*i/255,p=d*o/255,m=h*a/255;break;case"screen":f=255-(255-u)*(255-i)/255,p=255-(255-d)*(255-o)/255,m=255-(255-h)*(255-a)/255;break;case"add":f=u+i,p=d+o,m=h+a;break;case"difference":f=Math.abs(u-i),p=Math.abs(d-o),m=Math.abs(h-a);break;case"subtract":f=u-i,p=d-o,m=h-a;break;case"darken":f=Math.min(u,i),p=Math.min(d,o),m=Math.min(h,a);break;case"lighten":f=Math.max(u,i),p=Math.max(d,o),m=Math.max(h,a);break;case"overlay":f=i<128?2*u*i/255:255-2*(255-u)*(255-i)/255,p=o<128?2*d*o/255:255-2*(255-d)*(255-o)/255,m=a<128?2*h*a/255:255-2*(255-h)*(255-a)/255;break;case"exclusion":f=i+u-2*i*u/255,p=o+d-2*o*d/255,m=a+h-2*a*h/255;break;case"tint":f=i+u*l,p=o+d*l,m=a+h*l}r[c]=f,r[c+1]=p,r[c+2]=m}}sendUniformData(e,r){const n=new _r(this.color).getSource();n[0]=this.alpha*n[0]/255,n[1]=this.alpha*n[1]/255,n[2]=this.alpha*n[2]/255,n[3]=this.alpha,e.uniform4fv(r.uColor,n)}}fe(Yp,"defaults",{color:"#F95C63",mode:"multiply",alpha:1}),fe(Yp,"type","BlendColor"),fe(Yp,"uniformLocations",["uColor"]),ht.setClass(Yp);const tY={multiply:`
    precision highp float;
    uniform sampler2D uTexture;
    uniform sampler2D uImage;
    uniform vec4 uColor;
    varying vec2 vTexCoord;
    varying vec2 vTexCoord2;
    void main() {
      vec4 color = texture2D(uTexture, vTexCoord);
      vec4 color2 = texture2D(uImage, vTexCoord2);
      color.rgba *= color2.rgba;
      gl_FragColor = color;
    }
    `,mask:`
    precision highp float;
    uniform sampler2D uTexture;
    uniform sampler2D uImage;
    uniform vec4 uColor;
    varying vec2 vTexCoord;
    varying vec2 vTexCoord2;
    void main() {
      vec4 color = texture2D(uTexture, vTexCoord);
      vec4 color2 = texture2D(uImage, vTexCoord2);
      color.a = color2.a;
      gl_FragColor = color;
    }
    `},rY=["type","image"];class Qp extends bn{getCacheKey(){return"".concat(this.type,"_").concat(this.mode)}getFragmentSource(){return tY[this.mode]}getVertexSource(){return`
    attribute vec2 aPosition;
    varying vec2 vTexCoord;
    varying vec2 vTexCoord2;
    uniform mat3 uTransformMatrix;
    void main() {
      vTexCoord = aPosition;
      vTexCoord2 = (uTransformMatrix * vec3(aPosition, 1.0)).xy;
      gl_Position = vec4(aPosition * 2.0 - 1.0, 0.0, 1.0);
    }
    `}applyToWebGL(e){const r=e.context,n=this.createTexture(e.filterBackend,this.image);this.bindAdditionalTexture(r,n,r.TEXTURE1),super.applyToWebGL(e),this.unbindAdditionalTexture(r,r.TEXTURE1)}createTexture(e,r){return e.getCachedTexture(r.cacheKey,r.getElement())}calculateMatrix(){const e=this.image,{width:r,height:n}=e.getElement();return[1/e.scaleX,0,0,0,1/e.scaleY,0,-e.left/r,-e.top/n,1]}applyTo2d(e){let{imageData:{data:r,width:n,height:s},filterBackend:{resources:i}}=e;const o=this.image;i.blendImage||(i.blendImage=Wo());const a=i.blendImage,l=a.getContext("2d");a.width!==n||a.height!==s?(a.width=n,a.height=s):l.clearRect(0,0,n,s),l.setTransform(o.scaleX,0,0,o.scaleY,o.left,o.top),l.drawImage(o.getElement(),0,0,n,s);const c=l.getImageData(0,0,n,s).data;for(let u=0;u<r.length;u+=4){const d=r[u],h=r[u+1],f=r[u+2],p=r[u+3],m=c[u],y=c[u+1],g=c[u+2],_=c[u+3];switch(this.mode){case"multiply":r[u]=d*m/255,r[u+1]=h*y/255,r[u+2]=f*g/255,r[u+3]=p*_/255;break;case"mask":r[u+3]=_}}}sendUniformData(e,r){const n=this.calculateMatrix();e.uniform1i(r.uImage,1),e.uniformMatrix3fv(r.uTransformMatrix,!1,n)}toObject(){return ge(ge({},super.toObject()),{},{image:this.image&&this.image.toObject()})}static async fromObject(e,r){let{type:n,image:s}=e,i=Lr(e,rY);return cs.fromObject(s,r).then(o=>new this(ge(ge({},i),{},{image:o})))}}fe(Qp,"type","BlendImage"),fe(Qp,"defaults",{mode:"multiply",alpha:1}),fe(Qp,"uniformLocations",["uTransformMatrix","uImage"]),ht.setClass(Qp);class Jp extends bn{getFragmentSource(){return`
    precision highp float;
    uniform sampler2D uTexture;
    uniform vec2 uDelta;
    varying vec2 vTexCoord;
    const float nSamples = 15.0;
    vec3 v3offset = vec3(12.9898, 78.233, 151.7182);
    float random(vec3 scale) {
      /* use the fragment position for a different seed per-pixel */
      return fract(sin(dot(gl_FragCoord.xyz, scale)) * 43758.5453);
    }
    void main() {
      vec4 color = vec4(0.0);
      float totalC = 0.0;
      float totalA = 0.0;
      float offset = random(v3offset);
      for (float t = -nSamples; t <= nSamples; t++) {
        float percent = (t + offset - 0.5) / nSamples;
        vec4 sample = texture2D(uTexture, vTexCoord + uDelta * percent);
        float weight = 1.0 - abs(percent);
        float alpha = weight * sample.a;
        color.rgb += sample.rgb * alpha;
        color.a += alpha;
        totalA += weight;
        totalC += alpha;
      }
      gl_FragColor.rgb = color.rgb / totalC;
      gl_FragColor.a = color.a / totalA;
    }
  `}applyTo(e){P_(e)?(this.aspectRatio=e.sourceWidth/e.sourceHeight,e.passes++,this._setupFrameBuffer(e),this.horizontal=!0,this.applyToWebGL(e),this._swapTextures(e),this._setupFrameBuffer(e),this.horizontal=!1,this.applyToWebGL(e),this._swapTextures(e)):this.applyTo2d(e)}applyTo2d(e){let{imageData:{data:r,width:n,height:s}}=e;this.aspectRatio=n/s,this.horizontal=!0;let i=this.getBlurValue()*n;const o=new Uint8ClampedArray(r),a=15,l=4*n;for(let c=0;c<r.length;c+=4){let u=0,d=0,h=0,f=0,p=0;const m=c-c%l,y=m+l;for(let g=-14;g<a;g++){const _=g/a,v=4*Math.floor(i*_),w=1-Math.abs(_);let x=c+v;x<m?x=m:x>y&&(x=y);const M=r[x+3]*w;u+=r[x]*M,d+=r[x+1]*M,h+=r[x+2]*M,f+=M,p+=w}o[c]=u/f,o[c+1]=d/f,o[c+2]=h/f,o[c+3]=f/p}this.horizontal=!1,i=this.getBlurValue()*s;for(let c=0;c<o.length;c+=4){let u=0,d=0,h=0,f=0,p=0;const m=c%l,y=o.length-l+m;for(let g=-14;g<a;g++){const _=g/a,v=Math.floor(i*_)*l,w=1-Math.abs(_);let x=c+v;x<m?x=m:x>y&&(x=y);const M=o[x+3]*w;u+=o[x]*M,d+=o[x+1]*M,h+=o[x+2]*M,f+=M,p+=w}r[c]=u/f,r[c+1]=d/f,r[c+2]=h/f,r[c+3]=f/p}}sendUniformData(e,r){const n=this.chooseRightDelta();e.uniform2fv(r.uDelta,n)}isNeutralState(){return this.blur===0}getBlurValue(){let e=1;const{horizontal:r,aspectRatio:n}=this;return r?n>1&&(e=1/n):n<1&&(e=n),e*this.blur*.12}chooseRightDelta(){const e=this.getBlurValue();return this.horizontal?[e,0]:[0,e]}}fe(Jp,"type","Blur"),fe(Jp,"defaults",{blur:0}),fe(Jp,"uniformLocations",["uDelta"]),ht.setClass(Jp);class Zp extends bn{getFragmentSource(){return`
  precision highp float;
  uniform sampler2D uTexture;
  uniform float uBrightness;
  varying vec2 vTexCoord;
  void main() {
    vec4 color = texture2D(uTexture, vTexCoord);
    color.rgb += uBrightness;
    gl_FragColor = color;
  }
`}applyTo2d(e){let{imageData:{data:r}}=e;const n=Math.round(255*this.brightness);for(let s=0;s<r.length;s+=4)r[s]+=n,r[s+1]+=n,r[s+2]+=n}isNeutralState(){return this.brightness===0}sendUniformData(e,r){e.uniform1f(r.uBrightness,this.brightness)}}fe(Zp,"type","Brightness"),fe(Zp,"defaults",{brightness:0}),fe(Zp,"uniformLocations",["uBrightness"]),ht.setClass(Zp);const OB={matrix:[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0],colorsOnly:!0};class Xc extends bn{getFragmentSource(){return`
  precision highp float;
  uniform sampler2D uTexture;
  varying vec2 vTexCoord;
  uniform mat4 uColorMatrix;
  uniform vec4 uConstants;
  void main() {
    vec4 color = texture2D(uTexture, vTexCoord);
    color *= uColorMatrix;
    color += uConstants;
    gl_FragColor = color;
  }`}applyTo2d(e){const r=e.imageData.data,n=this.matrix,s=this.colorsOnly;for(let i=0;i<r.length;i+=4){const o=r[i],a=r[i+1],l=r[i+2];if(r[i]=o*n[0]+a*n[1]+l*n[2]+255*n[4],r[i+1]=o*n[5]+a*n[6]+l*n[7]+255*n[9],r[i+2]=o*n[10]+a*n[11]+l*n[12]+255*n[14],!s){const c=r[i+3];r[i]+=c*n[3],r[i+1]+=c*n[8],r[i+2]+=c*n[13],r[i+3]=o*n[15]+a*n[16]+l*n[17]+c*n[18]+255*n[19]}}}sendUniformData(e,r){const n=this.matrix,s=[n[0],n[1],n[2],n[3],n[5],n[6],n[7],n[8],n[10],n[11],n[12],n[13],n[15],n[16],n[17],n[18]],i=[n[4],n[9],n[14],n[19]];e.uniformMatrix4fv(r.uColorMatrix,!1,s),e.uniform4fv(r.uConstants,i)}toObject(){return ge(ge({},super.toObject()),{},{matrix:[...this.matrix]})}}function ac(t,e){var r;const n=(fe(r=class extends Xc{toObject(){return{type:this.type,colorsOnly:this.colorsOnly}}},"type",t),fe(r,"defaults",{colorsOnly:!1,matrix:e}),r);return ht.setClass(n,t),n}fe(Xc,"type","ColorMatrix"),fe(Xc,"defaults",OB),fe(Xc,"uniformLocations",["uColorMatrix","uConstants"]),ht.setClass(Xc);ac("Brownie",[.5997,.34553,-.27082,0,.186,-.0377,.86095,.15059,0,-.1449,.24113,-.07441,.44972,0,-.02965,0,0,0,1,0]);ac("Vintage",[.62793,.32021,-.03965,0,.03784,.02578,.64411,.03259,0,.02926,.0466,-.08512,.52416,0,.02023,0,0,0,1,0]);ac("Kodachrome",[1.12855,-.39673,-.03992,0,.24991,-.16404,1.08352,-.05498,0,.09698,-.16786,-.56034,1.60148,0,.13972,0,0,0,1,0]);ac("Technicolor",[1.91252,-.85453,-.09155,0,.04624,-.30878,1.76589,-.10601,0,-.27589,-.2311,-.75018,1.84759,0,.12137,0,0,0,1,0]);ac("Polaroid",[1.438,-.062,-.062,0,0,-.122,1.378,-.122,0,0,-.016,-.016,1.483,0,0,0,0,0,1,0]);ac("Sepia",[.393,.769,.189,0,0,.349,.686,.168,0,0,.272,.534,.131,0,0,0,0,0,1,0]);ac("BlackWhite",[1.5,1.5,1.5,0,-1,1.5,1.5,1.5,0,-1,1.5,1.5,1.5,0,-1,0,0,0,1,0]);class PD extends bn{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};super(e),this.subFilters=e.subFilters||[]}applyTo(e){P_(e)&&(e.passes+=this.subFilters.length-1),this.subFilters.forEach(r=>{r.applyTo(e)})}toObject(){return{type:this.type,subFilters:this.subFilters.map(e=>e.toObject())}}isNeutralState(){return!this.subFilters.some(e=>!e.isNeutralState())}static fromObject(e,r){return Promise.all((e.subFilters||[]).map(n=>ht.getClass(n.type).fromObject(n,r))).then(n=>new this({subFilters:n}))}}fe(PD,"type","Composed"),ht.setClass(PD);class em extends bn{getFragmentSource(){return`
  precision highp float;
  uniform sampler2D uTexture;
  uniform float uContrast;
  varying vec2 vTexCoord;
  void main() {
    vec4 color = texture2D(uTexture, vTexCoord);
    float contrastF = 1.015 * (uContrast + 1.0) / (1.0 * (1.015 - uContrast));
    color.rgb = contrastF * (color.rgb - 0.5) + 0.5;
    gl_FragColor = color;
  }`}isNeutralState(){return this.contrast===0}applyTo2d(e){let{imageData:{data:r}}=e;const n=Math.floor(255*this.contrast),s=259*(n+255)/(255*(259-n));for(let i=0;i<r.length;i+=4)r[i]=s*(r[i]-128)+128,r[i+1]=s*(r[i+1]-128)+128,r[i+2]=s*(r[i+2]-128)+128}sendUniformData(e,r){e.uniform1f(r.uContrast,this.contrast)}}fe(em,"type","Contrast"),fe(em,"defaults",{contrast:0}),fe(em,"uniformLocations",["uContrast"]),ht.setClass(em);const nY={Convolute_3_1:`
    precision highp float;
    uniform sampler2D uTexture;
    uniform float uMatrix[9];
    uniform float uStepW;
    uniform float uStepH;
    varying vec2 vTexCoord;
    void main() {
      vec4 color = vec4(0, 0, 0, 0);
      for (float h = 0.0; h < 3.0; h+=1.0) {
        for (float w = 0.0; w < 3.0; w+=1.0) {
          vec2 matrixPos = vec2(uStepW * (w - 1), uStepH * (h - 1));
          color += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 3.0 + w)];
        }
      }
      gl_FragColor = color;
    }
    `,Convolute_3_0:`
    precision highp float;
    uniform sampler2D uTexture;
    uniform float uMatrix[9];
    uniform float uStepW;
    uniform float uStepH;
    varying vec2 vTexCoord;
    void main() {
      vec4 color = vec4(0, 0, 0, 1);
      for (float h = 0.0; h < 3.0; h+=1.0) {
        for (float w = 0.0; w < 3.0; w+=1.0) {
          vec2 matrixPos = vec2(uStepW * (w - 1.0), uStepH * (h - 1.0));
          color.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 3.0 + w)];
        }
      }
      float alpha = texture2D(uTexture, vTexCoord).a;
      gl_FragColor = color;
      gl_FragColor.a = alpha;
    }
    `,Convolute_5_1:`
    precision highp float;
    uniform sampler2D uTexture;
    uniform float uMatrix[25];
    uniform float uStepW;
    uniform float uStepH;
    varying vec2 vTexCoord;
    void main() {
      vec4 color = vec4(0, 0, 0, 0);
      for (float h = 0.0; h < 5.0; h+=1.0) {
        for (float w = 0.0; w < 5.0; w+=1.0) {
          vec2 matrixPos = vec2(uStepW * (w - 2.0), uStepH * (h - 2.0));
          color += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 5.0 + w)];
        }
      }
      gl_FragColor = color;
    }
    `,Convolute_5_0:`
    precision highp float;
    uniform sampler2D uTexture;
    uniform float uMatrix[25];
    uniform float uStepW;
    uniform float uStepH;
    varying vec2 vTexCoord;
    void main() {
      vec4 color = vec4(0, 0, 0, 1);
      for (float h = 0.0; h < 5.0; h+=1.0) {
        for (float w = 0.0; w < 5.0; w+=1.0) {
          vec2 matrixPos = vec2(uStepW * (w - 2.0), uStepH * (h - 2.0));
          color.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 5.0 + w)];
        }
      }
      float alpha = texture2D(uTexture, vTexCoord).a;
      gl_FragColor = color;
      gl_FragColor.a = alpha;
    }
    `,Convolute_7_1:`
    precision highp float;
    uniform sampler2D uTexture;
    uniform float uMatrix[49];
    uniform float uStepW;
    uniform float uStepH;
    varying vec2 vTexCoord;
    void main() {
      vec4 color = vec4(0, 0, 0, 0);
      for (float h = 0.0; h < 7.0; h+=1.0) {
        for (float w = 0.0; w < 7.0; w+=1.0) {
          vec2 matrixPos = vec2(uStepW * (w - 3.0), uStepH * (h - 3.0));
          color += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 7.0 + w)];
        }
      }
      gl_FragColor = color;
    }
    `,Convolute_7_0:`
    precision highp float;
    uniform sampler2D uTexture;
    uniform float uMatrix[49];
    uniform float uStepW;
    uniform float uStepH;
    varying vec2 vTexCoord;
    void main() {
      vec4 color = vec4(0, 0, 0, 1);
      for (float h = 0.0; h < 7.0; h+=1.0) {
        for (float w = 0.0; w < 7.0; w+=1.0) {
          vec2 matrixPos = vec2(uStepW * (w - 3.0), uStepH * (h - 3.0));
          color.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 7.0 + w)];
        }
      }
      float alpha = texture2D(uTexture, vTexCoord).a;
      gl_FragColor = color;
      gl_FragColor.a = alpha;
    }
    `,Convolute_9_1:`
    precision highp float;
    uniform sampler2D uTexture;
    uniform float uMatrix[81];
    uniform float uStepW;
    uniform float uStepH;
    varying vec2 vTexCoord;
    void main() {
      vec4 color = vec4(0, 0, 0, 0);
      for (float h = 0.0; h < 9.0; h+=1.0) {
        for (float w = 0.0; w < 9.0; w+=1.0) {
          vec2 matrixPos = vec2(uStepW * (w - 4.0), uStepH * (h - 4.0));
          color += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 9.0 + w)];
        }
      }
      gl_FragColor = color;
    }
    `,Convolute_9_0:`
    precision highp float;
    uniform sampler2D uTexture;
    uniform float uMatrix[81];
    uniform float uStepW;
    uniform float uStepH;
    varying vec2 vTexCoord;
    void main() {
      vec4 color = vec4(0, 0, 0, 1);
      for (float h = 0.0; h < 9.0; h+=1.0) {
        for (float w = 0.0; w < 9.0; w+=1.0) {
          vec2 matrixPos = vec2(uStepW * (w - 4.0), uStepH * (h - 4.0));
          color.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 9.0 + w)];
        }
      }
      float alpha = texture2D(uTexture, vTexCoord).a;
      gl_FragColor = color;
      gl_FragColor.a = alpha;
    }
    `};class tm extends bn{getCacheKey(){return"".concat(this.type,"_").concat(Math.sqrt(this.matrix.length),"_").concat(this.opaque?1:0)}getFragmentSource(){return nY[this.getCacheKey()]}applyTo2d(e){const r=e.imageData,n=r.data,s=this.matrix,i=Math.round(Math.sqrt(s.length)),o=Math.floor(i/2),a=r.width,l=r.height,c=e.ctx.createImageData(a,l),u=c.data,d=this.opaque?1:0;let h,f,p,m,y,g,_,v,w,x,M,T,S;for(M=0;M<l;M++)for(x=0;x<a;x++){for(y=4*(M*a+x),h=0,f=0,p=0,m=0,S=0;S<i;S++)for(T=0;T<i;T++)_=M+S-o,g=x+T-o,_<0||_>=l||g<0||g>=a||(v=4*(_*a+g),w=s[S*i+T],h+=n[v]*w,f+=n[v+1]*w,p+=n[v+2]*w,d||(m+=n[v+3]*w));u[y]=h,u[y+1]=f,u[y+2]=p,u[y+3]=d?n[y+3]:m}e.imageData=c}sendUniformData(e,r){e.uniform1fv(r.uMatrix,this.matrix)}toObject(){return ge(ge({},super.toObject()),{},{opaque:this.opaque,matrix:[...this.matrix]})}}fe(tm,"type","Convolute"),fe(tm,"defaults",{opaque:!1,matrix:[0,0,0,0,1,0,0,0,0]}),fe(tm,"uniformLocations",["uMatrix","uOpaque","uHalfSize","uSize"]),ht.setClass(tm);const DB="Gamma";class rm extends bn{getFragmentSource(){return`
  precision highp float;
  uniform sampler2D uTexture;
  uniform vec3 uGamma;
  varying vec2 vTexCoord;
  void main() {
    vec4 color = texture2D(uTexture, vTexCoord);
    vec3 correction = (1.0 / uGamma);
    color.r = pow(color.r, correction.r);
    color.g = pow(color.g, correction.g);
    color.b = pow(color.b, correction.b);
    gl_FragColor = color;
    gl_FragColor.rgb *= color.a;
  }
`}constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};super(e),this.gamma=e.gamma||this.constructor.defaults.gamma.concat()}applyTo2d(e){let{imageData:{data:r}}=e;const n=this.gamma,s=1/n[0],i=1/n[1],o=1/n[2];this.rgbValues||(this.rgbValues={r:new Uint8Array(256),g:new Uint8Array(256),b:new Uint8Array(256)});const a=this.rgbValues;for(let l=0;l<256;l++)a.r[l]=255*Math.pow(l/255,s),a.g[l]=255*Math.pow(l/255,i),a.b[l]=255*Math.pow(l/255,o);for(let l=0;l<r.length;l+=4)r[l]=a.r[r[l]],r[l+1]=a.g[r[l+1]],r[l+2]=a.b[r[l+2]]}sendUniformData(e,r){e.uniform3fv(r.uGamma,this.gamma)}isNeutralState(){const{gamma:e}=this;return e[0]===1&&e[1]===1&&e[2]===1}toObject(){return{type:DB,gamma:this.gamma.concat()}}}fe(rm,"type",DB),fe(rm,"defaults",{gamma:[1,1,1]}),fe(rm,"uniformLocations",["uGamma"]),ht.setClass(rm);const sY={average:`
    precision highp float;
    uniform sampler2D uTexture;
    varying vec2 vTexCoord;
    void main() {
      vec4 color = texture2D(uTexture, vTexCoord);
      float average = (color.r + color.b + color.g) / 3.0;
      gl_FragColor = vec4(average, average, average, color.a);
    }
    `,lightness:`
    precision highp float;
    uniform sampler2D uTexture;
    uniform int uMode;
    varying vec2 vTexCoord;
    void main() {
      vec4 col = texture2D(uTexture, vTexCoord);
      float average = (max(max(col.r, col.g),col.b) + min(min(col.r, col.g),col.b)) / 2.0;
      gl_FragColor = vec4(average, average, average, col.a);
    }
    `,luminosity:`
    precision highp float;
    uniform sampler2D uTexture;
    uniform int uMode;
    varying vec2 vTexCoord;
    void main() {
      vec4 col = texture2D(uTexture, vTexCoord);
      float average = 0.21 * col.r + 0.72 * col.g + 0.07 * col.b;
      gl_FragColor = vec4(average, average, average, col.a);
    }
    `};class nm extends bn{applyTo2d(e){let{imageData:{data:r}}=e;for(let n,s=0;s<r.length;s+=4){const i=r[s],o=r[s+1],a=r[s+2];switch(this.mode){case"average":n=(i+o+a)/3;break;case"lightness":n=(Math.min(i,o,a)+Math.max(i,o,a))/2;break;case"luminosity":n=.21*i+.72*o+.07*a}r[s+2]=r[s+1]=r[s]=n}}getCacheKey(){return"".concat(this.type,"_").concat(this.mode)}getFragmentSource(){return sY[this.mode]}sendUniformData(e,r){e.uniform1i(r.uMode,1)}isNeutralState(){return!1}}fe(nm,"type","Grayscale"),fe(nm,"defaults",{mode:"average"}),fe(nm,"uniformLocations",["uMode"]),ht.setClass(nm);const iY=ge(ge({},OB),{},{rotation:0});class zv extends Xc{calculateMatrix(){const e=this.rotation*Math.PI,r=Bo(e),n=Vo(e),s=1/3,i=Math.sqrt(s)*n,o=1-r;this.matrix=[r+o/3,s*o-i,s*o+i,0,0,s*o+i,r+s*o,s*o-i,0,0,s*o-i,s*o+i,r+s*o,0,0,0,0,0,1,0]}isNeutralState(){return this.rotation===0}applyTo(e){this.calculateMatrix(),super.applyTo(e)}toObject(){return{type:this.type,rotation:this.rotation}}}fe(zv,"type","HueRotation"),fe(zv,"defaults",iY),ht.setClass(zv);class sm extends bn{applyTo2d(e){let{imageData:{data:r}}=e;for(let n=0;n<r.length;n+=4)r[n]=255-r[n],r[n+1]=255-r[n+1],r[n+2]=255-r[n+2],this.alpha&&(r[n+3]=255-r[n+3])}getFragmentSource(){return`
  precision highp float;
  uniform sampler2D uTexture;
  uniform int uInvert;
  uniform int uAlpha;
  varying vec2 vTexCoord;
  void main() {
    vec4 color = texture2D(uTexture, vTexCoord);
    if (uInvert == 1) {
      if (uAlpha == 1) {
        gl_FragColor = vec4(1.0 - color.r,1.0 -color.g,1.0 -color.b,1.0 -color.a);
      } else {
        gl_FragColor = vec4(1.0 - color.r,1.0 -color.g,1.0 -color.b,color.a);
      }
    } else {
      gl_FragColor = color;
    }
  }
`}isNeutralState(){return!this.invert}sendUniformData(e,r){e.uniform1i(r.uInvert,Number(this.invert)),e.uniform1i(r.uAlpha,Number(this.alpha))}}fe(sm,"type","Invert"),fe(sm,"defaults",{alpha:!1,invert:!0}),fe(sm,"uniformLocations",["uInvert","uAlpha"]),ht.setClass(sm);class im extends bn{getFragmentSource(){return`
  precision highp float;
  uniform sampler2D uTexture;
  uniform float uStepH;
  uniform float uNoise;
  uniform float uSeed;
  varying vec2 vTexCoord;
  float rand(vec2 co, float seed, float vScale) {
    return fract(sin(dot(co.xy * vScale ,vec2(12.9898 , 78.233))) * 43758.5453 * (seed + 0.01) / 2.0);
  }
  void main() {
    vec4 color = texture2D(uTexture, vTexCoord);
    color.rgb += (0.5 - rand(vTexCoord, uSeed, 0.1 / uStepH)) * uNoise;
    gl_FragColor = color;
  }
`}applyTo2d(e){let{imageData:{data:r}}=e;const n=this.noise;for(let s=0;s<r.length;s+=4){const i=(.5-Math.random())*n;r[s]+=i,r[s+1]+=i,r[s+2]+=i}}sendUniformData(e,r){e.uniform1f(r.uNoise,this.noise/255),e.uniform1f(r.uSeed,Math.random())}isNeutralState(){return this.noise===0}}fe(im,"type","Noise"),fe(im,"defaults",{noise:0}),fe(im,"uniformLocations",["uNoise","uSeed"]),ht.setClass(im);class om extends bn{applyTo2d(e){let{imageData:{data:r,width:n,height:s}}=e;for(let i=0;i<s;i+=this.blocksize)for(let o=0;o<n;o+=this.blocksize){const a=4*i*n+4*o,l=r[a],c=r[a+1],u=r[a+2],d=r[a+3];for(let h=i;h<Math.min(i+this.blocksize,s);h++)for(let f=o;f<Math.min(o+this.blocksize,n);f++){const p=4*h*n+4*f;r[p]=l,r[p+1]=c,r[p+2]=u,r[p+3]=d}}}isNeutralState(){return this.blocksize===1}getFragmentSource(){return`
  precision highp float;
  uniform sampler2D uTexture;
  uniform float uBlocksize;
  uniform float uStepW;
  uniform float uStepH;
  varying vec2 vTexCoord;
  void main() {
    float blockW = uBlocksize * uStepW;
    float blockH = uBlocksize * uStepH;
    int posX = int(vTexCoord.x / blockW);
    int posY = int(vTexCoord.y / blockH);
    float fposX = float(posX);
    float fposY = float(posY);
    vec2 squareCoords = vec2(fposX * blockW, fposY * blockH);
    vec4 color = texture2D(uTexture, squareCoords);
    gl_FragColor = color;
  }
`}sendUniformData(e,r){e.uniform1f(r.uBlocksize,this.blocksize)}}fe(om,"type","Pixelate"),fe(om,"defaults",{blocksize:4}),fe(om,"uniformLocations",["uBlocksize"]),ht.setClass(om);class am extends bn{getFragmentSource(){return`
precision highp float;
uniform sampler2D uTexture;
uniform vec4 uLow;
uniform vec4 uHigh;
varying vec2 vTexCoord;
void main() {
  gl_FragColor = texture2D(uTexture, vTexCoord);
  if(all(greaterThan(gl_FragColor.rgb,uLow.rgb)) && all(greaterThan(uHigh.rgb,gl_FragColor.rgb))) {
    gl_FragColor.a = 0.0;
  }
}
`}applyTo2d(e){let{imageData:{data:r}}=e;const n=255*this.distance,s=new _r(this.color).getSource(),i=[s[0]-n,s[1]-n,s[2]-n],o=[s[0]+n,s[1]+n,s[2]+n];for(let a=0;a<r.length;a+=4){const l=r[a],c=r[a+1],u=r[a+2];l>i[0]&&c>i[1]&&u>i[2]&&l<o[0]&&c<o[1]&&u<o[2]&&(r[a+3]=0)}}sendUniformData(e,r){const n=new _r(this.color).getSource(),s=this.distance,i=[0+n[0]/255-s,0+n[1]/255-s,0+n[2]/255-s,1],o=[n[0]/255+s,n[1]/255+s,n[2]/255+s,1];e.uniform4fv(r.uLow,i),e.uniform4fv(r.uHigh,o)}}fe(am,"type","RemoveColor"),fe(am,"defaults",{color:"#FFFFFF",distance:.02,useAlpha:!1}),fe(am,"uniformLocations",["uLow","uHigh"]),ht.setClass(am);class lm extends bn{sendUniformData(e,r){e.uniform2fv(r.uDelta,this.horizontal?[1/this.width,0]:[0,1/this.height]),e.uniform1fv(r.uTaps,this.taps)}getFilterWindow(){const e=this.tempScale;return Math.ceil(this.lanczosLobes/e)}getCacheKey(){const e=this.getFilterWindow();return"".concat(this.type,"_").concat(e)}getFragmentSource(){const e=this.getFilterWindow();return this.generateShader(e)}getTaps(){const e=this.lanczosCreate(this.lanczosLobes),r=this.tempScale,n=this.getFilterWindow(),s=new Array(n);for(let i=1;i<=n;i++)s[i-1]=e(i*r);return s}generateShader(e){const r=new Array(e);for(let n=1;n<=e;n++)r[n-1]="".concat(n,".0 * uDelta");return`
      precision highp float;
      uniform sampler2D uTexture;
      uniform vec2 uDelta;
      varying vec2 vTexCoord;
      uniform float uTaps[`.concat(e,`];
      void main() {
        vec4 color = texture2D(uTexture, vTexCoord);
        float sum = 1.0;
        `).concat(r.map((n,s)=>`
              color += texture2D(uTexture, vTexCoord + `.concat(n,") * uTaps[").concat(s,"] + texture2D(uTexture, vTexCoord - ").concat(n,") * uTaps[").concat(s,`];
              sum += 2.0 * uTaps[`).concat(s,`];
            `)).join(`
`),`
        gl_FragColor = color / sum;
      }
    `)}applyToForWebgl(e){e.passes++,this.width=e.sourceWidth,this.horizontal=!0,this.dW=Math.round(this.width*this.scaleX),this.dH=e.sourceHeight,this.tempScale=this.dW/this.width,this.taps=this.getTaps(),e.destinationWidth=this.dW,super.applyTo(e),e.sourceWidth=e.destinationWidth,this.height=e.sourceHeight,this.horizontal=!1,this.dH=Math.round(this.height*this.scaleY),this.tempScale=this.dH/this.height,this.taps=this.getTaps(),e.destinationHeight=this.dH,super.applyTo(e),e.sourceHeight=e.destinationHeight}applyTo(e){P_(e)?this.applyToForWebgl(e):this.applyTo2d(e)}isNeutralState(){return this.scaleX===1&&this.scaleY===1}lanczosCreate(e){return r=>{if(r>=e||r<=-e)return 0;if(r<11920929e-14&&r>-11920929e-14)return 1;const n=(r*=Math.PI)/e;return Math.sin(r)/r*Math.sin(n)/n}}applyTo2d(e){const r=e.imageData,n=this.scaleX,s=this.scaleY;this.rcpScaleX=1/n,this.rcpScaleY=1/s;const i=r.width,o=r.height,a=Math.round(i*n),l=Math.round(o*s);let c;c=this.resizeType==="sliceHack"?this.sliceByTwo(e,i,o,a,l):this.resizeType==="hermite"?this.hermiteFastResize(e,i,o,a,l):this.resizeType==="bilinear"?this.bilinearFiltering(e,i,o,a,l):this.resizeType==="lanczos"?this.lanczosResize(e,i,o,a,l):new ImageData(a,l),e.imageData=c}sliceByTwo(e,r,n,s,i){const o=e.imageData,a=.5;let l=!1,c=!1,u=r*a,d=n*a;const h=e.filterBackend.resources;let f=0,p=0;const m=r;let y=0;h.sliceByTwo||(h.sliceByTwo=Wo());const g=h.sliceByTwo;(g.width<1.5*r||g.height<n)&&(g.width=1.5*r,g.height=n);const _=g.getContext("2d");for(_.clearRect(0,0,1.5*r,n),_.putImageData(o,0,0),s=Math.floor(s),i=Math.floor(i);!l||!c;)r=u,n=d,s<Math.floor(u*a)?u=Math.floor(u*a):(u=s,l=!0),i<Math.floor(d*a)?d=Math.floor(d*a):(d=i,c=!0),_.drawImage(g,f,p,r,n,m,y,u,d),f=m,p=y,y+=d;return _.getImageData(f,p,s,i)}lanczosResize(e,r,n,s,i){const o=e.imageData.data,a=e.ctx.createImageData(s,i),l=a.data,c=this.lanczosCreate(this.lanczosLobes),u=this.rcpScaleX,d=this.rcpScaleY,h=2/this.rcpScaleX,f=2/this.rcpScaleY,p=Math.ceil(u*this.lanczosLobes/2),m=Math.ceil(d*this.lanczosLobes/2),y={},g={x:0,y:0},_={x:0,y:0};return function v(w){let x,M,T,S,k,$,j,V,L,X,K;for(g.x=(w+.5)*u,_.x=Math.floor(g.x),x=0;x<i;x++){for(g.y=(x+.5)*d,_.y=Math.floor(g.y),k=0,$=0,j=0,V=0,L=0,M=_.x-p;M<=_.x+p;M++)if(!(M<0||M>=r)){X=Math.floor(1e3*Math.abs(M-g.x)),y[X]||(y[X]={});for(let Y=_.y-m;Y<=_.y+m;Y++)Y<0||Y>=n||(K=Math.floor(1e3*Math.abs(Y-g.y)),y[X][K]||(y[X][K]=c(Math.sqrt(Math.pow(X*h,2)+Math.pow(K*f,2))/1e3)),T=y[X][K],T>0&&(S=4*(Y*r+M),k+=T,$+=T*o[S],j+=T*o[S+1],V+=T*o[S+2],L+=T*o[S+3]))}S=4*(x*s+w),l[S]=$/k,l[S+1]=j/k,l[S+2]=V/k,l[S+3]=L/k}return++w<s?v(w):a}(0)}bilinearFiltering(e,r,n,s,i){let o,a,l,c,u,d,h,f,p,m,y,g,_,v=0;const w=this.rcpScaleX,x=this.rcpScaleY,M=4*(r-1),T=e.imageData.data,S=e.ctx.createImageData(s,i),k=S.data;for(h=0;h<i;h++)for(f=0;f<s;f++)for(u=Math.floor(w*f),d=Math.floor(x*h),p=w*f-u,m=x*h-d,_=4*(d*r+u),y=0;y<4;y++)o=T[_+y],a=T[_+4+y],l=T[_+M+y],c=T[_+M+4+y],g=o*(1-p)*(1-m)+a*p*(1-m)+l*m*(1-p)+c*p*m,k[v++]=g;return S}hermiteFastResize(e,r,n,s,i){const o=this.rcpScaleX,a=this.rcpScaleY,l=Math.ceil(o/2),c=Math.ceil(a/2),u=e.imageData.data,d=e.ctx.createImageData(s,i),h=d.data;for(let f=0;f<i;f++)for(let p=0;p<s;p++){const m=4*(p+f*s);let y=0,g=0,_=0,v=0,w=0,x=0,M=0;const T=(f+.5)*a;for(let S=Math.floor(f*a);S<(f+1)*a;S++){const k=Math.abs(T-(S+.5))/c,$=(p+.5)*o,j=k*k;for(let V=Math.floor(p*o);V<(p+1)*o;V++){let L=Math.abs($-(V+.5))/l;const X=Math.sqrt(j+L*L);X>1&&X<-1||(y=2*X*X*X-3*X*X+1,y>0&&(L=4*(V+S*r),M+=y*u[L+3],_+=y,u[L+3]<255&&(y=y*u[L+3]/250),v+=y*u[L],w+=y*u[L+1],x+=y*u[L+2],g+=y))}}h[m]=v/g,h[m+1]=w/g,h[m+2]=x/g,h[m+3]=M/_}return d}}fe(lm,"type","Resize"),fe(lm,"defaults",{resizeType:"hermite",scaleX:1,scaleY:1,lanczosLobes:3}),fe(lm,"uniformLocations",["uDelta","uTaps"]),ht.setClass(lm);class cm extends bn{getFragmentSource(){return`
  precision highp float;
  uniform sampler2D uTexture;
  uniform float uSaturation;
  varying vec2 vTexCoord;
  void main() {
    vec4 color = texture2D(uTexture, vTexCoord);
    float rgMax = max(color.r, color.g);
    float rgbMax = max(rgMax, color.b);
    color.r += rgbMax != color.r ? (rgbMax - color.r) * uSaturation : 0.00;
    color.g += rgbMax != color.g ? (rgbMax - color.g) * uSaturation : 0.00;
    color.b += rgbMax != color.b ? (rgbMax - color.b) * uSaturation : 0.00;
    gl_FragColor = color;
  }
`}applyTo2d(e){let{imageData:{data:r}}=e;const n=-this.saturation;for(let s=0;s<r.length;s+=4){const i=r[s],o=r[s+1],a=r[s+2],l=Math.max(i,o,a);r[s]+=l!==i?(l-i)*n:0,r[s+1]+=l!==o?(l-o)*n:0,r[s+2]+=l!==a?(l-a)*n:0}}sendUniformData(e,r){e.uniform1f(r.uSaturation,-this.saturation)}isNeutralState(){return this.saturation===0}}fe(cm,"type","Saturation"),fe(cm,"defaults",{saturation:0}),fe(cm,"uniformLocations",["uSaturation"]),ht.setClass(cm);class um extends bn{getFragmentSource(){return`
  precision highp float;
  uniform sampler2D uTexture;
  uniform float uVibrance;
  varying vec2 vTexCoord;
  void main() {
    vec4 color = texture2D(uTexture, vTexCoord);
    float max = max(color.r, max(color.g, color.b));
    float avg = (color.r + color.g + color.b) / 3.0;
    float amt = (abs(max - avg) * 2.0) * uVibrance;
    color.r += max != color.r ? (max - color.r) * amt : 0.00;
    color.g += max != color.g ? (max - color.g) * amt : 0.00;
    color.b += max != color.b ? (max - color.b) * amt : 0.00;
    gl_FragColor = color;
  }
`}applyTo2d(e){let{imageData:{data:r}}=e;const n=-this.vibrance;for(let s=0;s<r.length;s+=4){const i=r[s],o=r[s+1],a=r[s+2],l=Math.max(i,o,a),c=(i+o+a)/3,u=2*Math.abs(l-c)/255*n;r[s]+=l!==i?(l-i)*u:0,r[s+1]+=l!==o?(l-o)*u:0,r[s+2]+=l!==a?(l-a)*u:0}}sendUniformData(e,r){e.uniform1f(r.uVibrance,-this.vibrance)}isNeutralState(){return this.vibrance===0}}fe(um,"type","Vibrance"),fe(um,"defaults",{vibrance:0}),fe(um,"uniformLocations",["uVibrance"]),ht.setClass(um);function Ng(t,[e,r]){return Math.min(r,Math.max(e,t))}var oY=D.createContext(void 0);function IB(t){const e=D.useContext(oY);return t||e||"ltr"}function FB(t){const e=D.useRef({value:t,previous:t});return D.useMemo(()=>(e.current.value!==t&&(e.current.previous=e.current.value,e.current.value=t),e.current.previous),[t])}var LB=["PageUp","PageDown"],RB=["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"],jB={"from-left":["Home","PageDown","ArrowDown","ArrowLeft"],"from-right":["Home","PageDown","ArrowDown","ArrowRight"],"from-bottom":["Home","PageDown","ArrowDown","ArrowLeft"],"from-top":["Home","PageDown","ArrowUp","ArrowLeft"]},Ku="Slider",[Ix,aY,lY]=G1(Ku),[NB,IJ]=Iu(Ku,[lY]),[cY,k_]=NB(Ku),zB=D.forwardRef((t,e)=>{const{name:r,min:n=0,max:s=100,step:i=1,orientation:o="horizontal",disabled:a=!1,minStepsBetweenThumbs:l=0,defaultValue:c=[n],value:u,onValueChange:d=()=>{},onValueCommit:h=()=>{},inverted:f=!1,form:p,...m}=t,y=D.useRef(new Set),g=D.useRef(0),v=o==="horizontal"?uY:dY,[w=[],x]=Fh({prop:u,defaultProp:c,onChange:j=>{var L;(L=[...y.current][g.current])==null||L.focus(),d(j)}}),M=D.useRef(w);function T(j){const V=gY(w,j);$(j,V)}function S(j){$(j,g.current)}function k(){const j=M.current[g.current];w[g.current]!==j&&h(w)}function $(j,V,{commit:L}={commit:!1}){const X=wY(i),K=xY(Math.round((j-n)/i)*i+n,X),Y=Ng(K,[n,s]);x((J=[])=>{const N=pY(J,Y,V);if(vY(N,l*i)){g.current=N.indexOf(Y);const ne=String(N)!==String(J);return ne&&L&&h(N),ne?N:J}else return J})}return G.jsx(cY,{scope:t.__scopeSlider,name:r,disabled:a,min:n,max:s,valueIndexToChangeRef:g,thumbs:y.current,values:w,orientation:o,form:p,children:G.jsx(Ix.Provider,{scope:t.__scopeSlider,children:G.jsx(Ix.Slot,{scope:t.__scopeSlider,children:G.jsx(v,{"aria-disabled":a,"data-disabled":a?"":void 0,...m,ref:e,onPointerDown:$t(m.onPointerDown,()=>{a||(M.current=w)}),min:n,max:s,inverted:f,onSlideStart:a?void 0:T,onSlideMove:a?void 0:S,onSlideEnd:a?void 0:k,onHomeKeyDown:()=>!a&&$(n,0,{commit:!0}),onEndKeyDown:()=>!a&&$(s,w.length-1,{commit:!0}),onStepKeyDown:({event:j,direction:V})=>{if(!a){const K=LB.includes(j.key)||j.shiftKey&&RB.includes(j.key)?10:1,Y=g.current,J=w[Y],N=i*K*V;$(J+N,Y,{commit:!0})}}})})})})});zB.displayName=Ku;var[BB,VB]=NB(Ku,{startEdge:"left",endEdge:"right",size:"width",direction:1}),uY=D.forwardRef((t,e)=>{const{min:r,max:n,dir:s,inverted:i,onSlideStart:o,onSlideMove:a,onSlideEnd:l,onStepKeyDown:c,...u}=t,[d,h]=D.useState(null),f=cr(e,v=>h(v)),p=D.useRef(),m=IB(s),y=m==="ltr",g=y&&!i||!y&&i;function _(v){const w=p.current||d.getBoundingClientRect(),x=[0,w.width],T=oM(x,g?[r,n]:[n,r]);return p.current=w,T(v-w.left)}return G.jsx(BB,{scope:t.__scopeSlider,startEdge:g?"left":"right",endEdge:g?"right":"left",direction:g?1:-1,size:"width",children:G.jsx(WB,{dir:m,"data-orientation":"horizontal",...u,ref:f,style:{...u.style,"--radix-slider-thumb-transform":"translateX(-50%)"},onSlideStart:v=>{const w=_(v.clientX);o==null||o(w)},onSlideMove:v=>{const w=_(v.clientX);a==null||a(w)},onSlideEnd:()=>{p.current=void 0,l==null||l()},onStepKeyDown:v=>{const x=jB[g?"from-left":"from-right"].includes(v.key);c==null||c({event:v,direction:x?-1:1})}})})}),dY=D.forwardRef((t,e)=>{const{min:r,max:n,inverted:s,onSlideStart:i,onSlideMove:o,onSlideEnd:a,onStepKeyDown:l,...c}=t,u=D.useRef(null),d=cr(e,u),h=D.useRef(),f=!s;function p(m){const y=h.current||u.current.getBoundingClientRect(),g=[0,y.height],v=oM(g,f?[n,r]:[r,n]);return h.current=y,v(m-y.top)}return G.jsx(BB,{scope:t.__scopeSlider,startEdge:f?"bottom":"top",endEdge:f?"top":"bottom",size:"height",direction:f?1:-1,children:G.jsx(WB,{"data-orientation":"vertical",...c,ref:d,style:{...c.style,"--radix-slider-thumb-transform":"translateY(50%)"},onSlideStart:m=>{const y=p(m.clientY);i==null||i(y)},onSlideMove:m=>{const y=p(m.clientY);o==null||o(y)},onSlideEnd:()=>{h.current=void 0,a==null||a()},onStepKeyDown:m=>{const g=jB[f?"from-bottom":"from-top"].includes(m.key);l==null||l({event:m,direction:g?-1:1})}})})}),WB=D.forwardRef((t,e)=>{const{__scopeSlider:r,onSlideStart:n,onSlideMove:s,onSlideEnd:i,onHomeKeyDown:o,onEndKeyDown:a,onStepKeyDown:l,...c}=t,u=k_(Ku,r);return G.jsx(Kt.span,{...c,ref:e,onKeyDown:$t(t.onKeyDown,d=>{d.key==="Home"?(o(d),d.preventDefault()):d.key==="End"?(a(d),d.preventDefault()):LB.concat(RB).includes(d.key)&&(l(d),d.preventDefault())}),onPointerDown:$t(t.onPointerDown,d=>{const h=d.target;h.setPointerCapture(d.pointerId),d.preventDefault(),u.thumbs.has(h)?h.focus():n(d)}),onPointerMove:$t(t.onPointerMove,d=>{d.target.hasPointerCapture(d.pointerId)&&s(d)}),onPointerUp:$t(t.onPointerUp,d=>{const h=d.target;h.hasPointerCapture(d.pointerId)&&(h.releasePointerCapture(d.pointerId),i(d))})})}),UB="SliderTrack",GB=D.forwardRef((t,e)=>{const{__scopeSlider:r,...n}=t,s=k_(UB,r);return G.jsx(Kt.span,{"data-disabled":s.disabled?"":void 0,"data-orientation":s.orientation,...n,ref:e})});GB.displayName=UB;var Fx="SliderRange",HB=D.forwardRef((t,e)=>{const{__scopeSlider:r,...n}=t,s=k_(Fx,r),i=VB(Fx,r),o=D.useRef(null),a=cr(e,o),l=s.values.length,c=s.values.map(h=>XB(h,s.min,s.max)),u=l>1?Math.min(...c):0,d=100-Math.max(...c);return G.jsx(Kt.span,{"data-orientation":s.orientation,"data-disabled":s.disabled?"":void 0,...n,ref:a,style:{...t.style,[i.startEdge]:u+"%",[i.endEdge]:d+"%"}})});HB.displayName=Fx;var Lx="SliderThumb",KB=D.forwardRef((t,e)=>{const r=aY(t.__scopeSlider),[n,s]=D.useState(null),i=cr(e,a=>s(a)),o=D.useMemo(()=>n?r().findIndex(a=>a.ref.current===n):-1,[r,n]);return G.jsx(hY,{...t,ref:i,index:o})}),hY=D.forwardRef((t,e)=>{const{__scopeSlider:r,index:n,name:s,...i}=t,o=k_(Lx,r),a=VB(Lx,r),[l,c]=D.useState(null),u=cr(e,_=>c(_)),d=l?o.form||!!l.closest("form"):!0,h=iR(l),f=o.values[n],p=f===void 0?0:XB(f,o.min,o.max),m=mY(n,o.values.length),y=h==null?void 0:h[a.size],g=y?_Y(y,p,a.direction):0;return D.useEffect(()=>{if(l)return o.thumbs.add(l),()=>{o.thumbs.delete(l)}},[l,o.thumbs]),G.jsxs("span",{style:{transform:"var(--radix-slider-thumb-transform)",position:"absolute",[a.startEdge]:`calc(${p}% + ${g}px)`},children:[G.jsx(Ix.ItemSlot,{scope:t.__scopeSlider,children:G.jsx(Kt.span,{role:"slider","aria-label":t["aria-label"]||m,"aria-valuemin":o.min,"aria-valuenow":f,"aria-valuemax":o.max,"aria-orientation":o.orientation,"data-orientation":o.orientation,"data-disabled":o.disabled?"":void 0,tabIndex:o.disabled?void 0:0,...i,ref:u,style:f===void 0?{display:"none"}:t.style,onFocus:$t(t.onFocus,()=>{o.valueIndexToChangeRef.current=n})})}),d&&G.jsx(fY,{name:s??(o.name?o.name+(o.values.length>1?"[]":""):void 0),form:o.form,value:f},n)]})});KB.displayName=Lx;var fY=t=>{const{value:e,...r}=t,n=D.useRef(null),s=FB(e);return D.useEffect(()=>{const i=n.current,o=window.HTMLInputElement.prototype,l=Object.getOwnPropertyDescriptor(o,"value").set;if(s!==e&&l){const c=new Event("input",{bubbles:!0});l.call(i,e),i.dispatchEvent(c)}},[s,e]),G.jsx("input",{style:{display:"none"},...r,ref:n,defaultValue:e})};function pY(t=[],e,r){const n=[...t];return n[r]=e,n.sort((s,i)=>s-i)}function XB(t,e,r){const i=100/(r-e)*(t-e);return Ng(i,[0,100])}function mY(t,e){return e>2?`Value ${t+1} of ${e}`:e===2?["Minimum","Maximum"][t]:void 0}function gY(t,e){if(t.length===1)return 0;const r=t.map(s=>Math.abs(s-e)),n=Math.min(...r);return r.indexOf(n)}function _Y(t,e,r){const n=t/2,i=oM([0,50],[0,n]);return(n-i(e)*r)*r}function yY(t){return t.slice(0,-1).map((e,r)=>t[r+1]-e)}function vY(t,e){if(e>0){const r=yY(t);return Math.min(...r)>=e}return!0}function oM(t,e){return r=>{if(t[0]===t[1]||e[0]===e[1])return e[0];const n=(e[1]-e[0])/(t[1]-t[0]);return e[0]+n*(r-t[0])}}function wY(t){return(String(t).split(".")[1]||"").length}function xY(t,e){const r=Math.pow(10,e);return Math.round(t*r)/r}var qB=zB,bY=GB,MY=HB,TY=KB;const YB=D.forwardRef(({className:t,...e},r)=>G.jsxs(qB,{ref:r,className:tr("relative flex w-full touch-none select-none items-center",t),...e,children:[G.jsx(bY,{className:"relative h-2 w-full grow overflow-hidden rounded-full bg-secondary",children:G.jsx(MY,{className:"absolute h-full bg-primary"})}),G.jsx(TY,{className:"block h-5 w-5 rounded-full border-2 border-primary bg-background ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50"})]}));YB.displayName=qB.displayName;var Bv=0;function QB(){D.useEffect(()=>{const t=document.querySelectorAll("[data-radix-focus-guard]");return document.body.insertAdjacentElement("afterbegin",t[0]??kD()),document.body.insertAdjacentElement("beforeend",t[1]??kD()),Bv++,()=>{Bv===1&&document.querySelectorAll("[data-radix-focus-guard]").forEach(e=>e.remove()),Bv--}},[])}function kD(){const t=document.createElement("span");return t.setAttribute("data-radix-focus-guard",""),t.tabIndex=0,t.style.outline="none",t.style.opacity="0",t.style.position="fixed",t.style.pointerEvents="none",t}var Vv="focusScope.autoFocusOnMount",Wv="focusScope.autoFocusOnUnmount",AD={bubbles:!1,cancelable:!0},CY="FocusScope",aM=D.forwardRef((t,e)=>{const{loop:r=!1,trapped:n=!1,onMountAutoFocus:s,onUnmountAutoFocus:i,...o}=t,[a,l]=D.useState(null),c=Rs(s),u=Rs(i),d=D.useRef(null),h=cr(e,m=>l(m)),f=D.useRef({paused:!1,pause(){this.paused=!0},resume(){this.paused=!1}}).current;D.useEffect(()=>{if(n){let m=function(v){if(f.paused||!a)return;const w=v.target;a.contains(w)?d.current=w:pa(d.current,{select:!0})},y=function(v){if(f.paused||!a)return;const w=v.relatedTarget;w!==null&&(a.contains(w)||pa(d.current,{select:!0}))},g=function(v){if(document.activeElement===document.body)for(const x of v)x.removedNodes.length>0&&pa(a)};document.addEventListener("focusin",m),document.addEventListener("focusout",y);const _=new MutationObserver(g);return a&&_.observe(a,{childList:!0,subtree:!0}),()=>{document.removeEventListener("focusin",m),document.removeEventListener("focusout",y),_.disconnect()}}},[n,a,f.paused]),D.useEffect(()=>{if(a){OD.add(f);const m=document.activeElement;if(!a.contains(m)){const g=new CustomEvent(Vv,AD);a.addEventListener(Vv,c),a.dispatchEvent(g),g.defaultPrevented||(SY($Y(JB(a)),{select:!0}),document.activeElement===m&&pa(a))}return()=>{a.removeEventListener(Vv,c),setTimeout(()=>{const g=new CustomEvent(Wv,AD);a.addEventListener(Wv,u),a.dispatchEvent(g),g.defaultPrevented||pa(m??document.body,{select:!0}),a.removeEventListener(Wv,u),OD.remove(f)},0)}}},[a,c,u,f]);const p=D.useCallback(m=>{if(!r&&!n||f.paused)return;const y=m.key==="Tab"&&!m.altKey&&!m.ctrlKey&&!m.metaKey,g=document.activeElement;if(y&&g){const _=m.currentTarget,[v,w]=EY(_);v&&w?!m.shiftKey&&g===w?(m.preventDefault(),r&&pa(v,{select:!0})):m.shiftKey&&g===v&&(m.preventDefault(),r&&pa(w,{select:!0})):g===_&&m.preventDefault()}},[r,n,f.paused]);return G.jsx(Kt.div,{tabIndex:-1,...o,ref:h,onKeyDown:p})});aM.displayName=CY;function SY(t,{select:e=!1}={}){const r=document.activeElement;for(const n of t)if(pa(n,{select:e}),document.activeElement!==r)return}function EY(t){const e=JB(t),r=$D(e,t),n=$D(e.reverse(),t);return[r,n]}function JB(t){const e=[],r=document.createTreeWalker(t,NodeFilter.SHOW_ELEMENT,{acceptNode:n=>{const s=n.tagName==="INPUT"&&n.type==="hidden";return n.disabled||n.hidden||s?NodeFilter.FILTER_SKIP:n.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;r.nextNode();)e.push(r.currentNode);return e}function $D(t,e){for(const r of t)if(!PY(r,{upTo:e}))return r}function PY(t,{upTo:e}){if(getComputedStyle(t).visibility==="hidden")return!0;for(;t;){if(e!==void 0&&t===e)return!1;if(getComputedStyle(t).display==="none")return!0;t=t.parentElement}return!1}function kY(t){return t instanceof HTMLInputElement&&"select"in t}function pa(t,{select:e=!1}={}){if(t&&t.focus){const r=document.activeElement;t.focus({preventScroll:!0}),t!==r&&kY(t)&&e&&t.select()}}var OD=AY();function AY(){let t=[];return{add(e){const r=t[0];e!==r&&(r==null||r.pause()),t=DD(t,e),t.unshift(e)},remove(e){var r;t=DD(t,e),(r=t[0])==null||r.resume()}}}function DD(t,e){const r=[...t],n=r.indexOf(e);return n!==-1&&r.splice(n,1),r}function $Y(t){return t.filter(e=>e.tagName!=="A")}var OY=function(t){if(typeof document>"u")return null;var e=Array.isArray(t)?t[0]:t;return e.ownerDocument.body},Sc=new WeakMap,dm=new WeakMap,hm={},Uv=0,ZB=function(t){return t&&(t.host||ZB(t.parentNode))},DY=function(t,e){return e.map(function(r){if(t.contains(r))return r;var n=ZB(r);return n&&t.contains(n)?n:(console.error("aria-hidden",r,"in not contained inside",t,". Doing nothing"),null)}).filter(function(r){return!!r})},IY=function(t,e,r,n){var s=DY(e,Array.isArray(t)?t:[t]);hm[r]||(hm[r]=new WeakMap);var i=hm[r],o=[],a=new Set,l=new Set(s),c=function(d){!d||a.has(d)||(a.add(d),c(d.parentNode))};s.forEach(c);var u=function(d){!d||l.has(d)||Array.prototype.forEach.call(d.children,function(h){if(a.has(h))u(h);else try{var f=h.getAttribute(n),p=f!==null&&f!=="false",m=(Sc.get(h)||0)+1,y=(i.get(h)||0)+1;Sc.set(h,m),i.set(h,y),o.push(h),m===1&&p&&dm.set(h,!0),y===1&&h.setAttribute(r,"true"),p||h.setAttribute(n,"true")}catch(g){console.error("aria-hidden: cannot operate on ",h,g)}})};return u(e),a.clear(),Uv++,function(){o.forEach(function(d){var h=Sc.get(d)-1,f=i.get(d)-1;Sc.set(d,h),i.set(d,f),h||(dm.has(d)||d.removeAttribute(n),dm.delete(d)),f||d.removeAttribute(r)}),Uv--,Uv||(Sc=new WeakMap,Sc=new WeakMap,dm=new WeakMap,hm={})}},e4=function(t,e,r){r===void 0&&(r="data-aria-hidden");var n=Array.from(Array.isArray(t)?t:[t]),s=OY(t);return s?(n.push.apply(n,Array.from(s.querySelectorAll("[aria-live]"))),IY(n,s,r,"aria-hidden")):function(){return null}},lo=function(){return lo=Object.assign||function(e){for(var r,n=1,s=arguments.length;n<s;n++){r=arguments[n];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=r[i])}return e},lo.apply(this,arguments)};function t4(t,e){var r={};for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e.indexOf(n)<0&&(r[n]=t[n]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,n=Object.getOwnPropertySymbols(t);s<n.length;s++)e.indexOf(n[s])<0&&Object.prototype.propertyIsEnumerable.call(t,n[s])&&(r[n[s]]=t[n[s]]);return r}function FY(t,e,r){if(r||arguments.length===2)for(var n=0,s=e.length,i;n<s;n++)(i||!(n in e))&&(i||(i=Array.prototype.slice.call(e,0,n)),i[n]=e[n]);return t.concat(i||Array.prototype.slice.call(e))}var Bm="right-scroll-bar-position",Vm="width-before-scroll-bar",LY="with-scroll-bars-hidden",RY="--removed-body-scroll-bar-size";function Gv(t,e){return typeof t=="function"?t(e):t&&(t.current=e),t}function jY(t,e){var r=D.useState(function(){return{value:t,callback:e,facade:{get current(){return r.value},set current(n){var s=r.value;s!==n&&(r.value=n,r.callback(n,s))}}}})[0];return r.callback=e,r.facade}var NY=typeof window<"u"?D.useLayoutEffect:D.useEffect,ID=new WeakMap;function zY(t,e){var r=jY(null,function(n){return t.forEach(function(s){return Gv(s,n)})});return NY(function(){var n=ID.get(r);if(n){var s=new Set(n),i=new Set(t),o=r.current;s.forEach(function(a){i.has(a)||Gv(a,null)}),i.forEach(function(a){s.has(a)||Gv(a,o)})}ID.set(r,t)},[t]),r}function BY(t){return t}function VY(t,e){e===void 0&&(e=BY);var r=[],n=!1,s={read:function(){if(n)throw new Error("Sidecar: could not `read` from an `assigned` medium. `read` could be used only with `useMedium`.");return r.length?r[r.length-1]:t},useMedium:function(i){var o=e(i,n);return r.push(o),function(){r=r.filter(function(a){return a!==o})}},assignSyncMedium:function(i){for(n=!0;r.length;){var o=r;r=[],o.forEach(i)}r={push:function(a){return i(a)},filter:function(){return r}}},assignMedium:function(i){n=!0;var o=[];if(r.length){var a=r;r=[],a.forEach(i),o=r}var l=function(){var u=o;o=[],u.forEach(i)},c=function(){return Promise.resolve().then(l)};c(),r={push:function(u){o.push(u),c()},filter:function(u){return o=o.filter(u),r}}}};return s}function WY(t){t===void 0&&(t={});var e=VY(null);return e.options=lo({async:!0,ssr:!1},t),e}var r4=function(t){var e=t.sideCar,r=t4(t,["sideCar"]);if(!e)throw new Error("Sidecar: please provide `sideCar` property to import the right car");var n=e.read();if(!n)throw new Error("Sidecar medium not found");return D.createElement(n,lo({},r))};r4.isSideCarExport=!0;function UY(t,e){return t.useMedium(e),r4}var n4=WY(),Hv=function(){},A_=D.forwardRef(function(t,e){var r=D.useRef(null),n=D.useState({onScrollCapture:Hv,onWheelCapture:Hv,onTouchMoveCapture:Hv}),s=n[0],i=n[1],o=t.forwardProps,a=t.children,l=t.className,c=t.removeScrollBar,u=t.enabled,d=t.shards,h=t.sideCar,f=t.noIsolation,p=t.inert,m=t.allowPinchZoom,y=t.as,g=y===void 0?"div":y,_=t.gapMode,v=t4(t,["forwardProps","children","className","removeScrollBar","enabled","shards","sideCar","noIsolation","inert","allowPinchZoom","as","gapMode"]),w=h,x=zY([r,e]),M=lo(lo({},v),s);return D.createElement(D.Fragment,null,u&&D.createElement(w,{sideCar:n4,removeScrollBar:c,shards:d,noIsolation:f,inert:p,setCallbacks:i,allowPinchZoom:!!m,lockRef:r,gapMode:_}),o?D.cloneElement(D.Children.only(a),lo(lo({},M),{ref:x})):D.createElement(g,lo({},M,{className:l,ref:x}),a))});A_.defaultProps={enabled:!0,removeScrollBar:!0,inert:!1};A_.classNames={fullWidth:Vm,zeroRight:Bm};var GY=function(){if(typeof __webpack_nonce__<"u")return __webpack_nonce__};function HY(){if(!document)return null;var t=document.createElement("style");t.type="text/css";var e=GY();return e&&t.setAttribute("nonce",e),t}function KY(t,e){t.styleSheet?t.styleSheet.cssText=e:t.appendChild(document.createTextNode(e))}function XY(t){var e=document.head||document.getElementsByTagName("head")[0];e.appendChild(t)}var qY=function(){var t=0,e=null;return{add:function(r){t==0&&(e=HY())&&(KY(e,r),XY(e)),t++},remove:function(){t--,!t&&e&&(e.parentNode&&e.parentNode.removeChild(e),e=null)}}},YY=function(){var t=qY();return function(e,r){D.useEffect(function(){return t.add(e),function(){t.remove()}},[e&&r])}},s4=function(){var t=YY(),e=function(r){var n=r.styles,s=r.dynamic;return t(n,s),null};return e},QY={left:0,top:0,right:0,gap:0},Kv=function(t){return parseInt(t||"",10)||0},JY=function(t){var e=window.getComputedStyle(document.body),r=e[t==="padding"?"paddingLeft":"marginLeft"],n=e[t==="padding"?"paddingTop":"marginTop"],s=e[t==="padding"?"paddingRight":"marginRight"];return[Kv(r),Kv(n),Kv(s)]},ZY=function(t){if(t===void 0&&(t="margin"),typeof window>"u")return QY;var e=JY(t),r=document.documentElement.clientWidth,n=window.innerWidth;return{left:e[0],top:e[1],right:e[2],gap:Math.max(0,n-r+e[2]-e[0])}},eQ=s4(),lu="data-scroll-locked",tQ=function(t,e,r,n){var s=t.left,i=t.top,o=t.right,a=t.gap;return r===void 0&&(r="margin"),`
  .`.concat(LY,` {
   overflow: hidden `).concat(n,`;
   padding-right: `).concat(a,"px ").concat(n,`;
  }
  body[`).concat(lu,`] {
    overflow: hidden `).concat(n,`;
    overscroll-behavior: contain;
    `).concat([e&&"position: relative ".concat(n,";"),r==="margin"&&`
    padding-left: `.concat(s,`px;
    padding-top: `).concat(i,`px;
    padding-right: `).concat(o,`px;
    margin-left:0;
    margin-top:0;
    margin-right: `).concat(a,"px ").concat(n,`;
    `),r==="padding"&&"padding-right: ".concat(a,"px ").concat(n,";")].filter(Boolean).join(""),`
  }
  
  .`).concat(Bm,` {
    right: `).concat(a,"px ").concat(n,`;
  }
  
  .`).concat(Vm,` {
    margin-right: `).concat(a,"px ").concat(n,`;
  }
  
  .`).concat(Bm," .").concat(Bm,` {
    right: 0 `).concat(n,`;
  }
  
  .`).concat(Vm," .").concat(Vm,` {
    margin-right: 0 `).concat(n,`;
  }
  
  body[`).concat(lu,`] {
    `).concat(RY,": ").concat(a,`px;
  }
`)},FD=function(){var t=parseInt(document.body.getAttribute(lu)||"0",10);return isFinite(t)?t:0},rQ=function(){D.useEffect(function(){return document.body.setAttribute(lu,(FD()+1).toString()),function(){var t=FD()-1;t<=0?document.body.removeAttribute(lu):document.body.setAttribute(lu,t.toString())}},[])},nQ=function(t){var e=t.noRelative,r=t.noImportant,n=t.gapMode,s=n===void 0?"margin":n;rQ();var i=D.useMemo(function(){return ZY(s)},[s]);return D.createElement(eQ,{styles:tQ(i,!e,s,r?"":"!important")})},Rx=!1;if(typeof window<"u")try{var fm=Object.defineProperty({},"passive",{get:function(){return Rx=!0,!0}});window.addEventListener("test",fm,fm),window.removeEventListener("test",fm,fm)}catch{Rx=!1}var Ec=Rx?{passive:!1}:!1,sQ=function(t){return t.tagName==="TEXTAREA"},i4=function(t,e){if(!(t instanceof Element))return!1;var r=window.getComputedStyle(t);return r[e]!=="hidden"&&!(r.overflowY===r.overflowX&&!sQ(t)&&r[e]==="visible")},iQ=function(t){return i4(t,"overflowY")},oQ=function(t){return i4(t,"overflowX")},LD=function(t,e){var r=e.ownerDocument,n=e;do{typeof ShadowRoot<"u"&&n instanceof ShadowRoot&&(n=n.host);var s=o4(t,n);if(s){var i=a4(t,n),o=i[1],a=i[2];if(o>a)return!0}n=n.parentNode}while(n&&n!==r.body);return!1},aQ=function(t){var e=t.scrollTop,r=t.scrollHeight,n=t.clientHeight;return[e,r,n]},lQ=function(t){var e=t.scrollLeft,r=t.scrollWidth,n=t.clientWidth;return[e,r,n]},o4=function(t,e){return t==="v"?iQ(e):oQ(e)},a4=function(t,e){return t==="v"?aQ(e):lQ(e)},cQ=function(t,e){return t==="h"&&e==="rtl"?-1:1},uQ=function(t,e,r,n,s){var i=cQ(t,window.getComputedStyle(e).direction),o=i*n,a=r.target,l=e.contains(a),c=!1,u=o>0,d=0,h=0;do{var f=a4(t,a),p=f[0],m=f[1],y=f[2],g=m-y-i*p;(p||g)&&o4(t,a)&&(d+=g,h+=p),a instanceof ShadowRoot?a=a.host:a=a.parentNode}while(!l&&a!==document.body||l&&(e.contains(a)||e===a));return(u&&(Math.abs(d)<1||!s)||!u&&(Math.abs(h)<1||!s))&&(c=!0),c},pm=function(t){return"changedTouches"in t?[t.changedTouches[0].clientX,t.changedTouches[0].clientY]:[0,0]},RD=function(t){return[t.deltaX,t.deltaY]},jD=function(t){return t&&"current"in t?t.current:t},dQ=function(t,e){return t[0]===e[0]&&t[1]===e[1]},hQ=function(t){return`
  .block-interactivity-`.concat(t,` {pointer-events: none;}
  .allow-interactivity-`).concat(t,` {pointer-events: all;}
`)},fQ=0,Pc=[];function pQ(t){var e=D.useRef([]),r=D.useRef([0,0]),n=D.useRef(),s=D.useState(fQ++)[0],i=D.useState(s4)[0],o=D.useRef(t);D.useEffect(function(){o.current=t},[t]),D.useEffect(function(){if(t.inert){document.body.classList.add("block-interactivity-".concat(s));var m=FY([t.lockRef.current],(t.shards||[]).map(jD),!0).filter(Boolean);return m.forEach(function(y){return y.classList.add("allow-interactivity-".concat(s))}),function(){document.body.classList.remove("block-interactivity-".concat(s)),m.forEach(function(y){return y.classList.remove("allow-interactivity-".concat(s))})}}},[t.inert,t.lockRef.current,t.shards]);var a=D.useCallback(function(m,y){if("touches"in m&&m.touches.length===2||m.type==="wheel"&&m.ctrlKey)return!o.current.allowPinchZoom;var g=pm(m),_=r.current,v="deltaX"in m?m.deltaX:_[0]-g[0],w="deltaY"in m?m.deltaY:_[1]-g[1],x,M=m.target,T=Math.abs(v)>Math.abs(w)?"h":"v";if("touches"in m&&T==="h"&&M.type==="range")return!1;var S=LD(T,M);if(!S)return!0;if(S?x=T:(x=T==="v"?"h":"v",S=LD(T,M)),!S)return!1;if(!n.current&&"changedTouches"in m&&(v||w)&&(n.current=x),!x)return!0;var k=n.current||x;return uQ(k,y,m,k==="h"?v:w,!0)},[]),l=D.useCallback(function(m){var y=m;if(!(!Pc.length||Pc[Pc.length-1]!==i)){var g="deltaY"in y?RD(y):pm(y),_=e.current.filter(function(x){return x.name===y.type&&(x.target===y.target||y.target===x.shadowParent)&&dQ(x.delta,g)})[0];if(_&&_.should){y.cancelable&&y.preventDefault();return}if(!_){var v=(o.current.shards||[]).map(jD).filter(Boolean).filter(function(x){return x.contains(y.target)}),w=v.length>0?a(y,v[0]):!o.current.noIsolation;w&&y.cancelable&&y.preventDefault()}}},[]),c=D.useCallback(function(m,y,g,_){var v={name:m,delta:y,target:g,should:_,shadowParent:mQ(g)};e.current.push(v),setTimeout(function(){e.current=e.current.filter(function(w){return w!==v})},1)},[]),u=D.useCallback(function(m){r.current=pm(m),n.current=void 0},[]),d=D.useCallback(function(m){c(m.type,RD(m),m.target,a(m,t.lockRef.current))},[]),h=D.useCallback(function(m){c(m.type,pm(m),m.target,a(m,t.lockRef.current))},[]);D.useEffect(function(){return Pc.push(i),t.setCallbacks({onScrollCapture:d,onWheelCapture:d,onTouchMoveCapture:h}),document.addEventListener("wheel",l,Ec),document.addEventListener("touchmove",l,Ec),document.addEventListener("touchstart",u,Ec),function(){Pc=Pc.filter(function(m){return m!==i}),document.removeEventListener("wheel",l,Ec),document.removeEventListener("touchmove",l,Ec),document.removeEventListener("touchstart",u,Ec)}},[]);var f=t.removeScrollBar,p=t.inert;return D.createElement(D.Fragment,null,p?D.createElement(i,{styles:hQ(s)}):null,f?D.createElement(nQ,{gapMode:t.gapMode}):null)}function mQ(t){for(var e=null;t!==null;)t instanceof ShadowRoot&&(e=t.host,t=t.host),t=t.parentNode;return e}const gQ=UY(n4,pQ);var lM=D.forwardRef(function(t,e){return D.createElement(A_,lo({},t,{ref:e,sideCar:gQ}))});lM.classNames=A_.classNames;var _Q=[" ","Enter","ArrowUp","ArrowDown"],yQ=[" ","Enter"],uf="Select",[$_,O_,vQ]=G1(uf),[Xu,FJ]=Iu(uf,[vQ,u_]),D_=u_(),[wQ,qa]=Xu(uf),[xQ,bQ]=Xu(uf),l4=t=>{const{__scopeSelect:e,children:r,open:n,defaultOpen:s,onOpenChange:i,value:o,defaultValue:a,onValueChange:l,dir:c,name:u,autoComplete:d,disabled:h,required:f,form:p}=t,m=D_(e),[y,g]=D.useState(null),[_,v]=D.useState(null),[w,x]=D.useState(!1),M=IB(c),[T=!1,S]=Fh({prop:n,defaultProp:s,onChange:i}),[k,$]=Fh({prop:o,defaultProp:a,onChange:l}),j=D.useRef(null),V=y?p||!!y.closest("form"):!0,[L,X]=D.useState(new Set),K=Array.from(L).map(Y=>Y.props.value).join(";");return G.jsx(Y6,{...m,children:G.jsxs(wQ,{required:f,scope:e,trigger:y,onTriggerChange:g,valueNode:_,onValueNodeChange:v,valueNodeHasChildren:w,onValueNodeHasChildrenChange:x,contentId:ru(),value:k,onValueChange:$,open:T,onOpenChange:S,dir:M,triggerPointerDownPosRef:j,disabled:h,children:[G.jsx($_.Provider,{scope:e,children:G.jsx(xQ,{scope:t.__scopeSelect,onNativeOptionAdd:D.useCallback(Y=>{X(J=>new Set(J).add(Y))},[]),onNativeOptionRemove:D.useCallback(Y=>{X(J=>{const N=new Set(J);return N.delete(Y),N})},[]),children:r})}),V?G.jsxs(D4,{"aria-hidden":!0,required:f,tabIndex:-1,name:u,autoComplete:d,value:k,onChange:Y=>$(Y.target.value),disabled:h,form:p,children:[k===void 0?G.jsx("option",{value:""}):null,Array.from(L)]},K):null]})})};l4.displayName=uf;var c4="SelectTrigger",u4=D.forwardRef((t,e)=>{const{__scopeSelect:r,disabled:n=!1,...s}=t,i=D_(r),o=qa(c4,r),a=o.disabled||n,l=cr(e,o.onTriggerChange),c=O_(r),u=D.useRef("touch"),[d,h,f]=I4(m=>{const y=c().filter(v=>!v.disabled),g=y.find(v=>v.value===o.value),_=F4(y,m,g);_!==void 0&&o.onValueChange(_.value)}),p=m=>{a||(o.onOpenChange(!0),f()),m&&(o.triggerPointerDownPosRef.current={x:Math.round(m.pageX),y:Math.round(m.pageY)})};return G.jsx(mR,{asChild:!0,...i,children:G.jsx(Kt.button,{type:"button",role:"combobox","aria-controls":o.contentId,"aria-expanded":o.open,"aria-required":o.required,"aria-autocomplete":"none",dir:o.dir,"data-state":o.open?"open":"closed",disabled:a,"data-disabled":a?"":void 0,"data-placeholder":O4(o.value)?"":void 0,...s,ref:l,onClick:$t(s.onClick,m=>{m.currentTarget.focus(),u.current!=="mouse"&&p(m)}),onPointerDown:$t(s.onPointerDown,m=>{u.current=m.pointerType;const y=m.target;y.hasPointerCapture(m.pointerId)&&y.releasePointerCapture(m.pointerId),m.button===0&&m.ctrlKey===!1&&m.pointerType==="mouse"&&(p(m),m.preventDefault())}),onKeyDown:$t(s.onKeyDown,m=>{const y=d.current!=="";!(m.ctrlKey||m.altKey||m.metaKey)&&m.key.length===1&&h(m.key),!(y&&m.key===" ")&&_Q.includes(m.key)&&(p(),m.preventDefault())})})})});u4.displayName=c4;var d4="SelectValue",h4=D.forwardRef((t,e)=>{const{__scopeSelect:r,className:n,style:s,children:i,placeholder:o="",...a}=t,l=qa(d4,r),{onValueNodeHasChildrenChange:c}=l,u=i!==void 0,d=cr(e,l.onValueNodeChange);return Kn(()=>{c(u)},[c,u]),G.jsx(Kt.span,{...a,ref:d,style:{pointerEvents:"none"},children:O4(l.value)?G.jsx(G.Fragment,{children:o}):i})});h4.displayName=d4;var MQ="SelectIcon",f4=D.forwardRef((t,e)=>{const{__scopeSelect:r,children:n,...s}=t;return G.jsx(Kt.span,{"aria-hidden":!0,...s,ref:e,children:n||""})});f4.displayName=MQ;var TQ="SelectPortal",p4=t=>G.jsx(s_,{asChild:!0,...t});p4.displayName=TQ;var ec="SelectContent",m4=D.forwardRef((t,e)=>{const r=qa(ec,t.__scopeSelect),[n,s]=D.useState();if(Kn(()=>{s(new DocumentFragment)},[]),!r.open){const i=n;return i?sc.createPortal(G.jsx(g4,{scope:t.__scopeSelect,children:G.jsx($_.Slot,{scope:t.__scopeSelect,children:G.jsx("div",{children:t.children})})}),i):null}return G.jsx(_4,{...t,ref:e})});m4.displayName=ec;var bi=10,[g4,Ya]=Xu(ec),CQ="SelectContentImpl",_4=D.forwardRef((t,e)=>{const{__scopeSelect:r,position:n="item-aligned",onCloseAutoFocus:s,onEscapeKeyDown:i,onPointerDownOutside:o,side:a,sideOffset:l,align:c,alignOffset:u,arrowPadding:d,collisionBoundary:h,collisionPadding:f,sticky:p,hideWhenDetached:m,avoidCollisions:y,...g}=t,_=qa(ec,r),[v,w]=D.useState(null),[x,M]=D.useState(null),T=cr(e,pe=>w(pe)),[S,k]=D.useState(null),[$,j]=D.useState(null),V=O_(r),[L,X]=D.useState(!1),K=D.useRef(!1);D.useEffect(()=>{if(v)return e4(v)},[v]),QB();const Y=D.useCallback(pe=>{const[$e,...Ne]=V().map(se=>se.ref.current),[de]=Ne.slice(-1),q=document.activeElement;for(const se of pe)if(se===q||(se==null||se.scrollIntoView({block:"nearest"}),se===$e&&x&&(x.scrollTop=0),se===de&&x&&(x.scrollTop=x.scrollHeight),se==null||se.focus(),document.activeElement!==q))return},[V,x]),J=D.useCallback(()=>Y([S,v]),[Y,S,v]);D.useEffect(()=>{L&&J()},[L,J]);const{onOpenChange:N,triggerPointerDownPosRef:ne}=_;D.useEffect(()=>{if(v){let pe={x:0,y:0};const $e=de=>{var q,se;pe={x:Math.abs(Math.round(de.pageX)-(((q=ne.current)==null?void 0:q.x)??0)),y:Math.abs(Math.round(de.pageY)-(((se=ne.current)==null?void 0:se.y)??0))}},Ne=de=>{pe.x<=10&&pe.y<=10?de.preventDefault():v.contains(de.target)||N(!1),document.removeEventListener("pointermove",$e),ne.current=null};return ne.current!==null&&(document.addEventListener("pointermove",$e),document.addEventListener("pointerup",Ne,{capture:!0,once:!0})),()=>{document.removeEventListener("pointermove",$e),document.removeEventListener("pointerup",Ne,{capture:!0})}}},[v,N,ne]),D.useEffect(()=>{const pe=()=>N(!1);return window.addEventListener("blur",pe),window.addEventListener("resize",pe),()=>{window.removeEventListener("blur",pe),window.removeEventListener("resize",pe)}},[N]);const[te,z]=I4(pe=>{const $e=V().filter(q=>!q.disabled),Ne=$e.find(q=>q.ref.current===document.activeElement),de=F4($e,pe,Ne);de&&setTimeout(()=>de.ref.current.focus())}),O=D.useCallback((pe,$e,Ne)=>{const de=!K.current&&!Ne;(_.value!==void 0&&_.value===$e||de)&&(k(pe),de&&(K.current=!0))},[_.value]),H=D.useCallback(()=>v==null?void 0:v.focus(),[v]),re=D.useCallback((pe,$e,Ne)=>{const de=!K.current&&!Ne;(_.value!==void 0&&_.value===$e||de)&&j(pe)},[_.value]),_e=n==="popper"?jx:y4,oe=_e===jx?{side:a,sideOffset:l,align:c,alignOffset:u,arrowPadding:d,collisionBoundary:h,collisionPadding:f,sticky:p,hideWhenDetached:m,avoidCollisions:y}:{};return G.jsx(g4,{scope:r,content:v,viewport:x,onViewportChange:M,itemRefCallback:O,selectedItem:S,onItemLeave:H,itemTextRefCallback:re,focusSelectedItem:J,selectedItemText:$,position:n,isPositioned:L,searchRef:te,children:G.jsx(lM,{as:ql,allowPinchZoom:!0,children:G.jsx(aM,{asChild:!0,trapped:_.open,onMountAutoFocus:pe=>{pe.preventDefault()},onUnmountAutoFocus:$t(s,pe=>{var $e;($e=_.trigger)==null||$e.focus({preventScroll:!0}),pe.preventDefault()}),children:G.jsx(rf,{asChild:!0,disableOutsidePointerEvents:!0,onEscapeKeyDown:i,onPointerDownOutside:o,onFocusOutside:pe=>pe.preventDefault(),onDismiss:()=>_.onOpenChange(!1),children:G.jsx(_e,{role:"listbox",id:_.contentId,"data-state":_.open?"open":"closed",dir:_.dir,onContextMenu:pe=>pe.preventDefault(),...g,...oe,onPlaced:()=>X(!0),ref:T,style:{display:"flex",flexDirection:"column",outline:"none",...g.style},onKeyDown:$t(g.onKeyDown,pe=>{const $e=pe.ctrlKey||pe.altKey||pe.metaKey;if(pe.key==="Tab"&&pe.preventDefault(),!$e&&pe.key.length===1&&z(pe.key),["ArrowUp","ArrowDown","Home","End"].includes(pe.key)){let de=V().filter(q=>!q.disabled).map(q=>q.ref.current);if(["ArrowUp","End"].includes(pe.key)&&(de=de.slice().reverse()),["ArrowUp","ArrowDown"].includes(pe.key)){const q=pe.target,se=de.indexOf(q);de=de.slice(se+1)}setTimeout(()=>Y(de)),pe.preventDefault()}})})})})})})});_4.displayName=CQ;var SQ="SelectItemAlignedPosition",y4=D.forwardRef((t,e)=>{const{__scopeSelect:r,onPlaced:n,...s}=t,i=qa(ec,r),o=Ya(ec,r),[a,l]=D.useState(null),[c,u]=D.useState(null),d=cr(e,T=>u(T)),h=O_(r),f=D.useRef(!1),p=D.useRef(!0),{viewport:m,selectedItem:y,selectedItemText:g,focusSelectedItem:_}=o,v=D.useCallback(()=>{if(i.trigger&&i.valueNode&&a&&c&&m&&y&&g){const T=i.trigger.getBoundingClientRect(),S=c.getBoundingClientRect(),k=i.valueNode.getBoundingClientRect(),$=g.getBoundingClientRect();if(i.dir!=="rtl"){const q=$.left-S.left,se=k.left-q,Q=T.left-se,Me=T.width+Q,Te=Math.max(Me,S.width),ke=window.innerWidth-bi,Pe=Ng(se,[bi,Math.max(bi,ke-Te)]);a.style.minWidth=Me+"px",a.style.left=Pe+"px"}else{const q=S.right-$.right,se=window.innerWidth-k.right-q,Q=window.innerWidth-T.right-se,Me=T.width+Q,Te=Math.max(Me,S.width),ke=window.innerWidth-bi,Pe=Ng(se,[bi,Math.max(bi,ke-Te)]);a.style.minWidth=Me+"px",a.style.right=Pe+"px"}const j=h(),V=window.innerHeight-bi*2,L=m.scrollHeight,X=window.getComputedStyle(c),K=parseInt(X.borderTopWidth,10),Y=parseInt(X.paddingTop,10),J=parseInt(X.borderBottomWidth,10),N=parseInt(X.paddingBottom,10),ne=K+Y+L+N+J,te=Math.min(y.offsetHeight*5,ne),z=window.getComputedStyle(m),O=parseInt(z.paddingTop,10),H=parseInt(z.paddingBottom,10),re=T.top+T.height/2-bi,_e=V-re,oe=y.offsetHeight/2,pe=y.offsetTop+oe,$e=K+Y+pe,Ne=ne-$e;if($e<=re){const q=j.length>0&&y===j[j.length-1].ref.current;a.style.bottom="0px";const se=c.clientHeight-m.offsetTop-m.offsetHeight,Q=Math.max(_e,oe+(q?H:0)+se+J),Me=$e+Q;a.style.height=Me+"px"}else{const q=j.length>0&&y===j[0].ref.current;a.style.top="0px";const Q=Math.max(re,K+m.offsetTop+(q?O:0)+oe)+Ne;a.style.height=Q+"px",m.scrollTop=$e-re+m.offsetTop}a.style.margin=`${bi}px 0`,a.style.minHeight=te+"px",a.style.maxHeight=V+"px",n==null||n(),requestAnimationFrame(()=>f.current=!0)}},[h,i.trigger,i.valueNode,a,c,m,y,g,i.dir,n]);Kn(()=>v(),[v]);const[w,x]=D.useState();Kn(()=>{c&&x(window.getComputedStyle(c).zIndex)},[c]);const M=D.useCallback(T=>{T&&p.current===!0&&(v(),_==null||_(),p.current=!1)},[v,_]);return G.jsx(PQ,{scope:r,contentWrapper:a,shouldExpandOnScrollRef:f,onScrollButtonChange:M,children:G.jsx("div",{ref:l,style:{display:"flex",flexDirection:"column",position:"fixed",zIndex:w},children:G.jsx(Kt.div,{...s,ref:d,style:{boxSizing:"border-box",maxHeight:"100%",...s.style}})})})});y4.displayName=SQ;var EQ="SelectPopperPosition",jx=D.forwardRef((t,e)=>{const{__scopeSelect:r,align:n="start",collisionPadding:s=bi,...i}=t,o=D_(r);return G.jsx(gR,{...o,...i,ref:e,align:n,collisionPadding:s,style:{boxSizing:"border-box",...i.style,"--radix-select-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-select-content-available-width":"var(--radix-popper-available-width)","--radix-select-content-available-height":"var(--radix-popper-available-height)","--radix-select-trigger-width":"var(--radix-popper-anchor-width)","--radix-select-trigger-height":"var(--radix-popper-anchor-height)"}})});jx.displayName=EQ;var[PQ,cM]=Xu(ec,{}),Nx="SelectViewport",v4=D.forwardRef((t,e)=>{const{__scopeSelect:r,nonce:n,...s}=t,i=Ya(Nx,r),o=cM(Nx,r),a=cr(e,i.onViewportChange),l=D.useRef(0);return G.jsxs(G.Fragment,{children:[G.jsx("style",{dangerouslySetInnerHTML:{__html:"[data-radix-select-viewport]{scrollbar-width:none;-ms-overflow-style:none;-webkit-overflow-scrolling:touch;}[data-radix-select-viewport]::-webkit-scrollbar{display:none}"},nonce:n}),G.jsx($_.Slot,{scope:r,children:G.jsx(Kt.div,{"data-radix-select-viewport":"",role:"presentation",...s,ref:a,style:{position:"relative",flex:1,overflow:"hidden auto",...s.style},onScroll:$t(s.onScroll,c=>{const u=c.currentTarget,{contentWrapper:d,shouldExpandOnScrollRef:h}=o;if(h!=null&&h.current&&d){const f=Math.abs(l.current-u.scrollTop);if(f>0){const p=window.innerHeight-bi*2,m=parseFloat(d.style.minHeight),y=parseFloat(d.style.height),g=Math.max(m,y);if(g<p){const _=g+f,v=Math.min(p,_),w=_-v;d.style.height=v+"px",d.style.bottom==="0px"&&(u.scrollTop=w>0?w:0,d.style.justifyContent="flex-end")}}}l.current=u.scrollTop})})})]})});v4.displayName=Nx;var w4="SelectGroup",[kQ,AQ]=Xu(w4),$Q=D.forwardRef((t,e)=>{const{__scopeSelect:r,...n}=t,s=ru();return G.jsx(kQ,{scope:r,id:s,children:G.jsx(Kt.div,{role:"group","aria-labelledby":s,...n,ref:e})})});$Q.displayName=w4;var x4="SelectLabel",b4=D.forwardRef((t,e)=>{const{__scopeSelect:r,...n}=t,s=AQ(x4,r);return G.jsx(Kt.div,{id:s.id,...n,ref:e})});b4.displayName=x4;var zg="SelectItem",[OQ,M4]=Xu(zg),T4=D.forwardRef((t,e)=>{const{__scopeSelect:r,value:n,disabled:s=!1,textValue:i,...o}=t,a=qa(zg,r),l=Ya(zg,r),c=a.value===n,[u,d]=D.useState(i??""),[h,f]=D.useState(!1),p=cr(e,_=>{var v;return(v=l.itemRefCallback)==null?void 0:v.call(l,_,n,s)}),m=ru(),y=D.useRef("touch"),g=()=>{s||(a.onValueChange(n),a.onOpenChange(!1))};if(n==="")throw new Error("A <Select.Item /> must have a value prop that is not an empty string. This is because the Select value can be set to an empty string to clear the selection and show the placeholder.");return G.jsx(OQ,{scope:r,value:n,disabled:s,textId:m,isSelected:c,onItemTextChange:D.useCallback(_=>{d(v=>v||((_==null?void 0:_.textContent)??"").trim())},[]),children:G.jsx($_.ItemSlot,{scope:r,value:n,disabled:s,textValue:u,children:G.jsx(Kt.div,{role:"option","aria-labelledby":m,"data-highlighted":h?"":void 0,"aria-selected":c&&h,"data-state":c?"checked":"unchecked","aria-disabled":s||void 0,"data-disabled":s?"":void 0,tabIndex:s?void 0:-1,...o,ref:p,onFocus:$t(o.onFocus,()=>f(!0)),onBlur:$t(o.onBlur,()=>f(!1)),onClick:$t(o.onClick,()=>{y.current!=="mouse"&&g()}),onPointerUp:$t(o.onPointerUp,()=>{y.current==="mouse"&&g()}),onPointerDown:$t(o.onPointerDown,_=>{y.current=_.pointerType}),onPointerMove:$t(o.onPointerMove,_=>{var v;y.current=_.pointerType,s?(v=l.onItemLeave)==null||v.call(l):y.current==="mouse"&&_.currentTarget.focus({preventScroll:!0})}),onPointerLeave:$t(o.onPointerLeave,_=>{var v;_.currentTarget===document.activeElement&&((v=l.onItemLeave)==null||v.call(l))}),onKeyDown:$t(o.onKeyDown,_=>{var w;((w=l.searchRef)==null?void 0:w.current)!==""&&_.key===" "||(yQ.includes(_.key)&&g(),_.key===" "&&_.preventDefault())})})})})});T4.displayName=zg;var rh="SelectItemText",C4=D.forwardRef((t,e)=>{const{__scopeSelect:r,className:n,style:s,...i}=t,o=qa(rh,r),a=Ya(rh,r),l=M4(rh,r),c=bQ(rh,r),[u,d]=D.useState(null),h=cr(e,g=>d(g),l.onItemTextChange,g=>{var _;return(_=a.itemTextRefCallback)==null?void 0:_.call(a,g,l.value,l.disabled)}),f=u==null?void 0:u.textContent,p=D.useMemo(()=>G.jsx("option",{value:l.value,disabled:l.disabled,children:f},l.value),[l.disabled,l.value,f]),{onNativeOptionAdd:m,onNativeOptionRemove:y}=c;return Kn(()=>(m(p),()=>y(p)),[m,y,p]),G.jsxs(G.Fragment,{children:[G.jsx(Kt.span,{id:l.textId,...i,ref:h}),l.isSelected&&o.valueNode&&!o.valueNodeHasChildren?sc.createPortal(i.children,o.valueNode):null]})});C4.displayName=rh;var S4="SelectItemIndicator",E4=D.forwardRef((t,e)=>{const{__scopeSelect:r,...n}=t;return M4(S4,r).isSelected?G.jsx(Kt.span,{"aria-hidden":!0,...n,ref:e}):null});E4.displayName=S4;var zx="SelectScrollUpButton",P4=D.forwardRef((t,e)=>{const r=Ya(zx,t.__scopeSelect),n=cM(zx,t.__scopeSelect),[s,i]=D.useState(!1),o=cr(e,n.onScrollButtonChange);return Kn(()=>{if(r.viewport&&r.isPositioned){let a=function(){const c=l.scrollTop>0;i(c)};const l=r.viewport;return a(),l.addEventListener("scroll",a),()=>l.removeEventListener("scroll",a)}},[r.viewport,r.isPositioned]),s?G.jsx(A4,{...t,ref:o,onAutoScroll:()=>{const{viewport:a,selectedItem:l}=r;a&&l&&(a.scrollTop=a.scrollTop-l.offsetHeight)}}):null});P4.displayName=zx;var Bx="SelectScrollDownButton",k4=D.forwardRef((t,e)=>{const r=Ya(Bx,t.__scopeSelect),n=cM(Bx,t.__scopeSelect),[s,i]=D.useState(!1),o=cr(e,n.onScrollButtonChange);return Kn(()=>{if(r.viewport&&r.isPositioned){let a=function(){const c=l.scrollHeight-l.clientHeight,u=Math.ceil(l.scrollTop)<c;i(u)};const l=r.viewport;return a(),l.addEventListener("scroll",a),()=>l.removeEventListener("scroll",a)}},[r.viewport,r.isPositioned]),s?G.jsx(A4,{...t,ref:o,onAutoScroll:()=>{const{viewport:a,selectedItem:l}=r;a&&l&&(a.scrollTop=a.scrollTop+l.offsetHeight)}}):null});k4.displayName=Bx;var A4=D.forwardRef((t,e)=>{const{__scopeSelect:r,onAutoScroll:n,...s}=t,i=Ya("SelectScrollButton",r),o=D.useRef(null),a=O_(r),l=D.useCallback(()=>{o.current!==null&&(window.clearInterval(o.current),o.current=null)},[]);return D.useEffect(()=>()=>l(),[l]),Kn(()=>{var u;const c=a().find(d=>d.ref.current===document.activeElement);(u=c==null?void 0:c.ref.current)==null||u.scrollIntoView({block:"nearest"})},[a]),G.jsx(Kt.div,{"aria-hidden":!0,...s,ref:e,style:{flexShrink:0,...s.style},onPointerDown:$t(s.onPointerDown,()=>{o.current===null&&(o.current=window.setInterval(n,50))}),onPointerMove:$t(s.onPointerMove,()=>{var c;(c=i.onItemLeave)==null||c.call(i),o.current===null&&(o.current=window.setInterval(n,50))}),onPointerLeave:$t(s.onPointerLeave,()=>{l()})})}),DQ="SelectSeparator",$4=D.forwardRef((t,e)=>{const{__scopeSelect:r,...n}=t;return G.jsx(Kt.div,{"aria-hidden":!0,...n,ref:e})});$4.displayName=DQ;var Vx="SelectArrow",IQ=D.forwardRef((t,e)=>{const{__scopeSelect:r,...n}=t,s=D_(r),i=qa(Vx,r),o=Ya(Vx,r);return i.open&&o.position==="popper"?G.jsx(_R,{...s,...n,ref:e}):null});IQ.displayName=Vx;function O4(t){return t===""||t===void 0}var D4=D.forwardRef((t,e)=>{const{value:r,...n}=t,s=D.useRef(null),i=cr(e,s),o=FB(r);return D.useEffect(()=>{const a=s.current,l=window.HTMLSelectElement.prototype,u=Object.getOwnPropertyDescriptor(l,"value").set;if(o!==r&&u){const d=new Event("change",{bubbles:!0});u.call(a,r),a.dispatchEvent(d)}},[o,r]),G.jsx(nf,{asChild:!0,children:G.jsx("select",{...n,ref:i,defaultValue:r})})});D4.displayName="BubbleSelect";function I4(t){const e=Rs(t),r=D.useRef(""),n=D.useRef(0),s=D.useCallback(o=>{const a=r.current+o;e(a),function l(c){r.current=c,window.clearTimeout(n.current),c!==""&&(n.current=window.setTimeout(()=>l(""),1e3))}(a)},[e]),i=D.useCallback(()=>{r.current="",window.clearTimeout(n.current)},[]);return D.useEffect(()=>()=>window.clearTimeout(n.current),[]),[r,s,i]}function F4(t,e,r){const s=e.length>1&&Array.from(e).every(c=>c===e[0])?e[0]:e,i=r?t.indexOf(r):-1;let o=FQ(t,Math.max(i,0));s.length===1&&(o=o.filter(c=>c!==r));const l=o.find(c=>c.textValue.toLowerCase().startsWith(s.toLowerCase()));return l!==r?l:void 0}function FQ(t,e){return t.map((r,n)=>t[(e+n)%t.length])}var LQ=l4,L4=u4,RQ=h4,jQ=f4,NQ=p4,R4=m4,zQ=v4,j4=b4,N4=T4,BQ=C4,VQ=E4,z4=P4,B4=k4,V4=$4;const WQ=LQ,UQ=RQ,W4=D.forwardRef(({className:t,children:e,...r},n)=>G.jsxs(L4,{ref:n,className:tr("flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1",t),...r,children:[e,G.jsx(jQ,{asChild:!0,children:G.jsx(jL,{className:"h-4 w-4 opacity-50"})})]}));W4.displayName=L4.displayName;const U4=D.forwardRef(({className:t,...e},r)=>G.jsx(z4,{ref:r,className:tr("flex cursor-default items-center justify-center py-1",t),...e,children:G.jsx(MG,{className:"h-4 w-4"})}));U4.displayName=z4.displayName;const G4=D.forwardRef(({className:t,...e},r)=>G.jsx(B4,{ref:r,className:tr("flex cursor-default items-center justify-center py-1",t),...e,children:G.jsx(jL,{className:"h-4 w-4"})}));G4.displayName=B4.displayName;const H4=D.forwardRef(({className:t,children:e,position:r="popper",...n},s)=>G.jsx(NQ,{children:G.jsxs(R4,{ref:s,className:tr("relative z-50 max-h-96 min-w-[8rem] overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",r==="popper"&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",t),position:r,...n,children:[G.jsx(U4,{}),G.jsx(zQ,{className:tr("p-1",r==="popper"&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:e}),G.jsx(G4,{})]})}));H4.displayName=R4.displayName;const GQ=D.forwardRef(({className:t,...e},r)=>G.jsx(j4,{ref:r,className:tr("py-1.5 pl-8 pr-2 text-sm font-semibold",t),...e}));GQ.displayName=j4.displayName;const K4=D.forwardRef(({className:t,children:e,...r},n)=>G.jsxs(N4,{ref:n,className:tr("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",t),...r,children:[G.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:G.jsx(VQ,{children:G.jsx(bG,{className:"h-4 w-4"})})}),G.jsx(BQ,{children:e})]}));K4.displayName=N4.displayName;const HQ=D.forwardRef(({className:t,...e},r)=>G.jsx(V4,{ref:r,className:tr("-mx-1 my-1 h-px bg-muted",t),...e}));HQ.displayName=V4.displayName;const mm=600,gm=600,KQ=[{value:"Arial",label:"Arial",preview:"Arial"},{value:"Helvetica",label:"Helvetica",preview:"Helvetica"},{value:"Times New Roman",label:"Times New Roman",preview:"Times New Roman"},{value:"Georgia",label:"Georgia",preview:"Georgia"},{value:"Verdana",label:"Verdana",preview:"Verdana"},{value:"Trebuchet MS",label:"Trebuchet MS",preview:"Trebuchet MS"},{value:"Impact",label:"Impact",preview:"Impact"},{value:"Comic Sans MS",label:"Comic Sans MS",preview:"Comic Sans MS"},{value:"Courier New",label:"Courier New",preview:"Courier New"},{value:"Lucida Console",label:"Lucida Console",preview:"Lucida Console"},{value:"Tahoma",label:"Tahoma",preview:"Tahoma"},{value:"Arial Black",label:"Arial Black",preview:"Arial Black"}],XQ=({imageUrl:t,caption:e,onCaptionChange:r})=>{const n=D.useRef(null),[s,i]=D.useState(null),[o,a]=D.useState(null),[l,c]=D.useState(24),[u,d]=D.useState("#ffffff"),[h,f]=D.useState("Arial"),[p,m]=D.useState({width:mm,height:gm}),[y,g]=D.useState({width:mm,height:gm}),[_,v]=D.useState({left:p.width/2,top:p.height-80,angle:0,scaleX:1,scaleY:1});D.useEffect(()=>{v({left:p.width/2,top:p.height-80,angle:0,scaleX:1,scaleY:1})},[t,p.width,p.height]),D.useEffect(()=>{if(!t)return;const S=new window.Image;S.onload=()=>{let k=S.naturalWidth,$=S.naturalHeight;g({width:k,height:$});const j=Math.min(mm/k,gm/$,1);k=Math.round(k*j),$=Math.round($*j),m({width:k,height:$})},S.src=t},[t]),D.useEffect(()=>{if(!n.current)return;const S=new Rg(n.current,{width:p.width,height:p.height,backgroundColor:"#f5f5f5"});return i(S),S.on("mouse:dblclick",k=>{if(k.target&&k.target.type==="text"){const $=k.target;$.set("editing",!0),S.setActiveObject($),S.renderAll()}}),()=>{S.dispose()}},[p.width,p.height]),D.useEffect(()=>{!s||!t||cs.fromURL(t,{crossOrigin:"anonymous"}).then(S=>{if(!s)return;s.clear();const k=s.width||mm,$=s.height||gm,j=S.width||1,V=S.height||1,L=Math.min(k/j,$/V);S.scale(L),S.left=(k-S.getScaledWidth())/2,S.top=($-S.getScaledHeight())/2,s.add(S),S.selectable=!1,S.evented=!1,s.renderAll()})},[s,t,p.width,p.height]),D.useEffect(()=>{if(!s||!e)return;o&&s.remove(o);const S=new Dn(e,{left:_.left,top:_.top,angle:_.angle,scaleX:_.scaleX,scaleY:_.scaleY,fontSize:l,fill:u,fontFamily:h,textAlign:"center",originX:"center",originY:"center",selectable:!0,editable:!0,hasControls:!0,hasBorders:!0});s.add(S),a(S);const k=()=>{S.text&&r(S.text),v({left:S.left??p.width/2,top:S.top??p.height-80,angle:S.angle??0,scaleX:S.scaleX??1,scaleY:S.scaleY??1})};return S.on("modified",k),s.renderAll(),()=>{S&&S.off("modified",k)}},[s,e,l,u,h,r,p.width,p.height,_.left,_.top,_.angle,_.scaleX,_.scaleY]);const w=S=>{const k=S[0];c(k),o&&(o.set("fontSize",k),s==null||s.renderAll())},x=S=>{const k=S.target.value;d(k),o&&(o.set("fill",k),s==null||s.renderAll())},M=S=>{f(S),o&&(o.set("fontFamily",S),s==null||s.renderAll())},T=()=>{if(!s)return;const S=new Rg(null,{width:y.width,height:y.height,backgroundColor:"#f5f5f5"});cs.fromURL(t,{crossOrigin:"anonymous"}).then(k=>{k.left=0,k.top=0,k.scaleX=1,k.scaleY=1,k.selectable=!1,k.evented=!1,S.add(k);const $=y.width/p.width,j=y.height/p.height,V=new Dn(e,{left:_.left*$,top:_.top*j,angle:_.angle,scaleX:_.scaleX*$,scaleY:_.scaleY*j,fontSize:l,fill:u,fontFamily:h,textAlign:"center",originX:"center",originY:"center",selectable:!1,editable:!1,hasControls:!1,hasBorders:!1});S.add(V),S.renderAll();const L=S.toDataURL({format:"png",quality:1,multiplier:1}),X=document.createElement("a");X.download="captioned-photo.png",X.href=L,X.click(),S.dispose()})};return G.jsx(__,{className:"p-6",children:G.jsxs("div",{className:"space-y-6",children:[G.jsxs("div",{className:"flex items-center justify-between",children:[G.jsxs("h2",{className:"text-xl font-semibold flex items-center gap-2",children:[G.jsx(My,{className:"w-5 h-5 text-blue-500"}),"Photo Editor"]}),G.jsxs(oo,{onClick:T,className:"gap-2",children:[G.jsx(TG,{className:"w-4 h-4"}),"Download"]})]}),G.jsx("div",{className:"flex justify-center",children:G.jsx("div",{className:"border border-gray-200 rounded-lg overflow-hidden bg-gray-50",style:{width:p.width,height:p.height},children:G.jsx("canvas",{ref:n,width:p.width,height:p.height,className:"block max-w-full h-auto"})})}),G.jsxs("div",{className:"space-y-4",children:[G.jsxs("div",{className:"flex items-center gap-4",children:[G.jsxs("div",{className:"flex items-center gap-2",children:[G.jsx(My,{className:"w-4 h-4"}),G.jsx("span",{className:"text-sm font-medium",children:"Font Size:"})]}),G.jsx("div",{className:"flex-1",children:G.jsx(YB,{value:[l],onValueChange:w,min:12,max:72,step:1,className:"w-full"})}),G.jsxs("span",{className:"text-sm text-gray-600 min-w-[2rem]",children:[l,"px"]})]}),G.jsxs("div",{className:"flex items-center gap-4",children:[G.jsxs("div",{className:"flex items-center gap-2",children:[G.jsx(My,{className:"w-4 h-4"}),G.jsx("span",{className:"text-sm font-medium",children:"Font Family:"})]}),G.jsx("div",{className:"flex-1",children:G.jsxs(WQ,{value:h,onValueChange:M,children:[G.jsx(W4,{className:"w-full",children:G.jsx(UQ,{placeholder:"Select a font"})}),G.jsx(H4,{children:KQ.map(S=>G.jsx(K4,{value:S.value,children:G.jsx("span",{style:{fontFamily:S.value},children:S.label})},S.value))})]})})]}),G.jsxs("div",{className:"flex items-center gap-4",children:[G.jsxs("div",{className:"flex items-center gap-2",children:[G.jsx(SG,{className:"w-4 h-4"}),G.jsx("span",{className:"text-sm font-medium",children:"Text Color:"})]}),G.jsx("input",{type:"color",value:u,onChange:x,className:"w-8 h-8 rounded border border-gray-300 cursor-pointer"})]})]}),G.jsx("p",{className:"text-sm text-gray-500",children:"Double-click the text to edit it, or drag to reposition the caption."})]})})};var uM="Dialog",[X4,q4]=Iu(uM),[qQ,Wi]=X4(uM),Y4=t=>{const{__scopeDialog:e,children:r,open:n,defaultOpen:s,onOpenChange:i,modal:o=!0}=t,a=D.useRef(null),l=D.useRef(null),[c=!1,u]=Fh({prop:n,defaultProp:s,onChange:i});return G.jsx(qQ,{scope:e,triggerRef:a,contentRef:l,contentId:ru(),titleId:ru(),descriptionId:ru(),open:c,onOpenChange:u,onOpenToggle:D.useCallback(()=>u(d=>!d),[u]),modal:o,children:r})};Y4.displayName=uM;var Q4="DialogTrigger",J4=D.forwardRef((t,e)=>{const{__scopeDialog:r,...n}=t,s=Wi(Q4,r),i=cr(e,s.triggerRef);return G.jsx(Kt.button,{type:"button","aria-haspopup":"dialog","aria-expanded":s.open,"aria-controls":s.contentId,"data-state":fM(s.open),...n,ref:i,onClick:$t(t.onClick,s.onOpenToggle)})});J4.displayName=Q4;var dM="DialogPortal",[YQ,Z4]=X4(dM,{forceMount:void 0}),eV=t=>{const{__scopeDialog:e,forceMount:r,children:n,container:s}=t,i=Wi(dM,e);return G.jsx(YQ,{scope:e,forceMount:r,children:D.Children.map(n,o=>G.jsx(Fu,{present:r||i.open,children:G.jsx(s_,{asChild:!0,container:s,children:o})}))})};eV.displayName=dM;var Bg="DialogOverlay",tV=D.forwardRef((t,e)=>{const r=Z4(Bg,t.__scopeDialog),{forceMount:n=r.forceMount,...s}=t,i=Wi(Bg,t.__scopeDialog);return i.modal?G.jsx(Fu,{present:n||i.open,children:G.jsx(QQ,{...s,ref:e})}):null});tV.displayName=Bg;var QQ=D.forwardRef((t,e)=>{const{__scopeDialog:r,...n}=t,s=Wi(Bg,r);return G.jsx(lM,{as:ql,allowPinchZoom:!0,shards:[s.contentRef],children:G.jsx(Kt.div,{"data-state":fM(s.open),...n,ref:e,style:{pointerEvents:"auto",...n.style}})})}),tc="DialogContent",rV=D.forwardRef((t,e)=>{const r=Z4(tc,t.__scopeDialog),{forceMount:n=r.forceMount,...s}=t,i=Wi(tc,t.__scopeDialog);return G.jsx(Fu,{present:n||i.open,children:i.modal?G.jsx(JQ,{...s,ref:e}):G.jsx(ZQ,{...s,ref:e})})});rV.displayName=tc;var JQ=D.forwardRef((t,e)=>{const r=Wi(tc,t.__scopeDialog),n=D.useRef(null),s=cr(e,r.contentRef,n);return D.useEffect(()=>{const i=n.current;if(i)return e4(i)},[]),G.jsx(nV,{...t,ref:s,trapFocus:r.open,disableOutsidePointerEvents:!0,onCloseAutoFocus:$t(t.onCloseAutoFocus,i=>{var o;i.preventDefault(),(o=r.triggerRef.current)==null||o.focus()}),onPointerDownOutside:$t(t.onPointerDownOutside,i=>{const o=i.detail.originalEvent,a=o.button===0&&o.ctrlKey===!0;(o.button===2||a)&&i.preventDefault()}),onFocusOutside:$t(t.onFocusOutside,i=>i.preventDefault())})}),ZQ=D.forwardRef((t,e)=>{const r=Wi(tc,t.__scopeDialog),n=D.useRef(!1),s=D.useRef(!1);return G.jsx(nV,{...t,ref:e,trapFocus:!1,disableOutsidePointerEvents:!1,onCloseAutoFocus:i=>{var o,a;(o=t.onCloseAutoFocus)==null||o.call(t,i),i.defaultPrevented||(n.current||(a=r.triggerRef.current)==null||a.focus(),i.preventDefault()),n.current=!1,s.current=!1},onInteractOutside:i=>{var l,c;(l=t.onInteractOutside)==null||l.call(t,i),i.defaultPrevented||(n.current=!0,i.detail.originalEvent.type==="pointerdown"&&(s.current=!0));const o=i.target;((c=r.triggerRef.current)==null?void 0:c.contains(o))&&i.preventDefault(),i.detail.originalEvent.type==="focusin"&&s.current&&i.preventDefault()}})}),nV=D.forwardRef((t,e)=>{const{__scopeDialog:r,trapFocus:n,onOpenAutoFocus:s,onCloseAutoFocus:i,...o}=t,a=Wi(tc,r),l=D.useRef(null),c=cr(e,l);return QB(),G.jsxs(G.Fragment,{children:[G.jsx(aM,{asChild:!0,loop:!0,trapped:n,onMountAutoFocus:s,onUnmountAutoFocus:i,children:G.jsx(rf,{role:"dialog",id:a.contentId,"aria-describedby":a.descriptionId,"aria-labelledby":a.titleId,"data-state":fM(a.open),...o,ref:c,onDismiss:()=>a.onOpenChange(!1)})}),G.jsxs(G.Fragment,{children:[G.jsx(tJ,{titleId:a.titleId}),G.jsx(nJ,{contentRef:l,descriptionId:a.descriptionId})]})]})}),hM="DialogTitle",sV=D.forwardRef((t,e)=>{const{__scopeDialog:r,...n}=t,s=Wi(hM,r);return G.jsx(Kt.h2,{id:s.titleId,...n,ref:e})});sV.displayName=hM;var iV="DialogDescription",oV=D.forwardRef((t,e)=>{const{__scopeDialog:r,...n}=t,s=Wi(iV,r);return G.jsx(Kt.p,{id:s.descriptionId,...n,ref:e})});oV.displayName=iV;var aV="DialogClose",lV=D.forwardRef((t,e)=>{const{__scopeDialog:r,...n}=t,s=Wi(aV,r);return G.jsx(Kt.button,{type:"button",...n,ref:e,onClick:$t(t.onClick,()=>s.onOpenChange(!1))})});lV.displayName=aV;function fM(t){return t?"open":"closed"}var cV="DialogTitleWarning",[eJ,uV]=L5(cV,{contentName:tc,titleName:hM,docsSlug:"dialog"}),tJ=({titleId:t})=>{const e=uV(cV),r=`\`${e.contentName}\` requires a \`${e.titleName}\` for the component to be accessible for screen reader users.

If you want to hide the \`${e.titleName}\`, you can wrap it with our VisuallyHidden component.

For more information, see https://radix-ui.com/primitives/docs/components/${e.docsSlug}`;return D.useEffect(()=>{t&&(document.getElementById(t)||console.error(r))},[r,t]),null},rJ="DialogDescriptionWarning",nJ=({contentRef:t,descriptionId:e})=>{const n=`Warning: Missing \`Description\` or \`aria-describedby={undefined}\` for {${uV(rJ).contentName}}.`;return D.useEffect(()=>{var i;const s=(i=t.current)==null?void 0:i.getAttribute("aria-describedby");e&&s&&(document.getElementById(e)||console.warn(n))},[n,t,e]),null},sJ=Y4,iJ=J4,oJ=eV,aJ=tV,lJ=rV,cJ=sV,uJ=oV,dV=lV,hV="AlertDialog",[dJ,LJ]=Iu(hV,[q4]),qo=q4(),fV=t=>{const{__scopeAlertDialog:e,...r}=t,n=qo(e);return G.jsx(sJ,{...n,...r,modal:!0})};fV.displayName=hV;var hJ="AlertDialogTrigger",fJ=D.forwardRef((t,e)=>{const{__scopeAlertDialog:r,...n}=t,s=qo(r);return G.jsx(iJ,{...s,...n,ref:e})});fJ.displayName=hJ;var pJ="AlertDialogPortal",pV=t=>{const{__scopeAlertDialog:e,...r}=t,n=qo(e);return G.jsx(oJ,{...n,...r})};pV.displayName=pJ;var mJ="AlertDialogOverlay",mV=D.forwardRef((t,e)=>{const{__scopeAlertDialog:r,...n}=t,s=qo(r);return G.jsx(aJ,{...s,...n,ref:e})});mV.displayName=mJ;var cu="AlertDialogContent",[gJ,_J]=dJ(cu),gV=D.forwardRef((t,e)=>{const{__scopeAlertDialog:r,children:n,...s}=t,i=qo(r),o=D.useRef(null),a=cr(e,o),l=D.useRef(null);return G.jsx(eJ,{contentName:cu,titleName:_V,docsSlug:"alert-dialog",children:G.jsx(gJ,{scope:r,cancelRef:l,children:G.jsxs(lJ,{role:"alertdialog",...i,...s,ref:a,onOpenAutoFocus:$t(s.onOpenAutoFocus,c=>{var u;c.preventDefault(),(u=l.current)==null||u.focus({preventScroll:!0})}),onPointerDownOutside:c=>c.preventDefault(),onInteractOutside:c=>c.preventDefault(),children:[G.jsx(U1,{children:n}),G.jsx(vJ,{contentRef:o})]})})})});gV.displayName=cu;var _V="AlertDialogTitle",yV=D.forwardRef((t,e)=>{const{__scopeAlertDialog:r,...n}=t,s=qo(r);return G.jsx(cJ,{...s,...n,ref:e})});yV.displayName=_V;var vV="AlertDialogDescription",wV=D.forwardRef((t,e)=>{const{__scopeAlertDialog:r,...n}=t,s=qo(r);return G.jsx(uJ,{...s,...n,ref:e})});wV.displayName=vV;var yJ="AlertDialogAction",xV=D.forwardRef((t,e)=>{const{__scopeAlertDialog:r,...n}=t,s=qo(r);return G.jsx(dV,{...s,...n,ref:e})});xV.displayName=yJ;var bV="AlertDialogCancel",MV=D.forwardRef((t,e)=>{const{__scopeAlertDialog:r,...n}=t,{cancelRef:s}=_J(bV,r),i=qo(r),o=cr(e,s);return G.jsx(dV,{...i,...n,ref:o})});MV.displayName=bV;var vJ=({contentRef:t})=>{const e=`\`${cu}\` requires a description for the component to be accessible for screen reader users.

You can add a description to the \`${cu}\` by passing a \`${vV}\` component as a child, which also benefits sighted users by adding visible context to the dialog.

Alternatively, you can use your own component as a description by assigning it an \`id\` and passing the same value to the \`aria-describedby\` prop in \`${cu}\`. If the description is confusing or duplicative for sighted users, you can use the \`@radix-ui/react-visually-hidden\` primitive as a wrapper around your description component.

For more information, see https://radix-ui.com/primitives/docs/components/alert-dialog`;return D.useEffect(()=>{var n;document.getElementById((n=t.current)==null?void 0:n.getAttribute("aria-describedby"))||console.warn(e)},[e,t]),null},wJ=fV,xJ=pV,TV=mV,CV=gV,SV=xV,EV=MV,PV=yV,kV=wV;const ND=wJ,bJ=xJ,AV=D.forwardRef(({className:t,...e},r)=>G.jsx(TV,{className:tr("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",t),...e,ref:r}));AV.displayName=TV.displayName;const Wx=D.forwardRef(({className:t,...e},r)=>G.jsxs(bJ,{children:[G.jsx(AV,{}),G.jsx(CV,{ref:r,className:tr("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",t),...e})]}));Wx.displayName=CV.displayName;const Ux=({className:t,...e})=>G.jsx("div",{className:tr("flex flex-col space-y-2 text-center sm:text-left",t),...e});Ux.displayName="AlertDialogHeader";const Gx=({className:t,...e})=>G.jsx("div",{className:tr("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",t),...e});Gx.displayName="AlertDialogFooter";const Hx=D.forwardRef(({className:t,...e},r)=>G.jsx(PV,{ref:r,className:tr("text-lg font-semibold",t),...e}));Hx.displayName=PV.displayName;const Kx=D.forwardRef(({className:t,...e},r)=>G.jsx(kV,{ref:r,className:tr("text-sm text-muted-foreground",t),...e}));Kx.displayName=kV.displayName;const Xx=D.forwardRef(({className:t,...e},r)=>G.jsx(SV,{ref:r,className:tr(ub(),t),...e}));Xx.displayName=SV.displayName;const qx=D.forwardRef(({className:t,...e},r)=>G.jsx(EV,{ref:r,className:tr(ub({variant:"outline"}),"mt-2 sm:mt-0",t),...e}));qx.displayName=EV.displayName;const MJ=()=>Math.random().toString(36).substr(2,9),TJ=({photos:t,selectedPhotoId:e,onSelect:r,onUploadClick:n,onDelete:s})=>G.jsxs("aside",{className:"w-28 bg-white border-r border-gray-200 flex flex-col items-center py-4 gap-4",children:[G.jsx(oo,{variant:"outline",size:"icon",className:"mb-2",onClick:n,title:"Upload New Photo",children:G.jsx(EG,{className:"w-5 h-5"})}),G.jsx("div",{className:"flex flex-col gap-3 w-full items-center",children:t.map(i=>G.jsxs("div",{className:"relative group w-16 h-16",children:[G.jsx("button",{onClick:()=>r(i.id),className:`rounded border-2 w-16 h-16 overflow-hidden flex items-center justify-center transition-all ${e===i.id?"border-blue-500 ring-2 ring-blue-300":"border-gray-200 hover:border-blue-300"}`,style:{background:"#f9f9f9"},children:G.jsx("img",{src:i.preview,alt:"Thumbnail",className:"object-cover w-full h-full"})}),G.jsx("button",{onClick:()=>s(i.id),className:"absolute -top-2 -right-2 w-5 h-5 rounded-full bg-white border border-gray-300 text-gray-500 hover:bg-red-500 hover:text-white flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity z-10 shadow",title:"Remove photo",tabIndex:-1,type:"button",children:G.jsx("svg",{viewBox:"0 0 20 20",fill:"currentColor",className:"w-3.5 h-3.5",children:G.jsx("path",{fillRule:"evenodd",d:"M10 8.586l4.95-4.95a1 1 0 111.414 1.415L11.414 10l4.95 4.95a1 1 0 01-1.414 1.414L10 11.414l-4.95 4.95a1 1 0 01-1.414-1.414L8.586 10l-4.95-4.95A1 1 0 115.05 3.636L10 8.586z",clipRule:"evenodd"})})})]},i.id))})]}),zD=()=>{const[t,e]=D.useState([]),[r,n]=D.useState(null),[s,i]=D.useState(!1),[o,a]=D.useState(!1),[l,c]=D.useState(!1),[u,d]=D.useState(!1),[h,f]=D.useState(null),p=t.find(S=>S.id===r)||null,m=S=>{const k=URL.createObjectURL(S),$={id:MJ(),file:S,preview:k,caption:""};e(j=>{const V=[...j,$];return console.log("Photos after upload:",V),V}),n($.id),console.log("Selected photo ID after upload:",$.id),c(!1)},y=S=>{r&&e(k=>{const $=k.map(j=>j.id===r?{...j,caption:S}:j);return console.log("Photos after caption update:",$),$})},g=()=>{n(null),i(!1),a(!1),console.log("Editor reset. Selected photo ID:",null)},_=()=>c(!0),v=()=>c(!1),w=S=>{e(k=>{const $=k.filter(j=>j.id!==S);return r===S&&($.length>0?n($[0].id):n(null)),$})},x=S=>{f(S),d(!0)},M=()=>{h&&w(h),d(!1),f(null)},T=()=>{d(!1),f(null)};return G.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 via-white to-purple-50",children:[G.jsxs("div",{className:"container mx-auto px-4 py-8",children:[G.jsxs("div",{className:"text-center mb-8",children:[G.jsx("h1",{className:"text-4xl font-bold bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent mb-4",children:"Photo Caption Editor"}),G.jsx("p",{className:"text-gray-600 text-lg max-w-2xl mx-auto",children:"Upload your photo, generate a caption, and customize how it appears on your image"})]}),t.length===0?G.jsx("div",{className:"max-w-6xl mx-auto",children:G.jsx(ik,{onImageUpload:m})}):G.jsxs("div",{className:"max-w-6xl mx-auto flex",children:[G.jsx(TJ,{photos:t,selectedPhotoId:r,onSelect:n,onUploadClick:_,onDelete:x}),G.jsxs("div",{className:"flex-1",children:[l&&G.jsxs("div",{className:"flex justify-center items-center h-full min-h-[400px]",children:[G.jsx(ik,{onImageUpload:m}),G.jsx(oo,{onClick:v,variant:"ghost",className:"ml-4",children:"Cancel"})]}),p&&!l&&G.jsxs("div",{className:"flex flex-col gap-8",children:[G.jsx("div",{className:"w-full",children:G.jsx(XQ,{imageUrl:p.preview,caption:p.caption,onCaptionChange:y})}),G.jsx("div",{className:"w-full",children:G.jsx(_X,{image:p.file,onCaptionGenerated:y,isGenerating:o,setIsGenerating:a})})]})]})]})]}),G.jsx(ND,{open:s,onOpenChange:i,children:G.jsxs(Wx,{className:"max-w-md",children:[G.jsxs(Ux,{children:[G.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[G.jsx("div",{className:"w-10 h-10 bg-orange-100 rounded-full flex items-center justify-center",children:G.jsx(A2,{className:"w-5 h-5 text-orange-600"})}),G.jsx(Hx,{className:"text-lg",children:"Unsaved Changes"})]}),G.jsx(Kx,{className:"text-gray-600",children:o?"You're currently generating a caption. Are you sure you want to upload a different photo and lose your progress?":"You have a caption that hasn't been saved. Are you sure you want to upload a different photo and lose your current work?"})]}),G.jsxs(Gx,{className:"gap-3",children:[G.jsx(qx,{asChild:!0,children:G.jsx(oo,{variant:"outline",className:"flex-1",children:"Keep Current Photo"})}),G.jsx(Xx,{asChild:!0,children:G.jsxs(oo,{onClick:g,variant:"destructive",className:"flex-1 bg-gradient-to-r from-red-500 to-red-600 hover:from-red-600 hover:to-red-700",children:[G.jsx(NL,{className:"w-4 h-4 mr-2"}),"Upload New Photo"]})})]})]})}),G.jsx(ND,{open:u,onOpenChange:d,children:G.jsxs(Wx,{className:"max-w-md",children:[G.jsxs(Ux,{children:[G.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[G.jsx("div",{className:"w-10 h-10 bg-orange-100 rounded-full flex items-center justify-center",children:G.jsx(A2,{className:"w-5 h-5 text-orange-600"})}),G.jsx(Hx,{className:"text-lg",children:"Delete Photo?"})]}),G.jsx(Kx,{className:"text-gray-600",children:"Deleting this photo will also delete its caption and any edits. This action cannot be undone. Are you sure you want to continue?"})]}),G.jsxs(Gx,{className:"gap-3",children:[G.jsx(qx,{asChild:!0,children:G.jsx(oo,{variant:"outline",className:"flex-1",onClick:T,children:"Cancel"})}),G.jsx(Xx,{asChild:!0,children:G.jsx(oo,{onClick:M,variant:"destructive",className:"flex-1 bg-gradient-to-r from-red-500 to-red-600 hover:from-red-600 hover:to-red-700",children:"Delete Photo"})})]})]})})]})},CJ=new LH,SJ=()=>G.jsx(jH,{client:CJ,children:G.jsxs(fH,{children:[G.jsx(d8,{}),G.jsx(z8,{}),G.jsx(MK,{children:G.jsxs(wK,{children:[G.jsx(tx,{path:"/",element:G.jsx(zD,{})}),G.jsx(tx,{path:"*",element:G.jsx(zD,{})})]})})]})});uL(document.getElementById("root")).render(G.jsx(SJ,{}));
